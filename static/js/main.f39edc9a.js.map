{"version":3,"file":"static/js/main.f39edc9a.js","mappings":"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","sources":["src/utils/Storage.tsx","i18n.ts","src/utils/CoreUtils.tsx","src/utils/I18n.tsx","src/utils/FormattingUtils.tsx","src/utils/Versioning.web.tsx","src/backend/exploration/ExplorationStatus.tsx","src/backend/GameState.tsx","src/backend/Caching.tsx","src/backend/Demo.tsx","src/backend/generic/Identifiable.tsx","src/backend/generic/DataStore.tsx","src/backend/Flags.tsx","src/backend/GameStateListeners.tsx","src/backend/transformation/TransformationTags.tsx","src/backend/transformation/Transformation.tsx","src/backend/Resources.tsx","src/backend/Retire.tsx","src/backend/action/ActionAreas.tsx","src/backend/spells/VisibleSpellsCache.tsx","src/backend/spells/Elements.tsx","src/Themes.tsx","src/backend/exploration/dungeons/Dungeons.tsx","src/backend/storylines/Storyline.tsx","src/backend/events/storyline/cavern/SchematicsStoryline.tsx","src/backend/Flag.tsx","src/backend/items/Items.tsx","src/backend/items/Inventory.tsx","src/backend/exploration/AttackTarget.tsx","src/backend/exploration/CombatStats.tsx","src/backend/timetick/OfflineTickListeners.tsx","src/backend/timetick/WarpTimeListeners.tsx","src/backend/timetick/TimeTick.tsx","src/backend/timetick/TotalTimePlayed.tsx","src/backend/action/Actions.tsx","src/backend/spells/Spells.tsx","src/backend/study/ResearcherAutoAssignStrategy.tsx","src/backend/study/Study.tsx","src/backend/timetick/IncomeOverTime.tsx","src/backend/items/Equipment.tsx","src/backend/SaveData.tsx","src/backend/UICommands.tsx","src/utils/ElectronUtils.tsx","src/utils/Achievements.web.tsx","src/backend/AccumulatorVariables.tsx","src/backend/exploration/ExplorationUtils.tsx","src/backend/familiars/Familiar.tsx","src/backend/temporaryeffects/TemporaryEffects.tsx","src/backend/exploration/DeathInterceptors.tsx","src/backend/exploration/ExplorationActionResult.tsx","src/backend/exploration/Summoning.tsx","src/backend/exploration/enemies/Enemies.tsx","src/backend/exploration/Exploration.tsx","src/backend/familiars/FamiliarUtils.tsx","src/backend/exploration/enemies/Enemy.tsx","src/backend/Achievements.tsx","src/backend/classes/CombatClassesStoryline.tsx","src/backend/classes/CombatClasses.tsx","src/backend/storylines/Storylines.tsx","src/backend/ending/Endings.tsx","src/backend/events/EmptyEventMessage.tsx","src/backend/events/GameEvent.tsx","src/backend/events/Events.tsx","src/backend/events/EventMessageBuilder.tsx","src/backend/events/DemoEndEvent.web.tsx","src/components/utility/AuxOptionsContext.tsx","src/components/utility/Text.tsx","src/components/utility/Button.tsx","src/components/utility/icons/GameIcon.tsx","src/components/utility/markdown/MarkdownIconPlugin.tsx","src/components/utility/markdown/MarkdownTooltipPlugin.tsx","src/components/utility/Markdown.tsx","src/components/utility/Styles.tsx","src/components/About.tsx","src/backend/action/Action.tsx","src/backend/events/storyline/desert/BoostingMachineStoryline.tsx","src/backend/spells/channeling/ChannelingResources.tsx","src/backend/boost/BoostActionBase.tsx","src/backend/Notification.tsx","src/backend/Notifications.tsx","src/backend/autocast/AutocastCondition.tsx","src/backend/autocast/conditions/AlwaysAutocastCondition.tsx","src/backend/autocast/AutocastConditionParameterType.tsx","src/backend/autocast/conditions/parameters/NumericAutocastConditionParameterType.tsx","src/backend/autocast/conditions/parameters/ResourceAutocastConditionParameterType.tsx","src/backend/autocast/conditions/ResourceLessThanAutocastCondition.tsx","src/backend/autocast/conditions/ResourceLessThanAutocastConditionRatio.tsx","src/backend/autocast/conditions/ResourceMoreThanAutocastCondition.tsx","src/backend/autocast/conditions/ResourceMoreThanAutocastConditionRatio.tsx","src/backend/autocast/conditions/SmartlyAutocastCondition.tsx","src/backend/autocast/conditions/parameters/TemporaryEffectAutocastConditionParameterType.tsx","src/backend/autocast/conditions/TemporaryEffectLowTimeRemainingAutocastCondition.tsx","src/backend/autocast/conditions/TemporaryEffectPresentAutocastCondition.tsx","src/backend/autocast/Autocast.tsx","src/backend/autocast/conditions/AutocastConditionLoader.tsx","src/backend/enhancement/Enhancements.tsx","src/backend/spells/SpellCastListeners.tsx","src/backend/spells/Utils.tsx","src/backend/spells/Spell.tsx","src/backend/items/transmute/TransmutationSpell.tsx","src/backend/temporaryeffects/TemporaryEffect.tsx","src/backend/rituals/RitualWeakness.tsx","src/backend/rituals/Rituals.tsx","src/backend/spells/ElementMultipliers.tsx","src/backend/events/progression/LevelUp.tsx","src/backend/items/ItemCompendium.tsx","src/backend/spellcraft/Spellcraft.tsx","src/backend/spellcraft/Spellcrafts.tsx","src/backend/spellcraft/SpellcraftUtils.tsx","src/backend/synchro/SynchroBonuses.tsx","src/backend/synchro/Synchro.tsx","src/components/utility/Miscellaneous.tsx","src/components/utility/TooltipContext.tsx","src/components/utility/VisibilityContext.tsx","src/components/utility/Tooltip.web.tsx","src/components/inventory/ItemTile.tsx","src/backend/buildings/Buildings.tsx","src/backend/buildings/Building.tsx","src/components/utility/CheckBox.tsx","src/components/utility/CostViewer.tsx","src/components/utility/IconButton.tsx","src/components/utility/PlusMinusAllocator.tsx","src/components/utility/SpellWizardsInfo.tsx","src/backend/spells/GameStartup.tsx","src/components/utility/StatePersistedExpandedUI.tsx","src/components/utility/ActionContainer.tsx","src/components/utility/Divider.tsx","src/components/utility/GameStateFreezer.tsx","src/components/utility/CategoryContainer.tsx","src/components/utility/ActionsContainer.tsx","src/components/Boosts.tsx","src/components/utility/icons/IconUtils.tsx","src/components/exploration/EnemySpriteTile.tsx","src/components/utility/tooltip/utils.ts","src/components/utility/tooltip/PaperTooltip.tsx","src/components/utility/tooltip/addEventListener.tsx","src/components/utility/CombatStatsViewer.tsx","src/components/utility/BestiaryEnemyContainer.tsx","src/components/compendium/Bestiary.tsx","src/backend/items/ItemTagEnum.tsx","src/backend/Quickbar.tsx","src/backend/items/Item.tsx","src/backend/items/equipment/EquippableItem.tsx","src/backend/items/equipment/PouchItem.tsx","src/components/inventory/ItemTags.tsx","src/components/inventory/ItemInfo.tsx","src/components/inventory/CraftingDetails.tsx","src/components/spellcraft/SpellcraftDetails.tsx","src/components/inventory/ItemGrid.tsx","src/components/utility/Picker.tsx","src/components/utility/UIContext.tsx","src/components/Transmute.tsx","src/components/compendium/ItemCompendiumDetails.tsx","src/components/compendium/ItemCompendium.tsx","src/components/Compendium.tsx","src/audio/AudioManager.tsx","src/backend/Cleanup.tsx","src/backend/events/autorandom/RandomEventTrigger.tsx","src/utils/FilesystemSave.web.tsx","src/components/Debug.tsx","src/backend/challenges/Challenges.tsx","src/components/utility/EndingDataViewer.tsx","src/components/Ending.tsx","src/components/Enhance.tsx","src/backend/rituals/Ritual.tsx","src/backend/rituals/NecromancyRitual.tsx","src/components/utility/AccessibilityContext.tsx","src/components/utility/ProgressBar.tsx","src/components/exploration/EnemyActionDisplay.tsx","src/components/exploration/HPBar.tsx","src/components/exploration/EnemyHPBar.tsx","src/components/utility/ActiveMark.tsx","src/components/utility/SpellView.tsx","src/components/utility/DragHandle.tsx","src/components/spells/FavoriteSpellsContainer.tsx","src/components/spells/SpellElementSelector.tsx","src/components/spells/SpellsContainer.tsx","src/components/utility/KeyboardListener.web.tsx","src/components/exploration/ExplorationPouch.tsx","src/components/utility/TemporaryEffectsViewer.tsx","src/components/exploration/QuickbarContainer.tsx","src/components/inventory/EquipmentSetButtons.tsx","src/components/synchro/SynchroGridSmallDisplay.tsx","src/components/synchro/SynchroGridSelector.tsx","src/components/synchro/SynchroGridSelectors.tsx","src/components/utility/AutocastLoadoutLoadContainer.tsx","src/components/exploration/StrategyContainer.tsx","src/components/exploration/ExplorationBottomComponent.tsx","src/components/exploration/ExplorationProgressDisplay.tsx","src/components/exploration/FamiliarActionDisplay.tsx","src/components/exploration/FamiliarHPBar.tsx","src/components/exploration/FamiliarSpriteTile.tsx","src/components/exploration/PlayerActionDisplay.tsx","src/components/exploration/PlayerHPBar.tsx","src/components/exploration/PlayerMessageLog.tsx","src/components/utility/BottomResourceViewer.tsx","src/components/Exploration.tsx","src/backend/items/material/SlimeDrop.tsx","src/backend/items/material/Wildgrass.tsx","src/backend/exploration/enemies/training/Slime.tsx","src/backend/familiars/FamiliarClass.tsx","src/backend/familiars/SlimeFamiliar.tsx","src/backend/buildings/FamiliarCrate.tsx","src/components/familiars/FamiliarMessageLog.tsx","src/components/utility/DungeonFloorSelect.tsx","src/components/utility/FullscreenModal.tsx","src/components/Familiars.tsx","src/backend/helps/Helps.tsx","src/components/utility/HelpContainer.tsx","src/components/Help.tsx","src/backend/hints/Hints.tsx","src/components/Home.tsx","src/backend/events/storyline/cavern/DualFlexibilityStoryline.tsx","src/components/utility/Card.tsx","src/components/utility/LoadGameContainer.tsx","src/components/Intro.tsx","src/components/inventory/EquippedItems.tsx","src/components/inventory/EquippedPouch.tsx","src/backend/buildings/SaleStall.tsx","src/backend/autocast/Market.tsx","src/backend/items/consumable/FamiliarItem.tsx","src/components/inventory/ItemDetailsAction.tsx","src/components/inventory/ItemFamiliarModalContents.tsx","src/components/inventory/ItemDetails.tsx","src/components/inventory/InventoryItems.tsx","src/components/Inventory.tsx","src/utils/OrientationLockManager.web.tsx","src/components/Loading.tsx","src/utils/Zoom.web.tsx","src/components/Options.tsx","src/components/Retirement.tsx","src/components/rituals/CorruptionDetails.tsx","src/components/rituals/RitualView.tsx","src/components/rituals/RitualsView.tsx","src/components/Rituals.tsx","src/backend/buildings/SpellcraftingVat.tsx","src/components/utility/SpellSelect.tsx","src/components/Spellcraft.tsx","src/backend/events/storyline/desert/Convenience.tsx","src/backend/buildings/catalysts/EssenceCatalyst.tsx","src/backend/buildings/mana/ManaSpout.tsx","src/backend/buildings/storages/EssenceStorage.tsx","src/backend/buildings/storages/ManaShard.tsx","src/backend/items/transmute/materials/CopperOre.tsx","src/backend/temporaryeffects/Poison.tsx","src/backend/temporaryeffects/NoxiousCloak.tsx","src/backend/exploration/enemies/sewers/EvolvedSlime.tsx","src/backend/temporaryeffects/Airborne.tsx","src/backend/temporaryeffects/AttackSpellProtection.tsx","src/backend/temporaryeffects/AutoAttackProtection.tsx","src/backend/temporaryeffects/Berserk.tsx","src/backend/temporaryeffects/Wet.tsx","src/backend/temporaryeffects/Chilled.tsx","src/backend/temporaryeffects/CloakOfFlames.tsx","src/backend/temporaryeffects/Corrosion.tsx","src/backend/temporaryeffects/Cursed.tsx","src/backend/temporaryeffects/Disease.tsx","src/backend/temporaryeffects/DivineImmunity.tsx","src/backend/temporaryeffects/ElementalProtection.tsx","src/backend/temporaryeffects/ElementalSilence.tsx","src/backend/temporaryeffects/Frail.tsx","src/backend/temporaryeffects/Frozen.tsx","src/backend/temporaryeffects/Grounded.tsx","src/backend/temporaryeffects/Guard.tsx","src/backend/temporaryeffects/Paralyzed.tsx","src/backend/temporaryeffects/Petrified.tsx","src/backend/temporaryeffects/PoisonImmunity.tsx","src/backend/temporaryeffects/Seared.tsx","src/backend/temporaryeffects/Shapeshifted.tsx","src/backend/temporaryeffects/Shrunken.tsx","src/backend/temporaryeffects/SpecificStatusImmunity.tsx","src/backend/temporaryeffects/StatusImmunity.tsx","src/backend/temporaryeffects/Stunning.tsx","src/backend/temporaryeffects/Weakened.tsx","src/backend/temporaryeffects/WizardDisarray.tsx","src/backend/temporaryeffects/CommonTemporaryEffects.tsx","src/backend/items/transmute/EquipmentTransmutationSpell.tsx","src/backend/items/equipment/pouch/HealthPotion.tsx","src/backend/items/transmute/materials/Cotton.tsx","src/backend/exploration/enemies/sewers/Goblin.tsx","src/backend/exploration/enemies/sewers/MutatedFish.tsx","src/backend/items/material/VenomPowder.tsx","src/backend/exploration/enemies/sewers/PoisonousToad.tsx","src/backend/exploration/enemies/sewers/SewerFish.tsx","src/backend/exploration/dungeons/DungeonFloor.tsx","src/backend/items/equipment/pouch/AntidotePotion.tsx","src/backend/exploration/enemies/sewers/GoblinSharpshooter.tsx","src/backend/exploration/enemies/sewers/SewerFly.tsx","src/backend/exploration/enemies/sewers/Sicklefish.tsx","src/backend/exploration/enemies/sewers/SludgeMass.tsx","src/backend/items/quest/EtherealEelExtract.tsx","src/backend/spells/CombatSpellBase.tsx","src/backend/spells/air/Haste.tsx","src/backend/exploration/enemies/sewers/EtherealEel.tsx","src/backend/exploration/enemies/sewers/GoblinDoctor.tsx","src/backend/exploration/enemies/sewers/ManEatingPlant.tsx","src/backend/items/equipment/pouch/BuffingPouchItem.tsx","src/backend/items/equipment/pouch/VenomousBrew.tsx","src/backend/exploration/enemies/sewers/VenomousSpider.tsx","src/backend/exploration/dungeons/sewers/SewerHideout.tsx","src/backend/exploration/dungeons/sewers/SewerHazardousSector.tsx","src/backend/exploration/dungeons/sewers/SewerEntrance.tsx","src/backend/events/storyline/sewers/FurniturePreservation.tsx","src/backend/events/storyline/sewers/PermaCast.tsx","src/backend/events/storyline/sewers/TicTacToeStoryline.tsx","src/backend/events/storyline/sewers/TomeOfToxicKnowledgeStoryline.tsx","src/backend/NewGamePlus.tsx","src/components/utility/EndingHistoryContainer.tsx","src/backend/events/storyline/desert/DiviningTheWorldStoryline.tsx","src/components/utility/StorylineContainer.tsx","src/components/utility/StorylinesContainer.tsx","src/components/Stats.tsx","src/components/Study.tsx","src/components/Synchro.tsx","src/backend/spells/channeling/BasicChannelingSpellBase.tsx","src/backend/spells/channeling/ChannelFire.tsx","src/components/Wizards.tsx","src/components/Worlds.tsx","src/components/events/EventList.tsx","src/components/events/EventOverlay.tsx","src/components/main/BottomMenu.tsx","src/components/main/GameTickProcessor.tsx","src/components/main/ManaBar.tsx","src/backend/timetick/TimePieces.tsx","src/components/utility/ElementViewer.tsx","src/components/utility/ResourceViewer.tsx","src/components/main/Menu.tsx","src/components/spells/SpellMenu.tsx","src/components/utility/DebugUPSOverlay.tsx","src/components/utility/ErrorBoundary.tsx","src/components/utility/FullScreenListener.web.tsx","src/components/utility/KeepAwake.tsx","src/components/utility/SaveDataBackupper.web.tsx","src/AppContents.tsx","src/backend/action/actions/ExpandHome.tsx","src/backend/action/actions/GatherMana.tsx","src/backend/action/actions/UseTimePiecesEvent.tsx","src/backend/action/actions/UseTimePiecesStudy.tsx","src/backend/action/actions/UseTimePiecesWarp.tsx","src/backend/action/ActionLoader.tsx","src/backend/items/transmute/materials/MonstiumPaper.tsx","src/backend/enhancement/EnhancementPurchaseListeners.tsx","src/backend/enhancement/Enhancement.tsx","src/backend/enhancement/exploration/MonstiumCollection.tsx","src/backend/enhancement/production/SuperheatedCatalysts.tsx","src/backend/enhancement/other/MonstiumCatalysts.tsx","src/backend/buildings/catalysts/MonstiumCatalyst.tsx","src/backend/enhancement/other/ManaSteamers.tsx","src/backend/buildings/mana/ManaSteamer.tsx","src/backend/enhancement/other/SewageSystem.tsx","src/backend/buildings/production/SewageSystem.tsx","src/backend/buildings/ResearcherDesk.tsx","src/backend/buildings/storages/Monstruarium.tsx","src/backend/enhancement/other/TreasureChests.tsx","src/backend/buildings/storages/TreasureChest.tsx","src/backend/buildings/WizardChamber.tsx","src/backend/buildings/DemoBuildingLoader.tsx","src/backend/classes/Battlemage.tsx","src/backend/classes/Builder.tsx","src/backend/classes/Spellslinger.tsx","src/backend/classes/DemoCombatClassLoader.tsx","src/backend/classes/CombatClassesUnlocker.tsx","src/backend/enhancement/exploration/EfficientExploration.tsx","src/backend/enhancement/exploration/Compass.tsx","src/backend/enhancement/exploration/HealthBoost.tsx","src/backend/enhancement/exploration/DoubleHealthBoost.tsx","src/backend/enhancement/exploration/EnlargedPouch.tsx","src/backend/enhancement/exploration/FirstAid.tsx","src/backend/enhancement/exploration/ProfessionalPouch.tsx","src/backend/enhancement/exploration/GiantPouch.tsx","src/backend/enhancement/exploration/HealthPotionEffectivity.tsx","src/backend/enhancement/exploration/TripleHealthBoost.tsx","src/backend/enhancement/land/FurnitureOrganization.tsx","src/backend/enhancement/land/LandTreaty.tsx","src/backend/enhancement/land/HouseExpansionContract.tsx","src/backend/enhancement/other/UnderstandingOfMagic.tsx","src/backend/enhancement/other/DeeperUnderstandingOfMagic.tsx","src/backend/enhancement/other/GlitteringStalls.tsx","src/backend/enhancement/other/HiringSpree.tsx","src/backend/enhancement/other/ScalableChambers.tsx","src/backend/enhancement/other/ShardDiligence.tsx","src/backend/enhancement/production/ImprovedPurification.tsx","src/backend/enhancement/production/SuperheatedSteamers.tsx","src/backend/enhancement/storage/CompressedEssence.tsx","src/backend/enhancement/storage/PrimaryStorage.tsx","src/backend/enhancement/storage/WideStorage.tsx","src/backend/events/autorandom/Chest.tsx","src/backend/events/autorandom/RandomRepeatableEvents.tsx","src/backend/events/DungeonEventGroup.tsx","src/backend/Achievement.tsx","src/backend/events/progression/PreTrainingProgression.tsx","src/backend/exploration/enemies/training/AnimatedSnowman.tsx","src/backend/items/equipment/pouch/Cherry.tsx","src/backend/exploration/enemies/training/Goat.tsx","src/backend/exploration/dungeons/training/TrainingTowerAir.tsx","src/backend/exploration/enemies/training/BreezyRabbit.tsx","src/backend/exploration/enemies/training/Windglider.tsx","src/backend/exploration/dungeons/training/TrainingTowerEarth.tsx","src/backend/exploration/enemies/training/FlyingRock.tsx","src/backend/spells/earth/Stoneskin.tsx","src/backend/exploration/enemies/training/RockGolem.tsx","src/backend/exploration/dungeons/training/TrainingTowerFire.tsx","src/backend/events/autorandom/ExplorationTrigger.tsx","src/backend/items/equipment/accessory/air/FeatheredHat.tsx","src/backend/items/equipment/body/earth/StoneMail.tsx","src/backend/items/equipment/body/water/WizardsRobe.tsx","src/backend/items/equipment/hand/air/Glaive.tsx","src/backend/items/equipment/hand/earth/BastardSword.tsx","src/backend/items/equipment/hand/fire/BattleAxe.tsx","src/backend/items/equipment/hand/fire/HandAxe.tsx","src/backend/items/equipment/hand/water/WandOfWater.tsx","src/backend/exploration/dungeons/Dungeon.tsx","src/backend/spells/fire/Strength.tsx","src/backend/exploration/enemies/training/BlazingTurtle.tsx","src/backend/exploration/enemies/training/FireBat.tsx","src/backend/exploration/dungeons/training/TrainingTowerWater.tsx","src/backend/exploration/dungeons/training/TrainingTowers.tsx","src/backend/exploration/enemies/training/HeadInstructor.tsx","src/backend/events/progression/DemoProgressionEvents.tsx","src/backend/events/progression/TrainingTowerProgression.tsx","src/backend/events/progression/SewersProgression.tsx","src/backend/events/storyline/desert/VarietyCollector.tsx","src/backend/events/storyline/pretraining/AdvertisingManual.tsx","src/backend/events/storyline/pretraining/BookOfMonstersStoryline.tsx","src/backend/events/storyline/pretraining/ChannelAllStoryline.tsx","src/backend/events/storyline/pretraining/PosterityStoryline.tsx","src/backend/exploration/enemies/sewers/GoblinChief.tsx","src/backend/events/storyline/sewers/GoblinDen.tsx","src/backend/items/transmute/materials/Paper.tsx","src/backend/events/storyline/sewers/LocationEncyclopediaStoryline.tsx","src/backend/events/storyline/sewers/LocationEncyclopedia.tsx","src/backend/events/storyline/sewers/Outessenced.tsx","src/backend/items/equipment/hand/air/CopperGauntlet.tsx","src/backend/items/equipment/hand/earth/CopperRapier.tsx","src/backend/items/equipment/hand/fire/CopperTomahawk.tsx","src/backend/exploration/dungeons/sewers/Sewers.tsx","src/backend/events/storyline/sewers/PassageOfStench.tsx","src/backend/events/storyline/sewers/ShardStockpile.tsx","src/backend/items/equipment/accessory/water/WizardsHat.tsx","src/backend/events/storyline/sewers/SomeonesTrash.tsx","src/backend/events/storyline/training/AdvancedManaSpouts.tsx","src/backend/events/storyline/training/AlchemyClass.tsx","src/backend/events/storyline/training/EssenceArtifact.tsx","src/backend/exploration/enemies/training/KnightInShiningArmor.tsx","src/backend/events/storyline/training/HowToFight.tsx","src/backend/events/storyline/training/StudentContest.tsx","src/backend/events/storyline/training/ZoomThroughTraining.tsx","src/backend/events/storyline/DemoStorylinesLoader.tsx","src/backend/storylines/StorylinesCommonLogic.tsx","src/backend/events/storyline/pretraining/RetireUnlocker.tsx","src/backend/events/storyline/pretraining/BookOfMonsters.tsx","src/backend/events/storyline/sewers/TicTacToe.tsx","src/backend/events/storyline/sewers/TomeOfToxicKnowledge.tsx","src/backend/events/DemoGameEventLoader.tsx","src/backend/exploration/dungeons/DemoDungeonLoader.tsx","src/backend/exploration/enemies/DemoEnemyLoader.tsx","src/backend/helps/HelpLoaderDemo.tsx","src/backend/hints/DemoHintLoader.tsx","src/backend/items/equipment/accessory/air/CloakOfDarkness.tsx","src/backend/items/equipment/accessory/earth/CopperShield.tsx","src/backend/items/equipment/accessory/earth/SmallShield.tsx","src/backend/items/equipment/accessory/earth/StoneEgg.tsx","src/backend/items/equipment/accessory/fire/CollarOfPower.tsx","src/backend/items/equipment/hand/poison/AssassinsBaselard.tsx","src/backend/items/equipment/accessory/poison/AssassinsCloak.tsx","src/backend/items/equipment/accessory/poison/CharmOfPoisonResistance.tsx","src/backend/items/equipment/accessory/poison/SoulStone.tsx","src/backend/items/equipment/accessory/water/ManaTear.tsx","src/backend/items/equipment/accessory/water/RingOfRegeneration.tsx","src/backend/items/equipment/body/air/BreezyShirt.tsx","src/backend/items/equipment/body/air/EvasiveGarb.tsx","src/backend/items/equipment/body/earth/CopperArmor.tsx","src/backend/items/equipment/body/earth/TurtleArmor.tsx","src/backend/items/equipment/body/fire/LeatherArmor.tsx","src/backend/items/equipment/body/fire/ReinforcedLeatherArmor.tsx","src/backend/items/equipment/body/water/ElderWizardsRobe.tsx","src/backend/items/equipment/body/water/TunicOfGoodHealth.tsx","src/backend/items/equipment/hand/air/GaleScepter.tsx","src/backend/items/equipment/hand/air/Knuckles.tsx","src/backend/items/equipment/hand/earth/Longsword.tsx","src/backend/items/equipment/hand/fire/CopperWarhammer.tsx","src/backend/items/equipment/hand/fire/RedConflagration.tsx","src/backend/items/equipment/hand/fire/WandOfFire.tsx","src/backend/items/equipment/hand/poison/Dagger.tsx","src/backend/items/equipment/hand/poison/ShadowBlade.tsx","src/backend/items/equipment/hand/poison/WandOfPoison.tsx","src/backend/items/equipment/hand/water/Rod.tsx","src/backend/items/equipment/pouch/PotionOfAlacrity.tsx","src/backend/items/equipment/pouch/PotionOfEvasion.tsx","src/backend/items/equipment/pouch/PotionOfMuscle.tsx","src/backend/items/equipment/pouch/PotionOfToughness.tsx","src/backend/items/equipment/pouch/PotionOfVitality.tsx","src/backend/items/transmute/materials/CopperIngot.tsx","src/backend/items/transmute/materials/ElementalPrism.tsx","src/backend/items/transmute/materials/ElementalShard.tsx","src/backend/items/transmute/materials/ThickHide.tsx","src/backend/items/DemoItemLoader.tsx","src/backend/spells/air/AirBlast.tsx","src/backend/spells/air/Blur.tsx","src/backend/spells/air/EnchantSaleStalls.tsx","src/backend/spells/air/Levitation.tsx","src/backend/spells/air/Richness.tsx","src/backend/spells/air/Twister.tsx","src/backend/spells/channeling/ChannelAir.tsx","src/backend/spells/channeling/ChannelEarth.tsx","src/backend/spells/channeling/ChannelWater.tsx","src/backend/spells/channeling/ChannelFour.tsx","src/backend/spells/channeling/ChannelPoison.tsx","src/backend/spells/earth/EarthShield.tsx","src/backend/spells/earth/EnchantTransmutation.tsx","src/backend/spells/earth/Guard.tsx","src/backend/spells/earth/Knockout.tsx","src/backend/spells/earth/Landslide.tsx","src/backend/spells/earth/StoneStrike.tsx","src/backend/spells/fire/CloakOfFlames.tsx","src/backend/spells/fire/EnchantCatalysts.tsx","src/backend/spells/fire/Fireball.tsx","src/backend/spells/fire/ImbueFlames.tsx","src/backend/spells/fire/InfernalBlaze.tsx","src/backend/spells/fire/Sear.tsx","src/backend/spells/poison/Antidote.tsx","src/backend/spells/poison/EnchantMonstiumCatalysts.tsx","src/backend/spells/poison/EnchantSewageSystem.tsx","src/backend/spells/poison/Frail.tsx","src/backend/spells/poison/Intoxicate.tsx","src/backend/spells/poison/Sting.tsx","src/backend/spells/water/DropletOfHealing.tsx","src/backend/spells/water/EnchantManaSpouts.tsx","src/backend/spells/water/EnchantManaSteamers.tsx","src/backend/spells/water/Frost.tsx","src/backend/spells/water/Longevity.tsx","src/backend/spells/water/Soak.tsx","src/backend/spells/water/Splash.tsx","src/backend/spells/water/StreamOfHealing.tsx","src/backend/spells/DemoSpellLoader.tsx","src/backend/spells/ElementsCommonLogic.tsx","src/backend/spells/SpellCommonLogic.tsx","src/backend/synchro/SynchroBonus.tsx","src/backend/synchro/bonuses/DoubleElementSynchroBonuses.tsx","src/backend/synchro/bonuses/BaseSynchroBonuses.tsx","src/backend/synchro/bonuses/air/AirPoisonSynchroBonus.tsx","src/backend/synchro/bonuses/earth/EarthAirSynchroBonus.tsx","src/backend/synchro/bonuses/earth/EarthPoisonSynchroBonus.tsx","src/backend/synchro/bonuses/earth/EarthWaterSynchroBonus.tsx","src/backend/synchro/bonuses/fire/FireAirSynchroBonus.tsx","src/backend/synchro/bonuses/fire/FireEarthSynchroBonus.tsx","src/backend/synchro/bonuses/fire/FirePoisonSynchroBonus.tsx","src/backend/synchro/bonuses/fire/FireWaterSynchroBonus.tsx","src/backend/synchro/bonuses/water/WaterAirSynchroBonus.tsx","src/backend/synchro/bonuses/water/WaterPoisonSynchroBonus.tsx","src/backend/synchro/SynchroLoaderDemo.tsx","src/backend/DemoLoader.tsx","src/backend/enhancement/DemoEnhancementLoader.tsx","DemoApp.tsx","node_modules/moment/locale|sync|/^/.*$","webpack/bootstrap","webpack/runtime/chunk loaded","webpack/runtime/compat get default export","webpack/runtime/create fake namespace object","webpack/runtime/define property getters","webpack/runtime/global","webpack/runtime/hasOwnProperty shorthand","webpack/runtime/make namespace object","webpack/runtime/node module decorator","webpack/runtime/publicPath","webpack/runtime/jsonp chunk loading","webpack/startup"],"sourcesContent":["import { MMKV } from \"react-native-mmkv\";\r\n\r\nexport const Storage = new MMKV();\r\n","import i18n from \"i18next\";\r\nimport { initReactI18next } from \"react-i18next\";\r\nimport { Storage } from \"./src/utils/Storage\";\r\n\r\n// const backend = {\r\n//   type: \"backend\",\r\n//   init: function (services, backendOptions, i18nextOptions) {\r\n//     console.warn(\"init\");\r\n//     // Do nothing\r\n//   },\r\n//   read: function (language, namespace, callback) {\r\n//     console.warn(\"read\", language, namespace);\r\n//     const store = {};\r\n//     const nowMS = new Date().getTime();\r\n\r\n//     if (!AsyncStorage) {\r\n//       return callback(null, null);\r\n//     }\r\n\r\n//     AsyncStorage.getItem(\"uploadedTranslations\")\r\n//       .then((local) => {\r\n//         console.warn(\"loaded\");\r\n//         return callback(null, {\r\n//           \"**Full Version**\": \"**IT WORKS**\",\r\n//           \"School Trophy (Plentiful Spellcasting)\": \"YESYESYES\",\r\n//         });\r\n//         if (local) {\r\n//           local = JSON.parse(local);\r\n\r\n//           return callback(null, local);\r\n//         }\r\n\r\n//         callback(null, null);\r\n//       })\r\n//       .catch((err) => {\r\n//         console.warn(err);\r\n//         callback(null, null);\r\n//       });\r\n//   },\r\n//   save: function () {\r\n//     console.warn(\"save\");\r\n//   },\r\n\r\n//   create: function (languages, namespace, key, fallbackValue) {\r\n//     // Do nothing\r\n//   },\r\n// };\r\n\r\n// const resources =  {\r\n//   en: {\r\n//     translation: {\r\n//       \"Welcome to React\": \"Welcome to React and react-i18next\",\r\n//     },\r\n//   },\r\n//   fr: {\r\n//     translation: {\r\n//       \"Welcome to React\": \"Bienvenue  React et react-i18next\",\r\n//     },\r\n//   },\r\n// };\r\n\r\nconst resources = {\r\n  en: {\r\n    translation: JSON.parse(\r\n      Storage.getString(\"uploadedTranslationsJSON\") ?? \"{}\",\r\n    ),\r\n  },\r\n};\r\n\r\ni18n\r\n  .use(initReactI18next)\r\n  // .use(I18NextChainedBackend)\r\n  // .use(Backend)\r\n  .init({\r\n    resources, //: { en: { translation: JSON.parse(resources ?? \"{}\") } },\r\n    lng: \"en\", // language to use, more information here: https://www.i18next.com/overview/configuration-options#languages-namespaces-resources\r\n    // you can use the i18n.changeLanguage function to change the language manually: https://www.i18next.com/overview/api#changelanguage\r\n    // if you're using a language detector, do not define the lng option\r\n\r\n    // allow keys to be phrases having `:`, `.`\r\n    nsSeparator: false,\r\n    keySeparator: false,\r\n\r\n    // do not load a fallback\r\n    fallbackLng: false,\r\n    saveMissing: true,\r\n\r\n    interpolation: {\r\n      escapeValue: false, // react already safes from xss\r\n    },\r\n  });\r\n\r\nexport default i18n;\r\n","import { useEffect, useRef } from \"react\";\r\nimport memoize from \"sonic-memoize\";\r\n\r\nexport function clone<T>(obj: T): T {\r\n  return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\nexport function hashCode(str: string, seed: number = 1): number {\r\n  let h1 = 0xdeadbeef ^ seed,\r\n    h2 = 0x41c6ce57 ^ seed;\r\n  for (let i = 0, ch; i < str.length; i++) {\r\n    ch = str.charCodeAt(i);\r\n    h1 = Math.imul(h1 ^ ch, 2654435761);\r\n    h2 = Math.imul(h2 ^ ch, 1597334677);\r\n  }\r\n\r\n  h1 =\r\n    Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^\r\n    Math.imul(h2 ^ (h2 >>> 13), 3266489909);\r\n  h2 =\r\n    Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^\r\n    Math.imul(h1 ^ (h1 >>> 13), 3266489909);\r\n\r\n  return 4294967296 * (2097151 & h2) + (h1 >>> 0);\r\n}\r\n\r\nexport function getRandomElementFromArray<T>(arr: T[]): T {\r\n  const len = arr.length;\r\n  const idx = Math.floor(Math.random() * len);\r\n  return arr[idx];\r\n}\r\n\r\nexport function compareVersions(\r\n  v1: string,\r\n  v2: string,\r\n  maxDepth?: number,\r\n): number {\r\n  const v1Parts = v1.split(\".\");\r\n  const v2Parts = v2.split(\".\");\r\n  try {\r\n    for (let i in v1Parts) {\r\n      if (maxDepth != null && Number.parseInt(i) >= maxDepth) {\r\n        break;\r\n      }\r\n      const v1Part = Number.parseInt(v1Parts?.[i] ?? \"0\");\r\n      const v2Part = Number.parseInt(v2Parts?.[i] ?? \"0\");\r\n      if (v1Part - v2Part != 0) {\r\n        return v1Part - v2Part;\r\n      }\r\n    }\r\n  } catch (e) {\r\n    // Failed to compare versions. Pretend they are equal\r\n    return 0;\r\n  }\r\n  return 0;\r\n}\r\n\r\nexport function keysOf<T extends string | number | symbol, V>(\r\n  obj: Partial<Record<T, V>> | Record<T, V>,\r\n): T[] {\r\n  return Object.keys(obj) as T[];\r\n}\r\n\r\nexport const keysOfCached = memoize(keysOf);\r\n\r\nexport function valuesOf<T extends string | number | symbol, V>(\r\n  obj: Partial<Record<T, V>> | Record<T, V>,\r\n): V[] {\r\n  return Object.values(obj) as V[];\r\n}\r\n\r\nexport const valuesOfCached = memoize(valuesOf);\r\n\r\nexport function fromEntries<T extends string | number | symbol, V>(\r\n  entries: [T, V][],\r\n): Record<T, V> {\r\n  return Object.fromEntries(entries) as Record<T, V>;\r\n}\r\n\r\nexport function addRecords<T extends string | number | symbol>(\r\n  records: Partial<Record<T, number>>[],\r\n): Partial<Record<T, number>> {\r\n  const result: Partial<Record<T, number>> = {};\r\n  for (let record of records) {\r\n    for (let key in record) {\r\n      if (result[key] == null) {\r\n        result[key] = 0;\r\n      }\r\n      result[key] = (record[key] ?? 0) + (result[key] ?? 0);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function nullthrows<T>(obj: T | null | undefined): T {\r\n  if (obj == null) {\r\n    throw new Error(\"Should be nonnull\");\r\n  }\r\n  return obj;\r\n}\r\n\r\nexport function useComponentDidUpdate(effect: () => void, dependencies) {\r\n  const hasMounted = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (!hasMounted.current) {\r\n      hasMounted.current = true;\r\n      return;\r\n    }\r\n    effect();\r\n  }, dependencies);\r\n}\r\n\r\nexport function assertUnreachable(x: never): never {\r\n  throw new Error(\"Didn't expect to get here\");\r\n}\r\n","// export const t = (...args) => args[0];\r\n\r\nimport { t as i18nextT } from \"i18next\";\r\nimport { LRUCache } from \"lru-cache\";\r\n\r\nconst cache = new LRUCache({ max: 10000 });\r\nlet cacheCalls = 0,\r\n  cacheMisses = 0;\r\n\r\nexport const t = (...args) => {\r\n  const key = JSON.stringify(args);\r\n  let cached = cache.get(key);\r\n  if (cached === undefined) {\r\n    // @ts-ignore\r\n    cached = i18nextT(...args);\r\n    cache.set(key, cached);\r\n    cacheMisses++;\r\n  }\r\n  cacheCalls++;\r\n  return cached as string;\r\n};\r\n","import moment from \"moment\";\r\nimport { t } from \"./I18n\";\r\n\r\nexport enum RoundingMethod {\r\n  DEFAULT = \"DEFAULT\",\r\n  UP = \"UP\",\r\n  DOWN = \"DOWN\",\r\n}\r\n\r\nconst MAX_FORMAT_VALUE = Number.MAX_VALUE / 100;\r\n\r\nexport function formatNumber(\r\n  num: number,\r\n  options: { showDecimals: boolean; roundingMethod?: RoundingMethod } = {\r\n    showDecimals: false,\r\n    roundingMethod: undefined,\r\n  },\r\n): string {\r\n  num = Number(num);\r\n  if (num >= MAX_FORMAT_VALUE) {\r\n    return \"\";\r\n  }\r\n  if (num >= 1e30) {\r\n    return num.toExponential(2);\r\n  }\r\n  if (num >= 1e27) {\r\n    return (\r\n      formatNumber(num / 1e27, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"Oc\"\r\n    );\r\n  }\r\n  if (num >= 1e24) {\r\n    return (\r\n      formatNumber(num / 1e24, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"Sp\"\r\n    );\r\n  }\r\n  if (num >= 1e21) {\r\n    return (\r\n      formatNumber(num / 1e21, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"Sx\"\r\n    );\r\n  }\r\n  if (num >= 1e18) {\r\n    return (\r\n      formatNumber(num / 1e18, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"Qi\"\r\n    );\r\n  }\r\n  if (num >= 1e15) {\r\n    return (\r\n      formatNumber(num / 1e15, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"Qa\"\r\n    );\r\n  }\r\n  if (num >= 1000000000000) {\r\n    return (\r\n      formatNumber(num / 1000000000000, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"T\"\r\n    );\r\n  }\r\n  if (num >= 1000000000) {\r\n    return (\r\n      formatNumber(num / 1000000000, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"B\"\r\n    );\r\n  }\r\n  if (num >= 1000000) {\r\n    return (\r\n      formatNumber(num / 1000000, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"M\"\r\n    );\r\n  }\r\n  if (num >= 10000) {\r\n    return (\r\n      formatNumber(num / 1000, {\r\n        showDecimals: true,\r\n        roundingMethod: options.roundingMethod,\r\n      }) + \"K\"\r\n    );\r\n  }\r\n\r\n  const roundingMethod = options.roundingMethod ?? RoundingMethod.DEFAULT;\r\n\r\n  if (options.showDecimals && Math.abs(num) < 10 && !Number.isInteger(num)) {\r\n    const base =\r\n      roundingMethod == RoundingMethod.DEFAULT\r\n        ? Math.round(num * 100)\r\n        : roundingMethod != RoundingMethod.UP\r\n        ? Math.floor(num * 100)\r\n        : Math.ceil(num * 100);\r\n    return (base / 100.0).toFixed(2);\r\n  } else if (\r\n    options.showDecimals &&\r\n    Math.abs(num) < 100 &&\r\n    !Number.isInteger(num)\r\n  ) {\r\n    const base =\r\n      roundingMethod == RoundingMethod.DEFAULT\r\n        ? Math.round(num * 10)\r\n        : roundingMethod != RoundingMethod.UP\r\n        ? Math.floor(num * 10)\r\n        : Math.ceil(num * 10);\r\n    return (Math.floor(base) / 10.0).toFixed(1);\r\n  } else {\r\n    const base =\r\n      roundingMethod == RoundingMethod.DEFAULT\r\n        ? Math.round(num)\r\n        : roundingMethod != RoundingMethod.UP\r\n        ? Math.floor(num)\r\n        : Math.ceil(num);\r\n    return base.toFixed();\r\n  }\r\n}\r\n\r\nexport function formatMultiplier(\r\n  ratio: number,\r\n  options: { showDecimals: boolean; roundingMethod?: RoundingMethod } = {\r\n    showDecimals: false,\r\n    roundingMethod: RoundingMethod.DEFAULT,\r\n  },\r\n): string {\r\n  const pct = (ratio - 1.0) * 100;\r\n  if (pct > 0) {\r\n    if (pct > 999.5) {\r\n      return t(\"{{ratio}}x\", {\r\n        ratio: formatNumber(ratio, { showDecimals: true }),\r\n      });\r\n    }\r\n    return t(\"+{{pct}}%\", { pct: formatNumber(pct, options) });\r\n  } else {\r\n    return t(\"{{pct}}%\", { pct: formatNumber(pct, options) });\r\n  }\r\n}\r\n\r\nexport function formatTime(\r\n  secs: number,\r\n  options: { shortForm: boolean; showDecimals: boolean } = {\r\n    shortForm: false,\r\n    showDecimals: false,\r\n  },\r\n): string {\r\n  const { shortForm, showDecimals } = options;\r\n  let unit = shortForm ? t(\"sec\") : t(\"second(s)\");\r\n  let time = formatNumber(secs, { showDecimals: showDecimals });\r\n  if (secs > 60) {\r\n    unit = shortForm ? t(\"min\") : t(\"minute(s)\");\r\n    time = formatNumber(secs / 60, { showDecimals: showDecimals });\r\n  }\r\n  if (secs > 60 * 60) {\r\n    unit = shortForm ? t(\"hr\") : t(\"hour(s)\");\r\n    time = formatNumber(secs / (60 * 60), { showDecimals: showDecimals });\r\n  }\r\n  return t(\"{{time}} {{unit}}\", { time, unit });\r\n}\r\n\r\nexport function formatTimeLong(duration: moment.Duration) {\r\n  if (duration.asDays() < 1.0) {\r\n    return t(\"{{hours}}:{{minutes}}:{{seconds}}\", {\r\n      hours: duration.hours().toFixed().padStart(2, \"0\"),\r\n      minutes: duration.minutes().toFixed().padStart(2, \"0\"),\r\n      seconds: duration.seconds().toFixed().padStart(2, \"0\"),\r\n    });\r\n  }\r\n\r\n  return t(\"{{days}} days, {{hours}}:{{minutes}}:{{seconds}}\", {\r\n    hours: duration.hours().toFixed().padStart(2, \"0\"),\r\n    minutes: duration.minutes().toFixed().padStart(2, \"0\"),\r\n    seconds: duration.seconds().toFixed().padStart(2, \"0\"),\r\n    days: formatNumber(Math.floor(duration.asDays())),\r\n  });\r\n}\r\n","import Constants from \"expo-constants\";\r\n\r\nexport function getCurrentVersionTimestamp(): number | undefined {\r\n  return Constants?.expoConfig?.extra?.buildRunTimestamp;\r\n}\r\n\r\nexport function getCurrentVersion(): string | undefined {\r\n  return Constants?.expoConfig?.version;\r\n}\r\n","export enum ExplorationStatus {\r\n  None = \"None\",\r\n  Exploring = \"Exploring\",\r\n  ExploringBoss = \"ExploringBoss\",\r\n  Reviving = \"Reviving\",\r\n  Combat = \"Combat\",\r\n}\r\n","import React from \"react\";\r\nimport { Platform } from \"react-native\";\r\nimport { clone } from \"../utils/CoreUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { getCurrentVersion } from \"../utils/Versioning\";\r\nimport { NotificationData } from \"./Notification\";\r\nimport { QuickbarData } from \"./Quickbar\";\r\nimport { Resource } from \"./Resources\";\r\nimport { AutocastRuleStatus, AutocastStrategy } from \"./autocast/Autocast\";\r\nimport { BuildingData } from \"./buildings/Buildings\";\r\nimport { EventOccurrenceData } from \"./events/Events\";\r\nimport { EventTag } from \"./events/GameEvent\";\r\nimport { CombatStat } from \"./exploration/CombatStats\";\r\nimport { CombatActionResult } from \"./exploration/ExplorationActionResult\";\r\nimport { ExplorationStatus } from \"./exploration/ExplorationStatus\";\r\nimport { DungeonFloor } from \"./exploration/dungeons/DungeonFloor\";\r\nimport { FamiliarData } from \"./familiars/Familiar\";\r\nimport { EquipmentSlot } from \"./items/Equipment\";\r\nimport { ItemOccurrence, ItemStack } from \"./items/Item\";\r\nimport { SpellcraftData } from \"./spellcraft/SpellcraftData\";\r\nimport { SpellElement } from \"./spells/Elements\";\r\nimport { TemporaryEffectData } from \"./temporaryeffects/TemporaryEffects\";\r\n\r\nexport type PlayerContextGlobalApprenticeLoadout = {\r\n  name: string;\r\n  allocation: Record<string, number>;\r\n};\r\n\r\nexport enum ResearcherAutoAssignStrategy {\r\n  OFF = \"OFF\",\r\n  SPREAD_EVENLY = \"SPREAD_EVENLY\",\r\n  HIGHEST_AMOUNT = \"HIGHEST_AMOUNT\",\r\n  SPREAD_THEN_HIGHEST = \"SPREAD_THEN_HIGHEST\",\r\n}\r\n\r\nexport type GameOptionsState = {\r\n  targetFps: number;\r\n  wakeLock: boolean;\r\n  hiddenFromBottomMenu: string[];\r\n  sectionOrder: string[];\r\n  hideDamageEffects: boolean;\r\n  doNotUseNativeDriver: boolean;\r\n  overrideElementDisplay: SpellElement | \"no\";\r\n  themeMode: \"light\" | \"dark\";\r\n  hideEventTags: EventTag[];\r\n  enableSwiping: boolean;\r\n  enableBottomMenu: boolean;\r\n  leftHandedMode: boolean;\r\n  putCastSpellOnBottomMenu: boolean;\r\n  doNotShowEventsOnWideScreens: boolean;\r\n  hideTooltips: boolean;\r\n  hideBottomResourceViewer: boolean;\r\n  waitUntilFullyHealedBeforeExplore: boolean;\r\n  autoPurchaseEnhancements: boolean;\r\n  zoomLevel: number;\r\n  researcherAutoAssignStrategy: ResearcherAutoAssignStrategy;\r\n  expandedUI: Record<string, boolean>;\r\n  saveExpandedUI: boolean;\r\n  colorSpellButtonsByElement: boolean;\r\n  compactUI: boolean;\r\n  doNotPopupEventsDuringBossFights: boolean;\r\n};\r\n\r\nexport type GameWorldState = {\r\n  flags: Record<string, boolean>;\r\n  variables: Record<string, string | number | boolean>;\r\n  maxPrimaryElementLevels: Partial<Record<SpellElement, number>>;\r\n  maxElementLevels: Partial<Record<SpellElement, number>>;\r\n  maxFurnitureNumbers: Record<string, number>;\r\n  unlockedElements: Partial<Record<SpellElement, boolean>>;\r\n  totalTimesResetted: number;\r\n  quickbars: QuickbarData[][];\r\n  currentQuickbar: number;\r\n  timesEnemyDefeated: Record<\r\n    string,\r\n    { player: number; familiars: number; losses: number }\r\n  >;\r\n  knownEnemiesThatDrop: Record<string, Record<string, boolean>>;\r\n  itemsEverAddedToInventory: Record<string, boolean>;\r\n  secondsPlayed: number;\r\n  activeSecondsPlayed: number;\r\n  timePiecesConsumed: number;\r\n  maxLandsPurchased: number;\r\n  startTimestamp: number;\r\n  endingsHistory: EndingStats[];\r\n  sheerPowerLevel: number;\r\n  storylineOracleLevel: number;\r\n  blazingSpeedLevel: number;\r\n  worldDifficultyLevel: number;\r\n  synchro: {\r\n    grids: Record<number, SynchroStrategyState>;\r\n    currentGrid: number;\r\n  };\r\n};\r\n\r\nexport type GameGlobalState = {\r\n  startTimestamp: number;\r\n  secondsPlayed: number;\r\n  activeSecondsPlayed: number;\r\n  timePiecesConsumed: number;\r\n  appVersionTimestamp: number;\r\n  appVersionString: string;\r\n  appPlatform: string;\r\n  isFullVersionSave: boolean;\r\n  tickCount: number;\r\n  newGamePlusUnlocked: boolean;\r\n  newGamePlusCount: number;\r\n  newGamePlusMax: number;\r\n  totalBoonPointsEarned: number;\r\n  autocast: GameAutocastState;\r\n  autoUsePouch: boolean;\r\n  notifications: NotificationData[];\r\n  debugShowUpdatesPerSec: boolean;\r\n  debugLastUpdateTimestamps: number[];\r\n  debugLastUpdateBeginEndTimestamps: {\r\n    begin: number;\r\n    end: number;\r\n    ticksRun: number;\r\n  }[];\r\n  endingsHistory: EndingStats[];\r\n};\r\n\r\nexport type GameEquipmentState = Record<EquipmentSlot, ItemOccurrence[]>;\r\n\r\nexport type GameEquipmentLoadout = {\r\n  name: string;\r\n  equipment: GameEquipmentState;\r\n};\r\n\r\nexport type MessageLog = {\r\n  id: string;\r\n  secondsPlayed: number;\r\n  message: string;\r\n  accessibleMessage?: string;\r\n  realTimestamp: number;\r\n};\r\n\r\nexport type EndingStats = {\r\n  endingId: string;\r\n  timestamp: number;\r\n  challengeId: string | undefined;\r\n  totalTimePlayed: number;\r\n  totalTimePlayedThisWorld: number;\r\n  totalTimePlayedThisRun: number;\r\n  totalActiveTimePlayed: number;\r\n  totalActiveTimePlayedThisWorld: number;\r\n  totalActiveTimePlayedThisRun: number;\r\n  totalRealWorldTimePlayed: number;\r\n  totalRealWorldTimePlayedThisWorld: number;\r\n  totalRealWorldTimePlayedThisRun: number;\r\n  timePiecesConsumed: number;\r\n  timePiecesConsumedThisWorld: number;\r\n  timePiecesConsumedThisRun: number;\r\n  totalRetirements: number;\r\n  primaryElement: SpellElement;\r\n  primaryElementLevelOnEnding: number;\r\n  secondaryElement: SpellElement | undefined;\r\n  secondaryElementLevelOnEnding: number | undefined;\r\n  combatClassId: string;\r\n  mpl: number;\r\n  researchMultiplier: number;\r\n  productionMultiplier: number;\r\n  completedStorylines: number;\r\n  worldsCreated: number;\r\n  sheerPowerLevel: number;\r\n  storylineOracleLevel: number;\r\n  blazingSpeedLevel: number;\r\n  worldDifficultyLevel: number;\r\n};\r\n\r\nexport type GameExplorationState = {\r\n  currentHP: number;\r\n  explorationStatus: ExplorationStatus;\r\n  explorationStartTime: number;\r\n  currentDungeonFloorId: string;\r\n  currentEnemy: {\r\n    id: string;\r\n    currentHP: number;\r\n  };\r\n  successfulExplorationsPerFloor: Record<string, number>;\r\n  playerActionProgress: number;\r\n  familiarActionProgress: number;\r\n  familiarIsInBackRow: boolean;\r\n  enemyActionProgress: number;\r\n  lastPlayerDamageCause: string | undefined;\r\n  actionResultQueue: CombatActionResult[];\r\n  lastActionResultPushedTime: number;\r\n  pouchItemsUsesLeft: Record<string, number>;\r\n  variables: Record<string, boolean>;\r\n  triggerPlayerDeath: boolean;\r\n};\r\n\r\nexport type GameAutocastState = {\r\n  savedStrategies: Record<number, AutocastStrategy>;\r\n  currentStrategy: AutocastStrategy;\r\n  lastStrategyIndex: number;\r\n};\r\n\r\nexport type GameAutocastStatusState = {\r\n  rules: Record<string, AutocastRuleStatus>;\r\n  autocastPaused: boolean;\r\n};\r\n\r\nexport type SynchroStrategyState = {\r\n  grid: Record<number, Record<number, SpellElement | undefined>>;\r\n  name: string | undefined;\r\n};\r\n\r\nexport type GameRunState = {\r\n  resources: Partial<Record<Resource, number>>;\r\n  buildings: Record<string, BuildingData>;\r\n  landPurchaseCount: number;\r\n  flags: Record<string, boolean>;\r\n  variables: Record<string, string | number | boolean>;\r\n  elementExperience: Partial<Record<SpellElement, number>>;\r\n  elementExponents: Partial<Record<SpellElement, number>>;\r\n  eventQueue: string[];\r\n  eventOccurrences: Record<string, EventOccurrenceData>;\r\n  nextEventIsManuallyTriggered: boolean;\r\n  secondsPlayed: number;\r\n  activeSecondsPlayed: number;\r\n  timePiecesConsumed: number;\r\n  newFlagsOnRetirement: Record<string, boolean>;\r\n  endingTriggered: EndingStats | undefined;\r\n  startTimestamp: number;\r\n  lastDungeonFloorCompleted: string | undefined;\r\n  temporaryEffects: Record<string, TemporaryEffectData>;\r\n  recentSpellsCast: string[];\r\n  nextRandomEvent: number;\r\n  primaryElement: SpellElement | undefined;\r\n  inventory: ItemStack[];\r\n  equipment: GameEquipmentState;\r\n  equipmentLoadouts: GameEquipmentLoadout[];\r\n  lastEquipmentLoadoutModified: number;\r\n  exploration: GameExplorationState;\r\n  explorationMessageLog: MessageLog[];\r\n  lastSpellCastTimes: Record<string, number>;\r\n  uiCommands: string[];\r\n  lastProcessedTime: number;\r\n  lastItemUsedTimes: Record<string, number>;\r\n  quickbar: QuickbarData[];\r\n  favoriteSpells: string[];\r\n  skipAheadTime: number;\r\n  warpTimeSecs: number;\r\n  summoningBlockedUntilTime: number;\r\n  boostsBought: Record<SpellElement, number>;\r\n  autocast: GameAutocastStatusState;\r\n  saleStallItems: ItemOccurrence[];\r\n  saleStallProgressRatio: number;\r\n  partiallyUnlockedElements: Partial<Record<SpellElement, boolean>>;\r\n  combatClassId: string | undefined;\r\n  explorationTriggers: Record<string, { timesTriggered: number; next: number }>;\r\n  studyAllocation: Record<SpellElement, number>;\r\n  familiars: Record<string, FamiliarData>;\r\n  secondaryElement: SpellElement | undefined;\r\n  autoPurchaseActions: Record<string, boolean>;\r\n  empoweredSpells: Record<string, boolean>;\r\n  activeRituals: Record<string, boolean>;\r\n  maxElementLevelsOnPrevRetirement: Partial<Record<SpellElement, number>>;\r\n  lastComputedLevelUpElementExperience: Partial<Record<SpellElement, number>>;\r\n  pityEnabledAtSeconds: number | undefined;\r\n  pityCounter: number;\r\n  extraEventSecs: number;\r\n  currentChallengeId: string | undefined;\r\n  autoAdvanceToNextFloor: boolean;\r\n  autoAttemptBoss: boolean;\r\n  spellcrafts: Record<string, SpellcraftData>;\r\n};\r\n\r\nexport type GameTempState = {\r\n  cache: Map<string, [number, any]>;\r\n  flagCache: Map<string, boolean>;\r\n  worldFlagCache: Map<string, boolean>;\r\n  elementLevelCache: Record<SpellElement, [number, any] | undefined>;\r\n  locationEncyclopediaCache: DungeonFloor[] | undefined;\r\n  isInAutocast: boolean;\r\n  isInPermacast: boolean;\r\n  isInPouch: boolean;\r\n  lastAutoPurchaseRun: number;\r\n  lastAutoPurchaseEnhancementRun: number;\r\n  familiarLevelCache: Map<string, number>;\r\n  combatStatCache: {\r\n    Player: Partial<Record<CombatStat, number>>;\r\n    Enemy: Partial<Record<CombatStat, number>>;\r\n    Familiar: Partial<\r\n      Record<CombatStat, Record<string, { level: number; value: number }>>\r\n    >;\r\n  };\r\n  resourceCapCache: Partial<Record<Resource, number>>;\r\n  unlockedElementsCache: SpellElement[];\r\n  incomeOverTimeCache: Record<string, Partial<Record<Resource, number>>>;\r\n  autocastPointsRequirementCache: Record<string, number>;\r\n  spellManaCostCache: Record<string, number>;\r\n  researchPerSecCache: Partial<Record<SpellElement, number>> | undefined;\r\n  spellRequirementsCache: Record<string, boolean>;\r\n  spellExpCache: Record<string, Partial<Record<SpellElement, number>>>;\r\n  lastProcessedAutocastSpellId: string | undefined;\r\n};\r\n\r\nexport type GameState = {\r\n  // run gets reset on retirement\r\n  run: GameRunState;\r\n  // world gets reset on creation / new game +\r\n  world: GameWorldState;\r\n  // global never gets reset, ever\r\n  global: GameGlobalState;\r\n  // options also do not get reset\r\n  options: GameOptionsState;\r\n  // temp is not persisted or saved, could be deleted at any time,\r\n  // is deleted on retirement, and meant for caches and the like\r\n  temp: GameTempState;\r\n  // when simulating \"what if\" scenarios, set this flag\r\n  isFake: boolean;\r\n};\r\n\r\nexport type GameStateTransform = (oldState: GameState) => GameState;\r\n\r\nexport type GameStateValue = GameState & {\r\n  apply: (transform: GameStateTransform) => void;\r\n};\r\n\r\nexport const EXPLORATION_INITIAL_STATE: GameExplorationState = {\r\n  currentHP: 60,\r\n  explorationStatus: ExplorationStatus.None,\r\n  explorationStartTime: 0,\r\n  currentDungeonFloorId: \"\",\r\n  currentEnemy: {\r\n    id: \"\",\r\n    currentHP: 1,\r\n  },\r\n  successfulExplorationsPerFloor: {},\r\n  playerActionProgress: 0.0,\r\n  familiarActionProgress: 0.0,\r\n  enemyActionProgress: 0.0,\r\n  familiarIsInBackRow: false,\r\n  lastPlayerDamageCause: undefined,\r\n  actionResultQueue: [],\r\n  lastActionResultPushedTime: 0.0,\r\n  pouchItemsUsesLeft: {},\r\n  variables: {},\r\n  triggerPlayerDeath: false,\r\n};\r\n\r\nexport const EQUIPMENT_INITIAL_STATE: GameEquipmentState = {\r\n  Hand: [],\r\n  Body: [],\r\n  Accessory: [],\r\n  Pouch: [],\r\n};\r\n\r\nexport const AUTOCAST_INITIAL_STATE: GameAutocastState = {\r\n  savedStrategies: {},\r\n  currentStrategy: {\r\n    rules: [],\r\n    permaCastRules: {},\r\n    name: t(\"Default\"),\r\n    wizardsAssignedToPermaCast: 0,\r\n  },\r\n  lastStrategyIndex: 0,\r\n};\r\n\r\nexport const SYNCHRO_INITIAL_STATE: SynchroStrategyState = {\r\n  grid: {},\r\n  name: undefined,\r\n};\r\n\r\nexport const GLOBAL_INITIAL_STATE: GameGlobalState = {\r\n  secondsPlayed: 0,\r\n  activeSecondsPlayed: 0,\r\n  timePiecesConsumed: 0,\r\n  startTimestamp: Date.now(),\r\n  appVersionTimestamp: 0,\r\n  appVersionString: getCurrentVersion() ?? \"0.0.0\",\r\n  isFullVersionSave: true,\r\n  tickCount: 0,\r\n  newGamePlusUnlocked: false,\r\n  newGamePlusCount: 0,\r\n  newGamePlusMax: 0,\r\n  totalBoonPointsEarned: 0,\r\n  appPlatform: Platform.OS,\r\n  notifications: [],\r\n  autoUsePouch: true,\r\n  autocast: AUTOCAST_INITIAL_STATE,\r\n  debugShowUpdatesPerSec: false,\r\n  debugLastUpdateTimestamps: [],\r\n  debugLastUpdateBeginEndTimestamps: [],\r\n  endingsHistory: [],\r\n};\r\n\r\nexport const RUN_INITIAL_STATE: GameRunState = {\r\n  secondsPlayed: 0,\r\n  activeSecondsPlayed: 0,\r\n  timePiecesConsumed: 0,\r\n  newFlagsOnRetirement: {},\r\n  endingTriggered: undefined,\r\n  startTimestamp: Date.now(),\r\n  lastDungeonFloorCompleted: undefined,\r\n  resources: {},\r\n  buildings: {},\r\n  flags: {},\r\n  variables: {},\r\n  elementExperience: {\r\n    Fire: 0,\r\n    Earth: 0,\r\n    Water: 0,\r\n    Air: 0,\r\n  },\r\n  elementExponents: {},\r\n  eventQueue: [],\r\n  eventOccurrences: {},\r\n  nextEventIsManuallyTriggered: false,\r\n  temporaryEffects: {},\r\n  recentSpellsCast: [],\r\n  nextRandomEvent: 600,\r\n  primaryElement: undefined,\r\n  inventory: [],\r\n  equipment: EQUIPMENT_INITIAL_STATE,\r\n  autocast: {\r\n    rules: {},\r\n    autocastPaused: false,\r\n  },\r\n  exploration: EXPLORATION_INITIAL_STATE,\r\n  explorationMessageLog: [],\r\n  lastSpellCastTimes: {},\r\n  uiCommands: [],\r\n  lastProcessedTime: Date.now(),\r\n  lastItemUsedTimes: {},\r\n  quickbar: [],\r\n  favoriteSpells: [],\r\n  skipAheadTime: 0,\r\n  warpTimeSecs: 0,\r\n  summoningBlockedUntilTime: 0,\r\n  boostsBought: {\r\n    Fire: 0,\r\n    Earth: 0,\r\n    Water: 0,\r\n    Air: 0,\r\n    Poison: 0,\r\n    Mind: 0,\r\n    Life: 0,\r\n    Electric: 0,\r\n    Death: 0,\r\n    Holy: 0,\r\n    Time: 0,\r\n    Space: 0,\r\n  },\r\n  equipmentLoadouts: [],\r\n  lastEquipmentLoadoutModified: 0,\r\n  landPurchaseCount: 0,\r\n  saleStallItems: [],\r\n  saleStallProgressRatio: 0,\r\n  partiallyUnlockedElements: {},\r\n  combatClassId: undefined,\r\n  explorationTriggers: {},\r\n  studyAllocation: {\r\n    Fire: 0,\r\n    Earth: 0,\r\n    Water: 0,\r\n    Air: 0,\r\n    Poison: 0,\r\n    Mind: 0,\r\n    Life: 0,\r\n    Electric: 0,\r\n    Death: 0,\r\n    Holy: 0,\r\n    Time: 0,\r\n    Space: 0,\r\n  },\r\n  familiars: {},\r\n  secondaryElement: undefined,\r\n  autoPurchaseActions: {},\r\n  empoweredSpells: {},\r\n  activeRituals: {},\r\n  maxElementLevelsOnPrevRetirement: {},\r\n  lastComputedLevelUpElementExperience: {},\r\n  pityEnabledAtSeconds: undefined,\r\n  pityCounter: 0,\r\n  extraEventSecs: 0,\r\n  currentChallengeId: undefined,\r\n  autoAdvanceToNextFloor: false,\r\n  autoAttemptBoss: false,\r\n  spellcrafts: {},\r\n};\r\n\r\nexport const WORLD_INITIAL_STATE: GameWorldState = {\r\n  flags: {},\r\n  variables: {},\r\n  maxPrimaryElementLevels: {},\r\n  maxElementLevels: {},\r\n  maxFurnitureNumbers: {},\r\n  unlockedElements: {\r\n    Fire: true,\r\n    Earth: true,\r\n    Water: true,\r\n    Air: true,\r\n  },\r\n  totalTimesResetted: 0,\r\n  quickbars: [],\r\n  currentQuickbar: 0,\r\n  timesEnemyDefeated: {},\r\n  maxLandsPurchased: 0,\r\n  secondsPlayed: 0,\r\n  activeSecondsPlayed: 0,\r\n  timePiecesConsumed: 0,\r\n  startTimestamp: Date.now(),\r\n  endingsHistory: [],\r\n  sheerPowerLevel: 0,\r\n  storylineOracleLevel: 0,\r\n  blazingSpeedLevel: 0,\r\n  worldDifficultyLevel: 0,\r\n  knownEnemiesThatDrop: {},\r\n  itemsEverAddedToInventory: {},\r\n  synchro: {\r\n    grids: { 0: clone(SYNCHRO_INITIAL_STATE) },\r\n    currentGrid: 0,\r\n  },\r\n};\r\n\r\nexport const OPTIONS_INITIAL_STATE: GameOptionsState = {\r\n  targetFps: 20,\r\n  wakeLock: false,\r\n  hiddenFromBottomMenu: [],\r\n  hideDamageEffects: false,\r\n  doNotUseNativeDriver: false,\r\n  overrideElementDisplay: \"no\",\r\n  themeMode: \"dark\",\r\n  hideEventTags: [],\r\n  enableSwiping: true,\r\n  enableBottomMenu: true,\r\n  leftHandedMode: false,\r\n  putCastSpellOnBottomMenu: true,\r\n  hideTooltips: false,\r\n  doNotShowEventsOnWideScreens: true,\r\n  hideBottomResourceViewer: false,\r\n  waitUntilFullyHealedBeforeExplore: false,\r\n  autoPurchaseEnhancements: false,\r\n  zoomLevel: 1.0,\r\n  researcherAutoAssignStrategy: ResearcherAutoAssignStrategy.OFF,\r\n  expandedUI: {},\r\n  saveExpandedUI: true,\r\n  colorSpellButtonsByElement: true,\r\n  sectionOrder: [],\r\n  compactUI: false,\r\n  doNotPopupEventsDuringBossFights: true,\r\n};\r\n\r\nexport const INITIAL_STATE: GameState = {\r\n  global: GLOBAL_INITIAL_STATE,\r\n  run: RUN_INITIAL_STATE,\r\n  world: WORLD_INITIAL_STATE,\r\n  options: OPTIONS_INITIAL_STATE,\r\n  temp: createTempState(),\r\n  isFake: false,\r\n};\r\n\r\nexport function createTempState(): GameTempState {\r\n  return {\r\n    cache: new Map(),\r\n    flagCache: new Map(),\r\n    worldFlagCache: new Map(),\r\n    locationEncyclopediaCache: undefined,\r\n    isInAutocast: false,\r\n    isInPermacast: false,\r\n    isInPouch: false,\r\n    elementLevelCache: {\r\n      Fire: undefined,\r\n      Earth: undefined,\r\n      Water: undefined,\r\n      Air: undefined,\r\n      Poison: undefined,\r\n      Mind: undefined,\r\n      Life: undefined,\r\n      Electric: undefined,\r\n      Death: undefined,\r\n      Holy: undefined,\r\n      Time: undefined,\r\n      Space: undefined,\r\n    },\r\n    lastAutoPurchaseRun: 0,\r\n    lastAutoPurchaseEnhancementRun: 0,\r\n    familiarLevelCache: new Map(),\r\n    combatStatCache: {\r\n      Player: {},\r\n      Familiar: {},\r\n      Enemy: {},\r\n    },\r\n    resourceCapCache: {},\r\n    unlockedElementsCache: undefined,\r\n    incomeOverTimeCache: {},\r\n    autocastPointsRequirementCache: {},\r\n    spellManaCostCache: {},\r\n    researchPerSecCache: undefined,\r\n    spellRequirementsCache: {},\r\n    spellExpCache: {},\r\n    lastProcessedAutocastSpellId: undefined,\r\n  };\r\n}\r\n\r\nexport function createHypotheticalState(state: GameState): GameState {\r\n  const clonedState = clone(state);\r\n  clonedState.temp = createTempState();\r\n  clonedState.isFake = true;\r\n  return clonedState;\r\n}\r\n\r\nexport type StateContextValue = GameState & {\r\n  apply: (transform: GameStateTransform) => void;\r\n  overwrite: (transform: GameStateTransform) => void;\r\n};\r\n\r\nexport const StateContext = React.createContext({\r\n  ...clone(INITIAL_STATE),\r\n  apply: (transform: GameStateTransform) => {},\r\n  overwrite: (transform: GameStateTransform) => {},\r\n});\r\n","import { createTempState, GameState, GameStateTransform } from \"./GameState\";\r\nimport { SpellElement } from \"./spells/Elements\";\r\n\r\nexport function cacheByTickCount(\r\n  state: GameState,\r\n  key: string,\r\n  valueFn: (state: GameState) => any,\r\n  readCacheOnly?: boolean,\r\n) {\r\n  if (state.isFake) {\r\n    return valueFn(state);\r\n  }\r\n  const tickCount = state.global.tickCount;\r\n  const cache = state.temp.cache;\r\n  const oldValue = cache.get(key);\r\n  if (!oldValue || (!readCacheOnly && oldValue[0] != tickCount)) {\r\n    const newValue = valueFn(state);\r\n    cache.set(key, [tickCount, newValue]);\r\n    return newValue;\r\n  }\r\n  return oldValue[1];\r\n}\r\n\r\nexport function cacheByTickCountElementLevel(\r\n  state: GameState,\r\n  key: SpellElement,\r\n  valueFn: (state: GameState) => any,\r\n  readCacheOnly?: boolean,\r\n) {\r\n  if (state.isFake) {\r\n    return valueFn(state);\r\n  }\r\n  const tickCount = state.global.tickCount;\r\n  const cache = state.temp.elementLevelCache;\r\n  const oldValue = cache[key];\r\n  if (!oldValue || (!readCacheOnly && oldValue[0] != tickCount)) {\r\n    const newValue = valueFn(state);\r\n    cache[key] = [tickCount, newValue];\r\n    return newValue;\r\n  }\r\n  return oldValue[1];\r\n}\r\n\r\nexport function cacheBySecondsPlayed(\r\n  state: GameState,\r\n  key: string,\r\n  valueFn: (state: GameState) => any,\r\n  readCacheOnly?: boolean,\r\n) {\r\n  if (state.isFake) {\r\n    return valueFn(state);\r\n  }\r\n  const cache = state.temp.cache;\r\n  const tickCount = state.run.secondsPlayed;\r\n  const oldValue = cache.get(key);\r\n  if (!oldValue || (!readCacheOnly && oldValue[0] != tickCount)) {\r\n    const newValue = valueFn(state);\r\n    cache.set(key, [tickCount, newValue]);\r\n    return newValue;\r\n  }\r\n  return oldValue[1];\r\n}\r\n\r\nexport function cacheByArbitraryVersion(\r\n  state: GameState,\r\n  key: string,\r\n  valueFn: (state: GameState) => any,\r\n  versionFn: (state: GameState) => any,\r\n  readCacheOnly?: boolean,\r\n) {\r\n  if (state.isFake) {\r\n    return valueFn(state);\r\n  }\r\n  const cache = state.temp.cache;\r\n  const tickCount = versionFn(state);\r\n  const oldValue = cache.get(key);\r\n  if (!oldValue || (!readCacheOnly && oldValue[0] != tickCount)) {\r\n    const newValue = valueFn(state);\r\n    cache.set(key, [tickCount, newValue]);\r\n    return newValue;\r\n  }\r\n  return oldValue[1];\r\n}\r\n\r\n// Caches only by boolean.\r\n// If the value function ever returns true, it will persist indefinitely.\r\n// This will not cache false values.\r\nexport function cacheBooleanTrueOnly(\r\n  state: GameState,\r\n  key: string,\r\n  valueFn: (state: GameState) => boolean,\r\n  readCacheOnly?: boolean,\r\n) {\r\n  if (state.isFake) {\r\n    return valueFn(state);\r\n  }\r\n  const cache = state.temp.cache;\r\n  const tickCount = state.run.secondsPlayed;\r\n  const oldValue = cache.get(key);\r\n  if (oldValue == null || (!readCacheOnly && oldValue[0] > tickCount)) {\r\n    const value = valueFn(state);\r\n    if (!value) {\r\n      return false;\r\n    }\r\n    cache.set(key, [tickCount, value]);\r\n    return value;\r\n  }\r\n  return oldValue[1];\r\n}\r\n\r\n/**\r\n * This cache is cleared on retirement\r\n */\r\nexport function cacheIndefinitely(\r\n  state: GameState,\r\n  keyFn: (state: GameState) => string,\r\n  valueFn: (state: GameState) => any,\r\n) {\r\n  if (state.isFake) {\r\n    return valueFn(state);\r\n  }\r\n  const cache = state.temp.cache;\r\n  const key = keyFn(state);\r\n  const oldValue = cache.get(key);\r\n  if (!oldValue) {\r\n    const newValue = valueFn(state);\r\n    cache.set(key, [0, newValue]);\r\n    return newValue;\r\n  }\r\n  return oldValue[1];\r\n}\r\n\r\nexport function clearCacheKey(\r\n  state: GameState,\r\n  keyFn: (state: GameState) => string,\r\n) {\r\n  const cache = state.temp.cache;\r\n  const key = keyFn(state);\r\n  cache.delete(key);\r\n  return state;\r\n}\r\n\r\nconst clearCacheListeners: Record<string, GameStateTransform> = {};\r\n\r\nexport function clearAllCaches(state: GameState): GameState {\r\n  state.temp = createTempState();\r\n  for (let listener of Object.values(clearCacheListeners)) {\r\n    state = listener(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function registerClearCacheListener(id: string, fn: GameStateTransform) {\r\n  clearCacheListeners[id] = fn;\r\n}\r\n","let isThisDemo = false;\r\n\r\nexport function setDemo(demo: boolean) {\r\n  isThisDemo = demo;\r\n}\r\n\r\nexport function isDemo() {\r\n  return isThisDemo;\r\n}\r\n","export interface Identifiable {\r\n  getId(): string;\r\n}\r\n\r\nexport function isIdentifiable(value: any): value is Identifiable {\r\n  return \"getId\" in value;\r\n}\r\n\r\nexport function idOf(obj: Identifiable): string {\r\n  return obj.getId();\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { isIdentifiable } from \"./Identifiable\";\r\n\r\nexport class DataStore<T> {\r\n  store: Record<string, T> = {};\r\n  numericIds: Record<string, number> = {};\r\n  maxId: number = 1;\r\n\r\n  register(value: T, overrideId?: string) {\r\n    const numericId = this.maxId++;\r\n    let id = numericId.toString();\r\n    if (isIdentifiable(value)) {\r\n      id = value.getId();\r\n    }\r\n    if (overrideId != null) {\r\n      id = overrideId;\r\n    }\r\n    if (this.store[id] == null) {\r\n      this.store[id] = value;\r\n    }\r\n    if (this.numericIds[id] == null) {\r\n      this.numericIds[id] = numericId;\r\n    }\r\n  }\r\n\r\n  getById(id: string): T {\r\n    return this.store[id];\r\n  }\r\n\r\n  getByIdNullable(id: string): T | undefined {\r\n    return this.store[id];\r\n  }\r\n\r\n  getNumericId(id: string): number | undefined {\r\n    return this.numericIds[id];\r\n  }\r\n\r\n  getAll(): T[] {\r\n    return valuesOf(this.store);\r\n  }\r\n\r\n  reset(): void {\r\n    this.maxId = 1;\r\n    this.store = {};\r\n  }\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { GameState, GameStateTransform } from \"./GameState\";\r\nimport { DataStore } from \"./generic/DataStore\";\r\n\r\nexport function hasFlag(state: GameState, flag: string) {\r\n  const cached = state.temp.flagCache.get(flag);\r\n  if (cached === undefined) {\r\n    state.temp.flagCache.set(flag, state.run.flags?.[flag] || false);\r\n    return state.temp.flagCache.get(flag);\r\n  }\r\n  return cached;\r\n}\r\n\r\nexport const SetFlagListeners = new DataStore<\r\n  (state: GameState, flag: string) => GameState\r\n>();\r\n\r\nfunction setFlagImpl(flag: string, state: GameState) {\r\n  if (!state.run.flags?.[flag]) {\r\n    state.temp.flagCache.delete(flag);\r\n  }\r\n  const oldValue = state.run.flags[flag] ?? false;\r\n  state.run.flags[flag] = true;\r\n  if (!oldValue) {\r\n    SetFlagListeners.getAll().forEach((transform) => {\r\n      state = transform(state, flag);\r\n    });\r\n  }\r\n  if (!state.world.flags?.[\"ever_\" + flag]) {\r\n    state.temp.worldFlagCache.delete(\"ever_\" + flag);\r\n  }\r\n  state.world.flags[\"ever_\" + flag] = true;\r\n  return state;\r\n}\r\n\r\nexport function hasEverHadFlag(state: GameState, flag: string) {\r\n  return hasWorldFlag(state, \"ever_\" + flag);\r\n}\r\n\r\nexport const setFlag = memoize((flag: string) => setFlagImpl.bind(this, flag));\r\n\r\nfunction clearFlagImpl(flag: string, state: GameState) {\r\n  state.run.flags[flag] = false;\r\n  state.temp.flagCache.delete(flag);\r\n  return state;\r\n}\r\n\r\nexport const clearFlag = memoize((flag: string) =>\r\n  clearFlagImpl.bind(this, flag),\r\n);\r\n\r\nexport function setWorldFlagForNextRunImpl(\r\n  flag: string,\r\n  state: GameState,\r\n): GameState {\r\n  state.run.newFlagsOnRetirement[flag] = true;\r\n  return state;\r\n}\r\n\r\nexport const setWorldFlagForNextRun = memoize((flag: string) =>\r\n  setWorldFlagForNextRunImpl.bind(this, flag),\r\n);\r\n\r\nexport function setWorldFlagImpl(flag: string, state: GameState): GameState {\r\n  if (!state.world.flags?.[flag]) {\r\n    state.temp.worldFlagCache.delete(flag);\r\n  }\r\n  state.world.flags[flag] = true;\r\n  return state;\r\n}\r\n\r\nexport const setWorldFlag = memoize((flag: string) =>\r\n  setWorldFlagImpl.bind(this, flag),\r\n);\r\n\r\nfunction clearWorldFlagImpl(flag: string, state: GameState) {\r\n  state.world.flags[flag] = false;\r\n  state.temp.worldFlagCache.delete(flag);\r\n  return state;\r\n}\r\n\r\nexport function clearWorldFlag(this: any, flag: string): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return clearWorldFlagImpl.bind(this, flag);\r\n}\r\n\r\nexport function hasWorldFlag(state: GameState, flag: string): boolean {\r\n  const cached = state.temp.worldFlagCache.get(flag);\r\n  if (cached === undefined) {\r\n    state.temp.worldFlagCache.set(flag, state.world.flags?.[flag] || false);\r\n    return state.temp.worldFlagCache.get(flag);\r\n  }\r\n  return cached;\r\n}\r\n\r\nexport function hasWorldFlagIncludingNextRun(\r\n  state: GameState,\r\n  flag: string,\r\n): boolean {\r\n  return (\r\n    state?.world?.flags?.[flag] ||\r\n    state?.run?.newFlagsOnRetirement?.[flag] ||\r\n    false\r\n  );\r\n}\r\n\r\nfunction setCombatVariableImpl(variable: string, value: any, state: GameState) {\r\n  state.run.exploration.variables[variable] = value;\r\n  return state;\r\n}\r\n\r\nexport function setCombatVariable(\r\n  this: any,\r\n  variable: string,\r\n  value: any,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return setCombatVariableImpl.bind(this, variable, value);\r\n}\r\n\r\nfunction clearCombatVariableImpl(variable: string, state: GameState) {\r\n  delete state.run.exploration.variables[variable];\r\n  return state;\r\n}\r\n\r\nexport function clearCombatVariable(\r\n  this: any,\r\n  variable: string,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return clearCombatVariableImpl.bind(this, variable);\r\n}\r\n\r\nexport function resetAllCombatVariables(state: GameState): GameState {\r\n  state.run.exploration.variables = {};\r\n  return state;\r\n}\r\n\r\nexport function getCombatVariable(state: GameState, variable: string): any {\r\n  return state.run.exploration?.variables[variable];\r\n}\r\n","import { GameState, GameStateTransform } from \"./GameState\";\r\n\r\nexport type GameStateListener = (\r\n  newState: GameState,\r\n) => GameStateTransform | null | undefined | void;\r\n\r\ntype GameStateListenerTrigger = (\r\n  state: GameState,\r\n  oldValue?: boolean | string | number,\r\n) => boolean | string | number;\r\n\r\nconst listeners: Record<string, GameStateListener> = {};\r\nconst highPriorityListeners: Record<string, GameStateListener> = {};\r\nconst triggerExtractors: Record<string, GameStateListenerTrigger> = {};\r\nconst triggerValues: Record<string, boolean | string | number> = {};\r\n\r\ntype PerfInfo = {\r\n  executed: number;\r\n  listenerMs: number;\r\n  executedTrigger: number;\r\n  triggerMs: number;\r\n};\r\nconst perfInfo: Record<string, PerfInfo> = {};\r\n\r\nexport function addGameStateListener(\r\n  id: string,\r\n  listener: GameStateListener,\r\n  triggerExtractor?: GameStateListenerTrigger,\r\n) {\r\n  listeners[id] = listener;\r\n  if (triggerExtractor != null) {\r\n    triggerExtractors[id] = triggerExtractor;\r\n  }\r\n}\r\n\r\nexport function addHighPriorityGameStateListener(\r\n  id: string,\r\n  listener: GameStateListener,\r\n  triggerExtractor?: GameStateListenerTrigger,\r\n) {\r\n  highPriorityListeners[id] = listener;\r\n  if (triggerExtractor != null) {\r\n    triggerExtractors[id] = triggerExtractor;\r\n  }\r\n}\r\n\r\nexport function clearGameStateListener(id: string) {\r\n  delete listeners[id];\r\n  delete highPriorityListeners[id];\r\n  delete triggerExtractors[id];\r\n  delete triggerValues[id];\r\n}\r\n\r\nfunction getPerfInfoForListener(key: string): PerfInfo {\r\n  if (perfInfo[key] == null) {\r\n    perfInfo[key] = {\r\n      executed: 0,\r\n      listenerMs: 0,\r\n      executedTrigger: 0,\r\n      triggerMs: 0,\r\n    };\r\n  }\r\n  return perfInfo[key];\r\n}\r\n\r\nexport function applyHighPriGameStateListeners(\r\n  newState: GameState,\r\n): GameStateTransform[] {\r\n  const validHighPriListeners = Object.keys(highPriorityListeners)\r\n    .filter((listenerKey) => {\r\n      if (triggerExtractors?.[listenerKey] != null) {\r\n        const oldValue = triggerValues?.[listenerKey];\r\n        const beginTimestamp = performance.now();\r\n        const newValue = triggerExtractors[listenerKey](newState, oldValue);\r\n        const endTimestamp = performance.now();\r\n        getPerfInfoForListener(listenerKey).executedTrigger++;\r\n        getPerfInfoForListener(listenerKey).triggerMs +=\r\n          endTimestamp - beginTimestamp;\r\n\r\n        if (triggerValues?.[listenerKey] == null) {\r\n          triggerValues[listenerKey] = newValue;\r\n          return false;\r\n        }\r\n\r\n        if (newValue == triggerValues?.[listenerKey]) {\r\n          return false;\r\n        }\r\n\r\n        triggerValues[listenerKey] = newValue;\r\n      }\r\n\r\n      return true;\r\n    })\r\n    .map((listenerKey) => {\r\n      const beginTimestamp = performance.now();\r\n      const result = highPriorityListeners[listenerKey](newState);\r\n      const endTimestamp = performance.now();\r\n      getPerfInfoForListener(listenerKey).executed++;\r\n      getPerfInfoForListener(listenerKey).listenerMs +=\r\n        endTimestamp - beginTimestamp;\r\n      return result;\r\n    });\r\n\r\n  return validHighPriListeners.filter(\r\n    (transform) => transform != null,\r\n  ) as GameStateTransform[];\r\n}\r\n\r\nexport function applyGameStateListeners(\r\n  newState: GameState,\r\n): GameStateTransform[] {\r\n  const validListeners = [];\r\n  for (let listenerKey in listeners) {\r\n    const extractor = triggerExtractors?.[listenerKey];\r\n    if (extractor != null) {\r\n      const oldValue = triggerValues?.[listenerKey];\r\n      // const beginTimestamp = performance.now();\r\n      const newValue = extractor(newState, oldValue);\r\n      // const endTimestamp = performance.now();\r\n      // getPerfInfoForListener(listenerKey).executedTrigger++;\r\n      // getPerfInfoForListener(listenerKey).triggerMs +=\r\n      //   endTimestamp - beginTimestamp;\r\n      if (oldValue == null) {\r\n        triggerValues[listenerKey] = newValue;\r\n        continue;\r\n      }\r\n\r\n      if (newValue == oldValue) {\r\n        continue;\r\n      }\r\n\r\n      triggerValues[listenerKey] = newValue;\r\n    }\r\n\r\n    validListeners.push(listenerKey);\r\n  }\r\n  const listenerResults = [];\r\n  for (let listenerKey of validListeners) {\r\n    // const beginTimestamp = performance.now();\r\n    const result = listeners[listenerKey](newState);\r\n    // const endTimestamp = performance.now();\r\n    // getPerfInfoForListener(listenerKey).executed++;\r\n    // getPerfInfoForListener(listenerKey).listenerMs +=\r\n    //   endTimestamp - beginTimestamp;\r\n    listenerResults.push(result);\r\n  }\r\n\r\n  return listenerResults.filter(\r\n    (transform) => transform != null,\r\n  ) as GameStateTransform[];\r\n}\r\n\r\nexport function applyAllTransforms(\r\n  state: GameState,\r\n  transform: GameStateTransform,\r\n): GameState {\r\n  let transforms = [transform];\r\n\r\n  do {\r\n    if (transforms.length > 0) {\r\n      state.global.tickCount += 1;\r\n      for (let trans of transforms) {\r\n        state = trans(state);\r\n      }\r\n    }\r\n\r\n    transforms = applyHighPriGameStateListeners(state);\r\n    if (transforms.length == 0) {\r\n      transforms = applyGameStateListeners(state);\r\n    }\r\n  } while (transforms.length > 0);\r\n\r\n  // Increment one more time to avoid cache\r\n  state.global.tickCount += 1;\r\n\r\n  // Return shallow clone for React to trigger context update\r\n  return Object.assign({}, state);\r\n}\r\n\r\n// import { GameState, GameStateTransform } from \"./GameState\";\r\n\r\n// export type GameStateListener = (\r\n//   newState: GameState,\r\n// ) => GameStateTransform | null | undefined | void;\r\n\r\n// type GameStateListenerTrigger = (\r\n//   state: GameState,\r\n//   oldValue?: boolean | string | number,\r\n// ) => boolean | string | number;\r\n\r\n// const listeners: Map<string, GameStateListener> = new Map();\r\n// const listenersWithExtractors: Map<string, GameStateListener> = new Map();\r\n// const triggerExtractors: Map<string, GameStateListenerTrigger> = new Map();\r\n// const triggerValues: Map<string, boolean | string | number> = new Map();\r\n\r\n// export function addGameStateListener(\r\n//   id: string,\r\n//   listener: GameStateListener,\r\n//   triggerExtractor?: GameStateListenerTrigger,\r\n// ) {\r\n//   if (triggerExtractor == null) {\r\n//     listeners.set(id, listener);\r\n//   } else {\r\n//     listenersWithExtractors.set(id, listener);\r\n//     triggerExtractors.set(id, triggerExtractor);\r\n//   }\r\n// }\r\n\r\n// export function clearGameStateListener(id: string) {\r\n//   listeners.delete(id);\r\n//   listenersWithExtractors.delete(id);\r\n//   triggerExtractors.delete(id);\r\n//   triggerValues.delete(id);\r\n// }\r\n\r\n// export function applyGameStateListeners(\r\n//   newState: GameState,\r\n// ): GameStateTransform[] {\r\n//   const validExtractorListeners = [];\r\n\r\n//   listenersWithExtractors.forEach((listener, listenerKey) => {\r\n//     const extractor = triggerExtractors.get(listenerKey);\r\n//     const oldValue = triggerValues.get(listenerKey);\r\n//     const newValue = extractor(newState, oldValue);\r\n//     if (oldValue == null) {\r\n//       triggerValues.set(listenerKey, newValue);\r\n//       return;\r\n//     }\r\n\r\n//     if (newValue == oldValue) {\r\n//       return;\r\n//     }\r\n\r\n//     triggerValues.set(listenerKey, newValue);\r\n//     validExtractorListeners.push(listener);\r\n//   });\r\n\r\n//   const validListeners = [];\r\n\r\n//   listeners.forEach((listener) => validListeners.push(listener(newState)));\r\n//   validExtractorListeners.forEach((listener) =>\r\n//     validListeners.push(listener(newState)),\r\n//   );\r\n\r\n//   return validListeners.filter(\r\n//     (transform) => transform != null,\r\n//   ) as GameStateTransform[];\r\n// }\r\n\r\n// export function applyAllTransforms(\r\n//   state: GameState,\r\n//   transform: GameStateTransform,\r\n// ): GameState {\r\n//   let transforms = [transform];\r\n\r\n//   do {\r\n//     if (transforms.length > 0) {\r\n//       state.global.tickCount += 1;\r\n//       state = transforms.reduce(\r\n//         (accumulatedState, currentTransform) =>\r\n//           currentTransform(accumulatedState),\r\n//         state,\r\n//       );\r\n//     }\r\n\r\n//     transforms = applyGameStateListeners(state);\r\n//   } while (transforms.length > 0);\r\n\r\n//   // Increment one more time to avoid cache\r\n//   state.global.tickCount += 1;\r\n\r\n//   // Return shallow clone for React to trigger context update\r\n//   return Object.assign({}, state);\r\n// }\r\n","export enum TransformationTags {\r\n  Production = \"Production\",\r\n  Consumption = \"Consumption\",\r\n  Cost = \"Cost\",\r\n  ManualGathering = \"ManualGathering\",\r\n  Loot = \"Loot\",\r\n  LootChance = \"LootChance\",\r\n  Cap = \"Cap\",\r\n  PerBuildingCap = \"PerBuildingCap\",\r\n  PerItemCap = \"PerItemCap\",\r\n  CostScale = \"CostScale\",\r\n  GameSpeed = \"GameSpeed\",\r\n  ExplorationBossRequirement = \"ExplorationBossRequirement\",\r\n  ExplorationDelay = \"ExplorationDelay\",\r\n  ExplorationWeight = \"ExplorationWeight\",\r\n  FamiliarExplorationDelay = \"FamiliarExplorationDelay\",\r\n  FromExploration = \"FromExploration\",\r\n  FromFamiliarExploration = \"FromFamiliarExploration\",\r\n  StunResistance = \"StunResistance\",\r\n  AutocastDelay = \"AutocastDelay\",\r\n  RandomEventWeight = \"RandomEventWeight\",\r\n  StorylineTriggerChance = \"StorylineTriggerChance\",\r\n  ExpRequirementScale = \"ExpRequirementScale\",\r\n  ExpGain = \"ExpGain\",\r\n  TimePiecePerFastSpeedup = \"TimePiecePerFastSpeedup\",\r\n  TimePiecePerFasterSpeedup = \"TimePiecePerFasterSpeedup\",\r\n  TimePiecePerWarpedSec = \"TimePiecePerWarpedSec\",\r\n  TimePiecePerStudy = \"TimePiecePerStudy\",\r\n  OfflineTimePieceGain = \"OfflineTimePieceGain\",\r\n  AttackDamageReceived = \"AttackDamageReceived\",\r\n  PostStunProtectionDuration = \"PostStunProtectionDuration\",\r\n  PostFrozenProtectionDuration = \"PostFrozenProtectionDuration\",\r\n  CanCastSpell = \"CanCastSpell\",\r\n  FinalIncomePerSec = \"FinalIncomePerSec\",\r\n  MaxElementLevel = \"MaxElementLevel\",\r\n  ChannelingEfficiency = \"ChannelingEfficiency\",\r\n  Land = \"Land\",\r\n  CatalystEffectivity = \"CatalystEffectivity\",\r\n  AutocastPointsProduction = \"AutocastPointsProduction\",\r\n  AutocastPointsConsumption = \"AutocastPointsConsumption\",\r\n  PerBuildingProduction = \"PerBuildingProduction\",\r\n  TimePerAutoSalePerStall = \"SaleStallProgress\",\r\n  WizardAmount = \"WizardAmount\",\r\n  ItemSalePrice = \"ItemSalePrice\",\r\n  AutoAttack = \"AutoAttack\",\r\n  SaleStallRevenue = \"SaleStallRevenue\",\r\n  FromSaleStalls = \"FromSaleStalls\",\r\n  PouchSize = \"PouchSize\",\r\n  AccessorySize = \"AccessorySize\",\r\n  Reflected = \"Reflected\",\r\n  ResearcherAmount = \"ResearcherAmount\",\r\n  Study = \"Study\",\r\n  PoisonDoTAmount = \"PoisonDoTAmount\",\r\n  AffectsGameSpeed = \"AffectsGameSpeed\",\r\n  MaxFamiliarLevel = \"MaxFamiliarLevel\",\r\n  FamiliarAmount = \"FamiliarAmount\",\r\n  FamiliarExp = \"FamiliarExp\",\r\n  LandCost = \"LandCost\",\r\n  CorrosionDoTAmount = \"CorrosionDoTAmount\",\r\n  NumberOfHits = \"NumberOfHits\",\r\n  CriticalResistance = \"CriticalResistance\",\r\n  TransmutationSpell = \"TransmutationSpell\",\r\n  InstantDeath = \"InstantDeath\",\r\n  Corruption = \"Corruption\",\r\n  CorruptionCap = \"CorruptionCap\",\r\n  PerRitualCost = \"PerRitualCost\",\r\n  Accumulation = \"Accumulation\",\r\n  Boost = \"Boost\",\r\n  PouchItemUses = \"PouchItemUses\",\r\n  StartingElementExpBase = \"StartingElementExpBase\",\r\n  ItemQualityMax = \"ItemQualityMax\",\r\n  ItemsNeededForCombining = \"ItemsNeededForCombining\",\r\n  BoonPointsEarned = \"BoonPoints\",\r\n  SynchroGridMax = \"SynchroGridMax\",\r\n  LootItemAmount = \"LootItemAmount\",\r\n\r\n  Action = \"Action\",\r\n  Spell = \"Spell\",\r\n  Building = \"Building\",\r\n  ShapeshiftingSpell = \"ShapeshiftingSpell\",\r\n  AttackSpell = \"AttackSpell\",\r\n  ActionEffect = \"ActionEffect\",\r\n  BuildingEffect = \"BuildingEffect\",\r\n  SpellCooldown = \"SpellCooldown\",\r\n  ActionMagnitude = \"ActionMagnitude\",\r\n  ActionVariance = \"ActionVariance\",\r\n  TemporaryEffectMagnitude = \"TemporaryEffectMagnitude\",\r\n  TemporaryEffectExtraCost = \"TemporaryEffectExtraCost\",\r\n  TemporaryEffectExtraCostDivisor = \"TemporaryEffectExtraCostDivisor\",\r\n  TemporaryEffectDuration = \"TemporaryEffectDuration\",\r\n  TemporaryEffectDurationPostProcessing = \"TemporaryEffectDurationPostProcessing\",\r\n  ItemEffect = \"ItemEffect\",\r\n  ItemQuality = \"ItemQuality\",\r\n  ItemCost = \"ItemCost\",\r\n  ItemCostItem = \"ItemCostItem\",\r\n  ItemAmountTransmuted = \"ItemAmountTransmuted\",\r\n  ItemQualityLevelDelta = \"ItemQualityLevelDelta\",\r\n  Ritual = \"Ritual\",\r\n  RitualEffect = \"RitualEffect\",\r\n  ClassEffect = \"ClassEffect\",\r\n  SynchroEffect = \"SynchroEffect\",\r\n  Spellcraft = \"Spellcraft\",\r\n  SpellcraftEffect = \"SpellcraftEffect\",\r\n}\r\n\r\nexport enum TransformationValueType {\r\n  Basic = \"Basic\",\r\n  Percent = \"Percent\",\r\n  Divisor = \"Divisor\",\r\n  Log2 = \"Log2\",\r\n  Log2Divisor = \"Log2Divisor\",\r\n}\r\n","import { memoizeWithLimit } from \"sonic-memoize\";\r\nimport { formatMultiplier, formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport {\r\n  cacheByArbitraryVersion,\r\n  cacheByTickCount,\r\n  cacheIndefinitely,\r\n} from \"../Caching\";\r\nimport { GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { Resource } from \"../Resources\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"./TransformationTags\";\r\n\r\nexport enum TransformationType {\r\n  Addition = \"Addition\",\r\n  Multiplier = \"Multiplier\",\r\n  Power = \"Power\",\r\n  Override = \"Override\",\r\n}\r\n\r\nexport type TransformationTag =\r\n  | TransformationTags\r\n  | Resource\r\n  | SpellElement\r\n  | CombatStat\r\n  | AttackTarget\r\n  | string;\r\n\r\nexport type Transformation = (\r\n  state: GameState,\r\n  params: Record<string, any>,\r\n  previousValue: number,\r\n) => number | undefined;\r\n\r\nexport type TransformationData = {\r\n  id: string;\r\n  description: string;\r\n  transformation: Transformation;\r\n  type: TransformationType;\r\n  tags: TransformationTag[][];\r\n  lastValue: number | undefined;\r\n};\r\n\r\nconst transformationDatabase: Partial<\r\n  Record<TransformationTag, TransformationData[]>\r\n> = {};\r\n\r\nconst allTransformations: Record<string, TransformationData> = {};\r\n\r\nexport function registerTransformation(\r\n  tags: TransformationTag[][],\r\n  transformationId: string,\r\n  transformationDescription: string,\r\n  transformationType: TransformationType,\r\n  transformation: Transformation,\r\n) {\r\n  const data = {\r\n    id: transformationId,\r\n    transformation,\r\n    description: transformationDescription,\r\n    type: transformationType,\r\n    tags,\r\n    lastValue: undefined,\r\n  };\r\n\r\n  const allTags = new Set(tags.flat(2));\r\n  allTags.forEach((tag) => {\r\n    const forTag = transformationDatabase?.[tag] ?? [];\r\n    if (!forTag.some((preExisting) => preExisting.id === transformationId)) {\r\n      forTag.push(data);\r\n      transformationDatabase[tag] = forTag;\r\n    }\r\n  });\r\n  allTransformations[transformationId] = data;\r\n  const recalculateEveryTick = false; //allTags.has(TransformationTags.PerBuildingCap);\r\n\r\n  if (recalculateEveryTick) {\r\n    addGameStateListener(\"t:cache:\" + transformationId, (state) => {\r\n      const value = transformation(state, {}, 10);\r\n      if (value != allTransformations[transformationId].lastValue) {\r\n        allTransformations[transformationId].lastValue = value;\r\n        return clearTransformationCache.bind(null, allTags);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nconst cacheMisses: Map<string, number> = new Map();\r\n\r\nconst getTransformationsThatApply = memoizeWithLimit(\r\n  (tags: TransformationTag[], prejoinedTags?: string) => {\r\n    // const key = joinedTags ?? tags.join(\"\");\r\n    // const oldValue = transformationsThatApplyCache.get(key);\r\n    // if (oldValue == null) {\r\n    //   const allTransformations = tags\r\n    //     .map((tag) => transformationDatabase?.[tag] ?? [])\r\n    //     .flat();\r\n    //   const allTransformationsThatApply = allTransformations.filter((data) =>\r\n    //     data.tags.some((targetTags) =>\r\n    //       targetTags.every((targetTag) => tags.includes(targetTag)),\r\n    //     ),\r\n    //   );\r\n    //   const uniqueTransformations = [...new Set(allTransformationsThatApply)];\r\n    //   const result = Object.fromEntries(\r\n    //     Object.values(TransformationType).map((type) => [\r\n    //       type,\r\n    //       uniqueTransformations.filter((data) => data.type === type),\r\n    //     ]),\r\n    //   ) as Record<TransformationType, TransformationData[]>;\r\n    //   transformationsThatApplyCache.set(key, result);\r\n    //   return result;\r\n    // }\r\n    // return oldValue;\r\n\r\n    const joinedTags = prejoinedTags ?? tags.join();\r\n    cacheMisses.set(joinedTags, (cacheMisses.get(joinedTags) ?? 0) + 1);\r\n    const allTransformations = tags\r\n      .map((tag) => transformationDatabase?.[tag] ?? [])\r\n      .flat();\r\n    const allTransformationsThatApply = allTransformations.filter((data) =>\r\n      data.tags.some((targetTags) =>\r\n        targetTags.every((targetTag) => tags.includes(targetTag)),\r\n      ),\r\n    );\r\n    const uniqueTransformations = [...new Set(allTransformationsThatApply)];\r\n    const result = Object.fromEntries(\r\n      Object.values(TransformationType).map((type) => [\r\n        type,\r\n        uniqueTransformations.filter((data) => data.type === type),\r\n      ]),\r\n    ) as Record<TransformationType, TransformationData[]>;\r\n    return result;\r\n  },\r\n  10000,\r\n);\r\n\r\n// Generally use applyTransformations. However, this one can be used for example\r\n// to display modified effects when multipliers affect the final effect.\r\n// This will prove inaccurate if, for example, there are overrides or similar things.\r\nexport function applyMultiplierTransformations(\r\n  tags: TransformationTag[],\r\n  state: GameState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n) {\r\n  const transformParams = params ?? {};\r\n  transformParams.tags = tags;\r\n\r\n  const transformations = getTransformationsThatApply(tags);\r\n\r\n  // Apply multiplication transforms only\r\n  const multiplicationTransformations =\r\n    transformations[TransformationType.Multiplier];\r\n  const afterMultiplication = multiplicationTransformations\r\n    .map((data) =>\r\n      data.transformation(state, transformParams, startingValue ?? 0),\r\n    )\r\n    .reduce((prev, current) => (prev ?? 1.0) * (current ?? 1.0), startingValue);\r\n\r\n  return afterMultiplication;\r\n}\r\n\r\nexport function applyTransformations(\r\n  tags: TransformationTag[],\r\n  state: GameState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n  joinedTags?: string,\r\n) {\r\n  const transformParams = params ?? {};\r\n  const oldTransformTags = transformParams?.tags;\r\n  transformParams.tags =\r\n    transformParams?.tags != null ? transformParams.tags.concat(tags) : tags;\r\n\r\n  const transformations = getTransformationsThatApply(tags, joinedTags);\r\n\r\n  // Step 1: apply addition transforms\r\n  const additionTransformations = transformations[TransformationType.Addition];\r\n  let afterAddition = startingValue;\r\n  for (let transformation of additionTransformations) {\r\n    afterAddition +=\r\n      transformation.transformation(state, transformParams, startingValue) ?? 0;\r\n  }\r\n\r\n  // Step 2: apply power transforms (rare)\r\n  const powerTransformations = transformations[TransformationType.Power];\r\n  let afterPower = afterAddition;\r\n  for (let transformation of powerTransformations) {\r\n    afterPower = Math.pow(\r\n      afterPower,\r\n      transformation.transformation(state, transformParams, afterAddition) ??\r\n        1.0,\r\n    );\r\n  }\r\n\r\n  // Step 3: apply multiplication transforms\r\n  const multiplicationTransformations =\r\n    transformations[TransformationType.Multiplier];\r\n  let afterMultiplication = afterPower;\r\n  for (let transformation of multiplicationTransformations) {\r\n    afterMultiplication *=\r\n      transformation.transformation(state, transformParams, afterPower) ?? 1.0;\r\n  }\r\n\r\n  // Step 4: finally, apply override transforms\r\n  const overrideTransformations = transformations[TransformationType.Override];\r\n  let afterOverride = afterMultiplication;\r\n  for (let transformation of overrideTransformations) {\r\n    const newOverride = transformation.transformation(\r\n      state,\r\n      transformParams,\r\n      afterMultiplication,\r\n    );\r\n    if (newOverride != null) {\r\n      afterOverride = newOverride;\r\n    }\r\n  }\r\n\r\n  transformParams.tags = oldTransformTags;\r\n\r\n  return afterOverride as number;\r\n}\r\n\r\nconst missMap = {};\r\nlet missCount = 0;\r\n\r\nconst getCacheKeyStuff = memoizeWithLimit(\r\n  (\r\n    tags: TransformationTag[],\r\n    startingValue: number,\r\n    params?: Record<string, any>,\r\n  ) => {\r\n    const joinedTags = tags.join(\"\");\r\n    missMap[joinedTags] = (missMap[joinedTags] ?? 0) + 1;\r\n    missCount++;\r\n    return [\r\n      joinedTags,\r\n      \"t:\" + joinedTags + startingValue + JSON.stringify(params),\r\n    ];\r\n  },\r\n  10000,\r\n);\r\n\r\nexport function applyTransformationsCached(\r\n  tags: TransformationTag[],\r\n  state: GameState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n): number {\r\n  const cacheKey = getCacheKeyStuff(tags, startingValue, params);\r\n  return cacheByTickCount(state, cacheKey[1], (state) =>\r\n    applyTransformations(tags, state, startingValue, params, cacheKey[0]),\r\n  );\r\n}\r\n\r\nexport function applyTransformationsPermaCached(\r\n  tags: TransformationTag[],\r\n  state: GameState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n): number {\r\n  const cacheKey = getCacheKeyStuff(tags, startingValue, params);\r\n  return cacheIndefinitely(\r\n    state,\r\n    (_state) => cacheKey[1],\r\n    (state) =>\r\n      applyTransformations(tags, state, startingValue, params, cacheKey[0]),\r\n  );\r\n}\r\n\r\nexport function clearTransformationCache(\r\n  tags: Set<TransformationTag>,\r\n  state: GameState,\r\n): GameState {\r\n  const cache = state.temp.cache;\r\n  for (let key of cache.keys()) {\r\n    let deleteKey = true;\r\n    for (let tag of tags) {\r\n      if (!key.includes(tag)) {\r\n        deleteKey = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (deleteKey) {\r\n      cache.delete(key);\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function explainTransformations(\r\n  tags: TransformationTag[],\r\n  state: GameState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n): Record<\r\n  TransformationType,\r\n  Array<{ id: string; description: string; value: number | undefined }>\r\n> {\r\n  const transformParams = params ?? {};\r\n  const oldTransformTags = transformParams?.tags;\r\n  transformParams.tags =\r\n    transformParams?.tags != null ? transformParams.tags.concat(tags) : tags;\r\n  const output: Record<\r\n    TransformationType,\r\n    Array<{ id: string; description: string; value: number | undefined }>\r\n  > = {\r\n    Power: [],\r\n    Addition: [],\r\n    Multiplier: [],\r\n    Override: [],\r\n  };\r\n\r\n  // Step 1: get the transformations that apply\r\n  const allTransformationsThatApply = getTransformationsThatApply(tags);\r\n\r\n  // Step 2: apply addition transforms\r\n  const additionTransformations = allTransformationsThatApply.Addition;\r\n  const afterAddition = additionTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(\r\n        state,\r\n        transformParams,\r\n        startingValue ?? 0,\r\n      );\r\n      output.Addition.push({\r\n        id: data.id,\r\n        description: data.description,\r\n        value,\r\n      });\r\n      return value;\r\n    })\r\n    .reduce((prev, current) => (prev ?? 0) + (current ?? 0), startingValue);\r\n\r\n  // Step 3: apply power transforms (rare)\r\n  const powerTransformations = allTransformationsThatApply.Power;\r\n  const afterPower = powerTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(\r\n        state,\r\n        transformParams,\r\n        afterAddition ?? 0,\r\n      );\r\n      output.Power.push({ id: data.id, description: data.description, value });\r\n      return value;\r\n    })\r\n    .reduce(\r\n      (prev, current) => Math.pow(prev ?? 1.0, current ?? 1.0),\r\n      afterAddition,\r\n    );\r\n\r\n  // Step 4: apply multiplication transforms\r\n  const multiplicationTransformations = allTransformationsThatApply.Multiplier;\r\n  const afterMultiplication = multiplicationTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(\r\n        state,\r\n        transformParams,\r\n        afterPower ?? 0,\r\n      );\r\n      output.Multiplier.push({\r\n        id: data.id,\r\n        description: data.description,\r\n        value,\r\n      });\r\n      return value;\r\n    })\r\n    .reduce((prev, current) => (prev ?? 1.0) * (current ?? 1.0), afterPower);\r\n\r\n  // Step 5: finally, apply override transforms\r\n  const overrideTransformations = allTransformationsThatApply.Override;\r\n  const _afterOverride = overrideTransformations\r\n    .map((data) => {\r\n      const value = data.transformation(\r\n        state,\r\n        transformParams,\r\n        afterMultiplication ?? 0,\r\n      );\r\n      output.Override.push({\r\n        id: data.id,\r\n        description: data.description,\r\n        value,\r\n      });\r\n      return value;\r\n    })\r\n    .reduce((prev, current) => current ?? prev, afterMultiplication);\r\n\r\n  transformParams.tags = oldTransformTags;\r\n\r\n  return output;\r\n}\r\n\r\nexport function explainTransformationsText(\r\n  tags: TransformationTag[],\r\n  state: GameState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n): string {\r\n  const cacheKey = getCacheKeyStuff(tags, startingValue, params);\r\n  return cacheByArbitraryVersion(\r\n    state,\r\n    \"explainCache:\" + cacheKey,\r\n    (state) =>\r\n      explainTransformationsTextUncached(tags, state, startingValue, params),\r\n    (state) => applyTransformations(tags, state, startingValue, params),\r\n  );\r\n}\r\n\r\nexport function explainTransformationsTextUncached(\r\n  tags: TransformationTag[],\r\n  state: GameState,\r\n  startingValue: number,\r\n  params?: Record<string, any>,\r\n): string {\r\n  const explained = explainTransformations(tags, state, startingValue, params);\r\n  const unit = params?.unit ?? \"\";\r\n  const type = params?.valueType ?? TransformationValueType.Basic;\r\n\r\n  const overrides = explained.Override.filter((value) => value.value != null);\r\n\r\n  if (overrides.length > 0) {\r\n    return t(\"Overridden: {{amount}}{{unit}} ({{description}})\", {\r\n      amount: overrides[0].value,\r\n      unit,\r\n      description: overrides[0].description,\r\n    });\r\n  }\r\n\r\n  function toTextAddition(result: {\r\n    id: string;\r\n    description: string;\r\n    value: number | undefined;\r\n  }) {\r\n    return t(\"{{amount}}{{unit}} ({{description}})\", {\r\n      amount:\r\n        result.value > 0\r\n          ? \"+\" +\r\n            formatNumber(\r\n              type == TransformationValueType.Percent\r\n                ? 100.0 * result.value\r\n                : result.value,\r\n            )\r\n          : formatNumber(result.value),\r\n      unit,\r\n      description: result.description,\r\n    });\r\n  }\r\n\r\n  function toTextMultiplier(result: {\r\n    id: string;\r\n    description: string;\r\n    value: number | undefined;\r\n  }) {\r\n    return t(\"{{amount}} ({{description}})\", {\r\n      amount: formatMultiplier(result.value),\r\n      description: result.description,\r\n    });\r\n  }\r\n\r\n  const additions = explained.Addition.filter((value) => value.value != 0);\r\n  const multipliers = explained.Multiplier.filter((value) => value.value != 1);\r\n\r\n  if (additions.length == 0 && multipliers.length == 0) {\r\n    return \"\";\r\n  }\r\n\r\n  const baseText = t(\"Base: {{amount}}{{unit}}\", {\r\n    amount: formatNumber(\r\n      type == TransformationValueType.Percent\r\n        ? 100.0 * startingValue\r\n        : startingValue,\r\n      { showDecimals: true },\r\n    ),\r\n    unit:\r\n      type == TransformationValueType.Percent ? t(\"%{{unit}}\", { unit }) : unit,\r\n  });\r\n  const additionText =\r\n    additions.length > 0\r\n      ? t(\"; Plus: {{plusText}}\", {\r\n          plusText: additions.map(toTextAddition).join(t(\", \")),\r\n        })\r\n      : \"\";\r\n  const multiplierText =\r\n    multipliers.length > 0\r\n      ? t(\"; Multipliers: {{plusText}}\", {\r\n          plusText: multipliers.map(toTextMultiplier).join(t(\", \")),\r\n        })\r\n      : \"\";\r\n\r\n  if (type == TransformationValueType.Log2) {\r\n    const base = params?.base ?? 1.0;\r\n    return t(\r\n      `Results from multiplying {{base}} by the base 2 logarithm of the following: {{baseText}}{{additionText}}{{multiplierText}}`,\r\n      {\r\n        base: formatNumber(base, { showDecimals: true }),\r\n        baseText,\r\n        additionText,\r\n        multiplierText,\r\n      },\r\n    );\r\n  }\r\n\r\n  if (type == TransformationValueType.Log2Divisor) {\r\n    const base = params?.base ?? 1.0;\r\n    return t(\r\n      `Results from dividing by 1.0 + {{base}} times the base 2 logarithm of the following: {{baseText}}{{additionText}}{{multiplierText}}`,\r\n      {\r\n        base: formatNumber(base, { showDecimals: true }),\r\n        baseText,\r\n        additionText,\r\n        multiplierText,\r\n      },\r\n    );\r\n  }\r\n\r\n  if (type == TransformationValueType.Divisor) {\r\n    return t(\r\n      `Results from dividing by 1.0 + the following: {{baseText}}{{additionText}}{{multiplierText}}`,\r\n      {\r\n        baseText,\r\n        additionText,\r\n        multiplierText,\r\n      },\r\n    );\r\n  }\r\n  return t(\"{{baseText}}{{additionText}}{{multiplierText}}\", {\r\n    baseText,\r\n    additionText,\r\n    multiplierText,\r\n  });\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { hasWorldFlag, setWorldFlag } from \"./Flags\";\r\nimport { GameState, GameStateTransform } from \"./GameState\";\r\nimport { addGameStateListener } from \"./GameStateListeners\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"./transformation/Transformation\";\r\nimport { TransformationTags } from \"./transformation/TransformationTags\";\r\n\r\ntype ResourceInfo = {\r\n  baseCap: number;\r\n  icon: string;\r\n};\r\n\r\nexport enum Resource {\r\n  Mana = \"Mana\",\r\n  FireEssence = \"FireEssence\",\r\n  EarthEssence = \"EarthEssence\",\r\n  WaterEssence = \"WaterEssence\",\r\n  AirEssence = \"AirEssence\",\r\n  PoisonEssence = \"PoisonEssence\",\r\n  MindEssence = \"MindEssence\",\r\n  LifeEssence = \"LifeEssence\",\r\n  ElectricEssence = \"ElectricEssence\",\r\n  DeathEssence = \"DeathEssence\",\r\n  HolyEssence = \"HolyEssence\",\r\n  TimeEssence = \"TimeEssence\",\r\n  SpaceEssence = \"SpaceEssence\",\r\n  Coins = \"Coins\",\r\n  Monstium = \"Monstium\",\r\n  TimePiece = \"TimePiece\",\r\n}\r\n\r\nexport function translateResource(resource: Resource): string {\r\n  switch (resource) {\r\n    case Resource.Mana:\r\n      return t(\"Mana\");\r\n    case Resource.FireEssence:\r\n      return t(\"Fire\");\r\n    case Resource.EarthEssence:\r\n      return t(\"Earth\");\r\n    case Resource.WaterEssence:\r\n      return t(\"Water\");\r\n    case Resource.AirEssence:\r\n      return t(\"Air\");\r\n    case Resource.PoisonEssence:\r\n      return t(\"Poison\");\r\n    case Resource.MindEssence:\r\n      return t(\"Mind\");\r\n    case Resource.LifeEssence:\r\n      return t(\"Life\");\r\n    case Resource.ElectricEssence:\r\n      return t(\"Electric\");\r\n    case Resource.DeathEssence:\r\n      return t(\"Death\");\r\n    case Resource.HolyEssence:\r\n      return t(\"Holy\");\r\n    case Resource.TimeEssence:\r\n      return t(\"Time\");\r\n    case Resource.SpaceEssence:\r\n      return t(\"Space\");\r\n    case Resource.Coins:\r\n      return t(\"Coins\");\r\n    case Resource.Monstium:\r\n      return t(\"Monstium\");\r\n    case Resource.TimePiece:\r\n      return t(\"Time Pieces\");\r\n\r\n    // Do not add a default\r\n  }\r\n}\r\n\r\nconst RESOURCES: Record<Resource, ResourceInfo> = {\r\n  Mana: {\r\n    baseCap: 100,\r\n    icon: \"mana\",\r\n  },\r\n  Coins: {\r\n    baseCap: 10000,\r\n    icon: \"coins\",\r\n  },\r\n  Monstium: {\r\n    baseCap: 1000,\r\n    icon: \"monstium\",\r\n  },\r\n  FireEssence: {\r\n    baseCap: 100,\r\n    icon: \"fireessence\",\r\n  },\r\n  EarthEssence: {\r\n    baseCap: 100,\r\n    icon: \"earthessence\",\r\n  },\r\n  WaterEssence: {\r\n    baseCap: 100,\r\n    icon: \"wateressence\",\r\n  },\r\n  AirEssence: {\r\n    baseCap: 100,\r\n    icon: \"airessence\",\r\n  },\r\n  PoisonEssence: {\r\n    baseCap: 100,\r\n    icon: \"poisonessence\",\r\n  },\r\n  MindEssence: {\r\n    baseCap: 100,\r\n    icon: \"mindessence\",\r\n  },\r\n  LifeEssence: {\r\n    baseCap: 100,\r\n    icon: \"lifeessence\",\r\n  },\r\n  ElectricEssence: {\r\n    baseCap: 100,\r\n    icon: \"electricessence\",\r\n  },\r\n  DeathEssence: {\r\n    baseCap: 100,\r\n    icon: \"deathessence\",\r\n  },\r\n  HolyEssence: {\r\n    baseCap: 100,\r\n    icon: \"holyessence\",\r\n  },\r\n  TimeEssence: {\r\n    baseCap: 100,\r\n    icon: \"timeessence\",\r\n  },\r\n  SpaceEssence: {\r\n    baseCap: 100,\r\n    icon: \"spaceessence\",\r\n  },\r\n  TimePiece: {\r\n    baseCap: 100000,\r\n    icon: \"timepiece\",\r\n  },\r\n};\r\n\r\nexport function getResourceInfo(resource: Resource): ResourceInfo {\r\n  return RESOURCES[resource];\r\n}\r\n\r\nexport function getSortedResourceKeys(state: GameState) {\r\n  return Object.keys(state.run.resources).sort(\r\n    (a, b) =>\r\n      Object.values(Resource).indexOf(a as Resource) -\r\n      Object.values(Resource).indexOf(b as Resource),\r\n  );\r\n}\r\n\r\nconst resourceCapTags = memoize((resourceName) => [\r\n  resourceName,\r\n  TransformationTags.Cap,\r\n]);\r\n\r\nconst resourceCapParams = memoize((resourceName) => ({\r\n  resource: resourceName,\r\n}));\r\n\r\nfunction calculateResourceCap(\r\n  state: GameState,\r\n  resourceName: Resource,\r\n): number {\r\n  let value = state.temp.resourceCapCache[resourceName];\r\n  if (value == null) {\r\n    value = applyTransformations(\r\n      resourceCapTags(resourceName),\r\n      state,\r\n      getResourceInfo(resourceName).baseCap,\r\n      resourceCapParams(resourceName),\r\n    );\r\n    state.temp.resourceCapCache[resourceName] = value;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function registerResourceCapClearer(\r\n  id: string,\r\n  valueFn: (state: GameState) => any,\r\n) {\r\n  addGameStateListener(\r\n    id + \"-resourceCapClearer\",\r\n    (_state) => (state) => {\r\n      state.temp.resourceCapCache = {};\r\n      return state;\r\n    },\r\n    valueFn,\r\n  );\r\n}\r\n\r\nexport function clearResourceCapCache(state: GameState): GameState {\r\n  state.temp.resourceCapCache = {};\r\n  return state;\r\n}\r\n\r\nexport function explainResourceCap(\r\n  state: GameState,\r\n  resourceName: Resource,\r\n): string {\r\n  return explainTransformationsText(\r\n    resourceCapTags(resourceName),\r\n    state,\r\n    getResourceInfo(resourceName).baseCap,\r\n    { resource: resourceName },\r\n  );\r\n}\r\n\r\nexport function getResourceCap(\r\n  state: GameState,\r\n  resourceName: Resource,\r\n): number {\r\n  return calculateResourceCap(state, resourceName);\r\n}\r\n\r\nexport function getResourceAmount(state: GameState, resource: Resource) {\r\n  return state.run.resources?.[resource] || 0;\r\n}\r\n\r\nexport function isResourceCapped(state: GameState, resource: Resource) {\r\n  return getResourceAmount(state, resource) >= getResourceCap(state, resource);\r\n}\r\n\r\nexport function hasEverHadResource(state: GameState, resource: Resource) {\r\n  return hasWorldFlag(state, \"hasEverHadResource-\" + resource);\r\n}\r\n\r\nfunction grantResourceImpl(name: Resource, amount: number, state: GameState) {\r\n  if (state.run.resources?.[name] == null) {\r\n    state.run.resources[name] = 0;\r\n  }\r\n  let resource = state.run.resources[name] as number;\r\n  if (amount < 0) {\r\n    resource += amount;\r\n  } else {\r\n    const cap = getResourceCap(state, name);\r\n    const overCap = resource > cap;\r\n\r\n    if (!overCap) {\r\n      resource += amount;\r\n      resource = Math.min(resource, cap);\r\n    }\r\n    state = setWorldFlag(\"hasEverHadResource-\" + name)(state);\r\n  }\r\n  resource = Math.max(resource, 0);\r\n  state.run.resources[name] = resource;\r\n  return state;\r\n}\r\n\r\nexport function grantResource(\r\n  this: any,\r\n  name: Resource,\r\n  amount: number,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return grantResourceImpl.bind(this, name, amount);\r\n}\r\n\r\nexport function loadResources() {\r\n  // addGameStateListener(\"resourceCaps\", (state) => {\r\n  //   let resourcesToRecap = [];\r\n  //   for (let resource of keysOf(state.run.resources)) {\r\n  //     const amount = state.run.resources[resource];\r\n  //     const cap = calculateResourceCap(state, resource);\r\n  //     if (amount > cap) {\r\n  //       resourcesToRecap.push(resource);\r\n  //     }\r\n  //   }\r\n  //   if (resourcesToRecap.length > 0) {\r\n  //     return (s) => {\r\n  //       for (let resource of resourcesToRecap) {\r\n  //         const cap = calculateResourceCap(state, resource);\r\n  //         state.run.resources[resource] = cap;\r\n  //       }\r\n  //       return state;\r\n  //     };\r\n  //   }\r\n  // });\r\n}\r\n","import { clone } from \"../utils/CoreUtils\";\r\nimport { clearAllCaches } from \"./Caching\";\r\nimport { hasWorldFlag } from \"./Flags\";\r\nimport { GameState, RUN_INITIAL_STATE } from \"./GameState\";\r\n\r\nexport type RetirementListenerTransform = (\r\n  state: GameState,\r\n  isMock: boolean,\r\n) => GameState;\r\nconst retirementListeners: Record<string, RetirementListenerTransform> = {};\r\nconst postRetirementListeners: Record<string, RetirementListenerTransform> = {};\r\n\r\nexport function registerRetirementListener(\r\n  id: string,\r\n  listener: RetirementListenerTransform,\r\n) {\r\n  retirementListeners[id] = listener;\r\n}\r\n\r\nexport function registerPostRetirementListener(\r\n  id: string,\r\n  listener: RetirementListenerTransform,\r\n) {\r\n  postRetirementListeners[id] = listener;\r\n}\r\n\r\nexport function isRetirementUnlocked(state: GameState): boolean {\r\n  return hasWorldFlag(state, \"storyline_posterity_completed\");\r\n}\r\n\r\nexport function retire(state: GameState, isMock: boolean) {\r\n  // Invalidate caches to prevent problems\r\n  state.global.tickCount++;\r\n  state = clearAllCaches(state);\r\n\r\n  Object.keys(retirementListeners).forEach((listenerId) => {\r\n    state = retirementListeners[listenerId](state, isMock);\r\n  });\r\n\r\n  state.world.totalTimesResetted += 1;\r\n\r\n  let newState = clone(RUN_INITIAL_STATE);\r\n  newState.lastProcessedTime = Date.now();\r\n  newState.startTimestamp = Date.now();\r\n  state.run = newState;\r\n\r\n  // Invalidate caches again to prevent problems\r\n  state.global.tickCount++;\r\n  state = clearAllCaches(state);\r\n\r\n  Object.keys(postRetirementListeners).forEach((listenerId) => {\r\n    state = postRetirementListeners[listenerId](state, isMock);\r\n  });\r\n\r\n  // Invalidate caches one more time to prevent problems\r\n  state.global.tickCount++;\r\n  state = clearAllCaches(state);\r\n\r\n  return state;\r\n}\r\n\r\nfunction flagsMover(state: GameState): GameState {\r\n  for (let flag in state?.run?.newFlagsOnRetirement || {}) {\r\n    state.world.flags[flag] = true;\r\n  }\r\n  return state;\r\n}\r\n\r\nregisterRetirementListener(\"new_flags\", flagsMover);\r\n","import { t } from \"../../utils/I18n\";\r\nimport { ItemTagEnum } from \"../items/ItemTagEnum\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\n\r\n// Where can an action show up?\r\nexport enum ActionArea {\r\n  HOME = \"HOME\",\r\n  SPELL_MENU = \"SPELL_MENU\",\r\n  STUDY = \"STUDY\",\r\n  TRANSMUTE = \"TRANSMUTE\",\r\n  EXPLORATION = \"EXPLORATION\",\r\n  ENHANCEMENT = \"ENHANCEMENT\",\r\n  BOOST = \"BOOST\",\r\n  FAMILIARS = \"FAMILIARS\",\r\n}\r\n\r\n// From within an action area like Home, what are the subcategories an action should show up in?\r\nexport enum ActionSubcategories {\r\n  // Home\r\n  ACTIONS = \"ACTIONS\",\r\n  CHANNELING = \"CHANNELING\",\r\n  MANA = \"MANA\",\r\n  STORAGE = \"STORAGE\",\r\n  CATALYSTS = \"CATALYSTS\",\r\n  OTHER = \"OTHER\",\r\n  TIME_PIECES = \"TIME_PIECES\",\r\n\r\n  // Enhance\r\n  ENHANCE_STORAGE = \"ENHANCE_STORAGE\",\r\n  ENHANCE_LAND = \"ENHANCE_LAND\",\r\n  ENHANCE_PRODUCTION = \"ENHANCE_PRODUCTION\",\r\n  ENHANCE_CATALYSTS = \"ENHANCE_CATALYSTS\",\r\n  ENHANCE_EXPLORATION = \"ENHANCE_COMBAT\",\r\n  ENHANCE_OTHER = \"ENHANCE_OTHER\",\r\n\r\n  // Boost\r\n  BOOST = \"BOOST\",\r\n  BOOST_OTHER = \"BOOST_OTHER\",\r\n\r\n  // Familiars\r\n  FAMILIARS = \"FAMILIARS\",\r\n}\r\n\r\nexport type ActionSubcategory =\r\n  | ActionSubcategories\r\n  | SpellElement\r\n  | ItemTagEnum;\r\n\r\nexport function translateActionArea(area: ActionArea): string {\r\n  switch (area) {\r\n    case ActionArea.HOME:\r\n      return t(\"Home\");\r\n    case ActionArea.SPELL_MENU:\r\n      return t(\"Spells\");\r\n    case ActionArea.STUDY:\r\n      return t(\"Study\");\r\n    case ActionArea.TRANSMUTE:\r\n      return t(\"Transmute\");\r\n    case ActionArea.EXPLORATION:\r\n      return t(\"Exploration\");\r\n    case ActionArea.ENHANCEMENT:\r\n      return t(\"Enhance\");\r\n    case ActionArea.BOOST:\r\n      return t(\"Boost\");\r\n    case ActionArea.FAMILIARS:\r\n      return t(\"Familiars\");\r\n    // Do not add a default\r\n  }\r\n}\r\n\r\nexport function translateActionSubcategory(\r\n  subcategory: ActionSubcategories,\r\n): string {\r\n  switch (subcategory) {\r\n    case ActionSubcategories.ACTIONS:\r\n      return t(\"Actions\");\r\n    case ActionSubcategories.CHANNELING:\r\n      return t(\"Channeling\");\r\n    case ActionSubcategories.MANA:\r\n      return t(\"Mana\");\r\n    case ActionSubcategories.STORAGE:\r\n      return t(\"Storage\");\r\n    case ActionSubcategories.CATALYSTS:\r\n      return t(\"Catalysts\");\r\n    case ActionSubcategories.OTHER:\r\n      return t(\"Other\");\r\n    case ActionSubcategories.TIME_PIECES:\r\n      return t(\"Time Pieces\");\r\n\r\n    case ActionSubcategories.ENHANCE_STORAGE:\r\n      return t(\"Storage\");\r\n    case ActionSubcategories.ENHANCE_LAND:\r\n      return t(\"Land\");\r\n    case ActionSubcategories.ENHANCE_PRODUCTION:\r\n      return t(\"Production\");\r\n    case ActionSubcategories.ENHANCE_CATALYSTS:\r\n      return t(\"Catalysts\");\r\n    case ActionSubcategories.ENHANCE_EXPLORATION:\r\n      return t(\"Exploration\");\r\n    case ActionSubcategories.ENHANCE_OTHER:\r\n      return t(\"Other\");\r\n\r\n    case ActionSubcategories.BOOST:\r\n      return t(\"Boost\");\r\n    case ActionSubcategories.BOOST_OTHER:\r\n      return t(\"Other\");\r\n\r\n    case ActionSubcategories.FAMILIARS:\r\n      return t(\"Familiars\");\r\n    // Do not add a default\r\n  }\r\n}\r\n","import { valuesOfCached } from \"../../utils/CoreUtils\";\r\nimport { GameState } from \"../GameState\";\r\nimport { ActionArea } from \"../action/ActionAreas\";\r\n\r\nexport function clearVisibleSpellsCache(state: GameState): GameState {\r\n  for (let actionArea of [...valuesOfCached(ActionArea), \"undefined\"]) {\r\n    const key = \"spellByElement:\" + actionArea;\r\n    if (state.temp.cache.get(key) != null) {\r\n      state.temp.cache.delete(key);\r\n    }\r\n  }\r\n  return state;\r\n}\r\n","import memoize, { memoizeWithLimit } from \"sonic-memoize\";\r\nimport {\r\n  clone,\r\n  fromEntries,\r\n  keysOf,\r\n  valuesOf,\r\n  valuesOfCached,\r\n} from \"../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { cacheByTickCountElementLevel, cacheIndefinitely } from \"../Caching\";\r\nimport { isDemo } from \"../Demo\";\r\nimport { hasWorldFlag, setWorldFlagForNextRun } from \"../Flags\";\r\nimport { GameState, GameStateTransform } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport {\r\n  registerPostRetirementListener,\r\n  registerRetirementListener,\r\n} from \"../Retire\";\r\nimport {\r\n  TransformationTag,\r\n  TransformationType,\r\n  applyTransformations,\r\n  applyTransformationsPermaCached,\r\n  registerTransformation,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { clearVisibleSpellsCache } from \"./VisibleSpellsCache\";\r\n\r\nexport enum SpellElement {\r\n  Fire = \"Fire\",\r\n  Earth = \"Earth\",\r\n  Water = \"Water\",\r\n  Air = \"Air\",\r\n  Poison = \"Poison\",\r\n  Mind = \"Mind\",\r\n  Life = \"Life\",\r\n  Electric = \"Electric\",\r\n  Death = \"Death\",\r\n  Holy = \"Holy\",\r\n  Time = \"Time\",\r\n  Space = \"Space\",\r\n}\r\n\r\nexport function translateElement(element: SpellElement): string {\r\n  switch (element) {\r\n    case SpellElement.Fire:\r\n      return t(\"Fire\");\r\n    case SpellElement.Earth:\r\n      return t(\"Earth\");\r\n    case SpellElement.Air:\r\n      return t(\"Air\");\r\n    case SpellElement.Water:\r\n      return t(\"Water\");\r\n    case SpellElement.Poison:\r\n      return t(\"Poison\");\r\n    case SpellElement.Mind:\r\n      return t(\"Mind\");\r\n    case SpellElement.Life:\r\n      return t(\"Life\");\r\n    case SpellElement.Electric:\r\n      return t(\"Electric\");\r\n    case SpellElement.Death:\r\n      return t(\"Death\");\r\n    case SpellElement.Holy:\r\n      return t(\"Holy\");\r\n    case SpellElement.Time:\r\n      return t(\"Time\");\r\n    case SpellElement.Space:\r\n      return t(\"Space\");\r\n    // Do not add a default\r\n  }\r\n}\r\n\r\nexport function getRankForLevel(level: number): string {\r\n  if (level >= 90) {\r\n    const rankPlus = Math.floor((level - 80) / 10.0);\r\n    return t(\"Eminence +{{rank}}\", { rank: formatNumber(rankPlus) });\r\n  }\r\n  if (level >= 80) return t(\"Eminence\");\r\n  //if (level >= 75) return t(\"Grandmaster\");\r\n  if (level >= 70) return t(\"Master\");\r\n  //if (level >= 65) return t(\"Archmage\");\r\n  if (level >= 60) return t(\"Archmage\");\r\n  //if (level >= 55) return t(\"High Expert\");\r\n  if (level >= 50) return t(\"Expert\");\r\n  //if (level >= 45) return t(\"High Magus\");\r\n  if (level >= 40) return t(\"Magus\");\r\n  //if (level >= 35) return t(\"Instructor\");\r\n  if (level >= 30) return t(\"Adept\");\r\n  //if (level >= 25) return t(\"Mage\");\r\n  if (level >= 20) return t(\"Apprentice\");\r\n  //if (level >= 15) return t(\"Journeyman\");\r\n  if (level >= 10) return t(\"Novice\");\r\n  //if (level >= 5) return t(\"Novice\");\r\n  return t(\"Initiate\");\r\n}\r\n\r\nexport const ELEMENT_LEVEL_CAP_BASE = 80;\r\nexport const ELEMENT_LEVEL_CAP_DEMO_BASE = 30;\r\n\r\nconst expTable = new Map<number, Map<number, number>>();\r\n\r\nexport function getElementExp(state: GameState, element: SpellElement): number {\r\n  return state.run.elementExperience?.[element] || 0;\r\n}\r\n\r\nconst maxElementLevelTags = [TransformationTags.MaxElementLevel];\r\n\r\nexport function getMaxElementLevel(state: GameState): number {\r\n  return applyTransformationsPermaCached(\r\n    maxElementLevelTags,\r\n    state,\r\n    isDemo() ? ELEMENT_LEVEL_CAP_DEMO_BASE : ELEMENT_LEVEL_CAP_BASE,\r\n  );\r\n}\r\n\r\nconst getIncrementalExpRequiredForLevelAndExponent = memoize(\r\n  (level: number, exponent: number, maxLevel: number): number => {\r\n    if (level <= 1) {\r\n      return 0;\r\n    }\r\n    if (level > maxLevel) {\r\n      return Infinity;\r\n    }\r\n    return Math.floor(600 * Math.pow(exponent, level - 2));\r\n  },\r\n);\r\n\r\nexport const getTotalExpRequiredForLevelByExponent = (\r\n  level: number,\r\n  exponent: number,\r\n  maxLevel: number,\r\n): number => {\r\n  if (level <= 1) {\r\n    return 0;\r\n  }\r\n  if (level > maxLevel) {\r\n    return Infinity;\r\n  }\r\n  const cachedExp = expTable.get(exponent)?.get(level);\r\n  if (cachedExp != null) {\r\n    return cachedExp;\r\n  }\r\n  return (\r\n    getTotalExpRequiredForLevelByExponent(level - 1, exponent, maxLevel) +\r\n    getIncrementalExpRequiredForLevelAndExponent(level, exponent, maxLevel)\r\n  );\r\n};\r\n\r\nexport const getLevelByExpAndExponent = (\r\n  exp: number,\r\n  exponent: number,\r\n  maxLevel: number,\r\n  estimateLevel?: number,\r\n): number => {\r\n  if (estimateLevel != null) {\r\n    if (\r\n      getTotalExpRequiredForLevelByExponent(\r\n        estimateLevel,\r\n        exponent,\r\n        maxLevel,\r\n      ) <= exp &&\r\n      getTotalExpRequiredForLevelByExponent(\r\n        estimateLevel + 1,\r\n        exponent,\r\n        maxLevel,\r\n      ) > exp\r\n    ) {\r\n      return estimateLevel;\r\n    }\r\n  }\r\n  let level = 1;\r\n  while (\r\n    getTotalExpRequiredForLevelByExponent(level + 1, exponent, maxLevel) <= exp\r\n  ) {\r\n    level += 1;\r\n  }\r\n  return level;\r\n};\r\n\r\nfunction getExponentForElement(\r\n  state: GameState,\r\n  element: SpellElement,\r\n): number {\r\n  if (\r\n    state.run.primaryElement != null &&\r\n    state.run.elementExponents?.[element] == null\r\n  ) {\r\n    if (!getUnlockedElements(state).includes(element)) {\r\n      return 2;\r\n    }\r\n    const primary =\r\n      state.run.primaryElement === element ||\r\n      state.run.secondaryElement === element;\r\n    const exponent = applyTransformations(\r\n      [TransformationTags.ExpRequirementScale, element],\r\n      state,\r\n      primary ? 1.38 : isPartiallyUnlocked(state, element) ? 2 : 1.43,\r\n      { element: element },\r\n    );\r\n    state.run.elementExponents[element] = exponent;\r\n  }\r\n  return state.run.elementExponents[element] ?? 1.43;\r\n}\r\n\r\nexport function getIncrementalExpRequiredForLevel(\r\n  state: GameState,\r\n  level: number,\r\n  element: SpellElement,\r\n): number {\r\n  const exponent = getExponentForElement(state, element);\r\n  return getIncrementalExpRequiredForLevelAndExponent(\r\n    level,\r\n    exponent,\r\n    getMaxElementLevel(state),\r\n  );\r\n}\r\n\r\nexport function getTotalExpRequiredForLevel(\r\n  state: GameState,\r\n  level: number,\r\n  element: SpellElement,\r\n): number {\r\n  const exponent = getExponentForElement(state, element);\r\n  return getTotalExpRequiredForLevelByExponent(\r\n    level,\r\n    exponent,\r\n    getMaxElementLevel(state),\r\n  );\r\n}\r\n\r\nfunction getLevelByExp(\r\n  state: GameState,\r\n  exp: number,\r\n  element: SpellElement,\r\n  estimateLevel?: number,\r\n): number {\r\n  const exponent = getExponentForElement(state, element);\r\n  return getLevelByExpAndExponent(\r\n    exp,\r\n    exponent,\r\n    getMaxElementLevel(state),\r\n    estimateLevel,\r\n  );\r\n}\r\n\r\nconst estimateLevels: Partial<Record<SpellElement, number>> = {};\r\n\r\nexport function getElementLevel(\r\n  state: GameState,\r\n  element: SpellElement,\r\n): number {\r\n  return cacheByTickCountElementLevel(state, element, (state) => {\r\n    const estimateLevel = estimateLevels[element];\r\n    const level = getLevelByExp(\r\n      state,\r\n      state.run.elementExperience?.[element] || 0,\r\n      element,\r\n      estimateLevel,\r\n    );\r\n    estimateLevels[element] = level;\r\n    return level;\r\n  });\r\n}\r\n\r\nfunction grantElementExpImpl(\r\n  element: SpellElement,\r\n  amount: number,\r\n  state: GameState,\r\n) {\r\n  let current = getElementExp(state, element);\r\n  current += amount;\r\n  current = Math.max(current, 0);\r\n  state.run.elementExperience[element] = current;\r\n  return state;\r\n}\r\n\r\nexport const grantElementExp = memoizeWithLimit(\r\n  (element, amount) => grantElementExpImpl.bind(this, element, amount),\r\n  10000,\r\n);\r\n\r\nexport function getTotalElementExp(state: GameState): number {\r\n  let totalExp = 0;\r\n  for (let element in state.run.elementExperience) {\r\n    totalExp += getElementExp(state, element as SpellElement);\r\n  }\r\n  return totalExp;\r\n}\r\n\r\nfunction selectPrimaryElementImpl(element: SpellElement, state: GameState) {\r\n  state.run.primaryElement = element;\r\n  return state;\r\n}\r\n\r\nexport function selectPrimaryElement(\r\n  this: any,\r\n  element: string,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return selectPrimaryElementImpl.bind(this, element);\r\n}\r\n\r\nfunction selectSecondaryElementImpl(element: SpellElement, state: GameState) {\r\n  state.run.secondaryElement = element;\r\n  return state;\r\n}\r\n\r\nexport function selectSecondaryElement(\r\n  this: any,\r\n  element: string,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return selectSecondaryElementImpl.bind(this, element);\r\n}\r\n\r\nexport function getPrimaryElements(state: GameState): SpellElement[] {\r\n  if (state.run.secondaryElement != null && state.run.primaryElement != null) {\r\n    return [state.run.primaryElement, state.run.secondaryElement];\r\n  }\r\n  if (state.run.primaryElement != null) {\r\n    return [state.run.primaryElement];\r\n  }\r\n  return [];\r\n}\r\n\r\nexport function getPrimaryElementMaxLevelForRun(state: GameState): number {\r\n  const primaryElements = getPrimaryElements(state);\r\n  return Math.max(\r\n    ...primaryElements.map((element) => getElementLevel(state, element)),\r\n    1,\r\n  );\r\n}\r\n\r\n// Includes partially unlocked elements\r\nexport function getUnlockedElements(state: GameState): SpellElement[] {\r\n  let value = state.temp.unlockedElementsCache;\r\n  if (value == null) {\r\n    const elementValues = valuesOf(SpellElement);\r\n    value = keysOf(state.world.unlockedElements)\r\n      .filter((key) => state.world.unlockedElements[key])\r\n      .sort((a, b) => elementValues.indexOf(a) - elementValues.indexOf(b))\r\n      .concat(\r\n        keysOf(state.run.partiallyUnlockedElements).filter(\r\n          (key) =>\r\n            state.run.partiallyUnlockedElements[key] &&\r\n            !state.world.unlockedElements[key],\r\n        ),\r\n      );\r\n    state.temp.unlockedElementsCache = value;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function getFullyUnlockedElements(state: GameState): SpellElement[] {\r\n  return keysOf(state.world.unlockedElements).filter(\r\n    (key) => state.world.unlockedElements[key],\r\n  );\r\n}\r\n\r\nexport function isPartiallyUnlocked(\r\n  state: GameState,\r\n  element: string,\r\n): boolean {\r\n  return (\r\n    !(state.world.unlockedElements[element] ?? false) &&\r\n    (state.run.partiallyUnlockedElements[element] ?? false)\r\n  );\r\n}\r\n\r\nfunction unlockElementImpl(element: string, state: GameState) {\r\n  state.world.unlockedElements[element] = true;\r\n  state.temp.unlockedElementsCache = null;\r\n  state.temp.spellRequirementsCache = {};\r\n  state = clearVisibleSpellsCache(state);\r\n  return state;\r\n}\r\n\r\nexport function unlockElement(this: any, element: string): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return unlockElementImpl.bind(this, element);\r\n}\r\n\r\nfunction partiallyUnlockElementImpl(element: string, state: GameState) {\r\n  state.run.partiallyUnlockedElements[element] = true;\r\n  state = setWorldFlagForNextRun(\"everPartiallyUnlockedElement_\" + element)(\r\n    state,\r\n  );\r\n  state.temp.unlockedElementsCache = null;\r\n  state.temp.spellRequirementsCache = {};\r\n  return state;\r\n}\r\n\r\nexport function partiallyUnlockElement(\r\n  this: any,\r\n  element: string,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return partiallyUnlockElementImpl.bind(this, element);\r\n}\r\n\r\nexport function hasElementBeenPartiallyUnlockedInPreviousRun(\r\n  state: GameState,\r\n  element: SpellElement,\r\n): boolean {\r\n  return hasWorldFlag(state, \"everPartiallyUnlockedElement_\" + element);\r\n}\r\n\r\nexport function getMaxPrimaryElementLevel(\r\n  state: GameState,\r\n  element: SpellElement,\r\n): number {\r\n  return Math.min(\r\n    state.world.maxPrimaryElementLevels?.[element] || 0,\r\n    getMaxElementLevel(state),\r\n  );\r\n}\r\n\r\nexport function getMaxOfMaxPrimaryElementLevels(state: GameState): number {\r\n  const maxElementLevels = state.world.maxPrimaryElementLevels || {};\r\n  let max = 0;\r\n  for (let element in maxElementLevels) {\r\n    max = Math.min(\r\n      Math.max(max, maxElementLevels[element as SpellElement] || 0),\r\n      getMaxElementLevel(state),\r\n    );\r\n  }\r\n  return max;\r\n}\r\n\r\nexport function getSumOfMaxPrimaryElementLevels(state: GameState): number {\r\n  const maxElementLevels = state.world.maxPrimaryElementLevels || {};\r\n  let total = 0;\r\n  for (let element in maxElementLevels) {\r\n    total += Math.min(\r\n      (maxElementLevels[element as SpellElement] ?? 1) - 1,\r\n      getMaxElementLevel(state) - 1,\r\n    );\r\n  }\r\n  return total;\r\n}\r\n\r\nconst OTHER_ELEMENT_GRANT = 0.1;\r\n\r\nconst ELEMENT_EXP_POW_BASE = 1.03;\r\nconst BASE_EXP_MULTIPLIER = 1.0;\r\n\r\nexport const MANA_SPENT_EXP_EXPONENT = 0.3;\r\n\r\nconst tagsForExpGain = memoize((tags, element) => [\r\n  ...tags,\r\n  element,\r\n  TransformationTags.ExpGain,\r\n]);\r\n\r\nexport function getElementExpByUsage(\r\n  state: GameState,\r\n  element: SpellElement,\r\n  level: number,\r\n  manaSpent: number,\r\n  isSpellElement: boolean,\r\n  tags: string[] = [],\r\n): number {\r\n  const transformed = applyTransformations(\r\n    tagsForExpGain(tags, element),\r\n    state,\r\n    Math.pow(ELEMENT_EXP_POW_BASE, Math.max(level - 1, 0)) *\r\n      Math.pow(manaSpent, MANA_SPENT_EXP_EXPONENT) *\r\n      BASE_EXP_MULTIPLIER *\r\n      (isSpellElement ? 1.0 : OTHER_ELEMENT_GRANT),\r\n    { school: element, level: level },\r\n  );\r\n  if (transformed == 0) {\r\n    return 0;\r\n  }\r\n  return Math.max(5.0, transformed);\r\n}\r\n\r\nconst BASE_STARTING_EXP = 400;\r\nconst STARTING_EXP_POWER_BASE = 1.27;\r\nconst STARTING_ELEMENT_EXP_BASE_TAGS_BY_ELEMENT: Record<\r\n  SpellElement,\r\n  TransformationTag[]\r\n> = fromEntries(\r\n  valuesOfCached(SpellElement).map((element) => [\r\n    element,\r\n    [TransformationTags.StartingElementExpBase, element],\r\n  ]),\r\n);\r\n\r\nexport function startingExpForElement(state: GameState, element: SpellElement) {\r\n  return (\r\n    BASE_STARTING_EXP *\r\n    (Math.pow(\r\n      applyTransformationsPermaCached(\r\n        STARTING_ELEMENT_EXP_BASE_TAGS_BY_ELEMENT[element],\r\n        state,\r\n        STARTING_EXP_POWER_BASE,\r\n      ),\r\n      getMaxPrimaryElementLevel(state, element),\r\n    ) -\r\n      1)\r\n  );\r\n}\r\n\r\nexport function maximumElementLevelExpMultiplier(state: GameState) {\r\n  return cacheIndefinitely(\r\n    state,\r\n    (s) => \"maximumElementLevelExpMultiplier\",\r\n    (s) => {\r\n      const maxLevel = Math.max(getMaxOfMaxPrimaryElementLevels(s), 1);\r\n      const sumOfLevels = getSumOfMaxPrimaryElementLevels(s);\r\n      const multiplier =\r\n        (1 + (Math.pow(1.11, maxLevel - 1) - 1) / 2.5) *\r\n        (Math.pow(sumOfLevels + Math.pow(20, 1 / 0.8), 0.8) / 20);\r\n      return multiplier;\r\n    },\r\n  );\r\n}\r\n\r\nexport function maximumElementLevelProductionMultiplier(\r\n  state: GameState,\r\n  multiplier: number,\r\n) {\r\n  return multiplier * maximumElementLevelProductionMultiplierDx(state);\r\n}\r\n\r\nexport function maximumElementLevelProductionMultiplierDx(state: GameState) {\r\n  return cacheIndefinitely(\r\n    state,\r\n    (s) => \"maximumElementLevelProductionMultiplierDx\",\r\n    (s) => {\r\n      const researchMultiplier = maximumElementLevelExpMultiplier(state);\r\n      return 1 + (Math.pow(researchMultiplier, 0.4) - 1) / 3.2;\r\n    },\r\n  );\r\n}\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExpGain]],\r\n  \"MELExp\",\r\n  t(\"Maximum Element Level multiplier\"),\r\n  TransformationType.Multiplier,\r\n  maximumElementLevelExpMultiplier,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Production]],\r\n  \"MELProduction\",\r\n  t(\"Maximum Element Level production multiplier\"),\r\n  TransformationType.Multiplier,\r\n  maximumElementLevelProductionMultiplierDx,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ChannelingEfficiency]],\r\n  \"MELChanneling\",\r\n  t(\"Maximum Element Level channeling multiplier\"),\r\n  TransformationType.Multiplier,\r\n  maximumElementLevelProductionMultiplierDx,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Loot]],\r\n  \"MELLoot\",\r\n  t(\"Maximum Element Level loot multiplier\"),\r\n  TransformationType.Multiplier,\r\n  maximumElementLevelProductionMultiplierDx,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.FamiliarExp]],\r\n  \"MELFamiliarExp\",\r\n  t(\"Maximum Element Level familiar Exp multiplier\"),\r\n  TransformationType.Multiplier,\r\n  maximumElementLevelProductionMultiplierDx,\r\n);\r\n\r\nObject.keys(SpellElement).forEach((element) => {\r\n  registerTransformation(\r\n    [\r\n      [\r\n        TransformationTags.Cost,\r\n        element,\r\n        TransformationTags.Spell,\r\n        Resource.Mana,\r\n      ],\r\n    ],\r\n    element + \"SpellCostReducer\",\r\n    t(\"Primary Element\"),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      getPrimaryElements(state).includes(element as SpellElement) ? 0.5 : 1,\r\n  );\r\n});\r\n\r\nfunction retirementListener(state: GameState): GameState {\r\n  const primaryElement = state.run.primaryElement;\r\n  if (primaryElement) {\r\n    const level = getElementLevel(state, primaryElement);\r\n    state.world.maxPrimaryElementLevels[primaryElement] = Math.max(\r\n      getMaxPrimaryElementLevel(state, primaryElement),\r\n      level,\r\n    );\r\n  }\r\n  const secondaryElement = state.run.secondaryElement;\r\n  if (secondaryElement) {\r\n    const level = getElementLevel(state, secondaryElement);\r\n    state.world.maxPrimaryElementLevels[secondaryElement] = Math.max(\r\n      getMaxPrimaryElementLevel(state, secondaryElement),\r\n      level,\r\n    );\r\n  }\r\n  return state;\r\n}\r\n\r\nregisterRetirementListener(\"mpl\", retirementListener);\r\n\r\nexport function grantStartingExp(state: GameState): GameState {\r\n  for (let element of keysOf(state.world.maxPrimaryElementLevels)) {\r\n    const exp = startingExpForElement(state, element);\r\n    state = grantElementExp(element, exp)(state);\r\n    state.run.lastComputedLevelUpElementExperience[element] = exp;\r\n  }\r\n  return state;\r\n}\r\n\r\nfunction maxElementLevelsOnPrevRetirementAssigner(state: GameState): GameState {\r\n  state.run.maxElementLevelsOnPrevRetirement = clone(\r\n    state.world.maxElementLevels,\r\n  );\r\n  return state;\r\n}\r\n\r\nregisterPostRetirementListener(\r\n  \"maxElementLevelsOnPrevRetirement\",\r\n  maxElementLevelsOnPrevRetirementAssigner,\r\n);\r\n\r\nexport function meetsRequirements(\r\n  state: GameState,\r\n  requirements: Partial<Record<SpellElement, number>>,\r\n): boolean {\r\n  if (\r\n    Object.keys(requirements).some((elementName) => {\r\n      const levelRequirement = requirements[elementName as SpellElement] || 0;\r\n      if (levelRequirement <= 0) {\r\n        return false;\r\n      }\r\n      return (\r\n        getElementLevel(state, elementName as SpellElement) <\r\n          (requirements[elementName as SpellElement] || 0) ||\r\n        !getUnlockedElements(state).includes(elementName as SpellElement)\r\n      );\r\n    })\r\n  ) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nconst cachedExponents = [1.38, 1.43, 2];\r\ncachedExponents.forEach((exponent) => expTable.set(exponent, new Map()));\r\n\r\nfor (let level = 1; level < 500; level++) {\r\n  cachedExponents.forEach((exponent) => {\r\n    expTable\r\n      .get(exponent)\r\n      ?.set(level, getTotalExpRequiredForLevelByExponent(level, exponent, 499));\r\n  });\r\n}\r\n","import color from \"color\";\r\nimport { MD3DarkTheme, MD3LightTheme } from \"react-native-paper\";\r\nimport memoize from \"sonic-memoize\";\r\nimport { SpellElement } from \"./backend/spells/Elements\";\r\nimport { clone } from \"./utils/CoreUtils\";\r\n\r\n/* \r\nBase colors:\r\n\r\nFire: #cb1e1e\r\nEarth: #b66336\r\nWater: #009ce9\r\nAir: #89ab83\r\nPoison: #7e18ef\r\nMind: #00dddd\r\nLife: #95AB6C\r\nElectric: #fbc02d\r\nTime: #C21872\r\nSpace: #00308f\r\n\r\nFor Death: \r\nDark mode: grab Fire, desaturate every color, and decrease lightness by 50%\r\nLight mode: same thing\r\n\r\nFor Holy:\r\nDark mode: grab Fire, desaturate every color\r\nLight mode: same thing\r\n*/\r\nfunction generateDeathColor(fireColor: string, isDark: boolean) {\r\n  const baseColor = color(fireColor);\r\n  const grayColor = baseColor.grayscale();\r\n  return grayColor.darken(isDark ? 0.3 : 0.2).hexa();\r\n}\r\nfunction generateHolyColor(fireColor: string, isDark: boolean) {\r\n  const baseColor = color(fireColor);\r\n  const grayColor = baseColor.grayscale();\r\n  return grayColor.lighten(isDark ? 0.3 : 0.4).hexa();\r\n}\r\nconst COLORS_TO_REGENERATE_LIGHT = [\r\n  \"primary\",\r\n  \"primaryContainer\",\r\n  \"onPrimaryContainer\",\r\n  \"secondary\",\r\n  \"secondaryContainer\",\r\n  \"onSecondaryContainer\",\r\n  \"tertiary\",\r\n  \"tertiaryContainer\",\r\n  \"onTertiaryContainer\",\r\n];\r\nconst COLORS_TO_REGENERATE_DARK = [\r\n  ...COLORS_TO_REGENERATE_LIGHT,\r\n  \"onPrimary\",\r\n  \"onSecondary\",\r\n  \"onTertiary\",\r\n];\r\nconst TO_GRAYSCALE_ONLY = [\r\n  \"background\",\r\n  \"onBackground\",\r\n  \"surface\",\r\n  \"surfaceVariant\",\r\n  \"outline\",\r\n  \"outlineVariant\",\r\n];\r\n\r\nfunction getThemeByElementAndDarkModeUnmemoized(\r\n  element: SpellElement | undefined,\r\n  isDark: boolean,\r\n) {\r\n  let colors = { colors: {} };\r\n  switch (element) {\r\n    case SpellElement.Fire:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(189, 16, 22)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(255, 218, 214)\",\r\n              onPrimaryContainer: \"rgb(65, 0, 2)\",\r\n              secondary: \"rgb(119, 86, 82)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(255, 218, 214)\",\r\n              onSecondaryContainer: \"rgb(44, 21, 18)\",\r\n              tertiary: \"rgb(113, 91, 46)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(253, 223, 166)\",\r\n              onTertiaryContainer: \"rgb(38, 25, 0)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(255, 251, 255)\",\r\n              onBackground: \"rgb(32, 26, 25)\",\r\n              surface: \"rgb(255, 251, 255)\",\r\n              onSurface: \"rgb(32, 26, 25)\",\r\n              surfaceVariant: \"rgb(245, 221, 218)\",\r\n              onSurfaceVariant: \"rgb(83, 67, 65)\",\r\n              outline: \"rgb(133, 115, 113)\",\r\n              outlineVariant: \"rgb(216, 194, 191)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(54, 47, 46)\",\r\n              inverseOnSurface: \"rgb(251, 238, 236)\",\r\n              inversePrimary: \"rgb(255, 180, 171)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(252, 239, 243)\",\r\n                level2: \"rgb(250, 232, 236)\",\r\n                level3: \"rgb(248, 225, 229)\",\r\n                level4: \"rgb(247, 223, 227)\",\r\n                level5: \"rgb(246, 218, 222)\",\r\n              },\r\n              surfaceDisabled: \"rgba(32, 26, 25, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(32, 26, 25, 0.38)\",\r\n              backdrop: \"rgba(59, 45, 43, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(255, 180, 171)\",\r\n              onPrimary: \"rgb(105, 0, 5)\",\r\n              primaryContainer: \"rgb(147, 0, 10)\",\r\n              onPrimaryContainer: \"rgb(255, 218, 214)\",\r\n              secondary: \"rgb(231, 189, 183)\",\r\n              onSecondary: \"rgb(68, 41, 38)\",\r\n              secondaryContainer: \"rgb(93, 63, 60)\",\r\n              onSecondaryContainer: \"rgb(255, 218, 214)\",\r\n              tertiary: \"rgb(224, 195, 140)\",\r\n              onTertiary: \"rgb(63, 46, 4)\",\r\n              tertiaryContainer: \"rgb(87, 68, 25)\",\r\n              onTertiaryContainer: \"rgb(253, 223, 166)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(32, 26, 25)\",\r\n              onBackground: \"rgb(237, 224, 222)\",\r\n              surface: \"rgb(32, 26, 25)\",\r\n              onSurface: \"rgb(237, 224, 222)\",\r\n              surfaceVariant: \"rgb(83, 67, 65)\",\r\n              onSurfaceVariant: \"rgb(216, 194, 191)\",\r\n              outline: \"rgb(160, 140, 138)\",\r\n              outlineVariant: \"rgb(83, 67, 65)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(237, 224, 222)\",\r\n              inverseOnSurface: \"rgb(54, 47, 46)\",\r\n              inversePrimary: \"rgb(189, 16, 22)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(43, 34, 32)\",\r\n                level2: \"rgb(50, 38, 37)\",\r\n                level3: \"rgb(57, 43, 41)\",\r\n                level4: \"rgb(59, 45, 43)\",\r\n                level5: \"rgb(63, 48, 45)\",\r\n              },\r\n              surfaceDisabled: \"rgba(237, 224, 222, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(237, 224, 222, 0.38)\",\r\n              backdrop: \"rgba(59, 45, 43, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Earth:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(152, 71, 23)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(255, 219, 203)\",\r\n              onPrimaryContainer: \"rgb(52, 17, 0)\",\r\n              secondary: \"rgb(118, 88, 73)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(255, 219, 203)\",\r\n              onSecondaryContainer: \"rgb(44, 22, 11)\",\r\n              tertiary: \"rgb(101, 95, 49)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(236, 228, 170)\",\r\n              onTertiaryContainer: \"rgb(31, 28, 0)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(255, 251, 255)\",\r\n              onBackground: \"rgb(32, 26, 24)\",\r\n              surface: \"rgb(255, 251, 255)\",\r\n              onSurface: \"rgb(32, 26, 24)\",\r\n              surfaceVariant: \"rgb(244, 222, 213)\",\r\n              onSurfaceVariant: \"rgb(82, 68, 61)\",\r\n              outline: \"rgb(133, 115, 108)\",\r\n              outlineVariant: \"rgb(215, 194, 185)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(54, 47, 44)\",\r\n              inverseOnSurface: \"rgb(251, 238, 233)\",\r\n              inversePrimary: \"rgb(255, 182, 146)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(250, 242, 243)\",\r\n                level2: \"rgb(247, 237, 236)\",\r\n                level3: \"rgb(244, 231, 230)\",\r\n                level4: \"rgb(243, 229, 227)\",\r\n                level5: \"rgb(241, 226, 223)\",\r\n              },\r\n              surfaceDisabled: \"rgba(32, 26, 24, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(32, 26, 24, 0.38)\",\r\n              backdrop: \"rgba(59, 46, 39, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(255, 182, 146)\",\r\n              onPrimary: \"rgb(85, 32, 0)\",\r\n              primaryContainer: \"rgb(121, 49, 0)\",\r\n              onPrimaryContainer: \"rgb(255, 219, 203)\",\r\n              secondary: \"rgb(230, 190, 172)\",\r\n              onSecondary: \"rgb(67, 42, 30)\",\r\n              secondaryContainer: \"rgb(92, 64, 51)\",\r\n              onSecondaryContainer: \"rgb(255, 219, 203)\",\r\n              tertiary: \"rgb(208, 200, 144)\",\r\n              onTertiary: \"rgb(53, 49, 7)\",\r\n              tertiaryContainer: \"rgb(76, 72, 28)\",\r\n              onTertiaryContainer: \"rgb(236, 228, 170)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(32, 26, 24)\",\r\n              onBackground: \"rgb(237, 224, 219)\",\r\n              surface: \"rgb(32, 26, 24)\",\r\n              onSurface: \"rgb(237, 224, 219)\",\r\n              surfaceVariant: \"rgb(82, 68, 61)\",\r\n              onSurfaceVariant: \"rgb(215, 194, 185)\",\r\n              outline: \"rgb(160, 141, 133)\",\r\n              outlineVariant: \"rgb(82, 68, 61)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(237, 224, 219)\",\r\n              inverseOnSurface: \"rgb(54, 47, 44)\",\r\n              inversePrimary: \"rgb(152, 71, 23)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(43, 34, 30)\",\r\n                level2: \"rgb(50, 39, 34)\",\r\n                level3: \"rgb(57, 43, 37)\",\r\n                level4: \"rgb(59, 45, 39)\",\r\n                level5: \"rgb(63, 48, 41)\",\r\n              },\r\n              surfaceDisabled: \"rgba(237, 224, 219, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(237, 224, 219, 0.38)\",\r\n              backdrop: \"rgba(59, 46, 39, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Water:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(0, 100, 151)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(204, 229, 255)\",\r\n              onPrimaryContainer: \"rgb(0, 30, 49)\",\r\n              secondary: \"rgb(81, 96, 111)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(212, 228, 246)\",\r\n              onSecondaryContainer: \"rgb(13, 29, 42)\",\r\n              tertiary: \"rgb(102, 88, 122)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(237, 220, 255)\",\r\n              onTertiaryContainer: \"rgb(34, 21, 52)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(252, 252, 255)\",\r\n              onBackground: \"rgb(26, 28, 30)\",\r\n              surface: \"rgb(252, 252, 255)\",\r\n              onSurface: \"rgb(26, 28, 30)\",\r\n              surfaceVariant: \"rgb(222, 227, 235)\",\r\n              onSurfaceVariant: \"rgb(66, 71, 78)\",\r\n              outline: \"rgb(114, 120, 126)\",\r\n              outlineVariant: \"rgb(194, 199, 206)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(47, 49, 51)\",\r\n              inverseOnSurface: \"rgb(240, 240, 244)\",\r\n              inversePrimary: \"rgb(146, 204, 255)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(239, 244, 250)\",\r\n                level2: \"rgb(232, 240, 247)\",\r\n                level3: \"rgb(224, 235, 244)\",\r\n                level4: \"rgb(222, 234, 243)\",\r\n                level5: \"rgb(217, 231, 240)\",\r\n              },\r\n              surfaceDisabled: \"rgba(26, 28, 30, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(26, 28, 30, 0.38)\",\r\n              backdrop: \"rgba(43, 49, 55, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(146, 204, 255)\",\r\n              onPrimary: \"rgb(0, 51, 81)\",\r\n              primaryContainer: \"rgb(0, 75, 115)\",\r\n              onPrimaryContainer: \"rgb(204, 229, 255)\",\r\n              secondary: \"rgb(184, 200, 218)\",\r\n              onSecondary: \"rgb(35, 50, 63)\",\r\n              secondaryContainer: \"rgb(57, 72, 87)\",\r\n              onSecondaryContainer: \"rgb(212, 228, 246)\",\r\n              tertiary: \"rgb(209, 191, 231)\",\r\n              onTertiary: \"rgb(55, 42, 74)\",\r\n              tertiaryContainer: \"rgb(78, 65, 98)\",\r\n              onTertiaryContainer: \"rgb(237, 220, 255)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(26, 28, 30)\",\r\n              onBackground: \"rgb(226, 226, 229)\",\r\n              surface: \"rgb(26, 28, 30)\",\r\n              onSurface: \"rgb(226, 226, 229)\",\r\n              surfaceVariant: \"rgb(66, 71, 78)\",\r\n              onSurfaceVariant: \"rgb(194, 199, 206)\",\r\n              outline: \"rgb(140, 145, 152)\",\r\n              outlineVariant: \"rgb(66, 71, 78)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(226, 226, 229)\",\r\n              inverseOnSurface: \"rgb(47, 49, 51)\",\r\n              inversePrimary: \"rgb(0, 100, 151)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(32, 37, 41)\",\r\n                level2: \"rgb(36, 42, 48)\",\r\n                level3: \"rgb(39, 47, 55)\",\r\n                level4: \"rgb(40, 49, 57)\",\r\n                level5: \"rgb(43, 53, 62)\",\r\n              },\r\n              surfaceDisabled: \"rgba(226, 226, 229, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(226, 226, 229, 0.38)\",\r\n              backdrop: \"rgba(43, 49, 55, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Air:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(39, 108, 43)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(170, 245, 163)\",\r\n              onPrimaryContainer: \"rgb(0, 34, 4)\",\r\n              secondary: \"rgb(82, 99, 79)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(213, 232, 206)\",\r\n              onSecondaryContainer: \"rgb(17, 31, 15)\",\r\n              tertiary: \"rgb(56, 101, 106)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(188, 235, 240)\",\r\n              onTertiaryContainer: \"rgb(0, 32, 35)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(252, 253, 246)\",\r\n              onBackground: \"rgb(26, 28, 25)\",\r\n              surface: \"rgb(252, 253, 246)\",\r\n              onSurface: \"rgb(26, 28, 25)\",\r\n              surfaceVariant: \"rgb(222, 229, 216)\",\r\n              onSurfaceVariant: \"rgb(66, 73, 64)\",\r\n              outline: \"rgb(114, 121, 111)\",\r\n              outlineVariant: \"rgb(194, 201, 189)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(47, 49, 45)\",\r\n              inverseOnSurface: \"rgb(240, 241, 235)\",\r\n              inversePrimary: \"rgb(143, 216, 138)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(241, 246, 236)\",\r\n                level2: \"rgb(235, 241, 230)\",\r\n                level3: \"rgb(229, 237, 224)\",\r\n                level4: \"rgb(226, 236, 222)\",\r\n                level5: \"rgb(222, 233, 218)\",\r\n              },\r\n              surfaceDisabled: \"rgba(26, 28, 25, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(26, 28, 25, 0.38)\",\r\n              backdrop: \"rgba(44, 50, 42, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(143, 216, 138)\",\r\n              onPrimary: \"rgb(0, 57, 10)\",\r\n              primaryContainer: \"rgb(6, 83, 21)\",\r\n              onPrimaryContainer: \"rgb(170, 245, 163)\",\r\n              secondary: \"rgb(186, 204, 179)\",\r\n              onSecondary: \"rgb(37, 52, 35)\",\r\n              secondaryContainer: \"rgb(59, 75, 56)\",\r\n              onSecondaryContainer: \"rgb(213, 232, 206)\",\r\n              tertiary: \"rgb(160, 207, 212)\",\r\n              onTertiary: \"rgb(0, 54, 59)\",\r\n              tertiaryContainer: \"rgb(31, 77, 82)\",\r\n              onTertiaryContainer: \"rgb(188, 235, 240)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(26, 28, 25)\",\r\n              // background: \"rgb(8, 9, 7)\",\r\n              onBackground: \"rgb(226, 227, 221)\",\r\n              surface: \"rgb(26, 28, 25)\",\r\n              onSurface: \"rgb(226, 227, 221)\",\r\n              surfaceVariant: \"rgb(66, 73, 64)\",\r\n              onSurfaceVariant: \"rgb(194, 201, 189)\",\r\n              outline: \"rgb(140, 147, 136)\",\r\n              outlineVariant: \"rgb(66, 73, 64)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(226, 227, 221)\",\r\n              inverseOnSurface: \"rgb(47, 49, 45)\",\r\n              inversePrimary: \"rgb(39, 108, 43)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(32, 37, 31)\",\r\n                level2: \"rgb(35, 43, 34)\",\r\n                level3: \"rgb(39, 49, 37)\",\r\n                level4: \"rgb(40, 51, 39)\",\r\n                level5: \"rgb(42, 54, 41)\",\r\n              },\r\n              surfaceDisabled: \"rgba(226, 227, 221, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(226, 227, 221, 0.38)\",\r\n              backdrop: \"rgba(44, 50, 42, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Poison:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(126, 23, 239)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(237, 220, 255)\",\r\n              onPrimaryContainer: \"rgb(40, 0, 86)\",\r\n              secondary: \"rgb(100, 90, 112)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(235, 221, 247)\",\r\n              onSecondaryContainer: \"rgb(31, 24, 42)\",\r\n              tertiary: \"rgb(127, 82, 91)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(255, 217, 223)\",\r\n              onTertiaryContainer: \"rgb(50, 16, 25)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(255, 251, 255)\",\r\n              onBackground: \"rgb(29, 27, 30)\",\r\n              surface: \"rgb(255, 251, 255)\",\r\n              onSurface: \"rgb(29, 27, 30)\",\r\n              surfaceVariant: \"rgb(232, 224, 235)\",\r\n              onSurfaceVariant: \"rgb(74, 69, 78)\",\r\n              outline: \"rgb(123, 117, 127)\",\r\n              outlineVariant: \"rgb(203, 196, 207)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(50, 47, 51)\",\r\n              inverseOnSurface: \"rgb(245, 239, 244)\",\r\n              inversePrimary: \"rgb(215, 186, 255)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(249, 240, 254)\",\r\n                level2: \"rgb(245, 233, 254)\",\r\n                level3: \"rgb(241, 226, 253)\",\r\n                level4: \"rgb(240, 224, 253)\",\r\n                level5: \"rgb(237, 219, 253)\",\r\n              },\r\n              surfaceDisabled: \"rgba(29, 27, 30, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(29, 27, 30, 0.38)\",\r\n              backdrop: \"rgba(51, 47, 55, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(215, 186, 255)\",\r\n              onPrimary: \"rgb(67, 0, 136)\",\r\n              primaryContainer: \"rgb(96, 0, 190)\",\r\n              onPrimaryContainer: \"rgb(237, 220, 255)\",\r\n              secondary: \"rgb(206, 194, 219)\",\r\n              onSecondary: \"rgb(53, 45, 64)\",\r\n              secondaryContainer: \"rgb(76, 67, 87)\",\r\n              onSecondaryContainer: \"rgb(235, 221, 247)\",\r\n              tertiary: \"rgb(241, 183, 194)\",\r\n              onTertiary: \"rgb(75, 37, 46)\",\r\n              tertiaryContainer: \"rgb(100, 59, 68)\",\r\n              onTertiaryContainer: \"rgb(255, 217, 223)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(29, 27, 30)\",\r\n              onBackground: \"rgb(231, 225, 230)\",\r\n              surface: \"rgb(29, 27, 30)\",\r\n              onSurface: \"rgb(231, 225, 230)\",\r\n              surfaceVariant: \"rgb(74, 69, 78)\",\r\n              onSurfaceVariant: \"rgb(203, 196, 207)\",\r\n              outline: \"rgb(149, 142, 153)\",\r\n              outlineVariant: \"rgb(74, 69, 78)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(231, 225, 230)\",\r\n              inverseOnSurface: \"rgb(50, 47, 51)\",\r\n              inversePrimary: \"rgb(126, 23, 239)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(38, 35, 41)\",\r\n                level2: \"rgb(44, 40, 48)\",\r\n                level3: \"rgb(50, 45, 55)\",\r\n                level4: \"rgb(51, 46, 57)\",\r\n                level5: \"rgb(55, 49, 62)\",\r\n              },\r\n              surfaceDisabled: \"rgba(231, 225, 230, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(231, 225, 230, 0.38)\",\r\n              backdrop: \"rgba(51, 47, 55, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Mind:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(0, 106, 106)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(73, 249, 249)\",\r\n              onPrimaryContainer: \"rgb(0, 32, 32)\",\r\n              secondary: \"rgb(74, 99, 99)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(204, 232, 231)\",\r\n              onSecondaryContainer: \"rgb(5, 31, 31)\",\r\n              tertiary: \"rgb(75, 96, 124)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(211, 228, 255)\",\r\n              onTertiaryContainer: \"rgb(4, 28, 53)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(250, 253, 252)\",\r\n              onBackground: \"rgb(25, 28, 28)\",\r\n              surface: \"rgb(250, 253, 252)\",\r\n              onSurface: \"rgb(25, 28, 28)\",\r\n              surfaceVariant: \"rgb(218, 229, 228)\",\r\n              onSurfaceVariant: \"rgb(63, 73, 72)\",\r\n              outline: \"rgb(111, 121, 121)\",\r\n              outlineVariant: \"rgb(190, 201, 200)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(45, 49, 49)\",\r\n              inverseOnSurface: \"rgb(239, 241, 240)\",\r\n              inversePrimary: \"rgb(0, 221, 221)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(238, 246, 245)\",\r\n                level2: \"rgb(230, 241, 240)\",\r\n                level3: \"rgb(223, 237, 236)\",\r\n                level4: \"rgb(220, 235, 235)\",\r\n                level5: \"rgb(215, 232, 232)\",\r\n              },\r\n              surfaceDisabled: \"rgba(25, 28, 28, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(25, 28, 28, 0.38)\",\r\n              backdrop: \"rgba(41, 50, 50, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(0, 221, 221)\",\r\n              onPrimary: \"rgb(0, 55, 55)\",\r\n              primaryContainer: \"rgb(0, 79, 79)\",\r\n              onPrimaryContainer: \"rgb(73, 249, 249)\",\r\n              secondary: \"rgb(176, 204, 203)\",\r\n              onSecondary: \"rgb(27, 53, 52)\",\r\n              secondaryContainer: \"rgb(50, 75, 75)\",\r\n              onSecondaryContainer: \"rgb(204, 232, 231)\",\r\n              tertiary: \"rgb(179, 200, 232)\",\r\n              onTertiary: \"rgb(28, 49, 75)\",\r\n              tertiaryContainer: \"rgb(51, 72, 99)\",\r\n              onTertiaryContainer: \"rgb(211, 228, 255)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(25, 28, 28)\",\r\n              onBackground: \"rgb(224, 227, 226)\",\r\n              surface: \"rgb(25, 28, 28)\",\r\n              onSurface: \"rgb(224, 227, 226)\",\r\n              surfaceVariant: \"rgb(63, 73, 72)\",\r\n              onSurfaceVariant: \"rgb(190, 201, 200)\",\r\n              outline: \"rgb(136, 147, 146)\",\r\n              outlineVariant: \"rgb(63, 73, 72)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(224, 227, 226)\",\r\n              inverseOnSurface: \"rgb(45, 49, 49)\",\r\n              inversePrimary: \"rgb(0, 106, 106)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(24, 38, 38)\",\r\n                level2: \"rgb(23, 43, 43)\",\r\n                level3: \"rgb(22, 49, 49)\",\r\n                level4: \"rgb(22, 51, 51)\",\r\n                level5: \"rgb(22, 55, 55)\",\r\n              },\r\n              surfaceDisabled: \"rgba(224, 227, 226, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(224, 227, 226, 0.38)\",\r\n              backdrop: \"rgba(41, 50, 50, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Life:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(74, 103, 11)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(202, 239, 135)\",\r\n              onPrimaryContainer: \"rgb(19, 31, 0)\",\r\n              secondary: \"rgb(89, 98, 72)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(221, 230, 198)\",\r\n              onSecondaryContainer: \"rgb(23, 30, 10)\",\r\n              tertiary: \"rgb(57, 102, 97)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(188, 236, 229)\",\r\n              onTertiaryContainer: \"rgb(0, 32, 29)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(254, 252, 244)\",\r\n              onBackground: \"rgb(27, 28, 23)\",\r\n              surface: \"rgb(254, 252, 244)\",\r\n              onSurface: \"rgb(27, 28, 23)\",\r\n              surfaceVariant: \"rgb(226, 228, 212)\",\r\n              onSurfaceVariant: \"rgb(69, 72, 61)\",\r\n              outline: \"rgb(117, 120, 107)\",\r\n              outlineVariant: \"rgb(197, 200, 185)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(48, 49, 44)\",\r\n              inverseOnSurface: \"rgb(242, 241, 233)\",\r\n              inversePrimary: \"rgb(175, 211, 110)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(245, 245, 232)\",\r\n                level2: \"rgb(240, 240, 225)\",\r\n                level3: \"rgb(234, 236, 218)\",\r\n                level4: \"rgb(232, 234, 216)\",\r\n                level5: \"rgb(229, 231, 211)\",\r\n              },\r\n              surfaceDisabled: \"rgba(27, 28, 23, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(27, 28, 23, 0.38)\",\r\n              backdrop: \"rgba(47, 50, 39, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(175, 211, 110)\",\r\n              onPrimary: \"rgb(36, 54, 0)\",\r\n              primaryContainer: \"rgb(54, 78, 0)\",\r\n              onPrimaryContainer: \"rgb(202, 239, 135)\",\r\n              secondary: \"rgb(193, 202, 171)\",\r\n              onSecondary: \"rgb(43, 51, 29)\",\r\n              secondaryContainer: \"rgb(66, 74, 50)\",\r\n              onSecondaryContainer: \"rgb(221, 230, 198)\",\r\n              tertiary: \"rgb(160, 208, 201)\",\r\n              onTertiary: \"rgb(1, 55, 51)\",\r\n              tertiaryContainer: \"rgb(31, 78, 73)\",\r\n              onTertiaryContainer: \"rgb(188, 236, 229)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(27, 28, 23)\",\r\n              onBackground: \"rgb(228, 227, 219)\",\r\n              surface: \"rgb(27, 28, 23)\",\r\n              onSurface: \"rgb(228, 227, 219)\",\r\n              surfaceVariant: \"rgb(69, 72, 61)\",\r\n              onSurfaceVariant: \"rgb(197, 200, 185)\",\r\n              outline: \"rgb(143, 146, 132)\",\r\n              outlineVariant: \"rgb(69, 72, 61)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(228, 227, 219)\",\r\n              inverseOnSurface: \"rgb(48, 49, 44)\",\r\n              inversePrimary: \"rgb(74, 103, 11)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(34, 37, 27)\",\r\n                level2: \"rgb(39, 43, 30)\",\r\n                level3: \"rgb(43, 48, 33)\",\r\n                level4: \"rgb(45, 50, 33)\",\r\n                level5: \"rgb(48, 54, 35)\",\r\n              },\r\n              surfaceDisabled: \"rgba(228, 227, 219, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(228, 227, 219, 0.38)\",\r\n              backdrop: \"rgba(46, 50, 39, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Electric:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(121, 89, 0)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(255, 223, 160)\",\r\n              onPrimaryContainer: \"rgb(38, 26, 0)\",\r\n              secondary: \"rgb(107, 92, 63)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(245, 224, 187)\",\r\n              onSecondaryContainer: \"rgb(36, 26, 4)\",\r\n              tertiary: \"rgb(74, 101, 70)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(204, 235, 196)\",\r\n              onTertiaryContainer: \"rgb(8, 32, 8)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(255, 251, 255)\",\r\n              onBackground: \"rgb(30, 27, 22)\",\r\n              surface: \"rgb(255, 251, 255)\",\r\n              onSurface: \"rgb(30, 27, 22)\",\r\n              surfaceVariant: \"rgb(237, 225, 207)\",\r\n              onSurfaceVariant: \"rgb(77, 70, 57)\",\r\n              outline: \"rgb(127, 118, 103)\",\r\n              outlineVariant: \"rgb(208, 197, 180)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(52, 48, 42)\",\r\n              inverseOnSurface: \"rgb(248, 239, 231)\",\r\n              inversePrimary: \"rgb(248, 189, 42)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(248, 243, 242)\",\r\n                level2: \"rgb(244, 238, 235)\",\r\n                level3: \"rgb(240, 233, 227)\",\r\n                level4: \"rgb(239, 232, 224)\",\r\n                level5: \"rgb(236, 228, 219)\",\r\n              },\r\n              surfaceDisabled: \"rgba(30, 27, 22, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(30, 27, 22, 0.38)\",\r\n              backdrop: \"rgba(54, 48, 36, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(248, 189, 42)\",\r\n              onPrimary: \"rgb(64, 45, 0)\",\r\n              primaryContainer: \"rgb(92, 67, 0)\",\r\n              onPrimaryContainer: \"rgb(255, 223, 160)\",\r\n              secondary: \"rgb(216, 196, 160)\",\r\n              onSecondary: \"rgb(59, 47, 21)\",\r\n              secondaryContainer: \"rgb(83, 69, 42)\",\r\n              onSecondaryContainer: \"rgb(245, 224, 187)\",\r\n              tertiary: \"rgb(177, 207, 169)\",\r\n              onTertiary: \"rgb(29, 54, 27)\",\r\n              tertiaryContainer: \"rgb(51, 77, 48)\",\r\n              onTertiaryContainer: \"rgb(204, 235, 196)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(30, 27, 22)\",\r\n              onBackground: \"rgb(233, 225, 216)\",\r\n              surface: \"rgb(30, 27, 22)\",\r\n              onSurface: \"rgb(233, 225, 216)\",\r\n              surfaceVariant: \"rgb(77, 70, 57)\",\r\n              onSurfaceVariant: \"rgb(208, 197, 180)\",\r\n              outline: \"rgb(153, 143, 128)\",\r\n              outlineVariant: \"rgb(77, 70, 57)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(233, 225, 216)\",\r\n              inverseOnSurface: \"rgb(52, 48, 42)\",\r\n              inversePrimary: \"rgb(121, 89, 0)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(41, 35, 23)\",\r\n                level2: \"rgb(47, 40, 24)\",\r\n                level3: \"rgb(54, 45, 24)\",\r\n                level4: \"rgb(56, 46, 24)\",\r\n                level5: \"rgb(61, 50, 25)\",\r\n              },\r\n              surfaceDisabled: \"rgba(233, 225, 216, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(233, 225, 216, 0.38)\",\r\n              backdrop: \"rgba(54, 48, 36, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Time:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(183, 7, 106)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(255, 217, 228)\",\r\n              onPrimaryContainer: \"rgb(62, 0, 32)\",\r\n              secondary: \"rgb(115, 86, 96)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(255, 217, 228)\",\r\n              onSecondaryContainer: \"rgb(42, 21, 29)\",\r\n              tertiary: \"rgb(125, 86, 54)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(255, 220, 195)\",\r\n              onTertiaryContainer: \"rgb(47, 21, 0)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(255, 251, 255)\",\r\n              onBackground: \"rgb(32, 26, 28)\",\r\n              surface: \"rgb(255, 251, 255)\",\r\n              onSurface: \"rgb(32, 26, 28)\",\r\n              surfaceVariant: \"rgb(242, 221, 226)\",\r\n              onSurfaceVariant: \"rgb(81, 67, 71)\",\r\n              outline: \"rgb(131, 115, 119)\",\r\n              outlineVariant: \"rgb(213, 194, 198)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(53, 47, 48)\",\r\n              inverseOnSurface: \"rgb(250, 238, 240)\",\r\n              inversePrimary: \"rgb(255, 176, 203)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(251, 239, 248)\",\r\n                level2: \"rgb(249, 232, 243)\",\r\n                level3: \"rgb(247, 224, 239)\",\r\n                level4: \"rgb(246, 222, 237)\",\r\n                level5: \"rgb(245, 217, 234)\",\r\n              },\r\n              surfaceDisabled: \"rgba(32, 26, 28, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(32, 26, 28, 0.38)\",\r\n              backdrop: \"rgba(57, 45, 49, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(255, 176, 203)\",\r\n              onPrimary: \"rgb(100, 0, 55)\",\r\n              primaryContainer: \"rgb(141, 0, 80)\",\r\n              onPrimaryContainer: \"rgb(255, 217, 228)\",\r\n              secondary: \"rgb(226, 189, 200)\",\r\n              onSecondary: \"rgb(66, 41, 50)\",\r\n              secondaryContainer: \"rgb(90, 63, 72)\",\r\n              onSecondaryContainer: \"rgb(255, 217, 228)\",\r\n              tertiary: \"rgb(240, 188, 149)\",\r\n              onTertiary: \"rgb(72, 41, 13)\",\r\n              tertiaryContainer: \"rgb(98, 63, 33)\",\r\n              onTertiaryContainer: \"rgb(255, 220, 195)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(32, 26, 28)\",\r\n              onBackground: \"rgb(235, 224, 225)\",\r\n              surface: \"rgb(32, 26, 28)\",\r\n              onSurface: \"rgb(235, 224, 225)\",\r\n              surfaceVariant: \"rgb(81, 67, 71)\",\r\n              onSurfaceVariant: \"rgb(213, 194, 198)\",\r\n              outline: \"rgb(158, 140, 145)\",\r\n              outlineVariant: \"rgb(81, 67, 71)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(235, 224, 225)\",\r\n              inverseOnSurface: \"rgb(53, 47, 48)\",\r\n              inversePrimary: \"rgb(183, 7, 106)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(43, 34, 37)\",\r\n                level2: \"rgb(50, 38, 42)\",\r\n                level3: \"rgb(57, 43, 47)\",\r\n                level4: \"rgb(59, 44, 49)\",\r\n                level5: \"rgb(63, 47, 53)\",\r\n              },\r\n              surfaceDisabled: \"rgba(235, 224, 225, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(235, 224, 225, 0.38)\",\r\n              backdrop: \"rgba(57, 45, 49, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    case SpellElement.Space:\r\n      colors = !isDark\r\n        ? {\r\n            colors: {\r\n              primary: \"rgb(56, 88, 182)\",\r\n              onPrimary: \"rgb(255, 255, 255)\",\r\n              primaryContainer: \"rgb(220, 225, 255)\",\r\n              onPrimaryContainer: \"rgb(0, 22, 78)\",\r\n              secondary: \"rgb(89, 94, 114)\",\r\n              onSecondary: \"rgb(255, 255, 255)\",\r\n              secondaryContainer: \"rgb(222, 225, 249)\",\r\n              onSecondaryContainer: \"rgb(22, 27, 44)\",\r\n              tertiary: \"rgb(116, 84, 112)\",\r\n              onTertiary: \"rgb(255, 255, 255)\",\r\n              tertiaryContainer: \"rgb(255, 215, 246)\",\r\n              onTertiaryContainer: \"rgb(44, 18, 42)\",\r\n              error: \"rgb(186, 26, 26)\",\r\n              onError: \"rgb(255, 255, 255)\",\r\n              errorContainer: \"rgb(255, 218, 214)\",\r\n              onErrorContainer: \"rgb(65, 0, 2)\",\r\n              background: \"rgb(254, 251, 255)\",\r\n              onBackground: \"rgb(27, 27, 31)\",\r\n              surface: \"rgb(254, 251, 255)\",\r\n              onSurface: \"rgb(27, 27, 31)\",\r\n              surfaceVariant: \"rgb(226, 225, 236)\",\r\n              onSurfaceVariant: \"rgb(69, 70, 79)\",\r\n              outline: \"rgb(118, 118, 128)\",\r\n              outlineVariant: \"rgb(198, 198, 208)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(48, 48, 52)\",\r\n              inverseOnSurface: \"rgb(242, 240, 244)\",\r\n              inversePrimary: \"rgb(181, 196, 255)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(244, 243, 251)\",\r\n                level2: \"rgb(238, 238, 249)\",\r\n                level3: \"rgb(232, 233, 247)\",\r\n                level4: \"rgb(230, 231, 246)\",\r\n                level5: \"rgb(226, 228, 245)\",\r\n              },\r\n              surfaceDisabled: \"rgba(27, 27, 31, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(27, 27, 31, 0.38)\",\r\n              backdrop: \"rgba(46, 48, 56, 0.4)\",\r\n            },\r\n          }\r\n        : {\r\n            colors: {\r\n              primary: \"rgb(181, 196, 255)\",\r\n              onPrimary: \"rgb(0, 40, 124)\",\r\n              primaryContainer: \"rgb(27, 63, 157)\",\r\n              onPrimaryContainer: \"rgb(220, 225, 255)\",\r\n              secondary: \"rgb(193, 197, 221)\",\r\n              onSecondary: \"rgb(43, 48, 66)\",\r\n              secondaryContainer: \"rgb(65, 70, 89)\",\r\n              onSecondaryContainer: \"rgb(222, 225, 249)\",\r\n              tertiary: \"rgb(227, 186, 219)\",\r\n              onTertiary: \"rgb(67, 39, 64)\",\r\n              tertiaryContainer: \"rgb(91, 61, 87)\",\r\n              onTertiaryContainer: \"rgb(255, 215, 246)\",\r\n              error: \"rgb(255, 180, 171)\",\r\n              onError: \"rgb(105, 0, 5)\",\r\n              errorContainer: \"rgb(147, 0, 10)\",\r\n              onErrorContainer: \"rgb(255, 180, 171)\",\r\n              background: \"rgb(27, 27, 31)\",\r\n              onBackground: \"rgb(228, 226, 230)\",\r\n              surface: \"rgb(27, 27, 31)\",\r\n              onSurface: \"rgb(228, 226, 230)\",\r\n              surfaceVariant: \"rgb(69, 70, 79)\",\r\n              onSurfaceVariant: \"rgb(198, 198, 208)\",\r\n              outline: \"rgb(143, 144, 154)\",\r\n              outlineVariant: \"rgb(69, 70, 79)\",\r\n              shadow: \"rgb(0, 0, 0)\",\r\n              scrim: \"rgb(0, 0, 0)\",\r\n              inverseSurface: \"rgb(228, 226, 230)\",\r\n              inverseOnSurface: \"rgb(48, 48, 52)\",\r\n              inversePrimary: \"rgb(56, 88, 182)\",\r\n              elevation: {\r\n                level0: \"transparent\",\r\n                level1: \"rgb(35, 35, 42)\",\r\n                level2: \"rgb(39, 41, 49)\",\r\n                level3: \"rgb(44, 46, 56)\",\r\n                level4: \"rgb(46, 47, 58)\",\r\n                level5: \"rgb(49, 51, 62)\",\r\n              },\r\n              surfaceDisabled: \"rgba(228, 226, 230, 0.12)\",\r\n              onSurfaceDisabled: \"rgba(228, 226, 230, 0.38)\",\r\n              backdrop: \"rgba(47, 48, 56, 0.4)\",\r\n            },\r\n          };\r\n      break;\r\n    // Death and Holy might need tweaking\r\n    case SpellElement.Death:\r\n      const deathColors = clone(\r\n        getThemeByElementAndDarkModeUnmemoized(SpellElement.Poison, isDark),\r\n      );\r\n      for (let colorToChange of isDark\r\n        ? COLORS_TO_REGENERATE_DARK\r\n        : COLORS_TO_REGENERATE_LIGHT) {\r\n        deathColors.colors[colorToChange] = generateDeathColor(\r\n          deathColors.colors[colorToChange],\r\n          isDark,\r\n        );\r\n      }\r\n      for (let colorToChange of TO_GRAYSCALE_ONLY) {\r\n        deathColors.colors[colorToChange] = color(\r\n          deathColors.colors[colorToChange],\r\n        )\r\n          .grayscale()\r\n          .hexa();\r\n      }\r\n      colors = deathColors;\r\n      break;\r\n    case SpellElement.Holy:\r\n      const holyColors = clone(\r\n        getThemeByElementAndDarkModeUnmemoized(SpellElement.Electric, isDark),\r\n      );\r\n      for (let colorToChange of isDark\r\n        ? COLORS_TO_REGENERATE_DARK\r\n        : COLORS_TO_REGENERATE_LIGHT) {\r\n        holyColors.colors[colorToChange] = generateHolyColor(\r\n          holyColors.colors[colorToChange],\r\n          isDark,\r\n        );\r\n      }\r\n      for (let colorToChange of TO_GRAYSCALE_ONLY) {\r\n        holyColors.colors[colorToChange] = color(\r\n          holyColors.colors[colorToChange],\r\n        )\r\n          .grayscale()\r\n          .hexa();\r\n      }\r\n      colors = holyColors;\r\n      break;\r\n  }\r\n\r\n  const baseTheme = isDark ? MD3DarkTheme : MD3LightTheme;\r\n  return {\r\n    ...baseTheme,\r\n    colors: {\r\n      ...baseTheme.colors,\r\n      ...colors.colors,\r\n      error: isDark ? \"rgb(246, 26, 26)\" : \"rgb(246, 26, 26)\",\r\n      hpBarForeground: isDark ? \"rgb(226, 0, 0)\" : \"rgb(255, 36, 36)\",\r\n      hpBarBackground: isDark ? \"rgb(100, 0, 0)\" : \"rgb(120, 0, 0)\",\r\n      background: isDark\r\n        ? // @ts-ignore Type not declared\r\n          color(colors.colors.background).darken(0.5).hexa()\r\n        : // @ts-ignore Type not declared\r\n          colors.colors.background,\r\n    },\r\n    fonts: {\r\n      ...baseTheme.fonts,\r\n      labelSmall: {\r\n        ...baseTheme.fonts.labelSmall,\r\n        letterSpacing: 0,\r\n      },\r\n      labelMedium: {\r\n        ...baseTheme.fonts.labelMedium,\r\n        letterSpacing: 0,\r\n      },\r\n      bodySmall: {\r\n        ...baseTheme.fonts.bodySmall,\r\n        letterSpacing: 0,\r\n      },\r\n      bodyMedium: {\r\n        ...baseTheme.fonts.bodyMedium,\r\n        letterSpacing: 0,\r\n      },\r\n    },\r\n    roundness: 2,\r\n  };\r\n}\r\n\r\nconst getThemeByElementAndDarkMode = memoize(\r\n  getThemeByElementAndDarkModeUnmemoized,\r\n);\r\n\r\nexport const getThemeWithOverriddenOnError = memoize((theme, onError) => {\r\n  const newTheme = clone(theme);\r\n  newTheme.colors.onError = onError;\r\n  return newTheme;\r\n});\r\n\r\nexport { getThemeByElementAndDarkMode };\r\n","import { hasFlag, hasWorldFlag, setFlag, setWorldFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { DataStore } from \"../../generic/DataStore\";\r\nimport { getMaxOfMaxPrimaryElementLevels } from \"../../spells/Elements\";\r\nimport { Dungeon } from \"./Dungeon\";\r\nimport { DungeonFloor } from \"./DungeonFloor\";\r\n\r\nconst Dungeons = new DataStore<Dungeon>();\r\nconst DungeonFloors = new DataStore<DungeonFloor>();\r\n\r\nexport { Dungeons, DungeonFloors };\r\n\r\nexport function getUnlockedDungeons(state: GameState): Dungeon[] {\r\n  return Dungeons.getAll().filter((dungeon) => dungeon.isUnlocked(state));\r\n}\r\n\r\nexport function isDungeonFloorCompletedThisRun(\r\n  state: GameState,\r\n  floor: DungeonFloor | string,\r\n): boolean {\r\n  return hasFlag(\r\n    state,\r\n    (typeof floor === \"string\" ? floor : floor.getId()) +\r\n      \"_dungeon_floor_completed\",\r\n  );\r\n}\r\n\r\nexport function isDungeonFloorEverCompleted(\r\n  state: GameState,\r\n  floor: DungeonFloor | string,\r\n): boolean {\r\n  return hasWorldFlag(\r\n    state,\r\n    (typeof floor === \"string\" ? floor : floor.getId()) +\r\n      \"_dungeon_floor_completed\",\r\n  );\r\n}\r\n\r\nexport function setDungeonFloorCompleted(\r\n  state: GameState,\r\n  floorId: string,\r\n): GameState {\r\n  state = setFlag(floorId + \"_dungeon_floor_completed\")(state);\r\n  state.run.lastDungeonFloorCompleted = floorId;\r\n  return setWorldFlag(floorId + \"_dungeon_floor_completed\")(state);\r\n}\r\n\r\nexport function minMPLRecommendation(state: GameState): number {\r\n  const unlockedDungeons = getUnlockedDungeons(state);\r\n  const floors = unlockedDungeons\r\n    .map((dungeon) =>\r\n      dungeon\r\n        .getDungeonFloors()\r\n        .filter(\r\n          (floor) => floor.isUnlocked(state) && floor.isMainStoryDungeonFloor(),\r\n        ),\r\n    )\r\n    .flat();\r\n  const maxLowRecommendation = Math.max(\r\n    ...floors.map((floor) => floor.getMinimumMPLRecommendation() ?? 0),\r\n  );\r\n  return maxLowRecommendation;\r\n}\r\n\r\nexport function mplIsTooLow(state: GameState): boolean {\r\n  const maxLowRecommendation = minMPLRecommendation(state);\r\n  const currentMPL = getMaxOfMaxPrimaryElementLevels(state);\r\n  return currentMPL < maxLowRecommendation;\r\n}\r\n\r\nexport function maxMPLRecommendation(state: GameState): number {\r\n  const unlockedDungeons = getUnlockedDungeons(state);\r\n  const floors = unlockedDungeons\r\n    .map((dungeon) =>\r\n      dungeon\r\n        .getDungeonFloors()\r\n        .filter(\r\n          (floor) => floor.isUnlocked(state) && floor.isMainStoryDungeonFloor(),\r\n        ),\r\n    )\r\n    .flat();\r\n  const maxHighRecommendation = Math.max(\r\n    ...floors.map((floor) => floor.getMaximumMPLRecommendation() ?? Infinity),\r\n  );\r\n  return maxHighRecommendation;\r\n}\r\n\r\nexport function mplIsTooHigh(state: GameState): boolean {\r\n  const minHighRecommendation = maxMPLRecommendation(state);\r\n  const currentMPL = getMaxOfMaxPrimaryElementLevels(state);\r\n  return currentMPL > minHighRecommendation;\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { hasFlag, hasWorldFlag, setFlag, setWorldFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  SpellElement,\r\n  getElementLevel,\r\n  getUnlockedElements,\r\n} from \"../spells/Elements\";\r\n\r\nexport enum StorylineStatus {\r\n  HIDDEN = \"HIDDEN\",\r\n  LOCKED = \"LOCKED\",\r\n  UNLOCKED = \"UNLOCKED\",\r\n  HINT_REVEALED = \"HINT_REVEALED\",\r\n  COMPLETED = \"COMPLETED\",\r\n  BONUS_ACTIVE = \"BONUS_ACTIVE\",\r\n}\r\n\r\nexport const STORYLINE_STATUS_ORDER = [\r\n  StorylineStatus.LOCKED,\r\n  StorylineStatus.UNLOCKED,\r\n  StorylineStatus.HINT_REVEALED,\r\n  StorylineStatus.COMPLETED,\r\n  StorylineStatus.BONUS_ACTIVE,\r\n];\r\n\r\nexport function translateStorylineStatus(status: StorylineStatus): string {\r\n  switch (status) {\r\n    case StorylineStatus.HIDDEN:\r\n      return t(\"Hidden\");\r\n    case StorylineStatus.LOCKED:\r\n      return t(\"Undiscovered\");\r\n    case StorylineStatus.UNLOCKED:\r\n      return t(\"Discoverable\");\r\n    case StorylineStatus.HINT_REVEALED:\r\n      return t(\"Hint Available\");\r\n    case StorylineStatus.COMPLETED:\r\n      return t(\"Completed\");\r\n    case StorylineStatus.BONUS_ACTIVE:\r\n      return t(\"Bonus Active\");\r\n  }\r\n}\r\n\r\nexport class Storyline {\r\n  id: string;\r\n  name: string;\r\n  // Order semantics\r\n  // Increment by 10 per storyline \"group\" and by 1 per outcome on that\r\n  // storyline.\r\n  order: number;\r\n  mindRequirementForHint: number;\r\n  hintDescription: (state: GameState) => string;\r\n  getBonusDescription: (state: GameState) => string;\r\n  isHintUnlockable: (state: GameState) => boolean;\r\n  isHidden?: (state: GameState) => boolean;\r\n\r\n  constructor(\r\n    id: string,\r\n    name: string,\r\n    order: number,\r\n    mindRequirementForHint: number,\r\n    hintDescription: string | ((state: GameState) => string),\r\n    getBonusDescription: string | ((state: GameState) => string),\r\n    isHintUnlockable: (state: GameState) => boolean,\r\n    isHidden?: (state: GameState) => boolean,\r\n  ) {\r\n    this.id = id;\r\n    this.name = name;\r\n    this.order = order;\r\n    this.mindRequirementForHint = mindRequirementForHint;\r\n    this.hintDescription =\r\n      typeof hintDescription === \"string\"\r\n        ? (state) => hintDescription\r\n        : hintDescription;\r\n    this.getBonusDescription =\r\n      typeof getBonusDescription === \"string\"\r\n        ? (state) => getBonusDescription\r\n        : getBonusDescription;\r\n    this.isHintUnlockable = isHintUnlockable;\r\n    this.isHidden = isHidden ?? ((_state) => false);\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getName(): string {\r\n    return this.name;\r\n  }\r\n\r\n  getCompletedFlag(): string {\r\n    return \"storyline_\" + this.getId() + \"_completed\";\r\n  }\r\n\r\n  isCompleted(state: GameState): boolean {\r\n    return hasWorldFlag(state, \"storyline_\" + this.getId() + \"_completed\");\r\n  }\r\n\r\n  isCompletedThisRun(state: GameState): boolean {\r\n    return hasFlag(state, \"storyline_\" + this.getId() + \"_completed\");\r\n  }\r\n\r\n  isBonusActive(state: GameState): boolean {\r\n    return hasWorldFlag(state, \"storyline_\" + this.getId() + \"_bonus_active\");\r\n  }\r\n\r\n  isHintRevealed(state: GameState): boolean {\r\n    return hasWorldFlag(state, \"storyline_\" + this.getId() + \"_hint_revealed\");\r\n  }\r\n\r\n  complete(state: GameState): GameState {\r\n    state = setFlag(\"storyline_\" + this.getId() + \"_completed\")(state);\r\n    return setWorldFlag(\"storyline_\" + this.getId() + \"_completed\")(state);\r\n  }\r\n\r\n  activateBonus(state: GameState): GameState {\r\n    state = setFlag(\"storyline_\" + this.getId() + \"_bonus_active\")(state);\r\n    return setWorldFlag(\"storyline_\" + this.getId() + \"_bonus_active\")(state);\r\n  }\r\n\r\n  revealHint(state: GameState): GameState {\r\n    state = setFlag(\"storyline_\" + this.getId() + \"_hint_revealed\")(state);\r\n    return setWorldFlag(\"storyline_\" + this.getId() + \"_hint_revealed\")(state);\r\n  }\r\n\r\n  shouldRevealHint(state: GameState): boolean {\r\n    return (\r\n      !this.isHintRevealed(state) &&\r\n      this.isHintUnlockable(state) &&\r\n      hasWorldFlag(state, \"storyline_diviningTheWorld_bonus_active\") &&\r\n      getUnlockedElements(state).includes(SpellElement.Mind) &&\r\n      getElementLevel(state, SpellElement.Mind) >= this.mindRequirementForHint\r\n    );\r\n  }\r\n\r\n  getStatus(state: GameState): StorylineStatus {\r\n    if (this.isHidden(state)) {\r\n      return StorylineStatus.HIDDEN;\r\n    }\r\n    if (this.isBonusActive(state)) {\r\n      return StorylineStatus.BONUS_ACTIVE;\r\n    }\r\n    if (this.isCompleted(state)) {\r\n      return StorylineStatus.COMPLETED;\r\n    }\r\n    if (this.isHintRevealed(state)) {\r\n      return StorylineStatus.HINT_REVEALED;\r\n    }\r\n    if (this.isHintUnlockable(state)) {\r\n      return StorylineStatus.UNLOCKED;\r\n    }\r\n    return StorylineStatus.LOCKED;\r\n  }\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { isDungeonFloorEverCompleted } from \"../../../exploration/dungeons/Dungeons\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"schematics\",\r\n  t(\"Schematics\"),\r\n  425,\r\n  25,\r\n  t('Defeat at least 15 enemies in the Exploration area \"Temple of Life\"'),\r\n  t(\"Unlock item quality feature (combine items)\"),\r\n  (state) => isDungeonFloorEverCompleted(state, \"templeOfLife\"),\r\n);\r\n\r\nexport { storyline as Schematics };\r\n","export enum Flag {\r\n  // Progression\r\n  ChannelingUnlocked = \"ChannelingUnlocked\",\r\n  ManaSpoutsUnlocked = \"ManaSpoutsUnlocked\",\r\n  ManaShardsUnlocked = \"ManaShardsUnlocked\",\r\n  StoragesUnlocked = \"StoragesUnlocked\",\r\n  CatalystsUnlocked = \"CatalystsUnlocked\",\r\n  StudyUnlocked = \"StudyUnlocked\",\r\n  TransmutationUnlocked = \"TransmutationUnlocked\",\r\n  WizardsUnlocked = \"WizardsUnlocked\",\r\n  SaleStallsUnlocked = \"SaleStallsUnlocked\",\r\n  ResearchersUnlocked = \"ResearchersUnlocked\",\r\n  LandPurchaseUnlocked = \"LandPurchaseUnlocked\",\r\n  ExplorationUnlocked = \"ExplorationUnlocked\",\r\n  RestOfTrainingUnlocked = \"RestOfTrainingUnlocked\",\r\n  EnhancementsUnlocked = \"EnhancementsUnlocked\",\r\n  SewersUnlocked = \"SewersUnlocked\",\r\n  MonstruariumsUnlocked = \"MonstruariumsUnlocked\",\r\n  SynchroUnlocked = \"SynchroUnlocked\",\r\n  VastDesertUnlocked = \"VastDesertUnlocked\",\r\n  ManaClustersUnlocked = \"ManaClustersUnlocked\",\r\n  DeepCavernsUnlocked = \"LifeCavernsUnlocked\",\r\n  FamiliarsUnlocked = \"FamiliarsUnlocked\",\r\n  ResearcherCooperation = \"ResearcherCooperation\",\r\n  LostForestUnlocked = \"LostForestUnlocked\",\r\n  MountainPassUnlocked = \"MountainPassUnlocked\",\r\n  TheSchoolUnlocked = \"TheSchoolUnlocked\",\r\n  SchoolGroundsFirstBossDefeated = \"SchoolGroundsFirstBossDefeated\",\r\n  AberrantRealmUnlocked = \"AberrantRealmUnlocked\",\r\n  HeadmasterFollowing = \"HeadmasterFollowing\",\r\n  MagicalResearchCardObtained = \"MagicalResearchCardObtained\",\r\n  FortressUnlocked = \"FortressUnlocked\",\r\n  DragonShrineUnlocked = \"DragonShrineUnlocked\",\r\n  SecretPrisonUnlocked = \"SecretPrisonUnlocked\",\r\n  SecretPrisonFirstBossDefeated = \"SecretPrisonFirstBossDefeated\",\r\n  PlainsUnlocked = \"PlainsUnlocked\",\r\n  DivineScriptReceived = \"DivineScriptReceived\",\r\n  HiredWizardConsumedStone = \"HiredWizardConsumedStone\",\r\n  DeflectiveShieldCreated = \"DeflectiveShieldCreated\",\r\n  CrossroadsOfWorldsUnlocked = \"CrossroadsOfWorldsUnlocked\",\r\n\r\n  // Other\r\n  SomeonesTrashTreasureGranted = \"SomeonesTrashTreasureGranted\",\r\n  AncientPowerStorylineFinished = \"AncientPowerStorylineFinished\",\r\n  SphinxUnlocked = \"SphinxUnlocked\",\r\n  WizardsConditionsUnlocked = \"WizardsConditionsUnlocked\",\r\n  HeadInstructorDefeated = \"HeadInstructorDefeated\",\r\n  MasteryDungeonUnlocked = \"MasteryDungeonUnlocked\",\r\n  ItemQualityCombinationUnlocked = \"ItemQualityCombinationUnlocked\",\r\n  SewageSystemMakesAll = \"SewageSystemMakesAll\",\r\n  AutoPurchaseUnlocked = \"AutoPurchaseUnlocked\",\r\n  PermaCastUnlocked = \"PermaCastUnlocked\",\r\n  RitualsUnlocked = \"RitualsUnlocked\",\r\n  ChallengesUnlocked = \"ChallengesUnlocked\",\r\n  AssignedWizard = \"AssignedWizard\",\r\n  Ending2CompletedFirstTime = \"Ending2CompletedFirstTime\",\r\n  Ending3CompletedFirstTime = \"Ending3CompletedFirstTime\",\r\n  UniversalChallengeLastStretch = \"UniversalChallengeLastStretch\",\r\n  UniversalChallengeCompletedFirstTime = \"UniversalChallengeCompletedFirstTime\",\r\n  CreatorPath = \"CreatorPath\",\r\n  EverUsedSynchro = \"EverUsedSynchro\",\r\n  SpellcraftUnlocked = \"SpellcraftUnlocked\",\r\n}\r\n","import { Schematics } from \"../events/storyline/cavern/SchematicsStoryline\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Item } from \"./Item\";\r\n\r\nconst Items = new DataStore<Item>();\r\n\r\nexport { Items };\r\n\r\nexport function isInventoryUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.TransmutationUnlocked);\r\n}\r\n\r\nexport function isInventoryEverUnlocked(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.TransmutationUnlocked);\r\n}\r\n\r\nexport function isCraftingUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.TransmutationUnlocked);\r\n}\r\n\r\nexport function isItemQualityUnlocked(state: GameState): boolean {\r\n  return Schematics.isBonusActive(state);\r\n}\r\n\r\nexport function hasEverUnlockedCrafting(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.TransmutationUnlocked);\r\n}\r\n\r\nexport function combineAll(state: GameState): GameState {\r\n  let combined;\r\n  do {\r\n    combined = false;\r\n    const inventory = state.run.inventory;\r\n    for (let stack of inventory) {\r\n      const item = Items.getById(stack.itemOccurrence.itemId);\r\n      const combineActions = item.getCombineActions(\r\n        state,\r\n        stack.itemOccurrence.params,\r\n      );\r\n      if (combineActions.length > 0) {\r\n        const combineAllAction = combineActions[combineActions.length - 1];\r\n        if (combineAllAction.isEnabled) {\r\n          state = combineAllAction.transform(state);\r\n          combined = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  } while (combined);\r\n  return state;\r\n}\r\n\r\nexport function sellLowQualityItems(state: GameState): GameState {\r\n  const inventory = state.run.inventory;\r\n  let sold = false;\r\n  do {\r\n    sold = false;\r\n    for (let stack of inventory) {\r\n      const item = Items.getById(stack.itemOccurrence.itemId);\r\n      const hasHigherQuality =\r\n        state.run.inventory.filter(\r\n          (itemStack) =>\r\n            itemStack.itemOccurrence.itemId == item.getId() &&\r\n            (itemStack.itemOccurrence.params?.itemQuality ?? 0) >\r\n              (stack.itemOccurrence.params?.itemQuality ?? 0),\r\n        ).length > 0;\r\n\r\n      if (hasHigherQuality) {\r\n        const saleActions = item.getSaleActions(\r\n          state,\r\n          stack.itemOccurrence.params,\r\n        );\r\n        const saleAction = saleActions[saleActions.length - 1];\r\n        if (saleAction?.isEnabled) {\r\n          state = saleAction.transform(state);\r\n          sold = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  } while (sold);\r\n  return state;\r\n}\r\n","import { clone } from \"../../utils/CoreUtils\";\r\nimport { setFlag } from \"../Flags\";\r\nimport { GameState, GameStateTransform } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Item, ItemOccurrence, ItemStack } from \"./Item\";\r\nimport { isInventoryUnlocked, Items } from \"./Items\";\r\nimport { ItemTagEnum } from \"./ItemTagEnum\";\r\n\r\nfunction getItemOccurrenceIndex(\r\n  itemOccurrence: ItemOccurrence,\r\n  state: GameState,\r\n): number {\r\n  const itemOccurrenceParamsJSON = JSON.stringify(itemOccurrence.params);\r\n  return state.run.inventory.findIndex((itemStack) => {\r\n    return (\r\n      itemStack.itemOccurrence.itemId == itemOccurrence.itemId &&\r\n      itemOccurrenceParamsJSON ==\r\n        JSON.stringify(itemStack.itemOccurrence.params)\r\n    );\r\n  });\r\n}\r\n\r\nexport function isItemOccurrenceEqual(\r\n  itemOccurrenceA: ItemOccurrence,\r\n  itemOccurrenceB: ItemOccurrence,\r\n) {\r\n  return (\r\n    itemOccurrenceA?.itemId == itemOccurrenceB?.itemId &&\r\n    JSON.stringify(itemOccurrenceA?.params) ==\r\n      JSON.stringify(itemOccurrenceB?.params)\r\n  );\r\n}\r\n\r\nexport function getItemStackFromInventory(\r\n  state: GameState,\r\n  itemOccurrence: ItemOccurrence,\r\n): ItemStack | null {\r\n  const index = getItemOccurrenceIndex(itemOccurrence, state);\r\n  if (index === -1) {\r\n    return null;\r\n  }\r\n  return state.run.inventory[index];\r\n}\r\n\r\nexport const AddToInventoryForFirstTimeListeners =\r\n  new DataStore<GameStateTransform>();\r\n\r\nexport function addToInventory(\r\n  itemOccurrence: ItemOccurrence,\r\n  amount: number,\r\n  state: GameState,\r\n): GameState {\r\n  if (!state.world.itemsEverAddedToInventory[itemOccurrence.itemId]) {\r\n    state.world.itemsEverAddedToInventory[itemOccurrence.itemId] = true;\r\n    AddToInventoryForFirstTimeListeners.getAll().forEach((transform) => {\r\n      state = transform(state);\r\n    });\r\n  }\r\n  const previousIndex = getItemOccurrenceIndex(itemOccurrence, state);\r\n\r\n  if (previousIndex >= 0) {\r\n    state.run.inventory[previousIndex] = {\r\n      itemOccurrence,\r\n      amount: state.run.inventory[previousIndex].amount + amount,\r\n    };\r\n    return state;\r\n  }\r\n\r\n  state.run.inventory.push({\r\n    itemOccurrence,\r\n    amount,\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\nexport function removeFromInventory(\r\n  itemOccurrence: ItemOccurrence,\r\n  amount: number,\r\n  state: GameState,\r\n): GameState {\r\n  const previousIndex = getItemOccurrenceIndex(itemOccurrence, state);\r\n  if (previousIndex < 0) {\r\n    return state;\r\n  }\r\n\r\n  const newAmount = state.run.inventory[previousIndex].amount - amount;\r\n  if (newAmount > 0) {\r\n    state.run.inventory[previousIndex] = {\r\n      itemOccurrence,\r\n      amount: newAmount,\r\n    };\r\n  } else {\r\n    state.run.inventory.splice(previousIndex, 1);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getAmountOfItem(\r\n  itemOccurrence: ItemOccurrence,\r\n  state: GameState,\r\n): number {\r\n  const index = getItemOccurrenceIndex(itemOccurrence, state);\r\n  if (index === -1) {\r\n    return 0;\r\n  }\r\n  return state.run.inventory[index].amount;\r\n}\r\n\r\nexport function getTotalAmountOfItem(item: Item, state: GameState): number {\r\n  return state.run.inventory\r\n    .filter((itemStack) => itemStack.itemOccurrence.itemId == item.getId())\r\n    .reduce((count, current) => count + current.amount, 0);\r\n}\r\n\r\nexport function getTotalAmountOfItemWithMinimumQuality(\r\n  item: Item,\r\n  minimumQuality: number,\r\n  state: GameState,\r\n): number {\r\n  return state.run.inventory\r\n    .filter(\r\n      (itemStack) =>\r\n        itemStack.itemOccurrence.itemId == item.getId() &&\r\n        (itemStack.itemOccurrence.params.itemQuality ?? 0) >= minimumQuality,\r\n    )\r\n    .reduce((count, current) => count + current.amount, 0);\r\n}\r\n\r\nexport function removeFromInventoryWithAnyParams(\r\n  item: Item,\r\n  amount: number,\r\n  state: GameState,\r\n): GameState {\r\n  const oldRunState = state.run.inventory;\r\n  state.run.inventory = clone(state.run.inventory);\r\n\r\n  while (amount > 0) {\r\n    const inventory = state.run.inventory;\r\n    const firstIndex = inventory.findIndex(\r\n      (itemStack) => itemStack.itemOccurrence.itemId == item.getId(),\r\n    );\r\n    if (firstIndex < 0) {\r\n      // Abort\r\n      state.run.inventory = oldRunState;\r\n      return state;\r\n    }\r\n    const itemAmount = inventory[firstIndex].amount;\r\n    state = removeFromInventory(\r\n      inventory[firstIndex].itemOccurrence,\r\n      Math.min(itemAmount, amount),\r\n      state,\r\n    );\r\n    amount -= itemAmount;\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function removeFromInventoryWithMinimumQuality(\r\n  item: Item,\r\n  amount: number,\r\n  minimumQuality: number,\r\n  state: GameState,\r\n): GameState {\r\n  const oldRunState = state.run.inventory;\r\n  state.run.inventory = clone(state.run.inventory);\r\n\r\n  while (amount > 0) {\r\n    const matchingItems = state.run.inventory.filter(\r\n      (itemStack) =>\r\n        itemStack.itemOccurrence.itemId == item.getId() &&\r\n        (itemStack.itemOccurrence.params.itemQuality ?? 0) >= minimumQuality,\r\n    );\r\n    const sortedByQuality = matchingItems.sort(\r\n      (a, b) =>\r\n        (a.itemOccurrence.params.itemQuality ?? 0) -\r\n        (b.itemOccurrence.params.itemQuality ?? 0),\r\n    );\r\n    if (sortedByQuality.length <= 0) {\r\n      // Abort\r\n      state.run.inventory = oldRunState;\r\n      return state;\r\n    }\r\n    const itemAmount = sortedByQuality[0].amount;\r\n    state = removeFromInventory(\r\n      sortedByQuality[0].itemOccurrence,\r\n      Math.min(itemAmount, amount),\r\n      state,\r\n    );\r\n    amount -= itemAmount;\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\n// Place items with those tags in order\r\nconst ITEM_TAG_ORDER = [\"Consumable\", \"Hand\", \"Body\", \"Accessory\"];\r\n// Then if two items have the same tags from the above list, put those who\r\n// have this tag in the back of that sub-category\r\nconst ITEM_TAG_LAST_ORDER = [\"Material\"];\r\n\r\nfunction hasTag(\r\n  itemOccurrence: ItemOccurrence,\r\n  state: GameState,\r\n  tag: string,\r\n): boolean {\r\n  const item = Items.getById(itemOccurrence.itemId);\r\n  return item.getTags().includes(tag as ItemTagEnum);\r\n}\r\n\r\nexport function sortInventory(state: GameState): GameState {\r\n  state.run.inventory.sort((a, b) => {\r\n    for (let tag of ITEM_TAG_ORDER) {\r\n      const aHasTag = hasTag(a.itemOccurrence, state, tag);\r\n      const bHasTag = hasTag(b.itemOccurrence, state, tag);\r\n      if (aHasTag && !bHasTag) {\r\n        return -1;\r\n      }\r\n      if (bHasTag && !aHasTag) {\r\n        return 1;\r\n      }\r\n    }\r\n    for (let tag of ITEM_TAG_LAST_ORDER) {\r\n      const aHasTag = hasTag(a.itemOccurrence, state, tag);\r\n      const bHasTag = hasTag(b.itemOccurrence, state, tag);\r\n      if (aHasTag && !bHasTag) {\r\n        return 1;\r\n      }\r\n      if (bHasTag && !aHasTag) {\r\n        return -1;\r\n      }\r\n    }\r\n    return 0;\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function loadInventoryListener() {\r\n  addGameStateListener(\"InventoryUnlockerListener\", (newState) => {\r\n    if (newState.run.inventory.length > 0 && !isInventoryUnlocked(newState)) {\r\n      return setFlag(\"new_inventory_unlocked\");\r\n    }\r\n  });\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\n\r\nexport enum AttackTarget {\r\n  Player = \"Player\",\r\n  Enemy = \"Enemy\",\r\n  Familiar = \"Familiar\",\r\n}\r\n\r\nexport function translateAttackTarget(target: AttackTarget): string {\r\n  switch (target) {\r\n    case AttackTarget.Player:\r\n      return t(\"Player\");\r\n    case AttackTarget.Enemy:\r\n      return t(\"Enemy\");\r\n    case AttackTarget.Familiar:\r\n      return t(\"Familiar\");\r\n  }\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { AttackTarget } from \"./AttackTarget\";\r\n\r\nexport enum CombatStat {\r\n  MaxHP = \"MaxHP\",\r\n  Attack = \"Attack\",\r\n  AttackDelay = \"AttackDelay\",\r\n  Defense = \"Defense\",\r\n  HPRegen = \"HPRegen\",\r\n  Dodge = \"Dodge\",\r\n  Accuracy = \"Accuracy\",\r\n  Crit = \"Crit\",\r\n}\r\n\r\nconst BASE_VALUES: Record<CombatStat, number> = {\r\n  MaxHP: 60,\r\n  Attack: 5,\r\n  Defense: 0,\r\n  AttackDelay: 2.0,\r\n  HPRegen: 0.0033,\r\n  Dodge: 100,\r\n  Accuracy: 100,\r\n  Crit: 0,\r\n};\r\n\r\nexport function calculatePlayerMaxHP(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.MaxHP);\r\n}\r\n\r\nexport function calculatePlayerAttack(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.Attack);\r\n}\r\n\r\nexport function calculatePlayerAttackDelaySec(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.AttackDelay);\r\n}\r\n\r\nexport function calculatePlayerDefense(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.Defense);\r\n}\r\n\r\nexport function calculatePlayerHPRegenRatioPerSec(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.HPRegen);\r\n}\r\n\r\nexport function calculatePlayerDodgePoints(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.Dodge);\r\n}\r\n\r\nexport function calculatePlayerAccuracyPoints(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.Accuracy);\r\n}\r\n\r\nexport function calculatePlayerCritPoints(state: GameState) {\r\n  return calculatePlayerCombatStat(state, CombatStat.Crit);\r\n}\r\n\r\nconst playerStatTags = memoize((stat) => [AttackTarget.Player, stat]);\r\n\r\nexport function calculatePlayerCombatStat(state: GameState, stat: CombatStat) {\r\n  return getCachedCombatStat(state, AttackTarget.Player, stat, (state) =>\r\n    applyTransformations(playerStatTags(stat), state, BASE_VALUES[stat]),\r\n  );\r\n}\r\n\r\nexport function getCachedCombatStat(\r\n  state: GameState,\r\n  target: AttackTarget,\r\n  stat: CombatStat,\r\n  fn: (state: GameState) => number,\r\n  familiarId?: string,\r\n  level?: number,\r\n): number {\r\n  if (target == AttackTarget.Familiar) {\r\n    // Familiars have an extra level of indirection because there are many familiars\r\n    let collection = state.temp.combatStatCache[target][stat];\r\n    if (collection == null) {\r\n      state.temp.combatStatCache[target][stat] = {};\r\n    }\r\n    let value = state.temp.combatStatCache[target][stat][familiarId];\r\n    if (value == null || value.level != level) {\r\n      value = { value: fn(state), level: level };\r\n      state.temp.combatStatCache[target][stat][familiarId] = value;\r\n    }\r\n    return value.value;\r\n  } else {\r\n    let value = state.temp.combatStatCache[target][stat];\r\n    if (value == null) {\r\n      value = fn(state);\r\n      state.temp.combatStatCache[target][stat] = value;\r\n    }\r\n    return value;\r\n  }\r\n}\r\n\r\nexport function clearCombatStatCache(\r\n  state: GameState,\r\n  target?: AttackTarget,\r\n  stat?: CombatStat,\r\n) {\r\n  if (target != null) {\r\n    if (stat != null) {\r\n      delete state.temp.combatStatCache[target][stat];\r\n    } else {\r\n      for (let stat of valuesOf(CombatStat)) {\r\n        state = clearCombatStatCache(state, target, stat);\r\n      }\r\n    }\r\n  } else {\r\n    for (let target of valuesOf(AttackTarget)) {\r\n      state = clearCombatStatCache(state, target, stat);\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function explainPlayerCombatStat(\r\n  state: GameState,\r\n  stat: CombatStat,\r\n  explainParams?: Record<string, any>,\r\n) {\r\n  return explainTransformationsText(\r\n    playerStatTags(stat),\r\n    state,\r\n    BASE_VALUES[stat],\r\n    explainParams,\r\n  );\r\n}\r\n\r\nregisterTransformation(\r\n  [\r\n    [AttackTarget.Player, CombatStat.MaxHP],\r\n    [AttackTarget.Player, CombatStat.HPRegen],\r\n  ],\r\n  \"DebugInvincibility\",\r\n  t(\"Debug invincibility\"),\r\n  TransformationType.Addition,\r\n  (state) => {\r\n    if (hasFlag(state, \"debug_invincibility\")) {\r\n      return 99999999;\r\n    }\r\n    return 0;\r\n  },\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  \"DebugInsvincibility\",\r\n  t(\"Debug invincibility attack\"),\r\n  TransformationType.Addition,\r\n  (state) => {\r\n    if (hasFlag(state, \"debug_invincibility\")) {\r\n      return 99999999999;\r\n    }\r\n    return 0;\r\n  },\r\n);\r\n","import { GameStateTransform } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\n\r\nexport type OfflineTickTransform = (\r\n  secsPassed: number,\r\n) => GameStateTransform | null | undefined | void;\r\n\r\nexport class OfflineTickListener implements Identifiable {\r\n  id: string;\r\n  listener: OfflineTickTransform;\r\n\r\n  constructor(id: string, listener: OfflineTickTransform) {\r\n    this.id = id;\r\n    this.listener = listener;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getListener(): OfflineTickTransform {\r\n    return this.listener;\r\n  }\r\n}\r\n\r\nconst OfflineTickListeners = new DataStore<OfflineTickListener>();\r\n\r\nexport { OfflineTickListeners };\r\n","import { GameStateTransform } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\n\r\nexport type WarpTimeTransform = (\r\n  secsPassed: number,\r\n) => GameStateTransform | null | undefined | void;\r\n\r\nexport class WarpTimeListener implements Identifiable {\r\n  id: string;\r\n  listener: WarpTimeTransform;\r\n\r\n  constructor(id: string, listener: WarpTimeTransform) {\r\n    this.id = id;\r\n    this.listener = listener;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getListener(): WarpTimeTransform {\r\n    return this.listener;\r\n  }\r\n}\r\n\r\nconst WarpTimeListeners = new DataStore<WarpTimeListener>();\r\n\r\nexport { WarpTimeListeners };\r\n","import memoize from \"sonic-memoize\";\r\nimport { keysOf } from \"../../utils/CoreUtils\";\r\nimport { GameState, GameStateTransform } from \"../GameState\";\r\nimport { applyAllTransforms } from \"../GameStateListeners\";\r\nimport { applyTransformations } from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { OfflineTickListeners } from \"./OfflineTickListeners\";\r\nimport { WarpTimeListeners } from \"./WarpTimeListeners\";\r\n\r\ntype TimeTickListener = (\r\n  state: GameState,\r\n  timeElapsedSec: number,\r\n  isWarp: boolean,\r\n) => GameState;\r\n\r\nconst listeners: Record<\r\n  string,\r\n  { listener: TimeTickListener; priority: number }\r\n> = {};\r\n\r\nexport function nextFrame() {\r\n  return new Promise(function (resolve, reject) {\r\n    requestAnimationFrame(function () {\r\n      resolve(null);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n *\r\n * @param id\r\n * @param listener\r\n * @param priority Default priority is 0. Higher values run later. Lower values run earlier.\r\n */\r\nexport function registerTimeTickListener(\r\n  id: string,\r\n  listener: TimeTickListener,\r\n  priority?: number,\r\n) {\r\n  listeners[id] = { listener, priority: priority ?? 0 };\r\n}\r\n\r\nconst sortedListeners = memoize(() =>\r\n  keysOf(listeners)\r\n    .sort((idA, idB) => listeners[idA].priority - listeners[idB].priority)\r\n    .map((listenerId) => listeners[listenerId].listener),\r\n);\r\n\r\nconst gameSpeedTags = [TransformationTags.GameSpeed];\r\nexport function processTimeTick(\r\n  this: any,\r\n  timeElapsedSec: number,\r\n  isWarp: boolean,\r\n): GameStateTransform {\r\n  return (state) => {\r\n    const speedMultiplier = applyTransformations(gameSpeedTags, state, 1.0, {\r\n      isWarp: isWarp,\r\n    });\r\n    const timeElapsedSecAfterTransform = timeElapsedSec * speedMultiplier;\r\n    sortedListeners().forEach((listener) => {\r\n      state = listener(state, timeElapsedSecAfterTransform, isWarp);\r\n    });\r\n    return state;\r\n  };\r\n}\r\n\r\nconst WARP_TIME_PROCESSING_CONFIG_DEFAULT = {\r\n  secsPerTick: 0.25,\r\n};\r\n\r\nlet warpTimeProcessingConfig = WARP_TIME_PROCESSING_CONFIG_DEFAULT;\r\n\r\nexport function setWarpTimeSecsPerTick(secsPerTick: number): void {\r\n  warpTimeProcessingConfig = { secsPerTick: secsPerTick };\r\n}\r\n\r\nexport async function processOfflineTicks(\r\n  initialState: GameState,\r\n  secsTotal: number,\r\n  lastProcessedTime: number,\r\n  setPlayerState: (state: GameState) => void,\r\n): Promise<void> {\r\n  let currentState = initialState;\r\n  currentState.run.lastProcessedTime = lastProcessedTime;\r\n\r\n  OfflineTickListeners.getAll().forEach((listener) => {\r\n    const transform = listener.getListener()(secsTotal);\r\n    if (transform) {\r\n      currentState = transform(currentState);\r\n    }\r\n  });\r\n\r\n  setPlayerState(currentState);\r\n}\r\n\r\nexport async function processWarpTime(\r\n  initialState: GameState,\r\n  lastProcessedTime: () => number,\r\n  onLoadingProgress: (secsProcessedSoFar: number, ticksTotal: number) => void,\r\n  setPlayerState: (state: GameState) => void,\r\n): Promise<void> {\r\n  warpTimeProcessingConfig = WARP_TIME_PROCESSING_CONFIG_DEFAULT;\r\n  const secsTotal = initialState.run.warpTimeSecs;\r\n  let secsProcessedSoFar = 0;\r\n  let currentState = initialState;\r\n  onLoadingProgress(secsProcessedSoFar, secsTotal);\r\n  let ticksProcessedSoFar = 0;\r\n  while (secsProcessedSoFar < secsTotal) {\r\n    const speedMultiplier = applyTransformations(\r\n      gameSpeedTags,\r\n      currentState,\r\n      1.0,\r\n      { isWarp: true },\r\n    );\r\n    const secsPerTick =\r\n      warpTimeProcessingConfig.secsPerTick / Math.min(5, speedMultiplier);\r\n    const secsToProcess = Math.min(secsPerTick, secsTotal - secsProcessedSoFar);\r\n    currentState = applyAllTransforms(\r\n      currentState,\r\n      processTimeTick(secsToProcess, true),\r\n    );\r\n    secsProcessedSoFar += secsToProcess;\r\n    ticksProcessedSoFar += 1;\r\n    if ((ticksProcessedSoFar - 1) % 100 == 0) {\r\n      onLoadingProgress(secsProcessedSoFar, secsTotal);\r\n      await nextFrame();\r\n    }\r\n  }\r\n  currentState.run.lastProcessedTime = lastProcessedTime();\r\n  currentState.run.warpTimeSecs = 0;\r\n\r\n  WarpTimeListeners.getAll().forEach((listener) => {\r\n    const transform = listener.getListener()(secsTotal);\r\n    if (transform) {\r\n      currentState = transform(currentState);\r\n    }\r\n  });\r\n\r\n  setPlayerState(currentState);\r\n  onLoadingProgress(secsTotal, secsTotal);\r\n}\r\n","import { GameState } from \"../GameState\";\r\nimport { applyTransformations } from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { registerTimeTickListener } from \"./TimeTick\";\r\n\r\nexport function loadTotalTimePlayed() {\r\n  const gameSpeedTags = [TransformationTags.GameSpeed];\r\n  registerTimeTickListener(\r\n    \"TotalTimePlayed\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      state.global.secondsPlayed += timeElapsedSec;\r\n      state.world.secondsPlayed += timeElapsedSec;\r\n      state.run.secondsPlayed += timeElapsedSec;\r\n      if (!isWarp) {\r\n        // To calculate active play time we need to de-transform the timeElapsedSec\r\n        const speed = applyTransformations(gameSpeedTags, state, 1.0);\r\n        state.global.activeSecondsPlayed += timeElapsedSec / speed;\r\n        state.world.activeSecondsPlayed += timeElapsedSec / speed;\r\n        state.run.activeSecondsPlayed += timeElapsedSec / speed;\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n}\r\n\r\nexport function getTotalSecondsPlayed(state: GameState) {\r\n  return state.global.secondsPlayed || 0;\r\n}\r\n\r\nexport function getTotalActiveSecondsPlayed(state: GameState) {\r\n  return state.global.activeSecondsPlayed || 0;\r\n}\r\n\r\nexport function getSecondsPlayed(state: GameState) {\r\n  return state.run.secondsPlayed || 0;\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { fromEntries, keysOf } from \"../../utils/CoreUtils\";\r\nimport { cacheBySecondsPlayed } from \"../Caching\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { Action } from \"./Action\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"./ActionAreas\";\r\n\r\nexport const Actions = new DataStore<Action>();\r\n\r\nexport function getVisibleActionsForAreaBySubcategory(\r\n  state: GameState,\r\n  area: ActionArea,\r\n): Partial<Record<ActionSubcategories, Action[]>> {\r\n  return cacheBySecondsPlayed(\r\n    state,\r\n    \"visibleActionsBySubcategory\" + area,\r\n    (state) => {\r\n      const actionsBySubcategory = actionsByAreaAndSubcategory[area];\r\n      return fromEntries(\r\n        keysOf(actionsBySubcategory).map((subcategory) => {\r\n          return [\r\n            subcategory,\r\n            actionsBySubcategory[subcategory].filter((action) =>\r\n              action.isVisible(state),\r\n            ),\r\n          ];\r\n        }),\r\n      );\r\n    },\r\n  );\r\n}\r\n\r\nconst actionsByAreaAndSubcategory: Record<\r\n  ActionArea,\r\n  Partial<Record<ActionSubcategory, Action[]>>\r\n> = {\r\n  HOME: {},\r\n  SPELL_MENU: {},\r\n  STUDY: {},\r\n  TRANSMUTE: {},\r\n  EXPLORATION: {},\r\n  ENHANCEMENT: {},\r\n  BOOST: {},\r\n  FAMILIARS: {},\r\n};\r\n\r\nexport function registerAction(action: Action) {\r\n  if (Actions.getByIdNullable(action.getId()) != null) {\r\n    return;\r\n  }\r\n  Actions.register(action);\r\n  const areas = action.getAreas();\r\n  for (let area of keysOf(areas)) {\r\n    const subcategories = areas[area];\r\n    for (let subcategory of subcategories) {\r\n      if (actionsByAreaAndSubcategory[area][subcategory] == null) {\r\n        actionsByAreaAndSubcategory[area][subcategory] = [];\r\n      }\r\n      actionsByAreaAndSubcategory[area][subcategory].push(action);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getActionById(id: string) {\r\n  return Actions.getById(id);\r\n}\r\n\r\nexport function isAutoPurchaseUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.AutoPurchaseUnlocked);\r\n}\r\n\r\nexport const getAutoPurchaseActions = memoize(() =>\r\n  Actions.getAll().filter((action) => action.canAutoPurchaseMax()),\r\n);\r\n\r\nexport function loadActionsCommonLogic() {\r\n  registerTimeTickListener(\r\n    \"actionAutoPurchaseMax\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      const secondsPlayed = getSecondsPlayed(state);\r\n      if (\r\n        Math.floor(state.temp.lastAutoPurchaseRun) != Math.floor(secondsPlayed)\r\n      ) {\r\n        getAutoPurchaseActions().forEach((action) => {\r\n          if (state.run.autoPurchaseActions[action.getId()] ?? false) {\r\n            if (action.isEnabled(state)) {\r\n              state = action.doAction({ isAutomatic: true }, state);\r\n            }\r\n          }\r\n          return state;\r\n        });\r\n        state.temp.lastAutoPurchaseRun = secondsPlayed;\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import { fromEntries, keysOf, valuesOfCached } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActionArea, ActionSubcategory } from \"../action/ActionAreas\";\r\nimport { registerAction } from \"../action/Actions\";\r\nimport { cacheIndefinitely, clearCacheKey } from \"../Caching\";\r\nimport { createHypotheticalState, GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Resource } from \"../Resources\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  clearTransformationCache,\r\n  registerTransformation,\r\n  TransformationTag,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport {\r\n  getElementLevel,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedElements,\r\n  SpellElement,\r\n} from \"./Elements\";\r\nimport { Spell } from \"./Spell\";\r\nimport { clearVisibleSpellsCache } from \"./VisibleSpellsCache\";\r\n\r\nconst Spells = new DataStore<Spell>();\r\n\r\nexport function registerSpell(spell: Spell) {\r\n  Spells.register(spell);\r\n  registerAction(spell);\r\n}\r\n\r\nexport { Spells };\r\n\r\nexport function getAllSpellsByAscendingLevel(): Spell[] {\r\n  return Spells.getAll().sort(\r\n    (a, b) =>\r\n      Math.max(...valuesOfCached(a.getLevelRequirements())) -\r\n      Math.max(...valuesOfCached(b.getLevelRequirements())),\r\n  );\r\n}\r\n\r\nexport function getVisibleSpellsForArea(\r\n  state: GameState,\r\n  area: ActionArea,\r\n): Partial<Record<ActionSubcategory, Spell[]>> {\r\n  const spellsBySubcategory: Partial<Record<ActionSubcategory, Spell[]>> = {};\r\n  for (let spell of Spells.getAll()) {\r\n    if (\r\n      (area == null || spell.getAreas()?.[area] != null) &&\r\n      spell.isVisible(state)\r\n    ) {\r\n      for (let subcategory of spell.getAreas()[area] ?? []) {\r\n        if (spellsBySubcategory?.[subcategory] === undefined) {\r\n          spellsBySubcategory[subcategory] = [];\r\n        }\r\n        spellsBySubcategory[subcategory]?.push(spell);\r\n      }\r\n    }\r\n  }\r\n  return spellsBySubcategory;\r\n}\r\n\r\nexport function getVisibleSpellsByElement(\r\n  state: GameState,\r\n  area?: ActionArea,\r\n): Record<SpellElement, Spell[]> {\r\n  return cacheIndefinitely(\r\n    state,\r\n    (_state) => \"spellByElement:\" + (area ?? \"undefined\"),\r\n    (state) => {\r\n      const spellsByElement: Record<SpellElement, Spell[]> = fromEntries(\r\n        valuesOfCached(SpellElement).map((element) => [element, [] as Spell[]]),\r\n      );\r\n      const unlockedElements = getUnlockedElements(state);\r\n      for (let spell of Spells.getAll()) {\r\n        if (\r\n          (area == null || spell.getAreas()?.[area] != null) &&\r\n          spell.isVisible(state)\r\n        ) {\r\n          const elementRequirements = spell.getLevelRequirements();\r\n          for (let element in elementRequirements) {\r\n            if (!unlockedElements.includes(element as SpellElement)) {\r\n              continue;\r\n            }\r\n            if (spellsByElement?.[element] === undefined) {\r\n              spellsByElement[element] = [];\r\n            }\r\n            spellsByElement[element].push(spell);\r\n          }\r\n        }\r\n      }\r\n      for (let element of keysOf(spellsByElement)) {\r\n        if (spellsByElement[element].length === 0) {\r\n          delete spellsByElement[element];\r\n        } else {\r\n          spellsByElement[element].sort(\r\n            (a, b) =>\r\n              (b.getLevelRequirements()[element] || 0) -\r\n              (a.getLevelRequirements()[element] || 0),\r\n          );\r\n        }\r\n      }\r\n      return spellsByElement;\r\n    },\r\n  );\r\n}\r\n\r\nexport function getVisibleSpellsForElement(\r\n  state: GameState,\r\n  element: SpellElement,\r\n  area?: ActionArea,\r\n  extraLevels?: number,\r\n) {\r\n  if (!extraLevels) {\r\n    return getVisibleSpellsByElement(state, area)?.[element] || [];\r\n  }\r\n  const fakeState = createHypotheticalState(state);\r\n  fakeState.run.elementExperience[element] = getTotalExpRequiredForLevel(\r\n    fakeState,\r\n    getElementLevel(state, element) + extraLevels,\r\n    element,\r\n  );\r\n  return getVisibleSpellsByElement(fakeState, area)?.[element] || [];\r\n}\r\n\r\nexport function getSpellsForElementThatCanBeLearnedSoon(\r\n  state: GameState,\r\n  element: SpellElement,\r\n) {\r\n  const currentSpells = getVisibleSpellsForElement(state, element);\r\n  const otherUnlockedElements = getUnlockedElements(state).filter(\r\n    (unlockedElement) => unlockedElement != element,\r\n  );\r\n\r\n  let learnedSoon: Spell[] = [];\r\n\r\n  for (let elementIdx in otherUnlockedElements) {\r\n    const otherElement = otherUnlockedElements[elementIdx];\r\n    const fakeState = createHypotheticalState(state);\r\n    fakeState.run.elementExperience[otherElement] = getTotalExpRequiredForLevel(\r\n      fakeState,\r\n      getElementLevel(state, otherElement) + 1,\r\n      otherElement,\r\n    );\r\n    const soonVisibleSpells = getVisibleSpellsForElement(fakeState, element);\r\n    learnedSoon = learnedSoon.concat(\r\n      soonVisibleSpells.filter((spell) => !currentSpells.includes(spell)),\r\n    );\r\n  }\r\n\r\n  return learnedSoon;\r\n}\r\n\r\nexport function getRecentSpellsCast(state: GameState): Spell[] {\r\n  return (state.run.recentSpellsCast || [])\r\n    .map(Spells.getById)\r\n    .filter((spell) => spell != null);\r\n}\r\n\r\nexport function addRecentSpellCast(spell: Spell, state: GameState) {\r\n  const id = spell.getId();\r\n  state.run.recentSpellsCast = state.run.recentSpellsCast.filter(\r\n    (recentSpellName) => recentSpellName != id,\r\n  );\r\n  state.run.recentSpellsCast.unshift(id);\r\n  state.run.recentSpellsCast = state.run.recentSpellsCast.slice(0, 3);\r\n  return state;\r\n}\r\n\r\nexport function setLastCastedTime(spell: Spell, state: GameState) {\r\n  state.run.lastSpellCastTimes[spell.getId()] = getSecondsPlayed(state);\r\n  return state;\r\n}\r\n\r\nexport function getFavoriteSpells(state: GameState): Spell[] {\r\n  return state.run?.favoriteSpells?.map((id) => Spells.getById(id)) ?? [];\r\n}\r\n\r\nexport function addFavoriteSpell(state: GameState, spell: Spell): GameState {\r\n  if (isInFavoriteSpells(state, spell)) {\r\n    return state;\r\n  }\r\n  state.run.favoriteSpells.push(spell.getId());\r\n  return state;\r\n}\r\n\r\nexport function removeFromFavoriteSpells(\r\n  state: GameState,\r\n  spell: Spell,\r\n): GameState {\r\n  const index = state.run.favoriteSpells.findIndex(\r\n    (id) => spell.getId() === id,\r\n  );\r\n  if (index < 0) {\r\n    return state;\r\n  }\r\n  state.run.favoriteSpells.splice(index, 1);\r\n  return state;\r\n}\r\n\r\nexport function isInFavoriteSpells(state: GameState, spell: Spell): boolean {\r\n  return state.run.favoriteSpells.findIndex((id) => spell.getId() === id) >= 0;\r\n}\r\n\r\nexport function toggleEmpowered(state: GameState, spell: Spell): GameState {\r\n  const empowered = spell.isEmpowered(state);\r\n  state.run.empoweredSpells[spell.getId()] = !empowered;\r\n  state.temp.spellManaCostCache = {};\r\n  state.temp.spellExpCache = {};\r\n  state = callSpellCacheListeners(state);\r\n  return state;\r\n}\r\n\r\nconst spellCacheListeners = [];\r\n\r\nfunction callSpellCacheListeners(state: GameState): GameState {\r\n  for (let listener of spellCacheListeners) {\r\n    state = listener(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function registerSpellCacheClearedListener(\r\n  fn: (state: GameState) => GameState,\r\n) {\r\n  spellCacheListeners.push(fn);\r\n}\r\n\r\nexport function clearAutocastPointsCache(state: GameState): GameState {\r\n  state.temp.autocastPointsRequirementCache = {};\r\n  return callSpellCacheListeners(state);\r\n}\r\n\r\nexport function registerAutocastPointsClearer(\r\n  id: string,\r\n  valueFn: (state: GameState) => any,\r\n) {\r\n  addGameStateListener(\r\n    id + \"-autocastPointsClearer\",\r\n    (state) => {\r\n      return clearAutocastPointsCache;\r\n    },\r\n    valueFn,\r\n  );\r\n}\r\n\r\nexport function clearManaCostCache(state: GameState): GameState {\r\n  state.temp.spellManaCostCache = {};\r\n  state.temp.spellExpCache = {};\r\n  return callSpellCacheListeners(state);\r\n}\r\n\r\nexport function registerManaCostClearer(\r\n  id: string,\r\n  valueFn: (state: GameState) => any,\r\n) {\r\n  addGameStateListener(\r\n    id + \"-ManaCostClearer\",\r\n    (state) => {\r\n      return clearManaCostCache;\r\n    },\r\n    valueFn,\r\n  );\r\n}\r\n\r\nexport function clearCanCastSpellCache(state: GameState): GameState {\r\n  state = clearTransformationCache(\r\n    new Set([TransformationTags.CanCastSpell]),\r\n    state,\r\n  );\r\n  return callSpellCacheListeners(state);\r\n}\r\n\r\nexport function registerCanCastSpellClearer(\r\n  id: string,\r\n  valueFn: (state: GameState) => any,\r\n) {\r\n  addGameStateListener(\r\n    id + \"-CanCastSpellClearer\",\r\n    (state) => {\r\n      return clearCanCastSpellCache;\r\n    },\r\n    valueFn,\r\n  );\r\n}\r\n\r\nexport function clearSpellCooldownCache(state: GameState): GameState {\r\n  state = clearTransformationCache(\r\n    new Set([TransformationTags.SpellCooldown]),\r\n    state,\r\n  );\r\n  return callSpellCacheListeners(state);\r\n}\r\n\r\nexport function registerSpellCooldownClearer(\r\n  id: string,\r\n  valueFn: (state: GameState) => any,\r\n) {\r\n  addGameStateListener(\r\n    id + \"-spellCooldownCapClearer\",\r\n    (state) => clearSpellCooldownCache,\r\n    valueFn,\r\n  );\r\n}\r\n\r\nexport function clearSpellDurationCache(state: GameState): GameState {\r\n  for (let key of state.temp.cache.keys()) {\r\n    if (key.startsWith(\"minAutocastDelayDuration\")) {\r\n      state = clearCacheKey(state, () => key);\r\n    }\r\n  }\r\n  return callSpellCacheListeners(state);\r\n}\r\n\r\nexport function clearAllSpellCaches(state: GameState): GameState {\r\n  state = clearSpellCooldownCache(state);\r\n  state = clearCanCastSpellCache(state);\r\n  state = clearManaCostCache(state);\r\n  state = clearAutocastPointsCache(state);\r\n  state = clearVisibleSpellsCache(state);\r\n  state = clearSpellDurationCache(state);\r\n  return state;\r\n}\r\n\r\nexport function registerEmpowerEffects(\r\n  spell: Spell,\r\n  tags: TransformationTag[],\r\n  multiplier: number,\r\n) {\r\n  registerTransformation(\r\n    [[spell.getId(), ...tags]],\r\n    spell.getId() + \"empowered\" + tags.join(),\r\n    t(\"Spell Empowering\"),\r\n    TransformationType.Multiplier,\r\n    (state) => (spell.isEmpowered(state) ? multiplier : 1),\r\n  );\r\n}\r\n\r\nexport function registerStandardEmpowerEffects(\r\n  spell: Spell,\r\n  actionEffectMultiplier: number,\r\n  manaCostMultiplier: number,\r\n) {\r\n  registerEmpowerEffects(\r\n    spell,\r\n    [TransformationTags.ActionEffect],\r\n    actionEffectMultiplier,\r\n  );\r\n  registerEmpowerEffects(\r\n    spell,\r\n    [TransformationTags.Cost, Resource.Mana],\r\n    manaCostMultiplier,\r\n  );\r\n}\r\n\r\nexport function registerBuffEmpowerEffects(\r\n  spell: Spell,\r\n  effectMagnitudeMultiplier: number,\r\n  manaCostMultiplier: number,\r\n) {\r\n  registerEmpowerEffects(\r\n    spell,\r\n    [TransformationTags.TemporaryEffectMagnitude],\r\n    effectMagnitudeMultiplier,\r\n  );\r\n  registerEmpowerEffects(\r\n    spell,\r\n    [TransformationTags.Cost, Resource.Mana],\r\n    manaCostMultiplier,\r\n  );\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { GameState, ResearcherAutoAssignStrategy } from \"../GameState\";\r\nimport {\r\n  SpellElement,\r\n  getElementLevel,\r\n  getMaxElementLevel,\r\n  getPrimaryElements,\r\n  getUnlockedElements,\r\n} from \"../spells/Elements\";\r\n\r\nexport function translateResearcherAutoAssignStrategy(\r\n  strategy: ResearcherAutoAssignStrategy,\r\n): string {\r\n  switch (strategy) {\r\n    case ResearcherAutoAssignStrategy.OFF:\r\n      return t(\"Off\");\r\n    case ResearcherAutoAssignStrategy.SPREAD_EVENLY:\r\n      return t(\"Spread evenly\");\r\n    case ResearcherAutoAssignStrategy.HIGHEST_AMOUNT:\r\n      return t(\"Most researchers\");\r\n    case ResearcherAutoAssignStrategy.SPREAD_THEN_HIGHEST:\r\n      return t(\"Spread, then most researchers\");\r\n  }\r\n}\r\n\r\nexport function decideOnAutoAssigning(\r\n  state: GameState,\r\n): SpellElement | undefined {\r\n  const elements = getUnlockedElements(state);\r\n  const strategy = state.options.researcherAutoAssignStrategy;\r\n\r\n  // First, check if any elements have no researchers\r\n  if (strategy == ResearcherAutoAssignStrategy.SPREAD_THEN_HIGHEST) {\r\n    for (let element of elements) {\r\n      const assignedResearchers = state.run.studyAllocation[element];\r\n      if (\r\n        assignedResearchers == 0 &&\r\n        getElementLevel(state, element) < getMaxElementLevel(state)\r\n      ) {\r\n        return element;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Then, assign them to that which has the most\r\n  if (\r\n    strategy == ResearcherAutoAssignStrategy.SPREAD_THEN_HIGHEST ||\r\n    strategy == ResearcherAutoAssignStrategy.HIGHEST_AMOUNT\r\n  ) {\r\n    let maxElement = null;\r\n    let maxElementResearchers = 0;\r\n    for (let element of elements) {\r\n      const assignedResearchers = state.run.studyAllocation[element];\r\n      if (\r\n        assignedResearchers > maxElementResearchers &&\r\n        getElementLevel(state, element) < getMaxElementLevel(state)\r\n      ) {\r\n        maxElement = element;\r\n        maxElementResearchers = assignedResearchers;\r\n      } else if (\r\n        assignedResearchers == maxElementResearchers &&\r\n        getPrimaryElements(state).includes(element) &&\r\n        getElementLevel(state, element) < getMaxElementLevel(state)\r\n      ) {\r\n        maxElement = element;\r\n      }\r\n    }\r\n\r\n    return maxElement;\r\n  }\r\n\r\n  // Or maybe to that which has the least\r\n  if (strategy == ResearcherAutoAssignStrategy.SPREAD_EVENLY) {\r\n    let minElement = null;\r\n    let minElementResearchers = 1e99;\r\n    for (let element of elements) {\r\n      const assignedResearchers = state.run.studyAllocation[element];\r\n      if (\r\n        assignedResearchers < minElementResearchers &&\r\n        getElementLevel(state, element) < getMaxElementLevel(state)\r\n      ) {\r\n        minElement = element;\r\n        minElementResearchers = assignedResearchers;\r\n      } else if (\r\n        assignedResearchers == minElementResearchers &&\r\n        getPrimaryElements(state).includes(element) &&\r\n        getElementLevel(state, element) < getMaxElementLevel(state)\r\n      ) {\r\n        minElement = element;\r\n      }\r\n    }\r\n\r\n    return minElement;\r\n  }\r\n}\r\n","import { fromEntries, keysOf, valuesOf } from \"../../utils/CoreUtils\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasFlag } from \"../Flags\";\r\nimport {\r\n  GameState,\r\n  GameStateTransform,\r\n  ResearcherAutoAssignStrategy,\r\n} from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport {\r\n  SpellElement,\r\n  getUnlockedElements,\r\n  grantElementExp,\r\n} from \"../spells/Elements\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { decideOnAutoAssigning } from \"./ResearcherAutoAssignStrategy\";\r\n\r\nfunction onTick(state: GameState, elapsedTimeSec: number): GameState {\r\n  const expPerSec = getResearcherExpPerSecForElements(state);\r\n  for (let element in expPerSec) {\r\n    state = grantElementExp(\r\n      element as SpellElement,\r\n      (expPerSec?.[element as SpellElement] ?? 0) * elapsedTimeSec,\r\n    )(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport const BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER = 3.0;\r\n\r\nexport const expGainTagsCache = fromEntries(\r\n  valuesOf(SpellElement).map((element) => [\r\n    element,\r\n    [element, TransformationTags.ExpGain, TransformationTags.Study],\r\n  ]),\r\n);\r\n\r\nexport function getResearcherExpPerSecAndResearcher(\r\n  state: GameState,\r\n): Partial<Record<SpellElement, number>> {\r\n  const researchRates: Partial<Record<SpellElement, number>> = {};\r\n  for (let element of getUnlockedElements(state)) {\r\n    const researchRatePerResearcher = applyTransformations(\r\n      expGainTagsCache[element],\r\n      state,\r\n      BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER,\r\n      { fromResearch: true },\r\n    );\r\n    researchRates[element] = researchRatePerResearcher;\r\n  }\r\n  return researchRates;\r\n}\r\n\r\nexport function getResearcherExpPerSecForElements(\r\n  state: GameState,\r\n): Partial<Record<SpellElement, number>> {\r\n  let value = state.temp.researchPerSecCache;\r\n  if (value == null) {\r\n    const researcherAllocation = state.run.studyAllocation;\r\n    const totalExpPerSec: Partial<Record<SpellElement, number>> = {};\r\n    for (let element of keysOf(researcherAllocation)) {\r\n      const allocatedResearchers = researcherAllocation[element] || 0;\r\n      if (allocatedResearchers > 0) {\r\n        const researchRatePerResearcher = applyTransformations(\r\n          expGainTagsCache[element],\r\n          state,\r\n          BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER,\r\n          { fromResearch: true },\r\n        );\r\n        totalExpPerSec[element] =\r\n          researchRatePerResearcher * allocatedResearchers;\r\n      }\r\n    }\r\n    value = totalExpPerSec;\r\n    state.temp.researchPerSecCache = value;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function clearResearcherExpCache(state: GameState) {\r\n  state.temp.researchPerSecCache = undefined;\r\n  return state;\r\n}\r\n\r\nconst expGainStudyTags = [TransformationTags.ExpGain, TransformationTags.Study];\r\n\r\nexport function getBaseResearchRate(state: GameState) {\r\n  return applyTransformations(\r\n    expGainStudyTags,\r\n    state,\r\n    BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER,\r\n  );\r\n}\r\n\r\nexport function explainBaseResearchRate(state: GameState) {\r\n  return explainTransformationsText(\r\n    expGainStudyTags,\r\n    state,\r\n    BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER,\r\n  );\r\n}\r\n\r\nconst researcherAmountTags = [TransformationTags.ResearcherAmount];\r\n\r\nexport function getTotalResearchers(state: GameState) {\r\n  return applyTransformations(researcherAmountTags, state, 1);\r\n}\r\n\r\nexport function getFreeResearchers(state: GameState): number {\r\n  const researcherAllocation = state.run.studyAllocation;\r\n  let researchersAllocated = 0;\r\n  for (let element of keysOf(researcherAllocation)) {\r\n    researchersAllocated += researcherAllocation[element] || 0;\r\n  }\r\n  return getTotalResearchers(state) - researchersAllocated;\r\n}\r\n\r\nfunction allocateResearchersToElementImpl(\r\n  element: SpellElement,\r\n  amount: number,\r\n  state: GameState,\r\n) {\r\n  const currentAllocation = state.run.studyAllocation[element] || 0;\r\n  const actualAmountToAllocate =\r\n    amount > 0\r\n      ? Math.min(getFreeResearchers(state), amount)\r\n      : Math.max(-currentAllocation, amount);\r\n  state.run.studyAllocation[element] =\r\n    currentAllocation + actualAmountToAllocate;\r\n  if (amount < 0) {\r\n    state.options.researcherAutoAssignStrategy =\r\n      ResearcherAutoAssignStrategy.OFF;\r\n  }\r\n  state = clearResearcherExpCache(state);\r\n  return state;\r\n}\r\n\r\nexport function allocateResearchersToElement(\r\n  this: any,\r\n  element: SpellElement,\r\n  amount: number,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return allocateResearchersToElementImpl.bind(this, element, amount);\r\n}\r\n\r\nexport function isStudyUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.StudyUnlocked);\r\n}\r\n\r\nexport function isStudyEverUnlocked(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.StudyUnlocked);\r\n}\r\n\r\nexport function loadResearchers(): void {\r\n  registerTimeTickListener(\"Researchers\", onTick);\r\n\r\n  addGameStateListener(\"researcherAssignerOrRemover\", (state) => {\r\n    const freeResearchers = getFreeResearchers(state);\r\n    if (freeResearchers < 0) {\r\n      return (state: GameState) => {\r\n        let freeResearchers = getFreeResearchers(state);\r\n        const elements = getUnlockedElements(state);\r\n        const elementLength = elements.length;\r\n        let currentElementIdx = elementLength - 1;\r\n        while (freeResearchers < 0 && currentElementIdx >= 0) {\r\n          const element = elements[currentElementIdx];\r\n          const assignedResearchers = state.run.studyAllocation[element];\r\n          if (assignedResearchers > 0) {\r\n            state = allocateResearchersToElement(element, -1)(state);\r\n            freeResearchers++;\r\n          } else {\r\n            currentElementIdx--;\r\n          }\r\n        }\r\n        return state;\r\n      };\r\n    } else if (\r\n      freeResearchers > 0 &&\r\n      state.options.researcherAutoAssignStrategy !=\r\n        ResearcherAutoAssignStrategy.OFF\r\n    ) {\r\n      return (state: GameState) => {\r\n        let freeResearchers = getFreeResearchers(state);\r\n        while (freeResearchers > 0) {\r\n          const elementToAssign = decideOnAutoAssigning(state);\r\n          if (elementToAssign == null) {\r\n            // Usually means all elements maxed\r\n            state.options.researcherAutoAssignStrategy =\r\n              ResearcherAutoAssignStrategy.OFF;\r\n            return state;\r\n          }\r\n          state = allocateResearchersToElement(elementToAssign, 1)(state);\r\n          freeResearchers--;\r\n        }\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { cacheByTickCount } from \"../Caching\";\r\nimport { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../Resources\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { registerTimeTickListener } from \"./TimeTick\";\r\n\r\nexport type IncomeOverTimeCalculator = (\r\n  state: GameState,\r\n) => Partial<Record<Resource, number>>;\r\n\r\n// If something produces (or consumes) income over time,\r\n// register it here. This will make it visible in the UI later.\r\nexport class IncomeOverTimeProducer implements Identifiable {\r\n  id: string;\r\n  displayName: string;\r\n  calculator: IncomeOverTimeCalculator;\r\n\r\n  constructor(\r\n    id: string,\r\n    displayName: string,\r\n    calculator: IncomeOverTimeCalculator,\r\n  ) {\r\n    this.id = id;\r\n    this.displayName = displayName;\r\n    this.calculator = calculator;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return this.displayName;\r\n  }\r\n\r\n  getCalculator(): IncomeOverTimeCalculator {\r\n    return this.calculator;\r\n  }\r\n}\r\n\r\nconst IncomeOverTimeProducers = new DataStore<IncomeOverTimeProducer>();\r\n\r\n// This method does not apply income if the resource is capped,\r\n// which is a \"smarter\" behavior.\r\nfunction onTick(state: GameState, elapsedTimeSec: number): GameState {\r\n  const incomes = IncomeOverTimeProducers.getAll().map((producer) =>\r\n    producer.getCalculator()(state),\r\n  );\r\n\r\n  let changed = false;\r\n  const incomeSet = new Set(incomes);\r\n  const appliedTotals: Partial<Record<Resource, number>> = {};\r\n  const appliedIncomes = new Set<Partial<Record<Resource, number>>>();\r\n  do {\r\n    changed = false;\r\n    for (let resString of Object.values(Resource)) {\r\n      const resource = resString as Resource;\r\n      if (\r\n        getResourceAmount(state, resource) + (appliedTotals?.[resource] ?? 0) <\r\n        getResourceCap(state, resource)\r\n      ) {\r\n        // Apply all incomes for this resource\r\n        const incomesThatHaveResource = Array.from(incomeSet).filter(\r\n          (income) => (income?.[resource] ?? 0) > 0,\r\n        );\r\n        incomesThatHaveResource.forEach((income) => {\r\n          let canApply = true;\r\n          for (let subResString in income) {\r\n            const subResource = subResString as Resource;\r\n            const subResourceIncome =\r\n              (income[subResource] ?? 0) * elapsedTimeSec;\r\n            if (\r\n              subResourceIncome < 0 &&\r\n              getResourceAmount(state, subResource) +\r\n                (appliedTotals?.[subResource] ?? 0) <\r\n                -subResourceIncome\r\n            ) {\r\n              canApply = false;\r\n            }\r\n          }\r\n          if (canApply) {\r\n            appliedIncomes.add(income);\r\n            for (let subResString in income) {\r\n              const subResource = subResString as Resource;\r\n              appliedTotals[subResource] =\r\n                (appliedTotals?.[subResource] ?? 0) +\r\n                (income[subResource] ?? 0) * elapsedTimeSec;\r\n            }\r\n          }\r\n        });\r\n        if (appliedIncomes.size > 0) {\r\n          appliedIncomes.forEach((appliedIncome) =>\r\n            incomeSet.delete(appliedIncome),\r\n          );\r\n          appliedIncomes.clear();\r\n          changed = true;\r\n        }\r\n      }\r\n    }\r\n  } while (changed && incomeSet.size > 0);\r\n\r\n  // Now we have calculated the total incomes, grant the resources\r\n  for (let resString in appliedTotals) {\r\n    if ((appliedTotals?.[resString as Resource] ?? 0) != 0) {\r\n      state = grantResource(\r\n        resString as Resource,\r\n        appliedTotals?.[resString as Resource] ?? 0,\r\n      )(state);\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nfunction calculatedIncomeCached(\r\n  state: GameState,\r\n  producerId: string,\r\n  readCacheOnly: boolean,\r\n): Partial<Record<Resource, number>> | null {\r\n  let value = state.temp.incomeOverTimeCache[producerId];\r\n  if (readCacheOnly) {\r\n    return value;\r\n  }\r\n  if (value == null) {\r\n    value = IncomeOverTimeProducers.getById(producerId).getCalculator()(state);\r\n    state.temp.incomeOverTimeCache[producerId] = value;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function clearCalculatedIncomeCache(state: GameState): GameState {\r\n  state.temp.incomeOverTimeCache = {};\r\n  return state;\r\n}\r\n\r\nfunction calculatedIncomesCached(\r\n  state: GameState,\r\n  readCacheOnly: boolean,\r\n): { displayName: string; income: Partial<Record<Resource, number>> }[] {\r\n  return cacheByTickCount(\r\n    state,\r\n    \"incomePerSec\",\r\n    (state) =>\r\n      IncomeOverTimeProducers.getAll().map((producer) => ({\r\n        income: calculatedIncomeCached(state, producer.getId(), readCacheOnly),\r\n        displayName: producer.getDisplayName(),\r\n      })),\r\n    readCacheOnly,\r\n  );\r\n}\r\n\r\nconst finalIncomeTags = memoize((resource) => [\r\n  TransformationTags.FinalIncomePerSec,\r\n  resource,\r\n]);\r\n\r\n// This method applies all incomes even if resources are capped.\r\nfunction onTickApplyAll(state: GameState, elapsedTimeSec: number): GameState {\r\n  if (elapsedTimeSec <= 0) {\r\n    return state;\r\n  }\r\n\r\n  const incomes = calculatedIncomesCached(state, false);\r\n\r\n  const appliedTotals: Partial<Record<Resource, number>> = {};\r\n  for (let income of incomes) {\r\n    let canApply = true;\r\n    for (let subResString in income.income) {\r\n      const subResource = subResString as Resource;\r\n      const subResourceIncome =\r\n        (income.income[subResource] ?? 0) * elapsedTimeSec;\r\n      if (\r\n        subResourceIncome < 0 &&\r\n        getResourceAmount(state, subResource) < -subResourceIncome\r\n      ) {\r\n        canApply = false;\r\n      }\r\n    }\r\n\r\n    if (canApply) {\r\n      for (let subResString in income.income) {\r\n        const subResource = subResString as Resource;\r\n        const subResourceIncome =\r\n          (income.income[subResource] ?? 0) * elapsedTimeSec;\r\n        appliedTotals[subResource] =\r\n          (appliedTotals?.[subResource] ?? 0) + subResourceIncome;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Transform the totals\r\n  for (let resource in appliedTotals) {\r\n    appliedTotals[resource as Resource] =\r\n      applyTransformations(\r\n        finalIncomeTags(resource),\r\n        state,\r\n        (appliedTotals[resource as Resource] ?? 0) / elapsedTimeSec,\r\n      ) * elapsedTimeSec;\r\n  }\r\n\r\n  // Now we have calculated the total incomes, grant the resources\r\n  for (let resString in appliedTotals) {\r\n    if ((appliedTotals?.[resString as Resource] ?? 0) != 0) {\r\n      state = grantResource(\r\n        resString as Resource,\r\n        appliedTotals?.[resString as Resource] ?? 0,\r\n      )(state);\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\n// Lower priority listener as otherwise mana bar doesn't fully fill\r\nregisterTimeTickListener(\"IncomeOverTime\", onTickApplyAll, 10);\r\n\r\n// Only use for display purposes\r\nexport function calculateIncomePerSecond(\r\n  state: GameState,\r\n): Partial<Record<Resource, number>> {\r\n  return cacheByTickCount(state, \"incomePerSecondDisplay\", (state) => {\r\n    let total: Partial<Record<Resource, number>> = {};\r\n    const incomes = calculatedIncomesCached(state, true);\r\n    incomes.forEach((income) => {\r\n      let canApply = true;\r\n      for (let subResString in income.income) {\r\n        const subResource = subResString as Resource;\r\n        const subResourceIncome = (income.income[subResource] ?? 0) * 0.5;\r\n        if (\r\n          subResourceIncome < 0 &&\r\n          getResourceAmount(state, subResource) < -subResourceIncome\r\n        ) {\r\n          canApply = false;\r\n        }\r\n      }\r\n\r\n      // Skip incomes that cannot be applied unless they are negative\r\n      for (let resString in income.income) {\r\n        const resource = resString as Resource;\r\n        const existingIncome = total?.[resource] ?? 0;\r\n        if (canApply || (income.income?.[resource] ?? 0) < 0) {\r\n          total[resource] = existingIncome + (income.income?.[resource] ?? 0);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Transform the totals\r\n    for (let resource in total) {\r\n      total[resource as Resource] = applyTransformations(\r\n        finalIncomeTags(resource),\r\n        state,\r\n        total[resource as Resource] ?? 0,\r\n      );\r\n    }\r\n    return total;\r\n  });\r\n}\r\n\r\nexport function explainIncomePerSecondPreTransform(\r\n  state: GameState,\r\n): Partial<Record<Resource, { displayName: string; income: number }[]>> {\r\n  let total: Partial<\r\n    Record<Resource, { displayName: string; income: number }[]>\r\n  > = {};\r\n  const incomes = calculatedIncomesCached(state, true);\r\n  incomes.forEach((income) => {\r\n    let canApply = true;\r\n    let foundNonzero = false;\r\n    for (let subResString in income.income) {\r\n      const subResource = subResString as Resource;\r\n      const subResourceIncome = (income.income[subResource] ?? 0) * 0.5;\r\n      if (\r\n        subResourceIncome < 0 &&\r\n        getResourceAmount(state, subResource) < -subResourceIncome\r\n      ) {\r\n        canApply = false;\r\n      }\r\n      if (subResourceIncome != 0) {\r\n        foundNonzero = true;\r\n      }\r\n    }\r\n\r\n    if (foundNonzero) {\r\n      for (let resString in income.income) {\r\n        const resource = resString as Resource;\r\n        const existingIncome = total?.[resource] ?? [];\r\n        if (canApply || (income.income?.[resource] ?? 0) < 0) {\r\n          existingIncome.push({\r\n            income: income.income?.[resource],\r\n            displayName: income.displayName,\r\n          });\r\n        }\r\n        total[resource] = existingIncome;\r\n      }\r\n    }\r\n  });\r\n\r\n  return total;\r\n}\r\n\r\nexport function explainIncomePerSecText(\r\n  state: GameState,\r\n): Partial<Record<Resource, string>> {\r\n  const explanations = explainIncomePerSecondPreTransform(state);\r\n\r\n  function toTextAddition(result: {\r\n    displayName: string;\r\n    income: number | undefined;\r\n  }) {\r\n    return t(\"{{amount}}/s ({{description}})\", {\r\n      amount:\r\n        result.income > 0\r\n          ? \"+\" + formatNumber(result.income)\r\n          : formatNumber(result.income),\r\n      description: result.displayName,\r\n    });\r\n  }\r\n\r\n  const total = {};\r\n  // Transform the totals\r\n  for (let resource in explanations) {\r\n    const values = explanations[resource] as {\r\n      displayName: string;\r\n      income: number;\r\n    }[];\r\n    const valuesText = values\r\n      .map((value) => toTextAddition(value))\r\n      .join(t(\", \"));\r\n\r\n    const postTransformationExplanation = explainTransformationsText(\r\n      finalIncomeTags(resource),\r\n      state,\r\n      total[resource as Resource] ?? 0,\r\n    );\r\n\r\n    if (postTransformationExplanation != \"\") {\r\n      total[resource as Resource] = t(\r\n        \"{{valuesText}}; and further changed by: {{postTransformationExplanation}}\",\r\n        { valuesText, postTransformationExplanation },\r\n      );\r\n    } else {\r\n      total[resource as Resource] = valuesText;\r\n    }\r\n  }\r\n  return total;\r\n}\r\n\r\nexport { IncomeOverTimeProducers };\r\n","import { t } from \"../../utils/I18n\";\r\nimport { GameState, GameStateTransform } from \"../GameState\";\r\nimport {\r\n  addToInventory,\r\n  getAmountOfItem,\r\n  removeFromInventory,\r\n} from \"./Inventory\";\r\nimport { ItemAction, ItemOccurrence } from \"./Item\";\r\n\r\nimport bind from \"memoize-bind\";\r\nimport { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { clearResourceCapCache } from \"../Resources\";\r\nimport { clearCombatStatCache } from \"../exploration/CombatStats\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { clearAllSpellCaches } from \"../spells/Spells\";\r\nimport { clearResearcherExpCache } from \"../study/Study\";\r\nimport { clearCalculatedIncomeCache } from \"../timetick/IncomeOverTime\";\r\nimport { applyTransformationsCached } from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { Items } from \"./Items\";\r\nimport { EquippableItem } from \"./equipment/EquippableItem\";\r\nimport { PouchItem } from \"./equipment/PouchItem\";\r\n\r\nexport enum EquipmentSlot {\r\n  Hand = \"Hand\",\r\n  Body = \"Body\",\r\n  Accessory = \"Accessory\",\r\n  Pouch = \"Pouch\",\r\n}\r\n\r\nexport function translateEquipmentSlot(slot: EquipmentSlot): string {\r\n  switch (slot) {\r\n    case EquipmentSlot.Hand:\r\n      return t(\"Hand\");\r\n    case EquipmentSlot.Body:\r\n      return t(\"Body\");\r\n    case EquipmentSlot.Accessory:\r\n      return t(\"Accessory\");\r\n    case EquipmentSlot.Pouch:\r\n      return t(\"Pouch\");\r\n  }\r\n}\r\n\r\nconst POUCH_SIZE_TAGS = [TransformationTags.PouchSize];\r\nconst ACCESSORY_SIZE_TAGS = [TransformationTags.AccessorySize];\r\n\r\nexport function getMaxEquippedItemsPerSlot(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n): number {\r\n  if (slot == EquipmentSlot.Pouch) {\r\n    return applyTransformationsCached(POUCH_SIZE_TAGS, state, 4);\r\n  }\r\n  if (slot == EquipmentSlot.Accessory) {\r\n    return applyTransformationsCached(ACCESSORY_SIZE_TAGS, state, 1);\r\n  }\r\n  return 1;\r\n}\r\n\r\nexport function canUnequipItem(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n  index: number,\r\n): boolean {\r\n  const items = getEquippedItems(state, slot);\r\n  if (items.length <= index) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function canEquipItem(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n  item: ItemOccurrence,\r\n): boolean {\r\n  if (getAmountOfItem(item, state) <= 0) {\r\n    return false;\r\n  }\r\n\r\n  if (getMaxEquippedItemsPerSlot(state, slot) == 0) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport const EquipmentChangeListeners = new DataStore<\r\n  (state: GameState) => GameState\r\n>();\r\n\r\nexport function equipToSlot(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n  item: ItemOccurrence,\r\n  position?: number,\r\n  skipSave?: boolean,\r\n): GameState {\r\n  if (!canEquipItem(state, slot, item)) {\r\n    return state;\r\n  }\r\n\r\n  const actualItem = Items.getById(item.itemId) as EquippableItem;\r\n\r\n  const extraSlots = actualItem.getExtraSlots();\r\n\r\n  const capacity = getMaxEquippedItemsPerSlot(state, slot);\r\n  const equippedItems = getEquippedItems(state, slot);\r\n\r\n  const equippedExtraSlotItem = getEquippedExtraSlotItem(state, slot, position);\r\n\r\n  if (position == null) {\r\n    // If we are under capacity, just push it to the end\r\n    let done = false;\r\n    for (\r\n      let i = equippedExtraSlotItem != null && capacity > 1 ? 1 : 0;\r\n      i < capacity;\r\n      i++\r\n    ) {\r\n      if (equippedItems?.[i] == null) {\r\n        position = i;\r\n        done = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!done) {\r\n      position =\r\n        equippedExtraSlotItem != null &&\r\n        capacity > 1 &&\r\n        slot != EquipmentSlot.Pouch\r\n          ? 1\r\n          : 0;\r\n    }\r\n  }\r\n\r\n  if (slot != EquipmentSlot.Pouch) {\r\n    // If there is already any slot that has this item, force position\r\n    // to be that item\r\n    // (cannot have 2 accessories of the same kind equipped)\r\n    for (let i = 0; i < capacity; i++) {\r\n      if (\r\n        equippedItems?.[i] != null &&\r\n        equippedItems[i].itemId == item.itemId\r\n      ) {\r\n        position = i;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // We unequip the item from the slot\r\n  state = unequipFromSlotImpl(slot, position, skipSave, state);\r\n  // Whatever we do, we must also remove the *first* item from any extra slots\r\n  for (let extraSlot of extraSlots) {\r\n    state = unequipFromSlotImpl(extraSlot, 0, skipSave, state);\r\n  }\r\n\r\n  // Then equip it\r\n  equippedItems[position] = item;\r\n  state.run.equipment[slot] = equippedItems;\r\n  // And then finally remove from inventory\r\n  state = removeFromInventory(item, 1, state);\r\n  // And finally, if it's a pouch item, we mark it used\r\n  if (slot == EquipmentSlot.Pouch) {\r\n    state.run.exploration.pouchItemsUsesLeft[position] = 0;\r\n  }\r\n\r\n  if (!skipSave) {\r\n    state = saveEquipmentLoadoutToPosition(\r\n      state,\r\n      state.run.lastEquipmentLoadoutModified,\r\n    );\r\n  }\r\n\r\n  // We must clear all combat caches.\r\n  // This is because equipment can have complex interactions. For example,\r\n  // the Synergizer increases the effect of other equipment.\r\n  state = clearCombatStatCache(state);\r\n  state = clearResourceCapCache(state);\r\n  state = clearCalculatedIncomeCache(state);\r\n  state = clearResearcherExpCache(state);\r\n  state = clearAllSpellCaches(state);\r\n\r\n  EquipmentChangeListeners.getAll().forEach((listener) => {\r\n    state = listener(state);\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\nexport function getEquippedItem(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n  position?: number,\r\n): ItemOccurrence | undefined {\r\n  const item = state.run.equipment?.[slot];\r\n  return item?.[position ?? 0];\r\n}\r\n\r\nexport function getEquippedItems(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n): ItemOccurrence[] {\r\n  const items = state.run.equipment?.[slot] ?? [];\r\n  return items;\r\n}\r\n\r\nexport function getEquippedExtraSlotItem(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n  position?: number,\r\n): ItemOccurrence | undefined {\r\n  const equipped = getEquippedItem(state, slot, position);\r\n  if (equipped || (position ?? 0) > 0) {\r\n    return equipped;\r\n  }\r\n\r\n  for (let otherSlot of valuesOf(EquipmentSlot)) {\r\n    const capacity = getMaxEquippedItemsPerSlot(state, slot);\r\n    for (let i = 0; i < capacity; i++) {\r\n      const equippedItem = getEquippedItem(state, otherSlot, i);\r\n      if (equippedItem) {\r\n        const equippedActualItem = Items.getById(\r\n          equippedItem.itemId,\r\n        ) as EquippableItem;\r\n        if (equippedActualItem.getExtraSlots().includes(slot)) {\r\n          return equippedItem;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction unequipFromSlotImpl(\r\n  slot: EquipmentSlot,\r\n  position: number,\r\n  skipSave: boolean,\r\n  state: GameState,\r\n): GameState {\r\n  let item = getEquippedItem(state, slot, position);\r\n  if (!item) {\r\n    // Check if there might be another equipment item with this as its extra slot\r\n    item = getEquippedExtraSlotItem(state, slot, position);\r\n    if (!item) {\r\n      return state;\r\n    }\r\n  }\r\n\r\n  const actualItem = Items.getById(item.itemId) as EquippableItem;\r\n\r\n  // If we are unequipping from pouch, clean up the effect\r\n  if (slot == EquipmentSlot.Pouch) {\r\n    state = (actualItem as PouchItem).doCleanup(state, item.params);\r\n  }\r\n\r\n  state = addToInventory(item, 1, state);\r\n  state.run.equipment[actualItem.getSlot()][position] = null;\r\n\r\n  if (!skipSave) {\r\n    state = saveEquipmentLoadoutToPosition(\r\n      state,\r\n      state.run.lastEquipmentLoadoutModified,\r\n    );\r\n  }\r\n\r\n  // We must clear all combat caches.\r\n  // This is because equipment can have complex interactions. For example,\r\n  // the Synergizer increases the effect of other equipment.\r\n  state = clearCombatStatCache(state);\r\n  state = clearResourceCapCache(state);\r\n  state = clearCalculatedIncomeCache(state);\r\n  state = clearResearcherExpCache(state);\r\n  state = clearAllSpellCaches(state);\r\n\r\n  EquipmentChangeListeners.getAll().forEach((listener) => {\r\n    state = listener(state);\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\nexport function unequipFromSlot(\r\n  this: any,\r\n  slot: EquipmentSlot,\r\n  position: number,\r\n  skipSave?: boolean,\r\n): GameStateTransform {\r\n  // Do it this way to avoid creating extra functions and avoid rerenders\r\n  return bind(unequipFromSlotImpl, this, slot, position, skipSave);\r\n}\r\n\r\nexport function getUnequipAction(\r\n  state: GameState,\r\n  slot: EquipmentSlot,\r\n  position: number,\r\n): ItemAction {\r\n  return {\r\n    id: \"unequip\" + slot + position,\r\n    description: t(\"Unequip\"),\r\n    isEnabled: canUnequipItem(state, slot, position),\r\n    transform: unequipFromSlot(slot, position),\r\n  };\r\n}\r\n\r\nexport function saveEquipmentLoadoutToPosition(\r\n  state: GameState,\r\n  position: number,\r\n  name?: string,\r\n): GameState {\r\n  const equipment = JSON.parse(JSON.stringify(state.run.equipment));\r\n  state.run.equipmentLoadouts[position] = {\r\n    name: name ?? t(\"Slot {{position}}\", { position: position + 1 }),\r\n    equipment: equipment,\r\n  };\r\n  state.run.lastEquipmentLoadoutModified = position;\r\n  return state;\r\n}\r\n\r\nexport function loadEquipmentLoadoutFromPosition(\r\n  state: GameState,\r\n  position: number,\r\n): GameState {\r\n  const equipment = JSON.parse(\r\n    JSON.stringify(\r\n      state.run.equipmentLoadouts?.[position]?.equipment || {\r\n        Hand: [],\r\n        Body: [],\r\n        Accessory: [],\r\n        Pouch: [],\r\n      },\r\n    ),\r\n  );\r\n\r\n  for (let slot of Object.values(EquipmentSlot)) {\r\n    if (slot == EquipmentSlot.Pouch) {\r\n      // Pouch items are NOT part of equipment loadouts, to avoid potions warding off\r\n      continue;\r\n    }\r\n    const capacity = getMaxEquippedItemsPerSlot(state, slot);\r\n\r\n    // First, unequip everything\r\n    for (let i = 0; i < capacity; i++) {\r\n      const currentItemOccurrence = getEquippedItem(\r\n        state,\r\n        slot as EquipmentSlot,\r\n        i,\r\n      );\r\n      if (currentItemOccurrence != null) {\r\n        state = unequipFromSlotImpl(slot as EquipmentSlot, i, true, state);\r\n      }\r\n    }\r\n\r\n    // Then, equip everything\r\n    for (let i = 0; i < capacity; i++) {\r\n      const itemOccurrence = equipment?.[slot]?.[i];\r\n      const currentItemOccurrence = getEquippedItem(\r\n        state,\r\n        slot as EquipmentSlot,\r\n        i,\r\n      );\r\n      if (itemOccurrence == null && currentItemOccurrence != null) {\r\n        // We want to unequip since there is nothing assigned to this slot\r\n        if (!canUnequipItem(state, slot as EquipmentSlot, i)) {\r\n          // Skip as there is no space to unequip\r\n          continue;\r\n        }\r\n        state = unequipFromSlotImpl(slot as EquipmentSlot, i, true, state);\r\n      } else {\r\n        // We want to equip the new item\r\n        if (itemOccurrence != null) {\r\n          state = equipToSlot(\r\n            state,\r\n            slot as EquipmentSlot,\r\n            itemOccurrence,\r\n            i,\r\n            true,\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  state.run.lastEquipmentLoadoutModified = position;\r\n  return state;\r\n}\r\n","import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { Buffer } from \"buffer\";\r\nimport deepmerge from \"deepmerge\";\r\nimport zlib from \"react-zlib-js\";\r\nimport { isArray, promisify } from \"util\";\r\nimport { clone } from \"../utils/CoreUtils\";\r\nimport {\r\n  AUTOCAST_INITIAL_STATE,\r\n  createTempState,\r\n  GameState,\r\n  INITIAL_STATE,\r\n} from \"./GameState\";\r\nimport { EquipmentSlot } from \"./items/Equipment\";\r\nimport { getTotalSecondsPlayed } from \"./timetick/TotalTimePlayed\";\r\n\r\nconst gzipCompress = promisify(zlib.gzip);\r\nconst gzipDecompress = promisify(zlib.gunzip);\r\n\r\nexport async function loadData(): Promise<GameState> {\r\n  const jsonValue = await AsyncStorage.getItem(\"MR2.GameState\");\r\n  if (jsonValue !== null) {\r\n    const state = JSON.parse(jsonValue);\r\n\r\n    // Fix all the save compatibility changes\r\n    return makeCompatible(state);\r\n  }\r\n  return clone(INITIAL_STATE);\r\n}\r\n\r\nexport async function saveData(state: GameState): Promise<void> {\r\n  const lastSaveDataTime = Math.max(\r\n    Number.parseFloat(\r\n      (await AsyncStorage.getItem(\"MR2.LastSaveSecondsPlayed\")) || \"0\",\r\n    ),\r\n    0,\r\n  );\r\n  if (Math.max(getTotalSecondsPlayed(state), 0) >= lastSaveDataTime) {\r\n    await saveDataUnsafe(state);\r\n  } else {\r\n    throw new Error(\"Not saving!!\");\r\n  }\r\n}\r\n\r\nexport async function saveDataUnsafe(state: GameState): Promise<void> {\r\n  // Do not save temp\r\n  const oldTemp = state.temp;\r\n  // @ts-ignore We are doing this for saving only\r\n  state.temp = {};\r\n  const jsonValue = JSON.stringify(state);\r\n  state.temp = oldTemp;\r\n  await AsyncStorage.setItem(\r\n    \"MR2.LastSaveSecondsPlayed\",\r\n    Math.max(getTotalSecondsPlayed(state), 0).toString(),\r\n  );\r\n  await AsyncStorage.setItem(\"MR2.GameState\", jsonValue);\r\n}\r\n\r\nexport function makeCompatible(obj: GameState): GameState {\r\n  if (obj.global.autocast == null) {\r\n    obj.global.autocast = AUTOCAST_INITIAL_STATE;\r\n    obj.global.autocast.currentStrategy =\r\n      // @ts-expect-error These values were moved\r\n      clone(obj.run.autocast.strategies[obj.run.autocast.currentStrategyIndex]);\r\n    // @ts-expect-error These values were moved\r\n    delete obj.run.autocast.strategies;\r\n    // @ts-expect-error These values were moved\r\n    delete obj.run.autocast.currentStrategyIndex;\r\n  }\r\n\r\n  for (let rule of obj.global.autocast.currentStrategy.rules) {\r\n    if (rule.id == null) {\r\n      rule.id = Math.random().toString();\r\n    }\r\n  }\r\n\r\n  for (let slot in EquipmentSlot) {\r\n    if (!isArray(obj.run.equipment[slot])) {\r\n      obj.run.equipment[slot] =\r\n        obj.run.equipment[slot] != null ? [obj.run.equipment[slot]] : [];\r\n    }\r\n    obj.run.equipmentLoadouts.forEach((loadout) => {\r\n      if (loadout != null && !isArray(loadout.equipment[slot])) {\r\n        loadout.equipment[slot] =\r\n          loadout.equipment[slot] != null ? [loadout.equipment[slot]] : [];\r\n      }\r\n    });\r\n  }\r\n\r\n  // Dp not load temp\r\n  obj.temp = createTempState();\r\n  return deepmerge(clone(INITIAL_STATE), obj);\r\n}\r\n\r\nexport async function loadBase64Data(\r\n  saveData: string,\r\n): Promise<GameState | null> {\r\n  const decodedBuffer = Buffer.from(\r\n    Buffer.from(saveData, \"base64\").toString(),\r\n    \"base64\",\r\n  );\r\n  const decodedJSON = await gzipDecompress(decodedBuffer);\r\n  const decodedData = JSON.parse(decodedJSON.toString());\r\n  if (decodedData !== null) {\r\n    return makeCompatible(decodedData);\r\n  }\r\n  return null;\r\n}\r\n\r\nexport async function serializeSaveData(state: GameState): Promise<string> {\r\n  // Do not save temp\r\n  const oldTemp = state.temp;\r\n  // @ts-ignore We are doing this for serialization only\r\n  state.temp = {};\r\n  const jsonValue = JSON.stringify(state);\r\n  state.temp = oldTemp;\r\n\r\n  const compressedJSON = await gzipCompress(jsonValue);\r\n  // Double converting to Base64 so it copies well on Android\r\n  return Buffer.from(compressedJSON.toString(\"base64\")).toString(\"base64\");\r\n}\r\n","import { GameState } from \"./GameState\";\r\n\r\nexport function getUICommands(state: GameState) {\r\n  return state.run.uiCommands || [];\r\n}\r\n\r\nexport function clearUICommands(state: GameState) {\r\n  state.run.uiCommands = [];\r\n  return state;\r\n}\r\n\r\nexport function addUICommand(state: GameState, command: string): GameState {\r\n  state.run.uiCommands.push(command);\r\n  return state;\r\n}\r\n","let requiredElectron = null;\r\ntry {\r\n  requiredElectron = window.require(\"electron\");\r\n} catch (e) {\r\n  // Do nothing\r\n}\r\n\r\nexport function isElectron() {\r\n  return requiredElectron != null;\r\n}\r\n\r\nexport function electron() {\r\n  return requiredElectron;\r\n}\r\n","import { Achievement } from \"../backend/Achievement\";\r\nimport { electron, isElectron } from \"./ElectronUtils\";\r\n\r\nexport const ACHIEVEMENTS_SUPPORTED = isElectron();\r\n\r\nexport function unlockAchievementRaw(achievementName: Achievement): void {\r\n  // On Electron, we do want to do something!\r\n  if (isElectron()) {\r\n    electron().ipcRenderer.send(\"unlockAchievement\", achievementName);\r\n  }\r\n}\r\n","import { GameState } from \"./GameState\";\r\n\r\nexport function incrementAccumulatorVariable(\r\n  state: GameState,\r\n  variableName: string,\r\n  amount?: number,\r\n): GameState {\r\n  const currentValue = (state.run.variables?.[variableName] as number) ?? 0;\r\n  state.run.variables[variableName] = currentValue + (amount ?? 0);\r\n  const worldValue = (state.world.variables?.[variableName] as number) ?? 0;\r\n  state.world.variables[variableName] = worldValue + (amount ?? 0);\r\n  return state;\r\n}\r\n\r\nexport function getAccumulatorVariable(\r\n  state: GameState,\r\n  variableName: string,\r\n): number {\r\n  return (state.run.variables?.[variableName] as number) ?? 0;\r\n}\r\n\r\nexport function getWorldAccumulatorVariable(\r\n  state: GameState,\r\n  variableName: string,\r\n): number {\r\n  return (state.world.variables?.[variableName] as number) ?? 0;\r\n}\r\n","import { GameState } from \"../GameState\";\r\nimport { CombatActionResult } from \"./ExplorationActionResult\";\r\nimport { ExplorationStatus } from \"./ExplorationStatus\";\r\n\r\n// This is meant to be used primarily inside enemy attack transforms\r\nexport function getLastQueuedActionResult(\r\n  state: GameState,\r\n): CombatActionResult | undefined {\r\n  if (state.run.exploration.actionResultQueue.length == 0) {\r\n    return undefined;\r\n  }\r\n  return state.run.exploration.actionResultQueue[\r\n    state.run.exploration.actionResultQueue.length - 1\r\n  ];\r\n}\r\n\r\nexport function getExplorationStatus(state: GameState): ExplorationStatus {\r\n  return state.run.exploration?.explorationStatus || ExplorationStatus.None;\r\n}\r\n","import { keysOf, valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { cacheByArbitraryVersion, cacheIndefinitely } from \"../Caching\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n  getCachedCombatStat,\r\n} from \"../exploration/CombatStats\";\r\nimport { DungeonFloor } from \"../exploration/dungeons/DungeonFloor\";\r\nimport {\r\n  DungeonFloors,\r\n  getUnlockedDungeons,\r\n} from \"../exploration/dungeons/Dungeons\";\r\nimport { ExplorationStatus } from \"../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../exploration/ExplorationUtils\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasFlag } from \"../Flags\";\r\nimport { GameState, GameStateTransform, MessageLog } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  applyTransformations,\r\n  applyTransformationsCached,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { FamiliarClass } from \"./FamiliarClass\";\r\n\r\nexport enum FamiliarStatusType {\r\n  Idle = \"Idle\",\r\n  Exploring = \"Exploring\",\r\n  Companion = \"Companion\",\r\n}\r\n\r\nexport function translateFamiliarStatusType(\r\n  status: FamiliarStatusType,\r\n): string {\r\n  switch (status) {\r\n    case FamiliarStatusType.Idle:\r\n      return t(\"Idle\");\r\n    case FamiliarStatusType.Exploring:\r\n      return t(\"Exploring\");\r\n    case FamiliarStatusType.Companion:\r\n      return t(\"At your side\");\r\n    // Do not add a default\r\n  }\r\n}\r\n\r\nexport enum FamiliarCompanionStatusType {\r\n  Reviving = \"Reviving\",\r\n  Exploring = \"Exploring\",\r\n  Combat = \"Combat\",\r\n  Preparing = \"Preparing\",\r\n}\r\n\r\nexport function translateFamiliarCompanionStatusType(\r\n  status: FamiliarCompanionStatusType,\r\n): string {\r\n  switch (status) {\r\n    case FamiliarCompanionStatusType.Preparing:\r\n      return t(\"Getting ready\");\r\n    case FamiliarCompanionStatusType.Exploring:\r\n      return t(\"Exploring\");\r\n    case FamiliarCompanionStatusType.Reviving:\r\n      return t(\"Recovering\");\r\n    case FamiliarCompanionStatusType.Combat:\r\n      return t(\"Fighting\");\r\n    // Do not add a default\r\n  }\r\n}\r\n\r\nexport type FamiliarStatus = {\r\n  status: FamiliarStatusType;\r\n  exploringDungeonFloorId: string;\r\n  exploringNextRandomRoll: number;\r\n  autoExploring: boolean;\r\n  currentHp: number;\r\n  triggerFamiliarDeath: boolean;\r\n  actionProgress: number;\r\n  companionStatus: FamiliarCompanionStatusType;\r\n};\r\n\r\nexport type FamiliarData = {\r\n  id: string;\r\n  familiarClassId: string;\r\n  exp: number;\r\n  status: FamiliarStatus;\r\n  messageLog: MessageLog[];\r\n};\r\n\r\nexport function getFamiliarData(\r\n  state: GameState,\r\n  familiarId: string,\r\n): FamiliarData | undefined {\r\n  return state.run.familiars?.[familiarId];\r\n}\r\n\r\nexport const FamiliarDeletionListeners: DataStore<GameStateTransform> =\r\n  new DataStore();\r\n\r\nexport function deleteFamiliar(\r\n  state: GameState,\r\n  familiarId: string,\r\n): GameState {\r\n  delete state.run.familiars[familiarId];\r\n  FamiliarDeletionListeners.getAll().forEach((transform) => {\r\n    state = transform(state);\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function getCurrentCompanionId(state: GameState): string {\r\n  return getCurrentCompanionData(state)?.id;\r\n}\r\n\r\nexport function getCurrentCompanionData(\r\n  state: GameState,\r\n): FamiliarData | undefined {\r\n  return valuesOf(state.run.familiars).find(\r\n    (familiarData) =>\r\n      familiarData.status.status === FamiliarStatusType.Companion,\r\n  );\r\n}\r\n\r\nexport function getCurrentCompanionClass(\r\n  state: GameState,\r\n): FamiliarClass | undefined {\r\n  const companionData = getCurrentCompanionData(state);\r\n  if (companionData == null) {\r\n    return undefined;\r\n  }\r\n\r\n  return Familiars.getById(companionData.familiarClassId);\r\n}\r\n\r\nexport function setCurrentCompanion(\r\n  state: GameState,\r\n  familiarId: string,\r\n): GameState {\r\n  const currentCompanion = getCurrentCompanionData(state);\r\n  if (currentCompanion != null) {\r\n    currentCompanion.status.status = FamiliarStatusType.Idle;\r\n  }\r\n\r\n  const newCompanionData = getFamiliarData(state, familiarId);\r\n  if (newCompanionData == null) {\r\n    return state;\r\n  }\r\n\r\n  newCompanionData.status.status = FamiliarStatusType.Companion;\r\n  newCompanionData.status.companionStatus =\r\n    FamiliarCompanionStatusType.Preparing;\r\n  newCompanionData.status.actionProgress = 0;\r\n\r\n  return state;\r\n}\r\n\r\nexport function setFamiliarToExplore(\r\n  state: GameState,\r\n  familiarId: string,\r\n  dungeonFloorId: string,\r\n): GameState {\r\n  const familiarData = getFamiliarData(state, familiarId);\r\n  if (familiarData == null) {\r\n    return state;\r\n  }\r\n\r\n  familiarData.status.status = FamiliarStatusType.Exploring;\r\n  familiarData.status.actionProgress = 0;\r\n  familiarData.status.exploringDungeonFloorId = dungeonFloorId;\r\n  familiarData.status.autoExploring = false;\r\n  familiarData.status.exploringNextRandomRoll = Math.random();\r\n\r\n  return state;\r\n}\r\n\r\nexport function setAllFamiliarsToExplore(\r\n  state: GameState,\r\n  dungeonFloorId: string,\r\n): GameState {\r\n  for (let familiarId of keysOf(state.run.familiars)) {\r\n    const familiarData = getFamiliarData(state, familiarId);\r\n    if (\r\n      familiarData == null ||\r\n      familiarData.status.status == FamiliarStatusType.Companion\r\n    ) {\r\n      continue;\r\n    }\r\n    state = setFamiliarToExplore(state, familiarId, dungeonFloorId);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function setFamiliarToAutoExplore(\r\n  state: GameState,\r\n  familiarId: string,\r\n): GameState {\r\n  const familiarData = getFamiliarData(state, familiarId);\r\n  if (familiarData == null) {\r\n    return state;\r\n  }\r\n\r\n  familiarData.status.status = FamiliarStatusType.Exploring;\r\n  familiarData.status.actionProgress = 0;\r\n  familiarData.status.exploringDungeonFloorId = findMaxFloorForFamiliar(\r\n    state,\r\n    familiarId,\r\n  ).getId();\r\n  familiarData.status.autoExploring = true;\r\n  familiarData.status.exploringNextRandomRoll = Math.random();\r\n\r\n  return state;\r\n}\r\n\r\nexport function setAllFamiliarsToAutoExplore(state: GameState): GameState {\r\n  for (let familiarId of keysOf(state.run.familiars)) {\r\n    const familiarData = getFamiliarData(state, familiarId);\r\n    if (\r\n      familiarData == null ||\r\n      familiarData.status.status == FamiliarStatusType.Companion\r\n    ) {\r\n      continue;\r\n    }\r\n    state = setFamiliarToAutoExplore(state, familiarId);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function setIdle(state: GameState, familiarId: string): GameState {\r\n  const familiarData = getFamiliarData(state, familiarId);\r\n  if (familiarData == null) {\r\n    return state;\r\n  }\r\n\r\n  familiarData.status.status = FamiliarStatusType.Idle;\r\n  return state;\r\n}\r\n\r\nexport function getFamiliarAmount(state: GameState): number {\r\n  return keysOf(state.run.familiars).length;\r\n}\r\n\r\nexport function getFamiliarMessageLog(\r\n  state: GameState,\r\n  familiarId: string,\r\n): MessageLog[] {\r\n  return getFamiliarData(state, familiarId)?.messageLog;\r\n}\r\n\r\nlet throttleTimestamps: Record<string, number> = {};\r\nlet throttleCounts: Record<string, number> = {};\r\n\r\nconst THROTTLE_THRESHOLD = 40;\r\n\r\nexport function wouldBeThrottledIfPushingToCreatureMessageLog(\r\n  state: GameState,\r\n  familiarId: string,\r\n) {\r\n  const timestamp = Date.now();\r\n  const timestampSec = Math.floor(timestamp / 1000);\r\n  const throttleTimestamp = throttleTimestamps?.[familiarId] ?? 0;\r\n  const throttleCount = throttleCounts?.[familiarId] ?? 0;\r\n  return (\r\n    timestampSec == throttleTimestamp && throttleCount >= THROTTLE_THRESHOLD\r\n  );\r\n}\r\n\r\nexport function pushToFamiliarMessageLog(\r\n  state: GameState,\r\n  familiarId: string,\r\n  log: string,\r\n): GameState {\r\n  const timestamp = Date.now();\r\n  const timestampSec = Math.floor(timestamp / 1000);\r\n  const throttleTimestamp = throttleTimestamps?.[familiarId] ?? 0;\r\n  let throttleCount = throttleCounts?.[familiarId] ?? 0;\r\n  if (throttleTimestamp == timestampSec) {\r\n    throttleCounts[familiarId] = throttleCount++;\r\n  } else {\r\n    throttleTimestamps[familiarId] = timestampSec;\r\n    throttleCounts[familiarId] = 1;\r\n  }\r\n  const familiarData = getFamiliarData(state, familiarId);\r\n  if (familiarData == null) {\r\n    return state;\r\n  }\r\n  const familiarMessageLog = familiarData.messageLog;\r\n  if (throttleCount == THROTTLE_THRESHOLD) {\r\n    familiarMessageLog.unshift({\r\n      id: Math.random().toString(),\r\n      secondsPlayed: getSecondsPlayed(state),\r\n      realTimestamp: timestamp,\r\n      message: t(\"(More loot omitted)\"),\r\n    });\r\n  } else if (throttleCount < THROTTLE_THRESHOLD) {\r\n    familiarMessageLog.unshift({\r\n      id: Math.random().toString(),\r\n      secondsPlayed: getSecondsPlayed(state),\r\n      realTimestamp: timestamp,\r\n      message: log,\r\n    });\r\n  }\r\n  familiarData.messageLog = familiarMessageLog.slice(0, 40);\r\n  return state;\r\n}\r\n\r\nexport function areFamiliarsUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.FamiliarsUnlocked);\r\n}\r\n\r\nexport function areFamiliarsEverUnlocked(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.FamiliarsUnlocked);\r\n}\r\n\r\nexport function isDungeonFloorValidForFamiliars(\r\n  state: GameState,\r\n  dungeonFloorId: string,\r\n): boolean {\r\n  const dungeonFloor = DungeonFloors.getById(dungeonFloorId);\r\n\r\n  if (!dungeonFloor.isUnlocked(state)) {\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    !dungeonFloor.canFightBoss(state) &&\r\n    dungeonFloor.getBoss(state) !== undefined\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function getFloorsAvailableForFamiliars(state: GameState) {\r\n  if (!areFamiliarsUnlocked(state)) {\r\n    return [];\r\n  }\r\n  return cacheIndefinitely(\r\n    state,\r\n    (_state) => \"floorsAvailableForFamiliars\",\r\n    (state) => {\r\n      const dungeons = getUnlockedDungeons(state);\r\n      const floors = dungeons\r\n        .map((dungeon) => {\r\n          return dungeon\r\n            .getDungeonFloors()\r\n            .filter((floor) =>\r\n              isDungeonFloorValidForFamiliars(state, floor.getId()),\r\n            );\r\n        })\r\n        .flat();\r\n      return floors;\r\n    },\r\n  );\r\n}\r\n\r\nconst Familiars = new DataStore<FamiliarClass>();\r\n\r\nexport { Familiars };\r\n\r\nconst familiarExplorationDelayTags = [\r\n  TransformationTags.FamiliarExplorationDelay,\r\n];\r\n\r\nfunction calculateExplorationDelaySec(\r\n  state: GameState,\r\n  familiarId: string,\r\n): number {\r\n  const familiarData = getFamiliarData(state, familiarId);\r\n  const familiarClass = Familiars.getById(familiarData.familiarClassId);\r\n  const dungeonFloor = DungeonFloors.getById(\r\n    familiarData.status.exploringDungeonFloorId,\r\n  );\r\n  const explorationResult = dungeonFloor.doExplore(\r\n    state,\r\n    true,\r\n    familiarData.status.exploringNextRandomRoll,\r\n  );\r\n  const enemy = explorationResult.enemy;\r\n  const familiarLevel = familiarClass.getLevel(state, familiarId);\r\n  const enemyLevel = enemy?.getLevel() ?? familiarLevel;\r\n  const overlevel = Math.max(0, familiarLevel - enemyLevel);\r\n  const baseExplorationTime = applyTransformationsCached(\r\n    familiarExplorationDelayTags,\r\n    state,\r\n    30.0,\r\n  );\r\n  const explorationTime = Math.pow(0.94, overlevel) * baseExplorationTime;\r\n  return explorationTime;\r\n}\r\n\r\nfunction findMaxFloorForFamiliar(\r\n  state: GameState,\r\n  familiarId: string,\r\n): DungeonFloor | undefined {\r\n  return cacheByArbitraryVersion(\r\n    state,\r\n    \"maxFloorForFamiliarId\" + familiarId,\r\n    (state) => {\r\n      const floors = getFloorsAvailableForFamiliars(state);\r\n      floors.sort(\r\n        (a, b) =>\r\n          b.calculateAverageEnemyLevelForFamiliars(state) -\r\n          a.calculateAverageEnemyLevelForFamiliars(state),\r\n      );\r\n      const topFloor = floors.filter(\r\n        (floor) => !floor.isDangerousForFamiliar(state, familiarId),\r\n      )[0];\r\n      return topFloor;\r\n    },\r\n    (state) => {\r\n      const familiarData = getFamiliarData(state, familiarId);\r\n      const familiarClass = Familiars.getById(familiarData.familiarClassId);\r\n      const level = familiarClass.getLevel(state, familiarId);\r\n\r\n      const floors = getFloorsAvailableForFamiliars(state);\r\n\r\n      return level.toString() + floors.length.toString();\r\n    },\r\n  );\r\n}\r\n\r\nexport function loadFamiliarCommonLogic() {\r\n  const familiarHPRegenTags = [CombatStat.HPRegen, AttackTarget.Familiar];\r\n  registerTimeTickListener(\r\n    \"Familiars\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      for (let familiarId in state.run.familiars) {\r\n        const familiarData = getFamiliarData(state, familiarId);\r\n        const familiarClass = Familiars.getById(familiarData.familiarClassId);\r\n\r\n        // Apply HP regen: fully recover in 2 minutes normally,\r\n        // but boost HP regen by 10x outside of combat for the current\r\n        // companion\r\n        const regenFraction =\r\n          (timeElapsedSec / 120.0) *\r\n          (getExplorationStatus(state) != ExplorationStatus.Combat &&\r\n          familiarData.status.status == FamiliarStatusType.Companion\r\n            ? 10.0\r\n            : 1.0);\r\n        const maxHP = familiarClass.getMaxHP(state, familiarId);\r\n        const hpToRegenMultiplier = getCachedCombatStat(\r\n          state,\r\n          AttackTarget.Familiar,\r\n          CombatStat.HPRegen,\r\n          (state) => applyTransformations(familiarHPRegenTags, state, maxHP),\r\n          familiarId,\r\n          familiarClass.getLevel(state, familiarId),\r\n        );\r\n        familiarData.status.currentHp = Math.min(\r\n          familiarData.status.currentHp + hpToRegenMultiplier * regenFraction,\r\n          maxHP,\r\n        );\r\n\r\n        if (familiarData.status.status == FamiliarStatusType.Exploring) {\r\n          // We will need to make progress here, AKA breeding-style\r\n          const dungeonFloor = DungeonFloors.getById(\r\n            familiarData.status.exploringDungeonFloorId,\r\n          );\r\n          let explorationResult = dungeonFloor.doExplore(\r\n            state,\r\n            true,\r\n            familiarData.status.exploringNextRandomRoll,\r\n          );\r\n          let explorationTime = calculateExplorationDelaySec(state, familiarId);\r\n          const progress = Math.min(1.0, timeElapsedSec / explorationTime);\r\n          let totalProgress = progress + familiarData.status.actionProgress;\r\n          while (totalProgress >= 1.0) {\r\n            // Explore\r\n            totalProgress -= 1.0;\r\n            state = explorationResult.familiar(state, familiarId);\r\n            const overflowProgress = totalProgress;\r\n            familiarData.status.exploringNextRandomRoll = Math.random();\r\n\r\n            // If auto-exploring, check highest-level floor\r\n            // and switch dungeons if desired\r\n            if (familiarData.status.autoExploring) {\r\n              const nextFloor = findMaxFloorForFamiliar(state, familiarId);\r\n              familiarData.status.exploringDungeonFloorId = nextFloor.getId();\r\n            }\r\n\r\n            const newExplorationTime = calculateExplorationDelaySec(\r\n              state,\r\n              familiarId,\r\n            );\r\n            // Adapt the overflow progress\r\n            totalProgress =\r\n              (overflowProgress * explorationTime) / newExplorationTime;\r\n            explorationResult = dungeonFloor.doExplore(\r\n              state,\r\n              true,\r\n              familiarData.status.exploringNextRandomRoll,\r\n            );\r\n            explorationTime = newExplorationTime;\r\n          }\r\n          familiarData.status.actionProgress = totalProgress;\r\n        }\r\n      }\r\n      return state;\r\n    },\r\n    -20,\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"FamiliarCombatEnd\",\r\n    (state) => {\r\n      const companion = getCurrentCompanionData(state);\r\n      if (companion != null) {\r\n        if (\r\n          (getExplorationStatus(state) === ExplorationStatus.Exploring ||\r\n            getExplorationStatus(state) === ExplorationStatus.ExploringBoss) &&\r\n          (companion.status.companionStatus ===\r\n            FamiliarCompanionStatusType.Combat ||\r\n            companion.status.companionStatus ===\r\n              FamiliarCompanionStatusType.Preparing)\r\n        ) {\r\n          companion.status.companionStatus =\r\n            FamiliarCompanionStatusType.Exploring;\r\n          state = clearCombatStatCache(state, AttackTarget.Familiar);\r\n        }\r\n\r\n        if (\r\n          getExplorationStatus(state) === ExplorationStatus.Combat &&\r\n          companion.status.companionStatus ===\r\n            FamiliarCompanionStatusType.Exploring\r\n        ) {\r\n          companion.status.companionStatus = FamiliarCompanionStatusType.Combat;\r\n          state = clearCombatStatCache(state, AttackTarget.Familiar);\r\n        }\r\n      }\r\n    },\r\n    (state) => getExplorationStatus(state),\r\n  );\r\n\r\n  addGameStateListener(\"FamiliarRevived\", (state) => {\r\n    const companion = getCurrentCompanionData(state);\r\n    if (companion != null) {\r\n      if (\r\n        companion.status.companionStatus ===\r\n          FamiliarCompanionStatusType.Reviving &&\r\n        companion.status.currentHp >=\r\n          getCurrentCompanionClass(state).getStatsForCompanion(state).maxHP *\r\n            0.999\r\n      ) {\r\n        // Reviving is done and ready to go!\r\n        switch (getExplorationStatus(state)) {\r\n          case ExplorationStatus.Exploring:\r\n          case ExplorationStatus.ExploringBoss:\r\n          case ExplorationStatus.Reviving:\r\n          case ExplorationStatus.None:\r\n            companion.status.companionStatus =\r\n              FamiliarCompanionStatusType.Exploring;\r\n          case ExplorationStatus.Combat:\r\n            companion.status.companionStatus =\r\n              FamiliarCompanionStatusType.Combat;\r\n        }\r\n        state = clearCombatStatCache(state, AttackTarget.Familiar);\r\n      }\r\n    }\r\n  });\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { clearCombatStatCache, CombatStat } from \"../exploration/CombatStats\";\r\nimport { hasWorldFlag, setWorldFlag } from \"../Flags\";\r\nimport { GameState, GameStateTransform } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  applyTransformations,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\n\r\nconst TemporaryEffects = new DataStore<TemporaryEffect>();\r\nexport { TemporaryEffects };\r\n\r\nconst TEMPORARY_EFFECT_DELTA = 1e10;\r\nconst CLEAR_EPSILON = TEMPORARY_EFFECT_DELTA / 100;\r\n\r\nexport type TemporaryEffectData = {\r\n  id: string;\r\n  setTime: number;\r\n  endTime: number;\r\n  target: AttackTarget;\r\n  params: Record<string, any>;\r\n  fromAutocast: boolean;\r\n  fromPermacast: boolean;\r\n  fromPouch: boolean;\r\n  registeredClear: boolean;\r\n};\r\n\r\nfunction getLookupId(id: string, target?: AttackTarget): string {\r\n  return id + (target ?? AttackTarget.Player);\r\n}\r\n\r\nexport function getTemporaryEffectEndTime(\r\n  state: GameState,\r\n  id: string,\r\n  target?: AttackTarget,\r\n): number {\r\n  return getTemporaryEffectEndTimeRaw(state, getLookupId(id, target));\r\n}\r\n\r\nexport function getTemporaryEffectEndTimeRaw(\r\n  state: GameState,\r\n  fullId: string,\r\n): number {\r\n  return (\r\n    (state.run.temporaryEffects[fullId] as TemporaryEffectData)?.endTime || 0\r\n  );\r\n}\r\n\r\nexport function getTemporaryEffectSetTime(\r\n  state: GameState,\r\n  id: string,\r\n  target?: AttackTarget,\r\n): number {\r\n  return (\r\n    (\r\n      state.run.temporaryEffects?.[\r\n        getLookupId(id, target)\r\n      ] as TemporaryEffectData\r\n    )?.setTime || 0\r\n  );\r\n}\r\n\r\nexport function wasTemporaryEffectCleared(\r\n  state: GameState,\r\n  id: string,\r\n  target?: AttackTarget,\r\n): boolean {\r\n  const endTime = getTemporaryEffectEndTimeRaw(state, getLookupId(id, target));\r\n  return (\r\n    endTime < getSecondsPlayed(state) - TEMPORARY_EFFECT_DELTA + CLEAR_EPSILON\r\n  );\r\n}\r\n\r\nexport function hasTemporaryEffect(\r\n  state: GameState,\r\n  id: string,\r\n  target?: AttackTarget,\r\n): boolean {\r\n  return hasTemporaryEffectRaw(state, getLookupId(id, target));\r\n}\r\n\r\nfunction hasTemporaryEffectRaw(state: GameState, fullId: string): boolean {\r\n  return getTemporaryEffectEndTimeRaw(state, fullId) > getSecondsPlayed(state);\r\n}\r\n\r\nexport function hasEverHadTemporaryEffect(\r\n  state: GameState,\r\n  id: string,\r\n): boolean {\r\n  return hasWorldFlag(state, \"everHadTemporaryEffect-\" + id);\r\n}\r\n\r\nexport function getTemporaryEffectData(\r\n  state: GameState,\r\n  id: string,\r\n  target?: AttackTarget,\r\n  includeEvenIfExpired?: boolean,\r\n): TemporaryEffectData | undefined {\r\n  if (!includeEvenIfExpired && !hasTemporaryEffect(state, id, target)) {\r\n    return undefined;\r\n  }\r\n  return state.run.temporaryEffects[getLookupId(id, target)];\r\n}\r\n\r\nexport function getTemporaryEffects(\r\n  state: GameState,\r\n  filter?: (state: GameState, effect: TemporaryEffectData) => boolean,\r\n): Array<TemporaryEffectData> {\r\n  let temporaryEffects: TemporaryEffectData[] = [];\r\n  const secondsPlayed = getSecondsPlayed(state);\r\n  for (let effectName in state.run.temporaryEffects) {\r\n    const temporaryEffect = state.run.temporaryEffects[effectName];\r\n    if (\r\n      temporaryEffect.endTime > secondsPlayed &&\r\n      (!filter || filter(state, temporaryEffect))\r\n    ) {\r\n      temporaryEffects.push(temporaryEffect);\r\n    }\r\n  }\r\n  return temporaryEffects;\r\n}\r\n\r\nexport function getTemporaryEffectsForTarget(\r\n  state: GameState,\r\n  target: AttackTarget,\r\n): Array<TemporaryEffectData> {\r\n  let temporaryEffects: TemporaryEffectData[] = [];\r\n  for (let effectName in state.run.temporaryEffects) {\r\n    if (\r\n      state.run.temporaryEffects[effectName].target == target &&\r\n      hasTemporaryEffectRaw(state, effectName)\r\n    ) {\r\n      const temporaryEffect = state.run.temporaryEffects[effectName];\r\n      temporaryEffects.push(temporaryEffect);\r\n    }\r\n  }\r\n  return temporaryEffects;\r\n}\r\n\r\nconst temporaryEffectDurationTags = memoize((id, target) => [\r\n  TransformationTags.TemporaryEffectDurationPostProcessing,\r\n  id,\r\n  target,\r\n]);\r\n\r\nfunction grantTemporaryEffectImpl(\r\n  id: string,\r\n  baseDurationSec: number,\r\n  extra: {\r\n    mode?: \"replace\" | \"add\";\r\n    target?: AttackTarget;\r\n    params?: Record<string, any>;\r\n  },\r\n  state: GameState,\r\n): GameState {\r\n  const mode = extra.mode ?? \"replace\";\r\n  const target = extra.target ?? AttackTarget.Player;\r\n  const params = extra.params ?? {};\r\n  const durationSec = applyTransformations(\r\n    temporaryEffectDurationTags(id, target),\r\n    state,\r\n    baseDurationSec,\r\n    { effectExtra: extra },\r\n  );\r\n\r\n  const newEndTime =\r\n    baseDurationSec == Infinity\r\n      ? Number.MAX_VALUE / 10\r\n      : getSecondsPlayed(state) + durationSec;\r\n  let temporaryEffectData: TemporaryEffectData = {\r\n    id: id,\r\n    setTime: getSecondsPlayed(state),\r\n    endTime: newEndTime,\r\n    target: target,\r\n    params: params,\r\n    fromAutocast: state.temp.isInAutocast,\r\n    fromPermacast: state.temp.isInPermacast,\r\n    fromPouch: state.temp.isInPouch,\r\n    registeredClear: baseDurationSec < 0,\r\n  };\r\n  if (hasTemporaryEffect(state, id, target)) {\r\n    const temporaryEffect = TemporaryEffects.getById(id);\r\n    temporaryEffectData = temporaryEffect.mergeData(\r\n      state,\r\n      getTemporaryEffectData(state, id, target),\r\n      temporaryEffectData,\r\n      mode,\r\n    );\r\n  }\r\n  for (let listener of Object.values(temporaryEffectListeners)) {\r\n    temporaryEffectData = listener(state, temporaryEffectData);\r\n  }\r\n  state.run.temporaryEffects[getLookupId(id, target)] = temporaryEffectData;\r\n  state = setWorldFlag(\"everHadTemporaryEffect-\" + id)(state);\r\n  return state;\r\n}\r\n\r\nexport const grantTemporaryEffect = (\r\n  id: string,\r\n  baseDurationSec: number,\r\n  extra: {\r\n    mode?: \"replace\" | \"add\";\r\n    target?: AttackTarget;\r\n    params?: Record<string, any>;\r\n  },\r\n) => grantTemporaryEffectImpl.bind(this, id, baseDurationSec, extra);\r\n\r\nexport function clearTemporaryEffect(\r\n  this: any,\r\n  id: string,\r\n  target?: AttackTarget,\r\n): GameStateTransform {\r\n  return grantTemporaryEffectImpl.bind(this, id, -TEMPORARY_EFFECT_DELTA, {\r\n    target: target,\r\n  });\r\n}\r\n\r\nexport function clearCombatTemporaryEffects(state: GameState): GameState {\r\n  const effects = getTemporaryEffects(state);\r\n  effects.forEach((effect) => {\r\n    const effectObject = TemporaryEffects.getById(effect.id);\r\n    if (effectObject.isCombatOnly() || effect.target == AttackTarget.Enemy) {\r\n      state = clearTemporaryEffect(effect.id, effect.target)(state);\r\n    }\r\n  });\r\n  return state;\r\n}\r\n\r\nexport const getTemporaryEffectsForCommonBuff = memoize(\r\n  (stat: CombatStat, type: TransformationType): TemporaryEffect[] => {\r\n    return TemporaryEffects.getAll().filter((effect) =>\r\n      effect\r\n        .isCommonBuffEnabled()\r\n        .some((value) => value.stat == stat && value.type == type),\r\n    );\r\n  },\r\n);\r\n\r\nexport type TemporaryEffectListenerTransform = (\r\n  state: GameState,\r\n  temporaryEffect: TemporaryEffectData,\r\n) => TemporaryEffectData;\r\n\r\nconst temporaryEffectListeners: Record<\r\n  string,\r\n  TemporaryEffectListenerTransform\r\n> = {};\r\n\r\nexport function registerTemporaryEffectListener(\r\n  id: string,\r\n  listener: TemporaryEffectListenerTransform,\r\n  registerExpiration?: boolean,\r\n) {\r\n  temporaryEffectListeners[id] = listener;\r\n  if (registerExpiration) {\r\n    TemporaryEffectExpirationListeners.register(listener);\r\n  }\r\n}\r\n\r\nexport const TemporaryEffectExpirationListeners = new DataStore<\r\n  (state: GameState, effect: TemporaryEffectData) => void\r\n>();\r\n\r\nexport function registerTemporaryEffectCombatStatCacheClearer(\r\n  id: string,\r\n  stat: CombatStat,\r\n) {\r\n  registerTemporaryEffectListener(\r\n    id + stat + \"cacheClearer\",\r\n    (state, effect) => {\r\n      if (effect.id == id) {\r\n        state = clearCombatStatCache(state, effect.target, stat);\r\n      }\r\n      return effect;\r\n    },\r\n    true,\r\n  );\r\n}\r\n","import { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { AttackTarget } from \"./AttackTarget\";\r\n\r\n/**\r\n * PlayerDeathInterceptors return true if player death is to be prevented.\r\n * Use in conjunction with some ContextListener that does some action.\r\n */\r\n\r\nexport type DeathInterceptor = (\r\n  state: GameState,\r\n  target: AttackTarget,\r\n) => boolean;\r\n\r\nconst DeathInterceptors = new DataStore<DeathInterceptor>();\r\n\r\nexport { DeathInterceptors };\r\n","import { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { AttackTarget } from \"./AttackTarget\";\r\n\r\nexport type CombatActionResult = {\r\n  id: string;\r\n  damage: number;\r\n  isHit: boolean;\r\n  isCrit: boolean;\r\n  time: number;\r\n  source: AttackTarget;\r\n  target: AttackTarget;\r\n  tags: string[];\r\n};\r\n\r\nexport type CombatActionResultListener = (\r\n  state: GameState,\r\n  result: CombatActionResult,\r\n) => GameState;\r\n\r\nconst CombatActionResultListeners = new DataStore<CombatActionResultListener>();\r\n\r\nexport { CombatActionResultListeners };\r\n\r\nexport function pushCombatActionResult(\r\n  state: GameState,\r\n  combatActionResult: CombatActionResult,\r\n): GameState {\r\n  state.run.exploration.actionResultQueue.push(combatActionResult);\r\n  state.run.exploration.lastActionResultPushedTime = getSecondsPlayed(state);\r\n\r\n  // Prevent super long action queues\r\n  if (state.run.exploration.actionResultQueue.length > 20) {\r\n    state.run.exploration.actionResultQueue =\r\n      state.run.exploration.actionResultQueue.slice(-10);\r\n  }\r\n\r\n  CombatActionResultListeners.getAll().forEach((listener) => {\r\n    state = listener(state, combatActionResult);\r\n  });\r\n  return state;\r\n}\r\n","import {\r\n  FamiliarCompanionStatusType,\r\n  getCurrentCompanionData,\r\n} from \"../familiars/Familiar\";\r\nimport { GameState } from \"../GameState\";\r\n\r\nexport function hasCurrentActiveCompanion(state: GameState): boolean {\r\n  return (\r\n    getCurrentCompanionData(state) != null &&\r\n    getCurrentCompanionData(state).status.companionStatus ===\r\n      FamiliarCompanionStatusType.Combat\r\n  );\r\n}\r\n\r\nexport function hasCurrentCompanion(state: GameState): boolean {\r\n  return getCurrentCompanionData(state) != null;\r\n}\r\n","import { GameState } from \"../../GameState\";\r\nimport { DataStore } from \"../../generic/DataStore\";\r\nimport { Enemy } from \"./Enemy\";\r\n\r\nconst Enemies = new DataStore<Enemy>();\r\n\r\nexport { Enemies };\r\n\r\nexport function getCurrentEnemy(state: GameState): Enemy {\r\n  return Enemies.getById(state.run.exploration.currentEnemy?.id || \"\");\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { incrementAccumulatorVariable } from \"../AccumulatorVariables\";\r\nimport { clearCacheKey } from \"../Caching\";\r\nimport { Flag } from \"../Flag\";\r\nimport {\r\n  clearFlag,\r\n  getCombatVariable,\r\n  hasEverHadFlag,\r\n  hasFlag,\r\n  resetAllCombatVariables,\r\n  setCombatVariable,\r\n  setFlag,\r\n} from \"../Flags\";\r\nimport {\r\n  EXPLORATION_INITIAL_STATE,\r\n  GameState,\r\n  GameStateTransform,\r\n} from \"../GameState\";\r\nimport {\r\n  addGameStateListener,\r\n  addHighPriorityGameStateListener,\r\n} from \"../GameStateListeners\";\r\nimport {\r\n  FamiliarCompanionStatusType,\r\n  getCurrentCompanionClass,\r\n  getCurrentCompanionData,\r\n} from \"../familiars/Familiar\";\r\nimport { FamiliarClass } from \"../familiars/FamiliarClass\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { EquipmentSlot, getEquippedItems } from \"../items/Equipment\";\r\nimport { Items } from \"../items/Items\";\r\nimport { PouchItem } from \"../items/equipment/PouchItem\";\r\nimport {\r\n  TemporaryEffects,\r\n  clearCombatTemporaryEffects,\r\n  clearTemporaryEffect,\r\n  getTemporaryEffects,\r\n} from \"../temporaryeffects/TemporaryEffects\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformations,\r\n  registerTransformation,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { AttackTarget } from \"./AttackTarget\";\r\nimport {\r\n  CombatStat,\r\n  calculatePlayerAccuracyPoints,\r\n  calculatePlayerAttack,\r\n  calculatePlayerAttackDelaySec,\r\n  calculatePlayerCritPoints,\r\n  calculatePlayerDefense,\r\n  calculatePlayerDodgePoints,\r\n  calculatePlayerHPRegenRatioPerSec,\r\n  calculatePlayerMaxHP,\r\n  clearCombatStatCache,\r\n  getCachedCombatStat,\r\n} from \"./CombatStats\";\r\nimport { DeathInterceptors } from \"./DeathInterceptors\";\r\nimport {\r\n  CombatActionResult,\r\n  pushCombatActionResult,\r\n} from \"./ExplorationActionResult\";\r\nimport { ExplorationStatus } from \"./ExplorationStatus\";\r\nimport { getExplorationStatus } from \"./ExplorationUtils\";\r\nimport { hasCurrentActiveCompanion } from \"./Summoning\";\r\nimport { DungeonFloor } from \"./dungeons/DungeonFloor\";\r\nimport { DungeonFloors } from \"./dungeons/Dungeons\";\r\nimport { getCurrentEnemy } from \"./enemies/Enemies\";\r\nimport { BattlerAction, Enemy } from \"./enemies/Enemy\";\r\n\r\nlet lastSelectedEnemyAction: BattlerAction | undefined = undefined;\r\nlet lastSelectedFamiliarAction: BattlerAction | undefined = undefined;\r\n\r\nexport function isExplorationUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.ExplorationUnlocked);\r\n}\r\n\r\nexport function isExplorationEverUnlocked(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.ExplorationUnlocked);\r\n}\r\n\r\nexport function startExplorationOnFloor(\r\n  state: GameState,\r\n  dungeonFloor: DungeonFloor,\r\n): GameState {\r\n  if (!state.run.exploration) {\r\n    state.run.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  if (!dungeonFloor.isUnlocked(state)) {\r\n    return state;\r\n  }\r\n  state.run.exploration.currentDungeonFloorId = dungeonFloor.getId();\r\n  return startExploration(state);\r\n}\r\n\r\nexport function startExploration(state: GameState): GameState {\r\n  if (!state.run.exploration) {\r\n    state.run.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.run.exploration.explorationStartTime = getSecondsPlayed(state);\r\n  state.run.exploration.explorationStatus = ExplorationStatus.Exploring;\r\n  return state;\r\n}\r\n\r\nexport function startBossExploration(state: GameState): GameState {\r\n  if (!state.run.exploration) {\r\n    state.run.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.run.exploration.explorationStartTime = getSecondsPlayed(state);\r\n  state.run.exploration.explorationStatus = ExplorationStatus.ExploringBoss;\r\n  return state;\r\n}\r\n\r\nexport function getExplorationStartTime(state: GameState): number {\r\n  return state.run.exploration?.explorationStartTime || 0;\r\n}\r\n\r\nexport function getCurrentDungeonFloor(state: GameState): DungeonFloor {\r\n  return DungeonFloors.getById(\r\n    state.run.exploration?.currentDungeonFloorId || \"\",\r\n  );\r\n}\r\n\r\nfunction startCombatImpl(enemy: Enemy, state: GameState): GameState {\r\n  if (!state.run.exploration) {\r\n    state.run.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state = clearCombatTemporaryEffects(state);\r\n  state = resetAllCombatVariables(state);\r\n  for (let itemOccurrence of getEquippedItems(state, EquipmentSlot.Pouch)) {\r\n    if (itemOccurrence != null) {\r\n      const item = Items.getById(itemOccurrence.itemId) as PouchItem;\r\n      state = item.doCleanup(state, itemOccurrence.params);\r\n    }\r\n  }\r\n  state.run.exploration.pouchItemsUsesLeft = {};\r\n  state.run.exploration.explorationStatus = ExplorationStatus.Combat;\r\n  state.run.exploration.currentEnemy = {\r\n    id: enemy.getId(),\r\n    currentHP: enemy.getMaxHP(state),\r\n  };\r\n  state = clearCombatStatCache(state, AttackTarget.Enemy);\r\n  // Do this one more time as getMaxHP depends on currentEnemy being set\r\n  state.run.exploration.currentEnemy.currentHP = enemy.getMaxHP(state);\r\n  state = enemy.onEncounter(state);\r\n  lastSelectedEnemyAction = enemy.getNextAction(state);\r\n  lastSelectedFamiliarAction = undefined;\r\n  const hasCompanion = hasCurrentActiveCompanion(state);\r\n  if (hasCompanion) {\r\n    const companion = getCurrentCompanionClass(state) as FamiliarClass;\r\n    lastSelectedFamiliarAction = companion.getNextActionForCompanion(state);\r\n    state.run.exploration.familiarActionProgress = 0.0;\r\n  }\r\n  state.run.exploration.playerActionProgress = 0.0;\r\n  state.run.exploration.enemyActionProgress = 0.0;\r\n  return state;\r\n}\r\n\r\nexport function getPlayerActionProgress(state: GameState): number {\r\n  return state.run.exploration?.playerActionProgress || 0.0;\r\n}\r\n\r\nexport function getEnemyActionProgress(state: GameState): number {\r\n  return state.run.exploration?.enemyActionProgress || 0.0;\r\n}\r\n\r\nexport function getFamiliarActionProgress(state: GameState): number {\r\n  return state.run.exploration?.familiarActionProgress || 0.0;\r\n}\r\n\r\nexport function startCombat(this: any, enemy: Enemy): GameStateTransform {\r\n  return startCombatImpl.bind(this, enemy);\r\n}\r\n\r\nexport function getCurrentPlayerHP(state: GameState): number {\r\n  return state.run.exploration?.currentHP || 0;\r\n}\r\n\r\nexport function getCurrentFamiliarHP(state: GameState): number {\r\n  return getCurrentCompanionData(state)?.status?.currentHp || 0;\r\n}\r\n\r\nexport function getCurrentEnemyHP(state: GameState): number {\r\n  return state.run.exploration?.currentEnemy?.currentHP || 0;\r\n}\r\n\r\nexport function getCurrentPlayerHPFraction(state: GameState): number {\r\n  return getCurrentPlayerHP(state) / calculatePlayerMaxHP(state);\r\n}\r\n\r\nexport function getCurrentFamiliarHPFraction(state: GameState): number {\r\n  return (\r\n    getCurrentFamiliarHP(state) /\r\n    getCurrentCompanionClass(state).getStatsForCompanion(state).maxHP\r\n  );\r\n}\r\n\r\nexport function getCurrentEnemyHPFraction(state: GameState): number {\r\n  return (\r\n    getCurrentEnemyHP(state) / (getCurrentEnemy(state)?.getMaxHP(state) ?? 1.0)\r\n  );\r\n}\r\n\r\nconst DAMAGE_INFLECTION = 1.15;\r\nexport function calculateDamage(attack: number, defense: number): number {\r\n  let damage = 1;\r\n  if (attack * DAMAGE_INFLECTION > defense) {\r\n    damage = attack - defense / 2;\r\n  } else {\r\n    damage =\r\n      attack -\r\n      (attack * DAMAGE_INFLECTION) / 2 -\r\n      ((Math.pow(attack, 2) * Math.pow(DAMAGE_INFLECTION, 2)) / 2) *\r\n        -1 *\r\n        (1 / defense - 1 / (DAMAGE_INFLECTION * attack));\r\n  }\r\n  return Math.max(damage, 1);\r\n}\r\n\r\nexport function calculateIsHit(\r\n  accuracyPoints: number,\r\n  dodgePoints: number,\r\n): boolean {\r\n  const ratio = Math.min(accuracyPoints / Math.max(1, dodgePoints), 1.0);\r\n  // This formula creates the following effect:\r\n  // Ratio >= 1: hitOdds is 100%+\r\n  // Ratio == 0.66: hitOdds is about 74%\r\n  // Ratio == 0.5: hitOdds is about 50%\r\n  // Ratio == 0.25: hitOdds is 0%\r\n  const hitOdds = -1.33333 * Math.pow(ratio, 2) + 3 * ratio - 0.66667;\r\n  return Math.random() < hitOdds;\r\n}\r\n\r\nexport function modifyTargetCurrentHP(\r\n  state: GameState,\r\n  target: AttackTarget,\r\n  amount: number,\r\n  cause?: string | null,\r\n): GameState {\r\n  switch (target) {\r\n    case AttackTarget.Player:\r\n      return modifyPlayerCurrentHP(state, amount, cause);\r\n    case AttackTarget.Familiar:\r\n      return modifyCompanionCurrentHP(state, amount, cause);\r\n    case AttackTarget.Enemy:\r\n      return modifyEnemyCurrentHP(state, amount);\r\n  }\r\n}\r\n\r\nexport function modifyPlayerCurrentHP(\r\n  state: GameState,\r\n  amount: number,\r\n  cause?: string | null,\r\n): GameState {\r\n  if (\r\n    amount < 0 &&\r\n    state.run.exploration.currentHP + amount <= 0 &&\r\n    !state.run.exploration.triggerPlayerDeath\r\n  ) {\r\n    cause = cause ?? lastSelectedEnemyAction?.name;\r\n    state.run.exploration.lastPlayerDamageCause = cause;\r\n  }\r\n  state.run.exploration.currentHP = Math.min(\r\n    calculatePlayerMaxHP(state),\r\n    Math.max(state.run.exploration.currentHP + amount, 0),\r\n  );\r\n  if (state.run.exploration.currentHP <= 0) {\r\n    state.run.exploration.triggerPlayerDeath = true;\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function modifyCompanionCurrentHP(\r\n  state: GameState,\r\n  amount: number,\r\n  cause: string | null | undefined,\r\n): GameState {\r\n  if (!hasCurrentActiveCompanion(state)) {\r\n    return state;\r\n  }\r\n\r\n  const currentCompanion = getCurrentCompanionClass(state) as FamiliarClass;\r\n  const currentCompanionData = getCurrentCompanionData(state);\r\n  currentCompanionData.status.currentHp = Math.min(\r\n    currentCompanion.getStatsForCompanion(state).maxHP,\r\n    Math.max(currentCompanionData.status.currentHp + amount, 0),\r\n  );\r\n  if (currentCompanionData.status.currentHp <= 0) {\r\n    currentCompanionData.status.triggerFamiliarDeath = true;\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function modifyEnemyCurrentHP(\r\n  state: GameState,\r\n  amount: number,\r\n): GameState {\r\n  const currentEnemy = getCurrentEnemy(state);\r\n  state.run.exploration.currentEnemy.currentHP = Math.min(\r\n    currentEnemy.getMaxHP(state),\r\n    state.run.exploration.currentEnemy.currentHP + amount,\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function executePlayerAutoAttack(state: GameState): GameState {\r\n  state = standardPlayerAttackEffect(state, calculatePlayerAttack(state), {\r\n    tags: [TransformationTags.AutoAttack],\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function executeFamiliarAction(state: GameState): GameState {\r\n  const familiar = getCurrentCompanionData(state);\r\n  if (\r\n    lastSelectedFamiliarAction &&\r\n    familiar != null &&\r\n    familiar.status.companionStatus === FamiliarCompanionStatusType.Combat\r\n  ) {\r\n    state = lastSelectedFamiliarAction.transform(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function executeEnemyAction(state: GameState): GameState {\r\n  if (lastSelectedEnemyAction) {\r\n    state = lastSelectedEnemyAction.transform(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getCurrentHPFromTarget(\r\n  state: GameState,\r\n  target: AttackTarget,\r\n): number {\r\n  switch (target) {\r\n    case AttackTarget.Player:\r\n      return getCurrentPlayerHP(state);\r\n    case AttackTarget.Familiar:\r\n      return getCurrentFamiliarHP(state);\r\n    case AttackTarget.Enemy:\r\n      return getCurrentEnemyHP(state);\r\n  }\r\n}\r\n\r\nexport function getStatFromTarget(\r\n  state: GameState,\r\n  target: AttackTarget,\r\n  stat: CombatStat,\r\n): number {\r\n  switch (target) {\r\n    case AttackTarget.Player:\r\n      switch (stat) {\r\n        case CombatStat.MaxHP:\r\n          return calculatePlayerMaxHP(state);\r\n        case CombatStat.Attack:\r\n          return calculatePlayerAttack(state);\r\n        case CombatStat.AttackDelay:\r\n          return calculatePlayerAttackDelaySec(state);\r\n        case CombatStat.Defense:\r\n          return calculatePlayerDefense(state);\r\n        case CombatStat.Accuracy:\r\n          return calculatePlayerAccuracyPoints(state);\r\n        case CombatStat.Dodge:\r\n          return calculatePlayerDodgePoints(state);\r\n        case CombatStat.Crit:\r\n          return calculatePlayerCritPoints(state);\r\n        case CombatStat.HPRegen:\r\n          return calculatePlayerHPRegenRatioPerSec(state);\r\n      }\r\n    case AttackTarget.Familiar:\r\n      const familiar = getCurrentCompanionClass(state);\r\n      if (stat === CombatStat.HPRegen) {\r\n        return 0;\r\n      }\r\n      return familiar.getStatsForCompanion(state, stat)[\r\n        stat[0].toLowerCase() + stat.substring(1)\r\n      ];\r\n    case AttackTarget.Enemy:\r\n      const enemy = getCurrentEnemy(state);\r\n      switch (stat) {\r\n        case CombatStat.MaxHP:\r\n          return enemy?.getMaxHP?.(state);\r\n        case CombatStat.Attack:\r\n          return enemy?.getAttack?.(state);\r\n        case CombatStat.AttackDelay:\r\n          return enemy?.getAttackDelay?.(state);\r\n        case CombatStat.Defense:\r\n          return enemy?.getDefense?.(state);\r\n        case CombatStat.Accuracy:\r\n          return enemy?.getAccuracyPoints?.(state);\r\n        case CombatStat.Dodge:\r\n          return enemy?.getDodgePoints?.(state);\r\n        case CombatStat.Crit:\r\n          return enemy?.getCriticalPoints?.(state);\r\n        case CombatStat.HPRegen:\r\n          return 0;\r\n      }\r\n  }\r\n}\r\n\r\nexport function calculateAttackTarget(state: GameState): AttackTarget {\r\n  if (\r\n    hasCurrentActiveCompanion(state) &&\r\n    !state.run.exploration.familiarIsInBackRow\r\n  ) {\r\n    return AttackTarget.Familiar;\r\n  }\r\n  return AttackTarget.Player;\r\n}\r\n\r\nexport function calculateIsEnemyHit(\r\n  state: GameState,\r\n  modifiedAccuracyPoints: number,\r\n  forcedTarget?: AttackTarget,\r\n): boolean {\r\n  const target = forcedTarget ?? calculateAttackTarget(state);\r\n  let dodgePoints = getStatFromTarget(state, target, CombatStat.Dodge);\r\n  return calculateIsHit(modifiedAccuracyPoints, dodgePoints);\r\n}\r\n\r\nconst attackDamageReceivedByTargetTags = memoize((target) => [\r\n  TransformationTags.AttackDamageReceived,\r\n  target,\r\n]);\r\n\r\nconst critResistanceByTargetTags = memoize((target) => [\r\n  target,\r\n  TransformationTags.CriticalResistance,\r\n]);\r\n\r\nexport function standardEnemyAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    accuracyAddition?: number;\r\n    critChanceMultiplier?: number;\r\n    forcedTarget?: AttackTarget;\r\n    tags?: string[];\r\n    cause?: string;\r\n    onHit?: (state: GameState, actionResult: CombatActionResult) => GameState;\r\n  },\r\n): GameState {\r\n  const enemy = getCurrentEnemy(state);\r\n  const modifiedAccuracyPoints =\r\n    (enemy.getAccuracyPoints(state) + (options?.accuracyAddition ?? 0.0)) *\r\n    (options?.accuracyMultiplier ?? 1.0);\r\n  const target = options?.forcedTarget ?? calculateAttackTarget(state);\r\n  const isHit = calculateIsEnemyHit(state, modifiedAccuracyPoints, target);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    const critChance =\r\n      (enemy.getCriticalPoints(state) *\r\n        (options?.critChanceMultiplier ?? 1.0)) /\r\n      100.0;\r\n    isCrit = Math.random() < (critChance ?? 0);\r\n    const critMultiplier = 1.5;\r\n\r\n    if (isCrit) {\r\n      const critResistance = applyTransformations(\r\n        critResistanceByTargetTags(target),\r\n        state,\r\n        0,\r\n        { target, tags: options?.tags },\r\n      );\r\n      if (Math.random() < critResistance) {\r\n        isCrit = false;\r\n      }\r\n    }\r\n    const defense = getStatFromTarget(state, target, CombatStat.Defense);\r\n    damage = calculateDamage(\r\n      isCrit ? attack * critMultiplier : attack,\r\n      isCrit ? 0 : defense,\r\n    );\r\n    damage = applyTransformations(\r\n      attackDamageReceivedByTargetTags(target),\r\n      state,\r\n      damage,\r\n      {\r\n        target,\r\n        tags: options?.tags,\r\n      },\r\n    );\r\n    state = modifyTargetCurrentHP(state, target, -damage, options?.cause);\r\n  }\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    source: AttackTarget.Enemy,\r\n    target,\r\n    tags: options?.tags ?? [],\r\n  };\r\n  state = pushCombatActionResult(state, enemyAction);\r\n  state = options?.onHit != null ? options.onHit(state, enemyAction) : state;\r\n  return state;\r\n}\r\n\r\nexport function aoeEnemyAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    accuracyAddition?: number;\r\n    critChanceMultiplier?: number;\r\n    cause?: string;\r\n    tags?: string[];\r\n    onHit?: (state: GameState, actionResult: CombatActionResult) => GameState;\r\n  },\r\n) {\r\n  if (hasCurrentActiveCompanion(state)) {\r\n    state = standardEnemyAttackEffect(state, attack, {\r\n      ...options,\r\n      forcedTarget: AttackTarget.Familiar,\r\n    });\r\n  }\r\n  state = standardEnemyAttackEffect(state, attack, {\r\n    ...options,\r\n    forcedTarget: AttackTarget.Player,\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function fractionEnemyAttackEffect(\r\n  state: GameState,\r\n  fraction: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    forcedTarget?: AttackTarget;\r\n    cause?: string;\r\n    tags?: string[];\r\n  },\r\n): GameState {\r\n  const enemy = getCurrentEnemy(state);\r\n  const modifiedAccuracyPoints =\r\n    enemy.getAccuracyPoints(state) * (options?.accuracyMultiplier ?? 1.0);\r\n  const target = options?.forcedTarget ?? calculateAttackTarget(state);\r\n  const isHit = calculateIsEnemyHit(state, modifiedAccuracyPoints, target);\r\n  const isCrit = false;\r\n  let damage = 0;\r\n  if (isHit) {\r\n    if (target === AttackTarget.Player) {\r\n      damage = getCurrentPlayerHP(state) * fraction;\r\n      state = modifyPlayerCurrentHP(state, -damage, options?.cause);\r\n    } else if (target === AttackTarget.Familiar) {\r\n      damage = getCurrentFamiliarHP(state) * fraction;\r\n      state = modifyCompanionCurrentHP(state, -damage, options?.cause);\r\n    } else {\r\n      damage = getCurrentEnemyHP(state) * fraction;\r\n      state = modifyEnemyCurrentHP(state, -damage);\r\n    }\r\n  }\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    source: AttackTarget.Enemy,\r\n    target,\r\n    tags: options?.tags,\r\n  };\r\n  state = pushCombatActionResult(state, enemyAction);\r\n  return state;\r\n}\r\n\r\nexport function pierceDefenseAoEEnemyAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    critChanceMultiplier?: number;\r\n    cause?: string;\r\n    tags?: string[];\r\n  },\r\n) {\r\n  if (hasCurrentActiveCompanion(state)) {\r\n    state = pierceDefenseEnemyAttackEffect(state, attack, {\r\n      ...options,\r\n      forcedTarget: AttackTarget.Familiar,\r\n    });\r\n  }\r\n  state = pierceDefenseEnemyAttackEffect(state, attack, {\r\n    ...options,\r\n    forcedTarget: AttackTarget.Player,\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function pierceDefenseEnemyAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    critChanceMultiplier?: number;\r\n    forcedTarget?: AttackTarget;\r\n    cause?: string;\r\n    tags?: string[];\r\n  },\r\n): GameState {\r\n  const enemy = getCurrentEnemy(state);\r\n  const modifiedAccuracyPoints =\r\n    enemy.getAccuracyPoints(state) * (options?.accuracyMultiplier ?? 1.0);\r\n  const target = options?.forcedTarget ?? calculateAttackTarget(state);\r\n  const isHit = calculateIsEnemyHit(state, modifiedAccuracyPoints, target);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    const critChance =\r\n      (enemy.getCriticalPoints(state) *\r\n        (options?.critChanceMultiplier ?? 1.0)) /\r\n      100.0;\r\n    isCrit = Math.random() < (critChance ?? 0);\r\n\r\n    if (isCrit) {\r\n      const critResistance = applyTransformations(\r\n        critResistanceByTargetTags(target),\r\n        state,\r\n        0,\r\n        { target, tags: options?.tags },\r\n      );\r\n      if (Math.random() < critResistance) {\r\n        isCrit = false;\r\n      }\r\n    }\r\n\r\n    const critMultiplier = 1.5;\r\n    damage = isCrit ? attack * critMultiplier : attack;\r\n    damage = applyTransformations(\r\n      attackDamageReceivedByTargetTags(target),\r\n      state,\r\n      damage,\r\n      {\r\n        target,\r\n        tags: options?.tags,\r\n      },\r\n    );\r\n    state = modifyTargetCurrentHP(state, target, -damage, options?.cause);\r\n  }\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    source: AttackTarget.Enemy,\r\n    target,\r\n    tags: options?.tags ?? [],\r\n  };\r\n  state = pushCombatActionResult(state, enemyAction);\r\n  return state;\r\n}\r\n\r\nexport function drainingEnemyAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    critChanceMultiplier?: number;\r\n    forcedTarget?: AttackTarget;\r\n    cause?: string;\r\n    tags?: string[];\r\n  },\r\n): GameState {\r\n  const enemy = getCurrentEnemy(state);\r\n  const modifiedAccuracyPoints =\r\n    enemy.getAccuracyPoints(state) * (options?.accuracyMultiplier ?? 1.0);\r\n  const target = options?.forcedTarget ?? calculateAttackTarget(state);\r\n  const isHit = calculateIsEnemyHit(state, modifiedAccuracyPoints, target);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    const critChance =\r\n      (enemy.getCriticalPoints(state) *\r\n        (options?.critChanceMultiplier ?? 1.0)) /\r\n      100.0;\r\n    isCrit = Math.random() < (critChance ?? 0);\r\n\r\n    if (isCrit) {\r\n      const critResistance = applyTransformations(\r\n        critResistanceByTargetTags(target),\r\n        state,\r\n        0,\r\n        { target, tags: options?.tags },\r\n      );\r\n      if (Math.random() < critResistance) {\r\n        isCrit = false;\r\n      }\r\n    }\r\n\r\n    const critMultiplier = 1.5;\r\n    damage = isCrit ? attack * critMultiplier : attack;\r\n    const defense = getStatFromTarget(state, target, CombatStat.Defense);\r\n    damage = calculateDamage(\r\n      isCrit ? attack * critMultiplier : attack,\r\n      isCrit ? 0 : defense,\r\n    );\r\n    damage = applyTransformations(\r\n      attackDamageReceivedByTargetTags(target),\r\n      state,\r\n      damage,\r\n      {\r\n        target,\r\n        tags: options?.tags,\r\n      },\r\n    );\r\n    state = modifyTargetCurrentHP(state, target, -damage, options?.cause);\r\n    state = modifyEnemyCurrentHP(state, +damage);\r\n\r\n    const healingAction = {\r\n      id: Math.random().toString(),\r\n      damage: -damage,\r\n      isHit: true,\r\n      isCrit: false,\r\n      time: getSecondsPlayed(state),\r\n      source: AttackTarget.Enemy,\r\n      target: AttackTarget.Enemy,\r\n      tags: options?.tags ?? [],\r\n    };\r\n    state = pushCombatActionResult(state, healingAction);\r\n  }\r\n\r\n  const enemyAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    source: AttackTarget.Enemy,\r\n    target: AttackTarget.Player,\r\n    tags: options?.tags ?? [],\r\n  };\r\n  state = pushCombatActionResult(state, enemyAction);\r\n\r\n  return state;\r\n}\r\n\r\nexport function dispelAllEnemyAttackEffect(\r\n  state: GameState,\r\n  includeBeneficial?: boolean,\r\n): GameState {\r\n  const tempEffects = getTemporaryEffects(state);\r\n  tempEffects.forEach((tempEffect) => {\r\n    const tempEffectObj = TemporaryEffects.getById(tempEffect.id);\r\n    if (\r\n      tempEffect.target == AttackTarget.Enemy &&\r\n      tempEffectObj.isDispellable() &&\r\n      (includeBeneficial || !tempEffectObj.isBeneficial())\r\n    ) {\r\n      state = clearTemporaryEffect(tempEffect.id, AttackTarget.Enemy)(state);\r\n    }\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function standardFamiliarAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    critChanceMultiplier?: number;\r\n    forcedTarget?: AttackTarget;\r\n    cause?: string;\r\n    tags?: string[];\r\n    onHit?: (state: GameState, actionResult: CombatActionResult) => GameState;\r\n  },\r\n): GameState {\r\n  const target = options?.forcedTarget ?? AttackTarget.Enemy;\r\n  const familiar = getCurrentCompanionClass(state);\r\n  const dodgePoints = getStatFromTarget(state, target, CombatStat.Dodge);\r\n  const familiarStats = familiar.getStatsForCompanion(state);\r\n  const modifiedAccuracyPoints =\r\n    familiarStats.accuracy * (options?.accuracyMultiplier ?? 1.0);\r\n  const isHit = calculateIsHit(modifiedAccuracyPoints, dodgePoints);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    const critChance =\r\n      (familiarStats.crit * (options?.critChanceMultiplier ?? 1.0)) / 100.0;\r\n    isCrit = Math.random() < (critChance ?? 0);\r\n    const critResistance = applyTransformations(\r\n      critResistanceByTargetTags(target),\r\n      state,\r\n      0,\r\n      { target, tags: options?.tags },\r\n    );\r\n    if (Math.random() < critResistance) {\r\n      isCrit = false;\r\n    }\r\n    const critMultiplier = 1.5;\r\n\r\n    damage = calculateDamage(\r\n      isCrit ? attack * critMultiplier : attack,\r\n      isCrit ? 0 : getStatFromTarget(state, target, CombatStat.Defense),\r\n    );\r\n    damage = applyTransformations(\r\n      attackDamageReceivedByTargetTags(target),\r\n      state,\r\n      damage,\r\n      {\r\n        target,\r\n        source: AttackTarget.Familiar,\r\n        tags: options?.tags,\r\n      },\r\n    );\r\n    state = modifyTargetCurrentHP(state, target, -damage, options?.cause);\r\n  }\r\n  const summonAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    source: AttackTarget.Familiar,\r\n    target: target,\r\n    tags: options?.tags ?? [],\r\n  };\r\n  state = pushCombatActionResult(state, summonAction);\r\n  state = options?.onHit != null ? options.onHit(state, summonAction) : state;\r\n  return state;\r\n}\r\n\r\nexport function drainingSummonAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    critChanceMultiplier?: number;\r\n    forcedTarget?: AttackTarget;\r\n    cause?: string;\r\n    tags?: string[];\r\n  },\r\n): GameState {\r\n  const familiar = getCurrentCompanionClass(state);\r\n  const target = options?.forcedTarget ?? AttackTarget.Enemy;\r\n  const dodgePoints = getStatFromTarget(state, target, CombatStat.Dodge);\r\n  const familiarStats = familiar.getStatsForCompanion(state);\r\n  const modifiedAccuracyPoints =\r\n    familiarStats.accuracy * (options?.accuracyMultiplier ?? 1.0);\r\n  const isHit = calculateIsHit(modifiedAccuracyPoints, dodgePoints);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    const critChance =\r\n      familiarStats.crit * (options?.critChanceMultiplier ?? 1.0);\r\n    isCrit = Math.random() < (critChance ?? 0);\r\n    const critResistance = applyTransformations(\r\n      critResistanceByTargetTags(target),\r\n      state,\r\n      0,\r\n      { target, tags: options?.tags },\r\n    );\r\n    if (Math.random() < critResistance) {\r\n      isCrit = false;\r\n    }\r\n    const critMultiplier = 1.5;\r\n\r\n    damage = calculateDamage(\r\n      isCrit ? attack * critMultiplier : attack,\r\n      isCrit ? 0 : getStatFromTarget(state, target, CombatStat.Defense),\r\n    );\r\n    damage = applyTransformations(\r\n      attackDamageReceivedByTargetTags(target),\r\n      state,\r\n      damage,\r\n      {\r\n        target: AttackTarget.Enemy,\r\n        source: AttackTarget.Familiar,\r\n        tags: options?.tags,\r\n      },\r\n    );\r\n    state = modifyTargetCurrentHP(state, target, -damage, options?.cause);\r\n    state = modifyCompanionCurrentHP(state, +damage, options?.cause);\r\n    const healingAction = {\r\n      id: Math.random().toString(),\r\n      damage: -damage,\r\n      isHit,\r\n      isCrit: false,\r\n      time: getSecondsPlayed(state),\r\n      source: AttackTarget.Familiar,\r\n      target: AttackTarget.Familiar,\r\n      tags: options?.tags ?? [],\r\n    };\r\n    state = pushCombatActionResult(state, healingAction);\r\n  }\r\n  const summonAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    source: AttackTarget.Familiar,\r\n    target: target,\r\n    tags: options?.tags ?? [],\r\n  };\r\n  state = pushCombatActionResult(state, summonAction);\r\n  return state;\r\n}\r\n\r\nexport function standardPlayerAttackEffect(\r\n  state: GameState,\r\n  attack: number,\r\n  options?: {\r\n    accuracyMultiplier?: number;\r\n    overrideAccuracy?: number;\r\n    critChanceMultiplier?: number;\r\n    critChanceAddition?: number;\r\n    targetDefenseMultiplier?: number;\r\n    overrideCritChance?: number;\r\n    forcedTarget?: AttackTarget;\r\n    cause?: string;\r\n    tags: string[];\r\n  },\r\n): GameState {\r\n  const target = options?.forcedTarget ?? AttackTarget.Enemy;\r\n  const accuracyPoints =\r\n    options?.overrideAccuracy ??\r\n    calculatePlayerAccuracyPoints(state) * (options?.accuracyMultiplier ?? 1.0);\r\n  const dodgePoints = getStatFromTarget(state, target, CombatStat.Dodge);\r\n  const isHit = calculateIsHit(accuracyPoints, dodgePoints);\r\n  let damage = 0,\r\n    isCrit = false;\r\n  if (isHit) {\r\n    const critChancePoints =\r\n      options.overrideCritChance ??\r\n      calculatePlayerCritPoints(state) + (options?.critChanceAddition ?? 0);\r\n    isCrit =\r\n      Math.random() <\r\n      (critChancePoints * (options?.critChanceMultiplier ?? 1.0)) / 100;\r\n    const critResistance = applyTransformations(\r\n      critResistanceByTargetTags(target),\r\n      state,\r\n      0,\r\n      { target, tags: options?.tags },\r\n    );\r\n    if (Math.random() < critResistance) {\r\n      isCrit = false;\r\n    }\r\n    const critMultiplier = 1.5;\r\n    damage = calculateDamage(\r\n      isCrit ? attack * critMultiplier : attack,\r\n      isCrit\r\n        ? 0\r\n        : getStatFromTarget(state, target, CombatStat.Defense) *\r\n            (options?.targetDefenseMultiplier ?? 1.0),\r\n    );\r\n    damage = applyTransformations(\r\n      attackDamageReceivedByTargetTags(target),\r\n      state,\r\n      damage,\r\n      {\r\n        target,\r\n        source: AttackTarget.Player,\r\n        tags: options?.tags,\r\n      },\r\n    );\r\n    state = modifyTargetCurrentHP(state, target, -damage, options?.cause);\r\n  }\r\n  const playerAction = {\r\n    id: Math.random().toString(),\r\n    damage,\r\n    isHit,\r\n    isCrit,\r\n    time: getSecondsPlayed(state),\r\n    source: AttackTarget.Player,\r\n    target: target,\r\n    tags: options?.tags ?? [],\r\n  };\r\n  state = pushCombatActionResult(state, playerAction);\r\n\r\n  return state;\r\n}\r\n\r\nexport function getCurrentEnemyAction(state: GameState) {\r\n  return lastSelectedEnemyAction;\r\n}\r\n\r\nexport function getCurrentFamiliarAction(state: GameState) {\r\n  return lastSelectedFamiliarAction;\r\n}\r\n\r\nexport function getMessageLog(state: GameState) {\r\n  return state.run.explorationMessageLog || [];\r\n}\r\n\r\nexport function getCumulativeLosses(state: GameState, enemyId: string): number {\r\n  return state.world.timesEnemyDefeated?.[enemyId]?.losses ?? 0;\r\n}\r\n\r\nexport function incrementCumulativeLosses(\r\n  state: GameState,\r\n  enemyId: string,\r\n): GameState {\r\n  const timesEnemyDefeated = state.world.timesEnemyDefeated?.[enemyId] ?? {\r\n    player: 0,\r\n    familiars: 0,\r\n    losses: 0,\r\n  };\r\n\r\n  timesEnemyDefeated.losses += 1;\r\n\r\n  state.world.timesEnemyDefeated[enemyId] = timesEnemyDefeated;\r\n\r\n  return state;\r\n}\r\n\r\nexport function getSuccessfulExplorationsForFloor(\r\n  state: GameState,\r\n  dungeonFloorId: string,\r\n) {\r\n  return (\r\n    state.run.exploration?.successfulExplorationsPerFloor?.[dungeonFloorId] || 0\r\n  );\r\n}\r\n\r\nexport function pushToMessageLog(state: GameState, log: string): GameState {\r\n  if (!state.run.explorationMessageLog) {\r\n    state.run.explorationMessageLog = [];\r\n  }\r\n  state.run.explorationMessageLog.unshift({\r\n    id: Math.random().toString(),\r\n    realTimestamp: Date.now(),\r\n    secondsPlayed: getSecondsPlayed(state),\r\n    message: log,\r\n    accessibleMessage: log,\r\n  });\r\n  state.run.explorationMessageLog = state.run.explorationMessageLog.slice(\r\n    0,\r\n    40,\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function endExploration(state: GameState): GameState {\r\n  if (!state.run.exploration) {\r\n    state.run.exploration = EXPLORATION_INITIAL_STATE;\r\n  }\r\n  state.run.exploration.explorationStatus = ExplorationStatus.None;\r\n  state = pushToMessageLog(state, `You stop exploring.`);\r\n  return state;\r\n}\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  \"PauseExplorationHandler\",\r\n  t(\"Pause Exploration\"),\r\n  TransformationType.Override,\r\n  (state) => (hasFlag(state, \"exploration_paused\") ? Infinity : undefined),\r\n);\r\n\r\nexport function pauseExploration(state: GameState): GameState {\r\n  state = setFlag(\"exploration_paused\")(state);\r\n  return state;\r\n}\r\n\r\nexport function resumeExploration(state: GameState): GameState {\r\n  state = clearFlag(\"exploration_paused\")(state);\r\n  state.run.exploration.explorationStartTime = getSecondsPlayed(state);\r\n  return state;\r\n}\r\n\r\nconst explorationDelayTags = [TransformationTags.ExplorationDelay];\r\nexport function getExplorationTimeRequirementSec(state: GameState): number {\r\n  const explorationStatus = getExplorationStatus(state);\r\n  if (\r\n    explorationStatus != ExplorationStatus.Exploring &&\r\n    explorationStatus != ExplorationStatus.ExploringBoss\r\n  ) {\r\n    return 0;\r\n  }\r\n  const dungeonFloor = getCurrentDungeonFloor(state);\r\n  return applyTransformations(\r\n    explorationDelayTags,\r\n    state,\r\n    dungeonFloor.getExplorationRequiredTimeSecBase(),\r\n  );\r\n}\r\n\r\nconst familiarAttackDelayTags = [AttackTarget.Familiar, CombatStat.AttackDelay];\r\nexport function getFamiliarAttackDelay(state: GameState): number | undefined {\r\n  const currentFamiliar = getCurrentCompanionClass(state);\r\n  if (\r\n    !currentFamiliar ||\r\n    state.run.exploration?.explorationStatus != ExplorationStatus.Combat\r\n  ) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!lastSelectedFamiliarAction) {\r\n    lastSelectedFamiliarAction =\r\n      currentFamiliar.getNextActionForCompanion(state);\r\n  }\r\n\r\n  // TODO: This is a bug, because the delay was calculated at the time the action\r\n  // was generated, but now it was changed (i.e. stun or something).\r\n  // If we transform it again, the effects like haste are doubled.\r\n  // Need to refactor the familiars.\r\n  return lastSelectedFamiliarAction.delay;\r\n  // return applyTransformations(\r\n  //   familiarAttackDelayTags,\r\n  //   state,\r\n  //   lastSelectedFamiliarAction.delay,\r\n  // );\r\n}\r\n\r\nconst enemyAttackDelayTags = [AttackTarget.Enemy, CombatStat.AttackDelay];\r\nexport function getEnemyAttackDelay(state: GameState): number {\r\n  const currentEnemy = getCurrentEnemy(state);\r\n  if (!lastSelectedEnemyAction) {\r\n    lastSelectedEnemyAction = currentEnemy.getNextAction(state);\r\n  }\r\n\r\n  const baseEnemyAttackDelay = currentEnemy.getAttackDelay(state);\r\n  const actualEnemyAttackDelay = getCachedCombatStat(\r\n    state,\r\n    AttackTarget.Enemy,\r\n    CombatStat.AttackDelay,\r\n    (state) =>\r\n      applyTransformations(enemyAttackDelayTags, state, baseEnemyAttackDelay),\r\n  );\r\n\r\n  // actionAttackDelay is calculated based on base attack delay\r\n  const actionAttackDelay = lastSelectedEnemyAction.delay;\r\n\r\n  // So we convert\r\n  return (actionAttackDelay * actualEnemyAttackDelay) / baseEnemyAttackDelay;\r\n}\r\n\r\nexport function resetEnemyNextAction(): void {\r\n  lastSelectedEnemyAction = undefined;\r\n}\r\n\r\nexport function resetFamiliarNextAction(): void {\r\n  lastSelectedFamiliarAction = undefined;\r\n}\r\n\r\nexport function getEnemyTurnCounter(state: GameState): number {\r\n  return getCombatVariable(state, \"enemyTurnCounter\") ?? 1;\r\n}\r\n\r\nexport type EnemyDeathListener = (state: GameState, enemy: Enemy) => GameState;\r\n\r\nconst enemyDeathListeners: DataStore<EnemyDeathListener> = new DataStore();\r\n\r\nexport function addEnemyDeathListener(\r\n  id: string,\r\n  listener: EnemyDeathListener,\r\n) {\r\n  enemyDeathListeners.register(listener, id);\r\n}\r\n\r\nexport function triggerEnemyDeathListeners(\r\n  state: GameState,\r\n  enemy: Enemy,\r\n): GameState {\r\n  enemyDeathListeners.getAll().forEach((listener) => {\r\n    state = listener(state, enemy);\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function triggerCombatLoss(state: GameState): GameState {\r\n  const currentEnemy = getCurrentEnemy(state);\r\n  state = clearCombatTemporaryEffects(state);\r\n  state = resetAllCombatVariables(state);\r\n  if (currentEnemy.isBoss()) {\r\n    state.run.autoAttemptBoss = false;\r\n  }\r\n  lastSelectedFamiliarAction = undefined;\r\n  state.run.exploration.explorationStatus = ExplorationStatus.Reviving;\r\n  if (hasCurrentActiveCompanion(state)) {\r\n    getCurrentCompanionData(state).status.companionStatus =\r\n      FamiliarCompanionStatusType.Preparing;\r\n  }\r\n  const currentEnemyName = currentEnemy?.getName();\r\n  let fromEnemyMessage = \"\";\r\n  if (currentEnemyName) {\r\n    fromEnemyMessage = t(` from {{enemy}}`, {\r\n      enemy: currentEnemyName,\r\n    });\r\n  }\r\n  const cause =\r\n    state.run.exploration.lastPlayerDamageCause ?? t(\"something unknown\");\r\n  state = pushToMessageLog(\r\n    state,\r\n    t(\r\n      \"You run away{{fromEnemyMessage}} to recover from your injuries caused by {{cause}}...\",\r\n      { fromEnemyMessage: fromEnemyMessage, cause: cause },\r\n    ),\r\n  );\r\n  state = incrementAccumulatorVariable(state, \"deathCount\", 1);\r\n  state = incrementAccumulatorVariable(\r\n    state,\r\n    \"deathCountIn-\" + getCurrentDungeonFloor(state).getId(),\r\n    1,\r\n  );\r\n  if (currentEnemy != null) {\r\n    incrementCumulativeLosses(state, currentEnemy.getId());\r\n    state = currentEnemy.onPlayerDeath(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function loadExploration() {\r\n  registerTimeTickListener(\r\n    \"Exploration\",\r\n    (state: GameState, timeElapsedSec: number) => {\r\n      const explorationStatus = getExplorationStatus(state);\r\n      if (\r\n        explorationStatus != ExplorationStatus.Exploring &&\r\n        explorationStatus != ExplorationStatus.ExploringBoss\r\n      ) {\r\n        return state;\r\n      }\r\n\r\n      const dungeonFloor = getCurrentDungeonFloor(state);\r\n      const explorationTimeRequirement =\r\n        getExplorationTimeRequirementSec(state);\r\n\r\n      const nextExplorationTime =\r\n        getExplorationStartTime(state) + explorationTimeRequirement;\r\n      if (getSecondsPlayed(state) > nextExplorationTime) {\r\n        if (!state.run.exploration) {\r\n          state.run.exploration = EXPLORATION_INITIAL_STATE;\r\n        }\r\n        state.run.exploration.explorationStartTime = nextExplorationTime;\r\n        if (explorationStatus == ExplorationStatus.Exploring) {\r\n          const outcome = dungeonFloor.doExplore(state, false);\r\n          if (outcome != null) {\r\n            return outcome.normal(state);\r\n          }\r\n        } else {\r\n          const transform = dungeonFloor.doFightBoss(state);\r\n          return transform ? transform(state) : state;\r\n        }\r\n      }\r\n\r\n      return state;\r\n    },\r\n  );\r\n\r\n  registerTimeTickListener(\r\n    \"Combat\",\r\n    (state: GameState, timeElapsedSec: number) => {\r\n      const explorationStatus = getExplorationStatus(state);\r\n      if (explorationStatus != ExplorationStatus.Combat) {\r\n        return state;\r\n      }\r\n\r\n      const currentEnemy = getCurrentEnemy(state);\r\n      const currentFamiliar = getCurrentCompanionClass(state);\r\n\r\n      // First, pass the time\r\n      const attackDelayPlayer = calculatePlayerAttackDelaySec(state);\r\n      const attackDelayEnemy = getEnemyAttackDelay(state);\r\n      const attackDelayFamiliar = getFamiliarAttackDelay(state);\r\n\r\n      state.run.exploration.playerActionProgress +=\r\n        timeElapsedSec / attackDelayPlayer;\r\n      state.run.exploration.enemyActionProgress +=\r\n        timeElapsedSec / attackDelayEnemy;\r\n      if (attackDelayFamiliar != null && hasCurrentActiveCompanion(state)) {\r\n        state.run.exploration.familiarActionProgress +=\r\n          timeElapsedSec / attackDelayFamiliar;\r\n      }\r\n\r\n      while (state.run.exploration.playerActionProgress > 1.0) {\r\n        state.run.exploration.playerActionProgress -= 1.0;\r\n        let extraSec =\r\n          state.run.exploration.playerActionProgress * attackDelayPlayer;\r\n        if (extraSec == Infinity) {\r\n          // Guard against stunning\r\n          extraSec = 0;\r\n        }\r\n        state = executePlayerAutoAttack(state);\r\n        const newAttackDelay = calculatePlayerAttackDelaySec(state);\r\n        state.run.exploration.playerActionProgress = extraSec / newAttackDelay;\r\n      }\r\n\r\n      if (\r\n        lastSelectedFamiliarAction != null &&\r\n        attackDelayFamiliar != null &&\r\n        state.run.exploration.familiarActionProgress > 1.0\r\n      ) {\r\n        state.run.exploration.familiarActionProgress -= 1.0;\r\n        const extraSec =\r\n          state.run.exploration.familiarActionProgress * attackDelayFamiliar;\r\n        state = executeFamiliarAction(state);\r\n        lastSelectedFamiliarAction =\r\n          currentFamiliar?.getNextActionForCompanion(state);\r\n        const newAttackDelay = getFamiliarAttackDelay(state);\r\n        if (newAttackDelay != null) {\r\n          state.run.exploration.familiarActionProgress =\r\n            extraSec / newAttackDelay;\r\n        }\r\n      }\r\n\r\n      if (state.run.exploration.enemyActionProgress > 1.0) {\r\n        state.run.exploration.enemyActionProgress -= 1.0;\r\n        let extraSec =\r\n          state.run.exploration.enemyActionProgress * attackDelayEnemy;\r\n        if (extraSec == Infinity) {\r\n          // Guard against stunning\r\n          extraSec = 0;\r\n        }\r\n        state = executeEnemyAction(state);\r\n        state = setCombatVariable(\r\n          \"enemyTurnCounter\",\r\n          getEnemyTurnCounter(state) + 1,\r\n        )(state);\r\n        lastSelectedEnemyAction = currentEnemy.getNextAction(state);\r\n        const newAttackDelay = getEnemyAttackDelay(state);\r\n        state.run.exploration.enemyActionProgress = extraSec / newAttackDelay;\r\n      }\r\n\r\n      return state;\r\n    },\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"CombatFamiliarDeathListener\",\r\n    (newState: GameState) => {\r\n      if (getExplorationStatus(newState) != ExplorationStatus.Combat) {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        hasCurrentActiveCompanion(newState) &&\r\n        (getCurrentFamiliarHP(newState) <= 0 ||\r\n          getCurrentCompanionData(newState).status.triggerFamiliarDeath)\r\n      ) {\r\n        return (state) => {\r\n          lastSelectedFamiliarAction = undefined;\r\n          state.run.exploration.familiarActionProgress = 0;\r\n\r\n          const familiar = getCurrentCompanionData(state);\r\n          if (familiar == null) {\r\n            return state;\r\n          }\r\n\r\n          state = pushToMessageLog(\r\n            state,\r\n            t(\"Your familiar is exhausted and needs to recover!\"),\r\n          );\r\n          familiar.status.triggerFamiliarDeath = false;\r\n          familiar.status.companionStatus =\r\n            FamiliarCompanionStatusType.Reviving;\r\n          state = clearCombatStatCache(state, AttackTarget.Familiar);\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) => getCurrentFamiliarHP(state),\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"CombatCleaningCrew\",\r\n    (newState: GameState) => {\r\n      if (getExplorationStatus(newState) !== ExplorationStatus.Combat) {\r\n        return (state) => {\r\n          state = clearCombatTemporaryEffects(state);\r\n          state = resetAllCombatVariables(state);\r\n          for (let itemOccurrence of getEquippedItems(\r\n            state,\r\n            EquipmentSlot.Pouch,\r\n          )) {\r\n            if (itemOccurrence != null) {\r\n              const item = Items.getById(itemOccurrence.itemId) as PouchItem;\r\n              state = item.doCleanup(state, itemOccurrence.params);\r\n            }\r\n          }\r\n          state.run.exploration.pouchItemsUsesLeft = {};\r\n          state.run.exploration.triggerPlayerDeath = false;\r\n          lastSelectedFamiliarAction = undefined;\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) => getExplorationStatus(state),\r\n  );\r\n\r\n  addHighPriorityGameStateListener(\r\n    \"CombatDeathListener\",\r\n    (newState: GameState) => {\r\n      if (getExplorationStatus(newState) != ExplorationStatus.Combat) {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        getCurrentPlayerHP(newState) <= 0 ||\r\n        newState.run.exploration.triggerPlayerDeath\r\n      ) {\r\n        newState.run.exploration.triggerPlayerDeath = false;\r\n        const shouldPreventDeath = DeathInterceptors.getAll()\r\n          .map((interceptor) => interceptor(newState, AttackTarget.Player))\r\n          .some((value) => value);\r\n        if (!shouldPreventDeath) {\r\n          // Player death occurred\r\n          return triggerCombatLoss;\r\n        }\r\n      }\r\n\r\n      if (getCurrentEnemyHP(newState) <= 0) {\r\n        const shouldPreventDeath = DeathInterceptors.getAll()\r\n          .map((interceptor) => interceptor(newState, AttackTarget.Enemy))\r\n          .some((value) => value);\r\n        if (!shouldPreventDeath) {\r\n          return (state) => {\r\n            const currentEnemy = getCurrentEnemy(state);\r\n            state = pushToMessageLog(\r\n              state,\r\n              t(\"You defeated {{enemy}}!\", { enemy: currentEnemy.getName() }),\r\n            );\r\n            state = currentEnemy.onDeath(state, false);\r\n            const floorId = state.run.exploration.currentDungeonFloorId;\r\n            const floor = DungeonFloors.getById(floorId);\r\n            const couldFightBoss = floor.canFightBoss(state);\r\n            state.run.exploration.successfulExplorationsPerFloor[floorId] =\r\n              getSuccessfulExplorationsForFloor(state, floorId) + 1;\r\n            const canFightBoss = floor.canFightBoss(state);\r\n            if (couldFightBoss != canFightBoss) {\r\n              state = clearCacheKey(\r\n                state,\r\n                (_state) => \"floorsAvailableForFamiliars\",\r\n              );\r\n            }\r\n            state = triggerEnemyDeathListeners(state, currentEnemy);\r\n\r\n            if (state.options.waitUntilFullyHealedBeforeExplore) {\r\n              state.run.exploration.explorationStatus =\r\n                ExplorationStatus.Reviving;\r\n              return state;\r\n            }\r\n\r\n            return startExplorationOrAutoAdvance(state);\r\n          };\r\n        }\r\n      }\r\n    },\r\n  );\r\n\r\n  registerTimeTickListener(\r\n    \"PlayerHPRegen\",\r\n    (state: GameState, timeElapsedSec: number) => {\r\n      const explorationStatus = getExplorationStatus(state);\r\n\r\n      // This is necessary or else the player never dies because they regenerate HP\r\n      // in the same update\r\n      const currentHP = getCurrentPlayerHP(state);\r\n      if (explorationStatus == ExplorationStatus.Combat && currentHP <= 0) {\r\n        return state;\r\n      }\r\n\r\n      const playerMaxHP = calculatePlayerMaxHP(state);\r\n      if (currentHP >= playerMaxHP) {\r\n        return state;\r\n      }\r\n\r\n      const hpRegenBase = calculatePlayerHPRegenRatioPerSec(state);\r\n      let hpRegenMultiplier = 1.0;\r\n      if (explorationStatus != ExplorationStatus.Combat) {\r\n        hpRegenMultiplier = 10.0;\r\n      }\r\n      state = modifyPlayerCurrentHP(\r\n        state,\r\n        playerMaxHP * hpRegenBase * hpRegenMultiplier * timeElapsedSec,\r\n        t(\"HP Regeneration\"),\r\n      );\r\n      return state;\r\n    },\r\n  );\r\n\r\n  function startExplorationOrAutoAdvance(state: GameState): GameState {\r\n    if (\r\n      state.run.autoAdvanceToNextFloor &&\r\n      getCurrentDungeonFloor(state).getNextFloor(state)?.isUnlocked?.(state)\r\n    ) {\r\n      return startExplorationOnFloor(\r\n        state,\r\n        getCurrentDungeonFloor(state).getNextFloor(state),\r\n      );\r\n    } else if (\r\n      state.run.autoAttemptBoss &&\r\n      getCurrentDungeonFloor(state).canFightBoss(state)\r\n    ) {\r\n      return startBossExploration(state);\r\n    }\r\n\r\n    return startExploration(state);\r\n  }\r\n\r\n  addGameStateListener(\"ContinueExplorationAfterReviving\", (newState) => {\r\n    if (\r\n      getExplorationStatus(newState) == ExplorationStatus.Reviving &&\r\n      getCurrentPlayerHP(newState) >= calculatePlayerMaxHP(newState) * 0.99\r\n    ) {\r\n      return startExplorationOrAutoAdvance;\r\n    }\r\n  });\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { GameState } from \"../GameState\";\r\nimport { FamiliarData, Familiars, FamiliarStatusType } from \"./Familiar\";\r\nimport { FamiliarClass } from \"./FamiliarClass\";\r\n\r\nexport function getCurrentCompanionId(state: GameState): string {\r\n  return getCurrentCompanionData(state)?.id;\r\n}\r\n\r\nexport function getCurrentCompanionData(\r\n  state: GameState,\r\n): FamiliarData | undefined {\r\n  return valuesOf(state.run.familiars).find(\r\n    (familiarData) =>\r\n      familiarData.status.status === FamiliarStatusType.Companion,\r\n  );\r\n}\r\n\r\nexport function getCurrentCompanionClass(\r\n  state: GameState,\r\n): FamiliarClass | undefined {\r\n  const companionData = getCurrentCompanionData(state);\r\n  if (companionData == null) {\r\n    return undefined;\r\n  }\r\n\r\n  return Familiars.getById(companionData.familiarClassId);\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { hasWorldFlag } from \"../../Flags\";\r\nimport { GameState, GameStateTransform } from \"../../GameState\";\r\nimport { Resource, grantResource } from \"../../Resources\";\r\nimport {\r\n  Familiars,\r\n  getCurrentCompanionData,\r\n  getFamiliarData,\r\n  pushToFamiliarMessageLog,\r\n  wouldBeThrottledIfPushingToCreatureMessageLog,\r\n} from \"../../familiars/Familiar\";\r\nimport { getCurrentCompanionClass } from \"../../familiars/FamiliarUtils\";\r\nimport { Identifiable } from \"../../generic/Identifiable\";\r\nimport { addToInventory } from \"../../items/Inventory\";\r\nimport { Items } from \"../../items/Items\";\r\nimport {\r\n  applyTransformations,\r\n  applyTransformationsCached,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { AttackTarget } from \"../AttackTarget\";\r\nimport { CombatStat, getCachedCombatStat } from \"../CombatStats\";\r\nimport {\r\n  getCumulativeLosses,\r\n  pushToMessageLog,\r\n  standardEnemyAttackEffect,\r\n} from \"../Exploration\";\r\nimport { hasCurrentActiveCompanion } from \"../Summoning\";\r\nimport { Enemies } from \"./Enemies\";\r\n\r\nexport interface BattlerStats {\r\n  maxHP: number;\r\n  attack: number;\r\n  attackDelay: number;\r\n  defense: number;\r\n  accuracy: number;\r\n  dodge: number;\r\n  crit: number;\r\n}\r\n\r\nexport interface BattlerAction {\r\n  name: string;\r\n  delay: number;\r\n  transform: GameStateTransform;\r\n}\r\n\r\nexport interface EnemyLoot {\r\n  itemId: string;\r\n  chance: number;\r\n  amount: number;\r\n  params?: any;\r\n}\r\n\r\nexport enum BestiaryState {\r\n  Hidden = \"Hidden\",\r\n  SpriteOnly = \"SpriteOnly\",\r\n  Basic = \"Basic\",\r\n  Expanded = \"Expanded\",\r\n  Loot = \"Loot\",\r\n}\r\n\r\nexport function getCombatStatFromBattlerStat(battlerStat: string): CombatStat {\r\n  switch (battlerStat) {\r\n    case \"maxHP\":\r\n      return CombatStat.MaxHP;\r\n    case \"attack\":\r\n      return CombatStat.Attack;\r\n    case \"attackDelay\":\r\n      return CombatStat.AttackDelay;\r\n    case \"defense\":\r\n      return CombatStat.Defense;\r\n    case \"accuracy\":\r\n      return CombatStat.Accuracy;\r\n    case \"dodge\":\r\n      return CombatStat.Dodge;\r\n    case \"crit\":\r\n      return CombatStat.Crit;\r\n  }\r\n  throw new Error(\"Invalid battler stat\");\r\n}\r\n\r\nexport function getCumulativeEnemyKills(\r\n  state: GameState,\r\n  enemyId: string,\r\n): number {\r\n  return (\r\n    getCumulativeEnemyKillsFromCreatures(state, enemyId) +\r\n    (state.world.timesEnemyDefeated?.[enemyId]?.player ?? 0)\r\n  );\r\n}\r\n\r\nexport function getCumulativeEnemyKillsFromCreatures(\r\n  state: GameState,\r\n  enemyId: string,\r\n): number {\r\n  return state.world.timesEnemyDefeated?.[enemyId]?.familiars ?? 0;\r\n}\r\n\r\nexport function getBestiaryVisibleEnemies(state: GameState): Enemy[] {\r\n  return Enemies.getAll().filter(\r\n    (enemy) => enemy.getBestiaryState(state) != BestiaryState.Hidden,\r\n  );\r\n}\r\n\r\nexport function isBestiaryUnlocked(state: GameState): boolean {\r\n  return hasWorldFlag(state, \"storyline_bookOfMonsters_completed\");\r\n}\r\n\r\nconst enemyStatTags = memoize((stat) => [AttackTarget.Enemy, stat]);\r\n\r\nexport const KILLS_FOR_EXPANDED_BESTIARY = 10;\r\nexport const KILLS_FOR_BESTIARY_LOOT = 50;\r\n\r\nexport abstract class Enemy implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getName(): string;\r\n  abstract getBaseStats(): BattlerStats;\r\n  abstract getPicture(state: GameState): any;\r\n  abstract getLevel(): number;\r\n\r\n  getMaxHP(state: GameState): number {\r\n    return getCachedCombatStat(\r\n      state,\r\n      AttackTarget.Enemy,\r\n      CombatStat.MaxHP,\r\n      (state) =>\r\n        applyTransformations(\r\n          enemyStatTags(CombatStat.MaxHP),\r\n          state,\r\n          this.getBaseStats().maxHP,\r\n        ),\r\n    );\r\n  }\r\n  getAttack(state: GameState): number {\r\n    return getCachedCombatStat(\r\n      state,\r\n      AttackTarget.Enemy,\r\n      CombatStat.Attack,\r\n      (state) =>\r\n        applyTransformations(\r\n          enemyStatTags(CombatStat.Attack),\r\n          state,\r\n          this.getBaseStats().attack,\r\n        ),\r\n    );\r\n  }\r\n  getAttackDelay(state: GameState): number {\r\n    // Transformed elsewhere\r\n    return this.getBaseStats().attackDelay;\r\n  }\r\n  getCriticalPoints(state: GameState): number {\r\n    return getCachedCombatStat(\r\n      state,\r\n      AttackTarget.Enemy,\r\n      CombatStat.Crit,\r\n      (state) =>\r\n        applyTransformations(\r\n          enemyStatTags(CombatStat.Crit),\r\n          state,\r\n          this.getBaseStats().crit,\r\n        ),\r\n    );\r\n  }\r\n  getDefense(state: GameState): number {\r\n    return getCachedCombatStat(\r\n      state,\r\n      AttackTarget.Enemy,\r\n      CombatStat.Defense,\r\n      (state) =>\r\n        applyTransformations(\r\n          enemyStatTags(CombatStat.Defense),\r\n          state,\r\n          this.getBaseStats().defense,\r\n        ),\r\n    );\r\n  }\r\n  getAccuracyPoints(state: GameState): number {\r\n    return getCachedCombatStat(\r\n      state,\r\n      AttackTarget.Enemy,\r\n      CombatStat.Accuracy,\r\n      (state) =>\r\n        applyTransformations(\r\n          enemyStatTags(CombatStat.Accuracy),\r\n          state,\r\n          this.getBaseStats().accuracy,\r\n        ),\r\n    );\r\n  }\r\n  getDodgePoints(state: GameState): number {\r\n    return getCachedCombatStat(\r\n      state,\r\n      AttackTarget.Enemy,\r\n      CombatStat.Dodge,\r\n      (state) =>\r\n        applyTransformations(\r\n          enemyStatTags(CombatStat.Dodge),\r\n          state,\r\n          this.getBaseStats().dodge,\r\n        ),\r\n    );\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  abstract getCoinsAwardedBase(state: GameState): number;\r\n\r\n  abstract getMonstiumAwardedBase(state: GameState): number;\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getBackdropColor(state: GameState): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBestiaryState(state: GameState): BestiaryState {\r\n    const kills = getCumulativeEnemyKills(state, this.getId());\r\n    const losses = getCumulativeLosses(state, this.getId());\r\n    if (kills >= (this.isBoss() ? 1 : KILLS_FOR_BESTIARY_LOOT)) {\r\n      return BestiaryState.Loot;\r\n    }\r\n    if (kills >= (this.isBoss() ? 1 : KILLS_FOR_EXPANDED_BESTIARY)) {\r\n      return BestiaryState.Expanded;\r\n    }\r\n    if (kills > 0 || losses >= 2) {\r\n      return BestiaryState.Basic;\r\n    }\r\n    if (losses > 0) {\r\n      return BestiaryState.SpriteOnly;\r\n    }\r\n    return BestiaryState.Hidden;\r\n  }\r\n\r\n  lootTags = memoize((isFromCreatures, resource) => [\r\n    TransformationTags.Loot,\r\n    resource,\r\n    isFromCreatures\r\n      ? TransformationTags.FromFamiliarExploration\r\n      : TransformationTags.FromExploration,\r\n  ]);\r\n\r\n  lootChanceTags = memoize((isFromCreatures) => [\r\n    TransformationTags.LootChance,\r\n    isFromCreatures\r\n      ? TransformationTags.FromFamiliarExploration\r\n      : TransformationTags.FromExploration,\r\n  ]);\r\n\r\n  onEncounter(state: GameState): GameState {\r\n    return state;\r\n  }\r\n\r\n  onPlayerDeath(state: GameState): GameState {\r\n    return state;\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromFamiliars: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    const totalTimesDefeated = state.world.timesEnemyDefeated?.[\r\n      this.getId()\r\n    ] ?? { player: 0, familiars: 0, losses: 0 };\r\n    if (isFromFamiliars) {\r\n      totalTimesDefeated.familiars++;\r\n    } else {\r\n      totalTimesDefeated.player++;\r\n    }\r\n    state.world.timesEnemyDefeated[this.getId()] = totalTimesDefeated;\r\n\r\n    const baseCoinsAwarded = this.getCoinsAwardedBase(state);\r\n    const baseMonstiumAwarded = this.getMonstiumAwardedBase(state);\r\n    const coinsAwarded = applyTransformationsCached(\r\n      this.lootTags(isFromFamiliars, Resource.Coins),\r\n      state,\r\n      baseCoinsAwarded,\r\n    );\r\n    const monstiumAwarded = applyTransformationsCached(\r\n      this.lootTags(isFromFamiliars, Resource.Monstium),\r\n      state,\r\n      baseMonstiumAwarded,\r\n    );\r\n    const familiarExpAwarded = applyTransformationsCached(\r\n      this.lootTags(isFromFamiliars, TransformationTags.FamiliarExp),\r\n      state,\r\n      baseMonstiumAwarded / 2,\r\n    );\r\n\r\n    state = grantResource(Resource.Coins, coinsAwarded)(state);\r\n    state = grantResource(Resource.Monstium, monstiumAwarded)(state);\r\n    if (!isFromFamiliars) {\r\n      state = pushToMessageLog(\r\n        state,\r\n        t(\r\n          `You found {{coinsAwarded}} :coins: and {{monstiumAwarded}} :monstium:!`,\r\n          {\r\n            coinsAwarded: formatNumber(coinsAwarded),\r\n            monstiumAwarded: formatNumber(monstiumAwarded),\r\n          },\r\n        ),\r\n      );\r\n      if (hasCurrentActiveCompanion(state)) {\r\n        const familiar = getCurrentCompanionData(state);\r\n        const familiarClass = getCurrentCompanionClass(state);\r\n        const oldLevel = familiarClass.getLevel(state, familiar.id);\r\n        familiar.exp += familiarExpAwarded;\r\n        const newLevel = familiarClass.getLevel(state, familiar.id);\r\n        if (newLevel > oldLevel) {\r\n          state = pushToMessageLog(\r\n            state,\r\n            t(\r\n              `Your familiar earned {{expAwarded}} exp and leveled up to {{newLevel}}!`,\r\n              {\r\n                expAwarded: formatNumber(familiarExpAwarded),\r\n                newLevel: formatNumber(newLevel),\r\n              },\r\n            ),\r\n          );\r\n          state = pushToFamiliarMessageLog(\r\n            state,\r\n            familiar.id,\r\n            t(\r\n              `Your familiar earned {{expAwarded}} exp and leveled up to {{newLevel}}!`,\r\n              {\r\n                expAwarded: formatNumber(familiarExpAwarded),\r\n                newLevel: formatNumber(newLevel),\r\n              },\r\n            ),\r\n          );\r\n        } else {\r\n          state = pushToMessageLog(\r\n            state,\r\n            t(`Your familiar earned {{expAwarded}} exp!`, {\r\n              expAwarded: formatNumber(familiarExpAwarded),\r\n            }),\r\n          );\r\n          state = pushToFamiliarMessageLog(\r\n            state,\r\n            familiar.id,\r\n            t(`Your familiar earned {{expAwarded}} exp!`, {\r\n              expAwarded: formatNumber(familiarExpAwarded),\r\n            }),\r\n          );\r\n        }\r\n      }\r\n    } else {\r\n      const familiar = getFamiliarData(state, familiarId);\r\n      const familiarClass = Familiars.getById(familiar.familiarClassId);\r\n      const oldLevel = familiarClass.getLevel(state, familiar.id);\r\n      familiar.exp += familiarExpAwarded;\r\n      const newLevel = familiarClass.getLevel(state, familiar.id);\r\n      if (!wouldBeThrottledIfPushingToCreatureMessageLog(state, familiarId)) {\r\n        state = pushToFamiliarMessageLog(\r\n          state,\r\n          familiarId,\r\n          t(\r\n            `Your familiar found {{coinsAwarded}} :coins: and {{monstiumAwarded}} :monstium:!`,\r\n            {\r\n              coinsAwarded: formatNumber(coinsAwarded),\r\n              monstiumAwarded: formatNumber(monstiumAwarded),\r\n            },\r\n          ),\r\n        );\r\n        if (newLevel > oldLevel) {\r\n          state = pushToFamiliarMessageLog(\r\n            state,\r\n            familiar.id,\r\n            t(\r\n              `Your familiar earned {{expAwarded}} exp and leveled up to {{newLevel}}!`,\r\n              {\r\n                expAwarded: formatNumber(familiarExpAwarded),\r\n                newLevel: formatNumber(newLevel),\r\n              },\r\n            ),\r\n          );\r\n        } else {\r\n          state = pushToFamiliarMessageLog(\r\n            state,\r\n            familiar.id,\r\n            t(`Your familiar earned {{expAwarded}} exp!`, {\r\n              expAwarded: formatNumber(familiarExpAwarded),\r\n            }),\r\n          );\r\n        }\r\n      }\r\n    }\r\n    const itemsAwarded = this.getItemsAwardedBase(state);\r\n    itemsAwarded.forEach((enemyLoot) => {\r\n      let chance = enemyLoot.chance;\r\n      chance = applyTransformations(\r\n        this.lootChanceTags(isFromFamiliars),\r\n        state,\r\n        chance,\r\n      );\r\n      if (Math.random() < chance) {\r\n        const item = Items.getById(enemyLoot.itemId);\r\n        const params = enemyLoot.params || {};\r\n        const itemOccurrence = { itemId: enemyLoot.itemId, params };\r\n        const amount = applyTransformations(\r\n          this._memoizedEnemyLootTags(enemyLoot.itemId, isFromFamiliars),\r\n          state,\r\n          enemyLoot.amount,\r\n        );\r\n        state = addToInventory(itemOccurrence, amount, state);\r\n        const foundLoot =\r\n          state.world.knownEnemiesThatDrop[enemyLoot.itemId] ?? {};\r\n        if (!foundLoot[this.getId()]) {\r\n          foundLoot[this.getId()] = true;\r\n        }\r\n        state.world.knownEnemiesThatDrop[enemyLoot.itemId] = foundLoot;\r\n        if (!isFromFamiliars) {\r\n          state = pushToMessageLog(\r\n            state,\r\n            t(\"You found {{amount}} {{item}}!\", {\r\n              amount: amount,\r\n              item: item.getName(params),\r\n            }),\r\n          );\r\n        } else {\r\n          state = pushToFamiliarMessageLog(\r\n            state,\r\n            familiarId,\r\n            t(\"Your familiar found {{amount}} {{item}}!\", {\r\n              amount: amount,\r\n              item: item.getName(params),\r\n            }),\r\n          );\r\n        }\r\n      }\r\n    });\r\n    return state;\r\n  }\r\n\r\n  _memoizedEnemyLootTags = memoize(\r\n    (enemyLootId: string, isFromFamiliars: boolean): string[] => {\r\n      return [\r\n        TransformationTags.LootItemAmount,\r\n        enemyLootId,\r\n        this.getId(),\r\n        isFromFamiliars\r\n          ? TransformationTags.FromFamiliarExploration\r\n          : TransformationTags.FromExploration,\r\n      ];\r\n    },\r\n  );\r\n\r\n  // Tips on how to fight\r\n  getTips(): string | undefined {\r\n    return undefined;\r\n  }\r\n}\r\n","import {\r\n  ACHIEVEMENTS_SUPPORTED,\r\n  unlockAchievementRaw,\r\n} from \"../utils/Achievements\";\r\nimport { Achievement } from \"./Achievement\";\r\nimport { SetFlagListeners, hasEverHadFlag, hasFlag } from \"./Flags\";\r\nimport { GameState } from \"./GameState\";\r\nimport { addGameStateListener } from \"./GameStateListeners\";\r\nimport { addEnemyDeathListener } from \"./exploration/Exploration\";\r\nimport { Enemy, getCumulativeEnemyKills } from \"./exploration/enemies/Enemy\";\r\nimport { DataStore } from \"./generic/DataStore\";\r\nimport { Storyline } from \"./storylines/Storyline\";\r\n\r\nconst achievementsUnlocked: Partial<Record<Achievement, boolean>> = {};\r\n\r\nexport function registerAchievementUnlocker(\r\n  checker: (state: GameState) => boolean,\r\n  achievement: Achievement,\r\n) {\r\n  // Do not add achievements if not supported, to avoid all the calculations\r\n  if (ACHIEVEMENTS_SUPPORTED) {\r\n    addGameStateListener(achievement + \"unlocker\", (state) => {\r\n      // Using local stored values for throttling rather than flags,\r\n      // so that restarting the game will re-unlock achievements, just in case\r\n      if (!achievementsUnlocked?.[achievement] && checker(state)) {\r\n        unlockAchievement(achievement);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n// Prefer not to use as achievement sync is unsupported\r\nexport function unlockAchievement(achievement: Achievement) {\r\n  if (!achievementsUnlocked?.[achievement]) {\r\n    achievementsUnlocked[achievement] = true;\r\n    if (ACHIEVEMENTS_SUPPORTED) {\r\n      unlockAchievementRaw(achievement);\r\n    }\r\n  }\r\n}\r\n\r\nexport const AchievementSyncListeners = new DataStore<\r\n  (state: GameState) => void\r\n>();\r\n\r\nexport function runAchievementSync(state: GameState) {\r\n  if (ACHIEVEMENTS_SUPPORTED) {\r\n    for (let listener of AchievementSyncListeners.getAll()) {\r\n      listener(state);\r\n    }\r\n  }\r\n}\r\n\r\nexport function registerAchievementUnlockerFromFlag(\r\n  flag: string,\r\n  achievement: Achievement,\r\n) {\r\n  if (ACHIEVEMENTS_SUPPORTED) {\r\n    SetFlagListeners.register((state, flagSet) => {\r\n      if (flagSet == flag && hasFlag(state, flagSet)) {\r\n        unlockAchievement(achievement);\r\n      }\r\n      return state;\r\n    }, achievement + \"-achievementUnlocker\");\r\n    AchievementSyncListeners.register((state) => {\r\n      if (hasEverHadFlag(state, flag)) {\r\n        unlockAchievement(achievement);\r\n      }\r\n    }, achievement + \"-syncUnlocker\");\r\n  }\r\n}\r\n\r\nexport function registerAchievementUnlockerFromEnemy(\r\n  enemy: Enemy,\r\n  achievement: Achievement,\r\n) {\r\n  if (ACHIEVEMENTS_SUPPORTED) {\r\n    addEnemyDeathListener(\r\n      achievement + \"-achievementUnlocker\",\r\n      (state: GameState, enemyDefeated: Enemy) => {\r\n        if (enemyDefeated == enemy) {\r\n          unlockAchievement(achievement);\r\n        }\r\n        return state;\r\n      },\r\n    );\r\n    AchievementSyncListeners.register((state) => {\r\n      if (getCumulativeEnemyKills(state, enemy.getId()) > 0) {\r\n        unlockAchievement(achievement);\r\n      }\r\n    }, achievement + \"-syncUnlocker\");\r\n  }\r\n}\r\n\r\nexport function registerAchievementUnlockerFromStoryline(\r\n  storyline: Storyline,\r\n  achievement: Achievement,\r\n) {\r\n  registerAchievementUnlockerFromFlag(\r\n    storyline.getCompletedFlag(),\r\n    achievement,\r\n  );\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { Storyline } from \"../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"combatClasses\",\r\n  t(\"Types of Wizards\"),\r\n  150,\r\n  10,\r\n  t(\"Complete Combat Training\"),\r\n  t(\"Unlock ability to choose a Class after retirement\"),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as CombatClassesStoryline };\r\n","import memoize from \"sonic-memoize\";\r\nimport { GameState } from \"../GameState\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport {\r\n  applyTransformationsPermaCached,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { CombatClassesStoryline } from \"./CombatClassesStoryline\";\r\n\r\nexport abstract class CombatClass implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getDisplayName(): string;\r\n  abstract getDisplayDescription(state: GameState): string;\r\n  abstract getDisplayEffect(state: GameState): string;\r\n\r\n  isActive(state: GameState): boolean {\r\n    return getCurrentCombatClass(state) == this;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return isCombatClassSelectionUnlocked(state);\r\n  }\r\n\r\n  protected getBaseClassEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getCachedBaseClassEffects = memoize(() => this.getBaseClassEffects());\r\n\r\n  tagsByEffect: Record<string, string[]> = {};\r\n  getTagsByEffect(key: string, baseEffect: ActionEffect): string[] {\r\n    if (this.tagsByEffect?.[key] == null) {\r\n      this.tagsByEffect[key] = [\r\n        ...(baseEffect.tags ?? []),\r\n        TransformationTags.ClassEffect,\r\n        key,\r\n      ];\r\n    }\r\n    return this.tagsByEffect[key];\r\n  }\r\n\r\n  getClassEffects(state: GameState, onlyId?: string): Record<string, number> {\r\n    const baseEffects = this.getCachedBaseClassEffects();\r\n    const finalEffects: Record<string, number> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = applyTransformationsPermaCached(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  getClassEffectExplanations(\r\n    state: GameState,\r\n    onlyId?: string,\r\n  ): Record<string, string> {\r\n    const baseEffects = this.getCachedBaseClassEffects();\r\n    const finalEffects: Record<string, string> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = explainTransformationsText(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        {\r\n          unit: baseEffect.unit,\r\n          valueType: baseEffect.valueType,\r\n        },\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n}\r\n\r\nexport const CombatClasses = new DataStore<CombatClass>();\r\n\r\nexport function isCombatClassSelectionUnlocked(state: GameState): boolean {\r\n  return CombatClassesStoryline.isBonusActive(state);\r\n}\r\n\r\nexport function getCurrentCombatClass(\r\n  state: GameState,\r\n): CombatClass | undefined {\r\n  return state.run.combatClassId != null\r\n    ? CombatClasses.getById(state.run.combatClassId)\r\n    : undefined;\r\n}\r\n\r\nexport function getSelectableCombatClasses(state: GameState): CombatClass[] {\r\n  if (!isCombatClassSelectionUnlocked(state)) {\r\n    return [];\r\n  }\r\n  return CombatClasses.getAll().filter((combatClass) =>\r\n    combatClass.isVisible(state),\r\n  );\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Storyline } from \"./Storyline\";\r\n\r\nexport const Storylines = new DataStore<Storyline>();\r\n\r\nfunction _getSortedStorylines(): Storyline[] {\r\n  return Storylines.getAll().sort((a, b) => a.order - b.order);\r\n}\r\n\r\nexport const getSortedStorylines = memoize(_getSortedStorylines);\r\n\r\nexport const getTotalStorylineCount = () => Storylines.getAll().length - 1;\r\n\r\nexport const storylineHintUnlockChecker = (state) => {\r\n  const storylines = Storylines.getAll().filter((storyline) =>\r\n    storyline.shouldRevealHint(state),\r\n  );\r\n  if (storylines.length > 0) {\r\n    storylines.forEach((storyline) => {\r\n      state = storyline.revealHint(state);\r\n    });\r\n  }\r\n  return state;\r\n};\r\n","import { clone } from \"../../utils/CoreUtils\";\r\nimport { Achievement } from \"../Achievement\";\r\nimport { registerAchievementUnlocker } from \"../Achievements\";\r\nimport { getCurrentCombatClass } from \"../classes/CombatClasses\";\r\nimport { EndingStats, GameState, GameStateTransform } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport {\r\n  getElementLevel,\r\n  getMaxOfMaxPrimaryElementLevels,\r\n  getPrimaryElements,\r\n  maximumElementLevelExpMultiplier,\r\n  maximumElementLevelProductionMultiplierDx,\r\n} from \"../spells/Elements\";\r\nimport { Storylines } from \"../storylines/Storylines\";\r\nimport { addUICommand } from \"../UICommands\";\r\n\r\nexport type Ending = {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  storylineId: string;\r\n};\r\n\r\nexport const Endings = new DataStore<Ending>();\r\n\r\nexport function addEnding(\r\n  id: string,\r\n  title: string,\r\n  contents: string,\r\n  storylineId: string,\r\n): void {\r\n  Endings.register({ id, description: contents, title, storylineId }, id);\r\n\r\n  registerAchievementUnlocker(\r\n    (state) => hasEverTriggeredEnding(state, id),\r\n    id as Achievement,\r\n  );\r\n}\r\n\r\nexport function getEndingData(state: GameState): EndingStats | undefined {\r\n  return state.run.endingTriggered;\r\n}\r\n\r\nexport function hasEverTriggeredEnding(state: GameState, id: string): boolean {\r\n  return state.world.endingsHistory.some((ending) => ending.endingId == id);\r\n}\r\n\r\nexport const EndingCloseListeners = new DataStore<GameStateTransform>();\r\n\r\nexport function setGameEnding(state: GameState, id: string): GameState {\r\n  if (\r\n    state.run.endingTriggered != null &&\r\n    state.run.endingTriggered.endingId === id\r\n  ) {\r\n    // Do nothing\r\n    return state;\r\n  }\r\n\r\n  const ending = Endings.getById(id);\r\n  const storyline = Storylines.getById(ending.storylineId);\r\n  if (!storyline.isCompleted(state)) {\r\n    state = storyline.complete(state);\r\n  }\r\n\r\n  const allStorylines = Storylines.getAll();\r\n  const completedStorylines = allStorylines.filter((storyline) => {\r\n    return storyline.isCompleted(state);\r\n  });\r\n  state.run.endingTriggered = {\r\n    endingId: id,\r\n    timestamp: Date.now(),\r\n    challengeId: state.run.currentChallengeId,\r\n    totalTimePlayed: state.global.secondsPlayed,\r\n    totalTimePlayedThisWorld: state.world.secondsPlayed,\r\n    totalTimePlayedThisRun: state.run.secondsPlayed,\r\n    totalActiveTimePlayed: state.global.activeSecondsPlayed,\r\n    totalActiveTimePlayedThisWorld: state.world.activeSecondsPlayed,\r\n    totalActiveTimePlayedThisRun: state.run.activeSecondsPlayed,\r\n    totalRealWorldTimePlayed: (Date.now() - state.global.startTimestamp) / 1000,\r\n    totalRealWorldTimePlayedThisWorld:\r\n      (Date.now() - state.world.startTimestamp) / 1000,\r\n    totalRealWorldTimePlayedThisRun:\r\n      (Date.now() - state.run.startTimestamp) / 1000,\r\n    timePiecesConsumed: state.global.timePiecesConsumed,\r\n    timePiecesConsumedThisWorld: state.world.timePiecesConsumed,\r\n    timePiecesConsumedThisRun: state.run.timePiecesConsumed,\r\n    totalRetirements: state.world.totalTimesResetted,\r\n    primaryElement: getPrimaryElements(state)?.[0],\r\n    primaryElementLevelOnEnding: getElementLevel(\r\n      state,\r\n      getPrimaryElements(state)?.[0],\r\n    ),\r\n    secondaryElement: getPrimaryElements(state)?.[1],\r\n    secondaryElementLevelOnEnding:\r\n      getPrimaryElements(state).length > 1\r\n        ? getElementLevel(state, getPrimaryElements(state)?.[1])\r\n        : undefined,\r\n    combatClassId: getCurrentCombatClass(state)?.getId?.(),\r\n    mpl: getMaxOfMaxPrimaryElementLevels(state),\r\n    researchMultiplier: maximumElementLevelExpMultiplier(state),\r\n    productionMultiplier: maximumElementLevelProductionMultiplierDx(state),\r\n    completedStorylines: completedStorylines.length,\r\n    worldsCreated: state.global.newGamePlusCount,\r\n    sheerPowerLevel: state.world.sheerPowerLevel,\r\n    storylineOracleLevel: state.world.storylineOracleLevel,\r\n    blazingSpeedLevel: state.world.blazingSpeedLevel,\r\n    worldDifficultyLevel: state.world.worldDifficultyLevel,\r\n  };\r\n  const endingsHistory = state.world.endingsHistory;\r\n  endingsHistory.push(clone(state.run.endingTriggered));\r\n  state.global.endingsHistory.push(clone(state.run.endingTriggered));\r\n  state = addUICommand(state, \"goToEnding\");\r\n  state = addUICommand(state, \"closeAllMenus\");\r\n  state = addUICommand(state, \"closeEventOverlay\");\r\n  return state;\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { EventMessage, EventMessageOption } from \"./GameEvent\";\r\n\r\nclass EmptyEventMessageImpl implements EventMessage {\r\n  constructor() {}\r\n\r\n  getId(): string {\r\n    return t(\"empty\");\r\n  }\r\n  getTitle(params: any): string {\r\n    return t(\"[Deleted]\");\r\n  }\r\n  getDescription(state: GameState, params: any): string {\r\n    return t(\"This is a deleted game event\");\r\n  }\r\n  getAllowedOptions(state: GameState, params: any): EventMessageOption[] {\r\n    return [];\r\n  }\r\n  isTerminal(): boolean {\r\n    return true;\r\n  }\r\n  isActionable(state: GameState, params: any): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst EmptyEventMessage = new EmptyEventMessageImpl();\r\n\r\nexport { EmptyEventMessage };\r\n","import { GameState } from \"../GameState\";\r\nimport { Storyline } from \"../storylines/Storyline\";\r\n\r\nexport enum EventTag {\r\n  MAIN_QUEST = \"MAIN_QUEST\",\r\n  INCONSEQUENTIAL_RANDOM_EVENT = \"INCONSEQUENTIAL_RANDOM_EVENT\",\r\n  LEVEL_UP = \"LEVEL_UP\",\r\n  LEVEL_UP_EMPTY = \"LEVEL_UP_EMPTY\",\r\n  LEVEL_UP_ALREADY_REACHED = \"LEVEL_UP_ALREADY_REACHED\",\r\n  MAIN_QUEST_SEEN_BEFORE = \"MAIN_QUEST_SEEN_BEFORE\",\r\n  STORYLINE = \"STORYLINE\",\r\n  DO_NOT_AUTO_TRIGGER_IF_ONGOING = \"DO_NOT_AUTO_TRIGGER_IF_ONGOING\",\r\n  DO_NOT_POPUP = \"DO_NOT_POPUP\",\r\n  DO_NOT_POPUP_IF_BOSS_FIGHT = \"DO_NOT_POPUP_IF_BOSS_FIGHT\",\r\n}\r\n\r\nexport type EventTransform = (state: GameState, params: any) => GameState;\r\n\r\nexport interface EventMessageOption {\r\n  description: string;\r\n  isEnabled: boolean;\r\n  transform?: (state: GameState, params: any) => GameState;\r\n  nextMessage?: EventMessage;\r\n}\r\n\r\nexport interface EventMessage {\r\n  getId(): string;\r\n  getTitle(params: any): string;\r\n  getDescription(state: GameState, params: any): string;\r\n  getAllowedOptions(state: GameState, params: any): EventMessageOption[];\r\n  isTerminal(): boolean;\r\n  isActionable(state: GameState, params: any): boolean;\r\n}\r\n\r\nexport interface GameEvent {\r\n  getId(): string;\r\n  getMainEventMessage(): EventMessage;\r\n  onTrigger(): EventTransform;\r\n  hasTriggered(state: GameState): boolean;\r\n  hasEverTriggered(state: GameState): boolean;\r\n  getTags(): EventTag[];\r\n  getStorylines(): Storyline[];\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { setWorldFlag } from \"../Flags\";\r\nimport { GameState, GameStateTransform } from \"../GameState\";\r\nimport { getCurrentEnemyHP } from \"../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../exploration/ExplorationUtils\";\r\nimport { getCurrentEnemy } from \"../exploration/enemies/Enemies\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { EmptyEventMessage } from \"./EmptyEventMessage\";\r\nimport {\r\n  EventMessage,\r\n  EventMessageOption,\r\n  EventTag,\r\n  GameEvent,\r\n} from \"./GameEvent\";\r\n\r\nconst eventMessages: Record<string, EventMessage> = {};\r\n\r\nexport function registerEventMessage(message: EventMessage) {\r\n  eventMessages[message.getId()] = message;\r\n}\r\n\r\nexport function eventMessageExists(id: string): boolean {\r\n  return Boolean(eventMessages?.[id]);\r\n}\r\n\r\nexport function getEventMessageById(id: string): EventMessage {\r\n  return (eventMessages?.[id] || EmptyEventMessage) as EventMessage;\r\n}\r\n\r\nexport type EventOccurrenceData = {\r\n  eventOccurrenceId: string;\r\n  eventId: string;\r\n  currentMessageId: string | null;\r\n  timestamp: number;\r\n  timestampSecondsPlayed: number;\r\n  params: any;\r\n  messageHistory: string[];\r\n};\r\n\r\nconst gameEvents: Record<string, GameEvent> = {};\r\n\r\nexport function registerGameEvent(event: GameEvent) {\r\n  gameEvents[event.getId()] = event;\r\n}\r\n\r\nexport function getGameEventById(id: string): GameEvent {\r\n  return gameEvents?.[id] as GameEvent;\r\n}\r\n\r\nexport function getAllGameEvents(): Record<string, GameEvent> {\r\n  return gameEvents;\r\n}\r\n\r\nexport function getEventOccurrenceById(\r\n  state: GameState,\r\n  id: string,\r\n): EventOccurrenceData | undefined {\r\n  return state.run.eventOccurrences?.[id];\r\n}\r\n\r\nfunction executeEventOccurrenceActionImpl(\r\n  occurrenceId: string,\r\n  selectedOption: EventMessageOption,\r\n  state: GameState,\r\n) {\r\n  const nextMessage = selectedOption.nextMessage;\r\n  if (nextMessage) {\r\n    if (state.run.eventOccurrences[occurrenceId].messageHistory == null) {\r\n      state.run.eventOccurrences[occurrenceId].messageHistory = [];\r\n    }\r\n    state.run.eventOccurrences[occurrenceId].messageHistory.push(\r\n      state.run.eventOccurrences[occurrenceId].currentMessageId as string,\r\n    );\r\n    state.run.eventOccurrences[occurrenceId].currentMessageId =\r\n      nextMessage.getId();\r\n\r\n    // Do this to avoid accidentally cleaning up events after they go terminal\r\n    if (nextMessage.isTerminal()) {\r\n      state.run.eventOccurrences[occurrenceId].timestamp = Date.now();\r\n      state.run.eventOccurrences[occurrenceId].timestampSecondsPlayed =\r\n        getSecondsPlayed(state);\r\n    }\r\n  }\r\n\r\n  if (selectedOption.transform) {\r\n    state = selectedOption.transform(\r\n      state,\r\n      state.run.eventOccurrences[occurrenceId].params,\r\n    );\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function executeEventOccurrenceAction(\r\n  this: any,\r\n  occurrenceId: string,\r\n  selectedOption: EventMessageOption,\r\n): GameStateTransform {\r\n  return executeEventOccurrenceActionImpl.bind(\r\n    this,\r\n    occurrenceId,\r\n    selectedOption,\r\n  );\r\n}\r\n\r\nexport function jumpEventToMessageIfExists(\r\n  state: GameState,\r\n  eventId: string,\r\n  messageId: string,\r\n): GameState {\r\n  const eventOccurrence = valuesOf(state.run.eventOccurrences).find(\r\n    (eventOccurrence) => eventOccurrence.eventId == eventId,\r\n  );\r\n  if (eventOccurrence == null) {\r\n    return state;\r\n  }\r\n\r\n  eventOccurrence.messageHistory.push(eventOccurrence.currentMessageId);\r\n  eventOccurrence.currentMessageId = eventId + messageId;\r\n  eventOccurrence.timestamp = Date.now();\r\n  state = addOccurrenceToQueueImpl(eventOccurrence.eventOccurrenceId, state);\r\n\r\n  return state;\r\n}\r\n\r\nfunction addOccurrenceToQueueImpl(occurrenceId: string, state: GameState) {\r\n  if (!state.run.eventQueue.includes(occurrenceId)) {\r\n    state.run.eventQueue.push(occurrenceId);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function addOccurrenceToQueue(\r\n  this: any,\r\n  occurrenceId: string,\r\n): GameStateTransform {\r\n  return addOccurrenceToQueueImpl.bind(this, occurrenceId);\r\n}\r\n\r\nfunction removeOccurrenceFromQueueImpl(occurrenceId: string, state: GameState) {\r\n  const position = state.run.eventQueue.lastIndexOf(occurrenceId);\r\n  if (position >= 0) {\r\n    state.run.eventQueue.splice(position, 1);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport function removeOccurrenceFromQueue(\r\n  this: any,\r\n  occurrenceId: string,\r\n): GameStateTransform {\r\n  return removeOccurrenceFromQueueImpl.bind(this, occurrenceId);\r\n}\r\n\r\nfunction triggerEventImpl(\r\n  event: GameEvent,\r\n  params: any,\r\n  extraTags: EventTag[],\r\n  state: GameState,\r\n) {\r\n  const totalTags: EventTag[] = [];\r\n  totalTags.push(...event.getTags());\r\n  totalTags.push(...extraTags);\r\n\r\n  if (\r\n    totalTags.includes(EventTag.DO_NOT_AUTO_TRIGGER_IF_ONGOING) &&\r\n    !state.run.nextEventIsManuallyTriggered\r\n  ) {\r\n    const isAlreadyOngoing = Object.values(state.run.eventOccurrences).find(\r\n      (occurrenceData) =>\r\n        occurrenceData.eventId == event.getId() &&\r\n        occurrenceData.currentMessageId &&\r\n        !getEventMessageById(occurrenceData.currentMessageId).isTerminal(),\r\n    );\r\n    if (isAlreadyOngoing) {\r\n      return state;\r\n    }\r\n  }\r\n\r\n  if (totalTags.includes(EventTag.STORYLINE)) {\r\n    state = setWorldFlag(\"storyline_event_ever_triggered\")(state);\r\n  }\r\n\r\n  const occurrenceId = event.getId() + Date.now();\r\n  state.run.eventOccurrences[occurrenceId] = {\r\n    eventOccurrenceId: occurrenceId,\r\n    eventId: event.getId(),\r\n    currentMessageId: event.getMainEventMessage().getId(),\r\n    timestamp: Date.now(),\r\n    timestampSecondsPlayed: getSecondsPlayed(state),\r\n    params,\r\n    messageHistory: [],\r\n  };\r\n\r\n  const everTriggered = event.hasEverTriggered(state);\r\n  if (\r\n    totalTags.includes(EventTag.MAIN_QUEST) &&\r\n    state.options.hideEventTags.includes(EventTag.MAIN_QUEST_SEEN_BEFORE) &&\r\n    everTriggered\r\n  ) {\r\n    let currentMessage = getEventMessageById(\r\n      getEventOccurrenceById(state, occurrenceId).currentMessageId,\r\n    );\r\n    while (\r\n      !currentMessage.isTerminal() &&\r\n      currentMessage.getAllowedOptions(state, params).length == 1\r\n    ) {\r\n      state = executeEventOccurrenceActionImpl(\r\n        occurrenceId,\r\n        currentMessage.getAllowedOptions(state, params)[0],\r\n        state,\r\n      );\r\n      currentMessage = getEventMessageById(\r\n        getEventOccurrenceById(state, occurrenceId).currentMessageId,\r\n      );\r\n    }\r\n  }\r\n\r\n  const transform = event.onTrigger();\r\n  if (transform) {\r\n    state = transform(state, params);\r\n  }\r\n  if (\r\n    shouldPopUpEventWithTags(\r\n      state,\r\n      event,\r\n      occurrenceId,\r\n      totalTags,\r\n      everTriggered,\r\n    ) ||\r\n    state.run.nextEventIsManuallyTriggered\r\n  ) {\r\n    state.run.eventQueue.unshift(occurrenceId);\r\n  }\r\n  state.run.nextEventIsManuallyTriggered = false;\r\n  return state;\r\n}\r\n\r\nexport function triggerEvent(\r\n  this: any,\r\n  event: GameEvent,\r\n  params?: any,\r\n  extraTags?: EventTag[],\r\n): GameStateTransform {\r\n  return triggerEventImpl.bind(this, event, params || {}, extraTags ?? []);\r\n}\r\n\r\nexport function shouldHideEventsWithTag(\r\n  state: GameState,\r\n  tag: EventTag,\r\n): boolean {\r\n  return state.options.hideEventTags.includes(tag);\r\n}\r\n\r\nexport function shouldPopUpEventWithTags(\r\n  state: GameState,\r\n  event: GameEvent,\r\n  occurrenceId: string,\r\n  tags: EventTag[],\r\n  everTriggered: boolean,\r\n): boolean {\r\n  if (\r\n    tags.includes(EventTag.MAIN_QUEST) &&\r\n    state.options.hideEventTags.includes(EventTag.MAIN_QUEST_SEEN_BEFORE) &&\r\n    everTriggered\r\n  ) {\r\n    const currentMessage = getEventMessageById(\r\n      getEventOccurrenceById(state, occurrenceId).currentMessageId,\r\n    );\r\n    if (currentMessage.isTerminal()) {\r\n      return false;\r\n    }\r\n  }\r\n  if (\r\n    state.options.doNotPopupEventsDuringBossFights &&\r\n    getExplorationStatus(state) == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(state)?.isBoss?.() &&\r\n    getCurrentEnemyHP(state) > 0\r\n  ) {\r\n    return false;\r\n  }\r\n  return (\r\n    !state.options.hideEventTags.some((tag) => tags.includes(tag)) &&\r\n    !tags.includes(EventTag.DO_NOT_POPUP)\r\n  );\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { hasFlag, hasWorldFlag, setFlag, setWorldFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Storyline } from \"../storylines/Storyline\";\r\nimport { Storylines } from \"../storylines/Storylines\";\r\nimport { registerEventMessage, registerGameEvent } from \"./Events\";\r\nimport {\r\n  EventMessage,\r\n  EventMessageOption,\r\n  EventTag,\r\n  EventTransform,\r\n  GameEvent,\r\n} from \"./GameEvent\";\r\n\r\n/*\r\n// Usage of the new hotness:\r\nconst eventBuilder = buildEvent(\"EventId\", \"Event Title\", []);\r\neventBuilder.message(\"A\");\r\neventBuilder\r\n  .message(\"B\")\r\n  .option(\r\n    \"Charm\",\r\n    {\r\n      isVisible(state, params) {\r\n        return state.run.activeSecondsPlayed > 1;\r\n      },\r\n    },\r\n    \"C1\",\r\n  )\r\n  .option(\"Pay\", {}, \"C2\")\r\n  .option(\"Decline\", \"C3\");\r\neventBuilder\r\n  .message(\"C1\")\r\n  .option(\"Pay less\", {}, \"goto C2\")\r\n  .option(\"Decline\", \"goto C3\");\r\neventBuilder.message(\"C2\", \"C2\");\r\neventBuilder.message(\"D\");\r\neventBuilder.message(\"E\").end();\r\neventBuilder.message(\"C3\", \"C3\").end();\r\neventBuilder.build();\r\n*/\r\n\r\n/*\r\nstaffEventBuilder.createMessage()\r\n  .setSimpleDescription(\"A staff was found on the ground.\");\r\nstaffEventBuilder.createMessage()\r\n  .setSimpleDescription(\"It is shiny.\")\r\n  .addOption(\r\n    \"Pick up\",\r\n    { transform: grantResource(Resource.Mana, -100) },  \r\n    staffEventBuilder.createMessage()\r\n      .setSimpleDescription(\r\n        \"You pick up the staff. It's cursed! You feel your mana getting drained.\",\r\n      ),\r\n  )\r\n  .addOption(\r\n    \"Destroy\",\r\n    staffEventBuilder.createMessage()\r\n      .setSimpleDescription(\r\n        \"You destroy the staff. Wonder what it could have been...\",\r\n      ),\r\n  );\r\n\r\nconst staffEvent = staffEventBuilder.build();\r\n*/\r\n\r\n/*\r\nUsage:\r\n\r\nconst staffEventBuilder = buildEvent(\"RandomSpoutEvents_1\", \"Found a staff!\");\r\nstaffEventBuilder.createMessage()\r\n  .setSimpleDescription(\"A staff was found on the ground.\")\r\n  .addOption(\r\n    \"Pick up\",\r\n    { transform: grantResource(Resource.Mana, -100) },  \r\n    staffEventBuilder.createMessage()\r\n      .setSimpleDescription(\r\n        \"You pick up the staff. It's cursed! You feel your mana getting drained.\",\r\n      ),\r\n  )\r\n  .addOption(\r\n    \"Destroy\",\r\n    staffEventBuilder.createMessage()\r\n      .setSimpleDescription(\r\n        \"You destroy the staff. Wonder what it could have been...\",\r\n      ),\r\n  );\r\n\r\nconst staffEvent = staffEventBuilder.build();\r\n*/\r\n\r\nexport const STUB_OPTION: EventMessageOptionStub = {};\r\n\r\ntype EventMessageOptionWithVisibility = {\r\n  option: Omit<EventMessageOption, \"isEnabled\">;\r\n  isVisible?: (state: GameState, params?: any) => boolean;\r\n  isEnabled?: (state: GameState, params?: any) => boolean;\r\n};\r\n\r\nfunction replaceWithParams(text: string, params: any) {\r\n  if (!params) {\r\n    return text;\r\n  }\r\n  Object.keys(params)\r\n    .map((key) => [\r\n      new RegExp(\"/\" + key + \"/\", \"g\"),\r\n      isNaN(params[key]) || params[key] === \"\"\r\n        ? params[key]\r\n        : formatNumber(params[key]),\r\n    ])\r\n    .forEach((replacement) => {\r\n      text = text.replace(replacement[0], replacement[1]);\r\n    });\r\n  return text;\r\n}\r\n\r\nexport class EventMessageImpl implements EventMessage {\r\n  constructor(\r\n    private id: string,\r\n    private title: string,\r\n    private description: (state: GameState) => string,\r\n    private options: EventMessageOptionWithVisibility[],\r\n  ) {\r\n    registerEventMessage(this);\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n  getTitle(params: any): string {\r\n    return replaceWithParams(this.title, params);\r\n  }\r\n  getDescription(state: GameState, params: any): string {\r\n    return replaceWithParams(this.description(state), params);\r\n  }\r\n  getAllowedOptions(state: GameState, params: any): EventMessageOption[] {\r\n    return this.options\r\n      .filter(\r\n        (option) => option.isVisible == null || option.isVisible(state, params),\r\n      )\r\n      .map((option) => ({\r\n        ...option.option,\r\n        description: replaceWithParams(option.option.description, params),\r\n        isEnabled: option.isEnabled == null || option.isEnabled(state, params),\r\n      }));\r\n  }\r\n  isTerminal(): boolean {\r\n    return this.options.every(\r\n      (option) => !option.option.nextMessage && !option.option.transform,\r\n    );\r\n  }\r\n  isActionable(state: GameState, params: any): boolean {\r\n    return this.getAllowedOptions(state, params).some(\r\n      (option) => (option.nextMessage || option.transform) && option.isEnabled,\r\n    );\r\n  }\r\n}\r\n\r\ntype EventMessageOptionStub = {\r\n  description?: string;\r\n  nextMessageId?: string;\r\n  transform?: (state: GameState, params: any) => GameState;\r\n  isVisible?: (state: GameState, params: any) => boolean;\r\n  isEnabled?: (state: GameState, params: any) => boolean;\r\n};\r\n\r\nclass EventMessageBuilderDeluxe {\r\n  id: string;\r\n  description: (state: GameState) => string = () => \"\";\r\n  options: EventMessageOptionStub[] = [];\r\n  isEnd: boolean = false;\r\n  built: boolean;\r\n\r\n  constructor(id: string) {\r\n    this.id = id;\r\n  }\r\n\r\n  tag(id: string) {\r\n    this.id = id;\r\n    return this;\r\n  }\r\n\r\n  setDescription(description: (state: GameState) => string) {\r\n    this.description = description;\r\n    return this;\r\n  }\r\n\r\n  setSimpleDescription(description: string) {\r\n    this.setDescription((state: GameState) => description);\r\n    return this;\r\n  }\r\n\r\n  option(\r\n    description: string,\r\n    paramsOrNextMessageId:\r\n      | {\r\n          transform?: (state: GameState, params: any) => GameState;\r\n          isVisible?: (state: GameState, params: any) => boolean;\r\n          isEnabled?: (state: GameState, params: any) => boolean;\r\n        }\r\n      | string = {},\r\n    nextMessageId?: string,\r\n  ) {\r\n    if (typeof paramsOrNextMessageId === \"string\") {\r\n      nextMessageId = paramsOrNextMessageId;\r\n      paramsOrNextMessageId = {};\r\n    }\r\n\r\n    this.options.push({\r\n      description,\r\n      nextMessageId,\r\n      transform: paramsOrNextMessageId?.transform,\r\n      isVisible: paramsOrNextMessageId?.isVisible,\r\n      isEnabled: paramsOrNextMessageId?.isEnabled,\r\n    });\r\n    return this;\r\n  }\r\n\r\n  getOptions() {\r\n    return this.options.length > 0 ? this.options : [STUB_OPTION];\r\n  }\r\n\r\n  end() {\r\n    this.isEnd = true;\r\n  }\r\n}\r\n\r\nclass SimpleGameEvent implements GameEvent {\r\n  triggerString: string;\r\n\r\n  constructor(\r\n    private id: string,\r\n    private message: EventMessage,\r\n    private tags: EventTag[],\r\n    private onTriggerTransform?: EventTransform,\r\n    private storylineIds?: string[],\r\n  ) {\r\n    registerGameEvent(this);\r\n    this.triggerString = \"event_triggered_\" + this.id;\r\n  }\r\n\r\n  onTrigger(): EventTransform {\r\n    return (state, params) => {\r\n      state = setWorldFlag(this.triggerString)(state);\r\n      state = setFlag(this.triggerString)(state);\r\n      state = this.onTriggerTransform\r\n        ? this.onTriggerTransform(state, params)\r\n        : state;\r\n      return state;\r\n    };\r\n  }\r\n\r\n  hasTriggered(state: GameState): boolean {\r\n    return hasFlag(state, this.triggerString);\r\n  }\r\n\r\n  hasEverTriggered(state: GameState): boolean {\r\n    return hasWorldFlag(state, this.triggerString);\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  getMainEventMessage(): EventMessage {\r\n    return this.message;\r\n  }\r\n\r\n  getTags(): EventTag[] {\r\n    return this.tags;\r\n  }\r\n\r\n  getStorylines(): Storyline[] {\r\n    return (this.storylineIds ?? []).map((id) =>\r\n      Storylines.getByIdNullable(id),\r\n    );\r\n  }\r\n}\r\n\r\nfunction createGameEvent(\r\n  id: string,\r\n  message: EventMessage,\r\n  tags: EventTag[],\r\n  onTrigger?: EventTransform,\r\n  storylineIds?: string[],\r\n): GameEvent {\r\n  return new SimpleGameEvent(id, message, tags, onTrigger, storylineIds);\r\n}\r\n\r\nclass EventBuilder {\r\n  constructor(\r\n    private id: string,\r\n    private title: string,\r\n    private tags: EventTag[],\r\n  ) {}\r\n\r\n  messages: EventMessageBuilderDeluxe[] = [];\r\n\r\n  private lastMessageId: number = 0;\r\n  private onTrigger?: EventTransform;\r\n  private storylineIds?: string[];\r\n\r\n  message(description: string, tag?: string): EventMessageBuilderDeluxe {\r\n    const builder = new EventMessageBuilderDeluxe(tag ?? this.newMessageId());\r\n    builder.setSimpleDescription(description);\r\n    this.messages.push(builder);\r\n    return builder;\r\n  }\r\n\r\n  newMessageId(): string {\r\n    return (this.lastMessageId++).toString();\r\n  }\r\n\r\n  setOnTrigger(onTrigger: EventTransform) {\r\n    this.onTrigger = onTrigger;\r\n    return this;\r\n  }\r\n\r\n  setStorylineIds(storylineIds: string | string[]) {\r\n    this.storylineIds =\r\n      typeof storylineIds === \"string\" ? [storylineIds] : storylineIds;\r\n    return this;\r\n  }\r\n\r\n  build(): GameEvent {\r\n    // Start from the first message\r\n    const message = this.buildRecursive(0);\r\n    if (message == null) {\r\n      throw new Error(\"Events should always have at least one message\");\r\n    }\r\n    // Make sure all messages are built!\r\n    for (let i in this.messages) {\r\n      if (!this.messages[i].built) {\r\n        this.buildRecursive(Number.parseInt(i));\r\n      }\r\n    }\r\n    return createGameEvent(\r\n      this.id,\r\n      message,\r\n      this.tags,\r\n      this.onTrigger,\r\n      this.storylineIds,\r\n    );\r\n  }\r\n\r\n  private findMessageIndexWithId(idToSearch: string | undefined): number {\r\n    return this.messages.findIndex(\r\n      (messageBuilder) => messageBuilder.id === idToSearch,\r\n    );\r\n  }\r\n\r\n  private buildRecursive(index: number): EventMessage | undefined {\r\n    const messageBuilder = this.messages?.[index];\r\n    if (!(messageBuilder instanceof EventMessageBuilderDeluxe)) {\r\n      return undefined;\r\n    }\r\n    const options = messageBuilder.getOptions().map((optionStub) => {\r\n      let nextMessageId = optionStub?.nextMessageId;\r\n\r\n      if (nextMessageId == null && !messageBuilder.isEnd) {\r\n        nextMessageId = this.messages?.[index + 1]?.id;\r\n      }\r\n\r\n      const nextMessageIndex = this.findMessageIndexWithId(nextMessageId);\r\n\r\n      let message: EventMessage | undefined = undefined;\r\n\r\n      if (nextMessageIndex >= 0) {\r\n        message = this.buildRecursive(nextMessageIndex);\r\n      }\r\n      return {\r\n        option: {\r\n          description:\r\n            optionStub.description ??\r\n            (nextMessageId != null ? t(\"Continue\") : t(\"Close\")),\r\n          transform: optionStub.transform,\r\n          nextMessage: message,\r\n        },\r\n        isVisible: optionStub.isVisible,\r\n        isEnabled: optionStub.isEnabled,\r\n      };\r\n    });\r\n    messageBuilder.built = true;\r\n    return new EventMessageImpl(\r\n      this.id + messageBuilder.id,\r\n      this.title,\r\n      messageBuilder.description,\r\n      options,\r\n    );\r\n  }\r\n}\r\n\r\nexport function buildEvent(id: string, title: string, tags: EventTag[]) {\r\n  return new EventBuilder(id, title, tags);\r\n}\r\n","import { isElectron } from \"../../utils/ElectronUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { isDemo } from \"../Demo\";\r\nimport { Flag } from \"../Flag\";\r\nimport { SetFlagListeners } from \"../Flags\";\r\nimport { buildEvent } from \"./EventMessageBuilder\";\r\nimport { triggerEvent } from \"./Events\";\r\n\r\nexport const getDemoAboutText = () =>\r\n  isElectron()\r\n    ? t(\r\n        \"Get the full version for Windows on [Steam](https://store.steampowered.com/app/2864890/Magic_Research_2/?utm_source=demo_about_steam)!\",\r\n      )\r\n    : t(\r\n        \"Get the full version for Windows on [Steam](https://store.steampowered.com/app/2864890/Magic_Research_2/?utm_source=demo_about_web), for Android in [the Google Play Store](https://play.google.com/store/apps/details?id=com.mcolotto.magicresearchtwo&utm_source=demo_about_web) or for iOS in [the App Store](https://apps.apple.com/app/id6478566840)!\",\r\n      );\r\n\r\nconst fullGameLink = () =>\r\n  isElectron()\r\n    ? t(\r\n        \"[**Get the full game now!**](https://store.steampowered.com/app/2864890/Magic_Research_2/?utm_source=demo_end_steam)\",\r\n      )\r\n    : t(\r\n        \"**Get the full game now for Windows on [Steam](https://store.steampowered.com/app/2864890/Magic_Research_2/?utm_source=demo_end_web), for Android in [the Google Play Store](https://play.google.com/store/apps/details?id=com.mcolotto.magicresearchtwo&utm_source=demo_end_web) or for iOS in [the App Store](https://apps.apple.com/app/id6478566840)!**\",\r\n      );\r\n\r\nexport const getMR1AboutText = () =>\r\n  isElectron()\r\n    ? t(\r\n        \"If you like the game, you may also like the original [Magic Research](https://store.steampowered.com/app/2311680/Magic_Research/?utm_source=mr2_about_steam)!\",\r\n      )\r\n    : t(\r\n        \"If you like the game, you may also like the original **Magic Research**, for Windows on [Steam](https://store.steampowered.com/app/2311680/Magic_Research/?utm_source=mr2_about_web), for Android in [the Google Play Store](https://play.google.com/store/apps/details?id=com.mcolotto.magicresearch&utm_source=mr2_about_web) or for iOS in [the App Store](https://apps.apple.com/app/id1671272877)!\",\r\n      );\r\n\r\nexport function loadDemoEndEvent() {\r\n  // Do nothing\r\n  const eventBuilder = buildEvent(\"demoEnd\", t(\"End of the Demo\"), []);\r\n\r\n  eventBuilder.message(\r\n    t(\r\n      `Congratulations! You have defeated the Man-Eating Plant. This is the end of the Demo Version of Magic Research 2. **Thank you for playing!**\r\n  \r\nIn the full game, you can expect much more content: more places to explore, more spells and items, and plenty more secrets to discover! Your progress in the Demo can be easily transferred to the full game.\r\n\r\n*Will you be able to successfully heal the deadly disease with the Philosopher's Stone?*\r\n\r\n{{fullGameLink}}`,\r\n      { fullGameLink: fullGameLink() },\r\n    ),\r\n  );\r\n\r\n  const event = eventBuilder.build();\r\n\r\n  if (isDemo()) {\r\n    SetFlagListeners.register((state, flag) => {\r\n      if (flag == Flag.VastDesertUnlocked && !event.hasTriggered(state)) {\r\n        state = triggerEvent(event)(state);\r\n      }\r\n      return state;\r\n    });\r\n  }\r\n}\r\n","import React, { useContext } from \"react\";\r\n\r\nexport type AuxOptions = {\r\n  compactLayout: boolean;\r\n};\r\n\r\nexport const AuxOptionsContext = React.createContext<AuxOptions>({\r\n  compactLayout: false,\r\n});\r\n\r\nexport function useAuxOptions() {\r\n  return useContext(AuxOptionsContext);\r\n}\r\n","import React, { useMemo } from \"react\";\r\nimport { StyleSheet } from \"react-native\";\r\nimport { Text as PaperText, TextProps } from \"react-native-paper\";\r\n\r\nfunction TextNonMemoized<T>(\r\n  props: TextProps<T> & {\r\n    h1?: boolean;\r\n    h2?: boolean;\r\n    h3?: boolean;\r\n    h4?: boolean;\r\n    doNotScaleFonts?: boolean;\r\n  },\r\n) {\r\n  const ariaLevel = props.h1\r\n    ? 1\r\n    : props.h2\r\n    ? 2\r\n    : props.h3\r\n    ? 3\r\n    : props.h4\r\n    ? 4\r\n    : undefined;\r\n  const style = useMemo(\r\n    () => [\r\n      props.h1 && styles.h1,\r\n      props.h2 && styles.h2,\r\n      props.h3 && styles.h3,\r\n      props.h4 && styles.h4,\r\n      props.style,\r\n    ],\r\n    [props.h1, props.h2, props.h3, props.h4, props.style],\r\n  );\r\n  return (\r\n    <PaperText\r\n      style={style}\r\n      maxFontSizeMultiplier={props.doNotScaleFonts === true ? 1.0 : 0}\r\n      accessibilityRole={\r\n        props.h1 || props.h2 || props.h3 || props.h4 ? \"header\" : undefined\r\n      }\r\n      selectable={false}\r\n      // @ts-ignore We want to send this prop anyway\r\n      ariaLevel={ariaLevel}\r\n      accessibilityLevel={ariaLevel}\r\n      aria-level={ariaLevel}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nconst Text = React.memo(TextNonMemoized);\r\n\r\nexport { Text };\r\n\r\n/*\r\nexport function Text(props: any) {\r\n  let children = props.children || [];\r\n  if (!Array.isArray(children)) {\r\n    children = [children];\r\n  }\r\n  const newChildren = children.map((child: any) => {\r\n    if (typeof child == \"string\") {\r\n      const splitString = child.split(\"{wood}\");\r\n      const newStringChildren = [\r\n        <StyledText props={props}>{splitString[0]}</StyledText>,\r\n      ] as Object[];\r\n      for (let i = 1; i < splitString.length; i++) {\r\n        newStringChildren.push(<Icon name=\"close\" />);\r\n        newStringChildren.push(\r\n          <StyledText props={props}>{splitString[i]}</StyledText>,\r\n        );\r\n      }\r\n      return <View>{newStringChildren}</View>;\r\n    }\r\n    //return child;\r\n  });\r\n  return <View>{newChildren}</View>;\r\n}*/\r\n\r\nconst styles = StyleSheet.create({\r\n  h1: {\r\n    fontSize: 20,\r\n  },\r\n  h2: {\r\n    fontSize: 18,\r\n  },\r\n  h3: {\r\n    fontSize: 16,\r\n  },\r\n  h4: {\r\n    fontSize: 14,\r\n  },\r\n});\r\n","import React, {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport type { ViewStyle } from \"react-native\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport {\r\n  ButtonProps,\r\n  Button as PaperButton,\r\n  useTheme,\r\n} from \"react-native-paper\";\r\nimport { valuesOf } from \"../../utils/CoreUtils\";\r\n// import PaperButton from \"./PaperButton\";\r\nimport { useAuxOptions } from \"./AuxOptionsContext\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function Button(\r\n  props: Omit<Omit<ButtonProps, \"onPress\">, \"children\"> & {\r\n    onPress: () => void;\r\n    enableAutoRepress?: boolean;\r\n    autoRepressConfig?: {\r\n      minTimeMs?: number;\r\n      startingThreshold?: number;\r\n      startingRepressTime?: number;\r\n      dropoffMultiplier?: number;\r\n    };\r\n    ButtonComponent?: React.ElementType;\r\n    size?: number;\r\n    TextComponent?: React.ElementType;\r\n    children?: React.ReactNode;\r\n    numberOfLines?: number | null;\r\n    passthroughStyle?: ViewStyle;\r\n    disableDisabledRenderingOptimization?: boolean;\r\n  },\r\n) {\r\n  const {\r\n    disabled,\r\n    autoRepressConfig,\r\n    enableAutoRepress,\r\n    style,\r\n    labelStyle,\r\n    passthroughStyle,\r\n    disableDisabledRenderingOptimization,\r\n    TextComponent,\r\n    ...rest\r\n  } = props;\r\n  const pressed = useRef(false);\r\n  const disabledRef = useRef(disabled);\r\n  disabledRef.current = disabled;\r\n  const currentRepressTimeout = useRef(300);\r\n  const currentRepressHandler = useRef<NodeJS.Timeout | null>(null);\r\n  const [flash, setFlash] = useState(false);\r\n  const shouldDisableRenderingOptimization =\r\n    disableDisabledRenderingOptimization || rest.ButtonComponent != null;\r\n\r\n  useEffect(() => {\r\n    if (flash) {\r\n      const timeoutHandler = setTimeout(\r\n        () => setFlash(false),\r\n        (autoRepressConfig?.minTimeMs ?? 100) / 3,\r\n      );\r\n      return () => clearTimeout(timeoutHandler);\r\n    }\r\n  }, [flash]);\r\n  const rePress = useCallback(() => {\r\n    if (pressed.current) {\r\n      if (!disabledRef.current) {\r\n        props.onPress && props.onPress();\r\n      }\r\n      setFlash(true);\r\n      currentRepressTimeout.current = Math.max(\r\n        autoRepressConfig?.minTimeMs ?? 100,\r\n        currentRepressTimeout.current *\r\n          (autoRepressConfig?.dropoffMultiplier ?? 0.94),\r\n      );\r\n      currentRepressHandler.current = setTimeout(\r\n        rePress,\r\n        currentRepressTimeout.current,\r\n      );\r\n    }\r\n  }, [props.onPress]);\r\n  const onPressInCallback = useCallback(() => {\r\n    pressed.current = true;\r\n    currentRepressHandler.current = setTimeout(() => {\r\n      if (pressed.current && !disabledRef.current) {\r\n        currentRepressTimeout.current =\r\n          autoRepressConfig?.startingRepressTime ?? 300;\r\n        rePress();\r\n      }\r\n    }, autoRepressConfig?.startingThreshold ?? 600);\r\n  }, [rePress]);\r\n  const onPressOutCallback = useCallback(() => {\r\n    pressed.current = false;\r\n    if (currentRepressHandler.current != null) {\r\n      clearTimeout(currentRepressHandler.current);\r\n      currentRepressHandler.current = null;\r\n    }\r\n  }, [rePress]);\r\n  useEffect(() => {\r\n    return () => {\r\n      onPressOutCallback();\r\n    };\r\n  }, [onPressOutCallback]);\r\n  const ButtonComponent = props.ButtonComponent ?? PaperButton;\r\n  const theme = useTheme();\r\n  const auxOptions = useAuxOptions();\r\n  const basicLabelStyle =\r\n    props.compact && Platform.OS != \"web\"\r\n      ? theme.fonts.labelSmall\r\n      : theme.fonts.labelLarge;\r\n  const verticallyNarrowLayout = auxOptions.compactLayout;\r\n  const verticalLabelStyle = verticallyNarrowLayout\r\n    ? styles.compactLabel\r\n    : undefined;\r\n  const styleFlash = useMemo(\r\n    () => [passthroughStyle, flash && { opacity: 0.9 }],\r\n    [passthroughStyle, flash],\r\n  );\r\n  const computedLabelStyle = useMemo(\r\n    () => [basicLabelStyle, verticalLabelStyle, labelStyle],\r\n    [basicLabelStyle, verticalLabelStyle, labelStyle],\r\n  );\r\n  const activeButton = useMemo(\r\n    () => (\r\n      <ButtonComponent\r\n        onPressIn={enableAutoRepress ? onPressInCallback : undefined}\r\n        onPressOut={enableAutoRepress ? onPressOutCallback : undefined}\r\n        disabled={shouldDisableRenderingOptimization ? disabled : false}\r\n        mode=\"contained\"\r\n        style={styleFlash}\r\n        labelStyle={computedLabelStyle}\r\n        TextComponent={TextComponent ?? Text}\r\n        {...rest}\r\n      />\r\n    ),\r\n    [\r\n      enableAutoRepress,\r\n      onPressInCallback,\r\n      onPressOutCallback,\r\n      styleFlash,\r\n      computedLabelStyle,\r\n      TextComponent,\r\n      shouldDisableRenderingOptimization ? disabled : false,\r\n      ...valuesOf(rest),\r\n    ],\r\n  );\r\n  const disabledButton = useMemo(\r\n    () =>\r\n      shouldDisableRenderingOptimization ? null : (\r\n        <ButtonComponent\r\n          onPressIn={enableAutoRepress ? onPressInCallback : undefined}\r\n          onPressOut={enableAutoRepress ? onPressOutCallback : undefined}\r\n          disabled={true}\r\n          mode=\"contained\"\r\n          style={styleFlash}\r\n          labelStyle={computedLabelStyle}\r\n          TextComponent={TextComponent ?? Text}\r\n          {...rest}\r\n        />\r\n      ),\r\n    [\r\n      enableAutoRepress,\r\n      onPressInCallback,\r\n      onPressOutCallback,\r\n      styleFlash,\r\n      computedLabelStyle,\r\n      TextComponent,\r\n      shouldDisableRenderingOptimization,\r\n      ...valuesOf(rest),\r\n    ],\r\n  );\r\n  return useMemo(\r\n    () =>\r\n      shouldDisableRenderingOptimization ? (\r\n        <View style={style}>\r\n          <View>{activeButton}</View>\r\n        </View>\r\n      ) : (\r\n        <View style={style}>\r\n          <View style={disabled && { display: \"none\" }}>{activeButton}</View>\r\n          <View style={!disabled && { display: \"none\" }}>{disabledButton}</View>\r\n        </View>\r\n      ),\r\n    [\r\n      style,\r\n      disabled,\r\n      activeButton,\r\n      disabledButton,\r\n      shouldDisableRenderingOptimization,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  compactLabel: {\r\n    marginVertical: 5,\r\n  },\r\n});\r\n","import React, { useMemo } from \"react\";\r\nimport { Image, ImageProps, ImageSourcePropType } from \"react-native\";\r\nimport { Items } from \"../../../backend/items/Items\";\r\n\r\ntype IconProps = Omit<ImageProps, \"source\"> & {\r\n  icon: string;\r\n  small?: boolean;\r\n};\r\n\r\nconst icons: Record<string, ImageSourcePropType> = {\r\n  // Elements\r\n  fire: require(\"./assets/fire.png\"),\r\n  earth: require(\"./assets/earth.png\"),\r\n  water: require(\"./assets/water.png\"),\r\n  air: require(\"./assets/air.png\"),\r\n  poison: require(\"./assets/poison.png\"),\r\n  mind: require(\"./assets/mind.png\"),\r\n  life: require(\"./assets/life.png\"),\r\n  electric: require(\"./assets/electric.png\"),\r\n  death: require(\"./assets/death.png\"),\r\n  holy: require(\"./assets/holy.png\"),\r\n  time: require(\"./assets/time.png\"),\r\n  space: require(\"./assets/space.png\"),\r\n\r\n  // Resources\r\n  fireessence: require(\"./assets/fireEssence.png\"),\r\n  earthessence: require(\"./assets/earthEssence.png\"),\r\n  wateressence: require(\"./assets/waterEssence.png\"),\r\n  airessence: require(\"./assets/airEssence.png\"),\r\n  poisonessence: require(\"./assets/poisonEssence.png\"),\r\n  mindessence: require(\"./assets/mindEssence.png\"),\r\n  lifeessence: require(\"./assets/lifeEssence.png\"),\r\n  electricessence: require(\"./assets/electricEssence.png\"),\r\n  deathessence: require(\"./assets/deathEssence.png\"),\r\n  holyessence: require(\"./assets/holyEssence.png\"),\r\n  timeessence: require(\"./assets/timeEssence.png\"),\r\n  spaceessence: require(\"./assets/spaceEssence.png\"),\r\n  land: require(\"./assets/land.png\"),\r\n  coins: require(\"./assets/coins.png\"),\r\n  mana: require(\"./assets/mana.png\"),\r\n  wizardpower: require(\"./assets/wizardPower.png\"),\r\n\r\n  // Stats and others\r\n  boost: require(\"./assets/boost.png\"),\r\n  attack: require(\"./assets/attack.png\"),\r\n  attackDelay: require(\"./assets/attackDelay.png\"),\r\n  defense: require(\"./assets/defense.png\"),\r\n  hp: require(\"./assets/hp.png\"),\r\n  monstium: require(\"./assets/monstium.png\"),\r\n  debuff: require(\"./assets/debuff.png\"),\r\n  generic: require(\"./assets/generic.png\"),\r\n  accuracy: require(\"./assets/accuracy.png\"),\r\n  dodge: require(\"./assets/dodge.png\"),\r\n  timepiece: require(\"./assets/timepiece.png\"),\r\n  critChance: require(\"./assets/critChance.png\"),\r\n  exchange: require(\"./assets/exchange.png\"),\r\n  corruption: require(\"./assets/corruption.png\"),\r\n  x: require(\"./assets/x.png\"),\r\n\r\n  // Menu sections\r\n  about: require(\"./assets/about.png\"),\r\n  apprentices: require(\"./assets/apprentices.png\"),\r\n  boosts: require(\"./assets/boosts.png\"),\r\n  compendium: require(\"./assets/compendium.png\"),\r\n  creatures: require(\"./assets/creatures.png\"),\r\n  ending: require(\"./assets/ending.png\"),\r\n  enhance: require(\"./assets/enhance.png\"),\r\n  exploration: require(\"./assets/exploration.png\"),\r\n  familiars: require(\"./assets/familiars.png\"),\r\n  help: require(\"./assets/help.png\"),\r\n  home: require(\"./assets/home.png\"),\r\n  inventory: require(\"./assets/inventory.png\"),\r\n  options: require(\"./assets/options.png\"),\r\n  research: require(\"./assets/research.png\"),\r\n  retirement: require(\"./assets/retirement.png\"),\r\n  rituals: require(\"./assets/rituals.png\"),\r\n  spellcraft: require(\"./assets/spellcraft.png\"),\r\n  stats: require(\"./assets/stats.png\"),\r\n  study: require(\"./assets/study.png\"),\r\n  synchro: require(\"./assets/synchro.png\"),\r\n  transmute: require(\"./assets/transmute.png\"),\r\n  wizards: require(\"./assets/wizards.png\"),\r\n  worlds: require(\"./assets/worlds.png\"),\r\n};\r\n\r\nfunction GameIconNonMemo(props: IconProps) {\r\n  const { icon, style, ...otherProps } = props;\r\n  let imageSource = icons[icon];\r\n  let label = icon;\r\n  if (!imageSource) {\r\n    // It could be an item\r\n    const item = Items.getByIdNullable(icon);\r\n    if (item) {\r\n      imageSource = item.getPicture();\r\n      label = item.getName(item.getDefaultParams());\r\n    }\r\n  }\r\n  if (!imageSource) {\r\n    return null;\r\n  }\r\n  const computedStyle = useMemo(\r\n    () => [\r\n      { width: 32, height: 32 },\r\n      style,\r\n      props.small ? { width: 16, height: 16 } : {},\r\n    ],\r\n    [style, props.small],\r\n  );\r\n\r\n  return (\r\n    <Image\r\n      source={imageSource}\r\n      accessibilityLabel={label}\r\n      accessibilityRole=\"image\"\r\n      style={computedStyle}\r\n      {...otherProps}\r\n    />\r\n  );\r\n}\r\n\r\nconst GameIcon = React.memo(GameIconNonMemo);\r\n\r\nexport { GameIcon };\r\n","import Plugin from \"markdown-it-regexp\";\r\n\r\nconst plugin = Plugin(\r\n  // regexp to match\r\n  /\\:([a-zA-Z_-]+)\\:/,\r\n\r\n  // this function will be called when something matches\r\n  (match: any[], utils: any) => {\r\n    const icon = match[1];\r\n\r\n    return icon;\r\n  },\r\n);\r\n\r\nexport default plugin;\r\n","import Plugin from \"markdown-it-regexp\";\r\n\r\nconst plugin = Plugin(\r\n  // regexp to match\r\n  /\\^(.+?)\\^<(.*?)>/,\r\n\r\n  // this function will be called when something matches\r\n  (match: any[], utils: any) => {\r\n    const base = match[1];\r\n    const tooltip = match[2];\r\n\r\n    return [base, tooltip];\r\n  },\r\n);\r\n\r\nexport default plugin;\r\n","import React, { useMemo } from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport LibraryMarkdown, {\r\n  MarkdownIt,\r\n  getUniqueID,\r\n} from \"react-native-markdown-display\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { Text } from \"../utility/Text\";\r\nimport type { Props as PaperTooltipProps } from \"../utility/tooltip/PaperTooltip\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport MarkdownIconPlugin from \"./markdown/MarkdownIconPlugin\";\r\nimport MarkdownTooltipPlugin from \"./markdown/MarkdownTooltipPlugin\";\r\n\r\nlet Tooltip: React.ComponentType<PaperTooltipProps> = null;\r\n\r\nexport function setTooltipComponentForMarkdown(\r\n  component: React.ComponentType<PaperTooltipProps>,\r\n) {\r\n  Tooltip = component;\r\n}\r\n\r\nconst markdownItInstance = MarkdownIt({ typographer: false })\r\n  .use(MarkdownIconPlugin, {\r\n    containerClassName: \"icon-embed\",\r\n  })\r\n  .use(MarkdownTooltipPlugin, {});\r\n\r\nconst markdownRules = {\r\n  paragraph: (node: any, children: any, parent: any, markdownStyles: any) => {\r\n    return (\r\n      <View key={node.key} style={[node.index > 0 && styles.markdownParagraph]}>\r\n        {children}\r\n      </View>\r\n    );\r\n  },\r\n  text: (node, children, parent, styles, inheritedStyles = {}) => (\r\n    <Text key={node.key} style={[inheritedStyles, styles.text]}>\r\n      {node.content}\r\n    </Text>\r\n  ),\r\n  \"regexp-0\": (node: any, children: any, parent: any, markdownStyles: any) => {\r\n    const icon = node.sourceMeta.match[1];\r\n    // \\u200b is \"zero-width space\". It needs to be added because\r\n    // in devices like the Google Pixel phones and tablets,\r\n    // if a line contains exclusively the icon with no text,\r\n    // the icon gets cut off.\r\n    return Platform.select({\r\n      default: (\r\n        <Text key={getUniqueID()}>\r\n          <GameIcon\r\n            key={getUniqueID()}\r\n            style={\r\n              icon === \"attack\"\r\n                ? styles.imageStyleAndroidAttack\r\n                : styles.imageStyleAndroid\r\n            }\r\n            small={true}\r\n            resizeMode=\"contain\"\r\n            icon={icon}\r\n          />\r\n          {Platform.OS === \"android\" && \"\\u200b\"}\r\n        </Text>\r\n      ),\r\n      ios: (\r\n        <Text key={getUniqueID()}>\r\n          <View\r\n            style={\r\n              icon === \"attack\"\r\n                ? styles.imageContainerStyleiOSAttack\r\n                : styles.imageContainerStyleiOS\r\n            }\r\n          >\r\n            <GameIcon\r\n              key={getUniqueID()}\r\n              style={\r\n                icon === \"attack\"\r\n                  ? styles.imageStyleiOSAttack\r\n                  : styles.imageStyleiOS\r\n              }\r\n              small={true}\r\n              resizeMode=\"contain\"\r\n              icon={icon}\r\n            />\r\n          </View>\r\n        </Text>\r\n      ),\r\n    });\r\n  },\r\n  \"regexp-1\": (\r\n    node: any,\r\n    children: any,\r\n    parent: any,\r\n    markdownStyles: any,\r\n    inheritedStyles: any,\r\n  ) => {\r\n    const base = node.sourceMeta.match[1];\r\n    const tooltip = node.sourceMeta.match[2];\r\n    if (tooltip == \"\") {\r\n      return (\r\n        <Text\r\n          key={node.key}\r\n          style={[inheritedStyles, markdownStyles.text, styles.text]}\r\n        >\r\n          {base}\r\n        </Text>\r\n      );\r\n    }\r\n    return (\r\n      <View key={getUniqueID()} style={styles.tooltipTextContainer}>\r\n        <Tooltip title={tooltip}>\r\n          <Text\r\n            style={[\r\n              inheritedStyles,\r\n              markdownStyles.text,\r\n              styles.text,\r\n              styles.underlined,\r\n            ]}\r\n          >\r\n            {base}\r\n          </Text>\r\n        </Tooltip>\r\n      </View>\r\n    );\r\n  },\r\n};\r\n\r\nfunction MarkdownImpl(props: any) {\r\n  const style = props?.style || {};\r\n  const containerStyle = props?.containerStyle || {};\r\n  const children = props.children?.replace?.(\r\n    /((\\d(K|M|B|T)?)|(Max)) :/g,\r\n    (_substring: string, args: string) => args + \":\",\r\n  );\r\n  const accessibilityLabel =\r\n    props.accessibilityLabel ??\r\n    (props.children as string)\r\n      ?.replaceAll?.(\"*\", \"\")\r\n      ?.replaceAll(/\\^(.+?)\\^<(.*?)>/g, (substring, ...matches) => matches[0]);\r\n  const accessibilityLiveRegion = props?.accessibilityLiveRegion ?? \"none\";\r\n  const theme = useTheme();\r\n  const fullStyle = useMemo(\r\n    () => ({\r\n      body: [\r\n        {\r\n          justifyContent: \"flex-end\",\r\n          minHeight: 21,\r\n          lineHeight: Platform.select({ ios: 19, default: undefined }),\r\n          color: theme.colors.onBackground,\r\n        },\r\n        style,\r\n      ],\r\n      bullet_list_icon: {\r\n        lineHeight: Platform.select({ ios: 20, default: 16 }),\r\n        marginTop: 4,\r\n      },\r\n      bullet_list: { width: \"100%\" },\r\n      list_item: { alignItems: \"center\", justifyContent: \"center\" },\r\n      heading2: {\r\n        lineHeight: 24,\r\n      },\r\n    }),\r\n    [theme, style],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        accessibilityLabel={accessibilityLabel}\r\n        accessibilityLiveRegion={accessibilityLiveRegion}\r\n        accessible={true}\r\n        style={[styles.containerView, containerStyle]}\r\n      >\r\n        <LibraryMarkdown\r\n          {...props}\r\n          markdownit={markdownItInstance}\r\n          rules={markdownRules}\r\n          style={fullStyle}\r\n        >\r\n          {children}\r\n        </LibraryMarkdown>\r\n      </View>\r\n    ),\r\n    [\r\n      accessibilityLabel,\r\n      accessibilityLiveRegion,\r\n      markdownItInstance,\r\n      markdownRules,\r\n      fullStyle,\r\n      children,\r\n    ],\r\n  );\r\n}\r\n\r\nconst Markdown = React.memo(MarkdownImpl);\r\n\r\nexport { Markdown };\r\n\r\nconst styles = StyleSheet.create({\r\n  markdownParagraph: {\r\n    marginTop: Platform.select({ ios: 8, default: 4 }),\r\n  },\r\n  markdownTextgroup: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    alignItems: \"center\",\r\n    padding: 0,\r\n    margin: 0,\r\n  },\r\n  text: {\r\n    lineHeight: 16,\r\n  },\r\n  imageStyleAndroid: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    top: 2,\r\n    marginLeft: 2,\r\n  },\r\n  imageStyleAndroidAttack: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    top: 2,\r\n    marginLeft: 2,\r\n    marginRight: 2,\r\n  },\r\n  imageContainerStyleiOS: {\r\n    width: 18,\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  imageContainerStyleiOSAttack: {\r\n    width: 20,\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  imageStyleiOS: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    alignSelf: \"center\",\r\n    top: 2,\r\n  },\r\n  imageStyleiOSAttack: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    alignSelf: \"center\",\r\n    top: 2,\r\n    right: 2,\r\n  },\r\n  containerView: Platform.select({\r\n    default: {},\r\n    web: {\r\n      flex: 1,\r\n    },\r\n  }),\r\n  underlined: {\r\n    textDecorationLine: \"underline\",\r\n    top: 2,\r\n  },\r\n  tooltipTextContainer: {\r\n    height: 16,\r\n    // justifyContent: \"flex-end\",\r\n    // lineHeight: 16,\r\n  },\r\n});\r\n","import { StyleSheet } from \"react-native\";\r\n\r\nconst Styles = StyleSheet.create({\r\n  flex: {\r\n    flex: 1,\r\n  },\r\n  flexRow: {\r\n    flexDirection: \"row\",\r\n  },\r\n  flexEnd: {\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  flexRowSpaceBetween: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  flexRowAlignCenter: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  flexCenter: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  alignSelfStretch: {\r\n    alignSelf: \"stretch\",\r\n  },\r\n  alignSelfNormal: {\r\n    alignSelf: \"flex-start\",\r\n  },\r\n  ml4: {\r\n    marginLeft: 4,\r\n  },\r\n  ml8: {\r\n    marginLeft: 8,\r\n  },\r\n  ml16: {\r\n    marginLeft: 16,\r\n  },\r\n  mt2: {\r\n    marginTop: 2,\r\n  },\r\n  mt4: {\r\n    marginTop: 4,\r\n  },\r\n  mt8: {\r\n    marginTop: 8,\r\n  },\r\n  mt16: {\r\n    marginTop: 16,\r\n  },\r\n  mr4: {\r\n    marginRight: 4,\r\n  },\r\n  mr8: {\r\n    marginRight: 8,\r\n  },\r\n  mr16: {\r\n    marginRight: 16,\r\n  },\r\n  mb4: {\r\n    marginBottom: 4,\r\n  },\r\n  mb8: {\r\n    marginBottom: 8,\r\n  },\r\n  mb16: {\r\n    marginBottom: 16,\r\n  },\r\n  mv2: {\r\n    marginVertical: 2,\r\n  },\r\n  mv4: {\r\n    marginVertical: 4,\r\n  },\r\n  mv8: {\r\n    marginVertical: 8,\r\n  },\r\n  mv16: {\r\n    marginVertical: 16,\r\n  },\r\n  pb4: {\r\n    paddingBottom: 4,\r\n  },\r\n  pb8: {\r\n    paddingBottom: 8,\r\n  },\r\n  pb16: {\r\n    paddingBottom: 16,\r\n  },\r\n  ph4: {\r\n    paddingHorizontal: 4,\r\n  },\r\n  ph8: {\r\n    paddingHorizontal: 8,\r\n  },\r\n  ph16: {\r\n    paddingHorizontal: 16,\r\n  },\r\n  pv4: {\r\n    paddingVertical: 4,\r\n  },\r\n  pv8: {\r\n    paddingVertical: 8,\r\n  },\r\n  pv16: {\r\n    paddingVertical: 16,\r\n  },\r\n  p4: {\r\n    padding: 4,\r\n  },\r\n  p8: {\r\n    padding: 8,\r\n  },\r\n  p16: {\r\n    padding: 16,\r\n  },\r\n  bold: {\r\n    fontWeight: \"bold\",\r\n  },\r\n  underlined: {\r\n    textDecorationLine: \"underline\",\r\n  },\r\n});\r\n\r\nexport default Styles;\r\n","import Constants from \"expo-constants\";\r\nimport React, { useContext, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { isDemo } from \"../backend/Demo\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { addUICommand } from \"../backend/UICommands\";\r\nimport {\r\n  getDemoAboutText,\r\n  getMR1AboutText,\r\n} from \"../backend/events/DemoEndEvent\";\r\nimport { t } from \"../utils/I18n\";\r\nimport {\r\n  getCurrentVersion,\r\n  getCurrentVersionTimestamp,\r\n} from \"../utils/Versioning\";\r\nimport { Button } from \"./utility/Button\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function About() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const versionText = isDemo() ? t(\"**Demo Version**\") : t(\"**Full Version**\");\r\n  const versionNumber = getCurrentVersionTimestamp() ?? t(\"Unknown\");\r\n  const versionString = getCurrentVersion() ?? t(\"Unknown\");\r\n  const versionNumberText = t(`Version {{versionString}} ({{versionNumber}})`, {\r\n    versionString,\r\n    versionNumber,\r\n  });\r\n  const demoText = isDemo() ? getDemoAboutText() : \"\";\r\n  const mr1text = getMR1AboutText();\r\n  const text = t(\r\n    `## Magic Research 2\r\n\r\n  \r\n{{versionText}}\r\n\r\n{{versionNumberText}}\r\n\r\n\r\nA game by **@Maticolotto**\r\n\r\n\r\n**Credits**\r\n\r\nAssets from:\r\n  * Raven Fantasy Icons, by Clockwork Raven [(https://clockworkraven.itch.io/raven-fantasy-icons)](https://clockworkraven.itch.io/raven-fantasy-icons)\r\n  * Aekashics Librarium, by Aekashics [(http://www.akashics.moe)](http://www.akashics.moe)\r\n  * 1000+ Fantasy RPG Icons, by finalbossblues [(https://finalbossblues.itch.io/icons)](https://finalbossblues.itch.io/icons)\r\n\r\nSpecial thanks to **@jpascua93** for pre-launch feedback. development, and marketing assets\r\n\r\nSpecial thanks to: **@Wiedmolol**, **@lunacent**, **@Fich**, **@Falk**, **@Aegys**, **@UVGamma**, **@AbsolFan1**, **@Kolt** for pre-launch feedback\r\n\r\nCheck out the **[Discord](https://discord.gg/bPhGsaqR9d)** to discuss the game!\r\n\r\n[Privacy Policy](https://mcolotto.github.io/magic-research-demo/privacy-policy)\r\n\r\n{{demoText}}\r\n\r\n{{mr1text}}`,\r\n    { versionText, versionNumberText, demoText, mr1text },\r\n  );\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text h1>{t(\"About\")}</Text>\r\n      <View style={styles.explanation}>\r\n        <Markdown style={styles.explanationText}>{text}</Markdown>\r\n        {Constants?.expoConfig?.extra?.showDebug && (\r\n          <Button\r\n            onPress={() => {\r\n              stateRef.current.apply((state) => {\r\n                state = addUICommand(state, \"goToDebug\");\r\n                return state;\r\n              });\r\n            }}\r\n            style={Styles.mt16}\r\n          >\r\n            Show debug\r\n          </Button>\r\n        )}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  explanation: {\r\n    marginTop: 16,\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    width: \"100%\",\r\n  },\r\n  explanationText: {\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import memoize from \"sonic-memoize\";\r\nimport { keysOf } from \"../../utils/CoreUtils\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  Resource,\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n} from \"../Resources\";\r\nimport {\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../items/Inventory\";\r\nimport { Items } from \"../items/Items\";\r\nimport { hasTemporaryEffect } from \"../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationTag,\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../transformation/TransformationTags\";\r\nimport { ActionArea, ActionSubcategory } from \"./ActionAreas\";\r\n\r\nexport type DoActionArgs = { isAutomatic: boolean };\r\n\r\nexport type ActionEffect = {\r\n  value: number;\r\n  tags?: TransformationTag[];\r\n  unit?: string;\r\n  valueType?: TransformationValueType;\r\n  base?: number;\r\n};\r\n\r\nexport abstract class Action {\r\n  constructor() {}\r\n\r\n  abstract getId(): string;\r\n  abstract getDisplayName(state: GameState): string;\r\n  abstract getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  };\r\n  abstract doAction(args: DoActionArgs, state: GameState): GameState;\r\n  abstract isVisible(state: GameState): boolean;\r\n  abstract getDisplayDescription(state: GameState): string;\r\n  abstract getDisplayEffect(state: GameState): string;\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return {};\r\n  }\r\n\r\n  canSpam(): boolean {\r\n    return true;\r\n  }\r\n\r\n  canAutoPurchaseMax(): boolean {\r\n    return false;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getCachedBaseActionEffects = memoize(() => this.getBaseActionEffects());\r\n\r\n  tagsByEffect: Record<string, string[]> = {};\r\n  getTagsByEffect(key: string, baseEffect: ActionEffect): string[] {\r\n    if (this.tagsByEffect?.[key] == null) {\r\n      this.tagsByEffect[key] = [\r\n        ...this.getTags(),\r\n        ...(baseEffect.tags ?? []),\r\n        TransformationTags.ActionEffect,\r\n        key,\r\n      ];\r\n    }\r\n    return this.tagsByEffect[key];\r\n  }\r\n\r\n  getActionEffect(state: GameState, effectId: string): number {\r\n    const baseEffects = this.getCachedBaseActionEffects();\r\n    return applyTransformations(\r\n      this.getTagsByEffect(effectId, baseEffects[effectId]),\r\n      state,\r\n      baseEffects[effectId].value,\r\n      {\r\n        action: this,\r\n      },\r\n    );\r\n  }\r\n\r\n  getActionEffects(state: GameState, onlyId?: string): Record<string, number> {\r\n    const baseEffects = this.getCachedBaseActionEffects();\r\n    const finalEffects: Record<string, number> = {};\r\n    if (onlyId != null) {\r\n      finalEffects[onlyId] = applyTransformations(\r\n        this.getTagsByEffect(onlyId, baseEffects[onlyId]),\r\n        state,\r\n        baseEffects[onlyId].value,\r\n        {\r\n          action: this,\r\n        },\r\n      );\r\n      return finalEffects;\r\n    }\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = applyTransformations(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.memoizedActionEffectParam(),\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  memoizedActionEffectParam = memoize(() => ({ action: this }));\r\n\r\n  memoizedActionEffectExplanationParam = memoize(\r\n    (baseEffect: ActionEffect) => ({\r\n      action: this,\r\n      unit: baseEffect.unit,\r\n      valueType: baseEffect.valueType,\r\n      base: baseEffect.base,\r\n    }),\r\n  );\r\n\r\n  getActionEffectExplanations(\r\n    state: GameState,\r\n    onlyId?: string,\r\n  ): Record<string, string> {\r\n    const baseEffects = this.getCachedBaseActionEffects();\r\n    const finalEffects: Record<string, string> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = explainTransformationsText(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.memoizedActionEffectExplanationParam(baseEffect),\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  getTags(): TransformationTag[] {\r\n    const tags = [TransformationTags.Action, this.getId()];\r\n    return tags;\r\n  }\r\n\r\n  canAfford(state: GameState): boolean {\r\n    const cost = this.getCost(state);\r\n    return (\r\n      keysOf(cost.resources).every(\r\n        (resource) =>\r\n          getResourceAmount(state, resource) >=\r\n            (cost.resources[resource] ?? 0) &&\r\n          getResourceCap(state, resource) >= (cost.resources[resource] ?? 0),\r\n      ) &&\r\n      keysOf(cost.items).every(\r\n        (itemId) =>\r\n          getTotalAmountOfItem(Items.getById(itemId), state) >=\r\n          cost.items[itemId],\r\n      )\r\n    );\r\n  }\r\n\r\n  isCapEnough(state: GameState): boolean {\r\n    const cost = this.getCost(state);\r\n    return (Object.keys(cost.resources) as Array<Resource>).every(\r\n      (resource: Resource) => {\r\n        return (\r\n          (cost.resources[resource] ?? 0) <= getResourceCap(state, resource)\r\n        );\r\n      },\r\n    );\r\n  }\r\n\r\n  payCost(state: GameState, n?: number): GameState {\r\n    const cost = this.getCost(state);\r\n    const times = n ?? 1;\r\n    (Object.keys(cost.resources) as Array<Resource>).forEach((resourceName) => {\r\n      state = grantResource(\r\n        resourceName,\r\n        -(cost?.resources?.[resourceName] ?? 0) * times,\r\n      )(state);\r\n    });\r\n    (Object.keys(cost.items) as Array<string>).forEach((itemId) => {\r\n      state = removeFromInventoryWithAnyParams(\r\n        Items.getById(itemId),\r\n        cost.items[itemId] * times,\r\n        state,\r\n      );\r\n    });\r\n\r\n    return state;\r\n  }\r\n\r\n  isEnabled(state: GameState, skipAffordabilityChecks?: boolean): boolean {\r\n    if (skipAffordabilityChecks) {\r\n      return true;\r\n    }\r\n    return this.canAfford(state);\r\n  }\r\n\r\n  // Returns true if the action is considered \"active\".\r\n  // Used mainly for spells that give buffs, to display a visual aid.\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, this.getId());\r\n  }\r\n\r\n  requireConfirmation(state: GameState): boolean {\r\n    return false;\r\n  }\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"boostingMachine\",\r\n  t(\"The Fancy Paperweight\"),\r\n  370,\r\n  30,\r\n  t(\"Explore and defeat the boss of The Sphinx\"),\r\n  t('Permanently unlock \"Boost\"'),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as BoostingMachine };\r\n","import { Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nexport const RESOURCE_FOR_ELEMENT: Record<SpellElement, Resource> = {\r\n  Fire: Resource.FireEssence,\r\n  Earth: Resource.EarthEssence,\r\n  Water: Resource.WaterEssence,\r\n  Air: Resource.AirEssence,\r\n  Poison: Resource.PoisonEssence,\r\n  Mind: Resource.MindEssence,\r\n  Life: Resource.LifeEssence,\r\n  Electric: Resource.ElectricEssence,\r\n  Death: Resource.DeathEssence,\r\n  Holy: Resource.HolyEssence,\r\n  Time: Resource.TimeEssence,\r\n  Space: Resource.SpaceEssence,\r\n};\r\n","import memoize from \"sonic-memoize\";\r\nimport { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource, clearResourceCapCache, grantResource } from \"../Resources\";\r\nimport { Action, DoActionArgs } from \"../action/Action\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../action/ActionAreas\";\r\nimport { getVisibleActionsForAreaBySubcategory } from \"../action/Actions\";\r\nimport { BoostingMachine } from \"../events/storyline/desert/BoostingMachineStoryline\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { clearCombatStatCache } from \"../exploration/CombatStats\";\r\nimport { SpellElement, getUnlockedElements } from \"../spells/Elements\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../spells/channeling/ChannelingResources\";\r\nimport { clearCalculatedIncomeCache } from \"../timetick/IncomeOverTime\";\r\nimport { applyTransformations } from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\n\r\nabstract class BoostActionBase extends Action {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return getUnlockedElements(state).includes(this.getElement());\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { BOOST: [ActionSubcategories.BOOST] };\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return super.getTags().concat([TransformationTags.Boost]);\r\n  }\r\n\r\n  abstract getName(): string;\r\n\r\n  getDisplayName(state: GameState): string {\r\n    const bought = getBoughtBoostsAmount(state, this.getElement());\r\n    return this.getName() + (bought > 0 ? ` (${bought})` : \"\");\r\n  }\r\n\r\n  abstract getElement(): SpellElement;\r\n\r\n  _costScaleMonstium = memoize(() => [\r\n    ...this.getTags(),\r\n    Resource.Monstium,\r\n    TransformationTags.CostScale,\r\n  ]);\r\n  _costScaleEssence = memoize((essence) => [\r\n    ...this.getTags(),\r\n    essence,\r\n    TransformationTags.CostScale,\r\n  ]);\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    const element = this.getElement();\r\n    const essence = RESOURCE_FOR_ELEMENT[element];\r\n    const fractionAddedPerUpgrade = applyTransformations(\r\n      this._costScaleMonstium(),\r\n      state,\r\n      0.2,\r\n    );\r\n    const essenceFractionAddedPerUpgrade = applyTransformations(\r\n      this._costScaleEssence(essence),\r\n      state,\r\n      0.4,\r\n    );\r\n    const resourcesObject = {\r\n      Monstium:\r\n        Math.pow(1.0 + fractionAddedPerUpgrade, getTotalBoughtBoosts(state)) *\r\n        100,\r\n    };\r\n    resourcesObject[essence] =\r\n      Math.pow(\r\n        1.0 + essenceFractionAddedPerUpgrade,\r\n        getBoughtBoostsAmount(state, element),\r\n      ) * 1000;\r\n    return {\r\n      resources: resourcesObject,\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  abstract getTotalBoostDescription(state: GameState): string;\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n    const cost = this.getCost(state).resources;\r\n    state.run.boostsBought[this.getElement()]++;\r\n    state = grantResource(Resource.Monstium, -(cost.Monstium ?? 0))(state);\r\n    state = grantResource(\r\n      RESOURCE_FOR_ELEMENT[this.getElement()],\r\n      -(cost[RESOURCE_FOR_ELEMENT[this.getElement()]] ?? 0),\r\n    )(state);\r\n    state = clearCombatStatCache(state, AttackTarget.Player);\r\n    state = clearCalculatedIncomeCache(state);\r\n    state = clearResourceCapCache(state);\r\n    return state;\r\n  }\r\n\r\n  canAutoPurchaseMax(): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function isBoostingUnlocked(state: GameState): boolean {\r\n  return BoostingMachine.isBonusActive(state);\r\n}\r\n\r\nexport function getBoughtBoostsAmount(\r\n  state: GameState,\r\n  element: SpellElement,\r\n): number {\r\n  return state.run.boostsBought[element];\r\n}\r\n\r\nexport function hasBoosts(state: GameState) {\r\n  return getTotalBoughtBoosts(state) > 0;\r\n}\r\n\r\nexport function getBoostsBonusText(state: GameState): string {\r\n  const visibleBoosts = (getVisibleActionsForAreaBySubcategory(\r\n    state,\r\n    ActionArea.BOOST,\r\n  )?.[ActionSubcategories.BOOST] ?? []) as BoostActionBase[];\r\n  return visibleBoosts\r\n    .map((visibleBoost) => {\r\n      if (getBoughtBoostsAmount(state, visibleBoost.getElement()) <= 0) {\r\n        return null;\r\n      }\r\n      return visibleBoost.getTotalBoostDescription(state);\r\n    })\r\n    .filter((value) => value != null)\r\n    .join(t(\", \"));\r\n}\r\n\r\nexport function getTotalBoughtBoosts(state: GameState): number {\r\n  return valuesOf(SpellElement)\r\n    .map((element) => getBoughtBoostsAmount(state, element))\r\n    .reduce((prev, current) => prev + current, 0);\r\n}\r\n\r\nexport default BoostActionBase;\r\n","export type NotificationData = {\r\n  id: string;\r\n  group: string;\r\n  item: string;\r\n  globalTimestampTriggered: number;\r\n  globalTimestampRead: number | undefined;\r\n};\r\n\r\nexport function isNotificationRead(data: NotificationData): boolean {\r\n  return (data?.globalTimestampRead ?? 0) > data.globalTimestampTriggered;\r\n}\r\n","import { GameState } from \"./GameState\";\r\nimport { NotificationData, isNotificationRead } from \"./Notification\";\r\nimport { getTotalSecondsPlayed } from \"./timetick/TotalTimePlayed\";\r\n\r\nexport function getNotificationById(\r\n  state: GameState,\r\n  id: string,\r\n): NotificationData | undefined {\r\n  return state.global.notifications.find(\r\n    (notification) => notification.id == id,\r\n  );\r\n}\r\n\r\nexport function getNotificationByGroupAndItem(\r\n  state: GameState,\r\n  group: string,\r\n  item: string,\r\n): NotificationData | undefined {\r\n  return state.global.notifications.find(\r\n    (notification) => notification.group == group && notification.item == item,\r\n  );\r\n}\r\n\r\nexport function getNotificationsByGroup(\r\n  state: GameState,\r\n  group: string,\r\n): NotificationData[] {\r\n  return state.global.notifications.filter(\r\n    (notification) => notification.group == group,\r\n  );\r\n}\r\n\r\nexport function getUnreadNotificationsByGroup(\r\n  state: GameState,\r\n  group: string,\r\n): NotificationData[] {\r\n  return getNotificationsByGroup(state, group).filter(\r\n    (notification) => !isNotificationRead(notification),\r\n  );\r\n}\r\n\r\nexport function triggerNotification(\r\n  state: GameState,\r\n  group: string,\r\n  item: string,\r\n): GameState {\r\n  const previousNotification = getNotificationByGroupAndItem(\r\n    state,\r\n    group,\r\n    item,\r\n  );\r\n  if (previousNotification) {\r\n    previousNotification.globalTimestampTriggered =\r\n      getTotalSecondsPlayed(state);\r\n    return state;\r\n  }\r\n\r\n  state.global.notifications.push({\r\n    id: Math.random().toString(),\r\n    group,\r\n    item,\r\n    globalTimestampTriggered: getTotalSecondsPlayed(state),\r\n    globalTimestampRead: undefined,\r\n  });\r\n  return state;\r\n}\r\n\r\nexport function markNotificationAsRead(\r\n  state: GameState,\r\n  group: string,\r\n  item: string,\r\n): GameState {\r\n  const previousNotification = getNotificationByGroupAndItem(\r\n    state,\r\n    group,\r\n    item,\r\n  );\r\n  if (previousNotification) {\r\n    if (!isNotificationRead(previousNotification)) {\r\n      previousNotification.globalTimestampRead = getTotalSecondsPlayed(state);\r\n    }\r\n  }\r\n  return state;\r\n}\r\n","import { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { Spell } from \"../spells/Spell\";\r\nimport { AutocastConditionParameterType } from \"./AutocastConditionParameterType\";\r\n\r\nexport type AutocastConditionParameter = {\r\n  parameterType: AutocastConditionParameterType;\r\n  name: string;\r\n};\r\n\r\nexport abstract class AutocastCondition implements Identifiable {\r\n  abstract getId(): string;\r\n\r\n  abstract getDisplayName(): string;\r\n\r\n  abstract getParameters(): AutocastConditionParameter[];\r\n\r\n  abstract getDisplayExplanation(state: GameState, values: string[]): string;\r\n\r\n  abstract isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean;\r\n\r\n  validate(state: GameState, values: string[]): Record<number, string> {\r\n    const parameters = this.getParameters();\r\n    let validation = {};\r\n    for (let idx in parameters) {\r\n      const validationResponse = parameters[idx].parameterType.validate(\r\n        state,\r\n        values[idx] ?? \"\",\r\n      );\r\n      if (validationResponse != null) {\r\n        validation[idx] = validationResponse;\r\n      }\r\n    }\r\n    return validation;\r\n  }\r\n}\r\n\r\nexport const AutocastConditions = new DataStore<AutocastCondition>();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\n\r\nclass AlwaysAutocastCondition extends AutocastCondition {\r\n  getId(): string {\r\n    return \"Always\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Always\");\r\n  }\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [];\r\n  }\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\"Always\");\r\n  }\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    return true;\r\n  }\r\n  validate(state: GameState, values: string[]): Record<number, string> {\r\n    return {};\r\n  }\r\n}\r\n\r\nexport default new AlwaysAutocastCondition();\r\n","import { GameState } from \"../GameState\";\r\n\r\nexport type AutocastConditionParameterOption = {\r\n  label: string;\r\n  value: string;\r\n};\r\n\r\nexport enum AutocastConditionParameterDisplay {\r\n  TEXT_FIELD = \"TEXT_FIELD\",\r\n  PICKER = \"PICKER\",\r\n}\r\n\r\nexport abstract class AutocastConditionParameterType {\r\n  abstract getDisplay(): AutocastConditionParameterDisplay;\r\n  abstract getOptions(state: GameState): AutocastConditionParameterOption[];\r\n  abstract validate(state: GameState, value: string): string | undefined;\r\n}\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport {\r\n  AutocastConditionParameterDisplay,\r\n  AutocastConditionParameterOption,\r\n  AutocastConditionParameterType,\r\n} from \"../../AutocastConditionParameterType\";\r\n\r\nexport class NumericAutocastConditionParameterType extends AutocastConditionParameterType {\r\n  constructor(\r\n    private min: number | undefined,\r\n    private max: number | undefined,\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  getDisplay(): AutocastConditionParameterDisplay {\r\n    return AutocastConditionParameterDisplay.TEXT_FIELD;\r\n  }\r\n\r\n  getOptions(state: GameState): AutocastConditionParameterOption[] {\r\n    return [];\r\n  }\r\n\r\n  validate(state: GameState, value: string): string | undefined {\r\n    try {\r\n      const amount = Number.parseFloat(value);\r\n      if (Number.isNaN(amount)) {\r\n        return t(\"Value must be a number\");\r\n      }\r\n      if (this.min != undefined && amount < this.min) {\r\n        return t(\"Value must be {{min}} or higher\", {\r\n          min: formatNumber(this.min),\r\n        });\r\n      }\r\n      if (this.max != undefined && amount > this.max) {\r\n        return t(\"Value must be {{max}} or lower\", {\r\n          max: formatNumber(this.max),\r\n        });\r\n      }\r\n    } catch (e) {\r\n      return t(\"Value must be a number\");\r\n    }\r\n    return;\r\n  }\r\n}\r\n","import { valuesOf } from \"../../../../utils/CoreUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport {\r\n  hasEverHadResource,\r\n  Resource,\r\n  translateResource,\r\n} from \"../../../Resources\";\r\nimport {\r\n  AutocastConditionParameterDisplay,\r\n  AutocastConditionParameterOption,\r\n  AutocastConditionParameterType,\r\n} from \"../../AutocastConditionParameterType\";\r\n\r\nexport class ResourceAutocastConditionParameterType extends AutocastConditionParameterType {\r\n  getDisplay(): AutocastConditionParameterDisplay {\r\n    return AutocastConditionParameterDisplay.PICKER;\r\n  }\r\n\r\n  getOptions(state: GameState): AutocastConditionParameterOption[] {\r\n    return valuesOf(Resource)\r\n      .filter((resource) => hasEverHadResource(state, resource))\r\n      .map((resource) => ({\r\n        label: translateResource(resource),\r\n        value: resource,\r\n      }));\r\n  }\r\n\r\n  validate(state: GameState, value: string): string | undefined {\r\n    if (!valuesOf(Resource).includes(value as Resource)) {\r\n      return t(\"You must select a resource\");\r\n    }\r\n    return;\r\n  }\r\n}\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { getResourceAmount, Resource } from \"../../Resources\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\nimport { NumericAutocastConditionParameterType } from \"./parameters/NumericAutocastConditionParameterType\";\r\nimport { ResourceAutocastConditionParameterType } from \"./parameters/ResourceAutocastConditionParameterType\";\r\n\r\nclass ResourceLessThanAutocastCondition extends AutocastCondition {\r\n  getId(): string {\r\n    return \"IfResourceAmountLessThan\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"If held resource is less than\");\r\n  }\r\n\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [\r\n      {\r\n        parameterType: new ResourceAutocastConditionParameterType(),\r\n        name: t(\"Resource\"),\r\n      },\r\n      {\r\n        parameterType: new NumericAutocastConditionParameterType(0, undefined),\r\n        name: t(\"Amount\"),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\"If less than {{amount}}{{resourceIcon}} are held\", {\r\n      amount: formatNumber(Number.parseFloat(values[1])),\r\n      resourceIcon: `:${values[0].toLowerCase()}:`,\r\n    });\r\n  }\r\n\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    const resource = values[0] as Resource;\r\n    const amount = Number.parseFloat(values[1]);\r\n    return getResourceAmount(state, resource) < amount;\r\n  }\r\n}\r\n\r\nexport default new ResourceLessThanAutocastCondition();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { getResourceAmount, getResourceCap, Resource } from \"../../Resources\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\nimport { NumericAutocastConditionParameterType } from \"./parameters/NumericAutocastConditionParameterType\";\r\nimport { ResourceAutocastConditionParameterType } from \"./parameters/ResourceAutocastConditionParameterType\";\r\n\r\nclass ResourceLessThanAutocastConditionRatio extends AutocastCondition {\r\n  getId(): string {\r\n    return \"IfResourceAmountLessThanRatio\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"If held resource is less than % of max\");\r\n  }\r\n\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [\r\n      {\r\n        parameterType: new ResourceAutocastConditionParameterType(),\r\n        name: t(\"Resource\"),\r\n      },\r\n      {\r\n        parameterType: new NumericAutocastConditionParameterType(0, 100),\r\n        name: t(\"Percent\"),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\"If less than {{amount}}% of the max {{resourceIcon}} are held\", {\r\n      amount: formatNumber(Number.parseFloat(values[1])),\r\n      resourceIcon: `:${values[0].toLowerCase()}:`,\r\n    });\r\n  }\r\n\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    const resource = values[0] as Resource;\r\n    const percent = Number.parseFloat(values[1]);\r\n    return (\r\n      getResourceAmount(state, resource) / getResourceCap(state, resource) <\r\n      percent / 100.0\r\n    );\r\n  }\r\n}\r\n\r\nexport default new ResourceLessThanAutocastConditionRatio();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { getResourceAmount, Resource } from \"../../Resources\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\nimport { NumericAutocastConditionParameterType } from \"./parameters/NumericAutocastConditionParameterType\";\r\nimport { ResourceAutocastConditionParameterType } from \"./parameters/ResourceAutocastConditionParameterType\";\r\n\r\nclass ResourceMoreThanAutocastCondition extends AutocastCondition {\r\n  getId(): string {\r\n    return \"IfResourceAmountMoreThan\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"If held resource is at least\");\r\n  }\r\n\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [\r\n      {\r\n        parameterType: new ResourceAutocastConditionParameterType(),\r\n        name: t(\"Resource\"),\r\n      },\r\n      {\r\n        parameterType: new NumericAutocastConditionParameterType(0, undefined),\r\n        name: t(\"Amount\"),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\"If at least {{amount}}{{resourceIcon}} are held\", {\r\n      amount: formatNumber(Number.parseFloat(values[1])),\r\n      resourceIcon: `:${values[0].toLowerCase()}:`,\r\n    });\r\n  }\r\n\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    const resource = values[0] as Resource;\r\n    const amount = Number.parseFloat(values[1]);\r\n    return getResourceAmount(state, resource) >= amount;\r\n  }\r\n}\r\n\r\nexport default new ResourceMoreThanAutocastCondition();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { getResourceAmount, getResourceCap, Resource } from \"../../Resources\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\nimport { NumericAutocastConditionParameterType } from \"./parameters/NumericAutocastConditionParameterType\";\r\nimport { ResourceAutocastConditionParameterType } from \"./parameters/ResourceAutocastConditionParameterType\";\r\n\r\nclass ResourceMoreThanAutocastConditionRatio extends AutocastCondition {\r\n  getId(): string {\r\n    return \"IfResourceAmountMoreThanRatio\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"If held resource is at least % of max\");\r\n  }\r\n\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [\r\n      {\r\n        parameterType: new ResourceAutocastConditionParameterType(),\r\n        name: t(\"Resource\"),\r\n      },\r\n      {\r\n        parameterType: new NumericAutocastConditionParameterType(0, 100),\r\n        name: t(\"Percent\"),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\"If at least {{amount}}% of the max {{resourceIcon}} are held\", {\r\n      amount: formatNumber(Number.parseFloat(values[1])),\r\n      resourceIcon: `:${values[0].toLowerCase()}:`,\r\n    });\r\n  }\r\n\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    const resource = values[0] as Resource;\r\n    const percent = Number.parseFloat(values[1]);\r\n    return (\r\n      getResourceAmount(state, resource) / getResourceCap(state, resource) >=\r\n      percent / 100.0\r\n    );\r\n  }\r\n}\r\n\r\nexport default new ResourceMoreThanAutocastConditionRatio();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\n\r\nclass SmartlyAutocastCondition extends AutocastCondition {\r\n  getId(): string {\r\n    return \"Smartly\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Smartly\");\r\n  }\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [];\r\n  }\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\"Smartly\");\r\n  }\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    if (spell == null) {\r\n      return true;\r\n    }\r\n    return spell.isCastingRecommended(state);\r\n  }\r\n  validate(state: GameState, values: string[]): Record<number, string> {\r\n    return {};\r\n  }\r\n}\r\n\r\nexport default new SmartlyAutocastCondition();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport {\r\n  hasEverHadTemporaryEffect,\r\n  TemporaryEffects,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  AutocastConditionParameterDisplay,\r\n  AutocastConditionParameterOption,\r\n  AutocastConditionParameterType,\r\n} from \"../../AutocastConditionParameterType\";\r\n\r\nexport class TemporaryEffectAutocastConditionParameterType extends AutocastConditionParameterType {\r\n  getDisplay(): AutocastConditionParameterDisplay {\r\n    return AutocastConditionParameterDisplay.PICKER;\r\n  }\r\n\r\n  getOptions(state: GameState): AutocastConditionParameterOption[] {\r\n    return TemporaryEffects.getAll()\r\n      .filter((effect) => hasEverHadTemporaryEffect(state, effect.getId()))\r\n      .map((effect) => ({\r\n        label: effect.getDisplayName(),\r\n        value: effect.getId(),\r\n      }));\r\n  }\r\n\r\n  validate(state: GameState, value: string): string | undefined {\r\n    if (TemporaryEffects.getByIdNullable(value) == null) {\r\n      return t(\"You must select a buff / debuff\");\r\n    }\r\n    return;\r\n  }\r\n}\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  getTemporaryEffectEndTime,\r\n  TemporaryEffects,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\nimport { NumericAutocastConditionParameterType } from \"./parameters/NumericAutocastConditionParameterType\";\r\nimport { TemporaryEffectAutocastConditionParameterType } from \"./parameters/TemporaryEffectAutocastConditionParameterType\";\r\n\r\nclass TemporaryEffectLowTimeRemainingAutocastCondition extends AutocastCondition {\r\n  getId(): string {\r\n    return \"IfBuffNotPresentOrTimeRemainingLessThanPlayer\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\r\n      \"If buff / debuff is not present on player or its time left is less than\",\r\n    );\r\n  }\r\n\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [\r\n      {\r\n        parameterType: new TemporaryEffectAutocastConditionParameterType(),\r\n        name: t(\"Buff / debuff\"),\r\n      },\r\n      {\r\n        parameterType: new NumericAutocastConditionParameterType(0, undefined),\r\n        name: t(\"Time remaining (sec)\"),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\r\n      \"If player's buff / debuff *{{buff}}* is over or has less than {{amount}} sec left\",\r\n      {\r\n        buff: TemporaryEffects.getById(values[0]).getDisplayName(),\r\n        amount: formatNumber(Number.parseFloat(values[1])),\r\n      },\r\n    );\r\n  }\r\n\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    const temporaryEffectId = values[0];\r\n    const timeLeftSecs = Number.parseFloat(values[1]);\r\n    const actualTimeLeft =\r\n      getTemporaryEffectEndTime(state, temporaryEffectId, AttackTarget.Player) -\r\n      getSecondsPlayed(state);\r\n    return actualTimeLeft < timeLeftSecs;\r\n  }\r\n}\r\n\r\nexport default new TemporaryEffectLowTimeRemainingAutocastCondition();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  TemporaryEffects,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  AutocastCondition,\r\n  AutocastConditionParameter,\r\n} from \"../AutocastCondition\";\r\nimport { TemporaryEffectAutocastConditionParameterType } from \"./parameters/TemporaryEffectAutocastConditionParameterType\";\r\n\r\nclass TemporaryEffectPresentAutocastCondition extends AutocastCondition {\r\n  getId(): string {\r\n    return \"IfBuffPresentPlayer\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"If player has buff / debuff\");\r\n  }\r\n\r\n  getParameters(): AutocastConditionParameter[] {\r\n    return [\r\n      {\r\n        parameterType: new TemporaryEffectAutocastConditionParameterType(),\r\n        name: t(\"Buff / debuff\"),\r\n      },\r\n    ];\r\n  }\r\n\r\n  getDisplayExplanation(state: GameState, values: string[]): string {\r\n    return t(\"If player has buff / debuff *{{buff}}*\", {\r\n      buff: TemporaryEffects.getById(values[0]).getDisplayName(),\r\n    });\r\n  }\r\n\r\n  isConditionMet(\r\n    state: GameState,\r\n    spell: Spell | undefined,\r\n    values: string[],\r\n  ): boolean {\r\n    return hasTemporaryEffect(state, values[0], AttackTarget.Player);\r\n  }\r\n}\r\n\r\nexport default new TemporaryEffectPresentAutocastCondition();\r\n","import memoize from \"sonic-memoize\";\r\nimport { addRecords, clone, fromEntries, keysOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport {\r\n  cacheByArbitraryVersion,\r\n  cacheIndefinitely,\r\n  clearCacheKey,\r\n} from \"../Caching\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasFlag, setFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport {\r\n  Resource,\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n} from \"../Resources\";\r\nimport { registerPostRetirementListener } from \"../Retire\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport { Spell } from \"../spells/Spell\";\r\nimport { Spells, registerSpellCacheClearedListener } from \"../spells/Spells\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { AutocastCondition, AutocastConditions } from \"./AutocastCondition\";\r\nimport { loadAutocastConditions } from \"./conditions/AutocastConditionLoader\";\r\nimport SmartlyAutocastCondition from \"./conditions/SmartlyAutocastCondition\";\r\n\r\nexport enum SpellAutocastCategory {\r\n  TRANSMUTATION = \"TRANSMUTATION\",\r\n  CHANNELING = \"CHANNELING\",\r\n  GENERAL_BUFF = \"GENERAL_BUFF\",\r\n  COMBAT_BUFF = \"COMBAT_BUFF\",\r\n  ATTACK = \"ATTACK\",\r\n  HEALING = \"HEALING\",\r\n  OTHER = \"OTHER\",\r\n}\r\n\r\nexport type AutocastRule = {\r\n  id: string;\r\n  spellId: string;\r\n  disabled: boolean;\r\n  wizardsAssigned: number;\r\n  conditions: AutocastConditionData[];\r\n};\r\n\r\nexport type AutocastRuleStatus = {\r\n  wizardsAssigned: number;\r\n  disabled: boolean;\r\n  currentPoints: number;\r\n  hidden: boolean;\r\n};\r\n\r\nexport type AutocastStrategy = {\r\n  rules: AutocastRule[];\r\n  permaCastRules: Record<string, AutocastRule>;\r\n  wizardsAssignedToPermaCast: number;\r\n  name: string;\r\n};\r\n\r\nexport type AutocastConditionData = {\r\n  condition: string;\r\n  values: string[];\r\n};\r\n\r\nexport function translateSpellAutocastCategory(\r\n  category: SpellAutocastCategory,\r\n): string {\r\n  switch (category) {\r\n    case SpellAutocastCategory.ATTACK:\r\n      return t(\"Attack Spell\");\r\n    case SpellAutocastCategory.CHANNELING:\r\n      return t(\"Channeling\");\r\n    case SpellAutocastCategory.COMBAT_BUFF:\r\n      return t(\"Combat Buff / Debuff\");\r\n    case SpellAutocastCategory.GENERAL_BUFF:\r\n      return t(\"General Buff / Debuff\");\r\n    case SpellAutocastCategory.HEALING:\r\n      return t(\"Healing\");\r\n    case SpellAutocastCategory.TRANSMUTATION:\r\n      return t(\"Transmutation\");\r\n    case SpellAutocastCategory.OTHER:\r\n      return t(\"Other\");\r\n    // Do not add a default\r\n  }\r\n}\r\n\r\nconst productionTags = [TransformationTags.AutocastPointsProduction];\r\nconst productionUnit = {\r\n  unit: \":wizardpower:\",\r\n};\r\nexport function getAutocastPointIncomePerSecPerWizard(state: GameState) {\r\n  return applyTransformations(productionTags, state, 1.0);\r\n}\r\nexport function explainAutocastPointIncomePerSecPerWizard(state: GameState) {\r\n  return explainTransformationsText(productionTags, state, 1.0, productionUnit);\r\n}\r\n\r\nconst wizardAmountTags = [TransformationTags.WizardAmount];\r\nexport function getWizardAmount(state: GameState) {\r\n  return Math.floor(applyTransformations(wizardAmountTags, state, 1.0));\r\n}\r\nconst wizardAmountUnit = memoize(() => ({\r\n  unit: t(\" wizard(s)\"),\r\n}));\r\nexport function explainWizardAmount(state: GameState) {\r\n  return explainTransformationsText(\r\n    wizardAmountTags,\r\n    state,\r\n    1.0,\r\n    wizardAmountUnit(),\r\n  );\r\n}\r\n\r\nfunction getUsedWizards(state: GameState) {\r\n  let usedWizards = 0;\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n  for (let idx = 0; idx < strategy.rules.length; idx++) {\r\n    usedWizards += getAssignedWizardsByRuleIndex(state, idx) ?? 0;\r\n  }\r\n  usedWizards += strategy.wizardsAssignedToPermaCast;\r\n  return usedWizards;\r\n}\r\n\r\nexport function getFreeWizards(state: GameState) {\r\n  return Math.floor(getWizardAmount(state) - getUsedWizards(state));\r\n}\r\n\r\nexport function getAutocastPointCap(state: GameState, rule: AutocastRule) {\r\n  return (\r\n    Spells.getByIdNullable(rule.spellId)?.getAutocastPointsRequirement(state) ??\r\n    0\r\n  );\r\n}\r\n\r\nfunction grantAutocastPoints(\r\n  state: GameState,\r\n  ruleIdx: number,\r\n  amount: number,\r\n) {\r\n  if (amount == 0) {\r\n    return state;\r\n  }\r\n  const rule = getCurrentAutocastStrategy(state).rules[ruleIdx];\r\n  return grantAutocastPointsToRule(\r\n    state,\r\n    rule,\r\n    amount,\r\n    Spells.getByIdNullable(rule.spellId),\r\n  );\r\n}\r\n\r\nfunction grantAutocastPointsToRule(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  amount: number,\r\n  spell: Spell,\r\n) {\r\n  const ruleStatus = getAutocastStatusByRule(state, rule);\r\n  ruleStatus.currentPoints = Math.min(\r\n    spell.getAutocastPointsRequirement(state),\r\n    Math.max(0, ruleStatus.currentPoints + amount),\r\n  );\r\n  state.run.autocast.rules[rule.id] = ruleStatus;\r\n  return state;\r\n}\r\n\r\nexport function assignWizardsToPermaCast(state: GameState, amount: number) {\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n  const freeWizards = getFreeWizards(state);\r\n  const amountToAdd = Math.min(freeWizards, amount);\r\n  strategy.wizardsAssignedToPermaCast = Math.max(\r\n    0,\r\n    strategy.wizardsAssignedToPermaCast + amountToAdd,\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function permaCastWizardsNeeded(state: GameState, spell: Spell): number {\r\n  const wizardPowerProductionPerWizard =\r\n    getAutocastPointIncomePerSecPerWizard(state);\r\n  const wizardPowerNeeded = permaCastWizardPowerNeeded(state, spell);\r\n  const wizardsNeeded = Math.ceil(\r\n    wizardPowerNeeded / wizardPowerProductionPerWizard,\r\n  );\r\n  return wizardsNeeded;\r\n}\r\n\r\nexport function permaCastWizardPowerNeeded(\r\n  state: GameState,\r\n  spell: Spell,\r\n): number {\r\n  const delay = spell.getPermaCastDelaySec(state);\r\n  const wizardPowerConsumption = spell.getAutocastPointsRequirement(state);\r\n  return wizardPowerConsumption / delay;\r\n}\r\n\r\nexport function addSpellToPermaCast(state: GameState, spell: Spell): GameState {\r\n  if (!spell.isPermaCastAllowed()) {\r\n    return state;\r\n  }\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n  const rule = getAutocastRuleBySpell(state, spell);\r\n  if (rule != null) {\r\n    strategy.rules = strategy.rules.filter(\r\n      (strategyRule) => rule != strategyRule,\r\n    );\r\n  }\r\n  strategy.permaCastRules[spell.getId()] = {\r\n    conditions: DEFAULT_CONDITIONS,\r\n    disabled: false,\r\n    id: Math.random().toString(),\r\n    spellId: spell.getId(),\r\n    wizardsAssigned: 0,\r\n  };\r\n  state = clearAutocastCaches(state);\r\n  const totalWizardsNeeded = estimateWizardsNeededPermaCast(state, strategy);\r\n  const currentWizards = strategy.wizardsAssignedToPermaCast;\r\n  if (currentWizards < totalWizardsNeeded) {\r\n    state = assignWizardsToPermaCast(\r\n      state,\r\n      totalWizardsNeeded - currentWizards,\r\n    );\r\n  }\r\n  clearPermacastCache(state);\r\n  return state;\r\n}\r\n\r\nexport function removeSpellFromPermaCast(\r\n  state: GameState,\r\n  spell: Spell,\r\n): GameState {\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n  if (!strategy.permaCastRules[spell.getId()]) {\r\n    return state;\r\n  }\r\n  const totalWizardsNeededBefore = estimateWizardsNeededPermaCast(\r\n    state,\r\n    strategy,\r\n  );\r\n  const currentWizards = strategy.wizardsAssignedToPermaCast;\r\n  delete strategy.permaCastRules[spell.getId()];\r\n  state = clearPermacastCache(state);\r\n  state = clearAutocastCaches(state);\r\n  const totalWizardsNeededAfter = estimateWizardsNeededPermaCast(\r\n    state,\r\n    strategy,\r\n  );\r\n  // Only keep it \"synced\" if it was already synced in the first place\r\n  if (\r\n    currentWizards == totalWizardsNeededBefore &&\r\n    currentWizards > totalWizardsNeededAfter\r\n  ) {\r\n    state = assignWizardsToPermaCast(\r\n      state,\r\n      totalWizardsNeededAfter - currentWizards,\r\n    );\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function isSpellInWizards(state: GameState, spell: Spell): boolean {\r\n  const rule = getAutocastRuleBySpell(state, spell);\r\n  if (rule == null) {\r\n    return false;\r\n  }\r\n  const status = getAutocastStatusByRule(state, rule);\r\n  return status.wizardsAssigned > 0;\r\n}\r\n\r\nexport function isSpellInPermaCast(state: GameState, spell: Spell): boolean {\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n  return strategy.permaCastRules[spell.getId()] != null;\r\n}\r\n\r\nexport function assignWizardsToRuleIndex(\r\n  state: GameState,\r\n  ruleIdx: number,\r\n  amount: number,\r\n) {\r\n  const rule = getCurrentAutocastStrategy(state).rules[ruleIdx];\r\n  return assignWizardsToRule(state, rule, amount);\r\n}\r\n\r\nexport function assignWizardsToRule(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  amount: number,\r\n) {\r\n  const ruleStatus = getAutocastStatusByRule(state, rule);\r\n  if (ruleStatus == null || rule == null) {\r\n    return state;\r\n  }\r\n  const freeWizards = getFreeWizards(state);\r\n  const amountToAdd = Math.min(freeWizards, amount);\r\n  ruleStatus.wizardsAssigned = Math.max(\r\n    0,\r\n    ruleStatus.wizardsAssigned + amountToAdd,\r\n  );\r\n  rule.wizardsAssigned = ruleStatus.wizardsAssigned;\r\n  state.run.autocast.rules[rule.id] = ruleStatus;\r\n  state = setFlag(Flag.AssignedWizard)(state);\r\n\r\n  return state;\r\n}\r\n\r\nexport function toggleAutocastRuleDisabledIndex(\r\n  state: GameState,\r\n  ruleIdx: number,\r\n) {\r\n  return toggleAutocastRuleDisabled(\r\n    state,\r\n    getCurrentAutocastStrategy(state).rules[ruleIdx],\r\n  );\r\n}\r\n\r\nexport function toggleAutocastRuleDisabled(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n) {\r\n  const ruleStatus = getAutocastStatusByRule(state, rule);\r\n  ruleStatus.disabled = !ruleStatus.disabled;\r\n  rule.disabled = ruleStatus.disabled;\r\n  state.run.autocast.rules[rule.id] = ruleStatus;\r\n  return state;\r\n}\r\n\r\nexport function toggleAutocastRuleHiddenIndex(\r\n  state: GameState,\r\n  ruleIdx: number,\r\n) {\r\n  const rule = getCurrentAutocastStrategy(state).rules[ruleIdx];\r\n  return toggleAutocastRuleHidden(state, rule);\r\n}\r\n\r\nexport function toggleAutocastRuleHidden(state: GameState, rule: AutocastRule) {\r\n  const ruleStatus = getAutocastStatusByRule(state, rule);\r\n  ruleStatus.hidden = !ruleStatus.hidden;\r\n  state.run.autocast.rules[rule.id] = ruleStatus;\r\n  return state;\r\n}\r\n\r\nexport function unhideAllRules(state: GameState) {\r\n  for (let id in state.run.autocast.rules) {\r\n    state.run.autocast.rules[id].hidden = false;\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getCurrentAutocastStrategy(state: GameState): AutocastStrategy {\r\n  return state.global.autocast.currentStrategy;\r\n}\r\n\r\nexport function getAutocastStatusByRuleIndex(\r\n  state: GameState,\r\n  index: number,\r\n): AutocastRuleStatus {\r\n  const rule = getCurrentAutocastStrategy(state).rules[index];\r\n  return getAutocastStatusByRule(state, rule);\r\n}\r\n\r\nexport function getAutocastRuleIndexByRule(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n): number {\r\n  return getCurrentAutocastStrategy(state).rules.findIndex(\r\n    (value) => value.id == rule.id,\r\n  );\r\n}\r\n\r\nexport function getAutocastStatusByRule(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n): AutocastRuleStatus {\r\n  return (\r\n    state.run.autocast.rules?.[rule?.id] ?? {\r\n      currentPoints: 0,\r\n      disabled: false,\r\n      wizardsAssigned: 0,\r\n      hidden: false,\r\n    }\r\n  );\r\n}\r\n\r\nexport function getAutocastRuleBySpell(\r\n  state: GameState,\r\n  spell: Spell,\r\n  strategy?: AutocastStrategy,\r\n): AutocastRule | null {\r\n  if (strategy == null) {\r\n    strategy = getCurrentAutocastStrategy(state);\r\n  }\r\n  for (let rule of strategy.rules) {\r\n    if (rule.spellId == spell.getId()) {\r\n      return rule;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getAutocastRuleById(\r\n  state: GameState,\r\n  ruleId: string,\r\n): AutocastRule | null {\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n  for (let rule of strategy.rules) {\r\n    if (rule.id == ruleId) {\r\n      return rule;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getAssignedWizardsByRuleIndex(\r\n  state: GameState,\r\n  index: number,\r\n): number {\r\n  return getAutocastStatusByRuleIndex(state, index).wizardsAssigned;\r\n}\r\n\r\nexport function saveCurrentAutocastStrategy(\r\n  state: GameState,\r\n  name: string,\r\n  index: number,\r\n): GameState {\r\n  state.global.autocast.currentStrategy.name = name;\r\n  state.global.autocast.savedStrategies[index] = clone(\r\n    state.global.autocast.currentStrategy,\r\n  );\r\n  state.global.autocast.lastStrategyIndex = index;\r\n  return state;\r\n}\r\n\r\nexport function clearAutocastStrategy(\r\n  state: GameState,\r\n  index: number,\r\n): GameState {\r\n  delete state.global.autocast.savedStrategies[index];\r\n  return state;\r\n}\r\n\r\nexport function loadAutocastStrategy(\r\n  state: GameState,\r\n  index: number,\r\n): GameState {\r\n  const strategyToLoad = state.global.autocast.savedStrategies?.[index];\r\n  if (strategyToLoad == null) {\r\n    return state;\r\n  }\r\n\r\n  const oldStrategy = state.global.autocast.currentStrategy;\r\n  const oldRuleStatuses = state.run.autocast.rules;\r\n  state.global.autocast.currentStrategy = clone(strategyToLoad);\r\n  state.run.autocast.rules = {};\r\n\r\n  const permaCastWizards = strategyToLoad.wizardsAssignedToPermaCast;\r\n\r\n  // Go bit by bit assigning wizards and setting status\r\n  for (let idx in state.global.autocast.currentStrategy.rules) {\r\n    const rule = state.global.autocast.currentStrategy.rules[idx];\r\n\r\n    const spell = Spells.getById(rule.spellId);\r\n    const oldRule = getAutocastRuleBySpell(state, spell, oldStrategy);\r\n\r\n    let progress = 0;\r\n    if (oldRule != null) {\r\n      progress = oldRuleStatuses[oldRule.id]?.currentPoints ?? 0;\r\n    }\r\n\r\n    const ruleStatus = getAutocastStatusByRule(state, rule);\r\n    ruleStatus.disabled = rule.disabled;\r\n    ruleStatus.currentPoints = progress;\r\n    state.run.autocast.rules[rule.id] = ruleStatus;\r\n    state = assignWizardsToRule(state, rule, rule.wizardsAssigned);\r\n  }\r\n\r\n  state.global.autocast.currentStrategy.wizardsAssignedToPermaCast = 0;\r\n  state = assignWizardsToPermaCast(state, permaCastWizards);\r\n\r\n  // Transfer over the progress of all permacast rules\r\n  for (let spellId of keysOf(oldStrategy.permaCastRules)) {\r\n    const oldRule = oldStrategy.permaCastRules[spellId];\r\n    const oldRuleId = oldRule.id;\r\n    const newRule =\r\n      state.global.autocast.currentStrategy.permaCastRules[spellId];\r\n    if (newRule != null) {\r\n      const oldRuleProgress = oldRuleStatuses[oldRuleId]?.currentPoints ?? 0;\r\n      const newStatus = getAutocastStatusByRule(state, newRule);\r\n      newStatus.currentPoints = oldRuleProgress;\r\n      state.run.autocast.rules[newRule.id] = newStatus;\r\n    }\r\n  }\r\n\r\n  state.global.autocast.lastStrategyIndex = index;\r\n  state = clearPermacastCache(state);\r\n\r\n  return state;\r\n}\r\n\r\nexport function getConditionFromData(\r\n  conditionData: AutocastConditionData,\r\n): AutocastCondition {\r\n  return AutocastConditions.getById(conditionData.condition);\r\n}\r\n\r\nfunction conditionIsMet(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  conditionData: AutocastConditionData,\r\n): boolean {\r\n  const condition = getConditionFromData(conditionData);\r\n  const spell = Spells.getByIdNullable(rule.spellId);\r\n\r\n  return condition.isConditionMet(state, spell, conditionData.values);\r\n}\r\n\r\nexport function isAutocastUnlocked(state: GameState) {\r\n  return hasFlag(state, Flag.WizardsUnlocked);\r\n}\r\n\r\nexport function isAutocastEverUnlocked(state: GameState) {\r\n  return hasEverHadFlag(state, Flag.WizardsUnlocked);\r\n}\r\n\r\nexport function estimateIntervalBetweenCastsForRule(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  ruleStatus: AutocastRuleStatus,\r\n): number {\r\n  const spell = Spells.getByIdNullable(rule?.spellId);\r\n  if (spell == null) {\r\n    return 0;\r\n  }\r\n\r\n  if (ruleStatus.wizardsAssigned <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const minimumFrequency = spell.getEstimatedMinAutocastDelay(state, rule);\r\n  const timeToFull =\r\n    spell.getAutocastPointsRequirement(state) /\r\n    (ruleStatus.wizardsAssigned * getAutocastPointIncomePerSecPerWizard(state));\r\n\r\n  return Math.max(minimumFrequency, timeToFull);\r\n}\r\n\r\nexport function estimateIntervalBetweenCastsForRuleIndex(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  index: number,\r\n): number {\r\n  return estimateIntervalBetweenCastsForRule(\r\n    state,\r\n    rule,\r\n    getAutocastStatusByRuleIndex(state, index),\r\n  );\r\n}\r\n\r\nexport function estimateManaConsumptionPerSecPerRule(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  ruleStatus: AutocastRuleStatus,\r\n): number {\r\n  const spell = Spells.getByIdNullable(rule?.spellId);\r\n  if (spell == null) {\r\n    return 0;\r\n  }\r\n\r\n  if (ruleStatus.wizardsAssigned <= 0 || rule.disabled) {\r\n    return 0;\r\n  }\r\n\r\n  const manaCost = spell.getCost(state).resources[Resource.Mana] ?? 0;\r\n  return (\r\n    manaCost / estimateIntervalBetweenCastsForRule(state, rule, ruleStatus)\r\n  );\r\n}\r\n\r\nexport function estimateManaConsumptionPerSecPerRuleIndex(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  index: number,\r\n): number {\r\n  return estimateManaConsumptionPerSecPerRule(\r\n    state,\r\n    rule,\r\n    getAutocastStatusByRuleIndex(state, index),\r\n  );\r\n}\r\n\r\nexport function estimateExpGainPerSecPerRule(\r\n  state: GameState,\r\n  rule: AutocastRule,\r\n  index: number,\r\n): Partial<Record<SpellElement, number>> {\r\n  const spell = Spells.getByIdNullable(rule.spellId);\r\n  if (spell == null) {\r\n    return {};\r\n  }\r\n\r\n  if (getAssignedWizardsByRuleIndex(state, index) <= 0 || rule.disabled) {\r\n    return {};\r\n  }\r\n\r\n  const expGain = spell.getExpFromUsage(state);\r\n  const intervalBetweenCasts = estimateIntervalBetweenCastsForRuleIndex(\r\n    state,\r\n    rule,\r\n    index,\r\n  );\r\n  return fromEntries(\r\n    keysOf(expGain).map((element) => [\r\n      element,\r\n      expGain[element] / intervalBetweenCasts,\r\n    ]),\r\n  );\r\n}\r\n\r\nexport function estimateManaConsumptionPerSecPermaCast(\r\n  state: GameState,\r\n  strategy: AutocastStrategy,\r\n): number {\r\n  if (strategy == getCurrentAutocastStrategy(state)) {\r\n    return cacheByArbitraryVersion(\r\n      state,\r\n      \"currentAutocastPermaCastMana\",\r\n      (state) =>\r\n        estimateManaConsumptionPerSecPermaCastUncached(state, strategy),\r\n      (state) => Math.floor(Date.now() / 500),\r\n    );\r\n  }\r\n  return estimateManaConsumptionPerSecPermaCastUncached(state, strategy);\r\n}\r\n\r\nfunction estimateManaConsumptionPerSecPermaCastUncached(\r\n  state: GameState,\r\n  strategy: AutocastStrategy,\r\n): number {\r\n  return keysOf(strategy.permaCastRules)\r\n    .filter((spellId) => {\r\n      const spell = Spells.getById(spellId);\r\n      return (\r\n        spell.isVisible(state) &&\r\n        spell.getManaCost(state) <= getResourceCap(state, Resource.Mana)\r\n      );\r\n    })\r\n    .map((spellId) => Spells.getById(spellId).getPermaCastManaCostPerSec(state))\r\n    .reduce((prev, current) => prev + current, 0);\r\n}\r\n\r\nexport function estimateWizardPowerConsumptionPerSecPermaCast(\r\n  state: GameState,\r\n  strategy: AutocastStrategy,\r\n): number {\r\n  const uncached = (state) =>\r\n    keysOf(strategy.permaCastRules)\r\n      .filter((spellId) => {\r\n        const spell = Spells.getById(spellId);\r\n        return (\r\n          spell.isVisible(state) &&\r\n          spell.getManaCost(state) <= getResourceCap(state, Resource.Mana)\r\n        );\r\n      })\r\n      .map((spellId) =>\r\n        Spells.getById(spellId).getPermaCastAutocastPointsConsumptionPerSec(\r\n          state,\r\n        ),\r\n      )\r\n      .reduce((prev, current) => prev + current, 0);\r\n  if (getCurrentAutocastStrategy(state) != strategy) {\r\n    return uncached(strategy);\r\n  }\r\n  return cacheByArbitraryVersion(\r\n    state,\r\n    \"permacastWizardPowerEstimate\",\r\n    uncached,\r\n    (state) => Math.floor(Date.now() / 500),\r\n  );\r\n}\r\n\r\nexport function clearAutocastCaches(state: GameState): GameState {\r\n  state = clearCacheKey(state, (_state) => \"permacastWizardPowerEstimate\");\r\n  state = clearCacheKey(state, (_state) => \"currentAutocastPermaCastMana\");\r\n  state = clearPermacastCache(state);\r\n  return state;\r\n}\r\n\r\nexport function estimateWizardsNeededPermaCast(\r\n  state: GameState,\r\n  strategy: AutocastStrategy,\r\n): number {\r\n  return Math.ceil(\r\n    estimateWizardPowerConsumptionPerSecPermaCast(state, strategy) /\r\n      getAutocastPointIncomePerSecPerWizard(state),\r\n  );\r\n}\r\n\r\nexport function estimateManaConsumptionPerSecPerStrategy(\r\n  state: GameState,\r\n  strategy: AutocastStrategy,\r\n): number {\r\n  let cumulativeManaConsumption = 0;\r\n\r\n  for (let idx in strategy.rules) {\r\n    cumulativeManaConsumption += estimateManaConsumptionPerSecPerRuleIndex(\r\n      state,\r\n      strategy.rules[idx],\r\n      Number.parseInt(idx),\r\n    );\r\n  }\r\n\r\n  cumulativeManaConsumption += estimateManaConsumptionPerSecPermaCast(\r\n    state,\r\n    strategy,\r\n  );\r\n\r\n  return cumulativeManaConsumption;\r\n}\r\n\r\nexport function estimateExpGainPerSecPerStrategy(\r\n  state: GameState,\r\n  strategy: AutocastStrategy,\r\n): Partial<Record<SpellElement, number>> {\r\n  return strategy.rules.reduce(\r\n    (cumulative, currentRule, idx) =>\r\n      addRecords([\r\n        cumulative,\r\n        estimateExpGainPerSecPerRule(state, currentRule, idx),\r\n      ]),\r\n    {},\r\n  );\r\n}\r\n\r\nexport function getSortedPermaCastSpellList(\r\n  state: GameState,\r\n  strategy: AutocastStrategy,\r\n): Spell[] {\r\n  const permaCastSpells = keysOf(strategy.permaCastRules)\r\n    .map((spellId) => Spells.getById(spellId))\r\n    .filter((spell) => spell.isVisible(state));\r\n  const permaCastSpellRequiredWizardPower = {};\r\n  const permaCastSpellRequiredMana = {};\r\n  for (let spell of permaCastSpells) {\r\n    permaCastSpellRequiredWizardPower[spell.getId()] =\r\n      spell.getPermaCastAutocastPointsConsumptionPerSec(state);\r\n    permaCastSpellRequiredMana[spell.getId()] =\r\n      spell.getPermaCastManaCostPerSec(state);\r\n  }\r\n  // Sort by required wizard power * required Mana\r\n  const sortedPermaCastSpells = permaCastSpells.sort(\r\n    (a, b) =>\r\n      permaCastSpellRequiredWizardPower[a.getId()] *\r\n        permaCastSpellRequiredMana[a.getId()] -\r\n      permaCastSpellRequiredWizardPower[b.getId()] *\r\n        permaCastSpellRequiredMana[b.getId()],\r\n  );\r\n  return sortedPermaCastSpells;\r\n}\r\n\r\nconst DEFAULT_CONDITIONS = [\r\n  {\r\n    condition: SmartlyAutocastCondition.getId(),\r\n    values: [],\r\n  },\r\n];\r\n\r\nfunction clearPermacastCache(state: GameState): GameState {\r\n  return clearCacheKey(state, (_state) => \"permacast\");\r\n}\r\n\r\nfunction calculatePermacastInfo(state: GameState, strategy: AutocastStrategy) {\r\n  const permaCastSpells = keysOf(strategy.permaCastRules).map((spellId) =>\r\n    Spells.getById(spellId),\r\n  );\r\n  return cacheIndefinitely(\r\n    state,\r\n    (_state) => \"permacast\",\r\n    (state) => {\r\n      const permaCastSpellRequiredWizardPower = {};\r\n      const permaCastSpellRequiredMana = {};\r\n      for (let spell of permaCastSpells) {\r\n        permaCastSpellRequiredWizardPower[spell.getId()] =\r\n          spell.getPermaCastAutocastPointsConsumptionPerSec(state);\r\n        permaCastSpellRequiredMana[spell.getId()] =\r\n          spell.getPermaCastManaCostPerSec(state);\r\n      }\r\n      // Sort by required wizard power * required Mana\r\n      const sortedPermaCastSpells = permaCastSpells.sort(\r\n        (a, b) =>\r\n          permaCastSpellRequiredWizardPower[a.getId()] *\r\n            permaCastSpellRequiredMana[a.getId()] -\r\n          permaCastSpellRequiredWizardPower[b.getId()] *\r\n            permaCastSpellRequiredMana[b.getId()],\r\n      );\r\n      return {\r\n        permaCastSpellRequiredWizardPower,\r\n        permaCastSpellRequiredMana,\r\n        sortedPermaCastSpells,\r\n      };\r\n    },\r\n  );\r\n}\r\n\r\nexport function loadAutocast() {\r\n  loadAutocastConditions();\r\n  registerTimeTickListener(\r\n    \"Autocast\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      if (!isAutocastUnlocked(state)) {\r\n        return state;\r\n      }\r\n\r\n      if (state.run.autocast.autocastPaused) {\r\n        return state;\r\n      }\r\n\r\n      state.temp.isInAutocast = true;\r\n\r\n      // Grant autocast points\r\n      const strategy = getCurrentAutocastStrategy(state);\r\n      const income = getAutocastPointIncomePerSecPerWizard(state);\r\n      for (let idx = 0; idx < strategy.rules.length; idx++) {\r\n        state = grantAutocastPoints(\r\n          state,\r\n          idx,\r\n          income *\r\n            (getAssignedWizardsByRuleIndex(state, idx) ?? 0) *\r\n            timeElapsedSec,\r\n        );\r\n      }\r\n\r\n      // Do the actual autocasting\r\n      for (let index = 0; index < strategy.rules.length; index++) {\r\n        const rule = strategy.rules[index];\r\n        const ruleStatus = getAutocastStatusByRuleIndex(state, index);\r\n        if (ruleStatus.disabled || ruleStatus.wizardsAssigned == 0) {\r\n          continue;\r\n        }\r\n        if (rule.spellId == \"checkOnly\") {\r\n          if (\r\n            !rule.conditions.every((condition) =>\r\n              conditionIsMet(state, rule, condition),\r\n            )\r\n          ) {\r\n            break;\r\n          }\r\n          continue;\r\n        }\r\n\r\n        const spell = Spells.getById(rule.spellId);\r\n        const pointsRequired = spell.getAutocastPointsRequirement(state);\r\n        if (ruleStatus.currentPoints < pointsRequired) {\r\n          continue;\r\n        }\r\n        if (!spell.isVisible(state)) {\r\n          continue;\r\n        }\r\n        if (!spell.isEnabled(state)) {\r\n          continue;\r\n        }\r\n\r\n        const conditions =\r\n          rule.conditions.length > 0 ? rule.conditions : DEFAULT_CONDITIONS;\r\n        if (\r\n          conditions.every((condition) =>\r\n            conditionIsMet(state, rule, condition),\r\n          )\r\n        ) {\r\n          state = spell.doAction({ isAutomatic: true }, state);\r\n          state = grantAutocastPoints(state, index, -pointsRequired);\r\n        }\r\n      }\r\n\r\n      // Handle permacast\r\n      // First, calculate total required wizard power\r\n      const {\r\n        permaCastSpellRequiredWizardPower,\r\n        permaCastSpellRequiredMana,\r\n        sortedPermaCastSpells,\r\n      } = calculatePermacastInfo(state, strategy);\r\n\r\n      let availableWizardPower =\r\n        strategy.wizardsAssignedToPermaCast * timeElapsedSec * income;\r\n      const maxMana = getResourceCap(state, Resource.Mana);\r\n\r\n      state.temp.isInPermacast = true;\r\n      for (let spell of sortedPermaCastSpells) {\r\n        const spellId = spell.getId();\r\n        const rule = strategy.permaCastRules[spellId];\r\n        const ruleStatus = getAutocastStatusByRule(state, rule);\r\n\r\n        if (ruleStatus.disabled) {\r\n          continue;\r\n        }\r\n\r\n        const currentMana = getResourceAmount(state, Resource.Mana);\r\n        const manaCostToPay =\r\n          permaCastSpellRequiredMana[spellId] * timeElapsedSec;\r\n\r\n        // There was historically a subtle bug here.\r\n        // The bug happens because incomes were calculated after Autocast.\r\n        // It's a problem because if you have a heavy load and little remaining Mana,\r\n        // Autocast can become delayed due to there not being enough Mana left until\r\n        // the income is granted.\r\n        // We cannot make income be calculated before Autocast, because that will result\r\n        // on a Mana bar that never fully fills up.\r\n        // The solution is that Autocast should be split into two. We should process everything\r\n        // before incomes, until we find a case where we have not enough Mana. Then we should\r\n        // break and continue processing the rest of Permacast *after* the incomes. If we find this\r\n        // situation, the Mana bar will probably not be full anyway so it's not a problem.\r\n        if (currentMana < manaCostToPay) {\r\n          state.temp.lastProcessedAutocastSpellId = spellId;\r\n          break;\r\n        }\r\n\r\n        if (spell.getManaCost(state) > maxMana) {\r\n          // Skip\r\n          continue;\r\n        }\r\n        if (!spell.isVisible(state)) {\r\n          // Also skip\r\n          continue;\r\n        }\r\n\r\n        const wizardPowerToAssign = Math.min(\r\n          availableWizardPower,\r\n          permaCastSpellRequiredWizardPower[spellId] * timeElapsedSec,\r\n        );\r\n\r\n        // If we do not have enough wizards, do not drain Mana\r\n        if (availableWizardPower > 0) {\r\n          state = grantAutocastPointsToRule(\r\n            state,\r\n            rule,\r\n            wizardPowerToAssign,\r\n            spell,\r\n          );\r\n          state = grantResource(Resource.Mana, -manaCostToPay)(state);\r\n        }\r\n        availableWizardPower -= wizardPowerToAssign;\r\n\r\n        const pointsRequired = spell.getAutocastPointsRequirement(state);\r\n        if (ruleStatus.currentPoints < pointsRequired) {\r\n          continue;\r\n        }\r\n        if (!spell.isEnabled(state, true)) {\r\n          continue;\r\n        }\r\n\r\n        const conditions =\r\n          rule.conditions.length > 0 ? rule.conditions : DEFAULT_CONDITIONS;\r\n        if (\r\n          conditions.every((condition) =>\r\n            conditionIsMet(state, rule, condition),\r\n          )\r\n        ) {\r\n          state = spell.doActionPermaCast(state);\r\n          state = grantAutocastPointsToRule(\r\n            state,\r\n            rule,\r\n            -pointsRequired,\r\n            spell,\r\n          );\r\n        }\r\n      }\r\n      state.temp.isInPermacast = false;\r\n\r\n      state.temp.isInAutocast = false;\r\n\r\n      return state;\r\n    },\r\n    -10,\r\n  );\r\n\r\n  registerTimeTickListener(\r\n    \"autocastPart2\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      if (!isAutocastUnlocked(state)) {\r\n        return state;\r\n      }\r\n\r\n      if (state.temp.lastProcessedAutocastSpellId == null) {\r\n        return state;\r\n      }\r\n\r\n      state.temp.isInAutocast = true;\r\n\r\n      const strategy = getCurrentAutocastStrategy(state);\r\n      const income = getAutocastPointIncomePerSecPerWizard(state);\r\n\r\n      // Handle permacast\r\n      // First, calculate total required wizard power\r\n      const {\r\n        permaCastSpellRequiredWizardPower,\r\n        permaCastSpellRequiredMana,\r\n        sortedPermaCastSpells,\r\n      } = calculatePermacastInfo(state, strategy);\r\n\r\n      let availableWizardPower =\r\n        strategy.wizardsAssignedToPermaCast * timeElapsedSec * income;\r\n      const maxMana = getResourceCap(state, Resource.Mana);\r\n\r\n      let foundTheSpell = false;\r\n      state.temp.isInPermacast = true;\r\n      for (let spell of sortedPermaCastSpells) {\r\n        // Continue until we find the spell\r\n        const spellId = spell.getId();\r\n        const wizardPowerToAssign = Math.min(\r\n          availableWizardPower,\r\n          permaCastSpellRequiredWizardPower[spellId] * timeElapsedSec,\r\n        );\r\n        if (\r\n          !foundTheSpell &&\r\n          spellId != state.temp.lastProcessedAutocastSpellId\r\n        ) {\r\n          availableWizardPower -= wizardPowerToAssign;\r\n          continue;\r\n        } else {\r\n          foundTheSpell = true;\r\n        }\r\n\r\n        const rule = strategy.permaCastRules[spellId];\r\n        const ruleStatus = getAutocastStatusByRule(state, rule);\r\n\r\n        if (ruleStatus.disabled) {\r\n          continue;\r\n        }\r\n\r\n        const currentMana = getResourceAmount(state, Resource.Mana);\r\n        const manaCostToPay =\r\n          permaCastSpellRequiredMana[spellId] * timeElapsedSec;\r\n        if (currentMana < manaCostToPay) {\r\n          // Now we are safe to skip here\r\n          continue;\r\n        }\r\n\r\n        if (spell.getManaCost(state) > maxMana) {\r\n          // Skip\r\n          continue;\r\n        }\r\n        if (!spell.isVisible(state)) {\r\n          // Also skip\r\n          continue;\r\n        }\r\n\r\n        // If we do not have enough wizards, do not drain Mana\r\n        if (availableWizardPower > 0) {\r\n          state = grantAutocastPointsToRule(\r\n            state,\r\n            rule,\r\n            wizardPowerToAssign,\r\n            spell,\r\n          );\r\n          state = grantResource(Resource.Mana, -manaCostToPay)(state);\r\n        }\r\n        availableWizardPower -= wizardPowerToAssign;\r\n\r\n        const pointsRequired = spell.getAutocastPointsRequirement(state);\r\n        if (ruleStatus.currentPoints < pointsRequired) {\r\n          continue;\r\n        }\r\n        if (!spell.isEnabled(state, true)) {\r\n          continue;\r\n        }\r\n\r\n        const conditions =\r\n          rule.conditions.length > 0 ? rule.conditions : DEFAULT_CONDITIONS;\r\n        if (\r\n          conditions.every((condition) =>\r\n            conditionIsMet(state, rule, condition),\r\n          )\r\n        ) {\r\n          state = spell.doActionPermaCast(state);\r\n          state = grantAutocastPointsToRule(\r\n            state,\r\n            rule,\r\n            -pointsRequired,\r\n            spell,\r\n          );\r\n        }\r\n      }\r\n\r\n      state.temp.isInPermacast = false;\r\n      state.temp.isInAutocast = false;\r\n      state.temp.lastProcessedAutocastSpellId = undefined;\r\n\r\n      return state;\r\n    },\r\n    20,\r\n  );\r\n\r\n  registerPostRetirementListener(\"permaCastRetirement\", (state, isMock) => {\r\n    // After retirement, we will have no wizards for any Perma-Cast.\r\n    // So unassign all of them, and clear all spells from Perma-Cast.\r\n    // Avid players will make a strategy anyway and load it.\r\n    const strategy = getCurrentAutocastStrategy(state);\r\n    strategy.permaCastRules = {};\r\n    strategy.wizardsAssignedToPermaCast = 0;\r\n    return state;\r\n  });\r\n\r\n  addGameStateListener(\"wizardRemover\", (state) => {\r\n    const freeWizards = getFreeWizards(state);\r\n    if (freeWizards < 0) {\r\n      return (state) => {\r\n        let freeWizards = getFreeWizards(state);\r\n        const rules = getCurrentAutocastStrategy(state).rules;\r\n        const ruleLength = rules.length;\r\n        let currentRuleIdx = ruleLength - 1;\r\n        while (freeWizards < 0 && currentRuleIdx >= 0) {\r\n          const assignedWizards = getAssignedWizardsByRuleIndex(\r\n            state,\r\n            currentRuleIdx,\r\n          );\r\n          if (assignedWizards > 0) {\r\n            state = assignWizardsToRuleIndex(state, currentRuleIdx, -1);\r\n            freeWizards++;\r\n          } else {\r\n            currentRuleIdx--;\r\n          }\r\n        }\r\n        if (freeWizards < 0) {\r\n          state = assignWizardsToPermaCast(state, freeWizards);\r\n        }\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n\r\n  registerSpellCacheClearedListener(clearPermacastCache);\r\n}\r\n","import { AutocastConditions } from \"../AutocastCondition\";\r\nimport AlwaysAutocastCondition from \"./AlwaysAutocastCondition\";\r\nimport ResourceLessThanAutocastCondition from \"./ResourceLessThanAutocastCondition\";\r\nimport ResourceLessThanAutocastConditionRatio from \"./ResourceLessThanAutocastConditionRatio\";\r\nimport ResourceMoreThanAutocastCondition from \"./ResourceMoreThanAutocastCondition\";\r\nimport ResourceMoreThanAutocastConditionRatio from \"./ResourceMoreThanAutocastConditionRatio\";\r\nimport SmartlyAutocastCondition from \"./SmartlyAutocastCondition\";\r\nimport TemporaryEffectLowTimeRemainingAutocastCondition from \"./TemporaryEffectLowTimeRemainingAutocastCondition\";\r\nimport TemporaryEffectPresentAutocastCondition from \"./TemporaryEffectPresentAutocastCondition\";\r\n\r\nexport function loadAutocastConditions() {\r\n  AutocastConditions.register(AlwaysAutocastCondition);\r\n  AutocastConditions.register(SmartlyAutocastCondition);\r\n  AutocastConditions.register(ResourceLessThanAutocastCondition);\r\n  AutocastConditions.register(ResourceLessThanAutocastConditionRatio);\r\n  AutocastConditions.register(ResourceMoreThanAutocastCondition);\r\n  AutocastConditions.register(ResourceMoreThanAutocastConditionRatio);\r\n  AutocastConditions.register(TemporaryEffectPresentAutocastCondition);\r\n  AutocastConditions.register(TemporaryEffectLowTimeRemainingAutocastCondition);\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { ActionArea, ActionSubcategory } from \"../action/ActionAreas\";\r\nimport {\r\n  getVisibleActionsForAreaBySubcategory,\r\n  registerAction,\r\n} from \"../action/Actions\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { Enhancement } from \"./Enhancement\";\r\n\r\nconst Enhancements = new DataStore<Enhancement>();\r\n\r\nexport function registerEnhancement(enhancement: Enhancement) {\r\n  Enhancements.register(enhancement);\r\n  registerAction(enhancement);\r\n}\r\n\r\nexport { Enhancements };\r\n\r\nexport function isEnhancementUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.EnhancementsUnlocked);\r\n}\r\n\r\nexport function isEnhancementEverUnlocked(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.EnhancementsUnlocked);\r\n}\r\n\r\nexport function shouldAutoPurchaseEnhancements(state: GameState): boolean {\r\n  return (\r\n    hasFlag(state, Flag.AutoPurchaseUnlocked) &&\r\n    state.options.autoPurchaseEnhancements\r\n  );\r\n}\r\n\r\nexport function getAllPurchasedEnhancements(\r\n  state: GameState,\r\n): Partial<Record<ActionSubcategory, Enhancement[]>> {\r\n  const purchasedEnhancements = Enhancements.getAll().filter((enhancement) =>\r\n    enhancement.isPurchased(state),\r\n  );\r\n  const sortedEnhancements = {};\r\n  for (let enhancement of purchasedEnhancements) {\r\n    const subareas = enhancement.getAreas().ENHANCEMENT ?? [];\r\n    for (let subarea of subareas) {\r\n      if (sortedEnhancements[subarea] == null) {\r\n        sortedEnhancements[subarea] = [];\r\n      }\r\n      sortedEnhancements[subarea].push(enhancement);\r\n    }\r\n  }\r\n  return sortedEnhancements;\r\n}\r\n\r\nexport function loadEnhancementCommonLogic() {\r\n  registerTimeTickListener(\r\n    \"enhancementAutoPurchaseMax\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      if (!shouldAutoPurchaseEnhancements(state)) {\r\n        return state;\r\n      }\r\n      const secondsPlayed = getSecondsPlayed(state);\r\n      if (\r\n        Math.floor(state.temp.lastAutoPurchaseEnhancementRun / 2.0) !=\r\n        Math.floor(secondsPlayed / 2.0)\r\n      ) {\r\n        valuesOf(\r\n          getVisibleActionsForAreaBySubcategory(state, ActionArea.ENHANCEMENT),\r\n        )\r\n          .flat()\r\n          .forEach((action) => {\r\n            if (action.isEnabled(state)) {\r\n              state = action.doAction({ isAutomatic: true }, state);\r\n            }\r\n          });\r\n        state.temp.lastAutoPurchaseEnhancementRun = secondsPlayed;\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Spell } from \"./Spell\";\r\n\r\nexport type SpellCastListener = (state: GameState, spell: Spell) => GameState;\r\n\r\nconst SpellCastListeners = new DataStore<SpellCastListener>();\r\n\r\nexport { SpellCastListeners };\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { standardPlayerAttackEffect } from \"../exploration/Exploration\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  getTemporaryEffectEndTime,\r\n  hasTemporaryEffect,\r\n} from \"../temporaryeffects/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { Spell } from \"./Spell\";\r\n\r\nexport function getStandardRangeEffectText(\r\n  average: number,\r\n  variance: number,\r\n  explanation?: string,\r\n): string {\r\n  const min = average - variance,\r\n    max = average + variance;\r\n  if (variance == 0) {\r\n    if (!explanation) {\r\n      return formatNumber(min);\r\n    }\r\n    return t(\"^{{effect}}^<{{explanation}}>\", {\r\n      effect: formatNumber(min),\r\n      explanation,\r\n    });\r\n  }\r\n  if (!explanation) {\r\n    return t(\"{{min}}~{{max}}\", {\r\n      min: formatNumber(min),\r\n      max: formatNumber(max),\r\n    });\r\n  }\r\n  return t(\"^{{min}}~{{max}}^<{{explanation}}>\", {\r\n    min: formatNumber(min),\r\n    max: formatNumber(max),\r\n    explanation,\r\n  });\r\n}\r\n\r\nexport function getStandardAttackEffectText(\r\n  average: number,\r\n  variance: number,\r\n  explanation?: string,\r\n): string {\r\n  return t(\"{{effect}}:attack:\", {\r\n    effect: getStandardRangeEffectText(average, variance, explanation),\r\n  });\r\n}\r\n\r\nexport function getStandardSpellAttackEffect(\r\n  state: GameState,\r\n  spell: Spell,\r\n  extras?: object,\r\n): GameState {\r\n  const effects = spell.getActionEffects(state);\r\n  state = standardPlayerAttackEffect(\r\n    state,\r\n    effects.average + (Math.random() - 0.5) * effects.variance * 2,\r\n    {\r\n      cause: spell.getSpellName(),\r\n      tags: spell.getTags(),\r\n      ...(extras ?? {}),\r\n    },\r\n  );\r\n  return state;\r\n}\r\n\r\nexport function getStandardSpellAttackEffectText(\r\n  state: GameState,\r\n  spell: Spell,\r\n): string {\r\n  const effects = spell.getActionEffects(state);\r\n  const explanation = spell.getActionEffectExplanations(\r\n    state,\r\n    \"average\",\r\n  ).average;\r\n  return getStandardAttackEffectText(\r\n    effects.average,\r\n    effects.variance,\r\n    explanation,\r\n  );\r\n}\r\n\r\nexport function isCastingRecommendedTemporaryEffect(\r\n  state: GameState,\r\n  effectName: string,\r\n  target?: AttackTarget,\r\n): boolean {\r\n  if (hasTemporaryEffect(state, effectName, target)) {\r\n    return (\r\n      getTemporaryEffectEndTime(state, effectName, target) -\r\n        getSecondsPlayed(state) <\r\n      2.0\r\n    );\r\n  }\r\n  return true;\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { fromEntries, keysOf, valuesOf } from \"../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { cacheBooleanTrueOnly, cacheIndefinitely } from \"../Caching\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport { Action, DoActionArgs } from \"../action/Action\";\r\nimport { ActionArea, ActionSubcategory } from \"../action/ActionAreas\";\r\nimport {\r\n  AutocastRule,\r\n  SpellAutocastCategory,\r\n  isSpellInPermaCast,\r\n  isSpellInWizards,\r\n} from \"../autocast/Autocast\";\r\nimport SmartlyAutocastCondition from \"../autocast/conditions/SmartlyAutocastCondition\";\r\nimport { hasTemporaryEffect } from \"../temporaryeffects/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  applyTransformations,\r\n  applyTransformationsPermaCached,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport {\r\n  SpellElement,\r\n  getElementExpByUsage,\r\n  grantElementExp,\r\n  meetsRequirements,\r\n} from \"./Elements\";\r\nimport { SpellCastListeners } from \"./SpellCastListeners\";\r\nimport { addRecentSpellCast, setLastCastedTime } from \"./Spells\";\r\nimport { isCastingRecommendedTemporaryEffect } from \"./Utils\";\r\n\r\nexport abstract class Spell extends Action {\r\n  abstract getBaseManaCost(state: GameState): number;\r\n  abstract doSpellAction(state: GameState, args: DoActionArgs): GameState;\r\n  abstract getLevelRequirements(): Partial<Record<SpellElement, number>>;\r\n  abstract getElement(): SpellElement | undefined;\r\n\r\n  // Translated version of the spell name.\r\n  abstract getSpellName(): string;\r\n\r\n  abstract getAutocastCategory(): SpellAutocastCategory;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  _tagArray: string[] | null = null;\r\n\r\n  getTags(): string[] {\r\n    if (this._tagArray == null) {\r\n      const tags = [\r\n        ...super.getTags(),\r\n        TransformationTags.Spell,\r\n        ...Object.keys(this.getLevelRequirements()),\r\n        ...this.getExtraTags(),\r\n      ];\r\n      const element = this.getElement();\r\n      tags.push(element);\r\n      this._tagArray = tags;\r\n    }\r\n    return this._tagArray;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [];\r\n  }\r\n\r\n  _manaCostTags = memoize((parentSpell?: Spell) =>\r\n    [\r\n      ...this.getTags(),\r\n      TransformationTags.Cost,\r\n      Resource.Mana,\r\n      parentSpell?.getId?.(),\r\n    ].filter((tag) => tag != null),\r\n  );\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: this.getManaCost(state),\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getManaCost(state: GameState, parentSpell?: Spell) {\r\n    if (parentSpell != null) {\r\n      return this.getManaCostUncached(state, parentSpell);\r\n    }\r\n\r\n    let value = state.temp.spellManaCostCache[this.getId()];\r\n    if (value == null) {\r\n      value = this.getManaCostUncached(state, parentSpell);\r\n      state.temp.spellManaCostCache[this.getId()] = value;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  private getManaCostUncached(state: GameState, parentSpell?: Spell): number {\r\n    return applyTransformations(\r\n      this._manaCostTags(parentSpell),\r\n      state,\r\n      this.getBaseManaCost(state),\r\n      parentSpell == null\r\n        ? this._actionParams()\r\n        : { action: parentSpell ?? this },\r\n    );\r\n  }\r\n\r\n  // Override with false if you change getManaCost()\r\n  hasFixedManaCost(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return {\r\n      SPELL_MENU: [this.getElement()],\r\n    };\r\n  }\r\n\r\n  getLastCastTime(state: GameState): number {\r\n    return state.run.lastSpellCastTimes?.[this.getId()] || 0;\r\n  }\r\n\r\n  /**\r\n   * Display name without cooldown or perma-cast\r\n   */\r\n  getBasicDisplayName(state: GameState): string {\r\n    let mainName = this.getSpellName();\r\n    if (this.hasActiveSpellcrafts(state)) {\r\n      mainName = mainName + \"*\";\r\n    }\r\n    if (this.isEmpowered(state)) {\r\n      mainName = mainName + \"+\";\r\n    }\r\n    return mainName;\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    const lastCastTime = this.getLastCastTime(state);\r\n    const isInPermaCast = isSpellInPermaCast(state, this);\r\n    let mainName = this.getBasicDisplayName(state);\r\n\r\n    if (lastCastTime > 0) {\r\n      const cooldown = lastCastTime + this.getCooldown(state);\r\n      const secTillOver = cooldown - getSecondsPlayed(state);\r\n      if (secTillOver > 0) {\r\n        mainName = t(\"{{spellName}} ({{secTillOver}} sec)\", {\r\n          spellName: mainName,\r\n          secTillOver: formatNumber(secTillOver, {\r\n            showDecimals: true,\r\n          }),\r\n        });\r\n      }\r\n    }\r\n    if (isInPermaCast) {\r\n      return t(\"{{mainName}} (P)\", { mainName });\r\n    } else if (isSpellInWizards(state, this)) {\r\n      return t(\"{{mainName}} (A)\", { mainName });\r\n    }\r\n    return t(\"{{mainName}}\", { mainName });\r\n  }\r\n\r\n  hasActiveSpellcrafts(state: GameState): boolean {\r\n    return valuesOf(state.run.spellcrafts).some(\r\n      (data) => data.spellId == this.getId() && data.spellcraftId != null,\r\n    );\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 0.0;\r\n  }\r\n\r\n  _cooldownTagArray: string[] | null = null;\r\n  _actionParams = memoize(() => ({ action: this }));\r\n  getCooldown(state: GameState): number {\r\n    if (this._cooldownTagArray == null) {\r\n      this._cooldownTagArray = [\r\n        ...this.getTags(),\r\n        TransformationTags.SpellCooldown,\r\n      ];\r\n    }\r\n    if (this.getBaseCooldown() === 0.0) {\r\n      return 0.0;\r\n    }\r\n    return applyTransformationsPermaCached(\r\n      this._cooldownTagArray,\r\n      state,\r\n      this.getBaseCooldown(),\r\n      this._actionParams(),\r\n    );\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    const id = this.getId();\r\n    let value = state.temp.spellRequirementsCache[id];\r\n    if (value == null) {\r\n      const elementRequirements = this.getLevelRequirements();\r\n      value = meetsRequirements(state, elementRequirements);\r\n      state.temp.spellRequirementsCache[id] = value;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  isEnabled(state: GameState, skipAffordabilityChecks?: boolean): boolean {\r\n    if (!this.isVisible(state)) {\r\n      return false;\r\n    }\r\n\r\n    const lastCastTime = this.getLastCastTime(state);\r\n    if (\r\n      lastCastTime > 0 &&\r\n      getSecondsPlayed(state) < lastCastTime + this.getCooldown(state)\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      hasTemporaryEffect(state, \"silence\") ||\r\n      hasTemporaryEffect(state, \"stun\")\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    const transformationResult = applyTransformationsPermaCached(\r\n      this.canCastSpellTags(),\r\n      state,\r\n      1.0,\r\n    );\r\n    if (transformationResult <= 0) {\r\n      return false;\r\n    }\r\n\r\n    return super.isEnabled(state, skipAffordabilityChecks);\r\n  }\r\n\r\n  isPermaCastAllowed(): boolean {\r\n    return (\r\n      this.getBaseCooldown() > 0 ||\r\n      (this.getCachedBaseActionEffects()?.duration?.value ?? 0) > 0\r\n    );\r\n  }\r\n\r\n  getPermaCastDelaySec(state: GameState): number {\r\n    return this.getEstimatedMinAutocastDelay(state);\r\n  }\r\n\r\n  getPermaCastManaCostPerSec(state: GameState): number {\r\n    return this.getManaCost(state) / this.getPermaCastDelaySec(state);\r\n  }\r\n\r\n  getPermaCastAutocastPointsConsumptionPerSec(state: GameState): number {\r\n    return (\r\n      this.getAutocastPointsRequirement(state) /\r\n      this.getPermaCastDelaySec(state)\r\n    );\r\n  }\r\n\r\n  canCastSpellTags = memoize(() => [\r\n    ...this.getTags(),\r\n    TransformationTags.CanCastSpell,\r\n  ]);\r\n\r\n  autocastPointsRequirementTags = memoize(() => [\r\n    ...this.getTags(),\r\n    TransformationTags.AutocastPointsConsumption,\r\n  ]);\r\n\r\n  getAutocastPointsRequirement(state: GameState): number {\r\n    let value = state.temp.autocastPointsRequirementCache[this.getId()];\r\n    if (value == null) {\r\n      value = applyTransformations(\r\n        this.autocastPointsRequirementTags(),\r\n        state,\r\n        this.getBaseAutocastPointsRequirement(),\r\n        this._actionParams(),\r\n      );\r\n      state.temp.autocastPointsRequirementCache[this.getId()] = value;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 60;\r\n  }\r\n\r\n  getExpFromUsage(state: GameState): Partial<Record<SpellElement, number>> {\r\n    const id = this.getId();\r\n    let value = state.temp.spellExpCache[id];\r\n    if (value == null) {\r\n      const elementRequirements = this.getLevelRequirements();\r\n      value = fromEntries(\r\n        keysOf(elementRequirements).map((element) => {\r\n          return [\r\n            element,\r\n            getElementExpByUsage(\r\n              state,\r\n              element,\r\n              elementRequirements[element],\r\n              this.getCost(state).resources?.[Resource.Mana] ?? 0,\r\n              true,\r\n              this.getTags(),\r\n            ),\r\n          ];\r\n        }),\r\n      );\r\n      state.temp.spellExpCache[id] = value;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  getMainExp(state: GameState): {\r\n    element: SpellElement | undefined;\r\n    expMin: number;\r\n    expMax: number;\r\n  } {\r\n    const exp = this.getExpFromUsage(state);\r\n    const element = this.getElement();\r\n    if (element != null) {\r\n      return {\r\n        element,\r\n        expMin: exp[element] ?? 0,\r\n        expMax: exp[element] ?? 0,\r\n      };\r\n    }\r\n\r\n    return {\r\n      element: undefined,\r\n      expMin: Math.min(...valuesOf(exp)),\r\n      expMax: Math.max(...valuesOf(exp)),\r\n    };\r\n  }\r\n\r\n  grantExpFromUsage(state: GameState): GameState {\r\n    const exp = this.getExpFromUsage(state);\r\n    const expElements = keysOf(exp);\r\n\r\n    expElements.forEach((element) => {\r\n      state = grantElementExp(element, exp[element])(state);\r\n    });\r\n    return state;\r\n  }\r\n\r\n  doActionPermaCast(state: GameState): GameState {\r\n    state = this.doSpellAction(state, { isAutomatic: true });\r\n    state = this.grantExpFromUsage(state);\r\n    state = setLastCastedTime(this, state);\r\n    for (let listener of SpellCastListeners.getAll()) {\r\n      state = listener(state, this);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    state = this.doSpellAction(state, args);\r\n\r\n    state = this.payCost(state);\r\n\r\n    state = this.grantExpFromUsage(state);\r\n\r\n    if (!args.isAutomatic) {\r\n      state = addRecentSpellCast(this, state);\r\n    }\r\n\r\n    state = setLastCastedTime(this, state);\r\n\r\n    for (let listener of SpellCastListeners.getAll()) {\r\n      state = listener(state, this);\r\n    }\r\n\r\n    return state;\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    if (!isCastingRecommendedTemporaryEffect(state, this.getId())) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule?: AutocastRule): number {\r\n    if (\r\n      rule != null &&\r\n      rule.conditions.length > 0 &&\r\n      rule.conditions.every(\r\n        (condition) => condition.condition != SmartlyAutocastCondition.getId(),\r\n      )\r\n    ) {\r\n      // We cannot predict\r\n      return Math.max(0, this.getCooldown(state));\r\n    }\r\n\r\n    let duration = 0;\r\n    const baseEffects = this.getCachedBaseActionEffects();\r\n    if (baseEffects?.duration) {\r\n      duration = cacheIndefinitely(\r\n        state,\r\n        (_state) => \"minAutocastDelayDuration\" + this.getId(),\r\n        (state) => this.getActionEffect(state, \"duration\"),\r\n      );\r\n    }\r\n    return Math.max(\r\n      0,\r\n      duration > 0 ? Math.max(1, Math.floor(duration - 2)) : 0,\r\n      this.getCooldown(state),\r\n    );\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  isEmpoweringPossible(state: GameState): boolean {\r\n    if (!this.isEmpowerable()) {\r\n      return false;\r\n    }\r\n\r\n    return cacheBooleanTrueOnly(\r\n      state,\r\n      \"spellEmpoweringEnabled.\" + this.getId(),\r\n      (s) => {\r\n        const elementRequirements = this.getEmpoweringLevelRequirements();\r\n        const isVisible = meetsRequirements(s, elementRequirements);\r\n        return isVisible;\r\n      },\r\n    );\r\n  }\r\n\r\n  isEmpowered(state: GameState): boolean {\r\n    return state.run.empoweredSpells[this.getId()] ?? false;\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return true;\r\n  }\r\n\r\n  // // Is this spell dependent on the effects of others?\r\n  // // If yes, override and put the spells here.\r\n  // // Spellcraft uses this to delegate its effects.\r\n  // getDependentSpells(): Spell[] {\r\n  //   return [];\r\n  // }\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { fromEntries, keysOf } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { cacheByTickCount } from \"../../Caching\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { GameState, createHypotheticalState } from \"../../GameState\";\r\nimport { Resource, getResourceAmount } from \"../../Resources\";\r\nimport { DoActionArgs } from \"../../action/Action\";\r\nimport { ActionArea, ActionSubcategory } from \"../../action/ActionAreas\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport {\r\n  SpellElement,\r\n  getElementExpByUsage,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedElements,\r\n  grantElementExp,\r\n} from \"../../spells/Elements\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport { Spells, registerSpell } from \"../../spells/Spells\";\r\nimport { applyTransformations } from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { addToInventory, getTotalAmountOfItem } from \"../Inventory\";\r\nimport { Item, ItemParams } from \"../Item\";\r\nimport { Items, isCraftingUnlocked } from \"../Items\";\r\n\r\nexport abstract class TransmutationSpell extends Spell {\r\n  abstract getItem(): Item;\r\n\r\n  getId(): string {\r\n    return \"transmute-\" + this.getItem().getId();\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.TRANSMUTATION;\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    // Must populate by subclasses\r\n    return { TRANSMUTE: this.getItem().getTags() };\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.TransmutationSpell];\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Transmute {{itemName}}\", {\r\n      itemName: this.getItem().getBaseName(this.getItem().getDefaultParams()),\r\n    });\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    return t(\"Transmute {{itemName}}\", {\r\n      itemName: this.getItem().getBaseName(this.getItem().getDefaultParams()),\r\n    });\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return this.getCraftingMaterials(state);\r\n  }\r\n\r\n  generateCraftedParams(state: GameState): ItemParams {\r\n    const itemQuality = applyTransformations(this.tagsForQuality(), state, 0, {\r\n      spell: this,\r\n    });\r\n    if (itemQuality == 0) {\r\n      return {};\r\n    }\r\n    return { itemQuality };\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return this.getCraftingElementLevelRequirements();\r\n  }\r\n\r\n  abstract getCraftingElementLevelRequirements(): Partial<\r\n    Record<SpellElement, number>\r\n  >;\r\n\r\n  // If crafting is NOT simplified, craft N times\r\n  // If crafting is simplified, craft once and then multiply that result by N times\r\n  // Because of item quality, simplified quality only really works for materials\r\n  simplifyCrafting(): boolean {\r\n    return true;\r\n  }\r\n\r\n  abstract getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  };\r\n\r\n  tagsForResource = memoize((resource) => [\r\n    ...this.getItem().getTags(),\r\n    ...Object.keys(this.getCraftingElementLevelRequirements()),\r\n    resource,\r\n    this.getId(),\r\n    TransformationTags.ItemCost,\r\n  ]);\r\n\r\n  tagsForItem = memoize((item) => [\r\n    ...this.getItem().getTags(),\r\n    ...Object.keys(this.getCraftingElementLevelRequirements()),\r\n    item,\r\n    this.getId(),\r\n    TransformationTags.ItemCostItem,\r\n  ]);\r\n\r\n  tagsForQuality = memoize(() => [\r\n    this.getId(),\r\n    TransformationTags.ItemQuality,\r\n    ...this.getItem().getTags(),\r\n    ...Object.keys(this.getCraftingElementLevelRequirements()),\r\n  ]);\r\n\r\n  tagsForCreation = memoize(() => [\r\n    this.getId(),\r\n    TransformationTags.ItemAmountTransmuted,\r\n    ...this.getItem().getTags(),\r\n    ...Object.keys(this.getCraftingElementLevelRequirements()),\r\n  ]);\r\n\r\n  getCraftingMaterials(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    const base = this.getCraftingMaterialsBase(state);\r\n    let resources: Partial<Record<Resource, number>> = {},\r\n      items: Record<string, number> = {};\r\n    for (let resource in base.resources) {\r\n      const baseAmount = base.resources[resource as Resource] ?? 0;\r\n      resources[resource as Resource] = Math.ceil(\r\n        applyTransformations(this.tagsForResource(resource), state, baseAmount),\r\n      );\r\n    }\r\n    for (let item in base.items) {\r\n      const baseAmount = base.items[item] ?? 0;\r\n      items[item] = Math.ceil(\r\n        applyTransformations(this.tagsForItem(item), state, baseAmount),\r\n      );\r\n    }\r\n    return {\r\n      resources,\r\n      items,\r\n    };\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return (\r\n      this.getItem().getDescription(state, this.generateCraftedParams(state)) ??\r\n      \"\"\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return (\r\n      this.getItem().getEffect(state, this.generateCraftedParams(state)) ?? \"\"\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    throw new Error(\"Not used in transmutation spells\");\r\n  }\r\n\r\n  canAfford(state: GameState): boolean {\r\n    return super.canAfford(state);\r\n  }\r\n\r\n  hasCraftingMaterials(state: GameState): boolean {\r\n    const materials = this.getCraftingMaterials(state);\r\n    for (let resource in materials.resources) {\r\n      const amount = materials.resources?.[resource as Resource] || 0;\r\n      if (getResourceAmount(state, resource as Resource) < amount) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let itemId in materials.items) {\r\n      const amount = materials.items[itemId];\r\n      if (getTotalAmountOfItem(Items.getById(itemId), state) < amount) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  canCraft(state: GameState): boolean {\r\n    if (!this.isEnabled(state)) {\r\n      return false;\r\n    }\r\n\r\n    if (!this.hasCraftingMaterials(state)) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    // Unused\r\n    return 0;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return isTransmutationUnlocked(state) && super.isVisible(state);\r\n  }\r\n\r\n  getExpFromUsage(state: GameState): Partial<Record<SpellElement, number>> {\r\n    const elementRequirements = this.getCraftingElementLevelRequirements();\r\n    const params = this.generateCraftedParams(state);\r\n\r\n    return fromEntries(\r\n      keysOf(elementRequirements).map((element) => {\r\n        return [\r\n          element,\r\n          getElementExpByUsage(\r\n            state,\r\n            element,\r\n            elementRequirements[element],\r\n            this.getItem().getBaseSalePrice(state, params),\r\n            true,\r\n            this.getTags(),\r\n          ),\r\n        ];\r\n      }),\r\n    );\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    return this.craftN(state, args, 1);\r\n  }\r\n\r\n  calculateAmountPerCraft(state: GameState, args: DoActionArgs): number {\r\n    return applyTransformations(this.tagsForCreation(), state, 1, {\r\n      spell: this,\r\n      automated: args.isAutomatic,\r\n    });\r\n  }\r\n\r\n  craftN(state: GameState, args: DoActionArgs, n: number): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    if (!this.canCraft(state)) {\r\n      return state;\r\n    }\r\n\r\n    let amountToCraft = this.calculateAmountPerCraft(state, args);\r\n\r\n    amountToCraft *= n;\r\n\r\n    if (this.simplifyCrafting()) {\r\n      const params = this.generateCraftedParams(state);\r\n\r\n      state = addToInventory(\r\n        { itemId: this.getItem().getId(), params },\r\n        amountToCraft,\r\n        state,\r\n      );\r\n    } else {\r\n      while (amountToCraft >= 1) {\r\n        const params = this.generateCraftedParams(state);\r\n\r\n        state = addToInventory(\r\n          { itemId: this.getItem().getId(), params },\r\n          1,\r\n          state,\r\n        );\r\n        amountToCraft -= 1;\r\n      }\r\n    }\r\n\r\n    state = this.payCost(state, n);\r\n\r\n    const expGranted = this.getExpFromUsage(state);\r\n\r\n    keysOf(expGranted).forEach((element) => {\r\n      state = grantElementExp(element, expGranted[element] * n)(state);\r\n    });\r\n\r\n    return state;\r\n  }\r\n\r\n  craftMax(state: GameState): GameState {\r\n    const timesCraftable = this.timesCraftable(state);\r\n    return this.craftN(state, { isAutomatic: false }, timesCraftable);\r\n  }\r\n\r\n  craftIntermediate(state: GameState): GameState {\r\n    // First of all, check the materials\r\n    const cost = this.getCost(state).items;\r\n    for (let itemId in cost) {\r\n      const item = Items.getById(itemId);\r\n      const amountNeeded = cost[itemId];\r\n      const amountInInventory = getTotalAmountOfItem(item, state);\r\n      if (amountInInventory >= amountNeeded) {\r\n        continue;\r\n      }\r\n      const spell = getTransmutationSpellForItem(item);\r\n      if (spell == null) {\r\n        continue;\r\n      }\r\n      if (!spell.isEnabled(state)) {\r\n        continue;\r\n      }\r\n      // There is a spell that we can use, and we need the item\r\n      const amountRequired = amountNeeded - amountInInventory;\r\n      const amountPerCraft = spell.calculateAmountPerCraft(state, {\r\n        isAutomatic: false,\r\n      });\r\n      const timesCraftable = spell.timesCraftable(state);\r\n      const timesToCraft = Math.min(\r\n        Math.ceil(amountRequired / amountPerCraft),\r\n        timesCraftable,\r\n      );\r\n      state = spell.craftN(state, { isAutomatic: false }, timesToCraft);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  // Are there any materials that are intermediate materials and transmutable,\r\n  // and at least the materials for crafting 1 of them are held in hand?\r\n  isCraftIntermediatePossible(state: GameState): boolean {\r\n    const cost = this.getCost(state).items;\r\n    for (let itemId in cost) {\r\n      const item = Items.getById(itemId);\r\n      const amountNeeded = cost[itemId];\r\n      const amountInInventory = getTotalAmountOfItem(item, state);\r\n      if (amountInInventory >= amountNeeded) {\r\n        continue;\r\n      }\r\n      const spell = getTransmutationSpellForItem(item);\r\n      if (spell == null || !spell.isVisible(state)) {\r\n        continue;\r\n      }\r\n      if (!spell.isEnabled(state)) {\r\n        continue;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // Are there any materials that are intermediate materials and transmutable,\r\n  // even if the materials for them are not in hand?\r\n  isCraftIntermediatePotentiallyPossible(state: GameState): boolean {\r\n    const cost = this.getCost(state).items;\r\n    for (let itemId in cost) {\r\n      const item = Items.getById(itemId);\r\n      const spell = getTransmutationSpellForItem(item);\r\n      if (spell == null || !spell.isVisible(state)) {\r\n        continue;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  timesCraftable(state: GameState): number {\r\n    const cost = this.getCost(state);\r\n    const resourceThresholds = (\r\n      Object.keys(cost.resources) as Array<Resource>\r\n    ).map((resourceName) => {\r\n      const amount = getResourceAmount(state, resourceName);\r\n      return Math.floor(amount / cost.resources[resourceName]);\r\n    });\r\n    const itemThresholds = (Object.keys(cost.items) as Array<string>).map(\r\n      (itemId) => {\r\n        const amount = getTotalAmountOfItem(Items.getById(itemId), state);\r\n        return Math.floor(amount / cost.items[itemId]);\r\n      },\r\n    );\r\n\r\n    return Math.min(\r\n      Math.min(...resourceThresholds),\r\n      Math.min(...itemThresholds),\r\n    );\r\n  }\r\n}\r\n\r\nexport function isTransmutationUnlocked(state: GameState) {\r\n  return hasFlag(state, Flag.TransmutationUnlocked);\r\n}\r\n\r\nconst transmutationSpellsByItem: Record<string, TransmutationSpell> = {};\r\n\r\nexport function registerTransmutationSpellAndItem(spell: TransmutationSpell) {\r\n  Items.register(spell.getItem());\r\n  registerSpell(spell);\r\n  transmutationSpellsByItem[spell.getItem().getId()] = spell;\r\n}\r\n\r\nexport function getTransmutationSpellForItem(\r\n  item: Item,\r\n): TransmutationSpell | undefined {\r\n  return transmutationSpellsByItem[item.getId()];\r\n}\r\n\r\nexport function getVisibleTransmutationSpells(\r\n  state: GameState,\r\n): TransmutationSpell[] {\r\n  if (!isCraftingUnlocked(state)) {\r\n    return [];\r\n  }\r\n\r\n  return Spells.getAll().filter(\r\n    (spell) => spell instanceof TransmutationSpell && spell.isVisible(state),\r\n  ) as TransmutationSpell[];\r\n}\r\n\r\nexport function getAllTransmutationSpellsEverCastable(\r\n  state: GameState,\r\n): TransmutationSpell[] {\r\n  return cacheByTickCount(\r\n    state,\r\n    \"allTransmutationSpellsEverCastable\",\r\n    (state) => {\r\n      let hypotheticalState = createHypotheticalState(state);\r\n      getUnlockedElements(hypotheticalState).forEach((element) => {\r\n        hypotheticalState.run.elementExperience[element] =\r\n          getTotalExpRequiredForLevel(\r\n            hypotheticalState,\r\n            state.world.maxElementLevels?.[element] ?? 1,\r\n            element,\r\n          );\r\n      });\r\n      hypotheticalState = setFlag(Flag.TransmutationUnlocked)(\r\n        hypotheticalState,\r\n      );\r\n      return getVisibleTransmutationSpells(hypotheticalState);\r\n    },\r\n  );\r\n}\r\n","import { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { TransformationType } from \"../transformation/Transformation\";\r\nimport {\r\n  getTemporaryEffectEndTime,\r\n  TemporaryEffectData,\r\n} from \"./TemporaryEffects\";\r\n\r\nexport abstract class TemporaryEffect implements Identifiable {\r\n  abstract getId(): string;\r\n\r\n  abstract getDisplayName(): string;\r\n\r\n  abstract getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string;\r\n\r\n  getParameterlessDisplayDescription(state: GameState): string {\r\n    return this.getDisplayDescription(state, {\r\n      id: \"null\",\r\n      fromPouch: false,\r\n      fromPermacast: false,\r\n      fromAutocast: false,\r\n      endTime: getSecondsPlayed(state),\r\n      setTime: getSecondsPlayed(state),\r\n      params: {},\r\n      registeredClear: false,\r\n      target: AttackTarget.Player,\r\n    });\r\n  }\r\n\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [];\r\n  }\r\n\r\n  getIcon() {\r\n    if (this.isBeneficial()) {\r\n      return require(\"./buff.png\");\r\n    } else {\r\n      return require(\"./debuff.png\");\r\n    }\r\n  }\r\n\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n\r\n  isCombatOnly(): boolean {\r\n    return false;\r\n  }\r\n\r\n  isDispellable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  isHidden(): boolean {\r\n    return false;\r\n  }\r\n\r\n  // When a temporary effect is applied with the same ID, the data must be merged\r\n  mergeData(\r\n    state: GameState,\r\n    oldData: TemporaryEffectData,\r\n    newData: TemporaryEffectData,\r\n    mode: \"add\" | \"replace\",\r\n  ): TemporaryEffectData {\r\n    if (mode == \"add\") {\r\n      const currentEndTime = getTemporaryEffectEndTime(\r\n        state,\r\n        this.getId(),\r\n        oldData.target,\r\n      );\r\n      const extraDuration = Math.max(\r\n        0,\r\n        currentEndTime - getSecondsPlayed(state),\r\n      );\r\n      newData.endTime += extraDuration;\r\n    }\r\n    return newData;\r\n  }\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { clearCombatStatCache, CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { TemporaryEffect } from \"../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\n\r\nclass RitualWeakness extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"ritualWeakness\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Ritual Weakness\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"Your body is temporarily weak from starting a Ritual! -50%:attack:, :defense:, :dodge: and :critChance:\",\r\n    );\r\n  }\r\n  getIcon() {\r\n    return require(\"./ritualWeakness.png\");\r\n  }\r\n\r\n  isDispellable(): boolean {\r\n    return false;\r\n  }\r\n  isCombatOnly(): boolean {\r\n    return false;\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const ritualWeakness = new RitualWeakness();\r\n\r\nexport function loadRitualWeakness() {\r\n  TemporaryEffects.register(ritualWeakness);\r\n\r\n  registerTransformation(\r\n    [\r\n      CombatStat.Attack,\r\n      CombatStat.Defense,\r\n      CombatStat.Dodge,\r\n      CombatStat.Crit,\r\n    ].map((stat) => [AttackTarget.Player, stat]),\r\n    ritualWeakness.getId(),\r\n    ritualWeakness.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(state, ritualWeakness.getId(), AttackTarget.Player)\r\n        ? 0.5\r\n        : 1.0,\r\n  );\r\n  registerTemporaryEffectListener(ritualWeakness.getId(), (state, effect) => {\r\n    if (effect.id == ritualWeakness.getId()) {\r\n      state = clearCombatStatCache(\r\n        state,\r\n        AttackTarget.Player,\r\n        CombatStat.Attack,\r\n      );\r\n      state = clearCombatStatCache(\r\n        state,\r\n        AttackTarget.Player,\r\n        CombatStat.Defense,\r\n      );\r\n      state = clearCombatStatCache(\r\n        state,\r\n        AttackTarget.Player,\r\n        CombatStat.Dodge,\r\n      );\r\n      state = clearCombatStatCache(state, AttackTarget.Player, CombatStat.Crit);\r\n    }\r\n    return effect;\r\n  });\r\n}\r\n","import { keysOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { getUnlockedElements, SpellElement } from \"../spells/Elements\";\r\nimport {\r\n  applyTransformationsCached,\r\n  applyTransformationsPermaCached,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { Ritual } from \"./Ritual\";\r\nimport { loadRitualWeakness } from \"./RitualWeakness\";\r\n\r\nexport const Rituals = new DataStore<Ritual>();\r\n\r\nexport function getActiveRituals(state: GameState): Ritual[] {\r\n  return keysOf(state.run.activeRituals)\r\n    .filter((ritualId) => state.run.activeRituals[ritualId])\r\n    .map((id) => Rituals.getById(id));\r\n}\r\n\r\nconst CORRUPTION_CAP_TAGS = [TransformationTags.CorruptionCap];\r\nexport function getCorruptionCap(state: GameState): number {\r\n  return applyTransformationsCached(CORRUPTION_CAP_TAGS, state, 1);\r\n}\r\n\r\nconst CORRUPTION_TAGS = [\r\n  TransformationTags.Corruption,\r\n  TransformationTags.Accumulation,\r\n];\r\nexport function getCorruption(state: GameState): number {\r\n  return applyTransformationsPermaCached(CORRUPTION_TAGS, state, 0);\r\n}\r\n\r\nconst CORRUPTION_HP_PENALTY_BASE = 0.9;\r\nconst CORRUPTION_HP_PENALTY_PER_CORRUPTION = 1.0;\r\nconst CORRUPTION_HP_PENALTY_OVER_CAP = 0.00001;\r\nexport function isCorruptionHPPenaltyActive(state: GameState) {\r\n  return (\r\n    getCorruption(state) >=\r\n    getCorruptionCap(state) + CORRUPTION_HP_PENALTY_OVER_CAP\r\n  );\r\n}\r\n\r\nexport function getCorruptionHPPenaltyMultiplier(state: GameState): number {\r\n  if (!isCorruptionHPPenaltyActive(state)) {\r\n    return 1.0;\r\n  }\r\n  return Math.pow(\r\n    CORRUPTION_HP_PENALTY_BASE,\r\n    Math.max(getCorruption(state) - getCorruptionCap(state), 0) /\r\n      CORRUPTION_HP_PENALTY_PER_CORRUPTION,\r\n  );\r\n}\r\n\r\nconst CORRUPTION_EXP_PENALTY_BASE = 0.7;\r\nconst CORRUPTION_EXP_PENALTY_PER_CORRUPTION = 3.0;\r\nconst CORRUPTION_EXP_PENALTY_OVER_CAP = 3.0;\r\nexport function isCorruptionExpPenaltyActive(state: GameState) {\r\n  return (\r\n    getCorruption(state) >=\r\n    getCorruptionCap(state) + CORRUPTION_EXP_PENALTY_OVER_CAP\r\n  );\r\n}\r\n\r\nexport function getCorruptionExpPenaltyMultiplier(state: GameState): number {\r\n  if (!isCorruptionExpPenaltyActive(state)) {\r\n    return 1.0;\r\n  }\r\n  return Math.pow(\r\n    CORRUPTION_EXP_PENALTY_BASE,\r\n    Math.max(getCorruption(state) - getCorruptionCap(state), 0) /\r\n      CORRUPTION_EXP_PENALTY_PER_CORRUPTION,\r\n  );\r\n}\r\n\r\nconst CORRUPTION_TRANSMUTE_PENALTY_BASE = 2.0;\r\nconst CORRUPTION_TRANSMUTE_PENALTY_PER_CORRUPTION = 5.0;\r\nconst CORRUPTION_TRANSMUTE_PENALTY_OVER_CAP = 5.0;\r\nexport function isCorruptionTransmutePenaltyActive(state: GameState) {\r\n  return (\r\n    getCorruption(state) >=\r\n    getCorruptionCap(state) + CORRUPTION_TRANSMUTE_PENALTY_OVER_CAP\r\n  );\r\n}\r\n\r\nexport function getCorruptionTransmutePenaltyMultiplier(\r\n  state: GameState,\r\n): number {\r\n  if (!isCorruptionTransmutePenaltyActive(state)) {\r\n    return 1.0;\r\n  }\r\n  return Math.pow(\r\n    CORRUPTION_TRANSMUTE_PENALTY_BASE,\r\n    Math.max(getCorruption(state) - getCorruptionCap(state), 0) /\r\n      CORRUPTION_TRANSMUTE_PENALTY_PER_CORRUPTION,\r\n  );\r\n}\r\n\r\nexport function areRitualsUnlocked(state: GameState): boolean {\r\n  return (\r\n    getUnlockedElements(state).includes(SpellElement.Death) &&\r\n    hasFlag(state, Flag.RitualsUnlocked)\r\n  );\r\n}\r\n\r\nexport function areRitualsEverUnlocked(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.RitualsUnlocked);\r\n}\r\n\r\nexport function getVisibleRituals(state: GameState): Ritual[] {\r\n  return hasFlag(state, Flag.RitualsUnlocked)\r\n    ? Rituals.getAll().filter((ritual) => ritual.isVisible(state))\r\n    : [];\r\n}\r\n\r\nexport function loadRitualCommonEffects() {\r\n  loadRitualWeakness();\r\n\r\n  // Corruption implementation\r\n  registerTransformation(\r\n    [[TransformationTags.Corruption, TransformationTags.Accumulation]],\r\n    \"ritualsCorruption\",\r\n    t(\"Active Rituals\"),\r\n    TransformationType.Addition,\r\n    (state) => {\r\n      const activeRituals = getActiveRituals(state);\r\n      return activeRituals\r\n        .map((ritual) => ritual.getCorruptionCost(state))\r\n        .reduce((prev, current) => prev + current, 0);\r\n    },\r\n  );\r\n\r\n  // Corruption negative effects\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.MaxHP]],\r\n    \"corruptionHP\",\r\n    t(\"Corruption\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getCorruptionHPPenaltyMultiplier(state),\r\n  );\r\n  registerTransformation(\r\n    [[TransformationTags.ExpGain]],\r\n    \"corruptionExp\",\r\n    t(\"Corruption\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getCorruptionExpPenaltyMultiplier(state),\r\n  );\r\n  registerTransformation(\r\n    [[TransformationTags.ItemCost], [TransformationTags.ItemCostItem]],\r\n    \"corruptionTransmute\",\r\n    t(\"Corruption\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getCorruptionTransmutePenaltyMultiplier(state),\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"./channeling/ChannelingResources\";\r\nimport {\r\n  getElementLevel,\r\n  getPrimaryElements,\r\n  isPartiallyUnlocked,\r\n  SpellElement,\r\n  translateElement,\r\n} from \"./Elements\";\r\nimport { Spell } from \"./Spell\";\r\n\r\nexport const PARTIALLY_UNLOCKED_STORAGE_MULTIPLIER = 0.25;\r\nexport const PARTIALLY_UNLOCKED_CHANNELING_MULTIPLIER = 1.0 / 3.0;\r\nexport const LEVELS_PER_RANK = 10.0;\r\nconst EXPONENTIAL_BONUS_PER_RANK = 1.33353;\r\n\r\nexport function getRankMultiplier(\r\n  baseLevel: number,\r\n  currentLevel: number,\r\n): number {\r\n  const rankDifference = getRankDifference(baseLevel, currentLevel);\r\n  if (rankDifference <= 0) {\r\n    return 1.0;\r\n  }\r\n  const powValue = Math.pow(EXPONENTIAL_BONUS_PER_RANK, rankDifference);\r\n  return powValue;\r\n}\r\n\r\nexport function getRankDifference(\r\n  baseLevel: number,\r\n  currentLevel: number,\r\n): number {\r\n  const rank = Math.floor(currentLevel / LEVELS_PER_RANK);\r\n  const spellRank = Math.floor(baseLevel / LEVELS_PER_RANK);\r\n  const rankDifference = rank - spellRank;\r\n  return rankDifference;\r\n}\r\n\r\nexport function loadElementMultipliers() {\r\n  for (let element of valuesOf(SpellElement)) {\r\n    registerTransformation(\r\n      [\r\n        [\r\n          TransformationTags.Spell,\r\n          TransformationTags.ActionEffect,\r\n          TransformationTags.ActionMagnitude,\r\n          element,\r\n        ],\r\n        [\r\n          TransformationTags.Spell,\r\n          TransformationTags.ActionEffect,\r\n          TransformationTags.TemporaryEffectMagnitude,\r\n          element,\r\n        ],\r\n        [\r\n          TransformationTags.Spell,\r\n          TransformationTags.ActionEffect,\r\n          TransformationTags.TemporaryEffectExtraCostDivisor,\r\n          element,\r\n        ],\r\n      ],\r\n      \"elementLevel\" + element,\r\n      t(\"{{element}} Rank\", { element: translateElement(element) }),\r\n      TransformationType.Multiplier,\r\n      (state, params) => {\r\n        const spell = params.action as Spell;\r\n        const baseLevel = spell.getLevelRequirements()[element];\r\n        if (baseLevel == null) {\r\n          return 1.0;\r\n        }\r\n        const currentLevel = getElementLevel(state, element);\r\n        return getRankMultiplier(baseLevel, currentLevel);\r\n      },\r\n    );\r\n\r\n    registerTransformation(\r\n      [\r\n        [\r\n          TransformationTags.Spell,\r\n          TransformationTags.ActionEffect,\r\n          TransformationTags.TemporaryEffectExtraCost,\r\n          element,\r\n        ],\r\n      ],\r\n      \"elementLevelCost\" + element,\r\n      t(\"{{element}} Rank\", { element: translateElement(element) }),\r\n      TransformationType.Multiplier,\r\n      (state, params) => {\r\n        const spell = params.action as Spell;\r\n        const baseLevel = spell.getLevelRequirements()[element];\r\n        if (baseLevel == null) {\r\n          return 1.0;\r\n        }\r\n        const currentLevel = getElementLevel(state, element);\r\n        const multiplier = getRankMultiplier(baseLevel, currentLevel);\r\n        return 1.0 / ((multiplier + 1.0) / 2);\r\n      },\r\n    );\r\n\r\n    registerTransformation(\r\n      [[element, TransformationTags.ExpGain]],\r\n      element + \"PrimaryElementMultiplier\",\r\n      t(\"Primary Element\"),\r\n      TransformationType.Multiplier,\r\n      (state) => (getPrimaryElements(state).includes(element) ? 2.0 : 1.0),\r\n    );\r\n\r\n    registerTransformation(\r\n      [[element, TransformationTags.ChannelingEfficiency]],\r\n      element + \"ChannelingMultiplier\",\r\n      t(\"{{element}} Element Rank\", { element: translateElement(element) }),\r\n      TransformationType.Multiplier,\r\n      (state) => {\r\n        const currentLevel = getElementLevel(state, element);\r\n        return getRankMultiplier(1, currentLevel);\r\n      },\r\n    );\r\n\r\n    registerTransformation(\r\n      [[RESOURCE_FOR_ELEMENT[element], TransformationTags.Cap]],\r\n      element + \"PartiallyUnlockedCapMultiplier\",\r\n      t(\"Partially Unlocked\"),\r\n      TransformationType.Multiplier,\r\n      (state) =>\r\n        isPartiallyUnlocked(state, element)\r\n          ? PARTIALLY_UNLOCKED_STORAGE_MULTIPLIER\r\n          : 1.0,\r\n    );\r\n\r\n    registerTransformation(\r\n      [\r\n        [element, TransformationTags.ChannelingEfficiency],\r\n        [element, TransformationTags.ExpGain],\r\n      ],\r\n      element + \"PartiallyUnlockedChannelingMultiplier\",\r\n      t(\"Partially Unlocked\"),\r\n      TransformationType.Multiplier,\r\n      (state) =>\r\n        isPartiallyUnlocked(state, element)\r\n          ? PARTIALLY_UNLOCKED_CHANNELING_MULTIPLIER\r\n          : 1.0,\r\n    );\r\n  }\r\n}\r\n","import { keysOf, valuesOf } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { ActionArea } from \"../../action/ActionAreas\";\r\nimport { createHypotheticalState, GameState } from \"../../GameState\";\r\nimport { addGameStateListener } from \"../../GameStateListeners\";\r\nimport { DataStore } from \"../../generic/DataStore\";\r\nimport {\r\n  getVisibleTransmutationSpells,\r\n  isTransmutationUnlocked,\r\n  TransmutationSpell,\r\n} from \"../../items/transmute/TransmutationSpell\";\r\nimport { Ritual } from \"../../rituals/Ritual\";\r\nimport { getVisibleRituals } from \"../../rituals/Rituals\";\r\nimport { LEVELS_PER_RANK } from \"../../spells/ElementMultipliers\";\r\nimport {\r\n  getElementExp,\r\n  getElementLevel,\r\n  getRankForLevel,\r\n  grantElementExp,\r\n  SpellElement,\r\n  translateElement,\r\n} from \"../../spells/Elements\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport { getVisibleSpellsForElement } from \"../../spells/Spells\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\n\r\nexport function getConcatenatedRequirements(spell: Spell): string {\r\n  return formatRequirements(spell.getLevelRequirements());\r\n}\r\n\r\nfunction formatRequirements(\r\n  elementRequirements: Partial<Record<SpellElement, number>>,\r\n): string {\r\n  let requirements = [];\r\n  for (let element of keysOf(elementRequirements)) {\r\n    requirements.push(\r\n      t(\"{{elementName}} Lv{{level}}\", {\r\n        elementName: translateElement(element),\r\n        level: elementRequirements[element],\r\n      }),\r\n    );\r\n  }\r\n  return requirements.join(t(\", \"));\r\n}\r\n\r\nexport function getMarkdownTextForSpell(spell: Spell): string {\r\n  return `*${spell.getSpellName()}* (${getConcatenatedRequirements(spell)})`;\r\n}\r\n\r\nexport function getMarkdownTextForSpellEmpowerment(spell: Spell): string {\r\n  return `*${spell.getSpellName()}+* (${formatRequirements(\r\n    spell.getEmpoweringLevelRequirements(),\r\n  )})`;\r\n}\r\n\r\nexport function getMarkdownTextForTransmutationSpell(\r\n  state: GameState,\r\n  spell: TransmutationSpell,\r\n): string {\r\n  return t(\"{{itemIcon}} *{{itemName}}* ({{requirements}})\", {\r\n    itemIcon: `:${spell.getItem().getId()}:`,\r\n    itemName: spell.getItem().getName(spell.getItem().getDefaultParams()),\r\n    requirements: getConcatenatedRequirements(spell),\r\n  });\r\n}\r\n\r\nfunction getLevelUpLearnedSpellsText(\r\n  oldSpells: Spell[],\r\n  newSpells: Spell[],\r\n): string {\r\n  let diffSpells = newSpells.filter((spell) => !oldSpells.includes(spell));\r\n  let newSpellText = \"\";\r\n  let extraSpellText = \"\";\r\n  if (diffSpells.length > 3) {\r\n    const extraSpells = diffSpells.length - 3;\r\n    extraSpellText = t(\"and {{extraSpells}} more!\", { extraSpells });\r\n    diffSpells = diffSpells.slice(0, 3);\r\n  }\r\n  if (diffSpells.length > 0) {\r\n    let newSpellsLearnedText = diffSpells\r\n      .map(getMarkdownTextForSpell)\r\n      .join(t(\", \"));\r\n    if (extraSpellText !== \"\") {\r\n      newSpellsLearnedText = [newSpellsLearnedText, extraSpellText].join(\r\n        t(\". \"),\r\n      );\r\n    }\r\n    newSpellText = t(`**New spells learned:** {{newSpellsLearnedText}}`, {\r\n      newSpellsLearnedText,\r\n    });\r\n  }\r\n  return newSpellText;\r\n}\r\n\r\nfunction getLevelUpLearnedTransmutationsForElement(\r\n  state: GameState,\r\n  element: SpellElement,\r\n  oldSpells: TransmutationSpell[],\r\n  newSpells: TransmutationSpell[],\r\n): string {\r\n  let diffSpells = newSpells.filter(\r\n    (spell) =>\r\n      !oldSpells.includes(spell) &&\r\n      (spell.getLevelRequirements()?.[element] ?? 0) > 0,\r\n  );\r\n  let newSpellsText = \"\";\r\n  if (isTransmutationUnlocked(state) && diffSpells.length > 0) {\r\n    let extraSpellsText = \"\";\r\n    if (diffSpells.length > 3) {\r\n      const extraSpells = diffSpells.length - 3;\r\n      extraSpellsText = t(\"and {{extraSpells}} more!\", { extraSpells });\r\n      diffSpells = diffSpells.slice(0, 3);\r\n    }\r\n    let newSpellsLearnedText = diffSpells\r\n      .map(getMarkdownTextForTransmutationSpell.bind(null, state))\r\n      .join(\", \");\r\n    if (extraSpellsText !== \"\") {\r\n      newSpellsLearnedText = [newSpellsLearnedText, extraSpellsText].join(\r\n        t(\", \"),\r\n      );\r\n    }\r\n    newSpellsText = t(\r\n      `**New Transmutations available:**\r\n{{newSpellsLearnedText}}`,\r\n      { newSpellsLearnedText },\r\n    );\r\n  }\r\n  return newSpellsText;\r\n}\r\n\r\nfunction getLevelUpLearnedEmpoweredSpellsText(\r\n  oldSpells: Spell[],\r\n  newSpells: Spell[],\r\n): string {\r\n  let diffSpells = newSpells.filter((spell) => !oldSpells.includes(spell));\r\n  let newSpellText = \"\";\r\n  let extraSpellText = \"\";\r\n  if (diffSpells.length > 3) {\r\n    const extraSpells = diffSpells.length - 3;\r\n    extraSpellText = t(\"and {{extraSpells}} more!\", { extraSpells });\r\n    diffSpells = diffSpells.slice(0, 3);\r\n  }\r\n  if (diffSpells.length > 0) {\r\n    let newSpellsLearnedText = diffSpells\r\n      .map(getMarkdownTextForSpellEmpowerment)\r\n      .join(t(\", \"));\r\n    if (extraSpellText !== \"\") {\r\n      newSpellsLearnedText = [newSpellsLearnedText, extraSpellText].join(\r\n        t(\". \"),\r\n      );\r\n    }\r\n    newSpellText = t(`**New Empowerable spells:** {{newSpellsLearnedText}}`, {\r\n      newSpellsLearnedText,\r\n    });\r\n  }\r\n  return newSpellText;\r\n}\r\n\r\nfunction getLevelUpLearnedRitualsText(\r\n  oldRituals: Ritual[],\r\n  newRituals: Ritual[],\r\n): string {\r\n  let diffRituals = newRituals.filter((ritual) => !oldRituals.includes(ritual));\r\n  let newRitualText = \"\";\r\n  let extraRitualText = \"\";\r\n  if (diffRituals.length > 3) {\r\n    const extraRituals = diffRituals.length - 3;\r\n    extraRitualText = t(\"and {{extraRituals}} more!\", {\r\n      extraRituals: extraRituals,\r\n    });\r\n    diffRituals = diffRituals.slice(0, 3);\r\n  }\r\n  if (diffRituals.length > 0) {\r\n    let newRitualsLearnedText = diffRituals\r\n      .map(\r\n        (ritual) =>\r\n          `*${ritual.getBaseName()}* (${formatRequirements(\r\n            ritual.getLevelRequirements(),\r\n          )})`,\r\n      )\r\n      .join(t(\", \"));\r\n    if (extraRitualText !== \"\") {\r\n      newRitualsLearnedText = [newRitualsLearnedText, extraRitualText].join(\r\n        t(\". \"),\r\n      );\r\n    }\r\n    newRitualText = t(`**New Rituals:** {{newRitualsLearnedText}}`, {\r\n      newRitualsLearnedText: newRitualsLearnedText,\r\n    });\r\n  }\r\n  return newRitualText;\r\n}\r\n\r\nexport const LevelUpListeners = new DataStore<\r\n  (state: GameState, element: SpellElement, oldExp: number) => GameState\r\n>();\r\n\r\nexport function loadLevelUpEvents() {\r\n  for (let element of valuesOf(SpellElement)) {\r\n    const eventBuilder = buildEvent(\r\n      \"Level_Up_\" + element,\r\n      t(\"{{element}} Level Up!\", { element: translateElement(element) }),\r\n      [EventTag.LEVEL_UP],\r\n    );\r\n\r\n    eventBuilder.message(\r\n      t(\r\n        `Congratulations!\r\n      \r\nYour {{element}} level is now /level/!\r\n\r\n/rankText/\r\n\r\n/levelUpLearnedSpells/\r\n\r\n/levelUpLearnedCrafts/\r\n\r\n/levelUpLearnedEmpowers/\r\n\r\n/levelUpLearnedRituals/`,\r\n        { element: translateElement(element) },\r\n      ),\r\n    );\r\n\r\n    const event = eventBuilder.build();\r\n\r\n    addGameStateListener(\r\n      \"Level_Up_\" + element,\r\n      (state) => {\r\n        // Need to clear this cache to get an accurate level up message\r\n        state.temp.spellRequirementsCache = {};\r\n        let lessExpState = createHypotheticalState(state);\r\n        const level = getElementLevel(state, element);\r\n        lessExpState = grantElementExp(\r\n          element,\r\n          -(\r\n            getElementExp(state, element) -\r\n            (state.run.lastComputedLevelUpElementExperience[element] ?? 0)\r\n          ),\r\n        )(lessExpState);\r\n        const oldLevel = getElementLevel(lessExpState, element);\r\n        if (oldLevel == level) {\r\n          // Do nothing\r\n          return;\r\n        }\r\n        const oldSpells = getVisibleSpellsForElement(\r\n          lessExpState,\r\n          element,\r\n          ActionArea.SPELL_MENU,\r\n        );\r\n        const newSpells = getVisibleSpellsForElement(\r\n          state,\r\n          element,\r\n          ActionArea.SPELL_MENU,\r\n        );\r\n        const levelUpLearnedSpells = getLevelUpLearnedSpellsText(\r\n          oldSpells,\r\n          newSpells,\r\n        );\r\n        const oldTransmutations = getVisibleTransmutationSpells(lessExpState);\r\n        const newTransmutations = getVisibleTransmutationSpells(state);\r\n        const levelUpLearnedTransmutations =\r\n          getLevelUpLearnedTransmutationsForElement(\r\n            state,\r\n            element,\r\n            oldTransmutations,\r\n            newTransmutations,\r\n          );\r\n        const oldEmpoweredSpells = oldSpells.filter((spell) =>\r\n          spell.isEmpoweringPossible(lessExpState),\r\n        );\r\n        const newEmpoweredSpells = newSpells.filter((spell) =>\r\n          spell.isEmpoweringPossible(state),\r\n        );\r\n        const levelUpLearnedEmpowers = getLevelUpLearnedEmpoweredSpellsText(\r\n          oldEmpoweredSpells,\r\n          newEmpoweredSpells,\r\n        );\r\n        const oldRituals = getVisibleRituals(lessExpState);\r\n        const newRituals = getVisibleRituals(state);\r\n        const levelUpLearnedRituals = getLevelUpLearnedRitualsText(\r\n          oldRituals,\r\n          newRituals,\r\n        );\r\n        const rankText =\r\n          level % LEVELS_PER_RANK == 0\r\n            ? t(\r\n                \"You have reached a new Rank: *{{rank}}*. Any {{element}} spells you have learned on a previous rank will become 33% stronger!\",\r\n                {\r\n                  rank: getRankForLevel(level),\r\n                  element: translateElement(element),\r\n                },\r\n              )\r\n            : \"\";\r\n        const tags: EventTag[] = [];\r\n        if (\r\n          !levelUpLearnedSpells &&\r\n          !levelUpLearnedTransmutations &&\r\n          !levelUpLearnedEmpowers &&\r\n          !levelUpLearnedRituals &&\r\n          !rankText\r\n        ) {\r\n          tags.push(EventTag.LEVEL_UP_EMPTY);\r\n        }\r\n        if (\r\n          lessExpState.run.maxElementLevelsOnPrevRetirement[element] >= level\r\n        ) {\r\n          tags.push(EventTag.LEVEL_UP_ALREADY_REACHED);\r\n        }\r\n        return (state) => {\r\n          state = triggerEvent(\r\n            event,\r\n            {\r\n              level,\r\n              rankText,\r\n              levelUpLearnedSpells: levelUpLearnedSpells,\r\n              levelUpLearnedCrafts: levelUpLearnedTransmutations,\r\n              levelUpLearnedEmpowers: levelUpLearnedEmpowers,\r\n              levelUpLearnedRituals,\r\n            },\r\n            tags,\r\n          )(state);\r\n          LevelUpListeners.getAll().forEach((listener) => {\r\n            state = listener(\r\n              state,\r\n              element,\r\n              state.run.lastComputedLevelUpElementExperience[element] ?? 0,\r\n            );\r\n          });\r\n          state.run.lastComputedLevelUpElementExperience[element] =\r\n            getElementExp(state, element);\r\n          state.temp.spellRequirementsCache = {};\r\n          return state;\r\n        };\r\n      },\r\n      (state) => getElementLevel(state, element),\r\n    );\r\n  }\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { cacheIndefinitely, clearCacheKey } from \"../Caching\";\r\nimport { GameState } from \"../GameState\";\r\nimport { LevelUpListeners } from \"../events/progression/LevelUp\";\r\nimport { addEnemyDeathListener } from \"../exploration/Exploration\";\r\nimport { Enemies } from \"../exploration/enemies/Enemies\";\r\nimport {\r\n  BestiaryState,\r\n  Enemy,\r\n  KILLS_FOR_BESTIARY_LOOT,\r\n  getCumulativeEnemyKills,\r\n} from \"../exploration/enemies/Enemy\";\r\nimport { AddToInventoryForFirstTimeListeners } from \"./Inventory\";\r\nimport { Item } from \"./Item\";\r\nimport { Items } from \"./Items\";\r\nimport {\r\n  TransmutationSpell,\r\n  getAllTransmutationSpellsEverCastable,\r\n  getTransmutationSpellForItem,\r\n} from \"./transmute/TransmutationSpell\";\r\n\r\nexport type ItemCompendiumLootInfo = {\r\n  enemy: Enemy;\r\n  lootChance: number | undefined;\r\n  amount: number | undefined;\r\n};\r\n\r\nexport type ItemCompendiumInfo = {\r\n  item: Item;\r\n  transmuteSpell: TransmutationSpell | undefined;\r\n  knownLootFromEnemies: ItemCompendiumLootInfo[];\r\n};\r\n\r\nexport function getItemCompendiumInfoForItem(\r\n  state: GameState,\r\n  itemId: string,\r\n): ItemCompendiumInfo {\r\n  const item = Items.getById(itemId);\r\n  const info: ItemCompendiumInfo = {\r\n    item,\r\n    transmuteSpell: undefined,\r\n    knownLootFromEnemies: [],\r\n  };\r\n  const transmutationSpell = getTransmutationSpellForItem(item);\r\n  const transmutationSpellsEverCastable =\r\n    getAllTransmutationSpellsEverCastable(state);\r\n  if (\r\n    transmutationSpell != null &&\r\n    transmutationSpellsEverCastable.includes(transmutationSpell)\r\n  ) {\r\n    info.transmuteSpell = transmutationSpell;\r\n  }\r\n\r\n  // Now, check all the enemies that can drop it\r\n  const enemyInfo = {};\r\n  Enemies.getAll().forEach((enemy) => {\r\n    const loot = enemy.getItemsAwardedBase(state);\r\n    const foundLoot = loot.find((enemyLoot) => enemyLoot.itemId == itemId);\r\n    if (foundLoot != null) {\r\n      if (enemy.getBestiaryState(state) == BestiaryState.Loot) {\r\n        enemyInfo[enemy.getId()] = {\r\n          enemy: enemy,\r\n          lootChance: foundLoot.chance,\r\n          amount: foundLoot.amount,\r\n        };\r\n      } else {\r\n        // We only return it if we have seen a drop\r\n        if (state.world.knownEnemiesThatDrop[itemId]?.[enemy.getId()]) {\r\n          enemyInfo[enemy.getId()] = {\r\n            enemy: enemy,\r\n            lootChance: undefined,\r\n            amount: foundLoot.amount,\r\n          };\r\n        }\r\n      }\r\n    }\r\n  });\r\n  info.knownLootFromEnemies = valuesOf(enemyInfo);\r\n  return info;\r\n}\r\n\r\nexport function getAllKnownItemCompendiumInfos(\r\n  state: GameState,\r\n): ItemCompendiumInfo[] {\r\n  return cacheIndefinitely(\r\n    state,\r\n    (_state) => \"allKnownItemCompendiumInfos\",\r\n    (state) =>\r\n      Items.getAll()\r\n        .map((item) => getItemCompendiumInfoForItem(state, item.getId()))\r\n        .filter(\r\n          (info) =>\r\n            info.transmuteSpell ||\r\n            info.knownLootFromEnemies.length > 0 ||\r\n            state.world.itemsEverAddedToInventory[info.item.getId()],\r\n        ),\r\n  );\r\n}\r\n\r\nfunction clearItemCompendiumInfoCache(state: GameState): GameState {\r\n  return clearCacheKey(state, (_state) => \"allKnownItemCompendiumInfos\");\r\n}\r\n\r\nexport function loadCompendium() {\r\n  LevelUpListeners.register(\r\n    clearItemCompendiumInfoCache,\r\n    \"compendiumCacheClearerLevelUp\",\r\n  );\r\n  addEnemyDeathListener(\"compendiumCacheClearerEnemyDeath\", (state, enemy) => {\r\n    if (enemy != null) {\r\n      const totalCounter = getCumulativeEnemyKills(state, enemy.getId());\r\n      if (\r\n        (totalCounter == 1 && enemy.isBoss()) ||\r\n        (totalCounter == KILLS_FOR_BESTIARY_LOOT && !enemy.isBoss())\r\n      ) {\r\n        return clearItemCompendiumInfoCache(state);\r\n      }\r\n    }\r\n    return state;\r\n  });\r\n  AddToInventoryForFirstTimeListeners.register(\r\n    clearItemCompendiumInfoCache,\r\n    \"compendiumCacheClearerAddToInventoryFirstTime\",\r\n  );\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { getTotalAmountOfItem } from \"../items/Inventory\";\r\nimport { Item } from \"../items/Item\";\r\nimport { Items } from \"../items/Items\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport { Spell } from \"../spells/Spell\";\r\nimport {\r\n  applyTransformationsCached,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../transformation/TransformationTags\";\r\n\r\nfunction generateEffect(value: number) {\r\n  if (value > 0) {\r\n    return {\r\n      value,\r\n      valueType: TransformationValueType.Percent,\r\n    };\r\n  } else {\r\n    return {\r\n      value: 1.0 / (1.0 + value) - 1.0,\r\n      valueType: TransformationValueType.Divisor,\r\n    };\r\n  }\r\n}\r\n\r\nexport function generateSpellcraftMultiplier(\r\n  baseValue: number,\r\n  transformedValue: number,\r\n) {\r\n  if (transformedValue == null) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (baseValue > 0) {\r\n    return 1.0 + transformedValue;\r\n  } else {\r\n    return 1.0 / (transformedValue + 1.0);\r\n  }\r\n}\r\n\r\nexport abstract class Spellcraft {\r\n  getId(): string {\r\n    return \"spellcraft-\" + this.getBaseItem().getId();\r\n  }\r\n\r\n  abstract getBaseItem(): Item;\r\n\r\n  getName(): string {\r\n    return this.getBaseItem().getDefaultName();\r\n  }\r\n\r\n  getPicture() {\r\n    return this.getBaseItem().getPicture();\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return [TransformationTags.Spellcraft];\r\n  }\r\n\r\n  tagsByEffect: Record<string, string[]> = {};\r\n  getTagsByEffect(key: string, baseEffect: ActionEffect): string[] {\r\n    if (this.tagsByEffect?.[key] == null) {\r\n      this.tagsByEffect[key] = [\r\n        ...this.getTags(),\r\n        this.getId(),\r\n        ...(baseEffect.tags ?? []),\r\n        TransformationTags.SpellcraftEffect,\r\n      ];\r\n    }\r\n    return this.tagsByEffect[key];\r\n  }\r\n\r\n  protected getBaseWizardPowerMultiplier(): number {\r\n    return 0;\r\n  }\r\n\r\n  protected getBasePowerMultiplier(): number {\r\n    return 0;\r\n  }\r\n\r\n  protected getBaseCooldownMultiplier(): number {\r\n    return 0;\r\n  }\r\n\r\n  protected getBaseTemporaryEffectDurationMultiplier(): number {\r\n    return 0;\r\n  }\r\n\r\n  protected getBaseManaCostMultiplier(): number {\r\n    return 0;\r\n  }\r\n\r\n  getBaseMultipliers(): Record<string, number> {\r\n    return {\r\n      wizardPower: this.getBaseWizardPowerMultiplier(),\r\n      power: this.getBasePowerMultiplier(),\r\n      cooldown: this.getBaseCooldownMultiplier(),\r\n      temporaryEffectDuration: this.getBaseTemporaryEffectDurationMultiplier(),\r\n      manaCost: this.getBaseManaCostMultiplier(),\r\n    };\r\n  }\r\n\r\n  requiresSpellsWithParameterizedEffects(): boolean {\r\n    return this.getBasePowerMultiplier() != 0;\r\n  }\r\n\r\n  requiresSpellsWithCooldown(): boolean {\r\n    return this.getBaseCooldownMultiplier() != 0;\r\n  }\r\n\r\n  requiresSpellsWithTemporaryEffect(): boolean {\r\n    return this.getBaseTemporaryEffectDurationMultiplier() != 0;\r\n  }\r\n\r\n  requiresSpellsWithFixedManaCost(): boolean {\r\n    return this.getBaseManaCostMultiplier() != 0;\r\n  }\r\n\r\n  isSpellCompatible(spell: Spell): boolean {\r\n    if (this.requiresSpellsWithFixedManaCost() && !spell.hasFixedManaCost()) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      this.requiresSpellsWithParameterizedEffects() &&\r\n      !valuesOf(spell.getCachedBaseActionEffects()).some((effect) =>\r\n        effect.tags?.includes?.(TransformationTags.ActionMagnitude),\r\n      ) &&\r\n      !valuesOf(spell.getCachedBaseActionEffects()).some((effect) =>\r\n        effect.tags?.includes?.(TransformationTags.TemporaryEffectMagnitude),\r\n      ) &&\r\n      !valuesOf(spell.getCachedBaseActionEffects()).some((effect) =>\r\n        effect.tags?.includes?.(TransformationTags.ChannelingEfficiency),\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (this.requiresSpellsWithCooldown() && spell.getBaseCooldown() <= 0) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      this.requiresSpellsWithTemporaryEffect() &&\r\n      !valuesOf(spell.getCachedBaseActionEffects()).some((effect) =>\r\n        effect.tags?.includes?.(TransformationTags.TemporaryEffectDuration),\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  canAfford(state: GameState): boolean {\r\n    return getTotalAmountOfItem(this.getBaseItem(), state) >= 1000;\r\n  }\r\n\r\n  getCachedBaseBonusEffects = memoize(() => {\r\n    const effects: Record<string, ActionEffect> = {};\r\n    if (this.getBaseWizardPowerMultiplier() != 0) {\r\n      effects.wizardPower = generateEffect(this.getBaseWizardPowerMultiplier());\r\n    }\r\n    if (this.getBasePowerMultiplier() != 0) {\r\n      effects.power = generateEffect(this.getBasePowerMultiplier());\r\n    }\r\n    if (this.getBaseCooldownMultiplier() != 0) {\r\n      effects.cooldown = generateEffect(this.getBaseCooldownMultiplier());\r\n    }\r\n    if (this.getBaseTemporaryEffectDurationMultiplier() != 0) {\r\n      effects.temporaryEffectDuration = generateEffect(\r\n        this.getBaseTemporaryEffectDurationMultiplier(),\r\n      );\r\n    }\r\n    if (this.getBaseManaCostMultiplier() != 0) {\r\n      effects.manaCost = generateEffect(this.getBaseManaCostMultiplier());\r\n    }\r\n\r\n    return effects;\r\n  });\r\n\r\n  getEffect(state: GameState): string {\r\n    const effects = this.getBonusEffects(state);\r\n    const effectExplanations = this.getBonusEffectExplanations(state);\r\n\r\n    const multipliers: Record<string, number> = {\r\n      wizardPower: generateSpellcraftMultiplier(\r\n        this.getBaseWizardPowerMultiplier(),\r\n        effects.wizardPower,\r\n      ),\r\n      power: generateSpellcraftMultiplier(\r\n        this.getBasePowerMultiplier(),\r\n        effects.power,\r\n      ),\r\n      cooldown: generateSpellcraftMultiplier(\r\n        this.getBaseCooldownMultiplier(),\r\n        effects.cooldown,\r\n      ),\r\n      temporaryEffectDuration: generateSpellcraftMultiplier(\r\n        this.getBaseTemporaryEffectDurationMultiplier(),\r\n        effects.temporaryEffectDuration,\r\n      ),\r\n      manaCost: generateSpellcraftMultiplier(\r\n        this.getBaseManaCostMultiplier(),\r\n        effects.manaCost,\r\n      ),\r\n    };\r\n\r\n    const bonusStrings = Object.keys(multipliers).map((stat) => {\r\n      let value = multipliers?.[stat];\r\n      if (value == 1.0) {\r\n        return null;\r\n      }\r\n      const explanation = effectExplanations?.[stat];\r\n      switch (stat) {\r\n        case \"wizardPower\":\r\n          return t(\"^{{value}}^<{{explanation}}> :wizardpower: cost\", {\r\n            value: formatMultiplier(value),\r\n            explanation,\r\n          });\r\n        case \"power\":\r\n          return t(\"^{{value}}^<{{explanation}}> spell power\", {\r\n            value: formatMultiplier(value),\r\n            explanation,\r\n          });\r\n        case \"cooldown\":\r\n          return t(\"^{{value}}^<{{explanation}}> spell cooldown\", {\r\n            value: formatMultiplier(value),\r\n            explanation,\r\n          });\r\n        case \"temporaryEffectDuration\":\r\n          return t(\"^{{value}}^<{{explanation}}> duration of spell effects\", {\r\n            value: formatMultiplier(value),\r\n            explanation,\r\n          });\r\n        case \"manaCost\":\r\n          return t(\"^{{value}}^<{{explanation}}> :mana: cost\", {\r\n            value: formatMultiplier(value),\r\n            explanation,\r\n          });\r\n      }\r\n    });\r\n\r\n    return bonusStrings\r\n      .filter((bonusString) => bonusString != null)\r\n      .join(t(\", \"));\r\n  }\r\n\r\n  getBonusEffect(state: GameState, effectId: string): number {\r\n    const baseEffects = this.getCachedBaseBonusEffects();\r\n    const baseEffect = baseEffects[effectId];\r\n    if (baseEffect == null) {\r\n      return 0.0;\r\n    }\r\n    return applyTransformationsCached(\r\n      this.getTagsByEffect(effectId, baseEffect),\r\n      state,\r\n      baseEffect.value,\r\n    );\r\n  }\r\n\r\n  getBonusEffects(state: GameState, amount?: number): Record<string, number> {\r\n    const baseEffects = this.getCachedBaseBonusEffects();\r\n    const finalEffects: Record<string, number> = {};\r\n    for (let key in baseEffects) {\r\n      finalEffects[key] = this.getBonusEffect(state, key);\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  bonusEffectExplanationParams = memoize((baseEffect: ActionEffect) => ({\r\n    valueType: baseEffect.valueType,\r\n    unit: baseEffect.unit,\r\n  }));\r\n\r\n  getBonusEffectExplanations(\r\n    state: GameState,\r\n    onlyId?: string,\r\n  ): Record<string, string> {\r\n    const baseEffects = this.getCachedBaseBonusEffects();\r\n    const finalEffects: Record<string, string> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = explainTransformationsText(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.bonusEffectExplanationParams(baseEffect),\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n}\r\n\r\nexport abstract class PrismBasedSpellcraft extends Spellcraft {\r\n  protected abstract getElement(): SpellElement;\r\n\r\n  getBaseItem(): Item {\r\n    return Items.getById(\"elementalPrism\" + this.getElement());\r\n  }\r\n\r\n  protected getBaseWizardPowerMultiplier(): number {\r\n    return 1.0;\r\n  }\r\n}\r\n\r\nexport abstract class JewelBasedSpellcraft extends Spellcraft {\r\n  protected abstract getElement(): SpellElement;\r\n\r\n  getBaseItem(): Item {\r\n    return Items.getById(\"elementalJewel\" + this.getElement());\r\n  }\r\n\r\n  protected getBaseWizardPowerMultiplier(): number {\r\n    return 2.0;\r\n  }\r\n}\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { Spellcraft } from \"./Spellcraft\";\r\n\r\nexport const Spellcrafts = new DataStore<Spellcraft>();\r\n","import { t } from \"i18next\";\r\nimport { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport { clearAutocastCaches } from \"../autocast/Autocast\";\r\nimport {\r\n  addToInventory,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../items/Inventory\";\r\nimport { getAllKnownItemCompendiumInfos } from \"../items/ItemCompendium\";\r\nimport { getTransmutationSpellForItem } from \"../items/transmute/TransmutationSpell\";\r\nimport { getPrimaryElements } from \"../spells/Elements\";\r\nimport type { Spell } from \"../spells/Spell\";\r\nimport { Spells, clearAllSpellCaches } from \"../spells/Spells\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { Spellcraft, generateSpellcraftMultiplier } from \"./Spellcraft\";\r\nimport { SpellcraftData } from \"./SpellcraftData\";\r\nimport { Spellcrafts } from \"./Spellcrafts\";\r\n\r\nexport const MAX_VATS_PER_SPELL = 2;\r\n\r\nexport function getSpellcraftVatsForSpell(\r\n  state: GameState,\r\n  spellId: string,\r\n): SpellcraftData[] {\r\n  return valuesOf(state.run.spellcrafts).filter(\r\n    (data) => data.spellId == spellId,\r\n  );\r\n}\r\n\r\nexport function canLoadMultipleVats(\r\n  state: GameState,\r\n  spellcraft: Spellcraft,\r\n): boolean {\r\n  const item = spellcraft.getBaseItem();\r\n  const transmutation = getTransmutationSpellForItem(item);\r\n  if (transmutation == null) {\r\n    return false;\r\n  }\r\n\r\n  const element = transmutation.getElement();\r\n  return getPrimaryElements(state).includes(element);\r\n}\r\n\r\nexport function getVisibleSpellcrafts(state: GameState): Spellcraft[] {\r\n  return Spellcrafts.getAll().filter((spellcraft) => {\r\n    const item = spellcraft.getBaseItem();\r\n    return getAllKnownItemCompendiumInfos(state).some(\r\n      (info) => info.item == item,\r\n    );\r\n  });\r\n}\r\n\r\nexport function getVisibleSpellcraftsForSpell(\r\n  state: GameState,\r\n  spell: Spell,\r\n): Spellcraft[] {\r\n  const spellcrafts = getVisibleSpellcrafts(state);\r\n  return spellcrafts.filter((spellcraft) =>\r\n    spellcraft.isSpellCompatible(spell),\r\n  );\r\n}\r\n\r\nexport function canApplySpellcraftToSpell(\r\n  state: GameState,\r\n  spellId: string,\r\n  spellcraft: Spellcraft,\r\n): boolean {\r\n  const allVats = valuesOf(state.run.spellcrafts);\r\n  const vats = getSpellcraftVatsForSpell(state, spellId).filter(\r\n    (vat) => vat.spellcraftId != null,\r\n  );\r\n\r\n  if (vats.length >= MAX_VATS_PER_SPELL) {\r\n    return false;\r\n  }\r\n\r\n  if (!canLoadMultipleVats(state, spellcraft)) {\r\n    // Check if any other vat is loaded with this spellcraft\r\n    for (let vat of allVats) {\r\n      if (vat.spellcraftId == spellcraft.getId()) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Check if the spell's vats already have this spellcraft\r\n  for (let vat of vats) {\r\n    if (vat.spellcraftId == spellcraft.getId()) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function assignSpellcraftToVat(\r\n  state: GameState,\r\n  vatId: string,\r\n  spellcraftId: string,\r\n): GameState {\r\n  const spellcraft = Spellcrafts.getById(spellcraftId);\r\n  const vat = state.run.spellcrafts[vatId];\r\n  if (vat.spellcraftId == spellcraftId) {\r\n    return state;\r\n  }\r\n\r\n  if (vat.spellId == null) {\r\n    // Do not assign\r\n    return state;\r\n  }\r\n  const spell = Spells.getById(vat.spellId);\r\n  if (!spellcraft.isSpellCompatible(spell)) {\r\n    // Do not assign\r\n    return state;\r\n  }\r\n\r\n  // Check if it can be applied\r\n  if (!canApplySpellcraftToSpell(state, vat.spellId, spellcraft)) {\r\n    return state;\r\n  }\r\n\r\n  // Check the cost\r\n  if (!spellcraft.canAfford(state)) {\r\n    return state;\r\n  }\r\n\r\n  if (vat.spellcraftId != null) {\r\n    // First, unassign the current one to recover the mats\r\n    state = removeSpellcraftFromVat(state, vatId);\r\n  }\r\n\r\n  // Pay the cost\r\n  state = removeFromInventoryWithAnyParams(\r\n    spellcraft.getBaseItem(),\r\n    1000,\r\n    state,\r\n  );\r\n\r\n  // Assign\r\n  vat.spellcraftId = spellcraftId;\r\n  state = clearAllSpellCaches(state);\r\n  state = clearAutocastCaches(state);\r\n  return state;\r\n}\r\n\r\nexport function removeSpellcraftFromVat(\r\n  state: GameState,\r\n  vatId: string,\r\n): GameState {\r\n  const vat = state.run.spellcrafts[vatId];\r\n  if (vat.spellId == null) {\r\n    // Do not do anything\r\n    return state;\r\n  }\r\n\r\n  // Refund the cost\r\n  const spellcraft = Spellcrafts.getByIdNullable(vat.spellcraftId);\r\n  if (spellcraft != null) {\r\n    state = addToInventory(\r\n      {\r\n        itemId: spellcraft.getBaseItem().getId(),\r\n        params: spellcraft.getBaseItem().getDefaultParams(),\r\n      },\r\n      1000,\r\n      state,\r\n    );\r\n  }\r\n\r\n  // Remove\r\n  vat.spellcraftId = undefined;\r\n  state = clearAllSpellCaches(state);\r\n  state = clearAutocastCaches(state);\r\n  return state;\r\n}\r\n\r\nexport function assignSpellToVat(\r\n  state: GameState,\r\n  vatId: string,\r\n  spellId: string,\r\n): GameState {\r\n  if (state.run.spellcrafts[vatId].spellcraftId != null) {\r\n    const spellcraft = Spellcrafts.getById(\r\n      state.run.spellcrafts[vatId].spellcraftId,\r\n    );\r\n    if (\r\n      !spellcraft.isSpellCompatible(Spells.getById(spellId)) ||\r\n      !canApplySpellcraftToSpell(state, spellId, spellcraft)\r\n    ) {\r\n      state = removeSpellcraftFromVat(state, vatId);\r\n    }\r\n  }\r\n  state.run.spellcrafts[vatId].spellId = spellId;\r\n  state = clearAllSpellCaches(state);\r\n  state = clearAutocastCaches(state);\r\n  return state;\r\n}\r\n\r\nexport function createNewVat(state: GameState): GameState {\r\n  const newId = Math.random().toString();\r\n  state.run.spellcrafts[newId] = {\r\n    spellcraftId: undefined,\r\n    spellId: undefined,\r\n    vatId: newId,\r\n  };\r\n  return state;\r\n}\r\n\r\nexport function destroyVat(state: GameState, vatId: string): GameState {\r\n  if (state.run.spellcrafts[vatId] == null) {\r\n    return state;\r\n  }\r\n\r\n  if (state.run.spellcrafts[vatId].spellcraftId != null) {\r\n    state = removeSpellcraftFromVat(state, vatId);\r\n  }\r\n\r\n  delete state.run.spellcrafts[vatId];\r\n  return state;\r\n}\r\n\r\nexport function getSpellcraftVats(state: GameState): SpellcraftData[] {\r\n  return valuesOf(state.run.spellcrafts);\r\n}\r\n\r\nexport function isSpellcraftUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.SpellcraftUnlocked);\r\n}\r\n\r\nexport function isSpellcraftEverUnlocked(state: GameState): boolean {\r\n  return hasEverHadFlag(state, Flag.SpellcraftUnlocked);\r\n}\r\n\r\nfunction spellcraftTransform(\r\n  effectId: string,\r\n  state: GameState,\r\n  params: Record<string, any>,\r\n) {\r\n  const spellId = params?.action?.getId?.();\r\n  if (spellId == null) {\r\n    return 1.0;\r\n  }\r\n\r\n  const spellcrafts = getSpellcraftVatsForSpell(state, spellId);\r\n  return spellcrafts.reduce((prev, current) => {\r\n    const spellcraft = Spellcrafts.getByIdNullable(current.spellcraftId);\r\n    return (\r\n      prev *\r\n      generateSpellcraftMultiplier(\r\n        spellcraft?.getBaseMultipliers?.()?.[effectId] ?? 0,\r\n        spellcraft?.getBonusEffect?.(state, effectId) ?? 0,\r\n      )\r\n    );\r\n  }, 1.0);\r\n}\r\n\r\nexport function loadGenericSpellcraftTransformations() {\r\n  registerTransformation(\r\n    [[TransformationTags.Spell, TransformationTags.AutocastPointsConsumption]],\r\n    \"spellcraftWizardPower\",\r\n    t(\"Spellcraft\"),\r\n    TransformationType.Multiplier,\r\n    spellcraftTransform.bind(null, \"wizardPower\"),\r\n  );\r\n\r\n  registerTransformation(\r\n    [\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.ActionMagnitude,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.TemporaryEffectMagnitude,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.ChannelingEfficiency,\r\n      ],\r\n    ],\r\n    \"spellcraftPower\",\r\n    t(\"Spellcraft\"),\r\n    TransformationType.Multiplier,\r\n    spellcraftTransform.bind(null, \"power\"),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Spell, TransformationTags.SpellCooldown]],\r\n    \"spellcraftCooldown\",\r\n    t(\"Spellcraft\"),\r\n    TransformationType.Multiplier,\r\n    spellcraftTransform.bind(null, \"cooldown\"),\r\n  );\r\n\r\n  registerTransformation(\r\n    [\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.TemporaryEffectDuration,\r\n      ],\r\n    ],\r\n    \"spellcraftTemporaryEffectDuration\",\r\n    t(\"Spellcraft\"),\r\n    TransformationType.Multiplier,\r\n    spellcraftTransform.bind(null, \"temporaryEffectDuration\"),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Spell, TransformationTags.Cost, Resource.Mana]],\r\n    \"spellcraftManaCost\",\r\n    t(\"Spellcraft\"),\r\n    TransformationType.Multiplier,\r\n    spellcraftTransform.bind(null, \"manaCost\"),\r\n  );\r\n}\r\n","import { DataStore } from \"../generic/DataStore\";\r\nimport { SynchroBonus } from \"./SynchroBonus\";\r\n\r\nexport const SynchroBonuses = new DataStore<SynchroBonus>();\r\n","import memoize from \"sonic-memoize\";\r\nimport { clone, valuesOfCached } from \"../../utils/CoreUtils\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasFlag, setWorldFlag } from \"../Flags\";\r\nimport {\r\n  GameState,\r\n  GameStateTransform,\r\n  SYNCHRO_INITIAL_STATE,\r\n  SynchroStrategyState,\r\n} from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { SpellElement, getFullyUnlockedElements } from \"../spells/Elements\";\r\nimport { applyTransformations } from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { SynchroBonus } from \"./SynchroBonus\";\r\nimport { SynchroBonuses } from \"./SynchroBonuses\";\r\n\r\nexport const SYNCHRO_ROWS = 3;\r\nexport const SYNCHRO_COLS = 3;\r\n\r\nexport const SYNCHRO_GRID_AMOUNT = 8;\r\n\r\nexport function isSynchroUnlocked(state: GameState) {\r\n  return hasFlag(state, Flag.SynchroUnlocked);\r\n}\r\n\r\nexport function getCurrentSynchroStrategy(\r\n  state: GameState,\r\n): SynchroStrategyState {\r\n  const position = state.world.synchro.currentGrid;\r\n  let grid = state.world.synchro.grids[position];\r\n  if (grid == null) {\r\n    grid = clone(SYNCHRO_INITIAL_STATE);\r\n    state.world.synchro.grids[position] = grid;\r\n  }\r\n  return grid;\r\n}\r\n\r\nexport function setCurrentSynchroGrid(\r\n  state: GameState,\r\n  gridIndex: number,\r\n): GameState {\r\n  if (gridIndex < 0 || gridIndex >= SYNCHRO_GRID_AMOUNT) {\r\n    return state;\r\n  }\r\n  state.world.synchro.currentGrid = gridIndex;\r\n  for (let listener of SynchroChangeListeners.getAll()) {\r\n    state = listener(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getSynchroPosition(\r\n  state: GameState,\r\n  x: number,\r\n  y: number,\r\n  strategy?: SynchroStrategyState,\r\n): SpellElement | undefined {\r\n  if (x < 0 || y < 0 || x >= SYNCHRO_COLS || y >= SYNCHRO_ROWS) {\r\n    return undefined;\r\n  }\r\n  strategy = strategy ?? getCurrentSynchroStrategy(state);\r\n  return strategy.grid[y]?.[x];\r\n}\r\n\r\nexport const SynchroChangeListeners = new DataStore<GameStateTransform>();\r\n\r\nexport function setCurrentSynchroPosition(\r\n  state: GameState,\r\n  x: number,\r\n  y: number,\r\n  element: SpellElement | undefined,\r\n): GameState {\r\n  if (x < 0 || y < 0 || x >= SYNCHRO_COLS || y >= SYNCHRO_ROWS) {\r\n    return state;\r\n  }\r\n  if (element != null) {\r\n    const used = getTotalOccurrencesInSynchroGrid(state, element);\r\n    const max = calculateMaxOccurrencesInSynchroGrid(state, element);\r\n    if (used >= max) {\r\n      return state;\r\n    }\r\n  }\r\n  const strategy = getCurrentSynchroStrategy(state);\r\n  if (strategy.grid[y] == null) {\r\n    strategy.grid[y] = {};\r\n  }\r\n  strategy.grid[y][x] = element;\r\n  state = setWorldFlag(Flag.EverUsedSynchro)(state);\r\n  for (let listener of SynchroChangeListeners.getAll()) {\r\n    state = listener(state);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function getCurrentSynchroBonuses(\r\n  state: GameState,\r\n  element1: SpellElement,\r\n  element2: SpellElement,\r\n): number {\r\n  // If the elements are the same, then only check right and down\r\n  // to avoid double counting\r\n  const offsetsToCheck =\r\n    element1 == element2\r\n      ? [\r\n          [1, 0],\r\n          [0, 1],\r\n        ]\r\n      : [\r\n          [-1, 0],\r\n          [0, -1],\r\n          [1, 0],\r\n          [0, 1],\r\n        ];\r\n  let bonusCount = 0;\r\n  for (let x = 0; x < 3; x++) {\r\n    for (let y = 0; y < 3; y++) {\r\n      if (getSynchroPosition(state, x, y) == element1) {\r\n        for (let offsets of offsetsToCheck) {\r\n          if (\r\n            getSynchroPosition(state, x + offsets[0], y + offsets[1]) ==\r\n            element2\r\n          ) {\r\n            bonusCount++;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return bonusCount;\r\n}\r\n\r\nexport function getSortedSynchroBonuses(\r\n  state: GameState,\r\n): { bonus: SynchroBonus; amount: number }[] {\r\n  const allBonuses = SynchroBonuses.getAll();\r\n  let bonusesToConsider = [];\r\n  const fullyUnlockedElements = getFullyUnlockedElements(state);\r\n  for (let bonus of allBonuses) {\r\n    const amount = bonus.getCurrentBonusAmount(state);\r\n    if (\r\n      fullyUnlockedElements.includes(bonus.getElement1()) &&\r\n      fullyUnlockedElements.includes(bonus.getElement2())\r\n    )\r\n      bonusesToConsider.push({ bonus, amount });\r\n  }\r\n  bonusesToConsider.sort((a, b) => {\r\n    if (a.amount != b.amount) {\r\n      return b.amount - a.amount;\r\n    }\r\n    if (a.bonus.getElement1() != b.bonus.getElement1()) {\r\n      return (\r\n        valuesOfCached(SpellElement).indexOf(a.bonus.getElement1()) -\r\n        valuesOfCached(SpellElement).indexOf(b.bonus.getElement1())\r\n      );\r\n    }\r\n    return (\r\n      valuesOfCached(SpellElement).indexOf(a.bonus.getElement2()) -\r\n      valuesOfCached(SpellElement).indexOf(b.bonus.getElement2())\r\n    );\r\n  });\r\n  return bonusesToConsider;\r\n}\r\n\r\nexport function getTotalOccurrencesInSynchroGrid(\r\n  state: GameState,\r\n  element: SpellElement,\r\n): number {\r\n  let count = 0;\r\n  const current = getCurrentSynchroStrategy(state);\r\n  for (let x in current.grid) {\r\n    for (let y in current.grid?.[x] ?? []) {\r\n      count += current.grid?.[x]?.[y] == element ? 1 : 0;\r\n    }\r\n  }\r\n  return count;\r\n}\r\n\r\nexport function calculateMaxOccurrencesInSynchroGrid(\r\n  state: GameState,\r\n  element: SpellElement,\r\n): number {\r\n  return applyTransformations(\r\n    [element, TransformationTags.SynchroGridMax],\r\n    state,\r\n    2,\r\n  );\r\n}\r\n\r\nfunction findSynchroBonusForElementsUncached(\r\n  element1: SpellElement,\r\n  element2: SpellElement,\r\n): SynchroBonus | undefined {\r\n  return SynchroBonuses.getAll().find(\r\n    (bonus) =>\r\n      (bonus.getElement1() == element1 && bonus.getElement2() == element2) ||\r\n      (bonus.getElement1() == element2 && bonus.getElement2() == element1),\r\n  );\r\n}\r\n\r\nexport const findSynchroBonusForElements = memoize(\r\n  findSynchroBonusForElementsUncached,\r\n);\r\n\r\nexport function hasNegativeSynchroBonusOnTile(\r\n  state: GameState,\r\n  x: number,\r\n  y: number,\r\n): boolean {\r\n  const offsetsToCheck = [\r\n    [-1, 0],\r\n    [0, -1],\r\n    [1, 0],\r\n    [0, 1],\r\n  ];\r\n\r\n  const currentElement = getSynchroPosition(state, x, y);\r\n  if (currentElement == null) {\r\n    return false;\r\n  }\r\n\r\n  for (let offsets of offsetsToCheck) {\r\n    const otherElement = getSynchroPosition(\r\n      state,\r\n      x + offsets[0],\r\n      y + offsets[1],\r\n    );\r\n    if (otherElement != null) {\r\n      const bonus = findSynchroBonusForElements(currentElement, otherElement);\r\n      if (bonus != null && !bonus.isBeneficial()) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","import color from \"color\";\r\nimport React, { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport { Platform, StyleSheet, useWindowDimensions } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { MD3Theme } from \"react-native-paper/lib/typescript/src/types\";\r\nimport memoize from \"sonic-memoize\";\r\nimport { getThemeByElementAndDarkMode } from \"../../Themes\";\r\nimport { cacheBySecondsPlayed } from \"../../backend/Caching\";\r\nimport { GameState, StateContext } from \"../../backend/GameState\";\r\nimport { getUnreadNotificationsByGroup } from \"../../backend/Notifications\";\r\nimport { isRetirementUnlocked } from \"../../backend/Retire\";\r\nimport {\r\n  estimateManaConsumptionPerSecPermaCast,\r\n  estimateWizardPowerConsumptionPerSecPermaCast,\r\n  getAutocastPointIncomePerSecPerWizard,\r\n  getCurrentAutocastStrategy,\r\n  isAutocastUnlocked,\r\n} from \"../../backend/autocast/Autocast\";\r\nimport { isBoostingUnlocked } from \"../../backend/boost/BoostActionBase\";\r\nimport { getEndingData } from \"../../backend/ending/Endings\";\r\nimport { isEnhancementUnlocked } from \"../../backend/enhancement/Enhancements\";\r\nimport { isExplorationUnlocked } from \"../../backend/exploration/Exploration\";\r\nimport { isBestiaryUnlocked } from \"../../backend/exploration/enemies/Enemy\";\r\nimport { areFamiliarsUnlocked } from \"../../backend/familiars/Familiar\";\r\nimport { isTransmutationUnlocked } from \"../../backend/items/transmute/TransmutationSpell\";\r\nimport { areRitualsUnlocked } from \"../../backend/rituals/Rituals\";\r\nimport { isSpellcraftUnlocked } from \"../../backend/spellcraft/SpellcraftUtils\";\r\nimport { SpellElement } from \"../../backend/spells/Elements\";\r\nimport { isStudyUnlocked } from \"../../backend/study/Study\";\r\nimport { isSynchroUnlocked } from \"../../backend/synchro/Synchro\";\r\nimport { calculateIncomePerSecond } from \"../../backend/timetick/IncomeOverTime\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Markdown } from \"./Markdown\";\r\n\r\nconst disabledColorByThemeMemoized = memoize(\r\n  (themeMode: string, disabledColor?: string) => {\r\n    return themeMode === \"dark\"\r\n      ? color(disabledColor)?.lighten(1.2).string()\r\n      : color(disabledColor)?.darken(0.3).string();\r\n  },\r\n);\r\n\r\nexport function disabledColorByTheme(theme: MD3Theme) {\r\n  return disabledColorByThemeMemoized(\r\n    theme.dark ? \"dark\" : \"light\",\r\n    theme.colors.onSurfaceDisabled,\r\n  );\r\n}\r\n\r\nexport function showImportFromFile(): boolean {\r\n  return Platform.select({\r\n    ios: true,\r\n    android: true,\r\n    default: false,\r\n  });\r\n}\r\n\r\nexport function showExportToFile(): boolean {\r\n  return Platform.select({\r\n    ios: true,\r\n    android: true,\r\n    web: true,\r\n    default: false,\r\n  });\r\n}\r\n\r\nexport function elementColorByTheme(isDark: boolean, element: SpellElement) {\r\n  const theme = getThemeByElementAndDarkMode(element, isDark);\r\n  return isDark ? theme.colors.primaryContainer : theme.colors.primary;\r\n}\r\n\r\nexport function getPrimaryButtonTextColor(\r\n  theme: MD3Theme,\r\n  disabled: boolean,\r\n): string {\r\n  if (disabled) {\r\n    return theme.colors.onSurfaceDisabled;\r\n  }\r\n  return theme.colors.onPrimary;\r\n}\r\n\r\nexport function DescriptionViewer(props: any) {\r\n  const theme = useTheme();\r\n  const style = useMemo(\r\n    () => [{ color: theme.colors.onBackground }, props.style || {}],\r\n    [theme, props.style],\r\n  );\r\n  return <Markdown style={style}>{props.children}</Markdown>;\r\n}\r\n\r\nexport function EffectViewer(props: any) {\r\n  const theme = useTheme();\r\n  const style = useMemo(\r\n    () => [\r\n      styles.effectText,\r\n      { color: theme.colors.onBackground },\r\n      props.style || {},\r\n    ],\r\n    [theme, props.style],\r\n  );\r\n  return <Markdown style={style}>{props.children}</Markdown>;\r\n}\r\n\r\nexport type SectionData = {\r\n  id: string;\r\n  name: string;\r\n  scrollable: boolean;\r\n  hideBottomResourceBar: boolean;\r\n  scrollView: boolean;\r\n  keepInMemory: boolean;\r\n  hotkey?: string;\r\n  isVisible?: (state: GameState) => boolean;\r\n  isBadged?: (state: GameState) => boolean;\r\n  fullScreen?: boolean;\r\n};\r\n\r\nexport const getAllSections = memoize(() => {\r\n  return [\r\n    {\r\n      id: \"Home\",\r\n      name: t(\"Home\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: false,\r\n      keepInMemory: true,\r\n      hotkey: \"H\",\r\n    },\r\n    {\r\n      id: \"Study\",\r\n      name: t(\"Study\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"S\",\r\n      isVisible: (state) => isStudyUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Inventory\",\r\n      name: t(\"Inventory\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"I\",\r\n      isVisible: (state) =>\r\n        isTransmutationUnlocked(state) || state.run.inventory.length > 0,\r\n    },\r\n    {\r\n      id: \"Transmute\",\r\n      name: t(\"Transmute\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"T\",\r\n      isVisible: (state) => isTransmutationUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Wizards\",\r\n      name: t(\"Wizards\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: true,\r\n      scrollView: false,\r\n      keepInMemory: true,\r\n      hotkey: \"W\",\r\n      isVisible: (state) => isAutocastUnlocked(state),\r\n      isBadged: (state) => {\r\n        return cacheBySecondsPlayed(state, \"isWizardsBadged\", (state) => {\r\n          if (state.run.autocast.autocastPaused) {\r\n            return true;\r\n          }\r\n          const strategy = getCurrentAutocastStrategy(state);\r\n          if (\r\n            estimateWizardPowerConsumptionPerSecPermaCast(state, strategy) >\r\n            getAutocastPointIncomePerSecPerWizard(state) *\r\n              strategy.wizardsAssignedToPermaCast\r\n          ) {\r\n            return true;\r\n          }\r\n          if (\r\n            estimateManaConsumptionPerSecPermaCast(state, strategy) >\r\n            (calculateIncomePerSecond(state)?.Mana ?? 0)\r\n          ) {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n      },\r\n    },\r\n    {\r\n      id: \"Exploration\",\r\n      name: t(\"Exploration\"),\r\n      scrollable: false,\r\n      hideBottomResourceBar: true,\r\n      scrollView: false,\r\n      keepInMemory: true,\r\n      hotkey: \"E\",\r\n      isVisible: (state) => isExplorationUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Enhance\",\r\n      name: t(\"Enhance\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"N\",\r\n      isVisible: (state) => isEnhancementUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Synchro\",\r\n      name: t(\"Synchro\"),\r\n      scrollable: false,\r\n      hideBottomResourceBar: true,\r\n      scrollView: false,\r\n      keepInMemory: true,\r\n      hotkey: \"Y\",\r\n      isVisible: (state) => isSynchroUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Boosts\",\r\n      name: t(\"Boost\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"B\",\r\n      isVisible: (state) => isBoostingUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Familiars\",\r\n      name: t(\"Familiars\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"F\",\r\n      isVisible: (state) => areFamiliarsUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Spellcraft\",\r\n      name: t(\"Spellcraft\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"P\",\r\n      isVisible: (state) => isSpellcraftUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Rituals\",\r\n      name: t(\"Rituals\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      hotkey: \"R\",\r\n      isVisible: (state) => areRitualsUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Ending\",\r\n      name: t(\"Ending\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      isVisible: (state) => getEndingData(state) != null,\r\n      fullScreen: true,\r\n    },\r\n    {\r\n      id: \"Retirement\",\r\n      name: t(\"Retirement\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      isVisible: (state) => isRetirementUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Worlds\",\r\n      name: t(\"Worlds\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: false,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      isVisible: (state) => state.global.newGamePlusUnlocked,\r\n    },\r\n    {\r\n      id: \"Compendium\",\r\n      name: t(\"Compendium\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: true,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n      isVisible: (state) => isBestiaryUnlocked(state),\r\n    },\r\n    {\r\n      id: \"Stats\",\r\n      name: t(\"Stats\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: true,\r\n      scrollView: true,\r\n      keepInMemory: true,\r\n    },\r\n    {\r\n      id: \"Options\",\r\n      name: t(\"Options\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: true,\r\n      scrollView: true,\r\n      keepInMemory: false,\r\n    },\r\n    {\r\n      id: \"Help\",\r\n      name: t(\"Help\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: true,\r\n      scrollView: true,\r\n      keepInMemory: false,\r\n      isBadged: (state) =>\r\n        getUnreadNotificationsByGroup(state, \"Help\").length > 0,\r\n    },\r\n    {\r\n      id: \"About\",\r\n      name: t(\"About\"),\r\n      scrollable: true,\r\n      hideBottomResourceBar: true,\r\n      keepInMemory: false,\r\n      scrollView: true,\r\n    },\r\n    {\r\n      id: \"Debug\",\r\n      name: \"Debug\",\r\n      scrollable: true,\r\n      hideBottomResourceBar: true,\r\n      scrollView: true,\r\n      keepInMemory: false,\r\n      isVisible: (state) => false, //Constants?.expoConfig?.extra?.showDebug,\r\n    },\r\n  ];\r\n});\r\n\r\nexport const DEFAULT_SECTION_ORDER = getAllSections().map(\r\n  (sectionData) => sectionData.id,\r\n);\r\n\r\nexport function getAllMenuItems(state: GameState): string[] {\r\n  return getAllSections()\r\n    .filter((section) => section.isVisible == null || section.isVisible(state))\r\n    .map((section) => section.id) as string[];\r\n}\r\n\r\nexport function getSectionInfo(section: string): SectionData {\r\n  return getAllSections().find((sectionInfo) => sectionInfo.id == section);\r\n}\r\n\r\nexport function useHorizontalScrollRef() {\r\n  const elRef = useRef<any>();\r\n  useEffect(() => {\r\n    if (Platform.OS !== \"web\") {\r\n      return;\r\n    }\r\n    const el = elRef.current;\r\n    if (el) {\r\n      const onWheel = (e: any) => {\r\n        if (e.deltaY === 0) return;\r\n        const scrollableElement = el.getScrollableNode();\r\n        if (\r\n          !(scrollableElement.scrollLeft === 0 && e.deltaY < 0) &&\r\n          !(\r\n            scrollableElement.scrollWidth -\r\n              scrollableElement.clientWidth -\r\n              Math.round(scrollableElement.scrollLeft) ===\r\n              0 && e.deltaY > 0\r\n          )\r\n        ) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n        scrollableElement.scrollBy({ left: e.deltaY, behavior: \"smooth\" });\r\n      };\r\n      el.getScrollableNode().addEventListener(\"wheel\", onWheel);\r\n      return () =>\r\n        el.getScrollableNode()?.removeEventListener?.(\"wheel\", onWheel);\r\n    }\r\n  }, []);\r\n  return elRef;\r\n}\r\n\r\nexport const MAX_OPEN_TABS = 5;\r\n\r\nexport function useLayoutType() {\r\n  const { width, height } = useWindowDimensions();\r\n  const state = useContext(StateContext);\r\n  return getLayoutType(state, height, width);\r\n}\r\n\r\nexport function getLayoutType(state: GameState, height: number, width: number) {\r\n  if (width < 700) {\r\n    return {\r\n      wideLayout: false,\r\n      showMenu: false,\r\n      showSpellMenu: false,\r\n      showEventsMenu: false,\r\n      activeContentTabs: 1,\r\n    };\r\n  }\r\n  if (width < 1000) {\r\n    return {\r\n      wideLayout: true,\r\n      showMenu: true,\r\n      showSpellMenu: false,\r\n      showEventsMenu: false,\r\n      activeContentTabs: 1,\r\n    };\r\n  }\r\n  if (width < 1350) {\r\n    return {\r\n      wideLayout: true,\r\n      showMenu: true,\r\n      showSpellMenu: true,\r\n      showEventsMenu: false,\r\n      activeContentTabs: 1,\r\n    };\r\n  }\r\n  return {\r\n    wideLayout: true,\r\n    showMenu: true,\r\n    showSpellMenu: true,\r\n    showEventsMenu: !state?.options?.doNotShowEventsOnWideScreens,\r\n    activeContentTabs: Math.min(\r\n      MAX_OPEN_TABS,\r\n      Math.max(\r\n        1,\r\n        Math.floor(\r\n          (width -\r\n            300 *\r\n              (2 + (state?.options?.doNotShowEventsOnWideScreens ? 0 : 1))) /\r\n            480,\r\n        ),\r\n      ),\r\n    ),\r\n  };\r\n}\r\n\r\nexport function getInitialActiveSectionObjects(\r\n  state: GameState,\r\n): { section: string; key: number }[] {\r\n  const tabCount = MAX_OPEN_TABS;\r\n  const menuItems = getAllMenuItems(state);\r\n  return menuItems\r\n    .slice(0, tabCount)\r\n    .map((menuItem, idx) => ({ section: menuItem, key: idx }));\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  effectText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n});\r\n","import React from \"react\";\r\n\r\nexport type TooltipPosition = {\r\n  top?: number;\r\n  bottom?: number;\r\n  left?: number;\r\n  right?: number;\r\n  containerWidth: number;\r\n};\r\n\r\nexport type TooltipContent = React.ReactNode | undefined;\r\n\r\nexport type TooltipContextValue = {\r\n  tooltip: TooltipContent;\r\n  position: TooltipPosition;\r\n};\r\n\r\nexport type TooltipControlContextValue = {\r\n  setTooltip: (\r\n    id: string,\r\n    tooltip: TooltipContent,\r\n    position: TooltipPosition,\r\n    measurementId?: number,\r\n  ) => void;\r\n  clearTooltip: (id: string) => void;\r\n  onMouseLeave: (id: string) => void;\r\n  onMouseEnter: (id: string, measurementId: number) => void;\r\n  onUnmountTooltip: (id: string) => void;\r\n};\r\n\r\nexport const TooltipContext = React.createContext<TooltipContextValue>({\r\n  tooltip: undefined,\r\n  position: { containerWidth: 1 },\r\n});\r\n\r\nexport const EMPTY_TOOLTIP_CONTEXT = {\r\n  tooltip: undefined,\r\n  position: { containerWidth: 1 },\r\n};\r\n\r\nexport const TooltipControlContext =\r\n  React.createContext<TooltipControlContextValue>({\r\n    setTooltip: (\r\n      id: string,\r\n      tooltip: TooltipContent,\r\n      position: TooltipPosition,\r\n    ) => {},\r\n    clearTooltip: (id: string) => {},\r\n    onMouseLeave: (id: string) => {},\r\n    onMouseEnter: (id: string, measurementId: number) => {},\r\n    onUnmountTooltip: (id: string) => {},\r\n  });\r\n","import React from \"react\";\r\n\r\nexport const VisibilityContext = React.createContext<boolean>(true);\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n} from \"react\";\r\nimport { StyleSheet, useWindowDimensions, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { useLayoutType } from \"./Miscellaneous\";\r\nimport {\r\n  TooltipContent,\r\n  TooltipContext,\r\n  TooltipControlContext,\r\n} from \"./TooltipContext\";\r\nimport { VisibilityContext } from \"./VisibilityContext\";\r\n\r\nexport const TooltipDisplay = () => {\r\n  const tooltipContext = useContext(TooltipContext);\r\n  const theme = useTheme();\r\n  const windowDimensions = useWindowDimensions();\r\n  const layout = useLayoutType();\r\n  return useMemo(() => {\r\n    return (\r\n      <View\r\n        style={{\r\n          zIndex: 800,\r\n          display:\r\n            tooltipContext.tooltip != null && layout.showSpellMenu\r\n              ? undefined\r\n              : \"none\",\r\n          position: \"absolute\",\r\n          left: tooltipContext.position?.left,\r\n          top: tooltipContext.position?.top,\r\n          bottom: tooltipContext.position?.bottom,\r\n          right: tooltipContext.position?.right,\r\n          minWidth: tooltipContext.position.containerWidth,\r\n          alignItems: \"center\",\r\n        }}\r\n        pointerEvents=\"none\"\r\n      >\r\n        <View\r\n          style={{\r\n            padding: 8,\r\n            alignSelf: \"center\",\r\n            backgroundColor: theme.colors.background,\r\n            borderRadius: 4,\r\n            borderWidth: 1,\r\n            borderColor: theme.colors.outlineVariant,\r\n            maxWidth: Math.min(\r\n              windowDimensions.width - (tooltipContext.position?.left ?? 0),\r\n              tooltipContext.position?.right ?? windowDimensions.width,\r\n              windowDimensions.width / 3,\r\n              480,\r\n            ),\r\n          }}\r\n          pointerEvents=\"none\"\r\n        >\r\n          {tooltipContext.tooltip}\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [\r\n    tooltipContext.tooltip,\r\n    JSON.stringify(tooltipContext.position),\r\n    theme,\r\n    windowDimensions.width,\r\n    layout.showSpellMenu,\r\n  ]);\r\n};\r\n\r\nexport enum TooltipPositionType {\r\n  DEFAULT = \"DEFAULT\",\r\n  LEFT_OF_ELEMENT = \"LEFT_OF_ELEMENT\",\r\n  RIGHT_OF_ELEMENT = \"RIGHT_OF_ELEMENT\",\r\n}\r\n\r\nexport const TooltipWrapper = (props: {\r\n  children: any;\r\n  tooltip: TooltipContent;\r\n  tooltipId: string;\r\n  tooltipPosition?: TooltipPositionType;\r\n  containerStyle?: any;\r\n}) => {\r\n  const tooltipPositionType =\r\n    props.tooltipPosition ?? TooltipPositionType.DEFAULT;\r\n  const tooltipContext = useContext(TooltipControlContext);\r\n  const visible = useContext(VisibilityContext);\r\n\r\n  const screenDimensions = useWindowDimensions();\r\n\r\n  const wrapperRef = useRef<View | null>(null);\r\n\r\n  const measureAndSetTooltip = useCallback(\r\n    (measurementId?: number) => {\r\n      wrapperRef.current?.measure((x, y, width, height, pageX, pageY) => {\r\n        switch (tooltipPositionType) {\r\n          case TooltipPositionType.DEFAULT:\r\n            if (pageY > screenDimensions.height / 2) {\r\n              tooltipContext.setTooltip(\r\n                props.tooltipId,\r\n                props.tooltip,\r\n                {\r\n                  left: pageX,\r\n                  containerWidth: width,\r\n                  bottom: screenDimensions.height - pageY + 4,\r\n                },\r\n                measurementId,\r\n              );\r\n            } else {\r\n              tooltipContext.setTooltip(\r\n                props.tooltipId,\r\n                props.tooltip,\r\n                {\r\n                  top: pageY + height + 4,\r\n                  left: pageX,\r\n                  containerWidth: width,\r\n                },\r\n                measurementId,\r\n              );\r\n            }\r\n            break;\r\n          case TooltipPositionType.RIGHT_OF_ELEMENT:\r\n            if (pageY > screenDimensions.height / 2) {\r\n              tooltipContext.setTooltip(\r\n                props.tooltipId,\r\n                props.tooltip,\r\n                {\r\n                  left: Math.min(\r\n                    pageX + width + 4,\r\n                    screenDimensions.width - 480,\r\n                  ),\r\n                  containerWidth: 30,\r\n                  bottom: Math.max(0, screenDimensions.height - pageY - height),\r\n                },\r\n                measurementId,\r\n              );\r\n            } else {\r\n              tooltipContext.setTooltip(\r\n                props.tooltipId,\r\n                props.tooltip,\r\n                {\r\n                  top: pageY,\r\n                  left: Math.min(\r\n                    pageX + width + 4,\r\n                    screenDimensions.width - 480,\r\n                  ),\r\n                  containerWidth: 30,\r\n                },\r\n                measurementId,\r\n              );\r\n            }\r\n            break;\r\n          case TooltipPositionType.LEFT_OF_ELEMENT:\r\n            if (pageY > screenDimensions.height / 2) {\r\n              tooltipContext.setTooltip(\r\n                props.tooltipId,\r\n                props.tooltip,\r\n                {\r\n                  right: screenDimensions.width - pageX + 4,\r\n                  containerWidth: 30,\r\n                  bottom: Math.max(0, screenDimensions.height - pageY - height),\r\n                },\r\n                measurementId,\r\n              );\r\n            } else {\r\n              tooltipContext.setTooltip(\r\n                props.tooltipId,\r\n                props.tooltip,\r\n                {\r\n                  top: pageY,\r\n                  right: screenDimensions.width - pageX + 4,\r\n                  containerWidth: 30,\r\n                },\r\n                measurementId,\r\n              );\r\n            }\r\n            break;\r\n        }\r\n      });\r\n    },\r\n    [\r\n      tooltipContext.setTooltip,\r\n      props.tooltip,\r\n      props.tooltipId,\r\n      wrapperRef,\r\n      screenDimensions.height,\r\n      tooltipPositionType,\r\n    ],\r\n  );\r\n\r\n  const onMouseOver = useCallback(() => {\r\n    const measurementId = Math.random();\r\n    tooltipContext.onMouseEnter(props.tooltipId, measurementId);\r\n    measureAndSetTooltip(measurementId);\r\n  }, [props.tooltipId, measureAndSetTooltip]);\r\n  const onMouseOut = useCallback(() => {\r\n    tooltipContext.onMouseLeave(props.tooltipId);\r\n  }, [props.tooltipId]);\r\n\r\n  useEffect(() => {\r\n    measureAndSetTooltip();\r\n  }, [measureAndSetTooltip]);\r\n\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      tooltipContext.onUnmountTooltip(props.tooltipId);\r\n    }\r\n  }, [visible, tooltipContext.clearTooltip, props.tooltipId]);\r\n\r\n  useEffect(() => {\r\n    if (props.tooltip == null) {\r\n      tooltipContext.clearTooltip(props.tooltipId);\r\n    }\r\n  }, [props.tooltip, props.tooltipId, tooltipContext.clearTooltip]);\r\n\r\n  useEffect(() => {\r\n    measureAndSetTooltip();\r\n    return () => tooltipContext.onUnmountTooltip(props.tooltipId);\r\n  }, [props.tooltipId]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        ref={wrapperRef}\r\n        style={[styles.tooltipWrapper, props.containerStyle]}\r\n        // @ts-expect-error React Native Web supports this\r\n        onMouseEnter={onMouseOver}\r\n        onMouseLeave={onMouseOut}\r\n      >\r\n        {props.children}\r\n      </View>\r\n    ),\r\n    [wrapperRef, props.children, props.containerStyle, onMouseOver, onMouseOut],\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  tooltipWrapper: {\r\n    alignSelf: \"stretch\",\r\n    flex: 1,\r\n  },\r\n});\r\n","import React, { useMemo, useState } from \"react\";\r\nimport { StyleSheet, TouchableOpacity, View } from \"react-native\";\r\nimport { Badge, useTheme } from \"react-native-paper\";\r\nimport { getThemeWithOverriddenOnError } from \"../../Themes\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { useAuxOptions } from \"../utility/AuxOptionsContext\";\r\nimport { TooltipWrapper } from \"../utility/Tooltip\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\n\r\nconst DOUBLE_TAP_THRESHOLD_MS = 500;\r\n\r\nfunction ItemTileNonMemoized(props: {\r\n  onPress?: () => void;\r\n  onDoublePress?: () => void;\r\n  title: string;\r\n  icon?: string;\r\n  amount?: number;\r\n  quality?: number;\r\n  disabled?: boolean;\r\n  tooltipIdSuffix?: string;\r\n  tooltip?: React.ReactNode;\r\n  borderColor?: string;\r\n}) {\r\n  const theme = useTheme();\r\n  const auxOptions = useAuxOptions();\r\n  const [lastTapTime, setLastTapTime] = useState(0);\r\n  const overriddenThemePrimary = getThemeWithOverriddenOnError(\r\n    theme,\r\n    theme.colors.onPrimary,\r\n  );\r\n  const overriddenThemeSecondary = getThemeWithOverriddenOnError(\r\n    theme,\r\n    theme.colors.onSecondary,\r\n  );\r\n  const inner = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.tile,\r\n          auxOptions.compactLayout && { height: 40, width: 40 },\r\n          { borderColor: props.borderColor ?? theme.colors.outlineVariant },\r\n        ]}\r\n      >\r\n        {props.icon && (\r\n          <GameIcon\r\n            style={props.disabled && { opacity: 0.2 }}\r\n            icon={props.icon}\r\n          />\r\n        )}\r\n        {props.quality != null && props.quality >= 1 && (\r\n          <Badge\r\n            style={{\r\n              position: \"absolute\",\r\n              opacity: props.disabled ? 0.2 : 1.0,\r\n              bottom: -8,\r\n              left: -8,\r\n              borderColor: theme.colors.background,\r\n              backgroundColor: theme.colors.secondary,\r\n            }}\r\n            theme={overriddenThemeSecondary}\r\n          >\r\n            {\"+\" + formatNumber(props.quality)}\r\n          </Badge>\r\n        )}\r\n        {props.amount != null && props.amount > 1 && (\r\n          <Badge\r\n            style={{\r\n              position: \"absolute\",\r\n              top: -8,\r\n              right: -8,\r\n              borderColor: theme.colors.background,\r\n              backgroundColor: theme.colors.primary,\r\n            }}\r\n            theme={overriddenThemePrimary}\r\n          >\r\n            {formatNumber(props.amount)}\r\n          </Badge>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      theme,\r\n      overriddenThemePrimary,\r\n      overriddenThemeSecondary,\r\n      props.icon,\r\n      props.amount,\r\n      props.disabled,\r\n      props.quality,\r\n      props.borderColor,\r\n      auxOptions.compactLayout,\r\n    ],\r\n  );\r\n  return useMemo(() => {\r\n    if (!props.onPress) {\r\n      return (\r\n        <TooltipWrapper\r\n          containerStyle={[\r\n            styles.tile,\r\n            auxOptions.compactLayout && { height: 40, width: 40 },\r\n            { flex: null, borderColor: theme.colors.outlineVariant },\r\n          ]}\r\n          tooltip={props.tooltip}\r\n          tooltipId={props.title + props.tooltipIdSuffix}\r\n        >\r\n          {inner}\r\n        </TooltipWrapper>\r\n      );\r\n    }\r\n    return (\r\n      <TooltipWrapper\r\n        containerStyle={[\r\n          styles.tile,\r\n          auxOptions.compactLayout && { height: 40, width: 40 },\r\n          { flex: null, borderColor: theme.colors.outlineVariant },\r\n        ]}\r\n        tooltip={props.tooltip}\r\n        tooltipId={props.title + props.tooltipIdSuffix}\r\n      >\r\n        <TouchableOpacity\r\n          accessibilityLabel={\r\n            props.title +\r\n            (props.amount && props.amount > 1 ? ` (${props.amount})` : \"\")\r\n          }\r\n          accessibilityRole=\"button\"\r\n          onPress={() => {\r\n            const currentTapTime = Date.now();\r\n            if (currentTapTime - lastTapTime < DOUBLE_TAP_THRESHOLD_MS) {\r\n              setLastTapTime(0);\r\n              props.onDoublePress && props.onDoublePress();\r\n            } else {\r\n              setLastTapTime(currentTapTime);\r\n              props.onPress && props.onPress();\r\n            }\r\n          }}\r\n        >\r\n          {inner}\r\n        </TouchableOpacity>\r\n      </TooltipWrapper>\r\n    );\r\n  }, [\r\n    props.title,\r\n    props.tooltip,\r\n    props.onPress,\r\n    props.onDoublePress,\r\n    lastTapTime,\r\n    setLastTapTime,\r\n    inner,\r\n    props.tooltipIdSuffix,\r\n    auxOptions.compactLayout,\r\n  ]);\r\n}\r\n\r\nexport const ItemTile = React.memo(\r\n  ItemTileNonMemoized,\r\n  (prevProps, nextProps) =>\r\n    prevProps.title == nextProps.title &&\r\n    prevProps.icon == nextProps.icon &&\r\n    prevProps.amount == nextProps.amount &&\r\n    prevProps.quality == nextProps.quality &&\r\n    prevProps.disabled == nextProps.disabled &&\r\n    prevProps.tooltipIdSuffix == nextProps.tooltipIdSuffix &&\r\n    prevProps.onPress == nextProps.onPress &&\r\n    prevProps.onDoublePress == nextProps.onDoublePress &&\r\n    prevProps.tooltip == nextProps.tooltip &&\r\n    prevProps.borderColor == nextProps.borderColor,\r\n);\r\n\r\nconst styles = StyleSheet.create({\r\n  tile: {\r\n    borderWidth: 0.5,\r\n    height: 48,\r\n    width: 48,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    margin: 8,\r\n  },\r\n});\r\n","import { cacheByTickCount } from \"../Caching\";\r\nimport { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport {\r\n  applyTransformationsPermaCached,\r\n  clearTransformationCache,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { Building } from \"./Building\";\r\n\r\nexport type BuildingData = {\r\n  current: number;\r\n  turnedOn: number;\r\n};\r\n\r\nconst Buildings = new DataStore<Building>();\r\n\r\nexport { Buildings };\r\n\r\nconst STARTING_LAND = 150;\r\n\r\nconst landCapTags = [TransformationTags.Land, TransformationTags.Cap];\r\nexport function getTotalLand(state: GameState): number {\r\n  return Math.floor(\r\n    applyTransformationsPermaCached(landCapTags, state, STARTING_LAND),\r\n  );\r\n}\r\n\r\nexport function clearLandCache(state: GameState): GameState {\r\n  return clearTransformationCache(new Set(landCapTags), state);\r\n}\r\n\r\nexport function getUsedLand(state: GameState): number {\r\n  return cacheByTickCount(state, \"usedLand\", (state) => {\r\n    let totalLand = 0;\r\n    Buildings.getAll().forEach(\r\n      (building) =>\r\n        (totalLand +=\r\n          building.getLandRequired(state) * getBuildingAmount(state, building)),\r\n    );\r\n    return totalLand;\r\n  });\r\n}\r\n\r\nexport function getFreeLand(state: GameState): number {\r\n  let totalLand = getTotalLand(state);\r\n  totalLand -= getUsedLand(state);\r\n  return Math.max(totalLand, 0);\r\n}\r\n\r\nexport function getBuildingAmount(\r\n  state: GameState,\r\n  building: Building,\r\n): number {\r\n  return state.run.buildings?.[building.getId()]?.current || 0;\r\n}\r\n\r\nexport function getBuildingAmountTurnedOn(\r\n  state: GameState,\r\n  building: Building,\r\n): number {\r\n  return state.run.buildings?.[building.getId()]?.turnedOn || 0;\r\n}\r\n\r\nexport function changeBuildingsTurnedOn(\r\n  building: Building,\r\n  amount: number,\r\n  state: GameState,\r\n): GameState {\r\n  const id = building.getId();\r\n\r\n  if (state.run.buildings?.[id] == null) {\r\n    state.run.buildings[id] = {\r\n      current: 0,\r\n      turnedOn: 0,\r\n    };\r\n  }\r\n\r\n  const newAmount = getBuildingAmountTurnedOn(state, building) + amount;\r\n  if (newAmount < 0 || newAmount > getBuildingAmount(state, building)) {\r\n    return state;\r\n  }\r\n  state.run.buildings[id].turnedOn = newAmount;\r\n\r\n  BuildingAmountListeners.getAll().forEach(\r\n    (transform) => (state = transform(state, building)),\r\n  );\r\n\r\n  return state;\r\n}\r\n\r\nexport const BuildingAmountListeners: DataStore<\r\n  (state: GameState, building: Building) => GameState\r\n> = new DataStore();\r\n","import memoize from \"sonic-memoize\";\r\nimport { keysOf, valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { cacheByArbitraryVersion, cacheByTickCount } from \"../Caching\";\r\nimport { hasWorldFlag } from \"../Flags\";\r\nimport { GameState, createHypotheticalState } from \"../GameState\";\r\nimport { Resource, getResourceCap } from \"../Resources\";\r\nimport { DoActionArgs } from \"../action/Action\";\r\nimport { ActionArea, ActionSubcategory } from \"../action/ActionAreas\";\r\nimport { SpellAutocastCategory } from \"../autocast/Autocast\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { Spell } from \"../spells/Spell\";\r\nimport { Spells } from \"../spells/Spells\";\r\nimport {\r\n  applyTransformationsCached,\r\n  applyTransformationsPermaCached,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport {\r\n  BuildingAmountListeners,\r\n  BuildingData,\r\n  getBuildingAmount,\r\n  getBuildingAmountTurnedOn,\r\n  getFreeLand,\r\n} from \"./Buildings\";\r\n\r\nexport abstract class Building implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getName(): string;\r\n  abstract getDisplayDescription(state: GameState): string;\r\n  abstract getDisplayEffect(state: GameState): string;\r\n  abstract canTurnOff(): boolean;\r\n  abstract getBaseLandRequired(): number;\r\n  landTags = [this.getId(), TransformationTags.LandCost];\r\n  getLandRequired(state: GameState): number {\r\n    const baseLandRequired = this.getBaseLandRequired();\r\n    const postTransform = applyTransformationsPermaCached(\r\n      this.landTags,\r\n      state,\r\n      baseLandRequired,\r\n    );\r\n    return postTransform;\r\n  }\r\n}\r\n\r\nexport abstract class BuildingSpell extends Spell {\r\n  abstract getBaseResourceCost(): Partial<Record<Resource, number>>;\r\n  abstract getBaseResourceScale(): Partial<Record<Resource, number>>;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  abstract getBuilding(): Building;\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.OTHER;\r\n  }\r\n\r\n  canAutoPurchaseMax(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    // Must populate by subclasses\r\n    return {};\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Build {{buildingName}}\", {\r\n      buildingName: this.getBuilding().getName(),\r\n    });\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    const amount = getBuildingAmount(state, this.getBuilding());\r\n    const buildingName = this.getBuilding().getName();\r\n    if (amount == 0) {\r\n      return buildingName;\r\n    }\r\n\r\n    if (this.canTurnOff()) {\r\n      const buildingAmountTurnedOn = getBuildingAmountTurnedOn(\r\n        state,\r\n        this.getBuilding(),\r\n      );\r\n      return t(\r\n        \"{{buildingName}} ({{buildingAmountTurnedOn}}/{{buildingAmount}})\",\r\n        {\r\n          buildingName,\r\n          buildingAmount: amount,\r\n          buildingAmountTurnedOn,\r\n        },\r\n      );\r\n    }\r\n    return t(\"{{buildingName}} ({{buildingAmount}})\", {\r\n      buildingName,\r\n      buildingAmount: getBuildingAmount(state, this.getBuilding()),\r\n    });\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return cacheByTickCount(state, this.getId() + \"cost\", (state) => ({\r\n      resources: this.getResourceCost(state),\r\n      items: {},\r\n    }));\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return ([TransformationTags.Building] as string[]).concat(super.getTags());\r\n  }\r\n\r\n  costTags = memoize((key) => [\r\n    ...this.getTags(),\r\n    TransformationTags.Cost,\r\n    key,\r\n  ]);\r\n  costScaleTags = memoize((key) => [\r\n    ...this.getTags(),\r\n    TransformationTags.CostScale,\r\n    key,\r\n  ]);\r\n\r\n  getResourceCost(state: GameState): Record<Resource, number> {\r\n    const currentAmount = getBuildingAmount(state, this.getBuilding());\r\n    const baseCost = this.getBaseResourceCost();\r\n    const scale = this.getBaseResourceScale();\r\n    const finalCost: Record<string, number> = {};\r\n    Object.keys(baseCost).forEach((key) => {\r\n      const baseCostForKey = applyTransformationsCached(\r\n        this.costTags(key),\r\n        state,\r\n        baseCost[key],\r\n      );\r\n      const costScaleForKey = applyTransformationsCached(\r\n        this.costScaleTags(key),\r\n        state,\r\n        scale[key] - 1,\r\n      );\r\n\r\n      finalCost[key] = Math.ceil(\r\n        baseCostForKey * Math.pow(1 + costScaleForKey, currentAmount),\r\n      );\r\n    });\r\n    return finalCost;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return this.getBuilding().canTurnOff();\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return this.getBuilding().getDisplayDescription(state);\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return this.getBuilding().getDisplayEffect(state);\r\n  }\r\n\r\n  getId(): string {\r\n    return \"build-\" + this.getBuilding().getId();\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    throw new Error(\"Not used in building spells\");\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    throw new Error(\"Not used in building spells\");\r\n  }\r\n\r\n  canAfford(state: GameState): boolean {\r\n    const canAffordLand =\r\n      getFreeLand(state) >= this.getBuilding().getLandRequired(state);\r\n    if (!canAffordLand) {\r\n      return false;\r\n    }\r\n    return super.canAfford(state);\r\n  }\r\n\r\n  isCapEnough(state: GameState): boolean {\r\n    const landRequirement = this.getBuilding().getLandRequired(state);\r\n    const freeLand = getFreeLand(state);\r\n\r\n    return super.isCapEnough(state) && landRequirement <= freeLand;\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    const id = this.getBuilding().getId();\r\n    state = this.payCost(state);\r\n    if (state.run.buildings?.[id] == null) {\r\n      state.run.buildings[id] = {\r\n        current: 0,\r\n        turnedOn: 0,\r\n      };\r\n    }\r\n    const buildingData = state.run.buildings[id] as BuildingData;\r\n    buildingData.current += 1;\r\n    buildingData.turnedOn =\r\n      getBuildingAmountTurnedOn(state, this.getBuilding()) + 1;\r\n    //((args.isAutomatic && this.canTurnOff()) ? 0 : 1);\r\n    if (buildingData.current > (state.world.maxFurnitureNumbers?.[id] ?? 0)) {\r\n      state.world.maxFurnitureNumbers[id] = buildingData.current;\r\n    }\r\n    BuildingAmountListeners.getAll().forEach(\r\n      (transform) => (state = transform(state, this.getBuilding())),\r\n    );\r\n    return state;\r\n  }\r\n\r\n  shouldNeverHaveDemolishBlockers(): boolean {\r\n    return true;\r\n  }\r\n\r\n  // If true, this building will never cause demolish blockers.\r\n  // Good for buildings like the Storage Expanders, which when demolished,\r\n  // can lower\r\n  shouldNotCountForDemolishBlockers(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getDemolishBlockers(state: GameState, amount: number): Building[] {\r\n    if (this.shouldNeverHaveDemolishBlockers()) {\r\n      return [];\r\n    }\r\n    return cacheByArbitraryVersion(\r\n      state,\r\n      this.getId() + \"demolishBlockers\",\r\n      (s) => {\r\n        let hypotheticalState = createHypotheticalState(s);\r\n\r\n        let blockerBuildings = [];\r\n        hypotheticalState = this._demolishUnsafe(hypotheticalState, amount);\r\n        // Remove 1 of every other building\r\n        for (let building of Spells.getAll().filter(\r\n          (spell) => spell instanceof BuildingSpell && spell != this,\r\n        ) as BuildingSpell[]) {\r\n          if (\r\n            getBuildingAmount(hypotheticalState, building.getBuilding()) > 0 &&\r\n            !building.shouldNotCountForDemolishBlockers()\r\n          ) {\r\n            hypotheticalState = building._demolishUnsafe(hypotheticalState, 1);\r\n            const resourceCost = building.getCost(hypotheticalState).resources;\r\n            for (let resource of keysOf(resourceCost)) {\r\n              if (\r\n                resourceCost[resource] >\r\n                  getResourceCap(hypotheticalState, resource) &&\r\n                resourceCost[resource] <= getResourceCap(state, resource)\r\n              ) {\r\n                blockerBuildings.push(building.getBuilding());\r\n                break;\r\n              }\r\n            }\r\n            hypotheticalState.run.buildings[\r\n              building.getBuilding().getId()\r\n            ].current += 1;\r\n          }\r\n        }\r\n\r\n        return blockerBuildings;\r\n      },\r\n      // This versioning function is not 100% correct, but it'll do in most cases\r\n      (s) =>\r\n        valuesOf(state.run.buildings)\r\n          .map((buildingData) => buildingData.current)\r\n          .reduce((prev, current, index) => prev + current * (index + 1), 0),\r\n    );\r\n  }\r\n\r\n  shouldHideDemolish(state: GameState): boolean {\r\n    return hasWorldFlag(state, \"storyline_blessedLand_bonus_active\");\r\n  }\r\n\r\n  canDemolish(state: GameState, amount: number): boolean {\r\n    return this.getDemolishBlockers(state, amount).length == 0;\r\n  }\r\n\r\n  _demolishUnsafe(state: GameState, amount: number): GameState {\r\n    const amountToDemolish = Math.min(\r\n      getBuildingAmount(state, this.getBuilding()),\r\n      amount,\r\n    );\r\n    const id = this.getBuilding().getId();\r\n    if (state.run.buildings?.[id] == null) {\r\n      state.run.buildings[id] = {\r\n        current: 0,\r\n        turnedOn: 0,\r\n      };\r\n    }\r\n    const buildingData = state.run.buildings[id] as BuildingData;\r\n    buildingData.current -= amountToDemolish;\r\n    buildingData.turnedOn -= Math.min(buildingData.turnedOn, amountToDemolish);\r\n    state.run.autoPurchaseActions[this.getId()] = false;\r\n    BuildingAmountListeners.getAll().forEach(\r\n      (transform) => (state = transform(state, this.getBuilding())),\r\n    );\r\n    return state;\r\n  }\r\n\r\n  demolish(state: GameState, amount: number): GameState {\r\n    if (!this.canDemolish(state, amount)) {\r\n      return state;\r\n    }\r\n    return this._demolishUnsafe(state, amount);\r\n  }\r\n}\r\n","import React, { useMemo } from \"react\";\r\nimport { StyleProp, View, ViewStyle } from \"react-native\";\r\nimport { Switch } from \"react-native-paper\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function CheckBox(props: {\r\n  title: string | React.ReactNode;\r\n  checked: boolean;\r\n  onPress: () => void;\r\n  containerStyle?: StyleProp<ViewStyle>;\r\n}) {\r\n  return useMemo(\r\n    () => (\r\n      <View style={[Styles.flexRowAlignCenter, props.containerStyle]}>\r\n        {typeof props.title == \"string\" ? (\r\n          <View style={Styles.flex}>\r\n            <Text>{props.title}</Text>\r\n          </View>\r\n        ) : (\r\n          props.title\r\n        )}\r\n        <Switch\r\n          style={Styles.ml8}\r\n          value={props.checked}\r\n          onValueChange={props.onPress}\r\n        />\r\n      </View>\r\n    ),\r\n    [props.title, props.checked, props.onPress, props.containerStyle],\r\n  );\r\n}\r\n","import React, { useContext } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { getTotalAmountOfItem } from \"../../backend/items/Inventory\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  getResourceInfo,\r\n  Resource,\r\n  translateResource,\r\n} from \"../../backend/Resources\";\r\nimport { formatNumber, RoundingMethod } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport { Text } from \"./Text\";\r\n\r\ntype Props = {\r\n  resources: Partial<Record<Resource, number>>;\r\n  items?: Record<string, number>;\r\n};\r\n\r\nfunction ResourceRow(props: {\r\n  name: string;\r\n  icon: string;\r\n  current: number;\r\n  cost: number;\r\n  cap: number;\r\n  switch?: boolean;\r\n}) {\r\n  const theme = useTheme();\r\n  return (\r\n    <View style={styles.row} accessible={true}>\r\n      <View style={styles.inlineRow}>\r\n        <GameIcon\r\n          icon={props.icon}\r\n          style={styles.icon}\r\n          small\r\n          accessibilityLabel=\"\"\r\n        />\r\n        <Text>{t(\"{{itemOrResource}}: \", { itemOrResource: props.name })}</Text>\r\n      </View>\r\n      {!props.switch ? (\r\n        <View style={styles.costValue}>\r\n          <Text\r\n            style={props.current < props.cost && { color: theme.colors.error }}\r\n          >\r\n            {formatNumber(props.current, {\r\n              showDecimals: true,\r\n              roundingMethod:\r\n                props.current >= props.cost\r\n                  ? RoundingMethod.UP\r\n                  : RoundingMethod.DEFAULT,\r\n            })}\r\n          </Text>\r\n          <Text>/</Text>\r\n          <Text style={props.cap < props.cost && { color: theme.colors.error }}>\r\n            {formatNumber(props.cost, {\r\n              showDecimals: false,\r\n              roundingMethod: RoundingMethod.UP,\r\n            })}\r\n          </Text>\r\n        </View>\r\n      ) : (\r\n        <View style={styles.costValue}>\r\n          <Text style={props.cap < props.cost && { color: theme.colors.error }}>\r\n            {formatNumber(props.cost, {\r\n              showDecimals: false,\r\n              roundingMethod: RoundingMethod.UP,\r\n            })}\r\n          </Text>\r\n          <Text>/</Text>\r\n          <Text\r\n            style={props.current < props.cost && { color: theme.colors.error }}\r\n          >\r\n            {formatNumber(props.current, {\r\n              showDecimals: true,\r\n              roundingMethod:\r\n                props.current >= props.cost\r\n                  ? RoundingMethod.UP\r\n                  : RoundingMethod.DEFAULT,\r\n            })}\r\n          </Text>\r\n        </View>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst ResourceRowMemo = React.memo(ResourceRow);\r\n\r\nexport { ResourceRowMemo as CostRow };\r\n\r\nexport function CostViewer(props: Props) {\r\n  const state = useContext(StateContext);\r\n  const resourceKeys = Object.keys(props.resources) as Array<Resource>;\r\n  const rows = resourceKeys.map((resourceName) => {\r\n    const resourceCost = props.resources[resourceName] as number;\r\n    const resourceCap = getResourceCap(state, resourceName);\r\n    const currentAmount = getResourceAmount(state, resourceName);\r\n    const resourceInfo = getResourceInfo(resourceName);\r\n    return (\r\n      <ResourceRowMemo\r\n        name={translateResource(resourceName)}\r\n        icon={resourceInfo.icon}\r\n        current={currentAmount}\r\n        cost={resourceCost}\r\n        cap={resourceCap}\r\n        key={resourceName}\r\n      />\r\n    );\r\n  });\r\n  const itemRows = props.items\r\n    ? Object.keys(props.items).map((itemId) => {\r\n        const itemCost = props?.items?.[itemId] as number;\r\n        const item = Items.getById(itemId);\r\n        const itemAmount = getTotalAmountOfItem(item, state);\r\n        return (\r\n          <ResourceRowMemo\r\n            name={item.getName(item.getDefaultParams())}\r\n            icon={item.getId()}\r\n            current={itemAmount}\r\n            cost={itemCost}\r\n            cap={1e10}\r\n            key={itemId}\r\n          />\r\n        );\r\n      })\r\n    : [];\r\n  return (\r\n    <View style={styles.container}>\r\n      {rows}\r\n      {itemRows}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  costValue: {\r\n    minWidth: 80,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  notMet: {\r\n    color: \"red\",\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport {\r\n  IconButton as PaperIconButton,\r\n  IconButtonProps,\r\n  useTheme,\r\n} from \"react-native-paper\";\r\n\r\nexport function IconButton(props: IconButtonProps) {\r\n  const theme = useTheme();\r\n  const disabled = props.disabled ?? false;\r\n  return (\r\n    <PaperIconButton\r\n      iconColor={\r\n        disabled ? theme.colors.onSurfaceDisabled : theme.colors.onPrimary\r\n      }\r\n      containerColor={\r\n        disabled ? theme.colors.surfaceDisabled : theme.colors.primary\r\n      }\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n","import React, { useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { Button } from \"./Button\";\r\nimport { IconButton } from \"./IconButton\";\r\n\r\ntype PlusMinusAllocatorProps = {\r\n  disableMinus: boolean;\r\n  disablePlus: boolean;\r\n  onPressMinus: () => void;\r\n  onPressPlus: () => void;\r\n};\r\n\r\nexport function PlusMinusAllocator(\r\n  props: PlusMinusAllocatorProps = {\r\n    disableMinus: false,\r\n    disablePlus: false,\r\n    onPressMinus: () => {},\r\n    onPressPlus: () => {},\r\n  },\r\n) {\r\n  const theme = useTheme();\r\n  const minusButton = useMemo(\r\n    () => (\r\n      <Button\r\n        enableAutoRepress={true}\r\n        passthroughStyle={styles.plusMinusAllocatorButton}\r\n        onPress={props.onPressMinus}\r\n        disabled={props.disableMinus}\r\n        compact={true}\r\n        autoRepressConfig={{\r\n          dropoffMultiplier: 0.8,\r\n          startingThreshold: 300,\r\n          startingRepressTime: 200,\r\n          minTimeMs: 50,\r\n        }}\r\n        mode=\"contained\"\r\n        size={20}\r\n        ButtonComponent={IconButton}\r\n        icon=\"minus\"\r\n      ></Button>\r\n    ),\r\n    [props.onPressMinus, props.disableMinus],\r\n  );\r\n  const plusButton = useMemo(\r\n    () => (\r\n      <Button\r\n        enableAutoRepress={true}\r\n        passthroughStyle={styles.plusMinusAllocatorButton}\r\n        onPress={props.onPressPlus}\r\n        disabled={props.disablePlus}\r\n        compact={true}\r\n        autoRepressConfig={{\r\n          dropoffMultiplier: 0.7,\r\n          startingThreshold: 300,\r\n          startingRepressTime: 150,\r\n          minTimeMs: 50,\r\n        }}\r\n        mode=\"contained\"\r\n        size={20}\r\n        ButtonComponent={IconButton}\r\n        icon=\"plus\"\r\n      ></Button>\r\n    ),\r\n    [props.onPressPlus, props.disablePlus],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        {minusButton}\r\n        {plusButton}\r\n      </View>\r\n    ),\r\n    [minusButton, plusButton],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  plusMinusAllocatorButton: {\r\n    height: 32,\r\n    width: 32,\r\n    // borderRadius: 16,\r\n    marginHorizontal: 4,\r\n    marginVertical: 0,\r\n    padding: 0,\r\n  },\r\n  plusMinusAllocatorButtonInner: {\r\n    paddingVertical: 0,\r\n    paddingHorizontal: 0,\r\n    marginVertical: 0,\r\n    marginHorizontal: 0,\r\n    height: 32,\r\n    width: 32,\r\n  },\r\n  plusMinusAllocatorIcon: {\r\n    height: 20,\r\n    width: 20,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n});\r\n","import { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  assignWizardsToRule,\r\n  estimateIntervalBetweenCastsForRule,\r\n  estimateManaConsumptionPerSecPerRule,\r\n  getAutocastRuleBySpell,\r\n  getAutocastStatusByRule,\r\n  getCurrentAutocastStrategy,\r\n  getFreeWizards,\r\n  toggleAutocastRuleDisabled,\r\n} from \"../../backend/autocast/Autocast\";\r\nimport { Spells } from \"../../backend/spells/Spells\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { PlusMinusAllocator } from \"./PlusMinusAllocator\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function SpellWizardsInfo(props: { spellId: string }) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const spell = Spells.getById(props.spellId);\r\n  const rule = getAutocastRuleBySpell(state, spell);\r\n\r\n  const ruleStatus = getAutocastStatusByRule(state, rule);\r\n  const intervalBetweenCasts = estimateIntervalBetweenCastsForRule(\r\n    state,\r\n    rule,\r\n    ruleStatus,\r\n  );\r\n  const manaCostPerSec = estimateManaConsumptionPerSecPerRule(\r\n    state,\r\n    rule,\r\n    ruleStatus,\r\n  );\r\n\r\n  const helperText = useMemo(\r\n    () =>\r\n      ruleStatus.wizardsAssigned > 0 && !ruleStatus.disabled\r\n        ? t(`*({{secs}}s/cast; {{mana}}:mana:/s)*`, {\r\n            secs: formatNumber(intervalBetweenCasts, { showDecimals: true }),\r\n            mana: formatNumber(manaCostPerSec, { showDecimals: true }),\r\n          })\r\n        : ruleStatus.disabled\r\n        ? t(\"(Disabled)\")\r\n        : \"\",\r\n    [\r\n      intervalBetweenCasts,\r\n      ruleStatus.wizardsAssigned,\r\n      ruleStatus.disabled,\r\n      manaCostPerSec,\r\n    ],\r\n  );\r\n\r\n  const wizardsAssignedComponent = useMemo(\r\n    () => (\r\n      <Markdown>\r\n        {t(\"Assign wizards {{helperText}}\", {\r\n          helperText,\r\n        })}\r\n      </Markdown>\r\n    ),\r\n    [helperText],\r\n  );\r\n\r\n  const onPressPlus = useCallback(\r\n    () =>\r\n      stateRef.current.apply((state) => {\r\n        const rule = getAutocastRuleBySpell(state, spell);\r\n        if (rule == null) {\r\n          // We must create a rule\r\n          const currentStrategy = getCurrentAutocastStrategy(state);\r\n          const newRule = {\r\n            id: Math.random().toString(),\r\n            disabled: false,\r\n            wizardsAssigned: 0,\r\n            spellId: props.spellId,\r\n            conditions: [],\r\n          };\r\n          currentStrategy.rules.push(newRule);\r\n          state.global.autocast.currentStrategy = currentStrategy;\r\n          state = assignWizardsToRule(state, newRule, 1);\r\n        } else {\r\n          state = assignWizardsToRule(state, rule, 1);\r\n          if (rule.disabled) {\r\n            state = toggleAutocastRuleDisabled(state, rule);\r\n          }\r\n        }\r\n        return state;\r\n      }),\r\n    [props.spellId],\r\n  );\r\n  const onPressMinus = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      const rule = getAutocastRuleBySpell(state, spell);\r\n      if (rule == null) {\r\n        return state;\r\n      }\r\n      state = assignWizardsToRule(state, rule, -1);\r\n      if (rule.disabled) {\r\n        state = toggleAutocastRuleDisabled(state, rule);\r\n      }\r\n      if (getAutocastStatusByRule(state, rule).wizardsAssigned <= 0) {\r\n        const currentStrategy = getCurrentAutocastStrategy(state);\r\n        currentStrategy.rules = currentStrategy.rules.filter(\r\n          (strategyRule) => rule != strategyRule,\r\n        );\r\n      }\r\n      return state;\r\n    });\r\n  }, [props.spellId]);\r\n\r\n  const allocator = useMemo(\r\n    () => (\r\n      <View style={[Styles.flexRowAlignCenter, Styles.ml8]}>\r\n        <View style={Styles.mr4}>\r\n          <Text>{ruleStatus.wizardsAssigned}</Text>\r\n        </View>\r\n        <PlusMinusAllocator\r\n          disableMinus={ruleStatus.wizardsAssigned <= 0}\r\n          disablePlus={getFreeWizards(state) <= 0}\r\n          onPressPlus={onPressPlus}\r\n          onPressMinus={onPressMinus}\r\n        />\r\n      </View>\r\n    ),\r\n    [\r\n      ruleStatus.wizardsAssigned,\r\n      getFreeWizards(state),\r\n      onPressPlus,\r\n      onPressMinus,\r\n    ],\r\n  );\r\n\r\n  return (\r\n    <View style={Styles.flexRowSpaceBetween}>\r\n      <View style={Styles.flex}>{wizardsAssignedComponent}</View>\r\n      {allocator}\r\n    </View>\r\n  );\r\n}\r\n","import { GameState, GameStateTransform } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\n\r\nexport const GameStartupListeners = new DataStore<GameStateTransform>();\r\n\r\nexport function runGameStartupListeners(state: GameState): GameState {\r\n  GameStartupListeners.getAll().forEach((listener) => {\r\n    state = listener(state);\r\n  });\r\n  return state;\r\n}\r\n","import { useCallback, useRef, useState } from \"react\";\r\nimport { StateContextValue } from \"../../backend/GameState\";\r\nimport { Actions } from \"../../backend/action/Actions\";\r\nimport {\r\n  SpellElement,\r\n  getUnlockedElements,\r\n} from \"../../backend/spells/Elements\";\r\nimport { GameStartupListeners } from \"../../backend/spells/GameStartup\";\r\nimport { keysOf } from \"../../utils/CoreUtils\";\r\n\r\nexport function useExpandedUIFromContext(\r\n  state: StateContextValue,\r\n  key: string,\r\n  defaultValue: boolean,\r\n): [boolean, (value: boolean) => void] {\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const currentValue = state.options.saveExpandedUI\r\n    ? state.options.expandedUI[key] ?? defaultValue\r\n    : defaultValue;\r\n  const [stateValue, setStateValue] = useState(currentValue);\r\n  const setCurrentValue = useCallback(\r\n    (value: boolean) => {\r\n      setStateValue(value);\r\n      stateRef.current.apply((s) => {\r\n        s.options.expandedUI[key] = value;\r\n        return s;\r\n      });\r\n    },\r\n    [key, setStateValue],\r\n  );\r\n\r\n  return [stateValue, setCurrentValue];\r\n}\r\n\r\nGameStartupListeners.register((state) => {\r\n  for (let key of keysOf(state.options.expandedUI)) {\r\n    const action = Actions.getByIdNullable(key);\r\n    if (action && !action.isVisible) {\r\n      state.options.expandedUI[key] = false;\r\n    }\r\n    if (key.startsWith(\"study:\")) {\r\n      const element = key.split(\":\")[1];\r\n      if (!getUnlockedElements(state).includes(element as SpellElement)) {\r\n        state.options.expandedUI[key] = false;\r\n      }\r\n    }\r\n  }\r\n  return state;\r\n}, \"expandedUI\");\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport {\r\n  Platform,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { Action } from \"../../backend/action/Action\";\r\nimport { isAutoPurchaseUnlocked } from \"../../backend/action/Actions\";\r\nimport { isAutocastUnlocked } from \"../../backend/autocast/Autocast\";\r\nimport { BuildingSpell } from \"../../backend/buildings/Building\";\r\nimport {\r\n  changeBuildingsTurnedOn,\r\n  getBuildingAmount,\r\n  getBuildingAmountTurnedOn,\r\n  getFreeLand,\r\n} from \"../../backend/buildings/Buildings\";\r\nimport { Spell } from \"../../backend/spells/Spell\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { useAuxOptions } from \"./AuxOptionsContext\";\r\nimport { Button } from \"./Button\";\r\nimport { CheckBox } from \"./CheckBox\";\r\nimport { CostRow, CostViewer } from \"./CostViewer\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { DescriptionViewer } from \"./Miscellaneous\";\r\nimport { PlusMinusAllocator } from \"./PlusMinusAllocator\";\r\nimport { SpellWizardsInfo } from \"./SpellWizardsInfo\";\r\nimport { useExpandedUIFromContext } from \"./StatePersistedExpandedUI\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\nimport { TooltipPositionType, TooltipWrapper } from \"./Tooltip\";\r\nimport { VisibilityContext } from \"./VisibilityContext\";\r\n\r\nexport function ActionContainer(props: { action: Action }) {\r\n  const theme = useTheme();\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const action = props.action;\r\n  const cost = action.getCost(state);\r\n  const isFree =\r\n    Object.keys(cost.resources).length === 0 &&\r\n    Object.keys(cost.items).length === 0;\r\n  const canTurnOff = action instanceof BuildingSpell && action.canTurnOff();\r\n  const buildingAmount =\r\n    action instanceof BuildingSpell &&\r\n    getBuildingAmount(state, action.getBuilding());\r\n  const buildingAmountOn =\r\n    action instanceof BuildingSpell &&\r\n    getBuildingAmountTurnedOn(state, action.getBuilding());\r\n  const landRequirement =\r\n    action instanceof BuildingSpell\r\n      ? action.getBuilding().getLandRequired(state)\r\n      : null;\r\n  const freeLand = getFreeLand(state);\r\n  const capIsEnough = action.isCapEnough(state);\r\n\r\n  const [expanded, setExpanded] = useExpandedUIFromContext(\r\n    state,\r\n    action.getId(),\r\n    false,\r\n  );\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    const descriptionContents = `${action.getDisplayDescription(\r\n      state,\r\n    )} **${action.getDisplayEffect(state)}**`;\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        <DescriptionViewer style={Styles.flex}>\r\n          {descriptionContents}\r\n        </DescriptionViewer>\r\n      </View>\r\n    );\r\n  }, [\r\n    (expanded || Platform.OS === \"web\") && action.getDisplayDescription(state),\r\n    (expanded || Platform.OS === \"web\") && action.getDisplayEffect(state),\r\n  ]);\r\n\r\n  const landContainer = useMemo(() => {\r\n    if (!landRequirement) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <View style={styles.costContainer}>\r\n        <Markdown>{t(\"Land required:\")}</Markdown>\r\n        <View style={Styles.mt4}>\r\n          <CostRow\r\n            cap={freeLand}\r\n            current={freeLand}\r\n            cost={landRequirement}\r\n            icon=\"land\"\r\n            name={t(\"Land\")}\r\n            switch={true}\r\n          />\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [landRequirement, freeLand]);\r\n\r\n  const costContainer = useMemo(() => {\r\n    return (\r\n      <View style={styles.costContainer}>\r\n        <Markdown>{t(\"Cost:\")}</Markdown>\r\n        <View style={Styles.mt4}>\r\n          <CostViewer\r\n            resources={action.getCost(state).resources}\r\n            items={action.getCost(state).items}\r\n          />\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [(expanded || Platform.OS === \"web\") && JSON.stringify(cost)]);\r\n\r\n  const onPressMinus = useCallback(\r\n    () =>\r\n      stateRef.current.apply((s) =>\r\n        changeBuildingsTurnedOn((action as BuildingSpell).getBuilding(), -1, s),\r\n      ),\r\n    [action],\r\n  );\r\n  const onPressPlus = useCallback(\r\n    () =>\r\n      stateRef.current.apply((s) =>\r\n        changeBuildingsTurnedOn((action as BuildingSpell).getBuilding(), 1, s),\r\n      ),\r\n    [action],\r\n  );\r\n\r\n  const turnOffContainer = useMemo(() => {\r\n    if (!canTurnOff) {\r\n      return null;\r\n    }\r\n    const amountActiveText = `${buildingAmountOn}/${buildingAmount}`;\r\n    return (\r\n      <View style={styles.turnOnRow}>\r\n        <Markdown>{t(\"Amount active:\")}</Markdown>\r\n        <View style={styles.turnOnQuantityContainer}>\r\n          <Markdown>{amountActiveText}</Markdown>\r\n          <View style={styles.plusMinusContainer}>\r\n            <PlusMinusAllocator\r\n              disableMinus={buildingAmountOn === 0}\r\n              disablePlus={buildingAmountOn === buildingAmount}\r\n              onPressMinus={onPressMinus}\r\n              onPressPlus={onPressPlus}\r\n            />\r\n          </View>\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [canTurnOff, buildingAmount, buildingAmountOn, onPressMinus, onPressPlus]);\r\n\r\n  const demolish = useCallback(\r\n    () =>\r\n      stateRef.current.apply((s) => (action as BuildingSpell).demolish(s, 1)),\r\n    [action],\r\n  );\r\n\r\n  const demolishBlockers = useMemo(\r\n    () =>\r\n      action instanceof BuildingSpell\r\n        ? action.getDemolishBlockers(state, 1)\r\n        : [],\r\n    [expanded && state, action],\r\n  );\r\n\r\n  const canDemolish = useMemo(\r\n    () =>\r\n      action instanceof BuildingSpell ? action.canDemolish(state, 1) : true,\r\n    [expanded && state, action],\r\n  );\r\n\r\n  const demolishContainer = useMemo(() => {\r\n    if (\r\n      buildingAmount &&\r\n      buildingAmount > 0 &&\r\n      landRequirement != null &&\r\n      landRequirement > 0 &&\r\n      !action.shouldHideDemolish(state)\r\n    ) {\r\n      return (\r\n        <View style={Styles.mt8}>\r\n          <Button\r\n            mode=\"outlined\"\r\n            compact={true}\r\n            onPress={demolish}\r\n            enableAutoRepress={action.canSpam()}\r\n            disabled={!canDemolish}\r\n            style={[Styles.alignSelfNormal, Styles.mt4]}\r\n          >\r\n            {t(\"Dispose of 1 (+{{land}} Land)\", { land: landRequirement })}\r\n          </Button>\r\n          {demolishBlockers.length > 0 && (\r\n            <View style={Styles.mt4}>\r\n              <Text style={{ color: theme.colors.error }}>\r\n                {t(\r\n                  \"You may not dispose of this furniture because without it you wouldn't have been able to build the following furniture: {{furnitureList}}. To dispose of it, dispose of those other furniture first.\",\r\n                  {\r\n                    furnitureList: demolishBlockers\r\n                      .map((blocker) => blocker.getName())\r\n                      .join(t(\", \")),\r\n                  },\r\n                )}\r\n              </Text>\r\n            </View>\r\n          )}\r\n        </View>\r\n      );\r\n    }\r\n    return null;\r\n  }, [\r\n    buildingAmount,\r\n    landRequirement,\r\n    theme,\r\n    demolish,\r\n    demolishBlockers.map((building) => building.getId()).join(),\r\n    action instanceof BuildingSpell && action.shouldHideDemolish(state),\r\n    action.canSpam(),\r\n  ]);\r\n\r\n  const id = action.getId();\r\n  const canAutoPurchase =\r\n    isAutoPurchaseUnlocked(state) && action.canAutoPurchaseMax();\r\n  const isAutoPurchaseEnabled = state.run.autoPurchaseActions?.[id];\r\n  const autoPurchaseEnabledToggle = useCallback(\r\n    () =>\r\n      stateRef.current.apply((state) => {\r\n        state.run.autoPurchaseActions[id] = !(\r\n          state.run.autoPurchaseActions[id] ?? false\r\n        );\r\n        return state;\r\n      }),\r\n    [id],\r\n  );\r\n\r\n  const autoPurchaseContainer = useMemo(\r\n    () =>\r\n      canAutoPurchase ? (\r\n        <CheckBox\r\n          title={t(\"Auto purchase max\")}\r\n          checked={isAutoPurchaseEnabled}\r\n          onPress={autoPurchaseEnabledToggle}\r\n          containerStyle={Styles.mt4}\r\n        />\r\n      ) : null,\r\n    [canAutoPurchase, isAutoPurchaseEnabled, autoPurchaseEnabledToggle],\r\n  );\r\n\r\n  const disabled = !action.isEnabled(state);\r\n\r\n  const [preConfirmation, setPreConfirmation] = useState(false);\r\n\r\n  const visible = useContext(VisibilityContext);\r\n\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setPreConfirmation(false);\r\n    }\r\n  }, [visible]);\r\n\r\n  const onPressCallback = useCallback(() => {\r\n    if (action.requireConfirmation(state) && !preConfirmation) {\r\n      setPreConfirmation(true);\r\n    } else {\r\n      stateRef.current.apply(\r\n        action.doAction.bind(action, { isAutomatic: false }),\r\n      );\r\n      setPreConfirmation(false);\r\n    }\r\n  }, [preConfirmation]);\r\n\r\n  const isAutoPurchasing = state.run.autoPurchaseActions[action.getId()];\r\n\r\n  const onPressExpand = useCallback(\r\n    () => setExpanded(!expanded),\r\n    [setExpanded, expanded],\r\n  );\r\n\r\n  const auxOptions = useAuxOptions();\r\n\r\n  const button = useMemo(\r\n    () => (\r\n      <TooltipWrapper\r\n        tooltip={\r\n          !expanded ? (\r\n            <View>\r\n              {descriptionContainer}\r\n              {landContainer}\r\n              {!isFree && costContainer}\r\n            </View>\r\n          ) : undefined\r\n        }\r\n        tooltipId={action.getId() + \"actioncontainer\"}\r\n        tooltipPosition={TooltipPositionType.RIGHT_OF_ELEMENT}\r\n      >\r\n        <Button\r\n          key={action.getId()}\r\n          onPress={onPressCallback}\r\n          enableAutoRepress={true}\r\n          style={styles.buttonContainer}\r\n          labelStyle={!capIsEnough && { textDecorationLine: \"line-through\" }}\r\n          disabled={disabled}\r\n        >\r\n          {preConfirmation\r\n            ? t(\"Press again to confirm\")\r\n            : t(\"{{actionName}}{{autoPurchase}}\", {\r\n                actionName: action.getDisplayName(state),\r\n                autoPurchase: isAutoPurchasing ? t(\" (A)\") : \"\",\r\n              })}\r\n        </Button>\r\n      </TooltipWrapper>\r\n    ),\r\n    [\r\n      id,\r\n      action.getDisplayName(state),\r\n      capIsEnough,\r\n      disabled,\r\n      onPressCallback,\r\n      descriptionContainer,\r\n      isFree,\r\n      landContainer,\r\n      costContainer,\r\n      expanded,\r\n      preConfirmation,\r\n      isAutoPurchasing,\r\n    ],\r\n  );\r\n\r\n  // Hack *only* for channeling spells\r\n  const showWizards =\r\n    action instanceof Spell && !(action instanceof BuildingSpell);\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View\r\n        style={[\r\n          styles.actionContainer,\r\n          auxOptions.compactLayout && { marginVertical: 4 },\r\n        ]}\r\n        key={action.getId()}\r\n      >\r\n        <View style={styles.buttonRowContainer}>\r\n          <View style={styles.buttonContainerView}>{button}</View>\r\n          <TouchableWithoutFeedback\r\n            onPress={onPressExpand}\r\n            accessibilityLabel={!expanded ? \"Expand\" : \"Collapse\"}\r\n          >\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={!expanded ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.colors.onBackground}\r\n              />\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n        </View>\r\n        {expanded && (\r\n          <View style={[Styles.mt8, Styles.mb8]}>\r\n            <View style={Styles.mt8}>{descriptionContainer}</View>\r\n            {landContainer}\r\n            {!isFree && costContainer}\r\n            {canTurnOff && turnOffContainer}\r\n            {autoPurchaseContainer}\r\n            {demolishContainer}\r\n            {showWizards && isAutocastUnlocked(state) ? (\r\n              <View style={Styles.mt4}>\r\n                <SpellWizardsInfo spellId={action.getId()} />\r\n              </View>\r\n            ) : null}\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    button,\r\n    id,\r\n    disabled,\r\n    canTurnOff,\r\n    turnOffContainer,\r\n    auxOptions.compactLayout,\r\n    expanded && costContainer,\r\n    expanded && descriptionContainer,\r\n    expanded && demolishContainer,\r\n    expanded && autoPurchaseContainer,\r\n    expanded,\r\n    onPressExpand,\r\n    theme,\r\n    isAutocastUnlocked(state),\r\n    showWizards,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  actionContainer: { marginVertical: 8 },\r\n  buttonRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  quickbarButtonContainer: {\r\n    marginLeft: 8,\r\n  },\r\n  expandContainer: {\r\n    width: 64,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    alignSelf: \"stretch\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  costContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 4,\r\n  },\r\n  descriptionTextContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  buttonTitle: {\r\n    fontSize: 16,\r\n    textAlign: \"center\",\r\n    paddingVertical: 1,\r\n    ...Platform.select({\r\n      android: {\r\n        fontFamily: \"sans-serif-medium\",\r\n      },\r\n      default: {\r\n        fontSize: 18,\r\n      },\r\n    }),\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  buttonContainerView: {\r\n    flexDirection: \"row\",\r\n    flex: 1,\r\n  },\r\n  buttonContainer: {\r\n    flex: 1,\r\n  },\r\n  buttonContainerSmall: {\r\n    marginRight: 0,\r\n  },\r\n  capTooLowText: {\r\n    color: \"#d99\",\r\n  },\r\n  turnOnRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginTop: 8,\r\n  },\r\n  turnOnQuantityContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusContainer: {\r\n    marginLeft: 8,\r\n  },\r\n  spellButtonTitleContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n  },\r\n  spellButtonTitleOnlyContainer: {\r\n    flex: 1,\r\n  },\r\n  spellButtonCostContainer: {\r\n    flexDirection: \"row\",\r\n    width: 40,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  spellManaIcon: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    top: 1,\r\n    marginLeft: 2,\r\n  },\r\n  marginTop: {\r\n    marginTop: 8,\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { Divider as PaperDivider } from \"react-native-paper\";\r\n\r\nexport default function Divider(props: any) {\r\n  return <PaperDivider {...props} />;\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { ThemeProvider, useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { VisibilityContext } from \"./VisibilityContext\";\r\n\r\nexport function GameStateFreezer(props: { isVisible: boolean; children: any }) {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n  return useMemo(() => {\r\n    return (\r\n      <VisibilityContext.Provider value={props.isVisible}>\r\n        <StateContext.Provider value={state}>\r\n          {\r\n            // @ts-ignore Seems to work\r\n            <ThemeProvider theme={theme}>{props.children}</ThemeProvider>\r\n          }\r\n        </StateContext.Provider>\r\n      </VisibilityContext.Provider>\r\n    );\r\n  }, [\r\n    props.isVisible ? state.global.tickCount : false,\r\n    props.isVisible ? props.children : false,\r\n    props.isVisible ? theme : false,\r\n  ]);\r\n}\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, { useCallback, useContext, useMemo, useState } from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport Divider from \"./Divider\";\r\nimport { GameStateFreezer } from \"./GameStateFreezer\";\r\nimport { Text } from \"./Text\";\r\nimport { VisibilityContext } from \"./VisibilityContext\";\r\n\r\ntype CategoryContainerProps = {\r\n  title: string;\r\n  titleStyle?: any;\r\n  containerStyle?: any;\r\n  contentContainerStyle?: any;\r\n  children: any;\r\n  initiallyExpanded?: boolean;\r\n  dividerColor?: string;\r\n};\r\n\r\nexport function CategoryHeader(\r\n  props: Omit<CategoryContainerProps, \"children\">,\r\n) {\r\n  return (\r\n    <View style={[styles.category, props.containerStyle]}>\r\n      <Text style={[styles.categoryTitle, props.titleStyle]} h4>\r\n        {props.title}\r\n      </Text>\r\n      <Divider\r\n        style={[\r\n          styles.categoryDivider,\r\n          props.dividerColor && { backgroundColor: props.dividerColor },\r\n        ]}\r\n      />\r\n    </View>\r\n  );\r\n}\r\n\r\nexport default function CategoryContainer(props: CategoryContainerProps) {\r\n  const [isExpanded, setExpanded] = useState(props.initiallyExpanded ?? true);\r\n  const theme = useTheme();\r\n\r\n  const visible = useContext(VisibilityContext);\r\n\r\n  const setExpandedCallback = useCallback(() => {\r\n    setExpanded(!isExpanded);\r\n  }, [setExpanded, isExpanded]);\r\n\r\n  const accessibilityLabel = isExpanded\r\n    ? t(\"{{title}}, Expanded - Press to Collapse\", { title: props.title })\r\n    : t(\"{{title}}, Collapsed - Press to Expand\");\r\n\r\n  const containerStyle = useMemo(\r\n    () => [styles.category, props.containerStyle],\r\n    [props.containerStyle],\r\n  );\r\n  const titleStyle = useMemo(\r\n    () => [styles.categoryTitle, props.titleStyle],\r\n    [props.titleStyle],\r\n  );\r\n  const contentContainerStyle = useMemo(\r\n    () => [\r\n      { display: isExpanded ? \"flex\" : \"none\" },\r\n      props.contentContainerStyle,\r\n    ],\r\n    [isExpanded, props.contentContainerStyle],\r\n  );\r\n  const dividerStyle = useMemo(\r\n    () => [\r\n      styles.categoryDivider,\r\n      props.dividerColor && { backgroundColor: props.dividerColor },\r\n    ],\r\n    [props.dividerColor],\r\n  );\r\n\r\n  const header = useMemo(\r\n    () => (\r\n      <View>\r\n        <TouchableWithoutFeedback\r\n          onPress={setExpandedCallback}\r\n          accessibilityRole=\"header\"\r\n          accessibilityLabel={accessibilityLabel}\r\n        >\r\n          <View style={styles.categoryHeaderExpand}>\r\n            <Text style={titleStyle} h4>\r\n              {props.title}\r\n            </Text>\r\n            <Entypo\r\n              name={isExpanded ? \"chevron-down\" : \"chevron-right\"}\r\n              size={24}\r\n              color={theme.colors.onBackground}\r\n            />\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        <Divider style={dividerStyle} />\r\n      </View>\r\n    ),\r\n    [\r\n      accessibilityLabel,\r\n      setExpandedCallback,\r\n      titleStyle,\r\n      props.title,\r\n      isExpanded,\r\n      theme,\r\n      dividerStyle,\r\n    ],\r\n  );\r\n\r\n  return (\r\n    <View style={containerStyle}>\r\n      {header}\r\n      <GameStateFreezer isVisible={isExpanded && visible}>\r\n        <View style={contentContainerStyle}>{props.children}</View>\r\n      </GameStateFreezer>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  category: { paddingTop: 16 },\r\n  categoryTitle: { fontWeight: \"bold\" },\r\n  categoryDivider: { height: StyleSheet.hairlineWidth * 2 },\r\n  categoryHeader: {\r\n    height: 26,\r\n  },\r\n  categoryHeaderExpand: {\r\n    height: 26,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  translateActionSubcategory,\r\n} from \"../../backend/action/ActionAreas\";\r\nimport { getVisibleActionsForAreaBySubcategory } from \"../../backend/action/Actions\";\r\nimport { idOf } from \"../../backend/generic/Identifiable\";\r\nimport { ActionContainer } from \"./ActionContainer\";\r\nimport CategoryContainer from \"./CategoryContainer\";\r\n\r\ntype ActionsContainerProps = {\r\n  area: ActionArea;\r\n};\r\n\r\nfunction ActionSubcategoryContainer(\r\n  props: ActionsContainerProps & {\r\n    subcategory: ActionSubcategories;\r\n  },\r\n) {\r\n  const state = useContext(StateContext);\r\n  const actionsBySubcategory = getVisibleActionsForAreaBySubcategory(\r\n    state,\r\n    props.area,\r\n  );\r\n  const subcategory = props.subcategory;\r\n  const actions = actionsBySubcategory[subcategory] ?? [];\r\n  const actionNamesStr = actions.map(idOf).join(\",\");\r\n\r\n  const actionContainers = useMemo(() => {\r\n    return actions.map((action) => {\r\n      return <ActionContainer key={action.getId()} action={action} />;\r\n    });\r\n  }, [actionNamesStr]);\r\n\r\n  return useMemo(() => {\r\n    if (actions.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <CategoryContainer\r\n        title={translateActionSubcategory(subcategory)}\r\n        key={subcategory}\r\n      >\r\n        <View style={styles.underCategoryPadding} />\r\n        <View key={actions[0].getId()}>{actionContainers[0]}</View>\r\n        {actionContainers.slice(1).map((actionContainer, idx) => {\r\n          return <View key={actions[idx + 1].getId()}>{actionContainer}</View>;\r\n        })}\r\n      </CategoryContainer>\r\n    );\r\n  }, [actionContainers, subcategory]);\r\n}\r\n\r\nexport default function ActionsContainer(props: ActionsContainerProps) {\r\n  const actionCategories = Object.values(ActionSubcategories).map(\r\n    (subcategory) => (\r\n      <ActionSubcategoryContainer\r\n        {...props}\r\n        subcategory={subcategory}\r\n        key={subcategory}\r\n      />\r\n    ),\r\n  );\r\n\r\n  return <View>{actionCategories}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  underCategoryPadding: {\r\n    height: 8,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { ActionArea } from \"../backend/action/ActionAreas\";\r\nimport {\r\n  getBoostsBonusText,\r\n  hasBoosts,\r\n} from \"../backend/boost/BoostActionBase\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { ItemTile } from \"./inventory/ItemTile\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport Styles from \"./utility/Styles\";\r\n\r\nexport default function Boosts() {\r\n  const state = useContext(StateContext);\r\n  const bonusText = getBoostsBonusText(state);\r\n  const playerHasBoosts = hasBoosts(state);\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.campusContainer}>\r\n        <View style={Styles.flexRowAlignCenter}>\r\n          <ItemTile icon=\"boosts\" title={t(\"Boosts\")} />\r\n          <View style={Styles.flex}>\r\n            <Markdown>\r\n              {playerHasBoosts\r\n                ? t(\r\n                    \"You are attuned to the Boosting Lamp. It is giving you the following bonuses: **{{bonusText}}**\",\r\n                    { bonusText },\r\n                  )\r\n                : t(\"You are attuned to the Boosting Lamp.\")}\r\n            </Markdown>\r\n          </View>\r\n        </View>\r\n        <ActionsContainer area={ActionArea.BOOST} />\r\n      </View>\r\n    ),\r\n    [playerHasBoosts, bonusText],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  campusContainer: {\r\n    height: \"100%\",\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import { ImageSourcePropType } from \"react-native\";\r\n\r\nexport function sanitizeImageSourceForElectron(\r\n  imageSource?: ImageSourcePropType,\r\n): ImageSourcePropType {\r\n  // @ts-ignore This is done on purpose as it is not really a RN source\r\n  if (imageSource?.default != null) {\r\n    // @ts-ignore This is done on purpose as it is not really a RN source\r\n    return imageSource.default;\r\n  }\r\n  // @ts-ignore Also done on purpose as it can be undefined, but we swallow it\r\n  return imageSource;\r\n}\r\n","import { LinearGradient } from \"expo-linear-gradient\";\r\nimport React from \"react\";\r\nimport { Image, ImageSourcePropType, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { sanitizeImageSourceForElectron } from \"../utility/icons/IconUtils\";\r\n\r\nexport function EnemySpriteTile(props: {\r\n  sprite?: ImageSourcePropType;\r\n  backdropColor?: string | false;\r\n}) {\r\n  const LinearGradientComponent = LinearGradient;\r\n  const theme = useTheme();\r\n  let sprite = sanitizeImageSourceForElectron(props.sprite);\r\n  return (\r\n    <View style={[styles.tile, { borderColor: theme.colors.outlineVariant }]}>\r\n      {props.backdropColor && (\r\n        <LinearGradientComponent\r\n          colors={[`${props.backdropColor}`, `${props.backdropColor}0`]}\r\n          style={styles.gradient}\r\n        />\r\n      )}\r\n      {sprite && (\r\n        <Image resizeMode=\"contain\" source={sprite} style={styles.image} />\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tile: {\r\n    borderWidth: StyleSheet.hairlineWidth,\r\n    height: 144,\r\n    width: 144,\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  image: {\r\n    height: 142,\r\n    width: 142,\r\n  },\r\n  gradient: {\r\n    height: 142,\r\n    width: 142,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n    opacity: 0.2,\r\n  },\r\n});\r\n","import { Dimensions, LayoutRectangle } from 'react-native';\r\n\r\ntype ChildrenMeasurement = {\r\n  width: number;\r\n  height: number;\r\n  pageX: number;\r\n  pageY: number;\r\n};\r\n\r\ntype TooltipLayout = LayoutRectangle;\r\n\r\nexport type Measurement = {\r\n  children: ChildrenMeasurement;\r\n  tooltip: TooltipLayout;\r\n  measured: boolean;\r\n};\r\n\r\n/**\r\n * Return true when the tooltip center x-coordinate relative to the wrapped element is negative.\r\n * The tooltip will be placed at the starting x-coordinate from the wrapped element.\r\n */\r\nconst overflowLeft = (center: number): boolean => {\r\n  return center < 0;\r\n};\r\n\r\n/**\r\n * Return true when the tooltip center x-coordinate + tooltip width is greater than the layout width\r\n * The tooltip width will grow from right to left relative to the wrapped element.\r\n */\r\nconst overflowRight = (center: number, tooltipWidth: number): boolean => {\r\n  const { width: layoutWidth } = Dimensions.get('window');\r\n\r\n  return center + tooltipWidth > layoutWidth;\r\n};\r\n\r\n/**\r\n * Return true when the children y-coordinate + its height + tooltip height is greater than the layout height.\r\n * The tooltip will be placed at the top of the wrapped element.\r\n */\r\nconst overflowBottom = (\r\n  childrenY: number,\r\n  childrenHeight: number,\r\n  tooltipHeight: number\r\n): boolean => {\r\n  const { height: layoutHeight } = Dimensions.get('window');\r\n\r\n  return childrenY + childrenHeight + tooltipHeight > layoutHeight;\r\n};\r\n\r\nconst getTooltipXPosition = (\r\n  { pageX: childrenX, width: childrenWidth }: ChildrenMeasurement,\r\n  { width: tooltipWidth }: TooltipLayout\r\n): number => {\r\n  const center = childrenX + (childrenWidth - tooltipWidth) / 2;\r\n\r\n  if (overflowLeft(center)) return childrenX;\r\n\r\n  if (overflowRight(center, tooltipWidth))\r\n    return childrenX + childrenWidth - tooltipWidth;\r\n\r\n  return center;\r\n};\r\n\r\nconst getTooltipYPosition = (\r\n  { pageY: childrenY, height: childrenHeight }: ChildrenMeasurement,\r\n  { height: tooltipHeight }: TooltipLayout\r\n): number => {\r\n  if (overflowBottom(childrenY, childrenHeight, tooltipHeight))\r\n    return childrenY - tooltipHeight;\r\n\r\n  return childrenY + childrenHeight;\r\n};\r\n\r\nexport const getTooltipPosition = ({\r\n  children,\r\n  tooltip,\r\n  measured,\r\n}: Measurement): {} | { left: number; top: number } => {\r\n  if (!measured) return {};\r\n\r\n  return {\r\n    left: getTooltipXPosition(children, tooltip),\r\n    top: getTooltipYPosition(children, tooltip),\r\n  };\r\n};\r\n","import * as React from \"react\";\r\nimport {\r\n  Dimensions,\r\n  LayoutChangeEvent,\r\n  Platform,\r\n  Pressable,\r\n  StyleSheet,\r\n  View,\r\n  ViewStyle,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\n\r\nimport type { ThemeProp } from \"react-native-paper/lib/typescript/src/types\";\r\n\r\nimport { Portal, Surface, useTheme } from \"react-native-paper\";\r\nimport { Markdown } from \"../Markdown\";\r\nimport Styles from \"../Styles\";\r\nimport { VisibilityContext } from \"../VisibilityContext\";\r\nimport { addEventListener } from \"./addEventListener\";\r\nimport { Measurement, getTooltipPosition } from \"./utils\";\r\n\r\nexport type Props = {\r\n  /**\r\n   * Tooltip reference element. Needs to be able to hold a ref.\r\n   */\r\n  children: React.ReactElement;\r\n  /**\r\n   * The number of milliseconds a user must touch the element before showing the tooltip.\r\n   */\r\n  enterTouchDelay?: number;\r\n  /**\r\n   * The number of milliseconds after the user stops touching an element before hiding the tooltip.\r\n   */\r\n  leaveTouchDelay?: number;\r\n  /**\r\n   * Tooltip title\r\n   */\r\n  title: string;\r\n  /**\r\n   * @optional\r\n   */\r\n  theme?: ThemeProp;\r\n  hitSlop?: any;\r\n};\r\n\r\n/**\r\n * Tooltips display informative text when users hover over, focus on, or tap an element.\r\n *\r\n * Plain tooltips, when activated, display a text label identifying an element, such as a description of its function. Tooltips should include only short, descriptive text and avoid restating visible UI text.\r\n *\r\n * <div class=\"screenshots\">\r\n *   <figure>\r\n *     <img class=\"small\" src=\"screenshots/tooltip.png\" />\r\n *   </figure>\r\n * </div>\r\n *\r\n * ## Usage\r\n * ```js\r\n * import * as React from 'react';\r\n * import { IconButton, Tooltip } from 'react-native-paper';\r\n *\r\n * const MyComponent = () => (\r\n *   <Tooltip title=\"Selected Camera\">\r\n *     <IconButton icon=\"camera\" selected size={24} onPress={() => {}} />\r\n *   </Tooltip>\r\n * );\r\n *\r\n * export default MyComponent;\r\n * ```\r\n */\r\nconst Tooltip = ({ children, title, hitSlop, ...rest }: Props) => {\r\n  const enterTouchDelay = 0;\r\n  const theme = useTheme();\r\n  const [visible, setVisible] = React.useState(false);\r\n\r\n  const [measurement, setMeasurement] = React.useState({\r\n    children: {},\r\n    tooltip: {},\r\n    measured: false,\r\n  });\r\n  const showTooltipTimer = React.useRef<NodeJS.Timeout>();\r\n  const hideTooltipTimer = React.useRef<NodeJS.Timeout>();\r\n  const childrenWrapperRef = React.useRef() as React.MutableRefObject<View>;\r\n  const touched = React.useRef(false);\r\n\r\n  const isWeb = Platform.OS === \"web\";\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (showTooltipTimer.current) {\r\n        clearTimeout(showTooltipTimer.current);\r\n      }\r\n\r\n      if (hideTooltipTimer.current) {\r\n        clearTimeout(hideTooltipTimer.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    const subscription = addEventListener(Dimensions, \"change\", () =>\r\n      setVisible(false),\r\n    );\r\n\r\n    return () => subscription.remove();\r\n  }, []);\r\n\r\n  const handleOnLayout = ({ nativeEvent: { layout } }: LayoutChangeEvent) => {\r\n    childrenWrapperRef.current.measure(\r\n      (_x, _y, width, height, pageX, pageY) => {\r\n        setMeasurement({\r\n          children: { pageX, pageY, height, width },\r\n          tooltip: { ...layout },\r\n          measured: true,\r\n        });\r\n      },\r\n    );\r\n  };\r\n\r\n  const handleTouchStart = () => {\r\n    if (hideTooltipTimer.current) {\r\n      clearTimeout(hideTooltipTimer.current);\r\n    }\r\n\r\n    showTooltipTimer.current = setTimeout(() => {\r\n      touched.current = true;\r\n      setVisible(true);\r\n    }, enterTouchDelay) as unknown as NodeJS.Timeout;\r\n  };\r\n\r\n  const handleTouchEnd = () => {\r\n    touched.current = false;\r\n    if (showTooltipTimer.current) {\r\n      clearTimeout(showTooltipTimer.current);\r\n    }\r\n\r\n    // hideTooltipTimer.current = setTimeout(() => {\r\n    //   setVisible(false);\r\n    //   setMeasurement({ children: {}, tooltip: {}, measured: false });\r\n    // }, leaveTouchDelay) as unknown as NodeJS.Timeout;\r\n  };\r\n\r\n  const hide = React.useCallback(() => {\r\n    setVisible(false);\r\n    setMeasurement({ children: {}, tooltip: {}, measured: false });\r\n  }, []);\r\n\r\n  const mobilePressProps = {\r\n    onPress: React.useCallback(() => {\r\n      if (touched.current) {\r\n        return null;\r\n      } else {\r\n        return children.props.onPress?.();\r\n      }\r\n    }, [children.props]),\r\n    onPressIn: () => handleTouchStart(),\r\n    onPressOut: () => handleTouchEnd(),\r\n  };\r\n\r\n  const webPressProps = {\r\n    onHoverIn: () => {\r\n      handleTouchStart();\r\n      children.props.onHoverIn?.();\r\n    },\r\n    onHoverOut: () => {\r\n      handleTouchEnd();\r\n      hide();\r\n      children.props.onHoverOut?.();\r\n    },\r\n  };\r\n\r\n  const isTextVisible = React.useContext(VisibilityContext);\r\n\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  const innerSurface = (\r\n    <Surface\r\n      onLayout={handleOnLayout}\r\n      style={[\r\n        styles.tooltip,\r\n        {\r\n          ...getTooltipPosition(measurement as Measurement),\r\n          borderRadius: theme.roundness,\r\n          ...(measurement.measured ? styles.visible : styles.hidden),\r\n        },\r\n      ]}\r\n      testID=\"tooltip-container\"\r\n    >\r\n      <View style={Styles.flexCenter}>\r\n        <Markdown\r\n          accessibilityLiveRegion=\"polite\"\r\n          selectable={false}\r\n          style={{\r\n            color: theme.colors.onSurface,\r\n          }}\r\n        >\r\n          {title}\r\n        </Markdown>\r\n      </View>\r\n    </Surface>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {visible && (\r\n        <Portal>\r\n          {Platform.OS != \"web\" && (\r\n            <Pressable onPressIn={hide}>\r\n              <View style={[styles.fullView, { height, width }]} />\r\n            </Pressable>\r\n          )}\r\n          {Platform.OS != \"web\" ? (\r\n            <Pressable onPressIn={hide}>{innerSurface}</Pressable>\r\n          ) : (\r\n            innerSurface\r\n          )}\r\n        </Portal>\r\n      )}\r\n      {/* Need the xxPressProps in both places */}\r\n      <Pressable\r\n        ref={childrenWrapperRef}\r\n        style={[styles.pressContainer]}\r\n        hitSlop={hitSlop}\r\n        {...(isWeb ? webPressProps : mobilePressProps)}\r\n      >\r\n        <View style={!isTextVisible && styles.textInvisible}>\r\n          {React.cloneElement(children, {\r\n            ...rest,\r\n            ...(isWeb ? webPressProps : mobilePressProps),\r\n          })}\r\n        </View>\r\n      </Pressable>\r\n    </>\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  tooltip: {\r\n    alignSelf: \"flex-start\",\r\n    justifyContent: \"center\",\r\n    paddingHorizontal: 16,\r\n    maxWidth: 300,\r\n    paddingVertical: 8,\r\n  },\r\n  visible: {\r\n    opacity: 1,\r\n  },\r\n  hidden: {\r\n    opacity: 0,\r\n  },\r\n  fullView: {\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n    backgroundColor: \"rgba(0, 0, 0, 0)\",\r\n  },\r\n  pressContainer: {\r\n    cursor: \"default\",\r\n    alignSelf: \"flex-start\",\r\n  } as ViewStyle,\r\n  textInvisible: {\r\n    display: \"none\",\r\n  },\r\n});\r\n\r\nexport default Tooltip;\r\n","import type {\r\n  NativeEventSubscription,\r\n  EmitterSubscription,\r\n} from 'react-native';\r\n\r\nexport function addEventListener<\r\n  T extends {\r\n    addEventListener: (\r\n      ...args: any\r\n    ) => NativeEventSubscription | EmitterSubscription;\r\n  } & { removeEventListener?: (...args: any) => void } & {\r\n    remove?: (...args: any) => void;\r\n  }\r\n>(Module: T, ...rest: Parameters<typeof Module.addEventListener>) {\r\n  const [eventName, handler] = rest;\r\n\r\n  let removed = false;\r\n\r\n  const subscription = Module.addEventListener(eventName, handler) ?? {\r\n    remove: () => {\r\n      if (removed) {\r\n        return;\r\n      }\r\n\r\n      Module.removeEventListener?.(eventName, handler);\r\n      Module.remove?.(eventName, handler);\r\n      removed = true;\r\n    },\r\n  };\r\n\r\n  return subscription;\r\n}\r\n\r\nexport function addListener<\r\n  T extends {\r\n    addListener: (...args: any) => EmitterSubscription;\r\n    removeEventListener: (...args: any) => void;\r\n  }\r\n>(Module: T, ...rest: Parameters<typeof Module.addListener>) {\r\n  const [eventName, handler] = rest;\r\n\r\n  let removed = false;\r\n\r\n  const subscription = Module.addListener(eventName, handler) ?? {\r\n    remove: () => {\r\n      if (removed) {\r\n        return;\r\n      }\r\n\r\n      Module.removeEventListener(eventName, handler);\r\n      removed = true;\r\n    },\r\n  };\r\n\r\n  return subscription;\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  CombatStat,\r\n  calculatePlayerAccuracyPoints,\r\n  calculatePlayerAttack,\r\n  calculatePlayerAttackDelaySec,\r\n  calculatePlayerCritPoints,\r\n  calculatePlayerDefense,\r\n  calculatePlayerDodgePoints,\r\n  calculatePlayerMaxHP,\r\n  explainPlayerCombatStat,\r\n} from \"../../backend/exploration/CombatStats\";\r\nimport { getCurrentPlayerHP } from \"../../backend/exploration/Exploration\";\r\nimport { Enemy } from \"../../backend/exploration/enemies/Enemy\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport Tooltip from \"./tooltip/PaperTooltip\";\r\n\r\nfunction CombatStatsRow(props: {\r\n  stat: string;\r\n  icon: string;\r\n  value: string;\r\n  valueMax?: string;\r\n  explanation?: string;\r\n  hideText?: boolean;\r\n}) {\r\n  if (props.explanation != null && props.explanation != \"\") {\r\n    return (\r\n      <View style={styles.inlineRow}>\r\n        <View style={styles.inlineRow}>\r\n          <GameIcon icon={props.icon} style={styles.icon} small />\r\n          {!props.hideText && (\r\n            <Text doNotScaleFonts={true}>\r\n              {t(\"{{stat}}: \", { stat: props.stat })}\r\n            </Text>\r\n          )}\r\n        </View>\r\n        <Tooltip title={props.explanation}>\r\n          {props.valueMax != null ? (\r\n            <Text doNotScaleFonts={true}>\r\n              <Text doNotScaleFonts={true}>\r\n                {t(\"{{value}}/\", { value: props.value })}\r\n              </Text>\r\n              <Text doNotScaleFonts={true} style={Styles.underlined}>\r\n                {t(\"{{value}}\", { value: props.valueMax })}\r\n              </Text>\r\n            </Text>\r\n          ) : (\r\n            <Text doNotScaleFonts={true} style={Styles.underlined}>\r\n              {t(\"{{value}}\", { value: props.value })}\r\n            </Text>\r\n          )}\r\n        </Tooltip>\r\n      </View>\r\n    );\r\n  }\r\n  return (\r\n    <View style={styles.inlineRow}>\r\n      <View style={styles.inlineRow}>\r\n        <GameIcon icon={props.icon} style={styles.icon} small />\r\n        {!props.hideText && (\r\n          <Text doNotScaleFonts={true}>\r\n            {t(\"{{stat}}: \", { stat: props.stat })}\r\n          </Text>\r\n        )}\r\n      </View>\r\n      <Text doNotScaleFonts={true}>\r\n        {props.valueMax != null\r\n          ? t(\"{{value}}/{{valueMax}}\", {\r\n              value: props.value,\r\n              valueMax: props.valueMax,\r\n            })\r\n          : t(\"{{value}}\", {\r\n              value: props.value,\r\n            })}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst CombatStatsRowMemo = React.memo(CombatStatsRow);\r\n\r\nexport type CombatStatsDisplay = {\r\n  currentHP: number;\r\n  maxHP: number;\r\n  maxHPExplanation?: string;\r\n  attack: number;\r\n  attackExplanation?: string;\r\n  attackDelay: number;\r\n  attackDelayExplanation?: string;\r\n  defense: number;\r\n  defenseExplanation?: string;\r\n  accuracy: number;\r\n  accuracyExplanation?: string;\r\n  dodge: number;\r\n  dodgeExplanation?: string;\r\n  crit: number;\r\n  critExplanation?: string;\r\n};\r\n\r\nexport function PlayerCombatStatsViewer(props: {\r\n  hideText?: boolean;\r\n  isVisible?: boolean;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const maxHPUnit = useMemo(\r\n    () => ({\r\n      unit: t(\" Max:hp:\"),\r\n    }),\r\n    [],\r\n  );\r\n  const attackUnit = useMemo(\r\n    () => ({\r\n      unit: \":attack:\",\r\n    }),\r\n    [],\r\n  );\r\n  const attackDelayUnit = useMemo(() => ({ unit: t(\"s\") }), []);\r\n  const defenseUnit = useMemo(\r\n    () => ({\r\n      unit: \":defense:\",\r\n    }),\r\n    [],\r\n  );\r\n  const accuracyUnit = useMemo(\r\n    () => ({\r\n      unit: \":accuracy:\",\r\n    }),\r\n    [],\r\n  );\r\n  const dodgeUnit = useMemo(\r\n    () => ({\r\n      unit: \":dodge:\",\r\n    }),\r\n    [],\r\n  );\r\n  const critChanceUnit = useMemo(\r\n    () => ({\r\n      unit: \":critChance:\",\r\n    }),\r\n    [],\r\n  );\r\n  const combatStatsDisplayObject = {\r\n    currentHP: getCurrentPlayerHP(state),\r\n    maxHP: calculatePlayerMaxHP(state),\r\n    maxHPExplanation: explainPlayerCombatStat(\r\n      state,\r\n      CombatStat.MaxHP,\r\n      maxHPUnit,\r\n    ),\r\n    attack: calculatePlayerAttack(state),\r\n    attackExplanation: explainPlayerCombatStat(\r\n      state,\r\n      CombatStat.Attack,\r\n      attackUnit,\r\n    ),\r\n    attackDelay: calculatePlayerAttackDelaySec(state),\r\n    attackDelayExplanation: explainPlayerCombatStat(\r\n      state,\r\n      CombatStat.AttackDelay,\r\n      attackDelayUnit,\r\n    ),\r\n    defense: calculatePlayerDefense(state),\r\n    defenseExplanation: explainPlayerCombatStat(\r\n      state,\r\n      CombatStat.Defense,\r\n      defenseUnit,\r\n    ),\r\n    accuracy: calculatePlayerAccuracyPoints(state),\r\n    accuracyExplanation: explainPlayerCombatStat(\r\n      state,\r\n      CombatStat.Accuracy,\r\n      accuracyUnit,\r\n    ),\r\n    dodge: calculatePlayerDodgePoints(state),\r\n    dodgeExplanation: explainPlayerCombatStat(\r\n      state,\r\n      CombatStat.Dodge,\r\n      dodgeUnit,\r\n    ),\r\n    crit: calculatePlayerCritPoints(state),\r\n    critExplanation: explainPlayerCombatStat(\r\n      state,\r\n      CombatStat.Crit,\r\n      critChanceUnit,\r\n    ),\r\n  };\r\n  return useMemo(\r\n    () => (\r\n      <CombatStatsViewer\r\n        {...props}\r\n        showCurrentHP={true}\r\n        combatStats={combatStatsDisplayObject}\r\n      />\r\n    ),\r\n    [props.hideText, props.isVisible, JSON.stringify(combatStatsDisplayObject)],\r\n  );\r\n}\r\n\r\nexport function EnemyCombatStatsViewer(props: {\r\n  enemy: Enemy;\r\n  obfuscateValues?: boolean;\r\n  hideText?: boolean;\r\n  isVisible?: boolean;\r\n}) {\r\n  const enemy = props.enemy;\r\n  const combatStatsDisplayObject = {\r\n    currentHP: 0,\r\n    maxHP: enemy.getBaseStats().maxHP,\r\n    attack: enemy.getBaseStats().attack,\r\n    attackDelay: enemy.getBaseStats().attackDelay,\r\n    defense: enemy.getBaseStats().defense,\r\n    hpRegen: 0,\r\n    accuracy: enemy.getBaseStats().accuracy,\r\n    dodge: enemy.getBaseStats().dodge,\r\n    crit: enemy.getBaseStats().crit,\r\n  };\r\n  return useMemo(\r\n    () => (\r\n      <CombatStatsViewer\r\n        {...props}\r\n        showCurrentHP={false}\r\n        combatStats={combatStatsDisplayObject}\r\n      />\r\n    ),\r\n    [\r\n      props.hideText,\r\n      props.isVisible,\r\n      props.obfuscateValues,\r\n      JSON.stringify(combatStatsDisplayObject),\r\n    ],\r\n  );\r\n}\r\n\r\nexport function CombatStatsViewer(props: {\r\n  obfuscateValues?: boolean;\r\n  hideText?: boolean;\r\n  isVisible?: boolean;\r\n  showCurrentHP?: boolean;\r\n  combatStats: CombatStatsDisplay;\r\n}) {\r\n  const combatStats = props.combatStats;\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.container}>\r\n        <CombatStatsRowMemo\r\n          stat=\"HP\"\r\n          icon=\"hp\"\r\n          hideText={props.hideText}\r\n          value={\r\n            props.obfuscateValues\r\n              ? t(\"???\")\r\n              : props.showCurrentHP\r\n              ? formatNumber(Math.ceil(combatStats.currentHP))\r\n              : formatNumber(Math.ceil(combatStats.maxHP))\r\n          }\r\n          valueMax={\r\n            props.showCurrentHP\r\n              ? formatNumber(Math.ceil(combatStats.maxHP))\r\n              : props.obfuscateValues\r\n              ? t(\"???\")\r\n              : undefined\r\n          }\r\n          explanation={\r\n            !props.obfuscateValues ? combatStats.maxHPExplanation : null\r\n          }\r\n        />\r\n        <CombatStatsRowMemo\r\n          stat=\"Attack\"\r\n          icon=\"attack\"\r\n          hideText={props.hideText}\r\n          value={\r\n            props.obfuscateValues ? t(\"???\") : formatNumber(combatStats.attack)\r\n          }\r\n          explanation={\r\n            !props.obfuscateValues ? combatStats.attackExplanation : null\r\n          }\r\n        />\r\n        <CombatStatsRowMemo\r\n          stat=\"Attack Delay\"\r\n          icon=\"attackDelay\"\r\n          hideText={props.hideText}\r\n          value={\r\n            props.obfuscateValues\r\n              ? t(\"???\")\r\n              : t(\"{{value}}s\", {\r\n                  value: formatNumber(combatStats.attackDelay, {\r\n                    showDecimals: true,\r\n                  }),\r\n                })\r\n          }\r\n          explanation={\r\n            !props.obfuscateValues ? combatStats.attackDelayExplanation : null\r\n          }\r\n        />\r\n        <CombatStatsRowMemo\r\n          stat=\"Defense\"\r\n          icon=\"defense\"\r\n          hideText={props.hideText}\r\n          value={\r\n            props.obfuscateValues ? t(\"???\") : formatNumber(combatStats.defense)\r\n          }\r\n          explanation={\r\n            !props.obfuscateValues ? combatStats.defenseExplanation : null\r\n          }\r\n        />\r\n        {combatStats.accuracy != 100 && (\r\n          <CombatStatsRowMemo\r\n            stat=\"Accuracy\"\r\n            icon=\"accuracy\"\r\n            hideText={props.hideText}\r\n            value={\r\n              props.obfuscateValues\r\n                ? t(\"???\")\r\n                : formatNumber(combatStats.accuracy, {\r\n                    showDecimals: false,\r\n                  })\r\n            }\r\n            explanation={\r\n              !props.obfuscateValues ? combatStats.accuracyExplanation : null\r\n            }\r\n          />\r\n        )}\r\n        {combatStats.dodge != 100 && (\r\n          <CombatStatsRowMemo\r\n            stat=\"Dodge\"\r\n            icon=\"dodge\"\r\n            hideText={props.hideText}\r\n            value={\r\n              props.obfuscateValues\r\n                ? t(\"???\")\r\n                : formatNumber(combatStats.dodge, {\r\n                    showDecimals: false,\r\n                  })\r\n            }\r\n            explanation={\r\n              !props.obfuscateValues ? combatStats.dodgeExplanation : null\r\n            }\r\n          />\r\n        )}\r\n        {combatStats.crit > 0 && (\r\n          <CombatStatsRowMemo\r\n            stat=\"Critical\"\r\n            icon=\"critChance\"\r\n            hideText={props.hideText}\r\n            value={\r\n              props.obfuscateValues\r\n                ? t(\"???\")\r\n                : formatNumber(combatStats.crit, {\r\n                    showDecimals: false,\r\n                  })\r\n            }\r\n            explanation={\r\n              !props.obfuscateValues ? combatStats.critExplanation : null\r\n            }\r\n          />\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      props.isVisible !== false ? JSON.stringify(combatStats) : false,\r\n      props.hideText,\r\n      props.showCurrentHP,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n});\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { getUnlockedDungeons } from \"../../backend/exploration/dungeons/Dungeons\";\r\nimport {\r\n  BestiaryState,\r\n  Enemy,\r\n  getCumulativeEnemyKills,\r\n  getCumulativeEnemyKillsFromCreatures,\r\n} from \"../../backend/exploration/enemies/Enemy\";\r\nimport { getCumulativeLosses } from \"../../backend/exploration/Exploration\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { formatNumber, RoundingMethod } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { EnemySpriteTile } from \"../exploration/EnemySpriteTile\";\r\nimport CategoryContainer from \"./CategoryContainer\";\r\nimport { EnemyCombatStatsViewer } from \"./CombatStatsViewer\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { Text } from \"./Text\";\r\n\r\nfunction BestiaryEnemyContents(props: { enemy: Enemy }) {\r\n  const enemy = props.enemy;\r\n  const id = enemy.getId();\r\n  const name = enemy.getName();\r\n  const state = useContext(StateContext);\r\n\r\n  const unlockedFloors = getUnlockedDungeons(state)\r\n    .map((dungeon) =>\r\n      dungeon.getDungeonFloors().filter((floor) => floor.isUnlocked(state)),\r\n    )\r\n    .flat();\r\n\r\n  const bestiaryState = enemy.getBestiaryState(state);\r\n\r\n  const foundInDungeons = unlockedFloors\r\n    .filter((floor) =>\r\n      floor\r\n        .getExplorationPossibilities(state, false)\r\n        .find((possibility) => possibility.transforms?.enemy == enemy),\r\n    )\r\n    .map((floor) => {\r\n      const possibilities = floor.getBaseExplorationPossibilities(state);\r\n      const weight =\r\n        possibilities.find(\r\n          (possibility) => possibility.transforms?.enemy == enemy,\r\n        )?.weight ?? 0;\r\n      const totalWeight = possibilities.reduce(\r\n        (prev, current) => prev + current.weight,\r\n        0,\r\n      );\r\n      return `*${floor.getFloorName()}*: ${formatNumber(\r\n        (weight * 100) / totalWeight,\r\n        { showDecimals: true },\r\n      )}%`;\r\n    })\r\n    .concat(\r\n      unlockedFloors\r\n        .filter((floor) => floor.getBoss(state) == enemy)\r\n        .map((floor) =>\r\n          t(\"*{{dungeonFloorName}}* (Boss)\", {\r\n            dungeonFloorName: floor.getFloorName(),\r\n          }),\r\n        ),\r\n    )\r\n    .join(t(\", \"));\r\n\r\n  const showDrops = bestiaryState == BestiaryState.Loot;\r\n\r\n  const dropsText = [\r\n    enemy.getCoinsAwardedBase(state) > 0\r\n      ? t(\"{{coinsAwarded}}:coins:\", {\r\n          coinsAwarded: formatNumber(enemy.getCoinsAwardedBase(state)),\r\n        })\r\n      : null,\r\n    enemy.getMonstiumAwardedBase(state) > 0\r\n      ? t(\"{{monstiumAwarded}}:monstium:\", {\r\n          monstiumAwarded: formatNumber(enemy.getMonstiumAwardedBase(state)),\r\n        })\r\n      : null,\r\n  ]\r\n    .concat(\r\n      enemy.getItemsAwardedBase(state).map((loot) => {\r\n        if (loot.chance == 0) {\r\n          return null;\r\n        }\r\n        const item = Items.getById(loot.itemId);\r\n        return t(\"{{amount}}x{{itemIcon}}*{{itemName}}* ({{lootChancePct}}%)\", {\r\n          amount: loot.amount,\r\n          itemIcon: `:${loot.itemId}:`,\r\n          itemName: item.getName(loot.params ?? item.getDefaultParams()),\r\n          lootChancePct: formatNumber(loot.chance * 100, {\r\n            showDecimals: true,\r\n            roundingMethod: RoundingMethod.UP,\r\n          }),\r\n        });\r\n      }),\r\n    )\r\n    .filter((v) => v != null)\r\n    .join(t(\", \"));\r\n\r\n  const cumulativeKills = getCumulativeEnemyKills(state, enemy.getId());\r\n  const cumulativeLosses = getCumulativeLosses(state, enemy.getId());\r\n  const cumulativeCreatureKills = getCumulativeEnemyKillsFromCreatures(\r\n    state,\r\n    enemy.getId(),\r\n  );\r\n\r\n  const generalText1 = t(\"Times defeated: {{cumulativeKills}}\", {\r\n    cumulativeKills: formatNumber(cumulativeKills),\r\n  });\r\n  const generalText2 = t(\"Times you ran away: {{cumulativeLosses}}\", {\r\n    cumulativeLosses: formatNumber(cumulativeLosses),\r\n  });\r\n\r\n  const showEnemyStats = bestiaryState != BestiaryState.SpriteOnly;\r\n  const showTip =\r\n    bestiaryState != BestiaryState.SpriteOnly && enemy.getTips() != null;\r\n  const tips = enemy.getTips();\r\n\r\n  const enemyContentContainer = useMemo(() => {\r\n    return (\r\n      <View style={styles.contentContainer}>\r\n        <View style={styles.row}>\r\n          <View style={styles.column}>\r\n            <EnemySpriteTile sprite={enemy.getPicture(state)} />\r\n          </View>\r\n          <View style={styles.column}>\r\n            <CategoryContainer title={t(\"Base stats\")}>\r\n              <View style={styles.categoryContents}>\r\n                <EnemyCombatStatsViewer\r\n                  enemy={enemy}\r\n                  obfuscateValues={!showEnemyStats}\r\n                />\r\n              </View>\r\n            </CategoryContainer>\r\n            <CategoryContainer title={t(\"General\")}>\r\n              <View style={styles.categoryContents}>\r\n                <Markdown>{generalText1}</Markdown>\r\n                <Markdown>{generalText2}</Markdown>\r\n              </View>\r\n            </CategoryContainer>\r\n          </View>\r\n        </View>\r\n        <View style={styles.row}>\r\n          <View style={styles.column}>\r\n            <CategoryContainer title={t(\"Found in\")}>\r\n              <View style={styles.categoryContents}>\r\n                <Markdown>\r\n                  {foundInDungeons != \"\" ? foundInDungeons : t(\"???\")}\r\n                </Markdown>\r\n              </View>\r\n            </CategoryContainer>\r\n          </View>\r\n          <View style={styles.column}>\r\n            <CategoryContainer title={t(\"Base loot\")}>\r\n              <View style={styles.categoryContents}>\r\n                <Markdown>\r\n                  {!showDrops\r\n                    ? t(\r\n                        \"You must defeat this enemy more times to see loot information!\",\r\n                      )\r\n                    : dropsText != \"\"\r\n                    ? dropsText\r\n                    : t(\"No loot\")}\r\n                </Markdown>\r\n              </View>\r\n            </CategoryContainer>\r\n          </View>\r\n        </View>\r\n        {showTip && (\r\n          <View>\r\n            <CategoryContainer title={t(\"Combat tips (from hired wizard)\")}>\r\n              <View style={styles.categoryContents}>\r\n                <Markdown>{tips}</Markdown>\r\n              </View>\r\n            </CategoryContainer>\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    enemy,\r\n    foundInDungeons,\r\n    dropsText,\r\n    generalText1,\r\n    generalText2,\r\n    showTip,\r\n    tips,\r\n    showEnemyStats,\r\n  ]);\r\n\r\n  return enemyContentContainer;\r\n}\r\n\r\nexport function BestiaryEnemyContainer(props: {\r\n  enemy: Enemy;\r\n  collapsed?: boolean;\r\n  onPressExpand?: () => void;\r\n}) {\r\n  const enemy = props.enemy;\r\n  const id = enemy.getId();\r\n  const name = enemy.getName();\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={styles.helpContainer} key={id}>\r\n        <TouchableWithoutFeedback\r\n          accessibilityRole=\"button\"\r\n          accessibilityHint=\"Expand\"\r\n          onPress={props.onPressExpand}\r\n        >\r\n          <View style={styles.topRowContainer}>\r\n            <Text h3 key={id} style={[styles.topContainer]}>\r\n              {t(\"{{enemyName}}{{bossText}}\", {\r\n                enemyName: name,\r\n                bossText: enemy.isBoss() ? t(\" (Boss)\") : \"\",\r\n              })}\r\n            </Text>\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.colors.onBackground}\r\n              />\r\n            </View>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        {!props.collapsed && (\r\n          <View>\r\n            <BestiaryEnemyContents enemy={enemy} />\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [theme, name, id, props.collapsed, props.onPressExpand]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  helpContainer: { marginVertical: 8 },\r\n  topRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginBottom: 8,\r\n    marginTop: 8,\r\n    marginHorizontal: 8,\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  descriptionViewer: { flex: 1, justifyContent: \"center\" },\r\n  topContainer: {\r\n    flex: 1,\r\n    marginLeft: 8,\r\n  },\r\n  disabledStorylineText: {\r\n    color: \"#aaa\",\r\n  },\r\n  contentContainer: {\r\n    paddingVertical: 8,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n  },\r\n  categoryContents: {\r\n    marginTop: 8,\r\n  },\r\n  column: {\r\n    flex: 1,\r\n    marginHorizontal: 4,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { getBestiaryVisibleEnemies } from \"../../backend/exploration/enemies/Enemy\";\r\nimport { BestiaryEnemyContainer } from \"../utility/BestiaryEnemyContainer\";\r\nimport Divider from \"../utility/Divider\";\r\n\r\nfunction BestiaryContainer() {\r\n  const [expandedEnemyId, setExpandedEnemyId] = useState(\"\");\r\n  const setEnemyCallback = useCallback(\r\n    (enemyId: string) => {\r\n      if (expandedEnemyId == enemyId) {\r\n        setExpandedEnemyId(\"\");\r\n      } else {\r\n        setExpandedEnemyId(enemyId);\r\n      }\r\n    },\r\n    [expandedEnemyId],\r\n  );\r\n\r\n  const state = useContext(StateContext);\r\n  const allEnemies = getBestiaryVisibleEnemies(state);\r\n\r\n  const enemyString = allEnemies.map((enemy) => enemy.getId()).join(\",\");\r\n\r\n  const enemyContainers = useMemo(\r\n    () =>\r\n      allEnemies.map((enemy) => {\r\n        return (\r\n          <BestiaryEnemyContainer\r\n            key={enemy.getId()}\r\n            enemy={enemy}\r\n            collapsed={expandedEnemyId != enemy.getId()}\r\n            onPressExpand={setEnemyCallback.bind(null, enemy.getId())}\r\n          />\r\n        );\r\n      }),\r\n    [enemyString, expandedEnemyId, setExpandedEnemyId],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (allEnemies.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <View>\r\n        {enemyContainers.map((enemyContainer, idx) => {\r\n          return (\r\n            <View key={allEnemies[idx].getId()}>\r\n              <Divider />\r\n              {enemyContainer}\r\n            </View>\r\n          );\r\n        })}\r\n        <Divider />\r\n      </View>\r\n    );\r\n  }, [enemyString, enemyContainers]);\r\n}\r\n\r\nexport default function Bestiary() {\r\n  return (\r\n    <View style={styles.bestiaryContainer}>\r\n      <BestiaryContainer />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  headerContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  valueText: {\r\n    minWidth: 60,\r\n    textAlign: \"right\",\r\n    marginLeft: 8,\r\n  },\r\n  valueTextLong: {\r\n    minWidth: 112,\r\n  },\r\n  bestiaryContainer: {\r\n    marginTop: 16,\r\n  },\r\n  captionText: {\r\n    flex: 1,\r\n  },\r\n});\r\n","export enum ItemTagEnum {\r\n  Consumable = \"Consumable\",\r\n  Familiar = \"Familiar\",\r\n  Material = \"Material\",\r\n  Equipment = \"Equipment\",\r\n  Hand = \"Hand\",\r\n  Body = \"Body\",\r\n  Accessory = \"Accessory\",\r\n  Pouch = \"Pouch\",\r\n  QuestItem = \"QuestItem\",\r\n}\r\n","import mem from \"mem\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { GameState, GameStateTransform } from \"./GameState\";\r\nimport { Action } from \"./action/Action\";\r\nimport { getActionById } from \"./action/Actions\";\r\nimport { getAmountOfItem, isItemOccurrenceEqual } from \"./items/Inventory\";\r\nimport type { Item } from \"./items/Item\";\r\nimport { ItemOccurrence } from \"./items/Item\";\r\nimport { ItemTagEnum } from \"./items/ItemTagEnum\";\r\nimport { Items } from \"./items/Items\";\r\nimport { ConsumableItem } from \"./items/consumable/ConsumableItem\";\r\n\r\nexport interface QuickbarItemData {\r\n  type: \"item\";\r\n  occurrence: ItemOccurrence;\r\n}\r\n\r\nexport interface QuickbarActionData {\r\n  type: \"action\";\r\n  id: string;\r\n}\r\n\r\nexport type QuickbarData = QuickbarItemData | QuickbarActionData;\r\n\r\nexport interface QuickbarAction {\r\n  getDisplayName(state: GameState): string;\r\n  isEnabled(state: GameState): boolean;\r\n  isActive(state: GameState): boolean;\r\n  getTransform(state: GameState): GameStateTransform;\r\n  toQuickbarData(): QuickbarData;\r\n}\r\n\r\nclass QuickbarItem {\r\n  data: QuickbarItemData;\r\n\r\n  constructor(data: QuickbarItemData) {\r\n    this.data = data;\r\n  }\r\n\r\n  getItem(): Item {\r\n    const itemOccurrence = this.data.occurrence;\r\n    const item = Items.getById(itemOccurrence.itemId);\r\n    return item;\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    const item = this.getItem();\r\n    return item.isActive(state);\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    const item = this.getItem();\r\n    const name = item.getName(this.data.occurrence.params);\r\n    const amount = getAmountOfItem(this.data.occurrence, state);\r\n    let cooldown = 0;\r\n    if (item.getTags().includes(ItemTagEnum.Consumable)) {\r\n      cooldown = (item as ConsumableItem).getCooldownLeftSec(state);\r\n    }\r\n    return t(\"{{name}}{{amountText}}{{cooldownText}}\", {\r\n      name,\r\n      amountText: amount != 1 ? t(\" ({{amount}})\", { amount }) : \"\",\r\n      cooldownText:\r\n        cooldown > 0\r\n          ? t(\" ({{cooldown}} sec)\", {\r\n              cooldown: formatNumber(cooldown, {\r\n                showDecimals: false,\r\n              }),\r\n            })\r\n          : \"\",\r\n    });\r\n  }\r\n\r\n  isEnabled(state: GameState): boolean {\r\n    return (\r\n      this.getItem().getPrimaryAction(state, this.data.occurrence.params)\r\n        ?.isEnabled || false\r\n    );\r\n  }\r\n\r\n  getTransform(state: GameState): GameStateTransform {\r\n    return (\r\n      this.getItem().getPrimaryAction(state, this.data.occurrence.params)\r\n        ?.transform || ((state) => state)\r\n    );\r\n  }\r\n\r\n  toQuickbarData(): QuickbarData {\r\n    return this.data;\r\n  }\r\n}\r\n\r\nconst doActionMemoized = mem((action: Action) => {\r\n  return action.doAction.bind(action, {\r\n    isAutomatic: false,\r\n  });\r\n});\r\n\r\nexport class QuickbarActionImpl {\r\n  data: QuickbarActionData;\r\n\r\n  constructor(data: QuickbarActionData) {\r\n    this.data = data;\r\n  }\r\n\r\n  getAction(): Action {\r\n    return getActionById(this.data.id);\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return this.getAction().isActive(state);\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    return this.getAction().getDisplayName(state);\r\n  }\r\n\r\n  isEnabled(state: GameState): boolean {\r\n    return this.getAction().isEnabled(state);\r\n  }\r\n\r\n  getTransform(state: GameState): GameStateTransform {\r\n    return doActionMemoized(this.getAction());\r\n  }\r\n\r\n  toQuickbarData(): QuickbarData {\r\n    return this.data;\r\n  }\r\n}\r\n\r\nfunction getCurrentQuickbar(state: GameState): QuickbarData[] {\r\n  let currentQuickbar = state.world.quickbars?.[state.world.currentQuickbar];\r\n  if (currentQuickbar == null) {\r\n    currentQuickbar = [];\r\n    state.world.quickbars[state.world.currentQuickbar] = currentQuickbar;\r\n  }\r\n  return currentQuickbar;\r\n}\r\n\r\nexport function getQuickbarActions(state: GameState): QuickbarAction[] {\r\n  return getCurrentQuickbar(state).map((quickbarData) => {\r\n    if (quickbarData.type == \"item\") {\r\n      return new QuickbarItem(quickbarData);\r\n    } else {\r\n      return new QuickbarActionImpl(quickbarData);\r\n    }\r\n  });\r\n}\r\n\r\nexport function addActionToQuickbar(\r\n  state: GameState,\r\n  action: Action,\r\n): GameState {\r\n  return addToQuickbar(state, {\r\n    type: \"action\",\r\n    id: action.getId(),\r\n  });\r\n}\r\n\r\nexport function addItemToQuickbar(\r\n  state: GameState,\r\n  itemOccurrence: ItemOccurrence,\r\n): GameState {\r\n  return addToQuickbar(state, {\r\n    type: \"item\",\r\n    occurrence: itemOccurrence,\r\n  });\r\n}\r\n\r\nexport function addToQuickbar(state: GameState, data: QuickbarData): GameState {\r\n  if (isInQuickbar(state, data)) {\r\n    return state;\r\n  }\r\n  if (isQuickbarFull(state)) {\r\n    return state;\r\n  }\r\n  const newQuickbar = getCurrentQuickbar(state);\r\n  newQuickbar.push(data);\r\n  return state;\r\n}\r\n\r\nexport function removeFromQuickbar(\r\n  state: GameState,\r\n  data: QuickbarData,\r\n): GameState {\r\n  const stringifiedData = JSON.stringify(data);\r\n  const index = getCurrentQuickbar(state).findIndex(\r\n    (element) => JSON.stringify(element) == stringifiedData,\r\n  );\r\n  if (index < 0) {\r\n    return state;\r\n  }\r\n  getCurrentQuickbar(state).splice(index, 1);\r\n  return state;\r\n}\r\n\r\nexport function isQuickbarFull(state: GameState): boolean {\r\n  return getCurrentQuickbar(state).length >= 10;\r\n}\r\n\r\nexport function isInQuickbar(state: GameState, data: QuickbarData): boolean {\r\n  return (\r\n    getCurrentQuickbar(state).findIndex(\r\n      (element) =>\r\n        (element.type == data.type &&\r\n          data.type == \"action\" &&\r\n          element.type == \"action\" &&\r\n          data.id == element.id) ||\r\n        (data.type == \"item\" &&\r\n          element.type == \"item\" &&\r\n          isItemOccurrenceEqual(data.occurrence, element.occurrence)),\r\n    ) >= 0\r\n  );\r\n}\r\n","import mem from \"mem\";\r\nimport memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { incrementAccumulatorVariable } from \"../AccumulatorVariables\";\r\nimport { GameState, GameStateTransform } from \"../GameState\";\r\nimport { addItemToQuickbar, isInQuickbar, isQuickbarFull } from \"../Quickbar\";\r\nimport {\r\n  Resource,\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n} from \"../Resources\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformations,\r\n  applyTransformationsCached,\r\n  applyTransformationsPermaCached,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport {\r\n  addToInventory,\r\n  getAmountOfItem,\r\n  removeFromInventory,\r\n} from \"./Inventory\";\r\nimport { ItemTagEnum } from \"./ItemTagEnum\";\r\nimport { isItemQualityUnlocked } from \"./Items\";\r\n\r\nexport type ItemTag = ItemTagEnum;\r\n\r\nexport function translateItemTag(tag: ItemTagEnum): string {\r\n  switch (tag) {\r\n    case ItemTagEnum.Consumable:\r\n      return t(\"Consumable\");\r\n    case ItemTagEnum.Material:\r\n      return t(\"Material\");\r\n    case ItemTagEnum.Familiar:\r\n      return t(\"Familiar\");\r\n    case ItemTagEnum.Equipment:\r\n      return t(\"Equipment\");\r\n    case ItemTagEnum.Hand:\r\n      return t(\"Hand\");\r\n    case ItemTagEnum.Body:\r\n      return t(\"Body\");\r\n    case ItemTagEnum.Accessory:\r\n      return t(\"Accessory\");\r\n    case ItemTagEnum.Pouch:\r\n      return t(\"Pouch\");\r\n    case ItemTagEnum.QuestItem:\r\n      return t(\"Quest Item\");\r\n  }\r\n}\r\n\r\nexport interface ItemStack {\r\n  itemOccurrence: ItemOccurrence;\r\n  amount: number;\r\n}\r\n\r\nexport type ItemParams = Record<string, any>;\r\n\r\nexport interface ItemOccurrence {\r\n  itemId: string;\r\n  params: ItemParams;\r\n}\r\n\r\nexport interface ItemAction {\r\n  id: string;\r\n  description: string;\r\n  isEnabled: boolean;\r\n  requireConfirm?: boolean;\r\n  isActive?: boolean;\r\n  transform?: GameStateTransform;\r\n}\r\n\r\nconst saleActionOne = mem(\r\n  (id: string, params: ItemParams, salePrice: number) => {\r\n    return {\r\n      id: \"sell1\" + salePrice,\r\n      description: t(`Sell 1 ({{coins}}:coins:)`, {\r\n        coins: formatNumber(salePrice),\r\n      }),\r\n      isEnabled: true,\r\n      isActive: false,\r\n      transform: (state: GameState) => {\r\n        state = incrementAccumulatorVariable(state, \"itemsSold\", 1);\r\n        state = removeFromInventory({ itemId: id, params }, 1, state);\r\n        return grantResource(Resource.Coins, salePrice)(state);\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nconst saleActionMany = mem(\r\n  (\r\n    id: string,\r\n    params: ItemParams,\r\n    salePrice: number,\r\n    amount: number,\r\n    isAll: boolean,\r\n  ) => {\r\n    let totalAmount = salePrice * amount;\r\n    return {\r\n      id: \"sellMany\" + (!isAll ? amount : \"\") + salePrice,\r\n      description: isAll\r\n        ? t(`Sell all ({{coins}}:coins:)`, {\r\n            coins: formatNumber(totalAmount),\r\n          })\r\n        : t(`Sell {{amount}} ({{coins}}:coins:)`, {\r\n            coins: formatNumber(totalAmount),\r\n            amount: formatNumber(amount),\r\n          }),\r\n      isEnabled: true,\r\n      requireConfirm: isAll,\r\n      isActive: false,\r\n      transform: (state: GameState) => {\r\n        if (isAll) {\r\n          amount = getAmountOfItem({ itemId: id, params }, state);\r\n          totalAmount = salePrice * amount;\r\n        }\r\n        state = incrementAccumulatorVariable(state, \"itemsSold\", amount);\r\n        state = removeFromInventory({ itemId: id, params }, amount, state);\r\n        return grantResource(Resource.Coins, totalAmount)(state);\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nconst quickbarAction = mem(\r\n  (id: string, params: ItemParams, enabled: boolean) => {\r\n    return {\r\n      id: \"quickbar\" + enabled,\r\n      description: t(\"Add to Quickbar\"),\r\n      isActive: false,\r\n      isEnabled: enabled,\r\n      transform: (state: GameState) => {\r\n        return addItemToQuickbar(state, { itemId: id, params });\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nfunction getAmountNeededForCombining(state: GameState): number {\r\n  return applyTransformationsPermaCached(\r\n    [TransformationTags.ItemsNeededForCombining],\r\n    state,\r\n    3,\r\n  );\r\n}\r\n\r\nconst combineActionOne = mem(\r\n  (id: string, params: ItemParams) => {\r\n    return {\r\n      description: t(`Combine 1 to +{{quality}}`, {\r\n        quality: formatNumber((params?.itemQuality ?? 0) + 1),\r\n      }),\r\n      isEnabled: (state) =>\r\n        getAmountOfItem({ itemId: id, params: params }, state) >=\r\n        getAmountNeededForCombining(state),\r\n      isActive: false,\r\n      transform: (state: GameState) => {\r\n        state = removeFromInventory(\r\n          { itemId: id, params },\r\n          getAmountNeededForCombining(state),\r\n          state,\r\n        );\r\n        state = addToInventory(\r\n          {\r\n            itemId: id,\r\n            params: { ...params, itemQuality: (params?.itemQuality ?? 0) + 1 },\r\n          },\r\n          1,\r\n          state,\r\n        );\r\n        return state;\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nconst combineActionMany = mem(\r\n  (id: string, params: ItemParams, amount: number) => {\r\n    return {\r\n      description: t(`Combine all ({{amount}}) to +{{quality}}`, {\r\n        quality: formatNumber((params?.itemQuality ?? 0) + 1),\r\n        amount: formatNumber(amount),\r\n      }),\r\n      isEnabled: (state) => true,\r\n      isActive: false,\r\n      transform: (state: GameState) => {\r\n        state = removeFromInventory(\r\n          { itemId: id, params },\r\n          amount * getAmountNeededForCombining(state),\r\n          state,\r\n        );\r\n        state = addToInventory(\r\n          {\r\n            itemId: id,\r\n            params: { ...params, itemQuality: (params?.itemQuality ?? 0) + 1 },\r\n          },\r\n          amount,\r\n          state,\r\n        );\r\n        return state;\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nexport const INITIAL_MAX_ITEM_QUALITY = 15;\r\n\r\nconst MAX_ITEM_QUALITY_TAGS = [TransformationTags.ItemQualityMax];\r\n\r\nexport function getMaxItemQuality(state: GameState): number {\r\n  return applyTransformationsPermaCached(\r\n    MAX_ITEM_QUALITY_TAGS,\r\n    state,\r\n    INITIAL_MAX_ITEM_QUALITY,\r\n  );\r\n}\r\n\r\nexport abstract class Item {\r\n  constructor() {}\r\n\r\n  abstract getId(): string;\r\n  abstract getPicture(): any;\r\n  abstract getBaseName(params: ItemParams): string;\r\n  abstract getDescription(\r\n    state: GameState,\r\n    params: ItemParams,\r\n  ): string | undefined;\r\n  abstract getEffect(state: GameState, params: ItemParams): string | undefined;\r\n  abstract getBaseSalePrice(state: GameState, params: ItemParams): number;\r\n\r\n  getTags(): ItemTag[] {\r\n    return [];\r\n  }\r\n\r\n  getName(params: ItemParams): string {\r\n    const base = this.getBaseName(params);\r\n    if (params?.itemQuality != null && params?.itemQuality > 0) {\r\n      return `${base} +${formatNumber(params?.itemQuality)}`;\r\n    }\r\n    return `${base}`;\r\n  }\r\n\r\n  getDefaultName(): string {\r\n    return this.getName(this.getDefaultParams());\r\n  }\r\n\r\n  protected getBaseItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getCachedBaseItemEffects = memoize((params: ItemParams) =>\r\n    this.getBaseItemEffects(params),\r\n  );\r\n\r\n  isActive(state: GameState): boolean {\r\n    return false;\r\n  }\r\n\r\n  _tags: string[] | undefined;\r\n\r\n  getTransformationTags() {\r\n    if (this._tags == null) {\r\n      this._tags = [this.getId(), ...this.getTags().map((itemTag) => itemTag)];\r\n    }\r\n    return this._tags;\r\n  }\r\n\r\n  tagsByEffect: Record<string, string[]> = {};\r\n  getTagsByEffect(key: string, baseEffect: ActionEffect): string[] {\r\n    if (this.tagsByEffect?.[key] == null) {\r\n      this.tagsByEffect[key] = [\r\n        ...this.getTags(),\r\n        this.getId(),\r\n        ...(baseEffect.tags ?? []),\r\n        TransformationTags.ItemEffect,\r\n      ];\r\n    }\r\n    return this.tagsByEffect[key];\r\n  }\r\n\r\n  _itemOccurrenceCache: Record<string, ItemOccurrence> = {};\r\n\r\n  getMemoizedItemOccurrence = (params) => {\r\n    const key = JSON.stringify(params);\r\n    let cached = this._itemOccurrenceCache[key];\r\n    if (cached == null) {\r\n      cached = { itemId: this.getId(), params };\r\n      this._itemOccurrenceCache[key] = cached;\r\n    }\r\n    // @ts-expect-error The transformations may add a \"tags\"\r\n    if (cached.tags != null) {\r\n      delete cached[\"tags\"];\r\n    }\r\n    return cached;\r\n  };\r\n\r\n  getItemEffect(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    effectId: string,\r\n    neutralValue?: number,\r\n  ): number {\r\n    const baseEffects = this.getCachedBaseItemEffects(params);\r\n    const baseEffect = baseEffects[effectId];\r\n    if (baseEffect == null || baseEffect?.value == neutralValue) {\r\n      return neutralValue;\r\n    }\r\n    return applyTransformationsCached(\r\n      this.getTagsByEffect(effectId, baseEffect),\r\n      state,\r\n      baseEffect.value,\r\n      this.getMemoizedItemOccurrence(params),\r\n    );\r\n  }\r\n\r\n  getItemEffects(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    onlyId?: string,\r\n  ): Record<string, number> {\r\n    const baseEffects = this.getCachedBaseItemEffects(params);\r\n    const finalEffects: Record<string, number> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = applyTransformationsCached(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.getMemoizedItemOccurrence(params),\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  explanationParams = memoize((params, baseEffect) => ({\r\n    itemId: this.getId(),\r\n    params: params,\r\n    valueType: baseEffect.valueType,\r\n    unit: baseEffect.unit,\r\n  }));\r\n\r\n  getItemEffectExplanations(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    onlyId?: string,\r\n  ): Record<string, string> {\r\n    const baseEffects = this.getCachedBaseItemEffects(params);\r\n    const finalEffects: Record<string, string> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = explainTransformationsText(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.explanationParams(params, baseEffect),\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  getSalePrice(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    extraTags?: string[],\r\n  ): number {\r\n    const basePrice = this.getBaseSalePrice(state, params);\r\n    return applyTransformations(\r\n      [\r\n        TransformationTags.ItemSalePrice,\r\n        ...this.getTransformationTags(),\r\n        ...(extraTags ?? []),\r\n      ],\r\n      state,\r\n      basePrice,\r\n      this.getMemoizedItemOccurrence(params),\r\n    );\r\n  }\r\n\r\n  getPrimaryAction(\r\n    _state: GameState,\r\n    _params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getSellOneAction(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    extraTags?: string[],\r\n  ): ItemAction | undefined {\r\n    const salePrice = this.getSalePrice(state, params, extraTags);\r\n    const amount = getAmountOfItem(\r\n      this.getMemoizedItemOccurrence(params),\r\n      state,\r\n    );\r\n\r\n    return amount >= 1\r\n      ? saleActionOne(this.getId(), params, salePrice)\r\n      : undefined;\r\n  }\r\n\r\n  getSaleActions(state: GameState, params: ItemParams): ItemAction[] {\r\n    const salePrice = this.getSalePrice(state, params);\r\n    const amount = getAmountOfItem(\r\n      this.getMemoizedItemOccurrence(params),\r\n      state,\r\n    );\r\n    const remainingCoinCap =\r\n      getResourceCap(state, Resource.Coins) -\r\n      getResourceAmount(state, Resource.Coins);\r\n    const canSellLess =\r\n      remainingCoinCap < salePrice * amount &&\r\n      salePrice > 0 &&\r\n      remainingCoinCap > 0;\r\n    const saleActions = [\r\n      amount > 1 ? saleActionOne(this.getId(), params, salePrice) : null,\r\n      canSellLess\r\n        ? saleActionMany(\r\n            this.getId(),\r\n            params,\r\n            salePrice,\r\n            Math.ceil(remainingCoinCap / salePrice),\r\n            false,\r\n          )\r\n        : null,\r\n      saleActionMany(this.getId(), params, salePrice, amount, true),\r\n    ];\r\n    return saleActions.filter(\r\n      (saleAction) => saleAction != null,\r\n    ) as ItemAction[];\r\n  }\r\n\r\n  getQuickbarAction(\r\n    state: GameState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    if (!this.getPrimaryAction(state, params)) {\r\n      return undefined;\r\n    }\r\n    return quickbarAction(\r\n      this.getId(),\r\n      params,\r\n      !isInQuickbar(state, {\r\n        type: \"item\",\r\n        occurrence: this.getMemoizedItemOccurrence(params),\r\n      }) && !isQuickbarFull(state),\r\n    );\r\n  }\r\n\r\n  getCombineActions(state: GameState, params: ItemParams): ItemAction[] {\r\n    const extraActions = [];\r\n    if (\r\n      this.isItemQualityValid() &&\r\n      isItemQualityUnlocked(state) &&\r\n      (params?.itemQuality ?? 0) < getMaxItemQuality(state)\r\n    ) {\r\n      const amountOfItem = getAmountOfItem(\r\n        { itemId: this.getId(), params: params },\r\n        state,\r\n      );\r\n      const neededItemsToCombine = getAmountNeededForCombining(state);\r\n      if (amountOfItem >= neededItemsToCombine) {\r\n        extraActions.push(combineActionOne(this.getId(), params));\r\n      }\r\n      if (amountOfItem >= neededItemsToCombine * 2) {\r\n        extraActions.push(\r\n          combineActionMany(\r\n            this.getId(),\r\n            params,\r\n            Math.floor(amountOfItem / neededItemsToCombine),\r\n          ),\r\n        );\r\n      }\r\n    }\r\n    return extraActions;\r\n  }\r\n\r\n  isItemQualityValid(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getExtraActions(state: GameState, params: ItemParams): ItemAction[] {\r\n    return [];\r\n  }\r\n\r\n  getDefaultParams(): ItemParams {\r\n    return {};\r\n  }\r\n}\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ItemEffect]],\r\n  \"itemQualityBonus\",\r\n  t(\"Item Quality\"),\r\n  TransformationType.Multiplier,\r\n  (state, params, previousValue) => {\r\n    if (previousValue <= 0) {\r\n      return 1.0;\r\n    }\r\n    return Math.pow(1.1, params?.params?.itemQuality ?? 0);\r\n  },\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ItemSalePrice]],\r\n  \"itemQualitySalePrice\",\r\n  t(\"Item Quality\"),\r\n  TransformationType.Multiplier,\r\n  (state, params, previousValue) => {\r\n    if (previousValue <= 0) {\r\n      return 1.0;\r\n    }\r\n    return Math.pow(1.5, params?.params?.itemQuality ?? 0);\r\n  },\r\n);\r\n","import mem from \"mem\";\r\nimport { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport {\r\n  EquipmentSlot,\r\n  canEquipItem,\r\n  equipToSlot,\r\n  getEquippedItem,\r\n  getEquippedItems,\r\n} from \"../Equipment\";\r\nimport { Item, ItemAction, ItemOccurrence, ItemParams, ItemTag } from \"../Item\";\r\nimport { ItemTagEnum } from \"../ItemTagEnum\";\r\nimport { Items } from \"../Items\";\r\n\r\nconst memoizedEquip = mem(\r\n  (\r\n    canEquipItem: boolean,\r\n    slot: EquipmentSlot,\r\n    id: string,\r\n    params: ItemParams,\r\n  ) => {\r\n    return {\r\n      id: \"equip\",\r\n      description: t(\"Equip\"),\r\n      isEnabled: canEquipItem,\r\n      transform: (state: GameState) => {\r\n        state = equipToSlot(state, slot, {\r\n          itemId: id,\r\n          params,\r\n        });\r\n        return state;\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nexport abstract class EquippableItem extends Item {\r\n  abstract getSlot(): EquipmentSlot;\r\n\r\n  getTags(): ItemTag[] {\r\n    return [ItemTagEnum.Equipment, this.getSlot() as unknown as ItemTagEnum];\r\n  }\r\n\r\n  getExtraSlots(): EquipmentSlot[] {\r\n    return [];\r\n  }\r\n\r\n  getEquippedParams(state: GameState): ItemParams | undefined {\r\n    const equippedItem = getEquippedItem(state, this.getSlot());\r\n    if (equippedItem.itemId != this.getId()) {\r\n      return;\r\n    }\r\n    return equippedItem.params;\r\n  }\r\n\r\n  getEquippedItemEffect(\r\n    state: GameState,\r\n    onlyId?: string,\r\n  ): Record<string, number> {\r\n    const equippedItem = getEquippedItems(state, this.getSlot()).find(\r\n      (item) => item?.itemId == this.getId(),\r\n    );\r\n    if (equippedItem == null) {\r\n      return;\r\n    }\r\n    return this.getItemEffects(state, equippedItem.params, onlyId);\r\n  }\r\n\r\n  getPrimaryAction(\r\n    state: GameState,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    return memoizedEquip(\r\n      canEquipItem(state, this.getSlot(), { itemId: this.getId(), params }),\r\n      this.getSlot(),\r\n      this.getId(),\r\n      params,\r\n    );\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  attackTags = [CombatStat.Attack];\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  defenseTags = [CombatStat.Defense];\r\n\r\n  getMaxHPBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  maxHPTags = [CombatStat.MaxHP];\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  manaRegenTags = [Resource.Mana, TransformationTags.Production];\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  maxManaTags = [Resource.Mana, TransformationTags.PerItemCap];\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  attackDelayTags = [CombatStat.AttackDelay];\r\n\r\n  getPlayerAccuracyBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  accuracyTags = [CombatStat.Accuracy];\r\n\r\n  getPlayerDodgeBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  dodgeTags = [CombatStat.Dodge];\r\n\r\n  getPlayerCritChanceBonusBase(params: ItemParams): number {\r\n    return 0;\r\n  }\r\n\r\n  critTags = [CombatStat.Crit];\r\n\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  protected getBaseItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    const bonuses: Record<string, ActionEffect> = {\r\n      attack: {\r\n        value: this.getAttackBonusBase(params),\r\n        tags: this.attackTags,\r\n        unit: t(\":attack:\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n      defense: {\r\n        value: this.getDefenseBonusBase(params),\r\n        tags: this.defenseTags,\r\n        unit: t(\":defense:\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n      maxHP: {\r\n        value: this.getMaxHPBonusBase(params),\r\n        tags: this.maxHPTags,\r\n        unit: t(\" Max:hp:\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n      manaRegen: {\r\n        value: this.getManaRegenBonusBase(params),\r\n        tags: this.manaRegenTags,\r\n        unit: t(\":mana:/sec\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n      maxMana: {\r\n        value: this.getMaxManaBonusBase(params),\r\n        tags: this.maxManaTags,\r\n        unit: t(\" Max:mana:\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n      attackDelay: {\r\n        value: 1.0 / (1.0 + this.getAttackDelayBonusRatioBase(params)) - 1.0,\r\n        tags: this.attackDelayTags,\r\n        unit: t(\":attackDelay:\"),\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n      accuracy: {\r\n        value: this.getPlayerAccuracyBonusBase(params),\r\n        tags: this.accuracyTags,\r\n        unit: t(\":accuracy:\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n      dodge: {\r\n        value: this.getPlayerDodgeBonusBase(params),\r\n        tags: this.dodgeTags,\r\n        unit: t(\":dodge:\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n      crit: {\r\n        value: this.getPlayerCritChanceBonusBase(params),\r\n        tags: this.critTags,\r\n        unit: t(\":critChance:\"),\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n    };\r\n\r\n    for (let key in bonuses) {\r\n      if (bonuses[key].value == 0) {\r\n        delete bonuses[key];\r\n      }\r\n    }\r\n\r\n    const extra = this.getBaseExtraItemEffects(params);\r\n    return {\r\n      ...bonuses,\r\n      ...extra,\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return this.getEffectBase(state, params);\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getEffectBase(state: GameState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    const effectExplanations = this.getItemEffectExplanations(state, params);\r\n\r\n    const bonuses: Record<string, number> = {\r\n      attack: effects.attack ?? 0,\r\n      defense: effects.defense ?? 0,\r\n      maxHP: effects.maxHP ?? 0,\r\n      manaRegen: effects.manaRegen ?? 0,\r\n      maxMana: effects.maxMana ?? 0,\r\n      attackDelay: 1.0 / ((effects.attackDelay ?? 0) + 1.0),\r\n      accuracy: effects.accuracy ?? 0,\r\n      dodge: effects.dodge ?? 0,\r\n      crit: effects.crit ?? 0,\r\n    };\r\n\r\n    const bonusStrings = Object.keys(bonuses).map((stat) => {\r\n      let value = bonuses?.[stat];\r\n      if (value == 0 || (value == 1.0 && stat == \"attackDelay\")) {\r\n        return null;\r\n      }\r\n      const explanation = effectExplanations?.[stat];\r\n      let prefix = \"+\";\r\n      if (value < 0) {\r\n        prefix = \"-\";\r\n        value = Math.abs(value);\r\n      }\r\n      switch (stat) {\r\n        case \"attack\":\r\n        case \"defense\":\r\n        case \"accuracy\":\r\n        case \"dodge\":\r\n          return t(\"^{{value}}^<{{explanation}}>{{statIcon}}\", {\r\n            value: prefix + formatNumber(value),\r\n            explanation,\r\n            statIcon: `:${stat}:`,\r\n          });\r\n        case \"crit\":\r\n          return t(\"^{{value}}^<{{explanation}}>{{statIcon}}\", {\r\n            value: prefix + formatNumber(value),\r\n            explanation,\r\n            statIcon: `:critChance:`,\r\n          });\r\n        case \"manaRegen\":\r\n          return t(\"^{{value}}^<{{explanation}}>:mana:/sec\", {\r\n            value: prefix + formatNumber(value),\r\n            explanation,\r\n          });\r\n        case \"maxHP\":\r\n          return t(\"^{{value}}^<{{explanation}}> Max:hp:\", {\r\n            value: prefix + formatNumber(value),\r\n            explanation,\r\n          });\r\n        case \"maxMana\":\r\n          return t(\"^{{value}}^<{{explanation}}> Max:mana:\", {\r\n            value: prefix + formatNumber(value),\r\n            explanation,\r\n          });\r\n        case \"attackDelay\":\r\n          return t(\"^{{value}}^<{{explanation}}>:attackDelay:\", {\r\n            value: formatMultiplier(value),\r\n            explanation,\r\n          });\r\n      }\r\n    });\r\n\r\n    const bonusEffect = this.getEffectExtra(state, params);\r\n    bonusStrings.push(bonusEffect);\r\n\r\n    return bonusStrings\r\n      .filter((bonusString) => bonusString != null)\r\n      .join(t(\", \"));\r\n  }\r\n\r\n  isEquippedWithAnyParams(state: GameState): boolean {\r\n    return getEquippedItems(state, this.getSlot()).some(\r\n      (item) => item?.itemId == this.getId(),\r\n    );\r\n  }\r\n\r\n  isItemQualityValid(): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\ntype EquippedItemFunction = (itemOccurrence: ItemOccurrence) => void;\r\n\r\nconst forEachEquippedItem = function (\r\n  state: GameState,\r\n  each: EquippedItemFunction,\r\n): void {\r\n  const equippedItemHand = getEquippedItem(state, EquipmentSlot.Hand);\r\n  const equippedItemBody = getEquippedItem(state, EquipmentSlot.Body);\r\n  const equippedItemAccessory = getEquippedItems(\r\n    state,\r\n    EquipmentSlot.Accessory,\r\n  );\r\n\r\n  [equippedItemHand, equippedItemBody, ...equippedItemAccessory.flat()].forEach(\r\n    (itemOccurrence) => {\r\n      if (itemOccurrence == null) {\r\n        return;\r\n      }\r\n      each(itemOccurrence);\r\n    },\r\n  );\r\n};\r\n\r\ntype EquippedItemBonus = (\r\n  state: GameState,\r\n  item: EquippableItem,\r\n  params: ItemParams,\r\n) => number;\r\n\r\nconst additiveTransform = (bonusFn: EquippedItemBonus) => {\r\n  return (state: GameState) => {\r\n    let total = 0;\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = Items.getById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const bonus = bonusFn(state, item, itemOccurrence.params);\r\n      if (bonus != 0) {\r\n        total += bonus;\r\n      }\r\n    });\r\n\r\n    return total;\r\n  };\r\n};\r\n\r\nconst multiplicativeTransform = (bonusFn: EquippedItemBonus) => {\r\n  return (state: GameState) => {\r\n    let totalMultiplier = 1.0;\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = Items.getById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const bonus = bonusFn(state, item, itemOccurrence.params);\r\n      if (bonus != 1.0) {\r\n        totalMultiplier *= bonus;\r\n      }\r\n    });\r\n\r\n    return totalMultiplier;\r\n  };\r\n};\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\"EquippableItem\", t(\"Equipped Items\"), (state) => {\r\n    const totalIncome: Partial<Record<Resource, number>> = {};\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = Items.getById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const manaRegen = item.getItemEffect(\r\n        state,\r\n        itemOccurrence.params,\r\n        \"manaRegen\",\r\n        0,\r\n      );\r\n      if (manaRegen != 0) {\r\n        totalIncome[Resource.Mana] =\r\n          (totalIncome?.[Resource.Mana] ?? 0) + manaRegen;\r\n      }\r\n    });\r\n    return totalIncome;\r\n  }),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  \"EquippableItemAttack\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getItemEffect(state, params, \"attack\", 0),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Defense]],\r\n  \"EquippableItemDefense\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getItemEffect(state, params, \"defense\", 0),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.MaxHP]],\r\n  \"EquippableItemMaxHP\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getItemEffect(state, params, \"maxHP\", 0),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n  \"EquippableItemAttackDelay\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Multiplier,\r\n  multiplicativeTransform(\r\n    (state, item, params) =>\r\n      1.0 / (item.getItemEffect(state, params, \"attackDelay\", 0) + 1.0),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Accuracy]],\r\n  \"EquippableItemAccuracy\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getItemEffect(state, params, \"accuracy\", 0),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Dodge]],\r\n  \"EquippableItemDodge\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getItemEffect(state, params, \"dodge\", 0),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Crit]],\r\n  \"EquippableItemCritChance\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Addition,\r\n  additiveTransform((state, item, params) =>\r\n    item.getItemEffect(state, params, \"crit\", 0),\r\n  ),\r\n);\r\n\r\nregisterTransformation(\r\n  [[Resource.Mana, TransformationTags.Cap]],\r\n  \"EquippableItemManaCap\",\r\n  t(\"Equipped Items\"),\r\n  TransformationType.Addition,\r\n  (state) => {\r\n    let capBonus = 0;\r\n    forEachEquippedItem(state, (itemOccurrence) => {\r\n      const item = Items.getById(itemOccurrence.itemId) as EquippableItem;\r\n\r\n      const maxManaBonus = item.getItemEffect(\r\n        state,\r\n        itemOccurrence.params,\r\n        \"maxMana\",\r\n        0,\r\n      );\r\n      if (maxManaBonus != 0) {\r\n        capBonus += maxManaBonus;\r\n      }\r\n    });\r\n\r\n    return capBonus;\r\n  },\r\n);\r\n","import mem from \"mem\";\r\nimport memoize from \"sonic-memoize\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { ExplorationStatus } from \"../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../exploration/ExplorationUtils\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { addGameStateListener } from \"../../GameStateListeners\";\r\nimport { hasTemporaryEffect } from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItems } from \"../Equipment\";\r\nimport { ItemAction, ItemParams } from \"../Item\";\r\nimport { Items } from \"../Items\";\r\nimport { EquippableItem } from \"./EquippableItem\";\r\n\r\nconst memoizedPrimary = mem(\r\n  (\r\n    enabled: boolean,\r\n    active: boolean,\r\n    id: string,\r\n    index: number,\r\n    params: ItemParams,\r\n  ) => {\r\n    return {\r\n      description: t(\"Use\"),\r\n      isEnabled: enabled,\r\n      isActive: active,\r\n      transform: (state: GameState) => {\r\n        // Re-check enabled\r\n        const item = Items.getById(id) as PouchItem;\r\n        const refreshedAction = item.getPouchItemAction(state, index, params);\r\n        if (refreshedAction?.isEnabled) {\r\n          state.run.exploration.pouchItemsUsesLeft[index] =\r\n            (state.run.exploration.pouchItemsUsesLeft[index] ??\r\n              item.getUsesPerCombat(state, params)) - 1;\r\n          state = (Items.getById(id) as PouchItem).doPouchItemEffect(\r\n            state,\r\n            params,\r\n          );\r\n        }\r\n        return state;\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\nexport abstract class PouchItem extends EquippableItem {\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Pouch;\r\n  }\r\n\r\n  abstract doPouchItemEffect(state: GameState, params: ItemParams): GameState;\r\n\r\n  getPouchItemAction(\r\n    state: GameState,\r\n    index: number,\r\n    params: ItemParams,\r\n  ): ItemAction | undefined {\r\n    const isStunned = hasTemporaryEffect(state, \"stun\");\r\n    const active = this.isActive(state);\r\n    const enabled =\r\n      !isStunned &&\r\n      getExplorationStatus(state) == ExplorationStatus.Combat &&\r\n      !hasUsedUpPouchItemThisCombat(state, index);\r\n    return memoizedPrimary(enabled, active, this.getId(), index, params);\r\n  }\r\n\r\n  // This function is called when a combat finishes\r\n  doCleanup(state: GameState, params: ItemParams): GameState {\r\n    return state;\r\n  }\r\n\r\n  shouldAutoUse(state: GameState, params: ItemParams): boolean {\r\n    return true;\r\n  }\r\n\r\n  getUsesPerCombatBase(params: ItemParams): number {\r\n    return 1;\r\n  }\r\n\r\n  getUsesPerCombatTags = memoize(() => [\r\n    ...this.getTransformationTags(),\r\n    TransformationTags.PouchItemUses,\r\n  ]);\r\n\r\n  getUsesPerCombat(state: GameState, params: ItemParams): number {\r\n    return Math.floor(\r\n      applyTransformations(\r\n        this.getUsesPerCombatTags(),\r\n        state,\r\n        this.getUsesPerCombatBase(params),\r\n        {\r\n          itemId: this.getId(),\r\n          params,\r\n        },\r\n      ),\r\n    );\r\n  }\r\n\r\n  getUsesPerCombatExplanation(state: GameState, params: ItemParams): string {\r\n    return explainTransformationsText(\r\n      this.getUsesPerCombatTags(),\r\n      state,\r\n      this.getUsesPerCombatBase(params),\r\n      { itemId: this.getId(), params },\r\n    );\r\n  }\r\n}\r\n\r\nexport function hasUsedUpPouchItemThisCombat(\r\n  state: GameState,\r\n  index: number,\r\n): boolean {\r\n  const usesLeft = state.run.exploration.pouchItemsUsesLeft?.[index];\r\n  return usesLeft <= 0;\r\n}\r\n\r\nexport function getUsesLeftForPouchItem(\r\n  state: GameState,\r\n  index: number,\r\n): number {\r\n  const usesLeft = state.run.exploration.pouchItemsUsesLeft?.[index];\r\n  if (usesLeft != null) {\r\n    return usesLeft;\r\n  }\r\n  const occurrence = getEquippedItems(state, EquipmentSlot.Pouch)[index];\r\n  if (occurrence == null) {\r\n    return 0;\r\n  }\r\n  const id = occurrence.itemId;\r\n  const params = occurrence.params;\r\n  const item = Items.getById(id) as PouchItem;\r\n  const uses = item.getUsesPerCombat(state, params);\r\n  state.run.exploration.pouchItemsUsesLeft[index] = uses;\r\n  return uses;\r\n}\r\n\r\nexport function loadPouch() {\r\n  addGameStateListener(\"pouchUser\", (state) => {\r\n    if (!state.global.autoUsePouch) {\r\n      return;\r\n    }\r\n    state.temp.isInPouch = true;\r\n    const pouchItems = getEquippedItems(state, EquipmentSlot.Pouch);\r\n    let used = false;\r\n    do {\r\n      used = false;\r\n      for (let index in pouchItems) {\r\n        // Shortcut for perf\r\n        if (\r\n          getExplorationStatus(state) != ExplorationStatus.Combat ||\r\n          hasUsedUpPouchItemThisCombat(state, Number.parseInt(index))\r\n        ) {\r\n          continue;\r\n        }\r\n        const itemOccurrence = pouchItems[index];\r\n        const item = Items.getByIdNullable(itemOccurrence?.itemId) as PouchItem;\r\n        if (!item) {\r\n          continue;\r\n        }\r\n        const action = item.getPouchItemAction(\r\n          state,\r\n          Number.parseInt(index),\r\n          itemOccurrence.params,\r\n        );\r\n        if (\r\n          action.isEnabled &&\r\n          item.shouldAutoUse(state, itemOccurrence.params)\r\n        ) {\r\n          state = action?.transform?.(state) ?? state;\r\n        }\r\n      }\r\n    } while (used);\r\n    state.temp.isInPouch = false;\r\n  });\r\n}\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { ItemTag, translateItemTag } from \"../../backend/items/Item\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function ItemTags(props: { tags: ItemTag[] }) {\r\n  const theme = useTheme();\r\n  return (\r\n    <View style={styles.tagRow}>\r\n      {props.tags.map((tag) => (\r\n        <View\r\n          style={[\r\n            styles.tagStyle,\r\n            {\r\n              backgroundColor: theme.colors.secondaryContainer,\r\n              borderColor: theme.colors.secondaryContainer,\r\n            },\r\n          ]}\r\n          key={tag}\r\n        >\r\n          <Text\r\n            doNotScaleFonts={true}\r\n            style={[\r\n              styles.tagTextStyle,\r\n              { color: theme.colors.onSecondaryContainer },\r\n            ]}\r\n          >\r\n            {translateItemTag(tag)}\r\n          </Text>\r\n        </View>\r\n      ))}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tagRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  tagStyle: {\r\n    textAlign: \"center\",\r\n    paddingHorizontal: 6,\r\n    borderRadius: 8,\r\n    height: 18,\r\n    marginRight: 4,\r\n  },\r\n  tagTextStyle: {\r\n    fontSize: 11,\r\n    lineHeight: 16,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { PouchItem } from \"../../backend/items/equipment/PouchItem\";\r\nimport { ItemStack } from \"../../backend/items/Item\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport { DescriptionViewer, EffectViewer } from \"../utility/Miscellaneous\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemTags } from \"./ItemTags\";\r\nimport { ItemTile } from \"./ItemTile\";\r\n\r\nexport interface ItemInfoProps {\r\n  itemStack: ItemStack;\r\n  showTile: boolean;\r\n}\r\n\r\nexport function ItemInfo(props: ItemInfoProps) {\r\n  const state = useContext(StateContext);\r\n\r\n  const { itemId, params } = props.itemStack.itemOccurrence;\r\n  const item = Items.getById(itemId);\r\n  const name = item.getName(params);\r\n  const description = item.getDescription(state, params);\r\n  const effect = item.getEffect(state, params);\r\n  const tags = item.getTags();\r\n  const usesPerCombat =\r\n    item instanceof PouchItem ? item.getUsesPerCombat(state, params) : null;\r\n  const usesPerCombatExplanation =\r\n    item instanceof PouchItem\r\n      ? item.getUsesPerCombatExplanation(state, params)\r\n      : null;\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.itemDetailsContainer}>\r\n        <View style={styles.main}>\r\n          <Text h3>\r\n            {name}\r\n            {props.itemStack.amount > 1 && ` (${props.itemStack.amount})`}\r\n          </Text>\r\n          <View style={styles.tagRow}>\r\n            <ItemTags tags={tags} />\r\n          </View>\r\n          {description && <DescriptionViewer>{description}</DescriptionViewer>}\r\n          {effect && <EffectViewer>{effect}</EffectViewer>}\r\n          {usesPerCombat && usesPerCombat > 1 && (\r\n            <Markdown>\r\n              {t(\"Can be used ^{{times}}^<{{explanation}}> times per combat\", {\r\n                times: formatNumber(usesPerCombat),\r\n                explanation: usesPerCombatExplanation,\r\n              })}\r\n            </Markdown>\r\n          )}\r\n        </View>\r\n        {props.showTile && (\r\n          <ItemTile\r\n            title={name}\r\n            icon={item.getId()}\r\n            quality={params?.itemQuality}\r\n            tooltipIdSuffix=\"itemInfo\"\r\n          />\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      name,\r\n      props.itemStack.amount,\r\n      JSON.stringify(tags),\r\n      description,\r\n      effect,\r\n      usesPerCombat,\r\n      params?.itemQuality,\r\n      item.getId(),\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  itemDetailsContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n  },\r\n  main: {\r\n    flex: 1,\r\n  },\r\n  tagRow: {\r\n    marginVertical: 4,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { isAutocastUnlocked } from \"../../backend/autocast/Autocast\";\r\nimport { getConcatenatedRequirements } from \"../../backend/events/progression/LevelUp\";\r\nimport { getTotalAmountOfItem } from \"../../backend/items/Inventory\";\r\nimport { TransmutationSpell } from \"../../backend/items/transmute/TransmutationSpell\";\r\nimport { translateElement } from \"../../backend/spells/Elements\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { CostViewer } from \"../utility/CostViewer\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport { SpellWizardsInfo } from \"../utility/SpellWizardsInfo\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemInfo } from \"./ItemInfo\";\r\n\r\nexport interface TransmuteSpellDetailsProps {\r\n  spell: TransmutationSpell;\r\n}\r\n\r\nexport function TransmuteSpellInfo(props: TransmuteSpellDetailsProps) {\r\n  const state = useContext(StateContext);\r\n\r\n  const spell = props.spell;\r\n  const item = spell.getItem();\r\n  const params = item.getDefaultParams();\r\n  const totalOwnedText = t(`Total owned: {{amount}}`, {\r\n    amount: getTotalAmountOfItem(item, state),\r\n  });\r\n  const cost = spell.getCraftingMaterials(state);\r\n  const isCraftable = spell.isVisible(state);\r\n\r\n  const theme = useTheme();\r\n\r\n  const concatenatedRequirements = getConcatenatedRequirements(spell);\r\n  const cannotCastText = t(\r\n    `You do not meet the requirements to cast this Transmutation spell. You need: {{requirements}}`,\r\n    { requirements: concatenatedRequirements },\r\n  );\r\n\r\n  const exp = spell.getMainExp(state);\r\n\r\n  const expGainText =\r\n    exp.element != null\r\n      ? t(\"Exp gain: +{{amount}} {{element}} exp\", {\r\n          amount: formatNumber(exp.expMax),\r\n          element: translateElement(exp.element),\r\n        })\r\n      : t(\"Exp gain: +{{min}}~{{max}} exp (various)\", {\r\n          min: formatNumber(exp.expMin),\r\n          max: formatNumber(exp.expMax),\r\n        });\r\n\r\n  const itemStack = useMemo(\r\n    () => ({\r\n      itemOccurrence: { itemId: item.getId(), params },\r\n      amount: 1,\r\n    }),\r\n    [item.getId()],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        <ItemInfo itemStack={itemStack} showTile={false} />\r\n        <Markdown>{totalOwnedText}</Markdown>\r\n        <Markdown>{expGainText}</Markdown>\r\n        <View style={styles.costContainer}>\r\n          <View style={styles.costTextContainer}>\r\n            <Markdown>{t(\"Cost:\")}</Markdown>\r\n          </View>\r\n          <CostViewer resources={cost.resources} items={cost.items} />\r\n        </View>\r\n        {!isCraftable && (\r\n          <View style={styles.actionRow}>\r\n            <Text\r\n              style={[styles.cannotCraftText, { color: theme.colors.error }]}\r\n            >\r\n              {cannotCastText}\r\n            </Text>\r\n          </View>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      itemStack,\r\n      totalOwnedText,\r\n      expGainText,\r\n      JSON.stringify(cost),\r\n      isCraftable,\r\n      cannotCastText,\r\n      theme,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function TransmuteSpellDetails(props: TransmuteSpellDetailsProps) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const spell = props.spell;\r\n  const item = spell.getItem();\r\n  const params = item.getDefaultParams();\r\n  const totalOwnedText = t(`Total owned: {{amount}}`, {\r\n    amount: getTotalAmountOfItem(item, state),\r\n  });\r\n\r\n  const cost = spell.getCraftingMaterials(state);\r\n  const canTransmute = spell.canCraft(state);\r\n  const isCraftable = spell.isVisible(state);\r\n  const theme = useTheme();\r\n\r\n  const concatenatedRequirements = getConcatenatedRequirements(spell);\r\n  const cannotCastText = t(\r\n    `You do not meet the requirements to cast this Transmutation spell. You need: {{requirements}}`,\r\n    { requirements: concatenatedRequirements },\r\n  );\r\n\r\n  const exp = spell.getMainExp(state);\r\n\r\n  const expGainText =\r\n    exp.element != null\r\n      ? t(\"Exp gain: +{{amount}} {{element}} exp\", {\r\n          amount: formatNumber(exp.expMax),\r\n          element: translateElement(exp.element),\r\n        })\r\n      : t(\"Exp gain: +{{min}}~{{max}} exp (various)\", {\r\n          min: formatNumber(exp.expMin),\r\n          max: formatNumber(exp.expMax),\r\n        });\r\n\r\n  const maxCraftAmount = spell.timesCraftable(state);\r\n\r\n  const transmuteCallback = useCallback(() => {\r\n    stateRef.current.apply(spell.doAction.bind(spell, {}));\r\n  }, [item]);\r\n\r\n  const transmuteMaxCallback = useCallback(() => {\r\n    stateRef.current.apply(spell.craftMax.bind(spell));\r\n  }, [item]);\r\n\r\n  const transmuteIntermediateCallback = useCallback(() => {\r\n    stateRef.current.apply(spell.craftIntermediate.bind(spell));\r\n  }, [item]);\r\n\r\n  const transmuteMaxVisible = maxCraftAmount > 1;\r\n\r\n  const transmuteIntermediateVisible =\r\n    spell.isCraftIntermediatePotentiallyPossible(state);\r\n  const transmuteIntermediateEnabled = spell.isCraftIntermediatePossible(state);\r\n\r\n  const itemStack = useMemo(\r\n    () => ({\r\n      itemOccurrence: { itemId: item.getId(), params },\r\n      amount: 1,\r\n    }),\r\n    [item.getId()],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.craftingDetailsContainer}>\r\n        <ItemInfo itemStack={itemStack} showTile={true} />\r\n        <Markdown>{totalOwnedText}</Markdown>\r\n        <Markdown>{expGainText}</Markdown>\r\n        <View style={styles.costContainer}>\r\n          <Markdown>{t(\"Cost:\")}</Markdown>\r\n          <CostViewer resources={cost.resources} items={cost.items} />\r\n        </View>\r\n        {isAutocastUnlocked(state) && (\r\n          <View style={Styles.mt4}>\r\n            <SpellWizardsInfo spellId={spell.getId()} />\r\n          </View>\r\n        )}\r\n        <View style={styles.actionRow}>\r\n          {isCraftable ? (\r\n            [\r\n              <Button\r\n                key=\"craft_button\"\r\n                enableAutoRepress={true}\r\n                autoRepressConfig={{\r\n                  dropoffMultiplier: 0.8,\r\n                  startingThreshold: 300,\r\n                  startingRepressTime: 200,\r\n                  minTimeMs: 50,\r\n                }}\r\n                disabled={!canTransmute}\r\n                onPress={transmuteCallback}\r\n              >\r\n                {t(\"Transmute\")}\r\n              </Button>,\r\n              transmuteMaxVisible && (\r\n                <Button\r\n                  key=\"craft_max\"\r\n                  disabled={!canTransmute}\r\n                  onPress={transmuteMaxCallback}\r\n                >\r\n                  {t(\"Transmute All ({{amount}})\", {\r\n                    amount: formatNumber(maxCraftAmount),\r\n                  })}\r\n                </Button>\r\n              ),\r\n              transmuteIntermediateVisible && (\r\n                <Button\r\n                  key=\"craft_intermediate\"\r\n                  onPress={transmuteIntermediateCallback}\r\n                  disabled={!transmuteIntermediateEnabled}\r\n                >\r\n                  {t(\"Transmute Materials\", {\r\n                    amount: formatNumber(maxCraftAmount),\r\n                  })}\r\n                </Button>\r\n              ),\r\n            ]\r\n          ) : (\r\n            <Text\r\n              style={[styles.cannotCraftText, { color: theme.colors.error }]}\r\n            >\r\n              {cannotCastText}\r\n            </Text>\r\n          )}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      itemStack,\r\n      totalOwnedText,\r\n      expGainText,\r\n      JSON.stringify(cost.resources),\r\n      JSON.stringify(cost.items),\r\n      isAutocastUnlocked(state),\r\n      canTransmute,\r\n      transmuteMaxVisible,\r\n      transmuteMaxCallback,\r\n      maxCraftAmount,\r\n      stateRef,\r\n      theme,\r\n      isCraftable,\r\n      transmuteIntermediateCallback,\r\n      transmuteIntermediateEnabled,\r\n      transmuteIntermediateVisible,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  craftingDetailsContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  tagRow: {\r\n    marginVertical: 4,\r\n  },\r\n  actionRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    marginTop: 8,\r\n    gap: 8,\r\n  },\r\n  actionButtonContainer: {\r\n    marginRight: 8,\r\n  },\r\n  costContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 4,\r\n  },\r\n  costTextContainer: {\r\n    marginRight: 8,\r\n  },\r\n  inventoryFullContainer: {\r\n    flex: 1,\r\n    marginHorizontal: 8,\r\n  },\r\n  cannotCraftText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  assignSpellcraftToVat,\r\n  canApplySpellcraftToSpell,\r\n} from \"../../backend/spellcraft/SpellcraftUtils\";\r\nimport { Spellcrafts } from \"../../backend/spellcraft/Spellcrafts\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ItemTile } from \"../inventory/ItemTile\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { CostViewer } from \"../utility/CostViewer\";\r\nimport { EffectViewer } from \"../utility/Miscellaneous\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function SpellcraftInfo(props: {\r\n  spellcraftId: string;\r\n  showTile: boolean;\r\n}) {\r\n  const state = useContext(StateContext);\r\n\r\n  const spellcraft = Spellcrafts.getById(props.spellcraftId);\r\n  const item = spellcraft.getBaseItem();\r\n  const cost = {\r\n    resources: {},\r\n    items: {},\r\n  };\r\n  cost.items[item.getId()] = 1000;\r\n\r\n  const theme = useTheme();\r\n\r\n  const effect = spellcraft.getEffect(state);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={styles.itemDetailsContainer}>\r\n          <View style={styles.main}>\r\n            <Text h3>{item.getDefaultName()}</Text>\r\n            {effect && <EffectViewer>{effect}</EffectViewer>}\r\n          </View>\r\n          {props.showTile && (\r\n            <ItemTile\r\n              title={spellcraft.getName()}\r\n              icon={item.getId()}\r\n              tooltipIdSuffix=\"spellcraftInfo\"\r\n              borderColor={theme.colors.outline}\r\n            />\r\n          )}\r\n        </View>\r\n        <View style={styles.costContainer}>\r\n          <View style={Styles.mr8}>\r\n            <Text>{t(\"Cost:\")}</Text>\r\n          </View>\r\n          <CostViewer resources={cost.resources} items={cost.items} />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [item.getId(), effect, JSON.stringify(cost), theme],\r\n  );\r\n}\r\n\r\nexport function SpellcraftDetails(props: {\r\n  vatId: string;\r\n  spellcraftId: string;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const vatId = props.vatId;\r\n  const spellcraft = Spellcrafts.getById(props.spellcraftId);\r\n  const item = spellcraft.getBaseItem();\r\n\r\n  const cost = {\r\n    resources: {},\r\n    items: {},\r\n  };\r\n  cost.items[item.getId()] = 1000;\r\n\r\n  const canAfford = spellcraft.canAfford(state);\r\n\r\n  const assignCallback = useCallback(() => {\r\n    stateRef.current.apply((state) =>\r\n      assignSpellcraftToVat(state, vatId, props.spellcraftId),\r\n    );\r\n  }, [item]);\r\n\r\n  const vat = state.run.spellcrafts[vatId];\r\n\r\n  const isAlreadyAssigned = vat.spellcraftId == props.spellcraftId;\r\n  const hasError = !canApplySpellcraftToSpell(state, vat.spellId, spellcraft);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.craftingDetailsContainer}>\r\n        <SpellcraftInfo spellcraftId={props.spellcraftId} showTile={true} />\r\n        <View style={styles.actionRow}>\r\n          <Button\r\n            key=\"assignButton\"\r\n            disabled={!canAfford || isAlreadyAssigned || hasError}\r\n            onPress={assignCallback}\r\n          >\r\n            {t(\"Spellcraft\")}\r\n          </Button>\r\n        </View>\r\n        {!isAlreadyAssigned && hasError && (\r\n          <View style={Styles.mt8}>\r\n            <Text style={{ color: theme.colors.error, fontStyle: \"italic\" }}>\r\n              {t(\r\n                \"You cannot assign this Spellcraft to the current spell! You may have only up to 2 separate Spellcrafts on a single spell. They must both be different, and unless the Spellcraft used is from items that you can Transmute using your Primary Element, the Spellcraft can only be used once across all spells!\",\r\n              )}\r\n            </Text>\r\n          </View>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      props.spellcraftId,\r\n      canAfford,\r\n      assignCallback,\r\n      isAlreadyAssigned,\r\n      hasError,\r\n      theme,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  craftingDetailsContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  actionRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    marginTop: 8,\r\n    gap: 8,\r\n  },\r\n  actionButtonContainer: {\r\n    marginRight: 8,\r\n  },\r\n  costContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 4,\r\n  },\r\n  costTextContainer: {\r\n    marginRight: 8,\r\n  },\r\n  inventoryFullContainer: {\r\n    flex: 1,\r\n    marginHorizontal: 8,\r\n  },\r\n  cannotCraftText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  itemDetailsContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n  },\r\n  main: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import React, { useContext, useMemo, useRef } from \"react\";\r\nimport {\r\n  Platform,\r\n  ScrollView,\r\n  StyleSheet,\r\n  View,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { ItemCompendiumInfo } from \"../../backend/items/ItemCompendium\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { TransmutationSpell } from \"../../backend/items/transmute/TransmutationSpell\";\r\nimport { Spellcrafts } from \"../../backend/spellcraft/Spellcrafts\";\r\nimport { Spells } from \"../../backend/spells/Spells\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { SpellcraftInfo } from \"../spellcraft/SpellcraftDetails\";\r\nimport { TransmuteSpellInfo } from \"./CraftingDetails\";\r\nimport { ItemInfo } from \"./ItemInfo\";\r\nimport { ItemTile } from \"./ItemTile\";\r\n\r\nexport interface ItemGridElement {\r\n  itemOrSpellId: string;\r\n  amount: number;\r\n  params: any;\r\n  disabled?: boolean;\r\n  disableTooltip?: boolean;\r\n  itemInfo?: ItemCompendiumInfo;\r\n}\r\n\r\nexport enum ItemGridElementUsage {\r\n  INVENTORY = \"INVENTORY\",\r\n  TRANSMUTE = \"TRANSMUTE\",\r\n  COMPENDIUM = \"COMPENDIUM\",\r\n  SPELLCRAFT = \"SPELLCRAFT\",\r\n}\r\n\r\nexport interface ItemGridProps {\r\n  items: ItemGridElement[];\r\n  location?: ItemGridElementUsage;\r\n  onPressItem?: (itemGridElement: ItemGridElement) => void;\r\n  onDoublePressItem?: (itemGridElement: ItemGridElement) => void;\r\n  overrideMaxHeight?: number;\r\n}\r\n\r\nfunction ItemGridTooltipUnmemoized(props: {\r\n  item: ItemGridElement | undefined;\r\n  location: ItemGridElementUsage | undefined;\r\n}) {\r\n  if (props.item == null || props.location == ItemGridElementUsage.COMPENDIUM) {\r\n    return null;\r\n  }\r\n  const itemGridElement = props.item;\r\n  return useMemo(() => {\r\n    if (props.location == ItemGridElementUsage.TRANSMUTE) {\r\n      const spell = Spells.getById(\r\n        itemGridElement.itemOrSpellId,\r\n      ) as TransmutationSpell;\r\n      return <TransmuteSpellInfo spell={spell} />;\r\n    } else if (props.location == ItemGridElementUsage.SPELLCRAFT) {\r\n      return (\r\n        <SpellcraftInfo\r\n          showTile={false}\r\n          spellcraftId={Spellcrafts.getAll()\r\n            .find(\r\n              (spellcraft) =>\r\n                spellcraft.getBaseItem().getId() ==\r\n                itemGridElement.itemOrSpellId,\r\n            )\r\n            .getId()}\r\n        />\r\n      );\r\n    }\r\n    const item = Items.getById(itemGridElement.itemOrSpellId);\r\n    return (\r\n      <ItemInfo\r\n        itemStack={{\r\n          itemOccurrence: {\r\n            itemId: item.getId(),\r\n            params: itemGridElement.params,\r\n          },\r\n          amount: itemGridElement.amount,\r\n        }}\r\n        showTile={false}\r\n      />\r\n    );\r\n  }, [JSON.stringify(itemGridElement), props.location]);\r\n}\r\n\r\nconst ItemGridTooltip = React.memo(\r\n  ItemGridTooltipUnmemoized,\r\n  (prevProps, nextProps) =>\r\n    JSON.stringify(prevProps) == JSON.stringify(nextProps),\r\n);\r\n\r\nfunction ItemGridElementUnmemoized(props: {\r\n  itemGridElement: ItemGridElement;\r\n  location: ItemGridElementUsage;\r\n  index: number;\r\n  onPress: (item: ItemGridElement) => void;\r\n  onDoublePress: (item: ItemGridElement) => void;\r\n}) {\r\n  const { itemGridElement, index, onPress, onDoublePress } = props;\r\n  const item =\r\n    props.location == ItemGridElementUsage.TRANSMUTE\r\n      ? (\r\n          Spells.getById(itemGridElement.itemOrSpellId) as TransmutationSpell\r\n        ).getItem()\r\n      : Items.getById(itemGridElement.itemOrSpellId);\r\n  const accessibilityMarker = useMemo(() => {\r\n    let accessibilityMarker: React.ReactNode = null;\r\n    if (index % 10 == 0) {\r\n      accessibilityMarker = (\r\n        <View\r\n          style={styles.accessibilityHidden}\r\n          accessible={true}\r\n          accessibilityLabel={t(\"Item list position {{index}}\", {\r\n            index: index + 1,\r\n          })}\r\n          accessibilityRole=\"header\"\r\n          // @ts-ignore This prop is supported\r\n          accessibilityLevel={5}\r\n          accessibilityElementsHidden={false}\r\n        />\r\n      );\r\n    }\r\n    return accessibilityMarker;\r\n  }, [index]);\r\n  const tooltip = useMemo(\r\n    () =>\r\n      itemGridElement.disableTooltip || Platform.OS != \"web\" ? null : (\r\n        <ItemGridTooltip item={itemGridElement} location={props.location} />\r\n      ),\r\n    [itemGridElement, props.location],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        {accessibilityMarker}\r\n        <ItemTile\r\n          title={item.getName(itemGridElement.params)}\r\n          onPress={onPress ? onPress.bind(null, itemGridElement) : undefined}\r\n          onDoublePress={\r\n            onDoublePress\r\n              ? onDoublePress.bind(null, itemGridElement)\r\n              : undefined\r\n          }\r\n          icon={item.getId()}\r\n          quality={itemGridElement?.params?.itemQuality}\r\n          disabled={itemGridElement.disabled}\r\n          amount={itemGridElement.amount}\r\n          tooltipIdSuffix={props.location}\r\n          tooltip={tooltip}\r\n        />\r\n      </View>\r\n    ),\r\n    [\r\n      accessibilityMarker,\r\n      itemGridElement,\r\n      tooltip,\r\n      onPress,\r\n      onDoublePress,\r\n      props.location,\r\n    ],\r\n  );\r\n}\r\n\r\nconst ItemGridTile = React.memo(ItemGridElementUnmemoized);\r\n\r\nexport function ItemGrid(props: ItemGridProps) {\r\n  const theme = useTheme();\r\n  const state = useContext(StateContext);\r\n  const { height, width } = useWindowDimensions();\r\n  const estimatedMaxHeight = Math.max(220, height - 80 - 300 - 300);\r\n  let stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const topContainerStyle = useMemo(\r\n    () => [styles.container, { borderColor: theme.colors.outlineVariant }],\r\n    [theme],\r\n  );\r\n  const scrollViewStyle = useMemo(\r\n    () => [\r\n      props.overrideMaxHeight != null\r\n        ? {\r\n            maxHeight: props.overrideMaxHeight,\r\n          }\r\n        : { maxHeight: estimatedMaxHeight },\r\n    ],\r\n    [props.overrideMaxHeight, estimatedMaxHeight],\r\n  );\r\n  const insideContainerStyle = useMemo(\r\n    () => [styles.gridContainer, { backgroundColor: theme.colors.background }],\r\n    [theme],\r\n  );\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={topContainerStyle}>\r\n        <ScrollView style={scrollViewStyle} nestedScrollEnabled={true}>\r\n          <View style={insideContainerStyle}>\r\n            {props.items.map((itemGridElement, index) => (\r\n              <ItemGridTile\r\n                key={\r\n                  itemGridElement.itemOrSpellId +\r\n                  JSON.stringify(itemGridElement.params)\r\n                }\r\n                itemGridElement={itemGridElement}\r\n                index={index}\r\n                onPress={props.onPressItem}\r\n                onDoublePress={props.onDoublePressItem}\r\n                location={props.location}\r\n              />\r\n            ))}\r\n          </View>\r\n        </ScrollView>\r\n      </View>\r\n    );\r\n  }, [\r\n    JSON.stringify(props.items),\r\n    props.onPressItem,\r\n    props.onDoublePressItem,\r\n    props.location,\r\n    topContainerStyle,\r\n    scrollViewStyle,\r\n    theme,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    borderWidth: 2,\r\n  },\r\n  scrollView: {\r\n    maxHeight: 220,\r\n  },\r\n  gridContainer: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"center\",\r\n    flex: 1,\r\n  },\r\n  accessibilityHidden: {\r\n    width: 1,\r\n    height: 1,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { Platform } from \"expo-modules-core\";\r\nimport React from \"react\";\r\nimport { StyleProp, StyleSheet } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport RNPicker from \"react-native-picker-select\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { useAuxOptions } from \"./AuxOptionsContext\";\r\n\r\nfunction DropDownIcon() {\r\n  const theme = useTheme();\r\n  return (\r\n    <MaterialIcons\r\n      name=\"arrow-drop-down\"\r\n      size={24}\r\n      color={theme.colors.onPrimary}\r\n    />\r\n  );\r\n}\r\n\r\nexport type PickerData = { key: string; label: string; value: string };\r\n\r\nexport function Picker(props: {\r\n  selectedValue: string;\r\n  onValueChange: (itemValue: string, itemIndex: number) => void;\r\n  data: PickerData[];\r\n  disablePlaceholder?: boolean;\r\n  maxLength?: number;\r\n  style?: StyleProp<any>;\r\n}) {\r\n  const { style, selectedValue, ...rest } = props;\r\n  const theme = useTheme();\r\n  const auxOptions = useAuxOptions();\r\n  return (\r\n    <RNPicker\r\n      {...rest}\r\n      style={{\r\n        inputAndroidContainer: {\r\n          backgroundColor: theme.colors.primary,\r\n          padding: 8,\r\n          paddingVertical: auxOptions.compactLayout ? 0 : 8,\r\n          paddingRight: 32,\r\n          borderRadius: 4,\r\n        },\r\n        inputAndroid: StyleSheet.flatten([\r\n          {\r\n            color: theme.colors.onPrimary,\r\n          },\r\n          style,\r\n        ]),\r\n        iconContainer: {\r\n          top: auxOptions.compactLayout ? 2 : 10,\r\n          right: 4,\r\n          width: Platform.OS === \"web\" ? 0 : 24,\r\n          display: Platform.OS === \"web\" ? \"none\" : \"flex\",\r\n        },\r\n        viewContainer: StyleSheet.flatten([\r\n          Platform.OS === \"web\"\r\n            ? {\r\n                alignSelf: \"center\",\r\n              }\r\n            : undefined,\r\n          style,\r\n        ]),\r\n        placeholder: {\r\n          color: theme.colors.onPrimary,\r\n        },\r\n      }}\r\n      placeholder={props.disablePlaceholder ? {} : { label: t(\"Select...\") }}\r\n      fixAndroidTouchableBug={true}\r\n      // @ts-expect-error Icon is not properly typed\r\n      Icon={DropDownIcon}\r\n      value={selectedValue}\r\n      useNativeAndroidPickerStyle={false}\r\n      dropdownIconColor={theme.colors.onBackground}\r\n      dropdownIconRippleColor={theme.colors.onBackground}\r\n      textInputProps={props.maxLength && { maxLength: props.maxLength }}\r\n      items={props.data}\r\n    ></RNPicker>\r\n  );\r\n}\r\n","import React, { useCallback, useState } from \"react\";\r\n\r\nexport type UIContextValue = {\r\n  getUIState: (id: string) => any;\r\n  setUIState: (id: string, value: any) => void;\r\n};\r\n\r\nexport const UIContext = React.createContext<UIContextValue>({\r\n  getUIState: (id: string) => null,\r\n  setUIState: (id: string, value: any) => {},\r\n});\r\n\r\nexport function useUIStateFromContext<T>(\r\n  context: UIContextValue,\r\n  key: string,\r\n  initialValue: T,\r\n): [T, (value: T) => void] {\r\n  const currentValue = context.getUIState(key) ?? initialValue;\r\n  const [stateValue, setStateValue] = useState<T>(currentValue);\r\n  const setCurrentValue = useCallback(\r\n    (value: T) => {\r\n      setStateValue(value);\r\n      context.setUIState(key, value);\r\n    },\r\n    [context, key, setStateValue],\r\n  );\r\n\r\n  return [stateValue as T, setCurrentValue];\r\n}\r\n","import { t } from \"i18next\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { TextInput } from \"react-native-paper\";\r\nimport { Flag } from \"../backend/Flag\";\r\nimport { hasFlag } from \"../backend/Flags\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport {\r\n  addGameStateListener,\r\n  clearGameStateListener,\r\n} from \"../backend/GameStateListeners\";\r\nimport { isEnhancementUnlocked } from \"../backend/enhancement/Enhancements\";\r\nimport { isExplorationUnlocked } from \"../backend/exploration/Exploration\";\r\nimport { translateItemTag } from \"../backend/items/Item\";\r\nimport { ItemTagEnum } from \"../backend/items/ItemTagEnum\";\r\nimport {\r\n  TransmutationSpell,\r\n  getAllTransmutationSpellsEverCastable,\r\n} from \"../backend/items/transmute/TransmutationSpell\";\r\nimport {\r\n  getElementLevel,\r\n  getUnlockedElements,\r\n} from \"../backend/spells/Elements\";\r\nimport { Spells } from \"../backend/spells/Spells\";\r\nimport { fromEntries } from \"../utils/CoreUtils\";\r\nimport { TransmuteSpellDetails } from \"./inventory/CraftingDetails\";\r\nimport {\r\n  ItemGrid,\r\n  ItemGridElement,\r\n  ItemGridElementUsage,\r\n} from \"./inventory/ItemGrid\";\r\nimport { Button } from \"./utility/Button\";\r\nimport { CheckBox } from \"./utility/CheckBox\";\r\nimport { Picker as UtilityPicker } from \"./utility/Picker\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"./utility/UIContext\";\r\nimport { VisibilityContext } from \"./utility/VisibilityContext\";\r\n\r\nexport const ITEM_TAG_ORDER = [\r\n  ItemTagEnum.Material,\r\n  ItemTagEnum.Hand,\r\n  ItemTagEnum.Body,\r\n  ItemTagEnum.Accessory,\r\n  ItemTagEnum.Consumable,\r\n  ItemTagEnum.Equipment,\r\n  ItemTagEnum.Familiar,\r\n  ItemTagEnum.QuestItem,\r\n];\r\n\r\nexport default function Transmute() {\r\n  const state = useContext(StateContext);\r\n  const uiContext = useContext(UIContext);\r\n  const [selectedElement, setSelectedElement] = useState(\r\n    null as ItemGridElement | null,\r\n  );\r\n  const [selectedTag, setSelectedTag] = useUIStateFromContext(\r\n    uiContext,\r\n    \"CraftingTag\",\r\n    \"All\",\r\n  );\r\n  const maxElementLevels = state.world.maxElementLevels;\r\n  const currentElementLevels = fromEntries(\r\n    getUnlockedElements(state).map((element) => [\r\n      element,\r\n      getElementLevel(state, element),\r\n    ]),\r\n  );\r\n  let castableSpells = useMemo(() => {\r\n    const allItems = getAllTransmutationSpellsEverCastable(state);\r\n    return allItems;\r\n  }, [\r\n    JSON.stringify(maxElementLevels),\r\n    isExplorationUnlocked(state),\r\n    isEnhancementUnlocked(state),\r\n    hasFlag(state, Flag.DeepCavernsUnlocked),\r\n    hasFlag(state, Flag.LostForestUnlocked),\r\n  ]);\r\n\r\n  const tags = useMemo(() => {\r\n    const tagSet = new Set<string>();\r\n    castableSpells.forEach((spell) => {\r\n      const tags = spell.getItem().getTags();\r\n      tags.forEach((tag) => tagSet.add(tag));\r\n    });\r\n    const tags = Array.from(tagSet).sort((a, b) => {\r\n      const indexA = ITEM_TAG_ORDER.findIndex((tag) => tag == a);\r\n      const indexB = ITEM_TAG_ORDER.findIndex((tag) => tag == b);\r\n      return indexA - indexB;\r\n    });\r\n    return tags;\r\n  }, [castableSpells]);\r\n\r\n  useEffect(() => {\r\n    if (!tags.includes(selectedTag)) {\r\n      setSelectedTag(\"All\");\r\n    }\r\n  }, [tags.join(), selectedTag]);\r\n\r\n  useEffect(() => setSelectedElement(null), [selectedTag]);\r\n\r\n  const selectedElementRef = useRef(selectedElement);\r\n  selectedElementRef.current = selectedElement;\r\n\r\n  const visible = useContext(VisibilityContext);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      addGameStateListener(\r\n        \"TransmutationComponent\",\r\n        (newState) => {\r\n          setSelectedElement(null);\r\n        },\r\n        (state) =>\r\n          getAllTransmutationSpellsEverCastable(state)\r\n            .map((item) => item.getId())\r\n            .join(),\r\n      );\r\n      return () => clearGameStateListener(\"TransmutationComponent\");\r\n    }\r\n  }, [visible]);\r\n\r\n  const onPressItem = React.useCallback(\r\n    (item: ItemGridElement) => {\r\n      setSelectedElement(item);\r\n    },\r\n    [setSelectedElement],\r\n  );\r\n\r\n  const tagButtons = useMemo(() => {\r\n    return (\r\n      <UtilityPicker\r\n        onValueChange={setSelectedTag}\r\n        style={styles.picker}\r\n        selectedValue={selectedTag}\r\n        data={[\"All\", ...tags].map((tag) => ({\r\n          label: tag == \"All\" ? t(\"All\") : translateItemTag(tag as ItemTagEnum),\r\n          value: tag,\r\n          key: tag,\r\n        }))}\r\n        disablePlaceholder={true}\r\n      />\r\n    );\r\n  }, [setSelectedTag, selectedTag, JSON.stringify(tags)]);\r\n\r\n  const sortedCastableSpells = useMemo(\r\n    () =>\r\n      castableSpells\r\n        .filter(\r\n          (spell) =>\r\n            selectedTag === \"All\" ||\r\n            spell\r\n              .getItem()\r\n              .getTags()\r\n              .includes(selectedTag as ItemTagEnum),\r\n        )\r\n        .sort((a, b) => {\r\n          const firstTagA = ITEM_TAG_ORDER.findIndex((tag) =>\r\n            a\r\n              .getItem()\r\n              .getTags()\r\n              .includes(tag as ItemTagEnum),\r\n          );\r\n          const firstTagB = ITEM_TAG_ORDER.findIndex((tag) =>\r\n            b\r\n              .getItem()\r\n              .getTags()\r\n              .includes(tag as ItemTagEnum),\r\n          );\r\n          if (firstTagA != firstTagB) {\r\n            return firstTagA - firstTagB;\r\n          }\r\n          const maxA = Math.max(\r\n            ...(Object.values(a.getLevelRequirements()).filter(\r\n              (n) => n != undefined,\r\n            ) as number[]),\r\n          );\r\n          const maxB = Math.max(\r\n            ...(Object.values(b.getLevelRequirements()).filter(\r\n              (n) => n != undefined,\r\n            ) as number[]),\r\n          );\r\n          return maxA - maxB;\r\n        }),\r\n    [selectedTag, castableSpells],\r\n  );\r\n\r\n  const [hideLocked, setHideLocked] = useUIStateFromContext(\r\n    uiContext,\r\n    \"crafting_hide_locked\",\r\n    false,\r\n  );\r\n\r\n  const toggleLockedCallback = useCallback(() => {\r\n    setHideLocked(!hideLocked);\r\n  }, [hideLocked, setHideLocked]);\r\n\r\n  useEffect(() => setSelectedElement(null), [hideLocked]);\r\n\r\n  const [filterText, setFilterText] = useState(\"\");\r\n  useEffect(() => setSelectedElement(null), [filterText]);\r\n\r\n  const [filterTextTemp, setFilterTextTemp] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const timeout = setTimeout(() => setFilterText(filterTextTemp), 400);\r\n    return () => clearTimeout(timeout);\r\n  }, [filterTextTemp]);\r\n\r\n  const itemGridElements = useMemo(\r\n    () =>\r\n      sortedCastableSpells.map((spell) => ({\r\n        itemOrSpellId: spell.getId(),\r\n        amount: 1,\r\n        params: spell.getItem().getDefaultParams(),\r\n        disabled: !spell.isVisible(state),\r\n      })),\r\n    [\r\n      JSON.stringify(maxElementLevels),\r\n      JSON.stringify(currentElementLevels),\r\n      sortedCastableSpells,\r\n    ],\r\n  );\r\n\r\n  const itemGridElementsJSON = useMemo(\r\n    () => JSON.stringify(itemGridElements),\r\n    [itemGridElements],\r\n  );\r\n\r\n  const isAnyLocked = useMemo(() => {\r\n    return itemGridElements.some((element) => element.disabled);\r\n  }, [itemGridElementsJSON]);\r\n\r\n  const itemGridElementsFiltered = useMemo(() => {\r\n    let elements = itemGridElements;\r\n    if (hideLocked) {\r\n      elements = elements.filter(\r\n        (itemGridElement) => !itemGridElement.disabled,\r\n      );\r\n    }\r\n    if (filterText.length >= 3) {\r\n      elements = elements.filter((itemGridElement) => {\r\n        return Spells.getById(itemGridElement.itemOrSpellId)\r\n          .getSpellName()\r\n          .toLowerCase()\r\n          .includes(filterText.toLowerCase());\r\n      });\r\n    }\r\n    return elements.map((element, index) => ({\r\n      ...element,\r\n      disableTooltip: selectedElement?.itemOrSpellId == element.itemOrSpellId,\r\n    }));\r\n  }, [itemGridElementsJSON, hideLocked, selectedElement, filterText]);\r\n\r\n  const itemGridElementsFilteredJSON = useMemo(\r\n    () => JSON.stringify(itemGridElementsFiltered),\r\n    [itemGridElementsFiltered],\r\n  );\r\n\r\n  const selectedSpell =\r\n    selectedElement != null\r\n      ? (Spells.getById(selectedElement?.itemOrSpellId) as TransmutationSpell)\r\n      : undefined;\r\n\r\n  const itemGrid = useMemo(\r\n    () => (\r\n      <ItemGrid\r\n        items={itemGridElementsFiltered}\r\n        location={ItemGridElementUsage.TRANSMUTE}\r\n        onPressItem={onPressItem}\r\n      />\r\n    ),\r\n    [itemGridElementsFilteredJSON, onPressItem],\r\n  );\r\n\r\n  const details = useMemo(\r\n    () => (\r\n      <View style={styles.detailsContainer}>\r\n        {selectedSpell && <TransmuteSpellDetails spell={selectedSpell} />}\r\n      </View>\r\n    ),\r\n    [selectedSpell?.getId()],\r\n  );\r\n\r\n  const clearFilter = useCallback(() => {\r\n    setFilterText(\"\");\r\n    setFilterTextTemp(\"\");\r\n  }, []);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.container}>\r\n        <View style={[Styles.flexRowSpaceBetween, Styles.mb8, Styles.ph8]}>\r\n          <View style={[styles.tagPickerContainer]}>{tagButtons}</View>\r\n          {isAnyLocked && (\r\n            <CheckBox\r\n              title={t(\"Hide locked\")}\r\n              checked={hideLocked}\r\n              onPress={toggleLockedCallback}\r\n              containerStyle={styles.checkboxContainer}\r\n            />\r\n          )}\r\n        </View>\r\n        <View style={[Styles.flexRowAlignCenter, Styles.mb8, Styles.ph8]}>\r\n          <Text>{t(\"Filter:\")}</Text>\r\n          <TextInput\r\n            style={[Styles.ml8, { minWidth: 180 }]}\r\n            mode=\"outlined\"\r\n            dense={true}\r\n            value={filterTextTemp}\r\n            onChangeText={setFilterTextTemp}\r\n          />\r\n          {filterTextTemp.length > 0 && (\r\n            <Button onPress={clearFilter} compact={true} style={Styles.ml8}>\r\n              {t(\"Clear\")}\r\n            </Button>\r\n          )}\r\n        </View>\r\n        {itemGrid}\r\n        {details}\r\n      </View>\r\n    ),\r\n    [\r\n      tagButtons,\r\n      isAnyLocked,\r\n      hideLocked,\r\n      toggleLockedCallback,\r\n      itemGrid,\r\n      details,\r\n      filterTextTemp,\r\n      setFilterTextTemp,\r\n      clearFilter,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n    paddingTop: 16,\r\n  },\r\n  detailsContainer: {\r\n    marginTop: 16,\r\n    paddingHorizontal: 8,\r\n    paddingBottom: 8,\r\n  },\r\n  buttonGroupContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    height: undefined,\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"flex-start\",\r\n    borderWidth: 0,\r\n  },\r\n  buttonGroupButtonContainer: {\r\n    flex: 1,\r\n    height: 40,\r\n    borderWidth: 1,\r\n    borderColor: \"#eee\",\r\n    margin: 4,\r\n  },\r\n  picker: {\r\n    flex: 1,\r\n  },\r\n  tagPickerContainer: {\r\n    width: Platform.OS != \"web\" ? 180 : null,\r\n    ...Platform.select({\r\n      android: { backgroundColor: \"#eee\", borderRadius: 10, default: {} },\r\n    }),\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n    flexWrap: \"wrap\",\r\n    marginBottom: 16,\r\n    paddingHorizontal: 8,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    padding: 0,\r\n    maxWidth: 140,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n});\r\n","import { useMemo } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport { getConcatenatedRequirements } from \"../../backend/events/progression/LevelUp\";\r\nimport { ItemCompendiumInfo } from \"../../backend/items/ItemCompendium\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ItemInfo } from \"../inventory/ItemInfo\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\n\r\nexport function ItemCompendiumDetails(props: { info: ItemCompendiumInfo }) {\r\n  const info = props.info;\r\n  const item = info.item;\r\n  const params = item.getDefaultParams();\r\n  const spell = info.transmuteSpell;\r\n\r\n  const howToObtainStrings = [];\r\n  if (spell != null) {\r\n    const concatenatedRequirements = getConcatenatedRequirements(spell);\r\n    howToObtainStrings.push(\r\n      t(\"Transmutation ({{requirements}})\", {\r\n        requirements: concatenatedRequirements,\r\n      }),\r\n    );\r\n  }\r\n  info.knownLootFromEnemies.forEach((lootInfo) =>\r\n    howToObtainStrings.push(\r\n      lootInfo.lootChance != null\r\n        ? t(\"{{enemyName}} ({{chance}}% to get {{amount}})\", {\r\n            enemyName: lootInfo.enemy.getName(),\r\n            amount: lootInfo.amount,\r\n            chance: formatNumber(lootInfo.lootChance * 100, {\r\n              showDecimals: true,\r\n            }),\r\n          })\r\n        : t(\"{{enemyName}} (???)\", { enemyName: lootInfo.enemy.getName() }),\r\n    ),\r\n  );\r\n\r\n  const howToObtainText = t(\"How to obtain: *{{howToObtain}}*\", {\r\n    howToObtain:\r\n      howToObtainStrings.length > 0\r\n        ? howToObtainStrings.join(t(\", \"))\r\n        : t(\"Unknown\"),\r\n  });\r\n\r\n  const howToObtainComponent = useMemo(\r\n    () => (\r\n      <View>\r\n        <Markdown>{howToObtainText}</Markdown>\r\n      </View>\r\n    ),\r\n    [howToObtainText],\r\n  );\r\n\r\n  const itemStack = useMemo(\r\n    () => ({\r\n      itemOccurrence: { itemId: item.getId(), params },\r\n      amount: 1,\r\n    }),\r\n    [item.getId()],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        <ItemInfo itemStack={itemStack} showTile={true} />\r\n        {howToObtainComponent}\r\n      </View>\r\n    ),\r\n    [itemStack, howToObtainComponent],\r\n  );\r\n}\r\n","import { t } from \"i18next\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { TextInput } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { translateItemTag } from \"../../backend/items/Item\";\r\nimport { getAllKnownItemCompendiumInfos } from \"../../backend/items/ItemCompendium\";\r\nimport { ItemTagEnum } from \"../../backend/items/ItemTagEnum\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { ITEM_TAG_ORDER } from \"../Transmute\";\r\nimport {\r\n  ItemGrid,\r\n  ItemGridElement,\r\n  ItemGridElementUsage,\r\n} from \"../inventory/ItemGrid\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { Picker as UtilityPicker } from \"../utility/Picker\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"../utility/UIContext\";\r\nimport { ItemCompendiumDetails } from \"./ItemCompendiumDetails\";\r\n\r\nexport default function ItemCompendium() {\r\n  const state = useContext(StateContext);\r\n  const uiContext = useContext(UIContext);\r\n  const [selectedElement, setSelectedElement] = useState(\r\n    null as ItemGridElement | null,\r\n  );\r\n  const [selectedTag, setSelectedTag] = useUIStateFromContext(\r\n    uiContext,\r\n    \"CompendiumTag\",\r\n    \"All\",\r\n  );\r\n  let visibleItemInfos = getAllKnownItemCompendiumInfos(state);\r\n\r\n  const tags = useMemo(() => {\r\n    const tagSet = new Set<string>();\r\n    visibleItemInfos.forEach((info) => {\r\n      const tags = info.item.getTags();\r\n      tags.forEach((tag) => tagSet.add(tag));\r\n    });\r\n    const tags = Array.from(tagSet).sort((a, b) => {\r\n      const indexA = ITEM_TAG_ORDER.findIndex((tag) => tag == a);\r\n      const indexB = ITEM_TAG_ORDER.findIndex((tag) => tag == b);\r\n      return indexA - indexB;\r\n    });\r\n    return tags;\r\n  }, [visibleItemInfos]);\r\n\r\n  useEffect(() => {\r\n    if (!tags.includes(selectedTag)) {\r\n      setSelectedTag(\"All\");\r\n    }\r\n  }, [tags.join(), selectedTag]);\r\n\r\n  useEffect(() => setSelectedElement(null), [selectedTag]);\r\n\r\n  const selectedElementRef = useRef(selectedElement);\r\n  selectedElementRef.current = selectedElement;\r\n\r\n  useEffect(() => {\r\n    setSelectedElement(null);\r\n  }, [visibleItemInfos]);\r\n\r\n  const onPressItem = React.useCallback(\r\n    (item: ItemGridElement) => {\r\n      setSelectedElement(item);\r\n    },\r\n    [setSelectedElement],\r\n  );\r\n\r\n  const tagButtons = useMemo(() => {\r\n    return (\r\n      <UtilityPicker\r\n        onValueChange={setSelectedTag}\r\n        style={styles.picker}\r\n        selectedValue={selectedTag}\r\n        data={[\"All\", ...tags].map((tag) => ({\r\n          label: tag == \"All\" ? t(\"All\") : translateItemTag(tag as ItemTagEnum),\r\n          value: tag,\r\n          key: tag,\r\n        }))}\r\n      />\r\n    );\r\n  }, [setSelectedTag, selectedTag, JSON.stringify(tags)]);\r\n\r\n  const sortedItemInfos = useMemo(\r\n    () =>\r\n      visibleItemInfos\r\n        .filter(\r\n          (info) =>\r\n            selectedTag === \"All\" ||\r\n            info.item.getTags().includes(selectedTag as ItemTagEnum),\r\n        )\r\n        .sort((a, b) => {\r\n          const firstTagA = ITEM_TAG_ORDER.findIndex((tag) =>\r\n            a.item.getTags().includes(tag as ItemTagEnum),\r\n          );\r\n          const firstTagB = ITEM_TAG_ORDER.findIndex((tag) =>\r\n            b.item.getTags().includes(tag as ItemTagEnum),\r\n          );\r\n          if (firstTagA != firstTagB) {\r\n            return firstTagA - firstTagB;\r\n          }\r\n          if (a.transmuteSpell != null && b.transmuteSpell == null) {\r\n            return 1;\r\n          } else if (a.transmuteSpell == null && b.transmuteSpell != null) {\r\n            return -1;\r\n          } else if (a.transmuteSpell == null && b.transmuteSpell == null) {\r\n            return 0;\r\n          }\r\n\r\n          const maxA = Math.max(\r\n            ...(Object.values(a.transmuteSpell.getLevelRequirements()).filter(\r\n              (n) => n != undefined,\r\n            ) as number[]),\r\n          );\r\n          const maxB = Math.max(\r\n            ...(Object.values(b.transmuteSpell.getLevelRequirements()).filter(\r\n              (n) => n != undefined,\r\n            ) as number[]),\r\n          );\r\n          return maxA - maxB;\r\n        }),\r\n    [selectedTag, visibleItemInfos],\r\n  );\r\n\r\n  const [filterText, setFilterText] = useState(\"\");\r\n  useEffect(() => setSelectedElement(null), [filterText]);\r\n\r\n  const [filterTextTemp, setFilterTextTemp] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const timeout = setTimeout(() => setFilterText(filterTextTemp), 400);\r\n    return () => clearTimeout(timeout);\r\n  }, [filterTextTemp]);\r\n\r\n  const itemGridElements = useMemo(\r\n    () =>\r\n      sortedItemInfos.map((info) => ({\r\n        itemOrSpellId: info.item.getId(),\r\n        amount: 1,\r\n        params: info.item.getDefaultParams(),\r\n        disabled: false,\r\n        itemInfo: info,\r\n      })),\r\n    [sortedItemInfos],\r\n  );\r\n\r\n  const itemGridElementsFiltered = useMemo(() => {\r\n    let elements = itemGridElements;\r\n    if (filterText.length >= 3) {\r\n      elements = elements.filter((itemGridElement) => {\r\n        return Items.getById(itemGridElement.itemOrSpellId)\r\n          .getDefaultName()\r\n          .toLowerCase()\r\n          .includes(filterText.toLowerCase());\r\n      });\r\n    }\r\n    return elements.map((element, index) => ({\r\n      ...element,\r\n      disableTooltip: true,\r\n    }));\r\n  }, [itemGridElements, selectedElement, filterText]);\r\n\r\n  const selectedItemInfo = selectedElement;\r\n\r\n  const itemGrid = useMemo(\r\n    () => (\r\n      <ItemGrid\r\n        items={itemGridElementsFiltered}\r\n        location={ItemGridElementUsage.COMPENDIUM}\r\n        onPressItem={onPressItem}\r\n      />\r\n    ),\r\n    [itemGridElementsFiltered, onPressItem],\r\n  );\r\n\r\n  const details = useMemo(\r\n    () => (\r\n      <View style={styles.detailsContainer}>\r\n        {selectedItemInfo && (\r\n          <ItemCompendiumDetails info={selectedItemInfo.itemInfo} />\r\n        )}\r\n      </View>\r\n    ),\r\n    [selectedItemInfo?.itemOrSpellId],\r\n  );\r\n\r\n  const clearFilter = useCallback(() => {\r\n    setFilterText(\"\");\r\n    setFilterTextTemp(\"\");\r\n  }, []);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.container}>\r\n        <View style={[Styles.flexRowSpaceBetween, Styles.mb8, Styles.ph8]}>\r\n          <View style={[styles.tagPickerContainer]}>{tagButtons}</View>\r\n        </View>\r\n        <View style={[Styles.flexRowAlignCenter, Styles.mb8, Styles.ph8]}>\r\n          <Text>{t(\"Filter:\")}</Text>\r\n          <TextInput\r\n            style={[Styles.ml8, { minWidth: 180 }]}\r\n            mode=\"outlined\"\r\n            dense={true}\r\n            value={filterTextTemp}\r\n            onChangeText={setFilterTextTemp}\r\n          />\r\n          {filterTextTemp.length > 0 && (\r\n            <Button onPress={clearFilter} compact={true} style={Styles.ml8}>\r\n              {t(\"Clear\")}\r\n            </Button>\r\n          )}\r\n        </View>\r\n        {itemGrid}\r\n        {details}\r\n      </View>\r\n    ),\r\n    [\r\n      tagButtons,\r\n      itemGrid,\r\n      details,\r\n      filterTextTemp,\r\n      setFilterTextTemp,\r\n      clearFilter,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n    paddingTop: 16,\r\n  },\r\n  detailsContainer: {\r\n    marginTop: 16,\r\n    paddingHorizontal: 8,\r\n    paddingBottom: 8,\r\n  },\r\n  buttonGroupContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    height: undefined,\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"flex-start\",\r\n    borderWidth: 0,\r\n  },\r\n  buttonGroupButtonContainer: {\r\n    flex: 1,\r\n    height: 40,\r\n    borderWidth: 1,\r\n    borderColor: \"#eee\",\r\n    margin: 4,\r\n  },\r\n  picker: {\r\n    flex: 1,\r\n  },\r\n  tagPickerContainer: {\r\n    width: Platform.OS != \"web\" ? 180 : null,\r\n    ...Platform.select({\r\n      android: { backgroundColor: \"#eee\", borderRadius: 10, default: {} },\r\n    }),\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n    flexWrap: \"wrap\",\r\n    marginBottom: 16,\r\n    paddingHorizontal: 8,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    padding: 0,\r\n    maxWidth: 140,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n});\r\n","import React, { useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { SegmentedButtons } from \"react-native-paper\";\r\nimport { t } from \"../utils/I18n\";\r\nimport Bestiary from \"./compendium/Bestiary\";\r\nimport ItemCompendium from \"./compendium/ItemCompendium\";\r\nimport { GameStateFreezer } from \"./utility/GameStateFreezer\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function Compendium() {\r\n  const [selectedTab, setSelectedTab] = useState(\"item\");\r\n  const buttons = useMemo(\r\n    () => [\r\n      { value: \"item\", label: t(\"Items\") },\r\n      { value: \"bestiary\", label: t(\"Bestiary\") },\r\n    ],\r\n    [],\r\n  );\r\n  const buttonSelectors = (\r\n    <SegmentedButtons\r\n      value={selectedTab}\r\n      onValueChange={setSelectedTab}\r\n      buttons={buttons}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <View>\r\n      <View style={styles.headerContainer}>\r\n        <Text h1>{t(\"Compendium\")}</Text>\r\n      </View>\r\n\r\n      {buttonSelectors}\r\n\r\n      <View style={Styles.mt16}>\r\n        <View style={selectedTab != \"item\" && { display: \"none\" }}>\r\n          <GameStateFreezer isVisible={selectedTab == \"item\"}>\r\n            <ItemCompendium />\r\n          </GameStateFreezer>\r\n        </View>\r\n        <View style={selectedTab != \"bestiary\" && { display: \"none\" }}>\r\n          <GameStateFreezer isVisible={selectedTab == \"bestiary\"}>\r\n            <Bestiary />\r\n          </GameStateFreezer>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  headerContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  captionText: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { Audio } from \"expo-av\";\r\n\r\nconst soundMap: Record<string, any> = {\r\n  menuClick: require(\"./menu/click.wav\"),\r\n};\r\n\r\nclass AudioManager {\r\n  sampleMap: Record<string, Audio.Sound> = {};\r\n\r\n  async load(): Promise<void> {\r\n    await Audio.setIsEnabledAsync(true);\r\n    await Promise.all(\r\n      Object.keys(soundMap).map(async (audioId) => {\r\n        const audioSample = soundMap[audioId];\r\n        const audioSound = new Audio.Sound();\r\n        await audioSound.loadAsync(audioSample);\r\n        this.sampleMap[audioId] = audioSound;\r\n      }),\r\n    );\r\n  }\r\n\r\n  play(audioId: string) {\r\n    this.sampleMap[audioId].replayAsync();\r\n    this.sampleMap[audioId].replayAsync();\r\n  }\r\n}\r\n\r\nexport default new AudioManager();\r\n","import { getEventMessageById } from \"./events/Events\";\r\nimport { GameState } from \"./GameState\";\r\nimport { hasTemporaryEffect } from \"./temporaryeffects/TemporaryEffects\";\r\n\r\nexport function cleanup(state: GameState): GameState {\r\n  // Cleanup events\r\n  const events = Object.values(state.run.eventOccurrences).sort(\r\n    (a, b) => b.timestamp - a.timestamp,\r\n  );\r\n  const terminalEvents = events.filter((event) => {\r\n    return (\r\n      event.currentMessageId &&\r\n      getEventMessageById(event.currentMessageId).isTerminal()\r\n    );\r\n  });\r\n  const oldEventOccurrenceIds = terminalEvents\r\n    .slice(20)\r\n    .map((eventOccurrence) => eventOccurrence.eventOccurrenceId);\r\n  oldEventOccurrenceIds.forEach((eventOccurrenceId) => {\r\n    delete state.run.eventOccurrences[eventOccurrenceId];\r\n  });\r\n\r\n  // Cleanup old temporary effect\r\n  for (const key in state.run.temporaryEffects) {\r\n    const temporaryEffect = state.run.temporaryEffects[key];\r\n    if (\r\n      !hasTemporaryEffect(state, temporaryEffect.id, temporaryEffect.target)\r\n    ) {\r\n      delete state.run.temporaryEffects[key];\r\n    }\r\n  }\r\n\r\n  // Cleanup old action results\r\n  state.run.exploration.actionResultQueue =\r\n    state.run.exploration.actionResultQueue.slice(-10);\r\n\r\n  return state;\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { registerTimeTickListener } from \"../../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { GameEvent } from \"../GameEvent\";\r\n\r\nexport type RandomEvent = {\r\n  event: GameEvent;\r\n  weight: number;\r\n  eligible?: (state: GameState) => boolean;\r\n  getParams?: (state: GameState) => any;\r\n};\r\n\r\nconst randomEvents: Record<string, RandomEvent> = {};\r\n\r\nexport function registerRandomEventTrigger(\r\n  event: GameEvent,\r\n  weight: number,\r\n  eligible?: (state: GameState) => boolean,\r\n  getParams?: (state: GameState) => any,\r\n): void {\r\n  randomEvents[event.getId()] = {\r\n    event,\r\n    weight,\r\n    eligible,\r\n    getParams,\r\n  };\r\n}\r\n\r\nconst PITY_COUNTER_THRESHOLD = 60 * 60 * 3; // 3 hours\r\nconst PITY_COUNTER_SECOND_THRESHOLD = 60 * 60 * 6; // 6 hours\r\nconst PITY_COUNTER_VARIANCE = 0.3;\r\nconst PITY_MULTIPLIER = 40;\r\nconst PITY_MAX_PER_RUN = 2;\r\n\r\nfunction registerPity(state: GameState): GameState {\r\n  state.run.pityCounter += 1;\r\n  const nextPitySec =\r\n    PITY_COUNTER_SECOND_THRESHOLD +\r\n    (Math.random() - 0.5) *\r\n      (PITY_COUNTER_SECOND_THRESHOLD * PITY_COUNTER_VARIANCE);\r\n  state.run.pityEnabledAtSeconds = getSecondsPlayed(state) + nextPitySec;\r\n  return state;\r\n}\r\n\r\nexport function isInPity(state: GameState): boolean {\r\n  return (\r\n    state.run.pityCounter < PITY_MAX_PER_RUN &&\r\n    getSecondsPlayed(state) > (state.run.pityEnabledAtSeconds ?? Infinity)\r\n  );\r\n}\r\n\r\nconst randomEventWeightTags = [TransformationTags.RandomEventWeight];\r\n\r\nexport function triggerRandomEvent(state: GameState): GameState {\r\n  // Initialize the pity counter, if needed\r\n  if (state.run.pityEnabledAtSeconds === undefined) {\r\n    const nextPitySec =\r\n      PITY_COUNTER_THRESHOLD +\r\n      (Math.random() - 0.5) * (PITY_COUNTER_THRESHOLD * PITY_COUNTER_VARIANCE);\r\n    state.run.pityEnabledAtSeconds = getSecondsPlayed(state) + nextPitySec;\r\n  }\r\n  const eventsThatApply = Object.values(randomEvents).filter(\r\n    (randomEvent) => !randomEvent.eligible || randomEvent.eligible(state),\r\n  );\r\n  if (eventsThatApply.length === 0) {\r\n    return state;\r\n  }\r\n  const totalWeight = eventsThatApply.reduce((sumToNow, randomEvent) => {\r\n    const weight = applyTransformations(\r\n      randomEventWeightTags,\r\n      state,\r\n      randomEvent.weight,\r\n      { randomEvent: randomEvent },\r\n    );\r\n    return sumToNow + weight;\r\n  }, 0);\r\n  let eventRoll = Math.random() * totalWeight;\r\n  for (let idx in eventsThatApply) {\r\n    const event = eventsThatApply[idx];\r\n    const weight = applyTransformations(\r\n      randomEventWeightTags,\r\n      state,\r\n      event.weight,\r\n      { randomEvent: event },\r\n    );\r\n    eventRoll -= weight;\r\n    if (eventRoll < 0) {\r\n      const params = event.getParams ? event.getParams(state) : {};\r\n      if (event.event.getStorylines().length > 0) {\r\n        state = registerPity(state);\r\n      }\r\n      return triggerEvent(event.event, params)(state);\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function debugRandomEvents(state: GameState): Record<string, number> {\r\n  const eventsThatApply = Object.values(randomEvents).filter(\r\n    (randomEvent) => !randomEvent.eligible || randomEvent.eligible(state),\r\n  );\r\n  const totalWeight = eventsThatApply.reduce((sumToNow, randomEvent) => {\r\n    const weight = applyTransformations(\r\n      randomEventWeightTags,\r\n      state,\r\n      randomEvent.weight,\r\n      { randomEvent: randomEvent },\r\n    );\r\n    return sumToNow + weight;\r\n  }, 0);\r\n  const chancesPerEvent: Record<string, number> = {};\r\n  eventsThatApply.forEach((event) => {\r\n    const weight = applyTransformations(\r\n      randomEventWeightTags,\r\n      state,\r\n      event.weight,\r\n      { randomEvent: event },\r\n    );\r\n    chancesPerEvent[event.event.getId()] = weight / totalWeight;\r\n  });\r\n  return chancesPerEvent;\r\n}\r\n\r\nexport function loadRandomEventTriggers(): void {\r\n  registerTransformation(\r\n    [[TransformationTags.RandomEventWeight]],\r\n    \"PityEventChance\",\r\n    t(\"Storyline Pity\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      const randomEvent: RandomEvent = params.randomEvent;\r\n      if (randomEvent.event.getStorylines().length > 0 && isInPity(state)) {\r\n        return PITY_MULTIPLIER;\r\n      }\r\n      return 1.0;\r\n    },\r\n  );\r\n  registerTimeTickListener(\r\n    \"RandomEventTriggers\",\r\n    (state: GameState, elapsedSec: number) => {\r\n      const secsPlayed = getSecondsPlayed(state) + state.run.extraEventSecs;\r\n      if (secsPlayed > (state.run.nextRandomEvent || 0)) {\r\n        state = triggerRandomEvent(state);\r\n\r\n        // The next random event will occur in 8 to 12 minutes. However,\r\n        // this period becomes longer and longer as more seconds have been played\r\n        // in the current run: 40 to 60 mins after 24 hours, for example.\r\n        // This rewards quickly triggering random events after retirement and\r\n        // prevents low quality random event spam later in the game.\r\n        // This is capped at 24 in-game hours.\r\n        const periodMultiplier = Math.max(\r\n          1.0 + Math.min(secsPlayed, 60 * 60 * 24) / (60 * 60 * 6),\r\n          1.0,\r\n        );\r\n        state.run.nextRandomEvent =\r\n          (8 + Math.random() * 4) * 60 * periodMultiplier + secsPlayed;\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import { openURL } from \"expo-linking\";\r\nimport { GameState } from \"../backend/GameState\";\r\nimport { loadBase64Data, serializeSaveData } from \"../backend/SaveData\";\r\nimport { isElectron } from \"./ElectronUtils\";\r\nimport { t } from \"./I18n\";\r\n\r\nexport type LoadResult =\r\n  | {\r\n      result: \"success\";\r\n      data: GameState;\r\n    }\r\n  | {\r\n      result: \"cancel\";\r\n    }\r\n  | {\r\n      result: \"error\";\r\n      error: string;\r\n    };\r\n\r\nexport type TranslationsLoadResult =\r\n  | {\r\n      result: \"success\";\r\n      data: Record<string, string>;\r\n    }\r\n  | {\r\n      result: \"cancel\";\r\n    }\r\n  | {\r\n      result: \"error\";\r\n      error: string;\r\n    };\r\n\r\nexport type SaveResult =\r\n  | {\r\n      result: \"success\";\r\n    }\r\n  | {\r\n      result: \"cancel\";\r\n    }\r\n  | {\r\n      result: \"error\";\r\n      error: string;\r\n    };\r\n\r\nexport const SAVE_TO_FILE_SUPPORTED = true;\r\nexport const LOAD_FROM_FILE_SUPPORTED = isElectron();\r\n\r\nexport async function loadSaveFromFile(): Promise<LoadResult> {\r\n  if (!isElectron()) {\r\n    return { result: \"error\", error: \"Not implemented\" };\r\n  }\r\n\r\n  try {\r\n    // @ts-expect-error window.showOpenFilePicker() is available in Electron\r\n    const [fileHandle] = await window.showOpenFilePicker();\r\n    if (fileHandle != null) {\r\n      const file = await fileHandle.getFile();\r\n      const resultContents = await file.text();\r\n      const unserialized = await loadBase64Data(resultContents);\r\n      if (unserialized != null) {\r\n        return { result: \"success\", data: unserialized };\r\n      }\r\n      return {\r\n        result: \"error\",\r\n        error: t(\"Failed decompressing and decoding the file\"),\r\n      };\r\n    }\r\n  } catch (e) {\r\n    return {\r\n      result: \"error\",\r\n      error: t(\r\n        \"Found unexpected error reading from the filesystem or deserializing\",\r\n      ),\r\n    };\r\n  }\r\n  return { result: \"cancel\" };\r\n}\r\n\r\nexport async function loadTranslationsFromFile(): Promise<TranslationsLoadResult> {\r\n  if (!isElectron()) {\r\n    return { result: \"error\", error: \"Not implemented\" };\r\n  }\r\n\r\n  try {\r\n    // @ts-expect-error window.showOpenFilePicker() is available in Electron\r\n    const [fileHandle] = await window.showOpenFilePicker();\r\n    if (fileHandle != null) {\r\n      const file = await fileHandle.getFile();\r\n      const resultContents = await file.text();\r\n      try {\r\n        const unserialized = JSON.parse(resultContents);\r\n        if (unserialized != null) {\r\n          return { result: \"success\", data: unserialized };\r\n        }\r\n        return {\r\n          result: \"error\",\r\n          error: t(\"Unknown error parsing the file\"),\r\n        };\r\n      } catch (e) {\r\n        return {\r\n          result: \"error\",\r\n          error: t(\"Error parsing the translation file\"),\r\n        };\r\n      }\r\n    }\r\n  } catch (e) {\r\n    return {\r\n      result: \"error\",\r\n      error: t(\"Found unexpected error reading from the filesystem\"),\r\n    };\r\n  }\r\n  return { result: \"cancel\" };\r\n}\r\n\r\nexport async function saveToFile(state: GameState): Promise<SaveResult> {\r\n  const serializedData = await serializeSaveData(state);\r\n  await openURL(\"data:application/octet-stream;utf8,\" + serializedData);\r\n  return { result: \"success\" };\r\n}\r\n","import { getDocumentAsync } from \"expo-document-picker\";\r\nimport * as FileSystem from \"expo-file-system\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { I18nManager, Platform, StyleSheet, View } from \"react-native\";\r\nimport { Card, TextInput } from \"react-native-paper\";\r\nimport AudioManager from \"../audio/AudioManager\";\r\nimport { cleanup } from \"../backend/Cleanup\";\r\nimport { clearFlag, hasFlag, setFlag } from \"../backend/Flags\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { Resource, grantResource } from \"../backend/Resources\";\r\nimport {\r\n  loadBase64Data,\r\n  makeCompatible,\r\n  saveDataUnsafe,\r\n} from \"../backend/SaveData\";\r\nimport { getAllGameEvents, triggerEvent } from \"../backend/events/Events\";\r\nimport { debugRandomEvents } from \"../backend/events/autorandom/RandomEventTrigger\";\r\nimport { AttackTarget } from \"../backend/exploration/AttackTarget\";\r\nimport {\r\n  CombatStat,\r\n  clearCombatStatCache,\r\n} from \"../backend/exploration/CombatStats\";\r\nimport { SpellElement, grantElementExp } from \"../backend/spells/Elements\";\r\nimport { Storylines } from \"../backend/storylines/Storylines\";\r\nimport { getSecondsPlayed } from \"../backend/timetick/TotalTimePlayed\";\r\nimport {\r\n  TransformationType,\r\n  explainTransformations,\r\n  registerTransformation,\r\n} from \"../backend/transformation/Transformation\";\r\nimport { keysOf } from \"../utils/CoreUtils\";\r\nimport { saveToFile } from \"../utils/FilesystemSave\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { Storage } from \"../utils/Storage\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { Picker } from \"./utility/Picker\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function Debug() {\r\n  const events = getAllGameEvents();\r\n  const storylines = Storylines.getAll();\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const [selectedEvent, setSelectedEvent] = useState(\"\");\r\n\r\n  const picker = useMemo(\r\n    () => (\r\n      <Picker\r\n        onValueChange={(value) => setSelectedEvent(value)}\r\n        selectedValue={selectedEvent}\r\n        data={Object.values(events).map((event, idx) => ({\r\n          label: event.getId(),\r\n          value: event.getId(),\r\n          key: event.getId(),\r\n        }))}\r\n      />\r\n    ),\r\n    [setSelectedEvent, selectedEvent, keysOf(events).join()],\r\n  );\r\n  const eventButtons = useMemo(\r\n    () => (\r\n      <CategoryContainer title=\"Trigger events\">\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              state.run.nextRandomEvent = 0;\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Trigger random event\r\n        </Button>\r\n        {picker}\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply(triggerEvent(events[selectedEvent]))\r\n          }\r\n        >\r\n          Trigger specific event\r\n        </Button>\r\n      </CategoryContainer>\r\n    ),\r\n    [JSON.stringify(Object.keys(events)), selectedEvent],\r\n  );\r\n\r\n  const [selectedStoryline, setSelectedStoryline] = useState(\"\");\r\n\r\n  const pickerStoryline = useMemo(\r\n    () => (\r\n      <Picker\r\n        onValueChange={(value) => setSelectedStoryline(value)}\r\n        selectedValue={selectedStoryline}\r\n        data={storylines.map((storyline, idx) => ({\r\n          label: storyline.getId(),\r\n          value: storyline.getId(),\r\n          key: storyline.getId(),\r\n        }))}\r\n      />\r\n    ),\r\n    [setSelectedStoryline, selectedStoryline],\r\n  );\r\n  const storylineButtons = useMemo(\r\n    () => (\r\n      <CategoryContainer title=\"Trigger Storylines\">\r\n        {pickerStoryline}\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) =>\r\n              Storylines.getById(selectedStoryline).complete(state),\r\n            )\r\n          }\r\n        >\r\n          Complete Storyline\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) =>\r\n              Storylines.getById(selectedStoryline).activateBonus(state),\r\n            )\r\n          }\r\n        >\r\n          Activate Storyline bonus\r\n        </Button>\r\n      </CategoryContainer>\r\n    ),\r\n    [selectedStoryline],\r\n  );\r\n\r\n  const [newPlayerContextState, setNewPlayerContextState] = useState(\r\n    JSON.stringify(state, null, \"  \"),\r\n  );\r\n  const [fixingPlayerContextState, setFixingPlayerContextState] = useState(\"\");\r\n  const overridePlayerContext = useCallback(async () => {\r\n    const deserializedJSON = JSON.parse(newPlayerContextState);\r\n    stateRef.current.overwrite((_oldState) => {\r\n      return makeCompatible(deserializedJSON);\r\n    });\r\n    await saveDataUnsafe(deserializedJSON);\r\n  }, [newPlayerContextState]);\r\n\r\n  const [transformDebugInput, setTransformDebugInput] = useState(\"\");\r\n  const [transformDebugOutput, setTransformDebugOutput] = useState(\"\");\r\n\r\n  const calculate = useCallback(() => {\r\n    const tags = transformDebugInput.split(\",\");\r\n\r\n    const output = explainTransformations(tags, stateRef.current, 1.0);\r\n    const debugOutput = Object.keys(output)\r\n      .map((key) => {\r\n        const eachType = output[key as TransformationType].map(\r\n          ({ id, value }) =>\r\n            `${id}: ${\r\n              value != null\r\n                ? formatNumber(value, { showDecimals: true })\r\n                : \"undefined\"\r\n            }`,\r\n        );\r\n        return key + \": \" + eachType.join(\", \");\r\n      })\r\n      .join(\"\\n\");\r\n    setTransformDebugOutput(debugOutput);\r\n  }, [transformDebugInput, setTransformDebugOutput]);\r\n\r\n  const playSoundCallback = useCallback(\r\n    () => AudioManager.play(\"menuClick\"),\r\n    [],\r\n  );\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <CategoryContainer title=\"Other actions\">\r\n        <Button\r\n          onPress={async () => {\r\n            const result = await getDocumentAsync();\r\n            if (result.type == \"success\") {\r\n              const resultContents = await FileSystem.readAsStringAsync(\r\n                result.uri,\r\n              );\r\n              const unserialized = await loadBase64Data(resultContents);\r\n              console.warn(unserialized);\r\n            }\r\n            console.warn(result);\r\n          }}\r\n        >\r\n          Open Document Picker\r\n        </Button>\r\n        <Button enableAutoRepress={true} onPress={playSoundCallback}>\r\n          Play Sounds\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              for (let resource in stateRef.current.run.resources) {\r\n                if (resource != Resource.TimePiece) {\r\n                  state = grantResource(resource as Resource, 1e30)(state);\r\n                }\r\n              }\r\n              // state = grantResource(Resource.TimePieces, 9999999)(state);\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Max all storages\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              state.global.debugShowUpdatesPerSec =\r\n                !state.global.debugShowUpdatesPerSec;\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Toggle UPS overlay\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              if (hasFlag(state, \"machinegun_mode\")) {\r\n                state = clearFlag(\"machinegun_mode\")(state);\r\n              } else {\r\n                state = setFlag(\"machinegun_mode\")(state);\r\n              }\r\n              state = clearCombatStatCache(state, AttackTarget.Player);\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Toggle machinegun mode\r\n        </Button>\r\n        <Button onPress={() => I18nManager.forceRTL(true)}>Force RTL</Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              state = grantElementExp(SpellElement.Fire, 10000)(state);\r\n              state = grantElementExp(SpellElement.Earth, 10000)(state);\r\n              state = grantElementExp(SpellElement.Water, 10000)(state);\r\n              state = grantElementExp(SpellElement.Air, 10000)(state);\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Grant 10k element exp\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              state.run.warpTimeSecs = 60 * 10;\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Warp 10 minutes\r\n        </Button>\r\n        <Button\r\n          onPress={() => {\r\n            stateRef.current.apply((state) => {\r\n              state.run.skipAheadTime = 60 * 10;\r\n              return state;\r\n            });\r\n          }}\r\n        >\r\n          Artificially pass 10 minutes\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              if (hasFlag(state, \"debug_2x_speed\")) {\r\n                state = clearFlag(\"debug_2x_speed\")(state);\r\n              } else {\r\n                state = setFlag(\"debug_2x_speed\")(state);\r\n              }\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Toggle 2x speed\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              if (hasFlag(state, \"debug_0x_speed\")) {\r\n                state = clearFlag(\"debug_0x_speed\")(state);\r\n              } else {\r\n                state = setFlag(\"debug_0x_speed\")(state);\r\n              }\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Toggle 0x speed\r\n        </Button>\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => {\r\n              if (hasFlag(state, \"debug_invincibility\")) {\r\n                state = clearFlag(\"debug_invincibility\")(state);\r\n              } else {\r\n                state = setFlag(\"debug_invincibility\")(state);\r\n              }\r\n              state = clearCombatStatCache(state, AttackTarget.Player);\r\n              return state;\r\n            })\r\n          }\r\n        >\r\n          Toggle invincibility\r\n        </Button>\r\n        <Button\r\n          onPress={() => {\r\n            state.apply(cleanup);\r\n          }}\r\n          key=\"cleanupplayercontext\"\r\n        >\r\n          Run cleanup\r\n        </Button>\r\n        <Button\r\n          onPress={() => {\r\n            Storage.set(\r\n              \"uploadedTranslationsJSON\",\r\n              `{\"Advanced Furniture Preservation ({{furniture}})\": \"YE{{furniture}}SYESYESSSS\", \"**Full Version**\": \"NONONNOO\"}`,\r\n            );\r\n          }}\r\n          key=\"settranslations\"\r\n        >\r\n          Set mock translations\r\n        </Button>\r\n      </CategoryContainer>\r\n      <Card>\r\n        <Card.Title title=\"Multiplier Debugging\"></Card.Title>\r\n        <Text>Separate tags by commas</Text>\r\n        <TextInput\r\n          onChangeText={setTransformDebugInput}\r\n          value={transformDebugInput}\r\n          onSubmitEditing={calculate}\r\n        />\r\n        <Button onPress={calculate}>Calculate Multipliers</Button>\r\n        <Text>{transformDebugOutput}</Text>\r\n      </Card>\r\n      <Card>\r\n        <Card.Title title=\"Random Event Debugging\"></Card.Title>\r\n        <Text>\r\n          Next event in{\" \"}\r\n          {formatNumber(\r\n            state.run.nextRandomEvent -\r\n              state.run.extraEventSecs -\r\n              getSecondsPlayed(state),\r\n          )}{\" \"}\r\n          sec\r\n        </Text>\r\n        <Text>{JSON.stringify(debugRandomEvents(state), null, \"\\t\")}</Text>\r\n      </Card>\r\n      <Card>\r\n        <Card.Title title=\"Game State Editing\"></Card.Title>\r\n        <TextInput\r\n          multiline={true}\r\n          onChangeText={setNewPlayerContextState}\r\n          value={newPlayerContextState}\r\n          contentStyle={{ height: 400 }}\r\n          mode=\"outlined\"\r\n          style={{\r\n            height: 400,\r\n            fontFamily: Platform.select({\r\n              android: \"monospace\",\r\n              default: \"Courier New\",\r\n            }),\r\n          }}\r\n        />\r\n        <Button onPress={overridePlayerContext} key=\"setPlayerContext\">\r\n          Set State\r\n        </Button>\r\n      </Card>\r\n\r\n      <Card>\r\n        <Card.Title title=\"Game State Fixing\"></Card.Title>\r\n        <TextInput\r\n          multiline={true}\r\n          onChangeText={setFixingPlayerContextState}\r\n          value={fixingPlayerContextState}\r\n          mode=\"outlined\"\r\n          style={{\r\n            height: 400,\r\n            fontFamily: Platform.select({\r\n              android: \"monospace\",\r\n              default: \"Courier New\",\r\n            }),\r\n          }}\r\n        />\r\n        <Button\r\n          onPress={async () => {\r\n            const unserialized = await loadBase64Data(fixingPlayerContextState);\r\n            setFixingPlayerContextState(\r\n              JSON.stringify(unserialized, null, \"  \"),\r\n            );\r\n          }}\r\n          key=\"fixPlayerContext\"\r\n        >\r\n          Load\r\n        </Button>\r\n        <Button\r\n          onPress={() => {\r\n            saveToFile(JSON.parse(fixingPlayerContextState));\r\n          }}\r\n          key=\"getAsFile\"\r\n        >\r\n          Save to file\r\n        </Button>\r\n      </Card>\r\n\r\n      <Card>\r\n        <Card.Title title=\"Trigger Events\"></Card.Title>\r\n        {eventButtons}\r\n      </Card>\r\n      <Card>\r\n        <Card.Title title=\"Trigger Storylines\"></Card.Title>\r\n        {storylineButtons}\r\n      </Card>\r\n    </View>\r\n  );\r\n}\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n  \"machinegun_delay\",\r\n  \"Machinegun Mode\",\r\n  TransformationType.Override,\r\n  (state) => (hasFlag(state, \"machinegun_mode\") ? 0.01 : undefined),\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  \"machinegun_attack\",\r\n  \"Machinegun Mode\",\r\n  TransformationType.Override,\r\n  (state) => (hasFlag(state, \"machinegun_mode\") ? 1 : undefined),\r\n);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import { Flag } from \"../Flag\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Challenge } from \"./Challenge\";\r\n\r\nconst Challenges = new DataStore<Challenge>();\r\n\r\nexport { Challenges };\r\n\r\nexport function getCurrentChallenge(state: GameState): Challenge | undefined {\r\n  const currentChallengeId = state.run.currentChallengeId;\r\n  if (!currentChallengeId) {\r\n    return undefined;\r\n  }\r\n  return Challenges.getById(currentChallengeId);\r\n}\r\n\r\nexport function getVisibleChallenges(state: GameState): Challenge[] {\r\n  if (!areChallengesUnlocked(state)) {\r\n    return [];\r\n  }\r\n\r\n  return Challenges.getAll().filter((challenge) => challenge.isVisible(state));\r\n}\r\n\r\nexport function areChallengesUnlocked(state: GameState): boolean {\r\n  return hasFlag(state, Flag.ChallengesUnlocked);\r\n}\r\n","import moment from \"moment\";\r\nimport React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { EndingStats } from \"../../backend/GameState\";\r\nimport { Challenges } from \"../../backend/challenges/Challenges\";\r\nimport { CombatClasses } from \"../../backend/classes/CombatClasses\";\r\nimport { Endings } from \"../../backend/ending/Endings\";\r\nimport { translateElement } from \"../../backend/spells/Elements\";\r\nimport { getTotalStorylineCount } from \"../../backend/storylines/Storylines\";\r\nimport { formatNumber, formatTimeLong } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Text } from \"./Text\";\r\n\r\ntype RowProps = {\r\n  caption: string;\r\n  value: string;\r\n};\r\n\r\nfunction Row(props: RowProps) {\r\n  return (\r\n    <View style={styles.row}>\r\n      <View style={styles.rowCaption}>\r\n        <Text numberOfLines={2}>{props.caption}</Text>\r\n      </View>\r\n      <Text style={styles.valueText}>{props.value}</Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nexport function EndingDataViewer(props: { endingData: EndingStats }) {\r\n  const endingData = props.endingData;\r\n  const ending = Endings.getById(endingData.endingId);\r\n\r\n  const totalDuration = moment.duration(endingData.totalTimePlayed, \"seconds\");\r\n  const thisWorldDuration = moment.duration(\r\n    endingData.totalTimePlayedThisWorld,\r\n    \"seconds\",\r\n  );\r\n  const thisRunDuration = moment.duration(\r\n    endingData.totalTimePlayedThisRun,\r\n    \"seconds\",\r\n  );\r\n  const totalActiveDuration =\r\n    endingData.totalActiveTimePlayed != null\r\n      ? moment.duration(endingData.totalActiveTimePlayed, \"seconds\")\r\n      : null;\r\n  const totalActiveDurationThisWorld =\r\n    endingData.totalActiveTimePlayedThisWorld != null\r\n      ? moment.duration(endingData.totalActiveTimePlayedThisWorld, \"seconds\")\r\n      : null;\r\n  const totalActiveDurationThisRun =\r\n    endingData.totalActiveTimePlayedThisRun != null\r\n      ? moment.duration(endingData.totalActiveTimePlayedThisRun, \"seconds\")\r\n      : null;\r\n  const thisRunTimePieces = endingData.timePiecesConsumedThisRun;\r\n  const thisWorldTimePieces = endingData.timePiecesConsumedThisWorld;\r\n  const totalTimePieces = endingData.timePiecesConsumed;\r\n  const totalRealDuration =\r\n    endingData.totalRealWorldTimePlayed != null\r\n      ? moment.duration(endingData.totalRealWorldTimePlayed, \"seconds\")\r\n      : null;\r\n  const totalRealDurationThisWorld =\r\n    endingData.totalRealWorldTimePlayedThisWorld != null\r\n      ? moment.duration(endingData.totalRealWorldTimePlayedThisWorld, \"seconds\")\r\n      : null;\r\n  const totalRealDurationThisRun =\r\n    endingData.totalRealWorldTimePlayedThisRun != null\r\n      ? moment.duration(endingData.totalRealWorldTimePlayedThisRun, \"seconds\")\r\n      : null;\r\n\r\n  const combatClassText =\r\n    CombatClasses.getByIdNullable(\r\n      endingData.combatClassId,\r\n    )?.getDisplayName?.() ?? t(\"None\");\r\n\r\n  const primaryElementText =\r\n    endingData.secondaryElement != null\r\n      ? t(\"{{primaryElement}}, {{secondaryElement}}\", {\r\n          primaryElement: translateElement(endingData.primaryElement),\r\n          secondaryElement: translateElement(endingData.secondaryElement),\r\n        })\r\n      : t(\"{{primaryElement}}\", {\r\n          primaryElement: translateElement(endingData.primaryElement),\r\n        });\r\n\r\n  const primaryElementLevelsText =\r\n    endingData.secondaryElement != null\r\n      ? t(\"{{primaryElementLevel}}, {{secondaryElementLevel}}\", {\r\n          primaryElementLevel: formatNumber(\r\n            endingData.primaryElementLevelOnEnding,\r\n          ),\r\n          secondaryElementLevel: formatNumber(\r\n            endingData.secondaryElementLevelOnEnding,\r\n          ),\r\n        })\r\n      : t(\"{{primaryElementLevel}}\", {\r\n          primaryElementLevel: formatNumber(\r\n            endingData.primaryElementLevelOnEnding,\r\n          ),\r\n        });\r\n\r\n  const challengeText = Challenges.getByIdNullable(\r\n    endingData.challengeId,\r\n  )?.getName?.();\r\n\r\n  const newGamePlusCount = endingData.worldsCreated;\r\n  const isNewGamePlus = newGamePlusCount > 0;\r\n  const showWorldStats = isNewGamePlus;\r\n  const worldModifiers = t(\r\n    \"{{sheerPower}}/{{storylineOracle}}/{{blazingSpeed}} - D{{worldDifficulty}}\",\r\n    {\r\n      sheerPower: formatNumber(endingData.sheerPowerLevel),\r\n      storylineOracle: formatNumber(endingData.storylineOracleLevel),\r\n      blazingSpeed: formatNumber(endingData.blazingSpeedLevel),\r\n      worldDifficulty: formatNumber(endingData.worldDifficultyLevel),\r\n    },\r\n  );\r\n\r\n  const storylineCount = getTotalStorylineCount();\r\n\r\n  return (\r\n    <View>\r\n      <Row caption={t(\"Ending:\")} value={ending.title} />\r\n      <Row\r\n        caption={t(\"Date:\")}\r\n        value={moment(endingData.timestamp).format(\"Y-MM-DD h:mm A\")}\r\n      />\r\n      {isNewGamePlus && (\r\n        <Row caption={t(\"World Modifiers:\")} value={worldModifiers} />\r\n      )}\r\n      {challengeText != null && (\r\n        <Row caption={t(\"Challenge:\")} value={challengeText} />\r\n      )}\r\n      <Row caption={t(\"Primary Element:\")} value={primaryElementText} />\r\n      <Row caption={t(\"Class:\")} value={combatClassText} />\r\n      <Row\r\n        caption={t(\"Total In-Game Time Played:\")}\r\n        value={formatTimeLong(totalDuration)}\r\n      />\r\n      {showWorldStats && (\r\n        <Row\r\n          caption={t(\"In-Game Time Played (This World):\")}\r\n          value={formatTimeLong(thisWorldDuration)}\r\n        />\r\n      )}\r\n      <Row\r\n        caption={t(\"In-Game Time Played (This Run):\")}\r\n        value={formatTimeLong(thisRunDuration)}\r\n      />\r\n      <Row\r\n        caption={t(\"Total Real World Time Played:\")}\r\n        value={formatTimeLong(totalActiveDuration)}\r\n      />\r\n      {showWorldStats && (\r\n        <Row\r\n          caption={t(\"Real World Time Played (This World):\")}\r\n          value={formatTimeLong(totalActiveDurationThisWorld)}\r\n        />\r\n      )}\r\n      <Row\r\n        caption={t(\"Real World Time Played (This Run):\")}\r\n        value={formatTimeLong(totalActiveDurationThisRun)}\r\n      />\r\n      <Row\r\n        caption={t(\"Total Time Pieces Consumed:\")}\r\n        value={formatNumber(totalTimePieces)}\r\n      />\r\n      {showWorldStats && (\r\n        <Row\r\n          caption={t(\"Time Pieces Consumed (This World):\")}\r\n          value={formatNumber(thisWorldTimePieces)}\r\n        />\r\n      )}\r\n      <Row\r\n        caption={t(\"Time Pieces Consumed (This Run):\")}\r\n        value={formatNumber(thisRunTimePieces)}\r\n      />\r\n      <Row\r\n        caption={t(\"Total Time Since Starting Game:\")}\r\n        value={formatTimeLong(totalRealDuration)}\r\n      />\r\n      {showWorldStats && (\r\n        <Row\r\n          caption={t(\"Total Time Since Starting This World:\")}\r\n          value={formatTimeLong(totalRealDurationThisWorld)}\r\n        />\r\n      )}\r\n      <Row\r\n        caption={t(\"Total Time Since Starting This Run:\")}\r\n        value={formatTimeLong(totalRealDurationThisRun)}\r\n      />\r\n      {showWorldStats && (\r\n        <Row\r\n          caption={t(\"Other Worlds visited:\")}\r\n          value={formatNumber(newGamePlusCount)}\r\n        />\r\n      )}\r\n      <Row\r\n        caption={\r\n          showWorldStats\r\n            ? t(\"Total Retirements (This World):\")\r\n            : t(\"Total Retirements:\")\r\n        }\r\n        value={endingData.totalRetirements?.toString?.() ?? \"\"}\r\n      />\r\n      <Row\r\n        caption={t(\"Maximum Primary Level Obtained:\")}\r\n        value={endingData.mpl.toString()}\r\n      />\r\n      <Row\r\n        caption={t(\"Primary Element Level on Game Beaten:\")}\r\n        value={primaryElementLevelsText}\r\n      />\r\n      <Row\r\n        caption={t(\"Global Experience Multiplier:\")}\r\n        value={t(\"{{multiplier}}x\", {\r\n          multiplier: formatNumber(endingData.researchMultiplier, {\r\n            showDecimals: true,\r\n          }),\r\n        })}\r\n      />\r\n      <Row\r\n        caption={t(\"Global Production Multiplier:\")}\r\n        value={t(\"{{multiplier}}x\", {\r\n          multiplier: formatNumber(endingData.productionMultiplier, {\r\n            showDecimals: true,\r\n          }),\r\n        })}\r\n      />\r\n      <Row\r\n        caption={t(\"Total Completed Storylines:\")}\r\n        value={t(\"{{completedStorylines}} / {{totalStorylines}}\", {\r\n          completedStorylines: formatNumber(endingData.completedStorylines),\r\n          totalStorylines: storylineCount,\r\n        })}\r\n      />\r\n      <Row\r\n        caption={t(\"Storyline Completion Percentage:\")}\r\n        value={t(\"{{percent}}%\", {\r\n          percent: formatNumber(\r\n            endingData.completedStorylines > storylineCount\r\n              ? 100 + (endingData.completedStorylines - storylineCount)\r\n              : (100 * endingData.completedStorylines) / storylineCount,\r\n          ),\r\n        })}\r\n      />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginBottom: 4,\r\n  },\r\n  valueText: {\r\n    minWidth: 100,\r\n    textAlign: \"right\",\r\n    fontWeight: \"bold\",\r\n    marginLeft: 8,\r\n  },\r\n  rowCaption: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import React, { useContext, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { EndingStats, StateContext } from \"../backend/GameState\";\r\nimport { Endings, getEndingData } from \"../backend/ending/Endings\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { Button } from \"./utility/Button\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { EndingDataViewer } from \"./utility/EndingDataViewer\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function Ending(props: {\r\n  close: () => void;\r\n  overrideEnding?: EndingStats;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const endingData = props.overrideEnding ?? getEndingData(state);\r\n  if (endingData == null) {\r\n    return <View />;\r\n  }\r\n\r\n  const ending = Endings.getById(endingData.endingId);\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text h1>{ending?.title}</Text>\r\n      <View style={styles.explanation}>\r\n        <Markdown style={styles.explanationText}>\r\n          {ending?.description}\r\n        </Markdown>\r\n      </View>\r\n      <View style={styles.dividerContainer}>\r\n        <Divider />\r\n      </View>\r\n      <View style={styles.congratsContainer}>\r\n        <Text h1>{t(\"Congratulations!\")}</Text>\r\n        <Text h2>{t(\"You have cleared Magic Research 2!\")}</Text>\r\n      </View>\r\n      <View style={Styles.mb16}>\r\n        <EndingDataViewer endingData={endingData} />\r\n      </View>\r\n      <View style={Styles.mt16}>\r\n        <Button onPress={props.close}>{t(\"Close\")}</Button>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  explanation: {\r\n    marginTop: 16,\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    width: \"100%\",\r\n  },\r\n  explanationText: {\r\n    width: \"100%\",\r\n  },\r\n  dividerContainer: {\r\n    marginTop: 32,\r\n    marginBottom: 24,\r\n  },\r\n  congratsContainer: {\r\n    alignItems: \"center\",\r\n    marginBottom: 16,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Flag } from \"../backend/Flag\";\r\nimport { hasFlag } from \"../backend/Flags\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  translateActionSubcategory,\r\n} from \"../backend/action/ActionAreas\";\r\nimport { getAllPurchasedEnhancements } from \"../backend/enhancement/Enhancements\";\r\nimport { keysOf } from \"../utils/CoreUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { CheckBox } from \"./utility/CheckBox\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nfunction ObtainedEnhancementsView() {\r\n  const state = useContext(StateContext);\r\n  const alreadyObtainedEnhancements = getAllPurchasedEnhancements(state);\r\n  return useMemo(\r\n    () => (\r\n      <View style={Styles.mt8}>\r\n        {keysOf(alreadyObtainedEnhancements).length == 0 && (\r\n          <Text key=\"none\" style={{ fontStyle: \"italic\" }}>\r\n            {t(\"You have not completed any enhancements yet!\")}\r\n          </Text>\r\n        )}\r\n        {keysOf(alreadyObtainedEnhancements).map((area, idx) => (\r\n          <View key={area} style={idx > 0 && Styles.mt8}>\r\n            <Text h3>\r\n              {translateActionSubcategory(area as ActionSubcategories)}\r\n            </Text>\r\n            {alreadyObtainedEnhancements[area].map((enhancement) => (\r\n              <View key={enhancement.getId()}>\r\n                <Markdown>\r\n                  {t(\"**{{enhancementName}}:** {{enhancementEffect}}\", {\r\n                    enhancementName: enhancement.getDisplayName(state),\r\n                    enhancementEffect: enhancement.getDisplayEffect(state),\r\n                  })}\r\n                </Markdown>\r\n              </View>\r\n            ))}\r\n          </View>\r\n        ))}\r\n      </View>\r\n    ),\r\n    [\r\n      JSON.stringify(alreadyObtainedEnhancements),\r\n      alreadyObtainedEnhancements.ENHANCE_STORAGE?.map((enhancement) => {\r\n        return enhancement.getDisplayEffect(state);\r\n      }).join(),\r\n    ],\r\n  );\r\n}\r\n\r\nfunction EnhancementConfigView() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const autoPurchaseCallback = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.options.autoPurchaseEnhancements =\r\n        !state.options.autoPurchaseEnhancements;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={Styles.mt8}>\r\n        <View>\r\n          <CheckBox\r\n            title={t(\"Auto purchase all\")}\r\n            checked={state.options.autoPurchaseEnhancements}\r\n            onPress={autoPurchaseCallback}\r\n            containerStyle={styles.checkboxContainer}\r\n          />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [state.options.autoPurchaseEnhancements, autoPurchaseCallback],\r\n  );\r\n}\r\n\r\nexport default function Enhance() {\r\n  const state = useContext(StateContext);\r\n\r\n  const purchasedComponent = useMemo(\r\n    () => (\r\n      <View style={Styles.mt16}>\r\n        <CategoryContainer title={t(\"Already obtained\")}>\r\n          <ObtainedEnhancementsView />\r\n        </CategoryContainer>\r\n      </View>\r\n    ),\r\n    [],\r\n  );\r\n\r\n  const showAutoPurchase = hasFlag(state, Flag.AutoPurchaseUnlocked);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.campusContainer}>\r\n        {showAutoPurchase && (\r\n          <View style={Styles.mb16}>\r\n            <CategoryContainer title={t(\"Enhancement Config\")}>\r\n              <EnhancementConfigView />\r\n            </CategoryContainer>\r\n          </View>\r\n        )}\r\n        <ActionsContainer area={ActionArea.ENHANCEMENT} />\r\n        {purchasedComponent}\r\n      </View>\r\n    ),\r\n    [purchasedComponent, showAutoPurchase],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  campusContainer: {\r\n    height: \"100%\",\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    marginTop: 8,\r\n    padding: 0,\r\n  },\r\n});\r\n","import memoize from \"sonic-memoize\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { cacheBooleanTrueOnly } from \"../Caching\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { clearCombatStatCache } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { meetsRequirements, SpellElement } from \"../spells/Elements\";\r\nimport { clearResearcherExpCache } from \"../study/Study\";\r\nimport { grantTemporaryEffect } from \"../temporaryeffects/TemporaryEffects\";\r\nimport { clearCalculatedIncomeCache } from \"../timetick/IncomeOverTime\";\r\nimport {\r\n  applyTransformations,\r\n  clearTransformationCache,\r\n  explainTransformationsText,\r\n  TransformationTag,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { ritualWeakness } from \"./RitualWeakness\";\r\n\r\nexport abstract class Ritual {\r\n  constructor() {}\r\n\r\n  abstract getId(): string;\r\n  abstract getBaseName(): string;\r\n  abstract getDescription(state: GameState): string;\r\n  abstract getEffect(state: GameState): string;\r\n  abstract getBaseCorruptionCost(): number;\r\n\r\n  getDisplayName(state: GameState): string {\r\n    const baseName = this.getBaseName();\r\n    return !this.isActive(state)\r\n      ? baseName\r\n      : t(\"{{ritualName}} (Active)\", { ritualName: baseName });\r\n  }\r\n\r\n  protected getBaseRitualEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  _costTags = [\r\n    TransformationTags.Corruption,\r\n    TransformationTags.PerRitualCost,\r\n  ].concat(this.getTags() as TransformationTags[]);\r\n\r\n  getCorruptionCost(state: GameState): number {\r\n    return applyTransformations(\r\n      this._costTags,\r\n      state,\r\n      this.getBaseCorruptionCost(),\r\n      { ritualId: this.getId() },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Death: this.getDeathLevelRequirement(),\r\n    };\r\n  }\r\n\r\n  abstract getDeathLevelRequirement(): number;\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return cacheBooleanTrueOnly(\r\n      state,\r\n      \"ritualVisibility.\" + this.getId(),\r\n      (s) => {\r\n        const elementRequirements = this.getLevelRequirements();\r\n        const isVisible = meetsRequirements(s, elementRequirements);\r\n        return isVisible;\r\n      },\r\n    );\r\n  }\r\n\r\n  turnOn(state: GameState): GameState {\r\n    if (!this.isVisible(state)) {\r\n      return state;\r\n    }\r\n\r\n    state.run.activeRituals[this.getId()] = true;\r\n    state = clearTransformationCache(\r\n      new Set([TransformationTags.Corruption]),\r\n      state,\r\n    );\r\n    state = grantTemporaryEffect(ritualWeakness.getId(), 60, {\r\n      target: AttackTarget.Player,\r\n    })(state);\r\n    state = clearCombatStatCache(state);\r\n    state = clearCalculatedIncomeCache(state);\r\n    state = clearResearcherExpCache(state);\r\n    return state;\r\n  }\r\n\r\n  turnOff(state: GameState): GameState {\r\n    state.run.activeRituals[this.getId()] = false;\r\n    state = clearTransformationCache(\r\n      new Set([TransformationTags.Corruption]),\r\n      state,\r\n    );\r\n    state = clearCombatStatCache(state);\r\n    state = clearCalculatedIncomeCache(state);\r\n    state = clearResearcherExpCache(state);\r\n    return state;\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return state.run.activeRituals[this.getId()] ?? false;\r\n  }\r\n\r\n  getTags(): TransformationTag[] {\r\n    const tags = [TransformationTags.Ritual, this.getId()];\r\n    return tags;\r\n  }\r\n\r\n  getCachedBaseRitualEffects = memoize(() => this.getBaseRitualEffects());\r\n\r\n  tagsByEffect: Record<string, string[]> = {};\r\n  getTagsByEffect(key: string, baseEffect: ActionEffect): string[] {\r\n    if (this.tagsByEffect?.[key] == null) {\r\n      this.tagsByEffect[key] = [\r\n        ...this.getTags(),\r\n        ...(baseEffect.tags ?? []),\r\n        TransformationTags.RitualEffect,\r\n        key,\r\n      ];\r\n    }\r\n    return this.tagsByEffect[key];\r\n  }\r\n\r\n  ritualEffectParams = memoize(() => ({ ritual: this }));\r\n\r\n  getRitualEffects(state: GameState, onlyId?: string): Record<string, number> {\r\n    const baseEffects = this.getCachedBaseRitualEffects();\r\n    const finalEffects: Record<string, number> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = applyTransformations(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.ritualEffectParams(),\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  ritualEffectExplanationParams = memoize((baseEffect: ActionEffect) => ({\r\n    ritual: this,\r\n    unit: baseEffect.unit,\r\n    valueType: baseEffect.valueType,\r\n  }));\r\n\r\n  getRitualEffectExplanations(\r\n    state: GameState,\r\n    onlyId?: string,\r\n  ): Record<string, string> {\r\n    const baseEffects = this.getCachedBaseRitualEffects();\r\n    const finalEffects: Record<string, string> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = explainTransformationsText(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.ritualEffectExplanationParams(baseEffect),\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n}\r\n","import { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { ExplorationStatus } from \"../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../exploration/ExplorationUtils\";\r\nimport { FamiliarCompanionStatusType } from \"../familiars/Familiar\";\r\nimport { getCurrentCompanionData } from \"../familiars/FamiliarUtils\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Storylines } from \"../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationValueType } from \"../transformation/TransformationTags\";\r\nimport { Ritual } from \"./Ritual\";\r\nimport { Rituals } from \"./Rituals\";\r\n\r\nclass NecromancyRitual extends Ritual {\r\n  getId(): string {\r\n    return \"necromancyRitual\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(`Necromancy Ritual`);\r\n  }\r\n  getDescription(state: GameState): string {\r\n    return t(\"Your Familiars could gain unholy strength...\");\r\n  }\r\n  protected getBaseRitualEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      attackMagnitude: {\r\n        value: 1.0,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      regenMagnitude: {\r\n        value: 5.0,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n  getEffect(state: GameState): string {\r\n    const effects = this.getRitualEffects(state);\r\n    const explanations = this.getRitualEffectExplanations(state);\r\n    return t(\r\n      `^{{attackMultiplier}}^<{{attackExplanation}}> Familiar :attack:; ^{{regenMultiplier}}^<{{regenExplanation}}> Familiar :hp: regeneration while recovering during combat`,\r\n      {\r\n        attackMultiplier: formatMultiplier(1.0 + effects.attackMagnitude),\r\n        attackExplanation: explanations.attackMagnitude,\r\n        regenMultiplier: formatMultiplier(1.0 + effects.regenMagnitude),\r\n        regenExplanation: explanations.regenMagnitude,\r\n      },\r\n    );\r\n  }\r\n  getBaseCorruptionCost(): number {\r\n    return 6;\r\n  }\r\n  getDeathLevelRequirement(): number {\r\n    return 1;\r\n  }\r\n  isVisible(state: GameState): boolean {\r\n    return Storylines.getById(\"forbiddenInvocation\").isBonusActive(state);\r\n  }\r\n}\r\n\r\nexport const necromancyRitual = new NecromancyRitual();\r\n\r\nexport function loadNecromancyRitual() {\r\n  Rituals.register(necromancyRitual);\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Familiar, CombatStat.Attack]],\r\n    necromancyRitual.getId(),\r\n    necromancyRitual.getBaseName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      necromancyRitual.isActive(state)\r\n        ? necromancyRitual.getRitualEffects(state, \"attackMagnitude\")\r\n            .attackMagnitude + 1.0\r\n        : 1.0,\r\n  );\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Familiar, CombatStat.HPRegen]],\r\n    necromancyRitual.getId(),\r\n    necromancyRitual.getBaseName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      necromancyRitual.isActive(state) &&\r\n      getExplorationStatus(state) == ExplorationStatus.Combat &&\r\n      getCurrentCompanionData(state)?.status?.companionStatus ==\r\n        FamiliarCompanionStatusType.Reviving\r\n        ? necromancyRitual.getRitualEffects(state, \"regenMagnitude\")\r\n            .regenMagnitude + 1.0\r\n        : 1.0,\r\n  );\r\n}\r\n\r\nexport function shouldShowGrayscaleFamiliar(state: GameState): boolean {\r\n  return necromancyRitual.isActive(state);\r\n}\r\n","import React from \"react\";\r\n\r\nexport type AccessibilityContextValue = {\r\n  announceForAccessibility: (announcement: string) => void;\r\n};\r\n\r\nexport const AccessibilityContext =\r\n  React.createContext<AccessibilityContextValue>({\r\n    announceForAccessibility: () => {},\r\n  });\r\n","import * as React from \"react\";\r\nimport {\r\n  Animated,\r\n  I18nManager,\r\n  LayoutChangeEvent,\r\n  Platform,\r\n  StyleProp,\r\n  StyleSheet,\r\n  View,\r\n  ViewStyle,\r\n} from \"react-native\";\r\n\r\nimport setColor from \"color\";\r\nimport { useTheme } from \"react-native-paper\";\r\n\r\nexport type Props = React.ComponentPropsWithRef<typeof View> & {\r\n  /**\r\n   * Animated value (between 0 and 1). This tells the progress bar to rely on this value to animate it.\r\n   * Note: It should not be used in parallel with the `progress` prop.\r\n   */\r\n  animatedValue?: number;\r\n  /**\r\n   * Progress value (between 0 and 1).\r\n   * Note: It should not be used in parallel with the `animatedValue` prop.\r\n   */\r\n  progress?: number;\r\n  /**\r\n   * Color of the progress bar. The background color will be calculated based on this but you can change it by passing `backgroundColor` to `style` prop.\r\n   */\r\n  color?: string;\r\n  /**\r\n   * If the progress bar will show indeterminate progress.\r\n   */\r\n  indeterminate?: boolean;\r\n  /**\r\n   * Whether to show the ProgressBar (true, the default) or hide it (false).\r\n   */\r\n  visible?: boolean;\r\n  style?: StyleProp<ViewStyle>;\r\n};\r\n\r\nconst INDETERMINATE_DURATION = 2000;\r\nconst INDETERMINATE_MAX_WIDTH = 0.6;\r\nconst { isRTL } = I18nManager;\r\n\r\n/**\r\n * Progress bar is an indicator used to present progress of some activity in the app.\r\n *\r\n * <div class=\"screenshots\">\r\n *   <img src=\"screenshots/progress-bar.png\" />\r\n * </div>\r\n *\r\n * ## Usage\r\n * ```js\r\n * import * as React from 'react';\r\n * import { ProgressBar, MD3Colors } from 'react-native-paper';\r\n *\r\n * const MyComponent = () => (\r\n *   <ProgressBar progress={0.5} color={MD3Colors.error50} />\r\n * );\r\n *\r\n * export default MyComponent;\r\n * ```\r\n */\r\nexport const ProgressBar = ({\r\n  color,\r\n  indeterminate,\r\n  style,\r\n  progress = 0,\r\n  visible = true,\r\n  animatedValue,\r\n  ...rest\r\n}: Props) => {\r\n  const theme = useTheme();\r\n  const { current: timer } = React.useRef<Animated.Value>(\r\n    new Animated.Value(0),\r\n  );\r\n  const passedAnimatedValue =\r\n    React.useRef<Props[\"animatedValue\"]>(animatedValue);\r\n  const [width, setWidth] = React.useState<number>(0);\r\n  const [prevWidth, setPrevWidth] = React.useState<number>(0);\r\n\r\n  const indeterminateAnimation =\r\n    React.useRef<Animated.CompositeAnimation | null>(null);\r\n\r\n  const { scale } = theme.animation;\r\n\r\n  React.useEffect(() => {\r\n    passedAnimatedValue.current = animatedValue;\r\n  });\r\n\r\n  const startAnimation = React.useCallback(() => {\r\n    /**\r\n     * We shouldn't add @param animatedValue to the\r\n     * deps array, to avoid the unnecessary loop.\r\n     * We can only check if the prop is passed initially,\r\n     * and we do early return.\r\n     */\r\n    const externalAnimation =\r\n      typeof passedAnimatedValue.current !== \"undefined\" &&\r\n      passedAnimatedValue.current >= 0;\r\n\r\n    if (externalAnimation) {\r\n      return;\r\n    }\r\n\r\n    // Animate progress bar\r\n    if (indeterminate) {\r\n      if (!indeterminateAnimation.current) {\r\n        indeterminateAnimation.current = Animated.timing(timer, {\r\n          duration: INDETERMINATE_DURATION,\r\n          toValue: 1,\r\n          // Animated.loop does not work if useNativeDriver is true on web\r\n          useNativeDriver: Platform.OS !== \"web\",\r\n          isInteraction: false,\r\n        });\r\n      }\r\n\r\n      // Reset timer to the beginning\r\n      timer.setValue(0);\r\n\r\n      Animated.loop(indeterminateAnimation.current).start();\r\n    } else {\r\n      Animated.timing(timer, {\r\n        duration: 200 * scale,\r\n        toValue: progress ? progress : 0,\r\n        useNativeDriver: true,\r\n        isInteraction: false,\r\n      }).start();\r\n    }\r\n  }, [scale, indeterminate, timer, progress]);\r\n\r\n  const stopAnimation = React.useCallback(() => {\r\n    // Stop indeterminate animation\r\n    if (indeterminateAnimation.current) {\r\n      indeterminateAnimation.current.stop();\r\n    }\r\n  }, [scale]);\r\n\r\n  React.useEffect(() => {\r\n    if (visible) startAnimation();\r\n    else stopAnimation();\r\n  }, [visible, startAnimation, stopAnimation]);\r\n\r\n  React.useEffect(() => {\r\n    if (animatedValue && animatedValue >= 0) {\r\n      timer.setValue(animatedValue);\r\n    }\r\n  }, [animatedValue, timer]);\r\n\r\n  React.useEffect(() => {\r\n    // Start animation the very first time when previously the width was unclear\r\n    if (visible && prevWidth === 0) {\r\n      startAnimation();\r\n    }\r\n  }, [prevWidth, startAnimation, visible]);\r\n\r\n  const onLayout = (event: LayoutChangeEvent) => {\r\n    setPrevWidth(width);\r\n    setWidth(event.nativeEvent.layout.width);\r\n  };\r\n\r\n  const tintColor = color || theme.colors?.primary;\r\n  const trackTintColor = theme.isV3\r\n    ? theme.colors.surfaceVariant\r\n    : setColor(tintColor).alpha(0.38).rgb().string();\r\n\r\n  const progressBar = React.useMemo(\r\n    () =>\r\n      width ? (\r\n        <Animated.View\r\n          style={[\r\n            styles.progressBar,\r\n            {\r\n              width,\r\n              backgroundColor: tintColor,\r\n              transform: [\r\n                {\r\n                  translateX: timer.interpolate(\r\n                    indeterminate\r\n                      ? {\r\n                          inputRange: [0, 0.5, 1],\r\n                          outputRange: [\r\n                            (isRTL ? 1 : -1) * 0.5 * width,\r\n                            (isRTL ? 1 : -1) *\r\n                              0.5 *\r\n                              INDETERMINATE_MAX_WIDTH *\r\n                              width,\r\n                            (isRTL ? -1 : 1) * 0.7 * width,\r\n                          ],\r\n                        }\r\n                      : {\r\n                          inputRange: [0, 1],\r\n                          outputRange: [(isRTL ? 1 : -1) * 0.5 * width, 0],\r\n                        },\r\n                  ),\r\n                },\r\n                {\r\n                  // Workaround for workaround for https://github.com/facebook/react-native/issues/6278\r\n                  scaleX: timer.interpolate(\r\n                    indeterminate\r\n                      ? {\r\n                          inputRange: [0, 0.5, 1],\r\n                          outputRange: [\r\n                            0.0001,\r\n                            INDETERMINATE_MAX_WIDTH,\r\n                            0.0001,\r\n                          ],\r\n                        }\r\n                      : {\r\n                          inputRange: [0, 1],\r\n                          outputRange: [0.0001, 1],\r\n                        },\r\n                  ),\r\n                },\r\n              ],\r\n            },\r\n          ]}\r\n        />\r\n      ) : null,\r\n    [width, tintColor, timer, isRTL],\r\n  );\r\n\r\n  return React.useMemo(\r\n    () => (\r\n      <View\r\n        onLayout={onLayout}\r\n        {...rest}\r\n        accessible\r\n        accessibilityRole=\"progressbar\"\r\n        accessibilityState={{ busy: visible }}\r\n        accessibilityValue={\r\n          indeterminate ? {} : { min: 0, max: 100, now: progress * 100 }\r\n        }\r\n      >\r\n        <View\r\n          style={[styles.container, { backgroundColor: trackTintColor }, style]}\r\n        >\r\n          {progressBar}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [onLayout, visible, trackTintColor, style, indeterminate, progressBar],\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    height: 4,\r\n    overflow: \"hidden\",\r\n  },\r\n\r\n  progressBar: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import React, { useContext, useEffect, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport {\r\n  getCurrentEnemyAction,\r\n  getEnemyActionProgress,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { AccessibilityContext } from \"../utility/AccessibilityContext\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { UIContext } from \"../utility/UIContext\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\n\r\nexport function EnemyActionDisplay() {\r\n  const state = useContext(StateContext);\r\n  const uiContext = useContext(UIContext);\r\n  const currentEventOccurrenceId = uiContext.getUIState(\r\n    \"current_event_occurrence_id\",\r\n  );\r\n  const currentEnemyAction = getCurrentEnemyAction(state);\r\n  const progress = getEnemyActionProgress(state);\r\n  const accessibilityContext = useContext(AccessibilityContext);\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (\r\n      currentEnemyAction?.name != null &&\r\n      currentEventOccurrenceId == null &&\r\n      visible\r\n    ) {\r\n      setTimeout(\r\n        () =>\r\n          accessibilityContext.announceForAccessibility(\r\n            currentEnemyAction?.name,\r\n          ),\r\n        0,\r\n      );\r\n    }\r\n  }, [\r\n    currentEnemyAction,\r\n    currentEventOccurrenceId,\r\n    accessibilityContext,\r\n    visible,\r\n  ]);\r\n  return useMemo(() => {\r\n    if (!currentEnemyAction) {\r\n      return (\r\n        <View style={styles.row}>\r\n          <GameIcon icon=\"attack\" style={styles.icon} />\r\n          <View style={styles.progressBarContainer}>\r\n            <Text style={styles.idleTextContainer}>-</Text>\r\n            <ProgressBar progress={0} style={{ width: 120 }} />\r\n          </View>\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View style={styles.row}>\r\n        <GameIcon icon=\"attack\" style={styles.icon} />\r\n        <View style={styles.progressBarContainer}>\r\n          <Text numberOfLines={1} style={styles.markdownContainer}>\r\n            {currentEnemyAction.name}\r\n          </Text>\r\n          <View style={{ width: 120 }}>\r\n            <ProgressBar progress={progress} style={{ width: 120 }} />\r\n          </View>\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [currentEnemyAction?.name, progress]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 4,\r\n    height: 24,\r\n    width: 24,\r\n  },\r\n  progressBarContainer: {\r\n    flex: 1,\r\n    marginTop: -5,\r\n  },\r\n  idleTextContainer: {\r\n    height: 21,\r\n  },\r\n  markdownContainer: {\r\n    height: 21,\r\n  },\r\n});\r\n","import React, { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  Animated,\r\n  Platform,\r\n  StyleSheet,\r\n  Text as RNText,\r\n  View,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport {\r\n  AttackTarget,\r\n  translateAttackTarget,\r\n} from \"../../backend/exploration/AttackTarget\";\r\nimport { CombatActionResult } from \"../../backend/exploration/ExplorationActionResult\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { getSecondsPlayed } from \"../../backend/timetick/TotalTimePlayed\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\n\r\nfunction CombatActionResultDisplay(props: {\r\n  action: CombatActionResult;\r\n  delay: number;\r\n}) {\r\n  const [auxText, auxTextStyle] = useMemo(() => {\r\n    let auxText = null,\r\n      auxTextStyle = null;\r\n    if (props.action != undefined) {\r\n      if (!props.action.isHit) {\r\n        auxText = \"Miss!\";\r\n      } else {\r\n        auxText =\r\n          (props.action.damage > 0 ? \"-\" : \"\") +\r\n          formatNumber(Math.abs(props.action.damage), {\r\n            showDecimals: false,\r\n          }) +\r\n          (props.action.isCrit ? \"!\" : \"\");\r\n        auxTextStyle = props.action.isCrit\r\n          ? styles.auxTextCritical\r\n          : props.action.damage >= 0\r\n          ? styles.auxTextDamage\r\n          : styles.auxTextHealing;\r\n      }\r\n    }\r\n    return [auxText, auxTextStyle];\r\n  }, [props.action]);\r\n\r\n  const damageAnim = useRef(new Animated.Value(0)).current;\r\n  const opacityAnim = useRef(new Animated.Value(0)).current;\r\n  useEffect(() => {\r\n    damageAnim.setValue(0);\r\n    Animated.sequence([\r\n      Animated.delay(props.delay),\r\n      Animated.spring(damageAnim, {\r\n        toValue: -16,\r\n        useNativeDriver: true,\r\n        bounciness: 0,\r\n      }),\r\n    ]).start();\r\n  }, [props.action?.id]);\r\n  useEffect(() => {\r\n    Animated.sequence([\r\n      Animated.delay(props.delay),\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 1,\r\n        useNativeDriver: true,\r\n        duration: 0,\r\n      }),\r\n      Animated.timing(opacityAnim, {\r\n        toValue: 0,\r\n        useNativeDriver: true,\r\n        duration: 800,\r\n      }),\r\n    ]).start();\r\n  }, [props.action?.id]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(\r\n    () =>\r\n      auxText ? (\r\n        <Animated.View\r\n          style={[\r\n            styles.auxTextContainer,\r\n            { transform: [{ translateY: damageAnim }], opacity: opacityAnim },\r\n          ]}\r\n        >\r\n          <RNText\r\n            style={[\r\n              styles.auxText,\r\n              { color: theme.colors.onBackground },\r\n              auxTextStyle,\r\n            ]}\r\n          >\r\n            {auxText}\r\n          </RNText>\r\n        </Animated.View>\r\n      ) : (\r\n        <View />\r\n      ),\r\n    [damageAnim, opacityAnim, theme, auxText, auxTextStyle],\r\n  );\r\n}\r\n\r\nfunction HPBarNonMemo(props: {\r\n  empty: boolean;\r\n  current: number;\r\n  max: number;\r\n  actionTarget: AttackTarget;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const visible = useContext(VisibilityContext);\r\n  const mountTime = useRef(getSecondsPlayed(state));\r\n\r\n  useEffect(() => {\r\n    mountTime.current = getSecondsPlayed(stateRef.current);\r\n  }, [visible]);\r\n\r\n  const actions = useMemo(\r\n    () =>\r\n      !state.options.hideDamageEffects\r\n        ? state.run.exploration.actionResultQueue.filter(\r\n            (result) =>\r\n              result != null &&\r\n              result.target === props.actionTarget &&\r\n              result.time > mountTime.current,\r\n          )\r\n        : [],\r\n    [\r\n      state.options.hideDamageEffects,\r\n      props.actionTarget,\r\n      state.run.exploration.lastActionResultPushedTime,\r\n    ],\r\n  );\r\n  const actionKeys = useMemo(\r\n    () => actions.map((action) => action.id).join(),\r\n    [actions],\r\n  );\r\n  const actionResults = useMemo(() => {\r\n    let lastTime = 0,\r\n      delay = 0;\r\n    const displays = [];\r\n    for (let actionIdx in actions) {\r\n      const action = actions[actionIdx];\r\n      if (action.time * 1000 < lastTime + 300) {\r\n        delay += lastTime + 300 - action.time * 1000;\r\n      } else {\r\n        delay = 0;\r\n      }\r\n      displays.push(\r\n        <CombatActionResultDisplay\r\n          key={action.id}\r\n          action={action}\r\n          delay={delay}\r\n        />,\r\n      );\r\n      lastTime = action.time * 1000;\r\n    }\r\n    return displays;\r\n  }, [actionKeys]);\r\n\r\n  const theme = useTheme();\r\n\r\n  const style = useMemo(\r\n    () => [\r\n      styles.bar,\r\n      // @ts-ignore The hpBarBackground is not part of react-native-elements\r\n      { backgroundColor: theme.colors.hpBarBackground },\r\n    ],\r\n    [theme],\r\n  );\r\n\r\n  const progressBar = useMemo(\r\n    () => (\r\n      <ProgressBar\r\n        progress={props.current / props.max}\r\n        // @ts-ignore The hpBarForeground is not part of react-native-elements\r\n        color={theme.colors.hpBarForeground}\r\n        style={style}\r\n      />\r\n    ),\r\n    [props.current / props.max, theme, style],\r\n  );\r\n\r\n  const progressBarText = useMemo(\r\n    () =>\r\n      !props.empty && (\r\n        <RNText style={styles.overlaidText}>\r\n          {formatNumber(Math.ceil(props.current))}/\r\n          {formatNumber(Math.ceil(props.max))}\r\n        </RNText>\r\n      ),\r\n    [props.empty, formatNumber(Math.ceil(props.current)), props.max],\r\n  );\r\n\r\n  const accessibilityLabel = useMemo(\r\n    () =>\r\n      t(\"{{target}} HP: {{current}}/{{max}} {{shortcut}}\", {\r\n        target: translateAttackTarget(props.actionTarget),\r\n        current: formatNumber(Math.ceil(props.current), {\r\n          showDecimals: false,\r\n        }),\r\n        cap: formatNumber(Math.ceil(props.max), { showDecimals: false }),\r\n        shortcut: Platform.OS === \"web\" ? t(\" (Control + Shift + Z)\") : \"\",\r\n      }),\r\n    [\r\n      props.actionTarget,\r\n      formatNumber(Math.ceil(props.current), {\r\n        showDecimals: false,\r\n      }),\r\n      props.max,\r\n    ],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[styles.row, styles.container]}\r\n        accessibilityLabel={accessibilityLabel}\r\n        accessible={true}\r\n        accessibilityRole={Platform.OS !== \"web\" ? \"header\" : undefined}\r\n      >\r\n        {/* @ts-expect-error react-native-web supports this */}\r\n        <GameIcon icon=\"hp\" style={styles.icon} accessibilityHidden={true} />\r\n        {/* @ts-expect-error react-native-web supports this */}\r\n        <View style={styles.progressBarContainer} accessibilityHidden={true}>\r\n          {progressBar}\r\n          {progressBarText}\r\n          {actionResults}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      accessibilityLabel,\r\n      progressBar,\r\n      progressBarText,\r\n      props.empty,\r\n      props.actionTarget,\r\n      actionResults,\r\n    ],\r\n  );\r\n}\r\n\r\nconst HPBar = React.memo(HPBarNonMemo);\r\n\r\nexport { HPBar };\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginTop: -4,\r\n    marginRight: 4,\r\n    height: 24,\r\n    width: 24,\r\n  },\r\n  overlaidText: {\r\n    color: \"#fff\",\r\n    fontWeight: \"bold\",\r\n    position: \"absolute\",\r\n    top: Platform.select({\r\n      default: 0,\r\n      android: -1,\r\n    }),\r\n    width: \"100%\",\r\n    textAlign: \"center\",\r\n  },\r\n  auxTextContainer: {\r\n    left: 48,\r\n    position: \"absolute\",\r\n    width: \"100%\",\r\n  },\r\n  auxText: {\r\n    width: \"100%\",\r\n    textAlign: \"center\",\r\n    fontWeight: \"bold\",\r\n  },\r\n  auxTextCritical: {\r\n    color: \"#dd0\",\r\n  },\r\n  auxTextDamage: {\r\n    color: \"#f00\",\r\n  },\r\n  auxTextHealing: {\r\n    color: \"#0f0\",\r\n  },\r\n  progressBarContainer: {\r\n    flex: 1,\r\n  },\r\n  container: {\r\n    height: 24,\r\n  },\r\n  bar: {\r\n    height: 20,\r\n    borderRadius: 10,\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport { getCurrentEnemy } from \"../../backend/exploration/enemies/Enemies\";\r\nimport { getCurrentEnemyHP } from \"../../backend/exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../backend/exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../backend/exploration/ExplorationUtils\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { HPBar } from \"./HPBar\";\r\n\r\nexport function EnemyHPBar() {\r\n  const state = useContext(StateContext);\r\n  const inCombat = getExplorationStatus(state) == ExplorationStatus.Combat;\r\n  let currentHP = 0;\r\n  let maxHP = 1;\r\n  if (inCombat) {\r\n    currentHP = getCurrentEnemyHP(state);\r\n    maxHP = getCurrentEnemy(state).getMaxHP(state);\r\n  }\r\n\r\n  return (\r\n    <HPBar\r\n      empty={!inCombat}\r\n      current={currentHP}\r\n      max={maxHP}\r\n      actionTarget={AttackTarget.Enemy}\r\n    />\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { StyleProp, StyleSheet, View, ViewStyle } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { getPrimaryButtonTextColor } from \"./Miscellaneous\";\r\n\r\nexport function ActiveMark(props: {\r\n  disabled: boolean;\r\n  style?: StyleProp<ViewStyle>;\r\n  themeOverride?: any;\r\n}) {\r\n  const theme = useTheme();\r\n  const themeToUse = props.themeOverride ?? theme;\r\n  const color = getPrimaryButtonTextColor(themeToUse, props.disabled);\r\n  return (\r\n    <View\r\n      style={[styles.activeMark, { backgroundColor: color }, props?.style]}\r\n    />\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  activeMark: {\r\n    width: 8,\r\n    height: 8,\r\n    alignSelf: \"center\",\r\n    marginRight: 8,\r\n    borderRadius: 4,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport {\r\n  Platform,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n} from \"react-native\";\r\nimport {\r\n  addActionToQuickbar,\r\n  isInQuickbar,\r\n  isQuickbarFull,\r\n} from \"../../backend/Quickbar\";\r\n\r\nimport { Entypo, Ionicons } from \"@expo/vector-icons\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { getThemeByElementAndDarkMode } from \"../../Themes\";\r\nimport { cacheByArbitraryVersion } from \"../../backend/Caching\";\r\nimport { Flag } from \"../../backend/Flag\";\r\nimport { hasFlag } from \"../../backend/Flags\";\r\nimport { StateContext, StateContextValue } from \"../../backend/GameState\";\r\nimport { Resource, getResourceCap } from \"../../backend/Resources\";\r\nimport {\r\n  addSpellToPermaCast,\r\n  isAutocastUnlocked,\r\n  isSpellInPermaCast,\r\n  permaCastWizardPowerNeeded,\r\n  permaCastWizardsNeeded,\r\n  removeSpellFromPermaCast,\r\n} from \"../../backend/autocast/Autocast\";\r\nimport {\r\n  SpellElement,\r\n  getPrimaryElements,\r\n  getUnlockedElements,\r\n  translateElement,\r\n} from \"../../backend/spells/Elements\";\r\nimport { Spell } from \"../../backend/spells/Spell\";\r\nimport {\r\n  addFavoriteSpell,\r\n  isInFavoriteSpells,\r\n  removeFromFavoriteSpells,\r\n  toggleEmpowered,\r\n} from \"../../backend/spells/Spells\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActiveMark } from \"./ActiveMark\";\r\nimport { useAuxOptions } from \"./AuxOptionsContext\";\r\nimport { Button } from \"./Button\";\r\nimport { GameStateFreezer } from \"./GameStateFreezer\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { DescriptionViewer, elementColorByTheme } from \"./Miscellaneous\";\r\nimport { SpellWizardsInfo } from \"./SpellWizardsInfo\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\nimport { TooltipPositionType, TooltipWrapper } from \"./Tooltip\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\n\r\nexport function SpellElementTag(props: { element: SpellElement }) {\r\n  const spellElement = props.element;\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.elementTextContainer,\r\n          {\r\n            backgroundColor: elementColorByTheme(theme.dark, spellElement),\r\n          },\r\n        ]}\r\n      >\r\n        <Text\r\n          style={[\r\n            getPrimaryElements(state).includes(spellElement) &&\r\n              styles.primaryElementText,\r\n            styles.spellElementBadgeText,\r\n          ]}\r\n        >\r\n          {spellElement}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [spellElement, getPrimaryElements(state).join(), theme],\r\n  );\r\n}\r\n\r\ntype SpellViewProps = {\r\n  spell: Spell;\r\n  tooltipExtra?: string;\r\n  showAddToQuickbar?: boolean;\r\n  showWizards?: boolean;\r\n  collapsed?: boolean;\r\n  toggleCollapsed?: () => void;\r\n  isMinimal?: boolean;\r\n  onPress?: (spell: Spell) => void;\r\n};\r\n\r\nfunction SpellNameText(props: { spell: Spell }) {\r\n  const state = useContext(StateContext);\r\n  const spell = props.spell;\r\n  return <>{spell.getDisplayName(state)}</>;\r\n}\r\n\r\nfunction SpellViewButtonContents(props: { spell: Spell; theme: any }) {\r\n  const spell = props.spell;\r\n  const theme = props.theme;\r\n  const state = useContext(StateContext);\r\n  const disabled = !spell.isEnabled(state);\r\n  const buttonTitleStyles = useMemo(\r\n    () => [\r\n      {\r\n        color: theme.colors.onPrimary,\r\n      },\r\n      disabled && {\r\n        color: theme.colors.onSurfaceDisabled,\r\n      },\r\n      styles.smallButtonTitle,\r\n    ],\r\n    [theme, disabled],\r\n  );\r\n  const spellDisplayName = useMemo(\r\n    () => <SpellNameText spell={spell} />,\r\n    [spell],\r\n  );\r\n  const spellCost = spell.getCost(state)?.resources?.Mana ?? 0;\r\n  const isActive = spell.isActive(state);\r\n  const buttonContents = useMemo(\r\n    () => (\r\n      <View style={styles.spellButtonTitleContainer}>\r\n        <View style={styles.spellButtonTitleOnlyContainer}>\r\n          {isActive && <ActiveMark disabled={disabled} themeOverride={theme} />}\r\n          <View style={styles.spellButtonTitleTitleOnlyContainer}>\r\n            <Text style={buttonTitleStyles} numberOfLines={2}>\r\n              {spellDisplayName}\r\n            </Text>\r\n          </View>\r\n        </View>\r\n        <View\r\n          style={[styles.spellButtonCostContainer, Styles.flexRowAlignCenter]}\r\n        >\r\n          <Text style={buttonTitleStyles} doNotScaleFonts={true}>\r\n            {formatNumber(spellCost, { showDecimals: false })}\r\n          </Text>\r\n          <GameIcon icon=\"mana\" style={styles.spellManaIcon} />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [isActive, disabled, buttonTitleStyles, spellDisplayName, spellCost],\r\n  );\r\n  return buttonContents;\r\n}\r\n\r\nfunction SpellViewMemoized(\r\n  props: SpellViewProps & { state: StateContextValue },\r\n) {\r\n  const state = props.state;\r\n  const stateRef = useRef(props.state);\r\n  const spell = props.spell;\r\n  const showAddToQuickbar = props.showAddToQuickbar || false;\r\n\r\n  let displayDescription = \"\",\r\n    displayEffect = \"\";\r\n\r\n  if (!props.collapsed || Platform.OS === \"web\") {\r\n    [displayDescription, displayEffect] = cacheByArbitraryVersion(\r\n      state,\r\n      \"spellDescriptionAndEffect:\" + spell.getId(),\r\n      (state) => [\r\n        spell.getDisplayDescription(state),\r\n        spell.getDisplayEffect(state),\r\n      ],\r\n      (state) =>\r\n        Math.floor(Date.now() / 500).toString() + spell.isEmpowered(state),\r\n    );\r\n  }\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    const descriptionContents = `${displayDescription} **${displayEffect}**`;\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        <DescriptionViewer style={{ flex: 1 }}>\r\n          {descriptionContents}\r\n        </DescriptionViewer>\r\n      </View>\r\n    );\r\n  }, [displayDescription, displayEffect]);\r\n\r\n  const theme = useTheme();\r\n\r\n  let spellElement: SpellElement | undefined = spell.getElement();\r\n  if (spellElement && !getUnlockedElements(state).includes(spellElement)) {\r\n    spellElement = undefined;\r\n  }\r\n  const elementText = useMemo(() => {\r\n    return (\r\n      <View>\r\n        {spellElement != null && (\r\n          <View style={styles.elementContainer}>\r\n            <Markdown>{t(\"Element:\")}</Markdown>\r\n            <SpellElementTag element={spellElement} />\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [spellElement, theme]);\r\n\r\n  const mainExp = spell.getMainExp(state);\r\n\r\n  const expText = useMemo(\r\n    () => (\r\n      <View style={[Styles.mt4, Styles.flexRowSpaceBetween]}>\r\n        <View style={Styles.flex}>\r\n          <Markdown>{t(\"Exp gain:\")}</Markdown>\r\n        </View>\r\n        <View style={[Styles.ml8]}>\r\n          <Markdown style={{ textAlign: \"right\" }}>\r\n            {mainExp.element != null\r\n              ? t(\"+{{amount}} {{element}} exp\", {\r\n                  amount: formatNumber(mainExp.expMin),\r\n                  element: translateElement(mainExp.element),\r\n                })\r\n              : t(\"+{{min}}~{{max}} exp (various)\", {\r\n                  min: formatNumber(mainExp.expMin),\r\n                  max: formatNumber(mainExp.expMax),\r\n                })}\r\n          </Markdown>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [mainExp.element, mainExp.expMin, mainExp.expMax],\r\n  );\r\n\r\n  const cooldownContainer = useMemo(() => {\r\n    const cooldown = spell.getCooldown(state);\r\n    const cooldownText = `${formatNumber(cooldown, {\r\n      showDecimals: true,\r\n    })} sec`;\r\n    return (\r\n      <View>\r\n        {cooldown > 0 && (\r\n          <View style={styles.costContainer}>\r\n            <Markdown>{t(\"Cooldown:\")}</Markdown>\r\n            <Markdown containerStyle={{ flex: null }}>{cooldownText}</Markdown>\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [(!props.collapsed || Platform.OS === \"web\") && spell.getCooldown(state)]);\r\n\r\n  const toggleFavorite = useCallback(() => {\r\n    stateRef.current.apply((state) =>\r\n      isInFavoriteSpells(state, spell)\r\n        ? removeFromFavoriteSpells(state, spell)\r\n        : addFavoriteSpell(state, spell),\r\n    );\r\n  }, []);\r\n\r\n  const favoritesButton = useMemo(\r\n    () => (\r\n      <Ionicons\r\n        accessibilityLabel={\r\n          isInFavoriteSpells(state, spell)\r\n            ? t(\"Remove from Favorites\")\r\n            : t(\"Add to Favorites\")\r\n        }\r\n        onPress={toggleFavorite}\r\n        name={isInFavoriteSpells(state, spell) ? \"heart\" : \"heart-outline\"}\r\n        color={theme.colors.onBackground}\r\n        size={32}\r\n      />\r\n    ),\r\n    [\r\n      !props.showAddToQuickbar && isInFavoriteSpells(state, spell),\r\n      toggleFavorite,\r\n      theme,\r\n    ],\r\n  );\r\n\r\n  const elementTheme = state.options.colorSpellButtonsByElement\r\n    ? getThemeByElementAndDarkMode(spell.getElement(), theme.dark)\r\n    : theme;\r\n\r\n  const disabled = !spell.isEnabled(state);\r\n  const buttonOnPress = useCallback(() => {\r\n    if (props.onPress != null) {\r\n      props.onPress(spell);\r\n    } else {\r\n      stateRef.current.apply(\r\n        spell.doAction.bind(spell, { isAutomatic: false }),\r\n      );\r\n    }\r\n  }, [props.onPress, spell]);\r\n  const auxOptions = useAuxOptions();\r\n  const buttonContents = useMemo(\r\n    () => <SpellViewButtonContents spell={spell} theme={elementTheme} />,\r\n    [spell, elementTheme],\r\n  );\r\n  const button = useMemo(\r\n    () => (\r\n      <TooltipWrapper\r\n        tooltip={\r\n          props.collapsed || props.isMinimal ? (\r\n            <View>\r\n              {descriptionContainer}\r\n              {elementText}\r\n              {expText}\r\n              {cooldownContainer}\r\n            </View>\r\n          ) : undefined\r\n        }\r\n        tooltipPosition={\r\n          showAddToQuickbar\r\n            ? TooltipPositionType.RIGHT_OF_ELEMENT\r\n            : TooltipPositionType.LEFT_OF_ELEMENT\r\n        }\r\n        tooltipId={\r\n          spell.getId() +\r\n          (showAddToQuickbar ? \"yes\" : \"no\") +\r\n          props.tooltipExtra\r\n        }\r\n      >\r\n        <Button\r\n          key={spell.getId()}\r\n          compact={true}\r\n          enableAutoRepress={true}\r\n          onPress={buttonOnPress}\r\n          style={Styles.flex}\r\n          labelStyle={[\r\n            styles.buttonLabelStyle,\r\n            auxOptions.compactLayout && { height: 36 },\r\n          ]}\r\n          contentStyle={[\r\n            styles.buttonContentStyle,\r\n            auxOptions.compactLayout && { height: 36 },\r\n          ]}\r\n          theme={elementTheme}\r\n          // @ts-ignore I added this myself\r\n          TextComponent={View}\r\n          disabled={disabled}\r\n          disableDisabledRenderingOptimization={true}\r\n        >\r\n          {buttonContents}\r\n        </Button>\r\n      </TooltipWrapper>\r\n    ),\r\n    [\r\n      spell.getDisplayName(state),\r\n      buttonOnPress,\r\n      disabled,\r\n      descriptionContainer,\r\n      elementText,\r\n      expText,\r\n      cooldownContainer,\r\n      props.collapsed,\r\n      props.isMinimal,\r\n      showAddToQuickbar,\r\n      props.tooltipExtra,\r\n      buttonContents,\r\n      elementTheme,\r\n      auxOptions.compactLayout,\r\n    ],\r\n  );\r\n\r\n  const addToQuickbarButton = useMemo(\r\n    () => (\r\n      <Button\r\n        onPress={() =>\r\n          stateRef.current.apply((state) => addActionToQuickbar(state, spell))\r\n        }\r\n        style={[styles.quickbarButtonContainer]}\r\n        disabled={\r\n          isInQuickbar(state, {\r\n            type: \"action\",\r\n            id: spell.getId(),\r\n          }) || isQuickbarFull(state)\r\n        }\r\n      >\r\n        {t(\"Add to Quickbar\")}\r\n      </Button>\r\n    ),\r\n    [\r\n      isInQuickbar(state, {\r\n        type: \"action\",\r\n        id: spell.getId(),\r\n      }),\r\n      isQuickbarFull(state),\r\n    ],\r\n  );\r\n\r\n  const isSpellPermaCastAllowed =\r\n    spell.isPermaCastAllowed() && hasFlag(state, Flag.PermaCastUnlocked);\r\n  const calculatePermaCastStuff = isSpellPermaCastAllowed && !props.collapsed;\r\n  const permaCastManaCost = calculatePermaCastStuff\r\n    ? spell.getPermaCastManaCostPerSec(state)\r\n    : 0;\r\n  const permaCastDelay = calculatePermaCastStuff\r\n    ? spell.getPermaCastDelaySec(state)\r\n    : 0;\r\n  const permaCastWizardPowerNeededForSpell = calculatePermaCastStuff\r\n    ? permaCastWizardPowerNeeded(state, spell)\r\n    : 0;\r\n  const permaCastWizardsNeededForSpell = calculatePermaCastStuff\r\n    ? permaCastWizardsNeeded(state, spell)\r\n    : 0;\r\n  const isInPermaCast = isSpellInPermaCast(state, spell);\r\n\r\n  const hasEnoughMaxManaForPermacast = calculatePermaCastStuff\r\n    ? spell.getManaCost(state) <= getResourceCap(state, Resource.Mana)\r\n    : true;\r\n\r\n  const permaCastButton = useMemo(\r\n    () =>\r\n      calculatePermaCastStuff ? (\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) =>\r\n              isSpellInPermaCast(state, spell)\r\n                ? removeSpellFromPermaCast(state, spell)\r\n                : addSpellToPermaCast(state, spell),\r\n            )\r\n          }\r\n          disabled={!hasEnoughMaxManaForPermacast && !isInPermaCast}\r\n          compact={true}\r\n          mode=\"outlined\"\r\n        >\r\n          {!isInPermaCast ? t(\"Perma-Cast\") : t(\"Stop Perma-Cast\")}\r\n        </Button>\r\n      ) : null,\r\n    [\r\n      calculatePermaCastStuff,\r\n      spell,\r\n      hasEnoughMaxManaForPermacast,\r\n      isInPermaCast,\r\n      permaCastManaCost,\r\n      permaCastWizardsNeededForSpell,\r\n    ],\r\n  );\r\n\r\n  const isEmpowerable = spell.isEmpoweringPossible(state);\r\n  const isEmpowered = spell.isEmpowered(state);\r\n  const empowerButton = useMemo(\r\n    () =>\r\n      isEmpowerable ? (\r\n        <Button\r\n          onPress={() =>\r\n            stateRef.current.apply((state) => toggleEmpowered(state, spell))\r\n          }\r\n          compact={true}\r\n          mode=\"outlined\"\r\n        >\r\n          {!isEmpowered ? t(\"Empower\") : t(\"Cancel Empower\")}\r\n        </Button>\r\n      ) : null,\r\n    [spell, isEmpowerable, isEmpowered],\r\n  );\r\n\r\n  const extraActionsRow = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          Styles.mt8,\r\n          Styles.mb4,\r\n          Styles.alignSelfNormal,\r\n          Styles.flexRowAlignCenter,\r\n          { gap: 8 },\r\n        ]}\r\n      >\r\n        {empowerButton}\r\n        {permaCastButton}\r\n      </View>\r\n    ),\r\n    [permaCastButton, empowerButton],\r\n  );\r\n\r\n  const permaCastParams = calculatePermaCastStuff\r\n    ? {\r\n        sec: formatNumber(permaCastDelay, { showDecimals: true }),\r\n        mana: formatNumber(permaCastManaCost, { showDecimals: true }),\r\n        wizardPower: formatNumber(permaCastWizardPowerNeededForSpell, {\r\n          showDecimals: true,\r\n        }),\r\n        wizText:\r\n          permaCastWizardsNeededForSpell > 1\r\n            ? t(\"{{wiz}} wizards\", {\r\n                wiz: formatNumber(permaCastWizardsNeededForSpell),\r\n              })\r\n            : t(\"{{wiz}} wizard\", {\r\n                wiz: formatNumber(permaCastWizardsNeededForSpell),\r\n              }),\r\n      }\r\n    : {};\r\n\r\n  const permaCastText = calculatePermaCastStuff\r\n    ? isInPermaCast\r\n      ? hasEnoughMaxManaForPermacast\r\n        ? t(\r\n            \"You are Perma-Casting this spell every {{sec}} sec. Requires {{mana}}:mana:/sec and {{wizardPower}}:wizardpower:/sec (about {{wizText}})\",\r\n            permaCastParams,\r\n          )\r\n        : t(\r\n            \"You are Perma-Casting this spell, but your Max:mana: is not enough, so it will not get cast.\",\r\n          )\r\n      : hasEnoughMaxManaForPermacast\r\n      ? t(\r\n          \"You may Perma-Cast this spell to automatically cast it every {{sec}} sec. Requires {{mana}}:mana:/sec and {{wizardPower}}:wizardpower:/sec (about {{wizText}})\",\r\n          permaCastParams,\r\n        )\r\n      : t(\"You may Perma-Cast this spell, but your Max:mana: is not enough.\")\r\n    : \"\";\r\n\r\n  const empowerText = isEmpowerable\r\n    ? isEmpowered\r\n      ? t(\"You are Empowering this spell.\")\r\n      : t(\r\n          \"You may Empower this spell to increase its effects at a higher :mana: cost.\",\r\n        )\r\n    : \"\";\r\n\r\n  const extrasText =\r\n    calculatePermaCastStuff && isEmpowerable\r\n      ? t(\"{{empowerText}}\\n\\n{{permaCastText}}\", {\r\n          permaCastText,\r\n          empowerText,\r\n        })\r\n      : calculatePermaCastStuff\r\n      ? permaCastText\r\n      : empowerText;\r\n\r\n  const extrasExplanation = useMemo(\r\n    () => <Markdown>{extrasText}</Markdown>,\r\n    [extrasText],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (props.isMinimal) {\r\n      return <View style={styles.buttonContainerView}>{button}</View>;\r\n    }\r\n    return (\r\n      <View\r\n        style={[styles.actionContainer, auxOptions.compactLayout && Styles.mv4]}\r\n        key={spell.getId()}\r\n      >\r\n        <View style={styles.buttonRowContainer}>\r\n          <View style={styles.buttonContainerView}>{button}</View>\r\n          <TouchableWithoutFeedback\r\n            accessibilityLabel={props.collapsed ? \"Expand\" : \"Collapse\"}\r\n            onPress={props.toggleCollapsed}\r\n          >\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.colors.onBackground}\r\n              />\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n        </View>\r\n        {(!props.collapsed || !props.showAddToQuickbar) && (\r\n          <GameStateFreezer isVisible={!props.collapsed}>\r\n            <View style={props.collapsed && { display: \"none\" }}>\r\n              <View style={styles.descriptionRow}>\r\n                {descriptionContainer}\r\n                {!showAddToQuickbar && favoritesButton}\r\n                {showAddToQuickbar && addToQuickbarButton}\r\n              </View>\r\n              {elementText}\r\n              {expText}\r\n              {cooldownContainer}\r\n              {props.showWizards &&\r\n              !isInPermaCast &&\r\n              isAutocastUnlocked(state) ? (\r\n                <View style={Styles.mt4}>\r\n                  <SpellWizardsInfo spellId={spell.getId()} />\r\n                </View>\r\n              ) : null}\r\n              {(calculatePermaCastStuff || isEmpowerable) &&\r\n                !showAddToQuickbar &&\r\n                extraActionsRow}\r\n              {extrasText != \"\" && !showAddToQuickbar\r\n                ? extrasExplanation\r\n                : null}\r\n            </View>\r\n          </GameStateFreezer>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    spell.getId(),\r\n    auxOptions.compactLayout,\r\n    !props.collapsed && cooldownContainer,\r\n    !props.collapsed && expText,\r\n    !props.collapsed && descriptionContainer,\r\n    showAddToQuickbar,\r\n    showAddToQuickbar && addToQuickbarButton,\r\n    showAddToQuickbar && JSON.stringify(state.run.quickbar),\r\n    props.collapsed,\r\n    props.showWizards,\r\n    isInPermaCast,\r\n    isAutocastUnlocked(state),\r\n    theme,\r\n    toggleFavorite,\r\n    props.isMinimal,\r\n    props.toggleCollapsed,\r\n    favoritesButton,\r\n    button,\r\n    calculatePermaCastStuff,\r\n    isEmpowerable,\r\n    permaCastButton,\r\n    extrasExplanation,\r\n  ]);\r\n}\r\n\r\nexport function SpellView(props: SpellViewProps & { isVisible?: boolean }) {\r\n  const state = useContext(StateContext);\r\n\r\n  return useMemo(\r\n    () => <SpellViewMemoized state={state} {...props} />,\r\n    [\r\n      props.spell.getId(),\r\n      props.collapsed,\r\n      props.tooltipExtra,\r\n      props.showAddToQuickbar,\r\n      props.toggleCollapsed,\r\n      props.isVisible !== false ? state : false,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  actionContainer: { marginVertical: 8 },\r\n  buttonRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  quickbarButtonContainer: {\r\n    marginTop: 4,\r\n    marginLeft: 8,\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n    alignSelf: \"stretch\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  costContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 4,\r\n  },\r\n  elementContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n    marginTop: 4,\r\n  },\r\n  descriptionTextContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    paddingRight: 4,\r\n  },\r\n  buttonTitle: {\r\n    fontSize: 16,\r\n    textAlign: \"center\",\r\n    paddingVertical: 1,\r\n    ...Platform.select({\r\n      android: {\r\n        fontFamily: \"sans-serif-medium\",\r\n      },\r\n      default: {\r\n        fontSize: 18,\r\n      },\r\n    }),\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  buttonContainerView: {\r\n    flexDirection: \"row\",\r\n    flex: 1,\r\n  },\r\n  buttonContainer: {\r\n    flex: 1,\r\n  },\r\n  buttonContainerSmall: {\r\n    marginRight: 0,\r\n  },\r\n  disabledActionText: {\r\n    color: \"#aaa\",\r\n  },\r\n  capTooLowText: {\r\n    color: \"#d99\",\r\n  },\r\n  turnOnRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginTop: 8,\r\n  },\r\n  turnOnQuantityContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusContainer: {\r\n    marginLeft: 8,\r\n  },\r\n  spellButtonTitleContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  spellButtonTitleOnlyContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  spellButtonTitleTitleOnlyContainer: {\r\n    flex: 1,\r\n  },\r\n  spellButtonCostContainer: {\r\n    flexDirection: \"row\",\r\n    width: 50,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  spellManaIcon: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    marginLeft: 2,\r\n  },\r\n  descriptionRow: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    marginTop: 8,\r\n  },\r\n  elementTextContainer: {\r\n    paddingHorizontal: 8,\r\n    borderRadius: 8,\r\n  },\r\n  primaryElementText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n  spellElementBadgeText: {\r\n    color: \"white\",\r\n  },\r\n  buttonLabelStyle: {\r\n    marginHorizontal: 16,\r\n    flex: 1,\r\n    marginVertical: 0,\r\n    height: 40,\r\n  },\r\n  buttonContentStyle: { marginHorizontal: 0, flex: 1, height: 40 },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\n\r\nexport function DragHandle(props: { drag: () => void }) {\r\n  const theme = useTheme();\r\n  return (\r\n    <View\r\n      importantForAccessibility=\"no-hide-descendants\"\r\n      accessibilityElementsHidden={true}\r\n      style={styles.dragHandle}\r\n    >\r\n      <TouchableWithoutFeedback\r\n        onPressIn={props.drag}\r\n        hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n      >\r\n        <MaterialIcons\r\n          name=\"drag-indicator\"\r\n          size={24}\r\n          color={theme.colors.onBackground}\r\n        />\r\n      </TouchableWithoutFeedback>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  dragHandle: {\r\n    cursor: \"grab\",\r\n    marginRight: 8,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport DraggableFlatList, {\r\n  RenderItemParams,\r\n  ScaleDecorator,\r\n} from \"react-native-draggable-flatlist\";\r\nimport { IconButton, useTheme } from \"react-native-paper\";\r\nimport { StateContext, StateContextValue } from \"../../backend/GameState\";\r\nimport { Spell } from \"../../backend/spells/Spell\";\r\nimport {\r\n  getFavoriteSpells,\r\n  removeFromFavoriteSpells,\r\n} from \"../../backend/spells/Spells\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport { DragHandle } from \"../utility/DragHandle\";\r\nimport { SpellView } from \"../utility/SpellView\";\r\nimport Styles from \"../utility/Styles\";\r\n\r\nfunction FavoriteSpellsContainerInside(props: { state: StateContextValue }) {\r\n  const favoriteSpells = getFavoriteSpells(props.state).filter(\r\n    (spell) => spell != null,\r\n  );\r\n  if (favoriteSpells.length === 0) {\r\n    return null;\r\n  }\r\n  const stateRef = useRef(props.state);\r\n  stateRef.current = props.state;\r\n\r\n  const theme = useTheme();\r\n\r\n  const renderItem = useCallback(\r\n    ({ item, drag, isActive }: RenderItemParams<Spell>) => {\r\n      const spell = item;\r\n      return (\r\n        <ScaleDecorator>\r\n          <View style={Styles.flexRowAlignCenter} key={spell.getId()}>\r\n            <DragHandle drag={drag} />\r\n            <SpellView\r\n              key={spell.getId()}\r\n              spell={spell}\r\n              isMinimal={true}\r\n              tooltipExtra=\"favorite\"\r\n            />\r\n            <IconButton\r\n              icon=\"close\"\r\n              accessibilityLabel={t(\"Remove from Favorites\")}\r\n              style={styles.deleteButton}\r\n              hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n              onPress={() =>\r\n                stateRef.current.apply((state) =>\r\n                  removeFromFavoriteSpells(state, spell),\r\n                )\r\n              }\r\n            />\r\n          </View>\r\n        </ScaleDecorator>\r\n      );\r\n    },\r\n    [removeFromFavoriteSpells, theme],\r\n  );\r\n  const keyExtractor = useCallback((spell: Spell) => spell.getId(), []);\r\n  return useMemo(\r\n    () => (\r\n      <View style={Styles.flex}>\r\n        <CategoryContainer\r\n          title={t(\"Favorites\")}\r\n          containerStyle={styles.categoryContainer}\r\n          contentContainerStyle={Styles.flex}\r\n        >\r\n          <View style={[Styles.mt8, Styles.flex]}>\r\n            <DraggableFlatList\r\n              data={favoriteSpells}\r\n              renderItem={renderItem}\r\n              containerStyle={Styles.flex}\r\n              keyExtractor={keyExtractor}\r\n              onDragEnd={(params) => {\r\n                stateRef.current.apply((state) => {\r\n                  state.run.favoriteSpells = params.data.map((spell) =>\r\n                    spell.getId(),\r\n                  );\r\n                  return state;\r\n                });\r\n              }}\r\n            />\r\n          </View>\r\n        </CategoryContainer>\r\n      </View>\r\n    ),\r\n    [\r\n      favoriteSpells.map((spell) => spell.getId()).join(),\r\n      renderItem,\r\n      keyExtractor,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function FavoriteSpellsContainer(props: { isVisible?: boolean }) {\r\n  const state = useContext(StateContext);\r\n\r\n  return useMemo(\r\n    () => <FavoriteSpellsContainerInside state={state} {...props} />,\r\n    [props.isVisible !== false ? state : false],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  deleteButton: {\r\n    marginLeft: 8,\r\n    width: 32,\r\n    height: 32,\r\n  },\r\n  deleteButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 32,\r\n    width: 32,\r\n    borderRadius: 16,\r\n  },\r\n  categoryContainer: {\r\n    paddingTop: 8,\r\n    flex: 1,\r\n  },\r\n});\r\n","import { useMemo } from \"react\";\r\nimport { StyleSheet, TouchableOpacity, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { getThemeByElementAndDarkMode } from \"../../Themes\";\r\nimport { SpellElement, translateElement } from \"../../backend/spells/Elements\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\n\r\ntype SelectorItemProps = {\r\n  element: SpellElement;\r\n  selected: boolean;\r\n  onPress: () => void;\r\n  dividerColor?: string;\r\n};\r\n\r\nfunction SpellElementSelectorItem(props: SelectorItemProps) {\r\n  const { element, selected, onPress } = { ...props };\r\n  const theme = useTheme();\r\n  const themeForElement = getThemeByElementAndDarkMode(element, theme.dark);\r\n  return useMemo(\r\n    () => (\r\n      <TouchableOpacity\r\n        onPress={onPress}\r\n        accessible={true}\r\n        accessibilityLabel={translateElement(element)}\r\n        accessibilityRole=\"tab\"\r\n      >\r\n        <View\r\n          style={[\r\n            styles.itemContainerStyle,\r\n            { borderColor: props.dividerColor ?? theme.colors.outlineVariant },\r\n            selected\r\n              ? { backgroundColor: themeForElement.colors.primaryContainer }\r\n              : null,\r\n          ]}\r\n        >\r\n          <GameIcon icon={element.toLowerCase()} />\r\n        </View>\r\n      </TouchableOpacity>\r\n    ),\r\n    [onPress, element, theme, selected, props.dividerColor],\r\n  );\r\n}\r\n\r\nexport type Props = {\r\n  onPress: (element: SpellElement) => void;\r\n  elements: SpellElement[];\r\n  selected: SpellElement;\r\n  dividerColor?: string;\r\n  style: any;\r\n};\r\n\r\nexport function SpellElementSelector(props: Props) {\r\n  return useMemo(\r\n    () => (\r\n      <View style={[styles.container, props.style]}>\r\n        {props.elements.map((element) => (\r\n          <SpellElementSelectorItem\r\n            key={element}\r\n            onPress={() => props.onPress(element)}\r\n            element={element}\r\n            selected={props.selected == element}\r\n            dividerColor={props.dividerColor}\r\n          />\r\n        ))}\r\n      </View>\r\n    ),\r\n    [\r\n      props.style,\r\n      props.elements.join(\"\"),\r\n      props.selected,\r\n      props.onPress,\r\n      props.dividerColor,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  itemContainerStyle: {\r\n    width: 34,\r\n    height: 34,\r\n    borderWidth: 1,\r\n  },\r\n  container: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    gap: 2,\r\n    alignItems: \"center\",\r\n  },\r\n});\r\n","import { SimpleLineIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext, StateContextValue } from \"../../backend/GameState\";\r\nimport { ActionArea } from \"../../backend/action/ActionAreas\";\r\nimport { SpellElement } from \"../../backend/spells/Elements\";\r\nimport { Spell } from \"../../backend/spells/Spell\";\r\nimport { getVisibleSpellsByElement } from \"../../backend/spells/Spells\";\r\nimport { clone, keysOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport { GameStateFreezer } from \"../utility/GameStateFreezer\";\r\nimport { SpellElementTag, SpellView } from \"../utility/SpellView\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport {\r\n  UIContext,\r\n  UIContextValue,\r\n  useUIStateFromContext,\r\n} from \"../utility/UIContext\";\r\nimport { FavoriteSpellsContainer } from \"./FavoriteSpellsContainer\";\r\nimport { SpellElementSelector } from \"./SpellElementSelector\";\r\n\r\nfunction SpellsContainerInside(props: {\r\n  uiKey: string;\r\n  area?: ActionArea;\r\n  onlyBySchool?: boolean;\r\n  showAddToQuickbar?: boolean;\r\n  showWizards?: boolean;\r\n  hideTitle?: boolean;\r\n  dividerColor?: string;\r\n  state: StateContextValue;\r\n  uiContext: UIContextValue;\r\n  isVisible?: boolean;\r\n}) {\r\n  const state = props.state;\r\n  const uiContext = props.uiContext;\r\n\r\n  const currentElementKey = props.uiKey + \".currentElement\";\r\n  const spellsByElement = getVisibleSpellsByElement(state, props.area);\r\n\r\n  const elements = keysOf(spellsByElement);\r\n\r\n  const [currentElement, setCurrentElement] = useUIStateFromContext(\r\n    uiContext,\r\n    currentElementKey,\r\n    elements?.[0] ?? SpellElement.Fire,\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!elements.includes(currentElement)) {\r\n      setCurrentElement(elements?.[0]);\r\n    }\r\n  }, [elements.join(\",\")]);\r\n\r\n  const [expandedSpells, setExpandedSpells] = useState<Record<string, boolean>>(\r\n    {},\r\n  );\r\n  const expandedSpellsRef = useRef(expandedSpells);\r\n  expandedSpellsRef.current = expandedSpells;\r\n\r\n  const currentElementSpells = spellsByElement?.[currentElement] || [];\r\n\r\n  const toggleCollapsed = useCallback((spell: Spell) => {\r\n    const id = spell.getId();\r\n    expandedSpellsRef.current[id] = !expandedSpellsRef?.current?.[id];\r\n    setExpandedSpells(clone(expandedSpellsRef.current));\r\n  }, []);\r\n\r\n  const boundToggleCollapsed = useMemo(\r\n    () =>\r\n      Object.fromEntries(\r\n        elements.map((element) => [\r\n          element,\r\n          Object.fromEntries(\r\n            spellsByElement[element].map((spell) => [\r\n              spell.getId(),\r\n              toggleCollapsed.bind(null, spell),\r\n            ]),\r\n          ),\r\n        ]),\r\n      ),\r\n    [spellsByElement],\r\n  );\r\n\r\n  const spellActionContainers = useMemo(() => {\r\n    if (!props.showAddToQuickbar) {\r\n      return elements.map((element) => {\r\n        const spellArray = spellsByElement[element];\r\n        return (\r\n          <GameStateFreezer\r\n            key={element}\r\n            isVisible={currentElement === element}\r\n          >\r\n            <View style={currentElement !== element && { display: \"none\" }}>\r\n              {spellArray.map((spell, idx) => {\r\n                return (\r\n                  <SpellView\r\n                    key={spell.getId()}\r\n                    spell={spell}\r\n                    showAddToQuickbar={props.showAddToQuickbar}\r\n                    showWizards={props.showWizards}\r\n                    collapsed={!expandedSpells?.[spell.getId()]}\r\n                    toggleCollapsed={\r\n                      boundToggleCollapsed[element][spell.getId()]\r\n                    }\r\n                    isVisible={props.isVisible && currentElement === element}\r\n                  />\r\n                );\r\n              })}\r\n            </View>\r\n          </GameStateFreezer>\r\n        );\r\n      });\r\n    }\r\n    return currentElementSpells.map((spell, idx) => {\r\n      return (\r\n        <SpellView\r\n          key={spell.getId()}\r\n          spell={spell}\r\n          showAddToQuickbar={props.showAddToQuickbar}\r\n          showWizards={props.showWizards}\r\n          collapsed={!expandedSpells?.[spell.getId()]}\r\n          toggleCollapsed={boundToggleCollapsed[currentElement][spell.getId()]}\r\n          isVisible={props.isVisible}\r\n        />\r\n      );\r\n    });\r\n  }, [\r\n    !props.showAddToQuickbar ? spellsByElement : currentElementSpells,\r\n    JSON.stringify(expandedSpells),\r\n    boundToggleCollapsed,\r\n    currentElement,\r\n    props.isVisible,\r\n    props.showWizards,\r\n  ]);\r\n\r\n  const spellElementPicker = useMemo(\r\n    () => (\r\n      <SpellElementSelector\r\n        onPress={(value) => setCurrentElement(value as SpellElement)}\r\n        style={styles.picker}\r\n        selected={currentElement}\r\n        elements={elements}\r\n        dividerColor={props.dividerColor}\r\n      />\r\n    ),\r\n    [\r\n      setCurrentElement,\r\n      currentElement,\r\n      JSON.stringify(elements),\r\n      props.dividerColor,\r\n    ],\r\n  );\r\n\r\n  const currentElementSpellsString = currentElementSpells\r\n    .map((spell) => spell.getId())\r\n    .join(\",\");\r\n\r\n  const hasAllSpellsExpanded = useMemo(() => {\r\n    return !currentElementSpells.some(\r\n      (spell) => !(expandedSpells?.[spell.getId()] ?? false),\r\n    );\r\n  }, [expandedSpells, currentElementSpellsString]);\r\n\r\n  const expandCollapseAll = useCallback(() => {\r\n    let expandedSomething = false;\r\n    currentElementSpells.forEach((spell) => {\r\n      const spellId = spell.getId();\r\n      if (!expandedSpells?.[spellId]) {\r\n        expandedSomething = true;\r\n        expandedSpells[spellId] = true;\r\n      }\r\n    });\r\n    if (!expandedSomething) {\r\n      currentElementSpells.forEach((spell) => {\r\n        delete expandedSpells[spell.getId()];\r\n      });\r\n    }\r\n    setExpandedSpells(clone(expandedSpells));\r\n  }, [expandedSpells, currentElementSpellsString]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View>\r\n        {!props.hideTitle && (\r\n          <View\r\n            accessible={true}\r\n            accessibilityRole=\"header\"\r\n            style={styles.emptyTitleContainer}\r\n          >\r\n            <SimpleLineIcons\r\n              name=\"magic-wand\"\r\n              size={24}\r\n              style={styles.magicWand}\r\n              color={theme.colors.onBackground}\r\n            />\r\n            <Text h2 accessibilityRole=\"none\">\r\n              {t(\"Cast Spell\")}\r\n            </Text>\r\n          </View>\r\n        )}\r\n        {!props.onlyBySchool && (\r\n          <View>\r\n            <FavoriteSpellsContainer isVisible={props.isVisible} />\r\n          </View>\r\n        )}\r\n        {elements.length > 0 ? (\r\n          <CategoryContainer\r\n            title={t(\"By Element\")}\r\n            dividerColor={props.dividerColor}\r\n          >\r\n            <View style={styles.schoolRowContainer}>\r\n              <View style={styles.tagPickerContainer}>\r\n                {spellElementPicker}\r\n              </View>\r\n              <View style={Styles.flexCenter}>\r\n                <Button compact={true} onPress={expandCollapseAll}>\r\n                  {hasAllSpellsExpanded ? t(\"Collapse all\") : t(\"Expand all\")}\r\n                </Button>\r\n                <View style={Styles.mt8}>\r\n                  <SpellElementTag element={currentElement} />\r\n                </View>\r\n              </View>\r\n            </View>\r\n            <View style={styles.schoolContainer}>{spellActionContainers}</View>\r\n          </CategoryContainer>\r\n        ) : (\r\n          <View style={styles.noSpellsContainer}>\r\n            <Text style={styles.noSpellsText}>{t(\"No spells yet!\")}</Text>\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    props.hideTitle,\r\n    currentElement,\r\n    setCurrentElement,\r\n    spellActionContainers,\r\n    props.isVisible,\r\n    spellElementPicker,\r\n    expandCollapseAll,\r\n    props.onlyBySchool,\r\n    props.dividerColor,\r\n    elements.length,\r\n    hasAllSpellsExpanded,\r\n    theme,\r\n  ]);\r\n}\r\n\r\nexport default function SpellsContainer(props: {\r\n  uiKey: string;\r\n  area: ActionArea;\r\n  hideRecent?: boolean;\r\n  showAddToQuickbar?: boolean;\r\n  showWizards?: boolean;\r\n  isVisible?: boolean;\r\n  hideTitle?: boolean;\r\n  onlyBySchool?: boolean;\r\n  dividerColor?: string;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const uiContext = useContext(UIContext);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <GameStateFreezer isVisible={props.isVisible}>\r\n        <SpellsContainerInside state={state} uiContext={uiContext} {...props} />\r\n      </GameStateFreezer>\r\n    ),\r\n    [\r\n      props.area,\r\n      props.hideRecent,\r\n      props.showAddToQuickbar,\r\n      props.onlyBySchool,\r\n      props.showWizards,\r\n      props.isVisible !== false ? state : false,\r\n      props.isVisible !== false ? uiContext : false,\r\n      props.isVisible !== false ? props.dividerColor : false,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  schoolContainer: { marginTop: 8 },\r\n  spellsContainer: { marginTop: 8 },\r\n  schoolButton: { marginVertical: 4 },\r\n  magicWand: { marginRight: 8 },\r\n  schoolTitleContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n  },\r\n  emptyTitleContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n  },\r\n  titleContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  schoolTitleTextContainer: {},\r\n  picker: {\r\n    flex: 1,\r\n    width: 144,\r\n  },\r\n  schoolRowContainer: {\r\n    marginTop: 8,\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  tagPickerContainer: {\r\n    width: 180,\r\n  },\r\n  buttonTitle: {\r\n    textAlign: \"center\",\r\n    paddingVertical: 1,\r\n    ...Platform.select({\r\n      android: {\r\n        fontFamily: \"sans-serif-medium\",\r\n      },\r\n      default: {\r\n        fontSize: 18,\r\n      },\r\n    }),\r\n    fontSize: 12,\r\n  },\r\n  noSpellsText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  noSpellsContainer: {\r\n    marginTop: 16,\r\n  },\r\n  nuxText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n});\r\n","import { useEffect } from \"react\";\r\n\r\nexport function KeyboardListener(props: {\r\n  callback: (ev: KeyboardEvent) => void;\r\n}) {\r\n  const callback = props.callback;\r\n  useEffect(() => {\r\n    window.addEventListener(\"keydown\", callback);\r\n    return () => window.removeEventListener(\"keydown\", callback);\r\n  }, [callback]);\r\n  return null;\r\n}\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  EquipmentSlot,\r\n  getEquippedItem,\r\n  getMaxEquippedItemsPerSlot,\r\n} from \"../../backend/items/Equipment\";\r\nimport {\r\n  getUsesLeftForPouchItem,\r\n  PouchItem,\r\n} from \"../../backend/items/equipment/PouchItem\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ItemInfo } from \"../inventory/ItemInfo\";\r\nimport { ItemTile } from \"../inventory/ItemTile\";\r\nimport { CheckBox } from \"../utility/CheckBox\";\r\nimport Styles from \"../utility/Styles\";\r\n\r\nfunction EquippedPouchSlot(props: { index: number }) {\r\n  const state = useContext(StateContext);\r\n  const index = props.index;\r\n  const equippedItem = getEquippedItem(state, EquipmentSlot.Pouch, index);\r\n\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const item =\r\n    equippedItem && (Items.getById(equippedItem.itemId) as PouchItem);\r\n  if (item && !(item instanceof PouchItem)) {\r\n    throw new Error(\"Only pouch items should be equipped\");\r\n  }\r\n\r\n  const useAction = item?.getPouchItemAction?.(\r\n    state,\r\n    index,\r\n    equippedItem.params,\r\n  );\r\n  const usesLeft = getUsesLeftForPouchItem(state, index);\r\n\r\n  return useMemo(() => {\r\n    if (!equippedItem) {\r\n      return (\r\n        <View key={index}>\r\n          <ItemTile title={t(\"Empty\")} />\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View key={index}>\r\n        <ItemTile\r\n          icon={item.getId()}\r\n          quality={equippedItem?.params?.itemQuality}\r\n          disabled={!useAction.isEnabled}\r\n          amount={usesLeft > 1 ? usesLeft : undefined}\r\n          title={item.getName(equippedItem.params)}\r\n          onPress={() => stateRef.current.apply(useAction.transform)}\r\n          tooltip={\r\n            <ItemInfo\r\n              showTile={false}\r\n              itemStack={{ itemOccurrence: equippedItem, amount: 1 }}\r\n            />\r\n          }\r\n          tooltipIdSuffix={\"explorationPouch\" + index}\r\n        />\r\n      </View>\r\n    );\r\n  }, [\r\n    JSON.stringify(equippedItem),\r\n    useAction?.isEnabled,\r\n    index,\r\n    usesLeft,\r\n    useAction?.transform,\r\n    stateRef,\r\n    item?.getName(equippedItem?.params || {}),\r\n  ]);\r\n}\r\n\r\nexport default function ExplorationPouch(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const capacity = getMaxEquippedItemsPerSlot(state, EquipmentSlot.Pouch);\r\n  const slotComponents = useMemo(() => {\r\n    let slotComponents = [];\r\n    for (let i = 0; i < capacity; i++) {\r\n      slotComponents.push(<EquippedPouchSlot key={i} index={i} />);\r\n    }\r\n    return slotComponents;\r\n  }, [capacity]);\r\n\r\n  const autoUsePouchToggle = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.global.autoUsePouch = !state.global.autoUsePouch;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <View>\r\n      <View\r\n        style={[\r\n          Styles.flexRowAlignCenter,\r\n          Styles.flexCenter,\r\n          { flexWrap: \"wrap\" },\r\n        ]}\r\n      >\r\n        {slotComponents}\r\n      </View>\r\n      <View style={[Styles.mt16, Styles.ph16]}>\r\n        <View>\r\n          <CheckBox\r\n            title={t(\"Auto-use pouch items\")}\r\n            checked={state.global.autoUsePouch}\r\n            onPress={autoUsePouchToggle}\r\n          />\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { Image, StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport {\r\n  TemporaryEffects,\r\n  getTemporaryEffectsForTarget,\r\n} from \"../../backend/temporaryeffects/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../backend/timetick/TotalTimePlayed\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\nimport Tooltip from \"./tooltip/PaperTooltip\";\r\n\r\nconst HITSLOP = { top: 8, bottom: 8, left: 8, right: 8 };\r\n\r\nfunction TemporaryEffectRow(props: {\r\n  tooltip: string;\r\n  text: string;\r\n  icon: any;\r\n}) {\r\n  const theme = useTheme();\r\n  const tooltip = useMemo(\r\n    () => (\r\n      <View style={Styles.mr8}>\r\n        <Tooltip title={props.tooltip} hitSlop={HITSLOP}>\r\n          <MaterialIcons\r\n            name=\"info\"\r\n            size={16}\r\n            color={theme.colors.onBackground}\r\n          />\r\n        </Tooltip>\r\n      </View>\r\n    ),\r\n    [props.tooltip, theme],\r\n  );\r\n  const viewStyle = useMemo(\r\n    () => [\r\n      styles.row,\r\n      {\r\n        width: \"100%\",\r\n      },\r\n    ],\r\n    [],\r\n  );\r\n  return (\r\n    <View style={viewStyle}>\r\n      {tooltip}\r\n      <Image source={props.icon} style={styles.icon} />\r\n      <Text doNotScaleFonts={true} style={styles.boostText}>\r\n        {props.text}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst TemporaryEffectRowMemo = React.memo(TemporaryEffectRow);\r\n\r\nexport function TemporaryEffectsViewer(props: {\r\n  target?: AttackTarget;\r\n  isVisible?: boolean;\r\n  accessibilityHeader?: string;\r\n  maxElements?: number;\r\n  skipPermacast?: boolean;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const target = props.target ?? AttackTarget.Player;\r\n  const temporaryEffects = getTemporaryEffectsForTarget(state, target)\r\n    .concat(\r\n      target == AttackTarget.Player\r\n        ? getTemporaryEffectsForTarget(state, AttackTarget.Familiar)\r\n        : [],\r\n    )\r\n    .sort(\r\n      (a, b) =>\r\n        (target == AttackTarget.Enemy ? -1 : 1) *\r\n          ((TemporaryEffects.getById(a.id).isBeneficial() ? 10000 : 0) -\r\n            (TemporaryEffects.getById(b.id).isBeneficial() ? 10000 : 0)) +\r\n        (a.fromPermacast ? 1000 : 0) -\r\n        (b.fromPermacast ? 1000 : 0) +\r\n        (a.fromPouch ? 100 : 0) -\r\n        (b.fromPouch ? 100 : 0) +\r\n        (a.fromAutocast ? 10 : 0) -\r\n        (b.fromAutocast ? 10 : 0),\r\n    );\r\n  const viewStyle = useMemo(\r\n    () => [\r\n      styles.row,\r\n      {\r\n        width: \"100%\",\r\n      },\r\n    ],\r\n    [],\r\n  );\r\n  return useMemo(() => {\r\n    const rows = temporaryEffects\r\n      .slice(0, props.maxElements)\r\n      .map((temporaryEffect, idx) => {\r\n        const { endTime } = temporaryEffect;\r\n        const temporaryEffectObject = TemporaryEffects.getById(\r\n          temporaryEffect.id,\r\n        );\r\n        const name = temporaryEffectObject.getDisplayName();\r\n        const timeLeftSec = endTime - getSecondsPlayed(state);\r\n        const isPermacast = temporaryEffect.fromPermacast;\r\n        const text =\r\n          isPermacast && !props.skipPermacast\r\n            ? t(\"{{familiarPrefix}}{{temporaryEffectName}} (P)\", {\r\n                temporaryEffectName: name,\r\n                familiarPrefix:\r\n                  temporaryEffect.target == AttackTarget.Familiar\r\n                    ? t(\"(Familiar) \")\r\n                    : \"\",\r\n              })\r\n            : t(\r\n                \"{{familiarPrefix}}{{temporaryEffectName}} ({{temporaryEffectDuration}} sec)\",\r\n                {\r\n                  temporaryEffectName: name,\r\n                  temporaryEffectDuration: formatNumber(timeLeftSec),\r\n                  familiarPrefix:\r\n                    temporaryEffect.target == AttackTarget.Familiar\r\n                      ? t(\"(Familiar) \")\r\n                      : \"\",\r\n                },\r\n              );\r\n        return (\r\n          <View\r\n            key={temporaryEffect.id + temporaryEffect.target}\r\n            style={idx > 0 && Styles.mt2}\r\n          >\r\n            <TemporaryEffectRowMemo\r\n              text={text}\r\n              tooltip={temporaryEffectObject.getDisplayDescription(\r\n                state,\r\n                temporaryEffect,\r\n              )}\r\n              icon={temporaryEffectObject.getIcon()}\r\n            />\r\n          </View>\r\n        );\r\n      });\r\n    let andMoreComponent = null;\r\n    if (rows.length < temporaryEffects.length) {\r\n      andMoreComponent = (\r\n        <View key=\"andMore\" style={viewStyle}>\r\n          <Text doNotScaleFonts={true} style={styles.boostText}>\r\n            {t(\"And {{notShownElements}} more...\", {\r\n              notShownElements: formatNumber(\r\n                temporaryEffects.length - rows.length,\r\n              ),\r\n            })}\r\n          </Text>\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View style={styles.container}>\r\n        {temporaryEffects.length > 0 && props.accessibilityHeader != null && (\r\n          <View\r\n            style={styles.accessibilityHidden}\r\n            accessible={true}\r\n            accessibilityLabel={props.accessibilityHeader}\r\n            accessibilityRole=\"header\"\r\n            accessibilityElementsHidden={false}\r\n          />\r\n        )}\r\n        {rows}\r\n        {andMoreComponent}\r\n      </View>\r\n    );\r\n  }, [\r\n    props.isVisible !== false ? state : false,\r\n    props.isVisible !== false ? temporaryEffects : false,\r\n    props.maxElements,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  icon: {\r\n    height: 16,\r\n    width: 16,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n    marginTop: 4,\r\n  },\r\n  boostText: {\r\n    flex: 1,\r\n    marginLeft: 8,\r\n  },\r\n  accessibilityHidden: {\r\n    width: 1,\r\n    height: 1,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport {\r\n  Platform,\r\n  ScrollView,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n} from \"react-native\";\r\nimport DraggableFlatList, {\r\n  DragEndParams,\r\n  RenderItemParams,\r\n  ScaleDecorator,\r\n} from \"react-native-draggable-flatlist\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  QuickbarAction,\r\n  QuickbarActionImpl,\r\n  getQuickbarActions,\r\n  removeFromQuickbar,\r\n} from \"../../backend/Quickbar\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActiveMark } from \"../utility/ActiveMark\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { IconButton } from \"../utility/IconButton\";\r\nimport { KeyboardListener } from \"../utility/KeyboardListener\";\r\nimport { getPrimaryButtonTextColor } from \"../utility/Miscellaneous\";\r\nimport Styles from \"../utility/Styles\";\r\n\r\nimport { getThemeByElementAndDarkMode } from \"../../Themes\";\r\nimport { Spell } from \"../../backend/spells/Spell\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { TemporaryEffectsViewer } from \"../utility/TemporaryEffectsViewer\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nfunction QuickbarIndexSelector(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const currentQuickbar = state.world.currentQuickbar;\r\n  const disableBackArrow = currentQuickbar <= 0;\r\n  const disableForwardArrow = currentQuickbar >= 3;\r\n  const slotNumber = currentQuickbar + 1;\r\n\r\n  const goBack = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.world.currentQuickbar = state.world.currentQuickbar - 1;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const goForward = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.world.currentQuickbar = state.world.currentQuickbar + 1;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const theme = useTheme();\r\n\r\n  const backButton = useMemo(\r\n    () => (\r\n      <Button\r\n        disabled={disableBackArrow}\r\n        accessibilityLabel={t(\"Previous Quickbar\")}\r\n        passthroughStyle={styles.quickbarSelectorButton}\r\n        ButtonComponent={IconButton}\r\n        size={24}\r\n        icon={() => (\r\n          <MaterialIcons\r\n            name=\"arrow-back\"\r\n            size={24}\r\n            color={\r\n              disableBackArrow\r\n                ? theme.colors.onSurfaceDisabled\r\n                : theme.colors.onPrimary\r\n            }\r\n          />\r\n        )}\r\n        disableDisabledRenderingOptimization={true}\r\n        onPress={goBack}\r\n      />\r\n    ),\r\n    [disableBackArrow, goBack],\r\n  );\r\n  const forwardButton = useMemo(\r\n    () => (\r\n      <Button\r\n        disabled={disableForwardArrow}\r\n        accessibilityLabel={t(\"Next Quickbar\")}\r\n        passthroughStyle={styles.quickbarSelectorButton}\r\n        ButtonComponent={IconButton}\r\n        size={24}\r\n        icon={() => (\r\n          <MaterialIcons\r\n            name=\"arrow-forward\"\r\n            size={24}\r\n            color={\r\n              disableForwardArrow\r\n                ? theme.colors.onSurfaceDisabled\r\n                : theme.colors.onPrimary\r\n            }\r\n          />\r\n        )}\r\n        disableDisabledRenderingOptimization={true}\r\n        onPress={goForward}\r\n      />\r\n    ),\r\n    [disableForwardArrow, goForward],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.row,\r\n          {\r\n            alignSelf: \"stretch\",\r\n            justifyContent: \"center\",\r\n          },\r\n        ]}\r\n      >\r\n        {backButton}\r\n        <View style={styles.barText}>\r\n          <View>\r\n            <Text>{t(\"Bar {{slot}}\", { slot: formatNumber(slotNumber) })}</Text>\r\n          </View>\r\n          {Platform.OS === \"web\" && (\r\n            <View>\r\n              <Text style={{ color: theme.colors.tertiary }} numberOfLines={1}>\r\n                {t(\"[Ctrl+1~4]\")}\r\n              </Text>\r\n            </View>\r\n          )}\r\n        </View>\r\n        {forwardButton}\r\n      </View>\r\n    ),\r\n    [backButton, slotNumber, forwardButton],\r\n  );\r\n}\r\n\r\nfunction QuickbarActionContainer(props: {\r\n  quickbarAction: QuickbarAction;\r\n  hotkey: string | undefined;\r\n  drag: () => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const quickbarAction = props.quickbarAction;\r\n  const name = quickbarAction.getDisplayName(state);\r\n  const transform = quickbarAction.getTransform(state);\r\n  const data = quickbarAction.toQuickbarData();\r\n  const enabled = quickbarAction.isEnabled(state);\r\n  const active = quickbarAction.isActive(state);\r\n\r\n  const theme = useTheme();\r\n  const elementTheme =\r\n    quickbarAction instanceof QuickbarActionImpl &&\r\n    state.options.colorSpellButtonsByElement\r\n      ? getThemeByElementAndDarkMode(\r\n          (quickbarAction.getAction() as Spell).getElement(),\r\n          theme.dark,\r\n        )\r\n      : theme;\r\n\r\n  const title = useMemo(() => {\r\n    if (props.hotkey) {\r\n      return (\r\n        <Text\r\n          style={[\r\n            styles.smallButtonTitle,\r\n            {\r\n              color: getPrimaryButtonTextColor(elementTheme, !enabled),\r\n            },\r\n            Styles.flex,\r\n          ]}\r\n          numberOfLines={2}\r\n        >\r\n          <Text\r\n            style={\r\n              enabled\r\n                ? { color: elementTheme.colors.onTertiary }\r\n                : { color: getPrimaryButtonTextColor(elementTheme, !enabled) }\r\n            }\r\n          >\r\n            [{props.hotkey}]\r\n          </Text>{\" \"}\r\n          {name}\r\n        </Text>\r\n      );\r\n    }\r\n    return (\r\n      <Text\r\n        style={[\r\n          styles.smallButtonTitle,\r\n          {\r\n            color: getPrimaryButtonTextColor(elementTheme, !enabled),\r\n          },\r\n          Styles.flex,\r\n        ]}\r\n        numberOfLines={2}\r\n      >\r\n        {name}\r\n      </Text>\r\n    );\r\n  }, [props.hotkey, name, elementTheme, enabled]);\r\n\r\n  const onPress = useCallback(\r\n    () => stateRef.current.apply(transform),\r\n    [transform],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <ScaleDecorator>\r\n        <View style={[Styles.flex, Styles.flexRowAlignCenter, Styles.mv4]}>\r\n          <View\r\n            importantForAccessibility=\"no-hide-descendants\"\r\n            accessibilityElementsHidden={true}\r\n            style={styles.dragHandle}\r\n          >\r\n            <TouchableWithoutFeedback\r\n              onPressIn={props.drag}\r\n              hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n              importantForAccessibility=\"no-hide-descendants\"\r\n              accessibilityElementsHidden={true}\r\n            >\r\n              <MaterialIcons\r\n                name=\"drag-indicator\"\r\n                size={24}\r\n                color={theme.colors.onSecondaryContainer}\r\n              />\r\n            </TouchableWithoutFeedback>\r\n          </View>\r\n          <View style={Styles.flex}>\r\n            <Button\r\n              icon={\r\n                active\r\n                  ? () => (\r\n                      <ActiveMark\r\n                        disabled={!enabled}\r\n                        style={{ marginRight: -8 }}\r\n                      />\r\n                    )\r\n                  : undefined\r\n              }\r\n              onPress={onPress}\r\n              disabled={!enabled}\r\n              compact={true}\r\n              style={Styles.flex}\r\n              labelStyle={{\r\n                marginHorizontal: 16,\r\n                flex: 1,\r\n                marginVertical: 0,\r\n                height: 40,\r\n              }}\r\n              contentStyle={{ marginHorizontal: 0, flex: 1, height: 40 }}\r\n              TextComponent={View}\r\n              enableAutoRepress={true}\r\n              disableDisabledRenderingOptimization={true}\r\n              numberOfLines={2}\r\n              theme={elementTheme}\r\n            >\r\n              <View style={[Styles.flex, Styles.flexRowAlignCenter]}>\r\n                <Text numberOfLines={2}>{title}</Text>\r\n              </View>\r\n            </Button>\r\n          </View>\r\n          <Button\r\n            accessibilityLabel={t(\"Remove from Quickbar\")}\r\n            // importantForAccessibility=\"no-hide-descendants\"\r\n            // accessibilityElementsHidden={true}\r\n            passthroughStyle={styles.deleteButton}\r\n            ButtonComponent={IconButton}\r\n            hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n            onPress={() =>\r\n              stateRef.current.apply((state) => {\r\n                return removeFromQuickbar(state, data);\r\n              })\r\n            }\r\n            icon=\"close\"\r\n            disableDisabledRenderingOptimization={true}\r\n          />\r\n        </View>\r\n      </ScaleDecorator>\r\n    ),\r\n    [\r\n      name,\r\n      stateRef,\r\n      transform,\r\n      enabled,\r\n      active,\r\n      removeFromQuickbar,\r\n      props.hotkey,\r\n      elementTheme,\r\n      props.drag,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function QuickbarContainer() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const quickbar = getQuickbarActions(state);\r\n\r\n  const renderItem = useCallback(\r\n    ({ item, getIndex, drag, isActive }: RenderItemParams<QuickbarAction>) => (\r\n      <QuickbarActionContainer\r\n        hotkey={\r\n          Platform.OS === \"web\"\r\n            ? (((getIndex() ?? 0) + 1) % 10).toString()\r\n            : undefined\r\n        }\r\n        drag={drag}\r\n        quickbarAction={item}\r\n      />\r\n    ),\r\n    [],\r\n  );\r\n  const keyExtractor = useCallback(\r\n    (quickbarAction: QuickbarAction) =>\r\n      JSON.stringify(quickbarAction.toQuickbarData()),\r\n    [],\r\n  );\r\n  const quickbarKeypressCallback = useCallback(\r\n    (ev: KeyboardEvent) => {\r\n      if (ev.ctrlKey) {\r\n        let slot = -1;\r\n        switch (ev.key) {\r\n          case \"1\":\r\n            slot = 0;\r\n            break;\r\n          case \"2\":\r\n            slot = 1;\r\n            break;\r\n          case \"3\":\r\n            slot = 2;\r\n            break;\r\n          case \"4\":\r\n            slot = 3;\r\n            break;\r\n        }\r\n        if (slot > -1) {\r\n          stateRef.current.apply((state) => {\r\n            state.world.currentQuickbar = slot;\r\n            return state;\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      let slot = -1;\r\n      switch (ev.key) {\r\n        case \"1\":\r\n          slot = 0;\r\n          break;\r\n        case \"2\":\r\n          slot = 1;\r\n          break;\r\n        case \"3\":\r\n          slot = 2;\r\n          break;\r\n        case \"4\":\r\n          slot = 3;\r\n          break;\r\n        case \"5\":\r\n          slot = 4;\r\n          break;\r\n        case \"6\":\r\n          slot = 5;\r\n          break;\r\n        case \"7\":\r\n          slot = 6;\r\n          break;\r\n        case \"8\":\r\n          slot = 7;\r\n          break;\r\n        case \"9\":\r\n          slot = 8;\r\n          break;\r\n        case \"0\":\r\n          slot = 9;\r\n          break;\r\n      }\r\n\r\n      if (slot >= 0) {\r\n        const quickbarAction = quickbar?.[slot];\r\n        if (quickbarAction != null) {\r\n          const transform = quickbarAction.getTransform(stateRef.current);\r\n          const enabled = quickbarAction.isEnabled(stateRef.current);\r\n          if (enabled) {\r\n            stateRef.current.apply(transform);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    [JSON.stringify(quickbar)],\r\n  );\r\n  const onDragEnd = useCallback((params: DragEndParams<QuickbarAction>) => {\r\n    stateRef.current.apply((state) => {\r\n      state.world.quickbars[state.world.currentQuickbar] = params.data.map(\r\n        (quickbarAction) => quickbarAction.toQuickbarData(),\r\n      );\r\n      return state;\r\n    });\r\n  }, []);\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.mainContainer}>\r\n        <KeyboardListener callback={quickbarKeypressCallback} />\r\n        <View style={styles.actionsContainer}>\r\n          {Platform.select({\r\n            web: (\r\n              <ScrollView\r\n                style={styles.actionsScroll}\r\n                nestedScrollEnabled={true}\r\n              >\r\n                {quickbar.length > 0 ? (\r\n                  <DraggableFlatList\r\n                    renderItem={renderItem}\r\n                    data={quickbar}\r\n                    keyExtractor={keyExtractor}\r\n                    onDragEnd={onDragEnd}\r\n                    nestedScrollEnabled={true}\r\n                  />\r\n                ) : (\r\n                  <Text style={styles.emptyText}>\r\n                    {t(\r\n                      'Your Quickbar is empty. Add actions to the Quickbar through the \"Spells\" menu at the bottom!',\r\n                    )}\r\n                  </Text>\r\n                )}\r\n              </ScrollView>\r\n            ),\r\n            default:\r\n              quickbar.length > 0 ? (\r\n                <DraggableFlatList\r\n                  renderItem={renderItem}\r\n                  data={quickbar}\r\n                  keyExtractor={keyExtractor}\r\n                  onDragEnd={onDragEnd}\r\n                  nestedScrollEnabled={true}\r\n                />\r\n              ) : (\r\n                <Text style={styles.emptyText}>\r\n                  {t(\r\n                    'Your Quickbar is empty. Add actions to the Quickbar through the \"Spells\" menu at the bottom!',\r\n                  )}\r\n                </Text>\r\n              ),\r\n          })}\r\n        </View>\r\n        <View style={styles.infoContainer}>\r\n          <View\r\n            style={styles.accessibilityHidden}\r\n            accessible={true}\r\n            accessibilityLabel={t(\"Select Quickbar slot\")}\r\n            accessibilityRole=\"header\"\r\n            accessibilityElementsHidden={false}\r\n          />\r\n          <QuickbarIndexSelector />\r\n          <ScrollView style={styles.infoContainer} nestedScrollEnabled={true}>\r\n            <TemporaryEffectsViewer accessibilityHeader={t(\"Player Buffs\")} />\r\n          </ScrollView>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      renderItem,\r\n      keyExtractor,\r\n      onDragEnd,\r\n      JSON.stringify(quickbar),\r\n      quickbarKeypressCallback,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  emptyText: { fontWeight: \"bold\", fontStyle: \"italic\" },\r\n  row: { flexDirection: \"row\", alignItems: \"center\", marginVertical: 4 },\r\n  mainContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"stretch\",\r\n    height: \"100%\",\r\n  },\r\n  actionsContainer: {\r\n    flex: 1.5,\r\n    marginRight: 8,\r\n  },\r\n  infoContainer: { flex: 1 },\r\n  actionsScroll: { flex: 1 },\r\n  mainButton: {\r\n    flex: 1,\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  deleteButton: {\r\n    marginLeft: 8,\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 24,\r\n    width: 24,\r\n    borderRadius: 16,\r\n  },\r\n  quickbarSelectorButton: {\r\n    height: 24,\r\n    width: 24,\r\n    borderRadius: 12,\r\n    marginHorizontal: 4,\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n  },\r\n  barText: {\r\n    marginHorizontal: 4,\r\n    alignItems: \"center\",\r\n  },\r\n  dragHandle: {\r\n    cursor: \"grab\",\r\n    marginRight: 8,\r\n  },\r\n  accessibilityHidden: {\r\n    width: 1,\r\n    height: 1,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  EquipmentSlot,\r\n  getMaxEquippedItemsPerSlot,\r\n  loadEquipmentLoadoutFromPosition,\r\n} from \"../../backend/items/Equipment\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\n\r\nexport function EquipmentSetButtons() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const setNumber = state.run.lastEquipmentLoadoutModified + 1;\r\n\r\n  const equipmentSetButtonCallback = useCallback((index: number) => {\r\n    stateRef.current.apply((state) =>\r\n      loadEquipmentLoadoutFromPosition(state, index),\r\n    );\r\n  }, []);\r\n\r\n  const theme = useTheme();\r\n\r\n  const equipmentSetButtons = useMemo(() => {\r\n    return [0, 1, 2, 3].map((i) => {\r\n      const equipmentSet = state.run.equipmentLoadouts?.[i];\r\n      const icons: React.ReactNode[] = [];\r\n      for (let slot of [\r\n        EquipmentSlot.Hand,\r\n        EquipmentSlot.Body,\r\n        EquipmentSlot.Accessory,\r\n      ]) {\r\n        const capacity = getMaxEquippedItemsPerSlot(state, slot);\r\n        for (let i = 0; i < capacity; i++) {\r\n          const itemOccurrence = equipmentSet?.equipment?.[slot]?.[i];\r\n          if (itemOccurrence != null) {\r\n            const icon = (\r\n              <GameIcon\r\n                key={slot + i}\r\n                icon={itemOccurrence.itemId}\r\n                small={true}\r\n              />\r\n            );\r\n            icons.push(icon);\r\n          } else {\r\n            icons.push(<View key={slot + i} style={styles.emptyIcon} />);\r\n          }\r\n        }\r\n      }\r\n\r\n      return (\r\n        <View key={i} style={styles.buttonContainer}>\r\n          <Button\r\n            style={styles.setButton}\r\n            contentStyle={{ margin: 0, flex: 1 }}\r\n            disabled={setNumber == i + 1}\r\n            compact={true}\r\n            onPress={equipmentSetButtonCallback.bind(null, i)}\r\n          >\r\n            {t(`Set {{number}}`, { number: i + 1 })}\r\n          </Button>\r\n          <View style={styles.iconsContainer}>{icons}</View>\r\n        </View>\r\n      );\r\n    });\r\n  }, [\r\n    JSON.stringify(state.run.equipmentLoadouts),\r\n    equipmentSetButtonCallback,\r\n    setNumber,\r\n    theme,\r\n  ]);\r\n\r\n  return (\r\n    <View style={styles.equipmentSetButtonsRow}>{equipmentSetButtons}</View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  equipmentSetButtonsRow: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  setButton: {\r\n    width: 70,\r\n  },\r\n  setText: {\r\n    marginRight: 8,\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  iconsContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    height: 16,\r\n    width: 48,\r\n    marginTop: 2,\r\n  },\r\n  emptyIcon: {\r\n    width: 16,\r\n  },\r\n  buttonContainer: {\r\n    marginLeft: 4,\r\n    alignItems: \"center\",\r\n    width: 70,\r\n  },\r\n});\r\n","import color from \"color\";\r\nimport { useContext, useMemo } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { getThemeByElementAndDarkMode } from \"../../Themes\";\r\nimport { SYNCHRO_INITIAL_STATE, StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  SYNCHRO_COLS,\r\n  SYNCHRO_ROWS,\r\n  getSynchroPosition,\r\n} from \"../../backend/synchro/Synchro\";\r\nimport Styles from \"../utility/Styles\";\r\n\r\nexport function SynchroGridSmallDisplay(props: { gridIndex: number }) {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n  const strategy =\r\n    state.world.synchro.grids[props.gridIndex] ?? SYNCHRO_INITIAL_STATE;\r\n\r\n  const rows = useMemo(() => {\r\n    const rows = [];\r\n    for (let j = 0; j < SYNCHRO_ROWS; j++) {\r\n      const currentRow = [];\r\n      for (let i = 0; i < SYNCHRO_COLS; i++) {\r\n        const element = getSynchroPosition(state, i, j, strategy);\r\n        let backgroundColor = undefined;\r\n        if (element != null) {\r\n          const elementTheme = getThemeByElementAndDarkMode(\r\n            element,\r\n            theme.dark,\r\n          );\r\n          backgroundColor = color(elementTheme.colors.primaryContainer)\r\n            .saturate(0.5)\r\n            .lighten(theme.dark ? 0.5 : -0.5)\r\n            .toString();\r\n        }\r\n\r\n        currentRow.push(\r\n          <View\r\n            key={i}\r\n            style={{\r\n              width: 8,\r\n              height: 8,\r\n              borderLeftWidth: 1,\r\n              borderTopWidth: 1,\r\n              borderColor: theme.colors.outline,\r\n              backgroundColor,\r\n            }}\r\n          />,\r\n        );\r\n      }\r\n      rows.push(\r\n        <View key={j} style={Styles.flexRowAlignCenter}>\r\n          {currentRow}\r\n        </View>,\r\n      );\r\n    }\r\n    return rows;\r\n  }, [JSON.stringify(strategy), theme]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={{\r\n          borderRightWidth: 1,\r\n          borderBottomWidth: 1,\r\n          borderColor: theme.colors.outline,\r\n        }}\r\n      >\r\n        {rows}\r\n      </View>\r\n    ),\r\n    [rows, theme],\r\n  );\r\n}\r\n","import color from \"color\";\r\nimport { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { TouchableOpacity, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { setCurrentSynchroGrid } from \"../../backend/synchro/Synchro\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { SynchroGridSmallDisplay } from \"./SynchroGridSmallDisplay\";\r\n\r\nexport function SynchroGridSelector(props: { gridIndex: number }) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const theme = useTheme();\r\n\r\n  const onPress = useCallback(\r\n    () =>\r\n      stateRef.current.apply((state) => {\r\n        state = setCurrentSynchroGrid(state, props.gridIndex);\r\n        return state;\r\n      }),\r\n    [props.gridIndex],\r\n  );\r\n\r\n  const selected = props.gridIndex == state.world.synchro.currentGrid;\r\n\r\n  return useMemo(\r\n    () => (\r\n      <TouchableOpacity\r\n        onPress={onPress}\r\n        accessible={true}\r\n        accessibilityLabel={\r\n          selected\r\n            ? t(\"Selected - Select Grid {{index}}\", {\r\n                index: formatNumber(props.gridIndex + 1),\r\n              })\r\n            : t(\"Select Grid {{index}}\", {\r\n                index: formatNumber(props.gridIndex + 1),\r\n              })\r\n        }\r\n        accessibilityRole=\"button\"\r\n      >\r\n        <View\r\n          style={{\r\n            borderRadius: 4,\r\n            backgroundColor: selected\r\n              ? color(theme.colors.primary).alpha(0.25).toString()\r\n              : undefined,\r\n            padding: 4,\r\n          }}\r\n        >\r\n          <SynchroGridSmallDisplay gridIndex={props.gridIndex} />\r\n        </View>\r\n      </TouchableOpacity>\r\n    ),\r\n    [onPress, selected, theme, props.gridIndex],\r\n  );\r\n}\r\n","import { memo } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport { SYNCHRO_GRID_AMOUNT } from \"../../backend/synchro/Synchro\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { SynchroGridSelector } from \"./SynchroGridSelector\";\r\n\r\nexport const SynchroGridSelectors = memo((props: {}) => {\r\n  const selectors = [];\r\n  for (let i = 0; i < SYNCHRO_GRID_AMOUNT; i++) {\r\n    selectors.push(<SynchroGridSelector key={i} gridIndex={i} />);\r\n  }\r\n\r\n  return (\r\n    <View style={Styles.flexRowAlignCenter}>\r\n      <View>\r\n        <Text h4>{t(\"Grids:\")}</Text>\r\n      </View>\r\n      <View\r\n        style={[\r\n          Styles.ml16,\r\n          Styles.flexRowAlignCenter,\r\n          { flex: 1, gap: 4, flexWrap: \"wrap\" },\r\n        ]}\r\n      >\r\n        {selectors}\r\n      </View>\r\n    </View>\r\n  );\r\n});\r\n","import { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { loadAutocastStrategy } from \"../../backend/autocast/Autocast\";\r\nimport { keysOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"./Button\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function AutocastLoadoutLoadContainer(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const loadoutObjects = state.global.autocast.savedStrategies ?? [];\r\n  const loadPosition = useCallback((position: number) => {\r\n    stateRef.current.apply((state) => loadAutocastStrategy(state, position));\r\n  }, []);\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.loadoutsLoadRow}>\r\n        <View style={styles.loadTextContainer}>\r\n          <Text>{t(\"Load:\")}</Text>\r\n        </View>\r\n        {keysOf(loadoutObjects).length > 0 ? (\r\n          keysOf(loadoutObjects).map((key) => {\r\n            const loadoutObject = loadoutObjects[key];\r\n            if (loadoutObject == null) {\r\n              return null;\r\n            }\r\n            const name =\r\n              loadoutObject?.name != \"\" && loadoutObject?.name != null\r\n                ? loadoutObject?.name\r\n                : t(\"Slot {{slot}}\", {\r\n                    slot:\r\n                      (typeof key === \"string\" ? Number.parseInt(key) : key) +\r\n                      1,\r\n                  });\r\n            return (\r\n              <Button\r\n                key={key}\r\n                style={styles.loadButton}\r\n                labelStyle={styles.smallButtonTitle}\r\n                compact={true}\r\n                onPress={loadPosition.bind(null, key)}\r\n              >\r\n                {name}\r\n              </Button>\r\n            );\r\n          })\r\n        ) : (\r\n          <Text style={styles.noLoadoutsText}>\r\n            {t(\"No loadouts have been saved yet!\")}\r\n          </Text>\r\n        )}\r\n      </View>\r\n    ),\r\n    [JSON.stringify(loadoutObjects), loadPosition],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  loadoutsLoadRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    alignItems: \"center\",\r\n    gap: 8,\r\n  },\r\n  loadButton: {},\r\n  loadTextContainer: {\r\n    marginRight: 8,\r\n  },\r\n  noLoadoutsText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n});\r\n","import React, { useCallback, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { isSynchroUnlocked } from \"../../backend/synchro/Synchro\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { EquipmentSetButtons } from \"../inventory/EquipmentSetButtons\";\r\nimport { SynchroGridSelectors } from \"../synchro/SynchroGridSelectors\";\r\nimport { AutocastLoadoutLoadContainer } from \"../utility/AutocastLoadoutLoadContainer\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport { CheckBox } from \"../utility/CheckBox\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function StrategyContainer() {\r\n  const state = React.useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const theme = useTheme();\r\n\r\n  const lastLoadoutUsed =\r\n    state.global.autocast.savedStrategies?.[\r\n      state.global.autocast.lastStrategyIndex\r\n    ]?.name ?? null;\r\n\r\n  const autoNextFloorCallback = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.run.autoAdvanceToNextFloor = !state.run.autoAdvanceToNextFloor;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const autoBossCallback = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.run.autoAttemptBoss = !state.run.autoAttemptBoss;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const fullyHealedCallback = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.options.waitUntilFullyHealedBeforeExplore =\r\n        !state.options.waitUntilFullyHealedBeforeExplore;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.mainContainer}>\r\n        <View style={styles.actionsContainer}>\r\n          <CategoryContainer\r\n            title={t(\"Equipment Sets\")}\r\n            containerStyle={styles.equipmentContainer}\r\n            dividerColor={theme.colors.surfaceDisabled}\r\n          >\r\n            <View style={styles.categoryContents}>\r\n              <EquipmentSetButtons />\r\n            </View>\r\n          </CategoryContainer>\r\n          {isSynchroUnlocked(state) && (\r\n            <CategoryContainer\r\n              title={t(\"Synchro Grids\")}\r\n              containerStyle={styles.autocastContainer}\r\n              dividerColor={theme.colors.surfaceDisabled}\r\n            >\r\n              <View style={styles.categoryContents}>\r\n                <SynchroGridSelectors />\r\n              </View>\r\n            </CategoryContainer>\r\n          )}\r\n          <CategoryContainer\r\n            title={t(\"Wizard Strategy\")}\r\n            containerStyle={styles.autocastContainer}\r\n            dividerColor={theme.colors.surfaceDisabled}\r\n          >\r\n            <View style={styles.categoryContents}>\r\n              <AutocastLoadoutLoadContainer />\r\n              {lastLoadoutUsed != null && (\r\n                <View style={styles.lastLoadedContainer}>\r\n                  <Text>\r\n                    {t(\"Last loaded: {{lastLoadoutUsed}}\", { lastLoadoutUsed })}\r\n                  </Text>\r\n                </View>\r\n              )}\r\n            </View>\r\n          </CategoryContainer>\r\n          <CategoryContainer\r\n            title={t(\"Exploration Config\")}\r\n            containerStyle={styles.autocastContainer}\r\n            dividerColor={theme.colors.surfaceDisabled}\r\n          >\r\n            <View style={styles.categoryContents}>\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\"Automatically advance to the next floor\")}\r\n                  checked={state.run.autoAdvanceToNextFloor}\r\n                  onPress={autoNextFloorCallback}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\"Automatically attempt fighting the boss\")}\r\n                  checked={state.run.autoAttemptBoss}\r\n                  onPress={autoBossCallback}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\"Wait until fully healed before exploring\")}\r\n                  checked={state.options.waitUntilFullyHealedBeforeExplore}\r\n                  onPress={fullyHealedCallback}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n            </View>\r\n          </CategoryContainer>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      lastLoadoutUsed,\r\n      state.run.autoAdvanceToNextFloor,\r\n      state.run.autoAttemptBoss,\r\n      state.options.waitUntilFullyHealedBeforeExplore,\r\n      isSynchroUnlocked(state),\r\n      theme,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  mainContainer: {\r\n    height: \"100%\",\r\n  },\r\n  actionsContainer: {\r\n    flex: 1.5,\r\n    marginRight: 8,\r\n  },\r\n  equipmentContainer: {\r\n    paddingTop: 0,\r\n  },\r\n  autocastContainer: {\r\n    paddingTop: 0,\r\n    marginTop: 16,\r\n  },\r\n  categoryContents: {\r\n    marginTop: 8,\r\n  },\r\n  lastLoadedContainer: {\r\n    marginTop: 8,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    marginTop: 8,\r\n    padding: 0,\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport {\r\n  Platform,\r\n  ScrollView,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\r\nimport { clearFlag, hasFlag, setFlag } from \"../../backend/Flags\";\r\nimport { GameState, StateContext } from \"../../backend/GameState\";\r\nimport { ActionArea } from \"../../backend/action/ActionAreas\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport SpellsContainer from \"../spells/SpellsContainer\";\r\nimport { AccessibilityContext } from \"../utility/AccessibilityContext\";\r\nimport { KeyboardListener } from \"../utility/KeyboardListener\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"../utility/UIContext\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\nimport ExplorationPouch from \"./ExplorationPouch\";\r\nimport { QuickbarContainer } from \"./QuickbarContainer\";\r\nimport { StrategyContainer } from \"./StrategyContainer\";\r\n\r\nexport function ExplorationBottomComponent(props: { containerHeight: number }) {\r\n  const uiContext = useContext(UIContext);\r\n  const [openedTab, setOpenedTab] = useUIStateFromContext(\r\n    uiContext,\r\n    \"exploration_bottom_component_tab\",\r\n    \"\",\r\n  );\r\n  const theme = useTheme();\r\n  const visible = useContext(VisibilityContext);\r\n  const { height, width } = useWindowDimensions();\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const isBottomMenuEnabled = state.options.enableBottomMenu;\r\n\r\n  const insets = useSafeAreaInsets();\r\n\r\n  const accessibilityContext = useContext(AccessibilityContext);\r\n  const isPaused = hasFlag(state, \"combat_paused_magic_tap\");\r\n\r\n  const onPause = useCallback(() => {\r\n    stateRef.current.apply((state: GameState) =>\r\n      isPaused\r\n        ? clearFlag(\"combat_paused_magic_tap\")(state)\r\n        : setFlag(\"combat_paused_magic_tap\")(state),\r\n    );\r\n    accessibilityContext.announceForAccessibility(\r\n      isPaused ? t(\"Resuming Exploration\") : t(\"Pausing Exploration\"),\r\n    );\r\n  }, [accessibilityContext, isPaused]);\r\n\r\n  const onKeyboard = useCallback(\r\n    (ev: KeyboardEvent) => {\r\n      if (visible && ev.shiftKey && ev.ctrlKey && ev.key == \"X\") {\r\n        onPause();\r\n      }\r\n    },\r\n    [onPause, visible],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        <View\r\n          style={[\r\n            styles.mainComponent,\r\n            {\r\n              backgroundColor: theme.colors.secondaryContainer,\r\n              borderColor: theme.colors.outlineVariant,\r\n            },\r\n            !openedTab && { display: \"none\" },\r\n          ]}\r\n        >\r\n          {openedTab == \"Inventory\" && (\r\n            <ScrollView\r\n              style={[\r\n                styles.mainScrollView,\r\n                {\r\n                  height: Math.max(\r\n                    Math.min(props.containerHeight - 434, 350),\r\n                    168,\r\n                  ),\r\n                },\r\n              ]}\r\n              nestedScrollEnabled={true}\r\n            >\r\n              <View\r\n                style={styles.accessibilityHidden}\r\n                accessible={true}\r\n                accessibilityLabel={t(\"Inventory Tab\")}\r\n                accessibilityRole=\"header\"\r\n                accessibilityElementsHidden={false}\r\n              />\r\n              <ExplorationPouch />\r\n            </ScrollView>\r\n          )}\r\n          <ScrollView\r\n            style={[\r\n              styles.mainScrollView,\r\n              {\r\n                height: Math.max(\r\n                  Math.min(props.containerHeight - 434, 350),\r\n                  168,\r\n                ),\r\n              },\r\n              openedTab != \"Spells\" && { display: \"none\" },\r\n            ]}\r\n          >\r\n            <View\r\n              style={styles.accessibilityHidden}\r\n              accessible={true}\r\n              accessibilityLabel={t(\"Spells Tab\")}\r\n              accessibilityRole=\"header\"\r\n              accessibilityElementsHidden={false}\r\n            />\r\n            <SpellsContainer\r\n              uiKey=\"ExplorationBottomContainer\"\r\n              area={ActionArea.EXPLORATION}\r\n              hideRecent={true}\r\n              showAddToQuickbar={true}\r\n              onlyBySchool={true}\r\n              hideTitle={true}\r\n              isVisible={openedTab == \"Spells\"}\r\n              dividerColor={theme.colors.surfaceDisabled}\r\n            />\r\n          </ScrollView>\r\n          {openedTab == \"Quickbar\" && (\r\n            <View\r\n              style={[\r\n                styles.quickbarScrollView,\r\n                {\r\n                  height: Math.max(\r\n                    Math.min(props.containerHeight - 434, 350),\r\n                    168,\r\n                  ),\r\n                },\r\n              ]}\r\n            >\r\n              <View\r\n                style={styles.accessibilityHidden}\r\n                accessible={true}\r\n                accessibilityLabel={t(\"Quickbar Tab\")}\r\n                accessibilityRole=\"header\"\r\n                accessibilityElementsHidden={false}\r\n              />\r\n              <QuickbarContainer />\r\n            </View>\r\n          )}\r\n          {openedTab == \"Strategy\" && (\r\n            <ScrollView\r\n              style={[\r\n                styles.mainScrollView,\r\n                {\r\n                  height: Math.max(\r\n                    Math.min(props.containerHeight - 434, 350),\r\n                    150,\r\n                  ),\r\n                },\r\n                openedTab != \"Strategy\" && { display: \"none\" },\r\n              ]}\r\n            >\r\n              <View\r\n                style={styles.accessibilityHidden}\r\n                accessible={true}\r\n                accessibilityLabel={t(\"Strategy Tab\")}\r\n                accessibilityRole=\"header\"\r\n                accessibilityElementsHidden={false}\r\n              />\r\n              <StrategyContainer />\r\n            </ScrollView>\r\n          )}\r\n        </View>\r\n        <View style={styles.tabsContainer}>\r\n          <View\r\n            style={styles.accessibilityHidden}\r\n            accessible={true}\r\n            accessibilityLabel=\"Exploration Tabs\"\r\n            accessibilityRole=\"header\"\r\n            accessibilityElementsHidden={false}\r\n          />\r\n          <TouchableWithoutFeedback\r\n            onPress={onPause}\r\n            accessibilityElementsHidden={false}\r\n          >\r\n            <View\r\n              accessibilityLabel={\r\n                isPaused\r\n                  ? t(\"Resume Exploration {{shortcut}}\", {\r\n                      shortcut:\r\n                        Platform.OS === \"web\"\r\n                          ? t(\"(Shortcut Control + Shift + X)\")\r\n                          : \"\",\r\n                    })\r\n                  : t(\"Pause Exploration {{shortcut}}\", {\r\n                      shortcut:\r\n                        Platform.OS === \"web\"\r\n                          ? t(\"(Shortcut Control + Shift + X)\")\r\n                          : \"\",\r\n                    })\r\n              }\r\n              accessibilityRole=\"button\"\r\n              style={[styles.accessibilityHidden, { left: 1 }]}\r\n            />\r\n          </TouchableWithoutFeedback>\r\n          <TouchableWithoutFeedback\r\n            onPress={() => {\r\n              setOpenedTab(\"\");\r\n            }}\r\n            accessibilityElementsHidden={false}\r\n          >\r\n            <View\r\n              accessibilityLabel={t(\"Exploration Log - Exploration\")}\r\n              accessibilityRole=\"tab\"\r\n              style={[styles.accessibilityHidden, { left: 2 }]}\r\n            />\r\n          </TouchableWithoutFeedback>\r\n          <KeyboardListener callback={onKeyboard} />\r\n          <TouchableWithoutFeedback\r\n            onPress={() => {\r\n              if (openedTab != \"Inventory\") {\r\n                setOpenedTab(\"Inventory\");\r\n              } else {\r\n                setOpenedTab(\"\");\r\n              }\r\n            }}\r\n            accessibilityLabel={t(\"Items - Exploration\")}\r\n            accessibilityRole=\"tab\"\r\n          >\r\n            <View\r\n              style={[\r\n                styles.tab,\r\n                {\r\n                  backgroundColor: theme.colors.secondaryContainer,\r\n                  borderColor: theme.colors.outlineVariant,\r\n                },\r\n                openedTab == \"Inventory\" && styles.selectedTab,\r\n              ]}\r\n            >\r\n              <Text h3>{t(\"Items\")}</Text>\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n          <TouchableWithoutFeedback\r\n            onPress={() => {\r\n              if (openedTab != \"Spells\") {\r\n                setOpenedTab(\"Spells\");\r\n              } else {\r\n                setOpenedTab(\"\");\r\n              }\r\n            }}\r\n            accessibilityLabel={t(\"Spells - Exploration\")}\r\n            accessibilityRole=\"tab\"\r\n          >\r\n            <View\r\n              style={[\r\n                styles.tab,\r\n                {\r\n                  backgroundColor: theme.colors.secondaryContainer,\r\n                  borderColor: theme.colors.outlineVariant,\r\n                },\r\n                openedTab == \"Spells\" && styles.selectedTab,\r\n              ]}\r\n            >\r\n              <Text h3>{t(\"Spells\")}</Text>\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n          <TouchableWithoutFeedback\r\n            onPress={() => {\r\n              if (openedTab != \"Strategy\") {\r\n                setOpenedTab(\"Strategy\");\r\n              } else {\r\n                setOpenedTab(\"\");\r\n              }\r\n            }}\r\n            accessibilityLabel={t(\"Strategy - Exploration\")}\r\n            accessibilityRole=\"tab\"\r\n          >\r\n            <View\r\n              style={[\r\n                styles.tab,\r\n                {\r\n                  backgroundColor: theme.colors.secondaryContainer,\r\n                  borderColor: theme.colors.outlineVariant,\r\n                },\r\n                openedTab == \"Strategy\" && styles.selectedTab,\r\n              ]}\r\n            >\r\n              <Text h3>{t(\"Strategy\")}</Text>\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n          <TouchableWithoutFeedback\r\n            onPress={() => {\r\n              if (openedTab != \"Quickbar\") {\r\n                setOpenedTab(\"Quickbar\");\r\n              } else {\r\n                setOpenedTab(\"\");\r\n              }\r\n            }}\r\n            accessibilityLabel={t(\"Quickbar - Exploration\")}\r\n            accessibilityRole=\"tab\"\r\n          >\r\n            <View\r\n              style={[\r\n                styles.tab,\r\n                {\r\n                  backgroundColor: theme.colors.secondaryContainer,\r\n                  borderColor: theme.colors.outlineVariant,\r\n                },\r\n                openedTab == \"Quickbar\" && styles.selectedTab,\r\n              ]}\r\n            >\r\n              <Text h3>{t(\"Quickbar\")}</Text>\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      openedTab,\r\n      setOpenedTab,\r\n      theme,\r\n      visible,\r\n      props.containerHeight,\r\n      onPause,\r\n      isPaused,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  mainComponent: {\r\n    padding: 8,\r\n    marginHorizontal: 2,\r\n    borderWidth: StyleSheet.hairlineWidth,\r\n  },\r\n  mainScrollView: { height: 296 },\r\n  quickbarScrollView: { height: 226, overflow: \"hidden\" },\r\n  tabsContainer: {\r\n    marginHorizontal: 8,\r\n    marginBottom: 8,\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-end\",\r\n    justifyContent: \"space-evenly\",\r\n  },\r\n  tab: {\r\n    borderWidth: StyleSheet.hairlineWidth,\r\n    borderRadius: 8,\r\n    padding: 8,\r\n    top: -1,\r\n    cursor: \"pointer\",\r\n  },\r\n  selectedTab: {\r\n    borderTopLeftRadius: 0,\r\n    borderTopRightRadius: 0,\r\n    borderTopWidth: 0,\r\n    paddingTop: 16,\r\n    position: \"relative\",\r\n  },\r\n  accessibilityHidden: {\r\n    width: 1,\r\n    height: 1,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport {\r\n  getExplorationStartTime,\r\n  getExplorationTimeRequirementSec,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { getSecondsPlayed } from \"../../backend/timetick/TotalTimePlayed\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\n\r\nexport function ExplorationProgressDisplay() {\r\n  const state = useContext(StateContext);\r\n  const currentTime = getSecondsPlayed(state);\r\n  const actionStartTime = getExplorationStartTime(state);\r\n  const actionTotalTime = getExplorationTimeRequirementSec(state);\r\n  const progress = (currentTime - actionStartTime) / actionTotalTime;\r\n  return (\r\n    <View style={{ width: 120 }}>\r\n      <ProgressBar progress={progress} />\r\n    </View>\r\n  );\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { ActivityIndicator } from \"react-native-paper\";\r\nimport {\r\n  getCurrentFamiliarAction,\r\n  getFamiliarActionProgress,\r\n} from \"../../backend/exploration/Exploration\";\r\nimport {\r\n  FamiliarCompanionStatusType,\r\n  getCurrentCompanionData,\r\n} from \"../../backend/familiars/Familiar\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function FamiliarActionDisplay() {\r\n  const state = useContext(StateContext);\r\n  const currentFamiliarAction = getCurrentFamiliarAction(state);\r\n  const ready = [\r\n    FamiliarCompanionStatusType.Exploring,\r\n    FamiliarCompanionStatusType.Combat,\r\n  ].includes(getCurrentCompanionData(state).status.companionStatus);\r\n  const progress = getFamiliarActionProgress(state);\r\n\r\n  return useMemo(() => {\r\n    if (!ready) {\r\n      return (\r\n        <View style={[styles.row, Styles.flexCenter]}>\r\n          <ActivityIndicator size=\"small\" />\r\n        </View>\r\n      );\r\n    }\r\n    if (!currentFamiliarAction) {\r\n      return (\r\n        <View style={styles.row}>\r\n          <GameIcon icon=\"attack\" style={styles.icon} />\r\n          <View style={styles.progressBarContainer}>\r\n            <Text style={styles.idleTextContainer}>-</Text>\r\n            <ProgressBar progress={0} style={styles.progressBar} />\r\n          </View>\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View style={styles.row}>\r\n        <GameIcon icon=\"attack\" style={styles.icon} />\r\n        <View style={styles.progressBarContainer}>\r\n          <Text numberOfLines={1} style={styles.markdownContainer}>\r\n            {currentFamiliarAction.name}\r\n          </Text>\r\n          <ProgressBar progress={progress} style={styles.progressBar} />\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [currentFamiliarAction?.name, progress, ready]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    width: 148,\r\n  },\r\n  icon: {\r\n    marginRight: 4,\r\n    height: 24,\r\n    width: 24,\r\n  },\r\n  progressBarContainer: {\r\n    flex: 1,\r\n    marginTop: -5,\r\n  },\r\n  idleTextContainer: {\r\n    height: 21,\r\n  },\r\n  markdownContainer: {\r\n    height: 21,\r\n  },\r\n  progressBar: {\r\n    width: 120,\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport {\r\n  getCurrentCompanionClass,\r\n  getCurrentCompanionData,\r\n} from \"../../backend/familiars/Familiar\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { HPBar } from \"./HPBar\";\r\n\r\nexport function FamiliarHPBar() {\r\n  const state = useContext(StateContext);\r\n  const currentHP = getCurrentCompanionData(state)?.status?.currentHp || 0;\r\n  let maxHP =\r\n    getCurrentCompanionClass(state)?.getStatsForCompanion(state)?.maxHP || 1;\r\n  return (\r\n    <HPBar\r\n      empty={false}\r\n      current={currentHP}\r\n      max={maxHP}\r\n      actionTarget={AttackTarget.Familiar}\r\n    />\r\n  );\r\n}\r\n","import React, { useMemo } from \"react\";\r\nimport { Image, ImageSourcePropType, StyleSheet, View } from \"react-native\";\r\nimport { sanitizeImageSourceForElectron } from \"../utility/icons/IconUtils\";\r\n\r\nexport function FamiliarSpriteTile(props: {\r\n  sprite?: ImageSourcePropType;\r\n  showDead?: boolean;\r\n  showUndead?: boolean;\r\n}) {\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.tile}>\r\n        {props.sprite && props.showUndead && (\r\n          <Image\r\n            resizeMode=\"contain\"\r\n            source={sanitizeImageSourceForElectron(props.sprite)}\r\n            style={[\r\n              styles.image,\r\n              {\r\n                tintColor: \"#444\",\r\n              },\r\n            ]}\r\n          />\r\n        )}\r\n        {props.sprite && (\r\n          <Image\r\n            resizeMode=\"contain\"\r\n            source={sanitizeImageSourceForElectron(props.sprite)}\r\n            style={[\r\n              styles.image,\r\n              {\r\n                opacity: props.showUndead ? 0.15 : props.showDead ? 0.25 : 1.0,\r\n                position: \"absolute\",\r\n              },\r\n            ]}\r\n          />\r\n        )}\r\n      </View>\r\n    ),\r\n    [props.sprite, props.showDead, props.showUndead],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tile: {\r\n    height: 24,\r\n    width: 24,\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  image: {\r\n    height: 22,\r\n    width: 22,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { getPlayerActionProgress } from \"../../backend/exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../backend/exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../backend/exploration/ExplorationUtils\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\nimport { ProgressBar } from \"../utility/ProgressBar\";\r\n\r\nexport function PlayerActionDisplay() {\r\n  const state = useContext(StateContext);\r\n  const inCombat = getExplorationStatus(state) == ExplorationStatus.Combat;\r\n  let progress = 0;\r\n  if (inCombat) {\r\n    progress = getPlayerActionProgress(state);\r\n  }\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <GameIcon icon=\"attack\" style={styles.icon} />\r\n        <ProgressBar progress={progress} style={{ width: 120 }} />\r\n      </View>\r\n    ),\r\n    [progress],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  icon: {\r\n    marginRight: 4,\r\n    height: 24,\r\n    width: 24,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport { AttackTarget } from \"../../backend/exploration/AttackTarget\";\r\nimport { calculatePlayerMaxHP } from \"../../backend/exploration/CombatStats\";\r\nimport { getCurrentPlayerHP } from \"../../backend/exploration/Exploration\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { HPBar } from \"./HPBar\";\r\n\r\nexport function PlayerHPBar() {\r\n  const state = useContext(StateContext);\r\n  const currentHP = getCurrentPlayerHP(state);\r\n  const maxHP = calculatePlayerMaxHP(state);\r\n  return (\r\n    <HPBar\r\n      empty={false}\r\n      current={currentHP}\r\n      max={maxHP}\r\n      actionTarget={AttackTarget.Player}\r\n    />\r\n  );\r\n}\r\n","import moment from \"moment\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { ScrollView, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { getMessageLog } from \"../../backend/exploration/Exploration\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\n\r\nexport function PlayerMessageLog() {\r\n  const state = useContext(StateContext);\r\n  const messageLog = getMessageLog(state);\r\n  return useMemo(\r\n    () => (\r\n      <ScrollView>\r\n        {messageLog.map((logItem) => {\r\n          const key: string = logItem.id;\r\n          return (\r\n            <View key={key}>\r\n              <Markdown\r\n                accessibilityLabel={\r\n                  logItem.accessibleMessage ?? logItem.message\r\n                }\r\n              >\r\n                {logItem.realTimestamp\r\n                  ? t(\"[{{time}}] {{message}}\", {\r\n                      time: moment(logItem.realTimestamp).format(\"h:mm:ss A\"),\r\n                      message: logItem.message,\r\n                    })\r\n                  : logItem.message}\r\n              </Markdown>\r\n            </View>\r\n          );\r\n        })}\r\n      </ScrollView>\r\n    ),\r\n    [messageLog.map((logItem) => logItem.id).join()],\r\n  );\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  Resource,\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  getResourceInfo,\r\n  getSortedResourceKeys,\r\n} from \"../../backend/Resources\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { Text } from \"./Text\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\n\r\nconst EPSILON = 1e-6;\r\n\r\nfunction ResourceItem(props: {\r\n  resource: Resource;\r\n  current: number;\r\n  cap: number;\r\n}) {\r\n  const resourceInfo = getResourceInfo(props.resource);\r\n  const isCapped = props.current >= props.cap - EPSILON;\r\n  const icon = useMemo(\r\n    () => <GameIcon icon={resourceInfo.icon} style={styles.icon} small />,\r\n    [resourceInfo.icon],\r\n  );\r\n  const theme = useTheme();\r\n  const textStyle = useMemo(\r\n    () => isCapped && { color: theme.colors.tertiary },\r\n    [isCapped, theme],\r\n  );\r\n  return (\r\n    <View style={styles.item} accessible={true}>\r\n      {icon}\r\n      <Text style={textStyle} doNotScaleFonts={true}>\r\n        {formatNumber(props.current, { showDecimals: true })}/\r\n        {formatNumber(props.cap)}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst ResourceItemMemo = React.memo(ResourceItem);\r\n\r\nexport function BottomResourceViewer(props: { isVisible?: boolean }) {\r\n  const state = useContext(StateContext);\r\n  const resourceKeys = getSortedResourceKeys(state) as Array<Resource>;\r\n  const filteredResourceKeys = resourceKeys.filter(\r\n    (resource) => resource !== Resource.Mana,\r\n  );\r\n  const rows = useMemo(\r\n    () =>\r\n      filteredResourceKeys.map((resourceName) => {\r\n        return (\r\n          <ResourceItemMemo\r\n            resource={resourceName}\r\n            current={getResourceAmount(state, resourceName)}\r\n            cap={getResourceCap(state, resourceName)}\r\n            key={resourceName}\r\n          />\r\n        );\r\n      }),\r\n    [props.isVisible !== false ? state : false],\r\n  );\r\n  return <View style={styles.container}>{rows}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    justifyContent: \"space-around\",\r\n  },\r\n  item: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n    width: 106,\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport {\r\n  LayoutChangeEvent,\r\n  ScrollView,\r\n  StyleSheet,\r\n  View,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\nimport { TouchableWithoutFeedback } from \"react-native-gesture-handler\";\r\nimport { ActivityIndicator, useTheme } from \"react-native-paper\";\r\nimport { clearFlag, hasFlag } from \"../backend/Flags\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { AttackTarget } from \"../backend/exploration/AttackTarget\";\r\nimport { calculatePlayerMaxHP } from \"../backend/exploration/CombatStats\";\r\nimport {\r\n  endExploration,\r\n  getCurrentDungeonFloor,\r\n  getCurrentEnemyHP,\r\n  getCurrentFamiliarHP,\r\n  getCurrentPlayerHP,\r\n  getSuccessfulExplorationsForFloor,\r\n  pauseExploration,\r\n  resumeExploration,\r\n  startBossExploration,\r\n  startExplorationOnFloor,\r\n} from \"../backend/exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../backend/exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../backend/exploration/ExplorationUtils\";\r\nimport {\r\n  hasCurrentActiveCompanion,\r\n  hasCurrentCompanion,\r\n} from \"../backend/exploration/Summoning\";\r\nimport { Dungeon } from \"../backend/exploration/dungeons/Dungeon\";\r\nimport { DungeonFloor } from \"../backend/exploration/dungeons/DungeonFloor\";\r\nimport {\r\n  getUnlockedDungeons,\r\n  isDungeonFloorCompletedThisRun,\r\n} from \"../backend/exploration/dungeons/Dungeons\";\r\nimport { getCurrentEnemy } from \"../backend/exploration/enemies/Enemies\";\r\nimport {\r\n  FamiliarCompanionStatusType,\r\n  getCurrentCompanionClass,\r\n  getCurrentCompanionData,\r\n} from \"../backend/familiars/Familiar\";\r\nimport { shouldShowGrayscaleFamiliar } from \"../backend/rituals/NecromancyRitual\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { EnemyActionDisplay } from \"./exploration/EnemyActionDisplay\";\r\nimport { EnemyHPBar } from \"./exploration/EnemyHPBar\";\r\nimport { EnemySpriteTile } from \"./exploration/EnemySpriteTile\";\r\nimport { ExplorationBottomComponent } from \"./exploration/ExplorationBottomComponent\";\r\nimport { ExplorationProgressDisplay } from \"./exploration/ExplorationProgressDisplay\";\r\nimport { FamiliarActionDisplay } from \"./exploration/FamiliarActionDisplay\";\r\nimport { FamiliarHPBar } from \"./exploration/FamiliarHPBar\";\r\nimport { FamiliarSpriteTile } from \"./exploration/FamiliarSpriteTile\";\r\nimport { PlayerActionDisplay } from \"./exploration/PlayerActionDisplay\";\r\nimport { PlayerHPBar } from \"./exploration/PlayerHPBar\";\r\nimport { PlayerMessageLog } from \"./exploration/PlayerMessageLog\";\r\nimport { AccessibilityContext } from \"./utility/AccessibilityContext\";\r\nimport { BottomResourceViewer } from \"./utility/BottomResourceViewer\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { GameStateFreezer } from \"./utility/GameStateFreezer\";\r\nimport { KeyboardListener } from \"./utility/KeyboardListener\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { TemporaryEffectsViewer } from \"./utility/TemporaryEffectsViewer\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { UIContext } from \"./utility/UIContext\";\r\nimport { VisibilityContext } from \"./utility/VisibilityContext\";\r\nimport { GameIcon } from \"./utility/icons/GameIcon\";\r\n\r\nfunction ExplorationRow(props: { floor: DungeonFloor }) {\r\n  const floor = props.floor;\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const isBossUnlocked =\r\n    floor.canFightBoss(state) && floor.getBoss(state) != null;\r\n  const isFloorCompleted = isDungeonFloorCompletedThisRun(state, floor);\r\n  const theme = useTheme();\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={styles.noneRow}>\r\n          <View>\r\n            <Text style={styles.noneFloorText}>{floor.getFloorName()}</Text>\r\n            <View style={styles.noneStatusRow}>\r\n              <Text>{t(\"Status: \")}</Text>\r\n              {isBossUnlocked ? (\r\n                <MaterialIcons\r\n                  name=\"check\"\r\n                  size={24}\r\n                  style={styles.noneIcon}\r\n                  color={\r\n                    isFloorCompleted\r\n                      ? theme.dark\r\n                        ? theme.colors.primaryContainer\r\n                        : theme.colors.primary\r\n                      : theme.colors.onBackground\r\n                  }\r\n                />\r\n              ) : (\r\n                <MaterialIcons\r\n                  name=\"lock-open\"\r\n                  size={24}\r\n                  style={styles.noneIcon}\r\n                  color={theme.colors.onBackground}\r\n                />\r\n              )}\r\n              <Text>\r\n                {isFloorCompleted\r\n                  ? t(\"Completed\")\r\n                  : isBossUnlocked\r\n                  ? t(\"Boss Unlocked\")\r\n                  : t(\"Open for Exploration\")}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n          <Button\r\n            onPress={() =>\r\n              stateRef.current.apply((state) => {\r\n                state = startExplorationOnFloor(state, floor);\r\n                if (floor.getNextFloor(state)?.isUnlocked?.(state)) {\r\n                  state.run.autoAdvanceToNextFloor = false;\r\n                }\r\n                return state;\r\n              })\r\n            }\r\n          >\r\n            {t(\"Explore\")}\r\n          </Button>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [isFloorCompleted, isBossUnlocked, theme, floor.getFloorName()],\r\n  );\r\n}\r\n\r\nfunction ExplorationDungeon(props: { dungeon: Dungeon }) {\r\n  const state = useContext(StateContext);\r\n  const unlockedFloors = props.dungeon\r\n    .getDungeonFloors()\r\n    .filter((floor) => floor.isUnlocked(state));\r\n  return useMemo(\r\n    () => (\r\n      <CategoryContainer title={props.dungeon.getName()}>\r\n        <View style={Styles.mt8}>\r\n          {/* {props.dungeon.hasTriggeredEvent(state) && (\r\n          <View style={Styles.mb8}>\r\n            <Text style={styles.noMoreStorylines}>\r\n              {t(\r\n                \"No more Storylines can be found by exploring these areas this run!\",\r\n              )}\r\n            </Text>\r\n          </View>\r\n        )} */}\r\n          {unlockedFloors.map((floor) => {\r\n            return <ExplorationRow key={floor.getId()} floor={floor} />;\r\n          })}\r\n        </View>\r\n      </CategoryContainer>\r\n    ),\r\n    [JSON.stringify(unlockedFloors.map((floor) => floor.getId()))],\r\n  );\r\n}\r\n\r\nfunction ExplorationNone() {\r\n  const state = useContext(StateContext);\r\n  const allDungeons = getUnlockedDungeons(state);\r\n  return useMemo(\r\n    () => (\r\n      <ScrollView\r\n        style={styles.container}\r\n        contentContainerStyle={styles.noneContent}\r\n      >\r\n        <View style={styles.topRow}>\r\n          <Text h2>{t(\"Exploration\")}</Text>\r\n        </View>\r\n        <Text>{t(\"Select a destination.\")}</Text>\r\n        {allDungeons.map((dungeon) => {\r\n          return <ExplorationDungeon key={dungeon.getId()} dungeon={dungeon} />;\r\n        })}\r\n      </ScrollView>\r\n    ),\r\n    [JSON.stringify(allDungeons.map((dungeon) => dungeon.getId()))],\r\n  );\r\n}\r\n\r\nfunction ExplorationMain() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const explorationStatus = getExplorationStatus(state);\r\n\r\n  const dungeonFloor = getCurrentDungeonFloor(state);\r\n  const dungeonTitle = dungeonFloor.getFloorName();\r\n  const currentEnemySprite =\r\n    explorationStatus == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(state).getPicture(state);\r\n  const toUnlockBoss =\r\n    dungeonFloor.getExplorationSuccessesForBoss(state) -\r\n    getSuccessfulExplorationsForFloor(state, dungeonFloor.getId());\r\n  const currentEnemyName =\r\n    explorationStatus == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(state).getName();\r\n\r\n  const checkmark =\r\n    getSuccessfulExplorationsForFloor(state, dungeonFloor.getId()) >=\r\n      dungeonFloor.getExplorationSuccessesForBoss(state) ||\r\n    isDungeonFloorCompletedThisRun(state, dungeonFloor);\r\n  const hasBoss = dungeonFloor.getBoss(state) != null;\r\n  const canFightBoss = dungeonFloor.canFightBoss(state);\r\n  const canMoveToNextFloor = dungeonFloor\r\n    .getNextFloor(state)\r\n    ?.isUnlocked(state);\r\n\r\n  const fightingBoss =\r\n    explorationStatus == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(state).isBoss();\r\n\r\n  const isExplorationPaused = hasFlag(state, \"exploration_paused\");\r\n  const togglePauseExploration = useCallback(() => {\r\n    stateRef.current.apply((state) =>\r\n      hasFlag(state, \"exploration_paused\")\r\n        ? resumeExploration(state)\r\n        : pauseExploration(state),\r\n    );\r\n  }, []);\r\n  const pauseExplorationButton = useMemo(\r\n    () => (\r\n      <Button\r\n        style={styles.pauseExplorationButton}\r\n        compact={true}\r\n        onPress={togglePauseExploration}\r\n      >\r\n        {isExplorationPaused ? t(\"Resume Exploration\") : t(\"Pause Exploration\")}\r\n      </Button>\r\n    ),\r\n    [isExplorationPaused, togglePauseExploration],\r\n  );\r\n\r\n  const explorationStatusContainer = useMemo(() => {\r\n    let explorationStatusContainer = null;\r\n    if (explorationStatus == ExplorationStatus.Combat) {\r\n      explorationStatusContainer = (\r\n        <ScrollView\r\n          centerContent={false}\r\n          style={styles.explorationStatusContainer}\r\n          persistentScrollbar={true}\r\n        >\r\n          <Text h3>{currentEnemyName}</Text>\r\n          <View style={Styles.mt4}>\r\n            <EnemyHPBar />\r\n          </View>\r\n          <View style={Styles.mt4}>\r\n            <EnemyActionDisplay />\r\n          </View>\r\n          <View style={Styles.mt4}>\r\n            <TemporaryEffectsViewer\r\n              target={AttackTarget.Enemy}\r\n              skipPermacast={true}\r\n              accessibilityHeader={t(\"Enemy Buffs\")}\r\n            />\r\n          </View>\r\n        </ScrollView>\r\n      );\r\n    } else if (explorationStatus == ExplorationStatus.Exploring) {\r\n      explorationStatusContainer = (\r\n        <View style={styles.explorationStatusContainer}>\r\n          <View style={Styles.mb8}>\r\n            <Text h3>{t(\"Exploring...\")}</Text>\r\n          </View>\r\n          <ExplorationProgressDisplay />\r\n          {pauseExplorationButton}\r\n        </View>\r\n      );\r\n    } else if (explorationStatus == ExplorationStatus.ExploringBoss) {\r\n      explorationStatusContainer = (\r\n        <View style={styles.explorationStatusContainer}>\r\n          <Text h3>{t(\"Preparing for Boss...\")}</Text>\r\n          <ExplorationProgressDisplay />\r\n          {pauseExplorationButton}\r\n        </View>\r\n      );\r\n    } else if (explorationStatus == ExplorationStatus.Reviving) {\r\n      explorationStatusContainer = (\r\n        <View style={styles.explorationStatusContainer}>\r\n          <Text h3>{t(\"Recovering...\")}</Text>\r\n          <ActivityIndicator />\r\n        </View>\r\n      );\r\n    }\r\n    return explorationStatusContainer;\r\n  }, [explorationStatus, currentEnemyName, pauseExplorationButton]);\r\n\r\n  const hasCompanion = hasCurrentCompanion(state);\r\n  const currentCompanionSprite =\r\n    hasCompanion && getCurrentCompanionClass(state).getPicture(state);\r\n  const isCompanionReady =\r\n    hasCompanion &&\r\n    [\r\n      FamiliarCompanionStatusType.Combat,\r\n      FamiliarCompanionStatusType.Exploring,\r\n    ].includes(getCurrentCompanionData(state)?.status?.companionStatus);\r\n  const flipCompanionRow = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      state.run.exploration.familiarIsInBackRow =\r\n        !state.run.exploration.familiarIsInBackRow;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const isFloorCompleted = isDungeonFloorCompletedThisRun(state, dungeonFloor);\r\n  const theme = useTheme();\r\n\r\n  const backdropColor =\r\n    explorationStatus == ExplorationStatus.Combat &&\r\n    getCurrentEnemy(state).getBackdropColor(state);\r\n\r\n  const accessibilityContext = useContext(AccessibilityContext);\r\n\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    stateRef.current.apply(clearFlag(\"combat_paused_magic_tap\"));\r\n    return () => stateRef.current.apply(clearFlag(\"combat_paused_magic_tap\"));\r\n  }, [visible]);\r\n\r\n  const uiContext = useContext(UIContext);\r\n  const currentEventOccurrenceId = uiContext.getUIState(\r\n    \"current_event_occurrence_id\",\r\n  );\r\n  const currentExplorationBottomTab =\r\n    uiContext.getUIState(\"exploration_bottom_component_tab\") ?? \"\";\r\n\r\n  useEffect(() => {\r\n    if (visible && currentEventOccurrenceId == null) {\r\n      if (explorationStatus === ExplorationStatus.Exploring) {\r\n        accessibilityContext.announceForAccessibility(t(\"Exploring\"));\r\n      }\r\n\r\n      if (explorationStatus === ExplorationStatus.ExploringBoss) {\r\n        accessibilityContext.announceForAccessibility(t(\"Preparing for boss\"));\r\n      }\r\n\r\n      if (explorationStatus === ExplorationStatus.Combat) {\r\n        accessibilityContext.announceForAccessibility(\r\n          t(\"Fighting {{enemy}}\", { enemy: currentEnemyName }),\r\n        );\r\n      }\r\n\r\n      if (explorationStatus === ExplorationStatus.Reviving) {\r\n        accessibilityContext.announceForAccessibility(\r\n          t(\"You were defeated. Recovering from injuries...\"),\r\n        );\r\n      }\r\n    }\r\n  }, [\r\n    explorationStatus,\r\n    accessibilityContext,\r\n    visible,\r\n    currentEventOccurrenceId,\r\n  ]);\r\n\r\n  const [lastAnnounced, setLastAnnounced] = useState(\"\");\r\n\r\n  const onKeyboard = useCallback(\r\n    (ev: KeyboardEvent) => {\r\n      if (!visible) {\r\n        return;\r\n      }\r\n\r\n      const state = stateRef.current;\r\n\r\n      if (ev.shiftKey && ev.ctrlKey && ev.key == \"Z\") {\r\n        const inCombat =\r\n          getExplorationStatus(state) == ExplorationStatus.Combat;\r\n        const hasFamiliar = hasCurrentActiveCompanion(state);\r\n        if (lastAnnounced === \"player\" && hasFamiliar) {\r\n          const currentHP = getCurrentFamiliarHP(state);\r\n          const maxHP =\r\n            getCurrentCompanionClass(state)?.getStatsForCompanion(state)\r\n              .maxHP ?? 0;\r\n          accessibilityContext.announceForAccessibility(\r\n            t(\"Familiar HP: {{current}}/{{max}}\", {\r\n              current: formatNumber(Math.ceil(currentHP), {\r\n                showDecimals: false,\r\n              }),\r\n              max: formatNumber(Math.ceil(maxHP), {\r\n                showDecimals: false,\r\n              }),\r\n            }),\r\n          );\r\n          setLastAnnounced(\"familiar\");\r\n        } else if (\r\n          (lastAnnounced === \"player\" ||\r\n            (hasFamiliar && lastAnnounced === \"familiar\")) &&\r\n          inCombat\r\n        ) {\r\n          const currentHP = getCurrentEnemyHP(state);\r\n          const maxHP = getCurrentEnemy(state).getMaxHP(state);\r\n          accessibilityContext.announceForAccessibility(\r\n            t(\"Enemy HP: {{current}}/{{max}}\", {\r\n              current: formatNumber(Math.ceil(currentHP), {\r\n                showDecimals: false,\r\n              }),\r\n              max: formatNumber(Math.ceil(maxHP), {\r\n                showDecimals: false,\r\n              }),\r\n            }),\r\n          );\r\n          setLastAnnounced(\"enemy\");\r\n        } else {\r\n          accessibilityContext.announceForAccessibility(\r\n            t(\"Player HP: {{current}}/{{max}}\", {\r\n              current: formatNumber(Math.ceil(getCurrentPlayerHP(state)), {\r\n                showDecimals: false,\r\n              }),\r\n              max: formatNumber(Math.ceil(calculatePlayerMaxHP(state)), {\r\n                showDecimals: false,\r\n              }),\r\n            }),\r\n          );\r\n          setLastAnnounced(\"player\");\r\n        }\r\n      }\r\n    },\r\n    [visible, lastAnnounced],\r\n  );\r\n\r\n  const isCompanionUndead = shouldShowGrayscaleFamiliar(state);\r\n\r\n  const buttonRow = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Button\r\n          style={styles.exitButtonContainer}\r\n          compact={true}\r\n          onPress={() => stateRef.current.apply(endExploration)}\r\n        >\r\n          {t(\"Exit\")}\r\n        </Button>\r\n        <Button\r\n          style={styles.exitButtonContainer}\r\n          compact={true}\r\n          onPress={() =>\r\n            stateRef.current.apply((state) =>\r\n              startExplorationOnFloor(\r\n                state,\r\n                getCurrentDungeonFloor(state).getNextFloor(\r\n                  state,\r\n                ) as DungeonFloor,\r\n              ),\r\n            )\r\n          }\r\n          disabled={!canMoveToNextFloor}\r\n        >\r\n          {t(\"Next Floor\")}\r\n        </Button>\r\n        <Button\r\n          compact={true}\r\n          onPress={() => stateRef.current.apply(startBossExploration)}\r\n          disabled={!canFightBoss || fightingBoss}\r\n        >\r\n          {t(\"Fight Boss\")}\r\n        </Button>\r\n      </View>\r\n    ),\r\n    [canFightBoss, fightingBoss, canMoveToNextFloor],\r\n  );\r\n\r\n  const topContainer = useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={[styles.row, styles.enemyContainer]}>\r\n          {explorationStatusContainer}\r\n          <View style={Styles.ml8}>\r\n            <EnemySpriteTile\r\n              sprite={currentEnemySprite}\r\n              backdropColor={backdropColor}\r\n            />\r\n          </View>\r\n        </View>\r\n        <Divider />\r\n        {hasCompanion && !state.run.exploration.familiarIsInBackRow && (\r\n          <View\r\n            key=\"companion\"\r\n            style={[styles.row, styles.summonContainer, { marginTop: 8 }]}\r\n          >\r\n            <FamiliarSpriteTile\r\n              sprite={currentCompanionSprite}\r\n              showDead={!isCompanionReady}\r\n              showUndead={isCompanionUndead}\r\n            />\r\n            <View style={{ flex: 1, marginLeft: 4, marginRight: 4 }}>\r\n              <FamiliarHPBar />\r\n            </View>\r\n            <FamiliarActionDisplay />\r\n          </View>\r\n        )}\r\n        <View\r\n          style={[\r\n            styles.row,\r\n            styles.playerContainer,\r\n            (!hasCompanion || state.run.exploration.familiarIsInBackRow) && {\r\n              marginTop: 8,\r\n            },\r\n          ]}\r\n        >\r\n          <View style={{ flex: 1, marginRight: 4 }}>\r\n            <PlayerHPBar />\r\n          </View>\r\n          <PlayerActionDisplay />\r\n        </View>\r\n        {hasCompanion && state.run.exploration.familiarIsInBackRow && (\r\n          <View key=\"companion\" style={[styles.row, styles.summonContainer]}>\r\n            <FamiliarSpriteTile\r\n              sprite={currentCompanionSprite}\r\n              showDead={!isCompanionReady}\r\n              showUndead={isCompanionUndead}\r\n            />\r\n            <View style={{ flex: 1, marginLeft: 4, marginRight: 4 }}>\r\n              <FamiliarHPBar />\r\n            </View>\r\n            <FamiliarActionDisplay />\r\n          </View>\r\n        )}\r\n        {hasCompanion && (\r\n          <View style={styles.switchFamiliarRowContainer}>\r\n            <View style={styles.switchFamiliarRow}>\r\n              <TouchableWithoutFeedback\r\n                onPress={flipCompanionRow}\r\n                accessibilityLabel={\r\n                  state.run.exploration.familiarIsInBackRow\r\n                    ? t(\"Send Familiar to Front Row\")\r\n                    : t(\"Send Familiar to Back Row\")\r\n                }\r\n                hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n              >\r\n                <GameIcon icon=\"exchange\" small />\r\n              </TouchableWithoutFeedback>\r\n            </View>\r\n          </View>\r\n        )}\r\n        <View style={[styles.row, styles.runAway]}>\r\n          <View style={[styles.row, styles.unlockBossContainer]}>\r\n            {checkmark && (\r\n              <MaterialIcons\r\n                name=\"check\"\r\n                size={24}\r\n                style={styles.checkmark}\r\n                color={\r\n                  isFloorCompleted\r\n                    ? theme.dark\r\n                      ? theme.colors.primaryContainer\r\n                      : theme.colors.primary\r\n                    : theme.colors.onBackground\r\n                }\r\n              />\r\n            )}\r\n            <View style={styles.unlockBossTextContainer}>\r\n              <Text doNotScaleFonts={true} numberOfLines={2}>\r\n                {isFloorCompleted\r\n                  ? t(\"Floor complete!\")\r\n                  : canFightBoss\r\n                  ? t(\"Boss unlocked\")\r\n                  : hasBoss\r\n                  ? t(\"To unlock boss: {{amount}}\", {\r\n                      amount: formatNumber(toUnlockBoss),\r\n                    })\r\n                  : \"\"}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n          {buttonRow}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      currentEnemySprite,\r\n      explorationStatusContainer,\r\n      toUnlockBoss,\r\n      checkmark,\r\n      canFightBoss,\r\n      hasBoss,\r\n      stateRef,\r\n      startBossExploration,\r\n      endExploration,\r\n      hasCompanion,\r\n      currentCompanionSprite,\r\n      isFloorCompleted,\r\n      backdropColor,\r\n      isCompanionReady,\r\n      isCompanionUndead,\r\n      state.run.exploration.familiarIsInBackRow,\r\n      flipCompanionRow,\r\n      buttonRow,\r\n      theme,\r\n    ],\r\n  );\r\n\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  const [containerHeight, setContainerHeight] = useState(null);\r\n\r\n  const onLayout = useCallback((event: LayoutChangeEvent) => {\r\n    setContainerHeight(event.nativeEvent.layout.height);\r\n  }, []);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.wholeContainer} onLayout={onLayout}>\r\n        <View style={styles.container}>\r\n          <View style={[styles.topRow]}>\r\n            <Text h2>\r\n              {t(\"Exploration - {{dungeonTitle}}\", { dungeonTitle })}\r\n            </Text>\r\n          </View>\r\n          <View style={styles.restOfScreen}>\r\n            {topContainer}\r\n            <View style={styles.playerMessageLogContainer}>\r\n              {currentExplorationBottomTab == \"\" && (\r\n                <View\r\n                  style={styles.accessibilityHidden}\r\n                  accessible={true}\r\n                  accessibilityLabel={t(\"Exploration Log Tab\")}\r\n                  accessibilityRole=\"header\"\r\n                  accessibilityElementsHidden={false}\r\n                />\r\n              )}\r\n              <PlayerMessageLog />\r\n            </View>\r\n            {width < 640 &&\r\n              height > 640 &&\r\n              !state.options.hideBottomResourceViewer && (\r\n                <GameStateFreezer isVisible={currentExplorationBottomTab == \"\"}>\r\n                  <BottomResourceViewer />\r\n                </GameStateFreezer>\r\n              )}\r\n          </View>\r\n        </View>\r\n        <View style={styles.bottomComponentContainer}>\r\n          <ExplorationBottomComponent containerHeight={containerHeight} />\r\n        </View>\r\n        <KeyboardListener callback={onKeyboard} />\r\n      </View>\r\n    ),\r\n    [\r\n      stateRef,\r\n      currentExplorationBottomTab,\r\n      endExploration,\r\n      dungeonTitle,\r\n      topContainer,\r\n      theme,\r\n      onKeyboard,\r\n      width,\r\n      height,\r\n      state.options.hideBottomResourceViewer,\r\n      onLayout,\r\n      containerHeight,\r\n    ],\r\n  );\r\n}\r\n\r\nexport default function Exploration() {\r\n  const state = useContext(StateContext);\r\n\r\n  const explorationStatus = getExplorationStatus(state);\r\n\r\n  if (explorationStatus == ExplorationStatus.None) {\r\n    return <ExplorationNone />;\r\n  }\r\n\r\n  // We are exploring, reviving, or in combat\r\n  return <ExplorationMain />;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  wholeContainer: { flex: 1 },\r\n  container: {\r\n    flex: 1,\r\n    padding: 8,\r\n  },\r\n  topRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n    marginBottom: 8,\r\n    height: 32,\r\n  },\r\n  arrowBack: {\r\n    marginRight: 8,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  checkmark: {\r\n    marginRight: 4,\r\n  },\r\n  enemyContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  playerContainer: {\r\n    marginTop: 16,\r\n  },\r\n  summonContainer: {\r\n    marginTop: 16,\r\n  },\r\n  playerMessageLogContainer: {\r\n    flex: 1,\r\n    padding: 8,\r\n    borderColor: \"#444\",\r\n    borderWidth: StyleSheet.hairlineWidth,\r\n    marginTop: 8,\r\n  },\r\n  moveRow: {\r\n    marginTop: 8,\r\n  },\r\n  exitButtonContainer: { marginRight: 4 },\r\n  explorationStatusContainer: {\r\n    flex: 1,\r\n    maxHeight: 144,\r\n  },\r\n  restOfScreen: {\r\n    flex: 1,\r\n    justifyContent: \"space-between\",\r\n    marginBottom: 48,\r\n  },\r\n  bottomComponentContainer: {\r\n    position: \"absolute\",\r\n    left: 0,\r\n    bottom: 0,\r\n    width: \"100%\",\r\n  },\r\n  dungeonButton: {\r\n    marginTop: 8,\r\n  },\r\n  gradient: {\r\n    left: 0,\r\n    top: 0,\r\n    width: \"100%\",\r\n    height: \"60%\",\r\n    position: \"absolute\",\r\n    opacity: 0.3,\r\n  },\r\n  noneContent: {\r\n    paddingBottom: 32,\r\n  },\r\n  noneDungeonContentsContainer: {\r\n    marginTop: 8,\r\n  },\r\n  noneRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    paddingVertical: 4,\r\n  },\r\n  noneStatusRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"center\",\r\n  },\r\n  noneFloorText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n  noneIcon: {\r\n    marginHorizontal: 4,\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  runAway: {\r\n    marginTop: 8,\r\n  },\r\n  unlockBossContainer: { flex: 1, justifyContent: \"flex-start\" },\r\n  unlockBossTextContainer: { flex: 1 },\r\n  accessibilityHidden: {\r\n    width: 1,\r\n    height: 1,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n  pauseExplorationButton: {\r\n    marginTop: 16,\r\n    alignSelf: \"flex-start\",\r\n  },\r\n  noMoreStorylines: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  switchFamiliarRow: {\r\n    position: \"absolute\",\r\n    top: -40,\r\n    cursor: \"pointer\",\r\n  },\r\n  switchFamiliarRowContainer: {\r\n    alignSelf: \"center\",\r\n  },\r\n});\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Item, ItemParams } from \"../Item\";\r\nimport { ItemTagEnum } from \"../ItemTagEnum\";\r\n\r\nclass SlimeDrop extends Item {\r\n  getId(): string {\r\n    return \"slimeDrop\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./slimeDrop.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Slime Drop\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A piece of a felled Slime.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 24;\r\n  }\r\n}\r\n\r\nexport default new SlimeDrop();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Item, ItemParams } from \"../Item\";\r\nimport { ItemTagEnum } from \"../ItemTagEnum\";\r\n\r\nclass Wildgrass extends Item {\r\n  getId(): string {\r\n    return \"wildgrass\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./wildgrass.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Wildgrass\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A basic herb used in alchemical compounds.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 12;\r\n  }\r\n}\r\n\r\nexport default new Wildgrass();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport SlimeDrop from \"../../../items/material/SlimeDrop\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass Slime extends Enemy {\r\n  getId(): string {\r\n    return \"slime\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Slime\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 50,\r\n      attack: 15,\r\n      defense: 5,\r\n      attackDelay: 3.2,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./slime.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 1;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 12;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 3;\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 1,\r\n        chance: 0.1,\r\n      },\r\n      {\r\n        itemId: SlimeDrop.getId(),\r\n        amount: 1,\r\n        chance: 0.5,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new Slime();\r\n","import { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat, getCachedCombatStat } from \"../exploration/CombatStats\";\r\nimport {\r\n  BattlerAction,\r\n  BattlerStats,\r\n  getCombatStatFromBattlerStat,\r\n} from \"../exploration/enemies/Enemy\";\r\nimport { standardFamiliarAttackEffect } from \"../exploration/Exploration\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  getLevelByExpAndExponent,\r\n  getTotalExpRequiredForLevelByExponent,\r\n} from \"../spells/Elements\";\r\nimport {\r\n  applyTransformations,\r\n  applyTransformationsCached,\r\n  applyTransformationsPermaCached,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport {\r\n  FamiliarCompanionStatusType,\r\n  FamiliarData,\r\n  FamiliarStatusType,\r\n  getCurrentCompanionId,\r\n  getFamiliarData,\r\n} from \"./Familiar\";\r\n\r\nconst FAMILIAR_EXP_REQUIREMENT_MULTIPLIER = 0.015;\r\n\r\nexport const FAMILIAR_LEVEL_CAP_BASE = 90;\r\n\r\nconst cachedStats = {\r\n  maxHP: [AttackTarget.Familiar, CombatStat.MaxHP, \"maxHP\"],\r\n  attack: [AttackTarget.Familiar, CombatStat.Attack, \"attack\"],\r\n  attackDelay: [AttackTarget.Familiar, CombatStat.AttackDelay, \"attackDelay\"],\r\n  defense: [AttackTarget.Familiar, CombatStat.Defense, \"defense\"],\r\n  accuracy: [AttackTarget.Familiar, CombatStat.Accuracy, \"accuracy\"],\r\n  dodge: [AttackTarget.Familiar, CombatStat.Dodge, \"dodge\"],\r\n  crit: [AttackTarget.Familiar, CombatStat.Crit, \"crit\"],\r\n};\r\n\r\nconst FAMILIAR_MAX_LEVEL_TAGS = [TransformationTags.MaxFamiliarLevel];\r\n\r\nexport abstract class FamiliarClass {\r\n  abstract getId(): string;\r\n  abstract getPicture(state: GameState): any;\r\n  abstract getName(): string;\r\n  abstract getBaseStats(): BattlerStats;\r\n  abstract getPerLevelStatMultiplier(): BattlerStats;\r\n\r\n  getNextAction(state: GameState, familiarId: string): BattlerAction {\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getStats(state, familiarId).attackDelay,\r\n      transform: (state) =>\r\n        standardFamiliarAttackEffect(\r\n          state,\r\n          this.getStats(state, familiarId).attack,\r\n        ),\r\n    };\r\n  }\r\n\r\n  getNextActionForCompanion(state: GameState): BattlerAction {\r\n    return this.getNextAction(state, getCurrentCompanionId(state));\r\n  }\r\n\r\n  getStats(\r\n    state: GameState,\r\n    familiarId: string,\r\n    onlyStat?: CombatStat,\r\n  ): BattlerStats {\r\n    const level = this.getLevel(state, familiarId);\r\n    const baseStats = this.getBaseStats();\r\n    const multipliers = this.getPerLevelStatMultiplier();\r\n\r\n    const stats = {};\r\n\r\n    for (let stat in baseStats) {\r\n      if (onlyStat == null || onlyStat == getCombatStatFromBattlerStat(stat)) {\r\n        stats[stat] = getCachedCombatStat(\r\n          state,\r\n          AttackTarget.Familiar,\r\n          getCombatStatFromBattlerStat(stat),\r\n          (state) => {\r\n            const statFromLevel =\r\n              baseStats[stat] * Math.pow(multipliers[stat], level - 1);\r\n            return applyTransformations(\r\n              cachedStats[stat],\r\n              state,\r\n              statFromLevel,\r\n            );\r\n          },\r\n          familiarId,\r\n          level,\r\n        );\r\n      }\r\n    }\r\n\r\n    return stats as BattlerStats;\r\n  }\r\n\r\n  getMaxHP(state: GameState, familiarId: string): number {\r\n    const level = this.getLevel(state, familiarId);\r\n    const baseStats = this.getBaseStats();\r\n    const multipliers = this.getPerLevelStatMultiplier();\r\n\r\n    return getCachedCombatStat(\r\n      state,\r\n      AttackTarget.Familiar,\r\n      CombatStat.MaxHP,\r\n      (state) => {\r\n        const statFromLevel =\r\n          baseStats.maxHP * Math.pow(multipliers.maxHP, level - 1);\r\n        return applyTransformationsCached(\r\n          cachedStats.maxHP,\r\n          state,\r\n          statFromLevel,\r\n        );\r\n      },\r\n      familiarId,\r\n      level,\r\n    );\r\n  }\r\n\r\n  getStatsForCompanion(state: GameState, onlyStat?: CombatStat): BattlerStats {\r\n    return this.getStats(state, getCurrentCompanionId(state), onlyStat);\r\n  }\r\n\r\n  getLevel(state: GameState, familiarId: string): number {\r\n    const levelEstimate = state.temp.familiarLevelCache.get(familiarId);\r\n    const level = getLevelByExpAndExponent(\r\n      getFamiliarData(state, familiarId).exp /\r\n        FAMILIAR_EXP_REQUIREMENT_MULTIPLIER,\r\n      1.38,\r\n      this.getMaxLevel(state, familiarId),\r\n      levelEstimate,\r\n    );\r\n    if (level != levelEstimate) {\r\n      state.temp.familiarLevelCache.set(familiarId, level);\r\n    }\r\n    return level;\r\n  }\r\n\r\n  getMaxLevel(state: GameState, familiarId: string): number {\r\n    return applyTransformationsPermaCached(\r\n      FAMILIAR_MAX_LEVEL_TAGS,\r\n      state,\r\n      FAMILIAR_LEVEL_CAP_BASE,\r\n    );\r\n  }\r\n\r\n  getExpForNextLevel(state: GameState, familiarId: string): number {\r\n    return (\r\n      getTotalExpRequiredForLevelByExponent(\r\n        this.getLevel(state, familiarId) + 1,\r\n        1.38,\r\n        this.getMaxLevel(state, familiarId),\r\n      ) * FAMILIAR_EXP_REQUIREMENT_MULTIPLIER\r\n    );\r\n  }\r\n\r\n  create(state: GameState): GameState {\r\n    const newId = Math.random().toString();\r\n    const data: FamiliarData = {\r\n      id: newId,\r\n      familiarClassId: this.getId(),\r\n      exp:\r\n        getTotalExpRequiredForLevelByExponent(5, 1.38, 10) *\r\n        FAMILIAR_EXP_REQUIREMENT_MULTIPLIER,\r\n      status: {\r\n        status: FamiliarStatusType.Idle,\r\n        exploringDungeonFloorId: undefined,\r\n        exploringNextRandomRoll: Math.random(),\r\n        autoExploring: false,\r\n        triggerFamiliarDeath: false,\r\n        currentHp: this.getBaseStats().maxHP,\r\n        companionStatus: FamiliarCompanionStatusType.Exploring,\r\n        actionProgress: 0,\r\n      },\r\n      messageLog: [],\r\n    };\r\n    state.run.familiars[newId] = data;\r\n    data.status.currentHp = this.getStats(state, newId).maxHP;\r\n    return state;\r\n  }\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { BattlerStats } from \"../exploration/enemies/Enemy\";\r\nimport Slime from \"../exploration/enemies/training/Slime\";\r\nimport { GameState } from \"../GameState\";\r\nimport { FamiliarClass } from \"./FamiliarClass\";\r\n\r\nclass SlimeFamiliar extends FamiliarClass {\r\n  getId(): string {\r\n    return \"slimeFamiliar\";\r\n  }\r\n  getPicture(state: GameState) {\r\n    return Slime.getPicture(state);\r\n  }\r\n  getName(): string {\r\n    return t(\"Slime\");\r\n  }\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 50,\r\n      attack: 15,\r\n      defense: 5,\r\n      attackDelay: 3.2,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n  getPerLevelStatMultiplier(): BattlerStats {\r\n    return {\r\n      maxHP: 1.06,\r\n      attack: 1.06,\r\n      defense: 1.06,\r\n      attackDelay: 1,\r\n      accuracy: 1,\r\n      dodge: 1,\r\n      crit: 1,\r\n    };\r\n  }\r\n}\r\n\r\nexport const slimeFamiliar = new SlimeFamiliar();\r\n","import { keysOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../action/ActionAreas\";\r\nimport { areFamiliarsUnlocked } from \"../familiars/Familiar\";\r\nimport { slimeFamiliar } from \"../familiars/SlimeFamiliar\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport { Building, BuildingSpell } from \"./Building\";\r\nimport { BuildingAmountListeners, getBuildingAmount } from \"./Buildings\";\r\n\r\nclass FamiliarCrate extends Building {\r\n  getId(): string {\r\n    return \"familiarCrate\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Familiar Crate\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Dedicate a parcel of land to a Familiar - a forever friend and companion to a skilled Wizard.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"+1 Familiars. Note: Cannot be demolished - release the Familiar instead from the Familiars screen\",\r\n    );\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 25;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const familiarCrate = new FamiliarCrate();\r\n\r\nclass BuildFamiliarCrate extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.OTHER] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return familiarCrate;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 10000,\r\n      LifeEssence: 10000,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 10.0,\r\n      LifeEssence: 10.0,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return areFamiliarsUnlocked(state) && super.isVisible(state);\r\n  }\r\n\r\n  shouldHideDemolish(): boolean {\r\n    return true;\r\n  }\r\n\r\n  canDemolish(state: GameState, amount: number): boolean {\r\n    return false;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Life;\r\n  }\r\n}\r\n\r\nexport const buildFamiliarCrate = new BuildFamiliarCrate();\r\n\r\nfunction familiarEqualizer(state: GameState) {\r\n  const buildingAmt = getBuildingAmount(state, familiarCrate);\r\n  const familiarAmt = keysOf(state.run.familiars).length;\r\n  if (familiarAmt < buildingAmt) {\r\n    const buildingAmt = getBuildingAmount(state, familiarCrate);\r\n    let familiarAmt = keysOf(state.run.familiars).length;\r\n    while (familiarAmt < buildingAmt) {\r\n      state = slimeFamiliar.create(state);\r\n      familiarAmt++;\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\nBuildingAmountListeners.register(familiarEqualizer, \"familiarCrates\");\r\n","import moment from \"moment\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { ScrollView, View } from \"react-native\";\r\nimport { getFamiliarMessageLog } from \"../../backend/familiars/Familiar\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\n\r\nexport function FamiliarMessageLog(props: { familiarId: string }) {\r\n  const state = useContext(StateContext);\r\n  const messageLog = getFamiliarMessageLog(state, props.familiarId);\r\n  return useMemo(\r\n    () => (\r\n      <ScrollView>\r\n        {messageLog.length === 0 ? (\r\n          <View key=\"noActivity\">\r\n            <Markdown>{t(\"*No activity yet!*\")}</Markdown>\r\n          </View>\r\n        ) : (\r\n          messageLog.map((logItem) => {\r\n            const key: string = logItem.id;\r\n            return (\r\n              <View key={key}>\r\n                <Markdown\r\n                  accessibilityLabel={\r\n                    logItem.accessibleMessage ?? logItem.message\r\n                  }\r\n                >\r\n                  {logItem.realTimestamp\r\n                    ? t(\"[{{time}}] {{message}}\", {\r\n                        time: moment(logItem.realTimestamp).format(\"h:mm:ss A\"),\r\n                        message: logItem.message,\r\n                      })\r\n                    : logItem.message}\r\n                </Markdown>\r\n              </View>\r\n            );\r\n          })\r\n        )}\r\n      </ScrollView>\r\n    ),\r\n    [messageLog.map((logItem) => logItem.id).join()],\r\n  );\r\n}\r\n","import { useContext } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { ScrollView } from \"react-native-gesture-handler\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { DungeonFloor } from \"../../backend/exploration/dungeons/DungeonFloor\";\r\nimport {\r\n  Dungeons,\r\n  getUnlockedDungeons,\r\n} from \"../../backend/exploration/dungeons/Dungeons\";\r\nimport { getFloorsAvailableForFamiliars } from \"../../backend/familiars/Familiar\";\r\nimport { keysOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"./Button\";\r\nimport CategoryContainer from \"./CategoryContainer\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function DungeonFloorSelect(props: {\r\n  familiarId: string | undefined;\r\n  onSelect: (dungeonFloorId: string) => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n\r\n  const dungeons = getUnlockedDungeons(state);\r\n  const dungeonFloors = getFloorsAvailableForFamiliars(state);\r\n  const floorsByDungeon: Record<string, DungeonFloor[]> = {};\r\n  for (let dungeon of dungeons) {\r\n    const floors = dungeon.getDungeonFloors();\r\n    const filteredFloors = floors.filter((floor) =>\r\n      dungeonFloors.includes(floor),\r\n    );\r\n    if (filteredFloors.length > 0) {\r\n      floorsByDungeon[dungeon.getId()] = filteredFloors;\r\n    }\r\n  }\r\n  const theme = useTheme();\r\n\r\n  const floorsView = (\r\n    <View>\r\n      {keysOf(floorsByDungeon).map((dungeonId) => {\r\n        const dungeon = Dungeons.getById(dungeonId);\r\n        return (\r\n          <CategoryContainer title={dungeon.getName()} key={dungeon.getId()}>\r\n            <View style={Styles.mt8}>\r\n              {floorsByDungeon[dungeonId].map((floor) => {\r\n                return (\r\n                  <View\r\n                    style={[Styles.flexRowSpaceBetween, Styles.mv4]}\r\n                    key={floor.getId()}\r\n                  >\r\n                    <View>\r\n                      <Text>{floor.getFloorName()}</Text>\r\n                      {props.familiarId != null &&\r\n                        floor.isDangerousForFamiliar(\r\n                          state,\r\n                          props.familiarId,\r\n                        ) && (\r\n                          <Text style={{ color: theme.colors.error }}>\r\n                            {t(\"Caution - dangerous!\")}\r\n                          </Text>\r\n                        )}\r\n                    </View>\r\n                    <Button\r\n                      style={Styles.ml16}\r\n                      onPress={() => props.onSelect(floor.getId())}\r\n                    >\r\n                      {t(\"Explore\")}\r\n                    </Button>\r\n                  </View>\r\n                );\r\n              })}\r\n            </View>\r\n          </CategoryContainer>\r\n        );\r\n      })}\r\n    </View>\r\n  );\r\n\r\n  return (\r\n    <View style={[Styles.flex, styles.bigContainer]}>\r\n      <ScrollView style={[{ flexGrow: 0 }, Styles.mt8]}>\r\n        {floorsView}\r\n      </ScrollView>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  spellButtonTitleContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  spellButtonTitleOnlyContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  spellButtonCostContainer: {\r\n    flexDirection: \"row\",\r\n    width: 100,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  spellManaIcon: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    marginLeft: 2,\r\n  },\r\n  bigContainer: {\r\n    width: 340,\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { StyleSheet, useWindowDimensions, View } from \"react-native\";\r\nimport { Modal, useTheme } from \"react-native-paper\";\r\nimport Styles from \"./Styles\";\r\n\r\nexport function FullscreenModal(props: {\r\n  visible: boolean;\r\n  onDismiss: () => void;\r\n  children: React.ReactNode;\r\n}) {\r\n  const theme = useTheme();\r\n  const { width, height } = useWindowDimensions();\r\n  return (\r\n    <Modal\r\n      visible={props.visible}\r\n      onDismiss={props.onDismiss}\r\n      contentContainerStyle={[\r\n        styles.overlay,\r\n        {\r\n          maxWidth: Math.min(width - 16, 640),\r\n          maxHeight: height - 32,\r\n          backgroundColor: theme.colors.background,\r\n        },\r\n      ]}\r\n    >\r\n      <View style={[Styles.flex, Styles.p16]}>{props.children}</View>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  overlay: {\r\n    alignSelf: \"center\",\r\n    marginHorizontal: 16,\r\n    maxWidth: 640,\r\n  },\r\n});\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { TouchableOpacity } from \"react-native-gesture-handler\";\r\nimport { Portal, Surface, useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { buildFamiliarCrate } from \"../backend/buildings/FamiliarCrate\";\r\nimport { DungeonFloors } from \"../backend/exploration/dungeons/Dungeons\";\r\nimport {\r\n  FamiliarStatusType,\r\n  Familiars,\r\n  deleteFamiliar,\r\n  getFamiliarData,\r\n  setAllFamiliarsToAutoExplore,\r\n  setAllFamiliarsToExplore,\r\n  setCurrentCompanion,\r\n  setFamiliarToAutoExplore,\r\n  setFamiliarToExplore,\r\n  translateFamiliarCompanionStatusType,\r\n} from \"../backend/familiars/Familiar\";\r\nimport { keysOf } from \"../utils/CoreUtils\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { EnemySpriteTile } from \"./exploration/EnemySpriteTile\";\r\nimport { FamiliarMessageLog } from \"./familiars/FamiliarMessageLog\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { CombatStatsViewer } from \"./utility/CombatStatsViewer\";\r\nimport { DungeonFloorSelect } from \"./utility/DungeonFloorSelect\";\r\nimport { FullscreenModal } from \"./utility/FullscreenModal\";\r\nimport { GameStateFreezer } from \"./utility/GameStateFreezer\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"./utility/UIContext\";\r\n\r\nfunction FamiliarRow(props: { familiarId: string }) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const theme = useTheme();\r\n\r\n  const [collapsed, setCollapsed] = useState(true);\r\n\r\n  const familiarId = props.familiarId;\r\n  const familiarData = getFamiliarData(state, familiarId);\r\n  const familiar = Familiars.getById(familiarData.familiarClassId);\r\n\r\n  const familiarLevel = familiar.getLevel(state, familiarId);\r\n  const familiarMaxLevel = familiar.getMaxLevel(state, familiarId);\r\n\r\n  let statusString = t(\"Idle\");\r\n  switch (familiarData.status.status) {\r\n    case FamiliarStatusType.Companion:\r\n      statusString = t(\"Fighting ({{companionStatus}})\", {\r\n        companionStatus: translateFamiliarCompanionStatusType(\r\n          familiarData.status.companionStatus,\r\n        ),\r\n      });\r\n      break;\r\n    case FamiliarStatusType.Exploring:\r\n      statusString = t(\r\n        \"{{auto}}Exploring ({{dungeonFloorName}} - {{explorationProgressPct}}%)\",\r\n        {\r\n          auto: familiarData.status.autoExploring ? t(\"Auto-\") : \"\",\r\n          dungeonFloorName: DungeonFloors.getById(\r\n            familiarData.status.exploringDungeonFloorId,\r\n          ).getFloorName(),\r\n          explorationProgressPct: formatNumber(\r\n            familiarData.status.actionProgress * 100,\r\n          ),\r\n        },\r\n      );\r\n      break;\r\n  }\r\n\r\n  const uiContext = useContext(UIContext);\r\n  const [_isModalSelectorOpen, setIsModalSelectorOpen] = useUIStateFromContext(\r\n    uiContext,\r\n    \"picker_open\",\r\n    false,\r\n  );\r\n  const [showingDungeonSelector, setShowingDungeonSelector] = useState(false);\r\n\r\n  const showModal = useCallback(() => {\r\n    setShowingDungeonSelector(true);\r\n    setIsModalSelectorOpen(true);\r\n  }, [setShowingDungeonSelector, setIsModalSelectorOpen]);\r\n  const hideModal = useCallback(() => {\r\n    setShowingDungeonSelector(false);\r\n    setIsModalSelectorOpen(false);\r\n  }, [setShowingDungeonSelector, setIsModalSelectorOpen]);\r\n\r\n  const [confirmRelease, setConfirmRelease] = useState(false);\r\n  const releaseFamiliar = useCallback(() => {\r\n    if (confirmRelease) {\r\n      stateRef.current.apply((state) => {\r\n        state = deleteFamiliar(state, familiarId);\r\n        buildFamiliarCrate._demolishUnsafe(state, 1);\r\n        return state;\r\n      });\r\n    } else {\r\n      setConfirmRelease(true);\r\n    }\r\n  }, [confirmRelease]);\r\n\r\n  const autoExploreCallback = useCallback(() => {\r\n    stateRef.current.apply((state) =>\r\n      setFamiliarToAutoExplore(state, familiarId),\r\n    );\r\n  }, [familiarId]);\r\n  const companionCallback = useCallback(() => {\r\n    stateRef.current.apply((state) => setCurrentCompanion(state, familiarId));\r\n  }, [familiarId]);\r\n  const explorationCallback = useCallback(\r\n    (dungeonFloorId: string) => {\r\n      stateRef.current.apply((state) =>\r\n        setFamiliarToExplore(state, familiarId, dungeonFloorId),\r\n      );\r\n      hideModal();\r\n    },\r\n    [familiarId, hideModal],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <Surface mode=\"flat\" key={props.familiarId} style={styles.rowContainer}>\r\n        <TouchableOpacity\r\n          onPress={() => setCollapsed(!collapsed)}\r\n          style={styles.expandTouchable}\r\n        >\r\n          <View style={Styles.flexRowSpaceBetween}>\r\n            <View>\r\n              <Text h4 style={Styles.bold}>\r\n                {t(\"{{familiarName}} - Lv{{familiarLevel}}\", {\r\n                  familiarName: familiar.getName(),\r\n                  familiarLevel: familiarLevel,\r\n                })}\r\n              </Text>\r\n              <Text>{statusString}</Text>\r\n            </View>\r\n            <Entypo\r\n              name={collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n              size={24}\r\n              color={theme.colors.onBackground}\r\n            />\r\n          </View>\r\n        </TouchableOpacity>\r\n        <GameStateFreezer isVisible={!collapsed}>\r\n          <View style={collapsed ? { display: \"none\" } : null}>\r\n            <View style={Styles.flexRowSpaceBetween}>\r\n              <View style={[Styles.flex, Styles.flexCenter]}>\r\n                <EnemySpriteTile sprite={familiar.getPicture(state)} />\r\n              </View>\r\n              <View style={Styles.flex}>\r\n                <CategoryContainer title={t(\"General\")}>\r\n                  <View style={Styles.mt8}>\r\n                    <View style={Styles.flexRowSpaceBetween}>\r\n                      <Text>{t(\"Level:\")}</Text>\r\n                      {familiarLevel < familiarMaxLevel ? (\r\n                        <Text>\r\n                          {t(\"{{level}}\", {\r\n                            level: formatNumber(familiarLevel),\r\n                          })}\r\n                        </Text>\r\n                      ) : (\r\n                        <Text>\r\n                          {t(\"{{level}} (Max)\", {\r\n                            level: formatNumber(familiarLevel),\r\n                          })}\r\n                        </Text>\r\n                      )}\r\n                    </View>\r\n                    <View style={Styles.flexRowSpaceBetween}>\r\n                      <Text>{t(\"Exp:\")}</Text>\r\n                      <Text>\r\n                        {t(\"{{currentExp}}/{{toNextLevel}}\", {\r\n                          currentExp: formatNumber(familiarData.exp),\r\n                          toNextLevel: formatNumber(\r\n                            familiar.getExpForNextLevel(state, familiarId),\r\n                          ),\r\n                        })}\r\n                      </Text>\r\n                    </View>\r\n                    <View style={Styles.flexRowSpaceBetween}>\r\n                      <Text>{t(\"Status:\")}</Text>\r\n                      <Text\r\n                        style={[Styles.ml8, { textAlign: \"right\", flex: 1 }]}\r\n                      >\r\n                        {statusString}\r\n                      </Text>\r\n                    </View>\r\n                  </View>\r\n                </CategoryContainer>\r\n                <CategoryContainer title={t(\"Stats\")}>\r\n                  <View style={Styles.mt8}>\r\n                    <CombatStatsViewer\r\n                      combatStats={{\r\n                        ...familiar.getStats(state, familiarId),\r\n                        currentHP: familiarData.status.currentHp,\r\n                      }}\r\n                      showCurrentHP={true}\r\n                    />\r\n                  </View>\r\n                </CategoryContainer>\r\n              </View>\r\n            </View>\r\n            <CategoryContainer title={t(\"Actions\")}>\r\n              <View style={Styles.mt8}>\r\n                <View style={styles.optionRow}>\r\n                  <Button\r\n                    onPress={companionCallback}\r\n                    disabled={\r\n                      familiarData.status.status == FamiliarStatusType.Companion\r\n                    }\r\n                    compact={true}\r\n                  >\r\n                    {t(\"Summon\")}\r\n                  </Button>\r\n                  <Button onPress={showModal} compact={true}>\r\n                    {t(\"Explore\")}\r\n                  </Button>\r\n                  <Button\r\n                    onPress={autoExploreCallback}\r\n                    disabled={\r\n                      familiarData.status.status ==\r\n                        FamiliarStatusType.Exploring &&\r\n                      familiarData.status.autoExploring\r\n                    }\r\n                    compact={true}\r\n                  >\r\n                    {t(\"Auto-Explore\")}\r\n                  </Button>\r\n                  <Portal>\r\n                    <FullscreenModal\r\n                      visible={showingDungeonSelector}\r\n                      onDismiss={hideModal}\r\n                    >\r\n                      <DungeonFloorSelect\r\n                        onSelect={explorationCallback}\r\n                        familiarId={familiarId}\r\n                      />\r\n                    </FullscreenModal>\r\n                  </Portal>\r\n                </View>\r\n              </View>\r\n              <View style={[Styles.mt8, Styles.ph8]}>\r\n                <CategoryContainer\r\n                  title={t(\"Release\")}\r\n                  initiallyExpanded={false}\r\n                >\r\n                  <View style={Styles.mt8}>\r\n                    <Markdown>\r\n                      {t(\r\n                        \"If you want to recover the land used by a Familiar Crate, you can release a familiar. However, you will **lose the familiar** permanently - if you build a Familiar Crate again, you will need to raise the familiar again as if it was new.\",\r\n                      )}\r\n                    </Markdown>\r\n                    <View style={[Styles.mt8, Styles.flexCenter]}>\r\n                      <Button onPress={releaseFamiliar}>\r\n                        {confirmRelease\r\n                          ? t(\"Press again to confirm\")\r\n                          : t(\"Release Familiar\")}\r\n                      </Button>\r\n                    </View>\r\n                  </View>\r\n                </CategoryContainer>\r\n              </View>\r\n            </CategoryContainer>\r\n            <CategoryContainer title={t(\"Activity\")} initiallyExpanded={false}>\r\n              <View style={[Styles.mt8, styles.messageLogContainer]}>\r\n                <FamiliarMessageLog familiarId={familiarId} />\r\n              </View>\r\n            </CategoryContainer>\r\n          </View>\r\n        </GameStateFreezer>\r\n      </Surface>\r\n    ),\r\n    [\r\n      collapsed,\r\n      setCollapsed,\r\n      familiar.getName(),\r\n      familiarLevel,\r\n      familiarMaxLevel,\r\n      statusString,\r\n      !collapsed && showingDungeonSelector,\r\n      !collapsed && hideModal,\r\n      !collapsed && explorationCallback,\r\n      !collapsed && autoExploreCallback,\r\n      !collapsed && JSON.stringify(familiarData),\r\n      theme,\r\n      confirmRelease,\r\n      releaseFamiliar,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function FamiliarsComponent() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const familiarIds = keysOf(state.run.familiars);\r\n\r\n  const uiContext = useContext(UIContext);\r\n  const [_isModalSelectorOpen, setIsModalSelectorOpen] = useUIStateFromContext(\r\n    uiContext,\r\n    \"picker_open\",\r\n    false,\r\n  );\r\n  const [showingDungeonSelector, setShowingDungeonSelector] = useState(false);\r\n\r\n  const showModal = useCallback(() => {\r\n    setShowingDungeonSelector(true);\r\n    setIsModalSelectorOpen(true);\r\n  }, [setShowingDungeonSelector, setIsModalSelectorOpen]);\r\n  const hideModal = useCallback(() => {\r\n    setShowingDungeonSelector(false);\r\n    setIsModalSelectorOpen(false);\r\n  }, [setShowingDungeonSelector, setIsModalSelectorOpen]);\r\n\r\n  const autoExploreCallback = useCallback(() => {\r\n    stateRef.current.apply((state) => setAllFamiliarsToAutoExplore(state));\r\n  }, []);\r\n  const explorationCallback = useCallback(\r\n    (dungeonFloorId: string) => {\r\n      stateRef.current.apply((state) =>\r\n        setAllFamiliarsToExplore(state, dungeonFloorId),\r\n      );\r\n      hideModal();\r\n    },\r\n    [hideModal],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={styles.topContainer}>\r\n        {familiarIds.length > 0 ? (\r\n          <View>\r\n            {familiarIds.map((familiarId) => (\r\n              <View key={familiarId} style={Styles.pv4}>\r\n                <FamiliarRow familiarId={familiarId} key={familiarId} />\r\n              </View>\r\n            ))}\r\n\r\n            <View style={Styles.mt16}>\r\n              <CategoryContainer title={t(\"Familiar Actions\")}>\r\n                <View style={Styles.flexCenter}>\r\n                  <View\r\n                    style={[\r\n                      Styles.mt8,\r\n                      Styles.flexRowAlignCenter,\r\n                      { gap: 8, justifyContent: \"space-around\" },\r\n                    ]}\r\n                  >\r\n                    <Button onPress={showModal} compact={true}>\r\n                      {t(\"All Explore\")}\r\n                    </Button>\r\n                    <Button onPress={autoExploreCallback} compact={true}>\r\n                      {t(\"All Auto-Explore\")}\r\n                    </Button>\r\n                  </View>\r\n                </View>\r\n                <Portal>\r\n                  <FullscreenModal\r\n                    visible={showingDungeonSelector}\r\n                    onDismiss={hideModal}\r\n                  >\r\n                    <DungeonFloorSelect\r\n                      onSelect={explorationCallback}\r\n                      familiarId={undefined}\r\n                    />\r\n                  </FullscreenModal>\r\n                </Portal>\r\n              </CategoryContainer>\r\n            </View>\r\n          </View>\r\n        ) : (\r\n          <Markdown>\r\n            {t(\r\n              \"In this screen, you can check the status of your familiars and control them. However, you have no familiars right now. Build a Familiar Crate in your Home to get one!\",\r\n            )}\r\n          </Markdown>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    familiarIds.join(),\r\n    showingDungeonSelector,\r\n    hideModal,\r\n    explorationCallback,\r\n    autoExploreCallback,\r\n    showModal,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    width: \"100%\",\r\n  },\r\n  contentContainer: {\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 4,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  hintProgress: {\r\n    marginTop: 4,\r\n  },\r\n  loadoutsContainer: {\r\n    borderTopWidth: 1,\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 4,\r\n  },\r\n  categoryTitle: {\r\n    marginLeft: 8,\r\n  },\r\n  categoryContainer: {\r\n    paddingTop: 4,\r\n    marginBottom: 8,\r\n  },\r\n  campusContainer: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  campusHintWarning: {\r\n    marginTop: 16,\r\n  },\r\n  optionRow: {\r\n    marginTop: 8,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    gap: 8,\r\n    justifyContent: \"space-around\",\r\n  },\r\n  overlay: {\r\n    alignSelf: \"center\",\r\n    marginHorizontal: 16,\r\n    maxWidth: 640,\r\n  },\r\n  messageLogContainer: {\r\n    padding: 8,\r\n    borderColor: \"#444\",\r\n    borderWidth: 1,\r\n    maxHeight: 320,\r\n  },\r\n  rowContainer: {\r\n    padding: 8,\r\n    borderRadius: 8,\r\n  },\r\n  topContainer: {\r\n    gap: 8,\r\n  },\r\n  expandTouchable: {\r\n    // @ts-ignore This is a valid property\r\n    cursor: \"pointer\",\r\n  },\r\n});\r\n","import { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { triggerNotification } from \"../Notifications\";\r\n\r\nexport type Help = {\r\n  id: string;\r\n  category: string;\r\n  title: string;\r\n  description: string;\r\n  descriptionWeb?: string;\r\n  order: number;\r\n  isVisible?: (state: GameState) => boolean;\r\n};\r\n\r\nexport enum HelpCategory {\r\n  Introduction = \"Introduction\",\r\n  ScreensOverview = \"ScreensOverview\",\r\n  ElementsOverview = \"ElementsOverview\",\r\n  GameFeatures = \"GameFeatures\",\r\n  Wizards = \"Wizards\",\r\n  Exploration = \"Exploration\",\r\n  TipsAndTricks = \"TipsAndTricks\",\r\n}\r\n\r\nexport function translateHelpCategory(helpCategory: HelpCategory): string {\r\n  switch (helpCategory) {\r\n    case HelpCategory.Introduction:\r\n      return t(\"Introduction\");\r\n    case HelpCategory.ScreensOverview:\r\n      return t(\"Screens Overview\");\r\n    case HelpCategory.ElementsOverview:\r\n      return t(\"Elements Overview\");\r\n    case HelpCategory.GameFeatures:\r\n      return t(\"Game Features\");\r\n    case HelpCategory.Wizards:\r\n      return t(\"Wizards\");\r\n    case HelpCategory.Exploration:\r\n      return t(\"Exploration\");\r\n    case HelpCategory.TipsAndTricks:\r\n      return t(\"Tips and Tricks\");\r\n    // Do not add a default\r\n  }\r\n}\r\n\r\nconst Helps = new DataStore<Help>();\r\n\r\nexport { Helps };\r\n\r\nexport function getVisibleHelps(state: GameState): Help[] {\r\n  return Helps.getAll()\r\n    .filter((help) => help.isVisible == null || help.isVisible(state))\r\n    .sort((a, b) => a.order - b.order);\r\n}\r\n\r\nexport function getVisibleHelpsByCategory(\r\n  state: GameState,\r\n): Record<HelpCategory, Help[]> {\r\n  const helps = getVisibleHelps(state);\r\n  const helpsByCategory = {\r\n    Introduction: [],\r\n    ScreensOverview: [],\r\n    ElementsOverview: [],\r\n    GameFeatures: [],\r\n    Wizards: [],\r\n    Exploration: [],\r\n    TipsAndTricks: [],\r\n  };\r\n  for (let help of helps) {\r\n    helpsByCategory[help.category] = helpsByCategory[help.category] ?? [];\r\n    helpsByCategory[help.category].push(help);\r\n  }\r\n  for (let category in helpsByCategory) {\r\n    if (helpsByCategory[category].length == 0) {\r\n      delete helpsByCategory[category];\r\n    }\r\n  }\r\n  return helpsByCategory;\r\n}\r\n\r\nlet tempIds: string | undefined = undefined;\r\n\r\naddGameStateListener(\r\n  \"HelpNotifier\",\r\n  (state) => {\r\n    if (tempIds == null) {\r\n      return;\r\n    }\r\n\r\n    const oldIds = tempIds?.split(\",\") ?? [];\r\n    const newHelps = getVisibleHelps(state);\r\n    const idsToNotify = [];\r\n    for (let help of newHelps) {\r\n      if (!oldIds.includes(help.order.toString())) {\r\n        idsToNotify.push(help.id);\r\n      }\r\n    }\r\n    if (idsToNotify.length > 0) {\r\n      return (newState) => {\r\n        for (let helpId of idsToNotify) {\r\n          newState = triggerNotification(newState, \"Help\", helpId);\r\n        }\r\n        return newState;\r\n      };\r\n    }\r\n  },\r\n  (state, oldValue) => {\r\n    tempIds = oldValue as string | undefined;\r\n    return getVisibleHelps(state)\r\n      .map((help) => help.order.toString())\r\n      .join(\",\");\r\n  },\r\n);\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, { useMemo } from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { Badge, useTheme } from \"react-native-paper\";\r\nimport { Help } from \"../../backend/helps/Helps\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function HelpContainer(props: {\r\n  help: Help;\r\n  showBadge: boolean;\r\n  collapsed?: boolean;\r\n  onPressExpand?: () => void;\r\n}) {\r\n  const help = props.help;\r\n  const title = help.title;\r\n  const description = help.description;\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        <Markdown style={styles.descriptionViewer}>{description}</Markdown>\r\n      </View>\r\n    );\r\n  }, [description]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={styles.helpContainer} key={title}>\r\n        <TouchableWithoutFeedback\r\n          accessibilityRole=\"button\"\r\n          accessibilityHint=\"Expand\"\r\n          onPress={props.onPressExpand}\r\n        >\r\n          <View style={styles.topRowContainer}>\r\n            <View style={styles.topContainer}>\r\n              <Text h3 key={title}>\r\n                {title}\r\n              </Text>\r\n              {props.showBadge && (\r\n                <View style={styles.badgeContainer}>\r\n                  <Badge />\r\n                </View>\r\n              )}\r\n            </View>\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.colors.onBackground}\r\n              />\r\n            </View>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        {!props.collapsed && <View>{descriptionContainer}</View>}\r\n      </View>\r\n    );\r\n  }, [\r\n    theme,\r\n    title,\r\n    !props.collapsed && descriptionContainer,\r\n    props.collapsed,\r\n    props.onPressExpand,\r\n    props.showBadge,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  helpContainer: { marginVertical: 8 },\r\n  topRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginBottom: 8,\r\n    marginTop: 8,\r\n    marginHorizontal: 8,\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  descriptionViewer: { flex: 1, justifyContent: \"center\" },\r\n  topContainer: {\r\n    flex: 1,\r\n    marginLeft: 8,\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  disabledStorylineText: {\r\n    color: \"#aaa\",\r\n  },\r\n  badgeContainer: {\r\n    marginLeft: 8,\r\n  },\r\n});\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n} from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport {\r\n  getUnreadNotificationsByGroup,\r\n  markNotificationAsRead,\r\n} from \"../backend/Notifications\";\r\nimport {\r\n  Help,\r\n  HelpCategory,\r\n  getVisibleHelpsByCategory,\r\n  translateHelpCategory,\r\n} from \"../backend/helps/Helps\";\r\nimport { t } from \"../utils/I18n\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { HelpContainer } from \"./utility/HelpContainer\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nfunction HelpsCategoryContainer(props: {\r\n  expandedHelp: string;\r\n  setHelpCallback: (helpTitle: string) => void;\r\n  helps: Help[];\r\n  category: HelpCategory;\r\n}) {\r\n  const { category, expandedHelp, helps, setHelpCallback } = props;\r\n\r\n  const state = useContext(StateContext);\r\n  const helpNotifications = getUnreadNotificationsByGroup(state, \"Help\").map(\r\n    (notification) => notification.item,\r\n  );\r\n\r\n  const helpNameString = helps.map((help) => help.title).join(\",\");\r\n\r\n  const helpContainers = useMemo(\r\n    () =>\r\n      helps.map((help) => {\r\n        return (\r\n          <HelpContainer\r\n            key={help.title}\r\n            help={help}\r\n            showBadge={helpNotifications.includes(help.id)}\r\n            collapsed={expandedHelp != help.id}\r\n            onPressExpand={setHelpCallback.bind(null, help.id)}\r\n          />\r\n        );\r\n      }),\r\n    [helpNameString, expandedHelp, setHelpCallback, helpNotifications.join()],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (helps.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <CategoryContainer title={translateHelpCategory(category)}>\r\n        <View style={Styles.mt4}>\r\n          {helpContainers.map((helpContainer, idx) => {\r\n            return (\r\n              <View key={helps[idx].title}>\r\n                {idx > 0 && <Divider />}\r\n                {helpContainer}\r\n              </View>\r\n            );\r\n          })}\r\n          <Divider />\r\n        </View>\r\n      </CategoryContainer>\r\n    );\r\n  }, [helpNameString, helpContainers]);\r\n}\r\n\r\nfunction HelpsContainer() {\r\n  const [expandedHelp, setExpandedHelp] = useState(\"\");\r\n\r\n  const state = useContext(StateContext);\r\n  const stateRef = React.useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const setHelpCallback = useCallback(\r\n    (id: string) => {\r\n      if (expandedHelp == id) {\r\n        setExpandedHelp(\"\");\r\n      } else {\r\n        setExpandedHelp(id);\r\n      }\r\n    },\r\n    [expandedHelp],\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (expandedHelp != \"\") {\r\n      stateRef.current.apply((state) =>\r\n        markNotificationAsRead(state, \"Help\", expandedHelp),\r\n      );\r\n    }\r\n  }, [expandedHelp]);\r\n\r\n  const allHelps = getVisibleHelpsByCategory(state);\r\n\r\n  return useMemo(() => {\r\n    let categoryContainers = [];\r\n    for (let category in allHelps) {\r\n      const helps = allHelps[category];\r\n      if (helps != null && helps.length > 0) {\r\n        categoryContainers.push(\r\n          <HelpsCategoryContainer\r\n            category={category as HelpCategory}\r\n            expandedHelp={expandedHelp}\r\n            helps={helps}\r\n            setHelpCallback={setHelpCallback}\r\n            key={category}\r\n          />,\r\n        );\r\n      }\r\n    }\r\n    return (\r\n      <View>\r\n        {categoryContainers}\r\n        <Divider />\r\n      </View>\r\n    );\r\n  }, [JSON.stringify(allHelps), expandedHelp, setExpandedHelp]);\r\n}\r\n\r\nexport default function HelpScreen() {\r\n  return (\r\n    <View>\r\n      <View style={styles.headerContainer}>\r\n        <Text h1>{t(\"Help\")}</Text>\r\n      </View>\r\n\r\n      <Text>{t(\"Learn how to play the game!\")}</Text>\r\n      <View style={styles.helpContainer}>\r\n        <HelpsContainer />\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  headerContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  valueText: {\r\n    minWidth: 60,\r\n    textAlign: \"right\",\r\n    marginLeft: 8,\r\n  },\r\n  valueTextLong: {\r\n    minWidth: 112,\r\n  },\r\n  helpContainer: {\r\n    marginTop: 16,\r\n  },\r\n  captionText: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { GameState } from \"../GameState\";\r\n\r\nexport type Hint = {\r\n  description: string;\r\n  isCompleted: (state: GameState) => boolean;\r\n\r\n  // Returns a number between 0 and 1 representing a percentage\r\n  progress?: (state: GameState) => number;\r\n};\r\n\r\nlet hintsDatabase: Hint[] = [];\r\n\r\nexport function clearAllHints(): void {\r\n  hintsDatabase = [];\r\n}\r\n\r\nexport function pushHint(hint: Hint): void {\r\n  hintsDatabase.push(hint);\r\n}\r\n\r\nexport function getFirstHint(state: GameState): Hint | undefined {\r\n  for (const idx in hintsDatabase) {\r\n    const hint = hintsDatabase[idx];\r\n    if (!hint.isCompleted(state)) {\r\n      return hint;\r\n    }\r\n  }\r\n}\r\n\r\nexport function getFirstHintIndex(state: GameState): string | undefined {\r\n  for (const idx in hintsDatabase) {\r\n    const hint = hintsDatabase[idx];\r\n    if (!hint.isCompleted(state)) {\r\n      return idx;\r\n    }\r\n  }\r\n}\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { ScrollView, StyleSheet, View } from \"react-native\";\r\nimport { Menu, useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { ActionArea } from \"../backend/action/ActionAreas\";\r\nimport {\r\n  getAutoPurchaseActions,\r\n  isAutoPurchaseUnlocked,\r\n} from \"../backend/action/Actions\";\r\nimport { getFirstHint } from \"../backend/hints/Hints\";\r\nimport { t } from \"../utils/I18n\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { ProgressBar } from \"./utility/ProgressBar\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { VisibilityContext } from \"./utility/VisibilityContext\";\r\n\r\nexport default function Home(props: {\r\n  onScroll: (event: any) => void;\r\n  scrollRef: any;\r\n}) {\r\n  const visible = useContext(VisibilityContext);\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const currentHint = getFirstHint(state);\r\n  const hintProgress = currentHint?.progress?.(state);\r\n\r\n  const theme = useTheme();\r\n\r\n  const [menuVisible, setMenuVisible] = useState(false);\r\n  const toggleMenuVisible = useCallback(\r\n    () => setMenuVisible(!menuVisible),\r\n    [menuVisible, setMenuVisible],\r\n  );\r\n\r\n  const menuButton = useMemo(\r\n    () => (\r\n      <Button compact={true} onPress={toggleMenuVisible}>\r\n        {t(\"More actions...\")}\r\n      </Button>\r\n    ),\r\n    [toggleMenuVisible],\r\n  );\r\n  const toggleAllAutoBuildAction = useMemo(\r\n    () => (\r\n      <Menu.Item\r\n        key=\"toggleAllAutoBuild\"\r\n        title={t(\"Toggle all auto-purchase max\")}\r\n        onPress={() => {\r\n          stateRef.current.apply((state) => {\r\n            let shouldEnableAll = false;\r\n            const actions = getAutoPurchaseActions();\r\n            for (let action of actions) {\r\n              if (\r\n                action.isVisible(state) &&\r\n                (action.getAreas()[ActionArea.HOME]?.length ?? 0) > 0 &&\r\n                !(state.run.autoPurchaseActions[action.getId()] ?? false)\r\n              ) {\r\n                shouldEnableAll = true;\r\n                break;\r\n              }\r\n            }\r\n            for (let action of actions) {\r\n              if (\r\n                action.isVisible(state) &&\r\n                (action.getAreas()[ActionArea.HOME]?.length ?? 0) > 0\r\n              ) {\r\n                state.run.autoPurchaseActions[action.getId()] = shouldEnableAll;\r\n              }\r\n            }\r\n            return state;\r\n          });\r\n          setMenuVisible(false);\r\n        }}\r\n      />\r\n    ),\r\n    [setMenuVisible],\r\n  );\r\n  const menuDismiss = useCallback(\r\n    () => setMenuVisible(false),\r\n    [setMenuVisible],\r\n  );\r\n  const menuActions = useMemo(() => {\r\n    const menuActions = [];\r\n    if (isAutoPurchaseUnlocked(state)) {\r\n      menuActions.push(toggleAllAutoBuildAction);\r\n    }\r\n    return menuActions;\r\n  }, [toggleAllAutoBuildAction, isAutoPurchaseUnlocked(state)]);\r\n\r\n  const menu = useMemo(() => {\r\n    return (\r\n      menuActions.length > 0 && (\r\n        <Menu visible={menuVisible} anchor={menuButton} onDismiss={menuDismiss}>\r\n          {menuActions}\r\n        </Menu>\r\n      )\r\n    );\r\n  }, [menuActions, menuVisible, menuButton, menuDismiss]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.campusContainer}>\r\n        <ScrollView\r\n          contentContainerStyle={styles.contentContainer}\r\n          style={styles.container}\r\n          onScroll={visible && props.onScroll}\r\n          ref={props.scrollRef}\r\n        >\r\n          <View style={[Styles.mt8, Styles.flexRowSpaceBetween]}>\r\n            <Text h1>{t(\"Home\")}</Text>\r\n            {menu}\r\n          </View>\r\n          <ActionsContainer area={ActionArea.HOME} />\r\n        </ScrollView>\r\n        <View\r\n          style={[\r\n            styles.hintContainer,\r\n            { borderColor: theme.colors.outlineVariant },\r\n          ]}\r\n        >\r\n          <CategoryContainer\r\n            titleStyle={styles.categoryTitle}\r\n            title={t(\"Current Goal\")}\r\n            containerStyle={styles.categoryContainer}\r\n          >\r\n            <View style={styles.hintContents}>\r\n              <Text style={styles.hintContentsText}>\r\n                {currentHint?.description}!\r\n              </Text>\r\n              {currentHint?.progress && (\r\n                <ProgressBar\r\n                  progress={hintProgress}\r\n                  style={styles.hintProgress}\r\n                />\r\n              )}\r\n            </View>\r\n          </CategoryContainer>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [currentHint, hintProgress, theme, props.onScroll, visible, menu],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    width: \"100%\",\r\n  },\r\n  contentContainer: {\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n    paddingHorizontal: 8,\r\n  },\r\n  hintContents: {\r\n    marginLeft: 16,\r\n    marginTop: 8,\r\n    paddingRight: 32,\r\n  },\r\n  hintContentsText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  hintProgress: {\r\n    marginTop: 4,\r\n  },\r\n  hintContainer: {\r\n    borderTopWidth: 1,\r\n  },\r\n  categoryTitle: {\r\n    marginLeft: 8,\r\n  },\r\n  categoryContainer: {\r\n    paddingTop: 4,\r\n    marginBottom: 8,\r\n  },\r\n  campusContainer: {\r\n    height: \"100%\",\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  campusHintWarning: {\r\n    marginTop: 16,\r\n  },\r\n});\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"dualFlexibility\",\r\n  t(\"Dual Flexibility\"),\r\n  470,\r\n  40,\r\n  t(\r\n    \"Reach Lv45 on your primary element, and have a second element at least Lv35 and 3 levels higher than the next highest\",\r\n  ),\r\n  t(\"Unlock the ability to select a second Primary Element\"),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as DualFlexibilityStoryline };\r\n","import React, { ReactNode } from \"react\";\r\nimport { Card as PaperCard, CardProps, useTheme } from \"react-native-paper\";\r\n\r\nexport function Card(\r\n  props: Omit<CardProps, \"elevation\"> & { children?: ReactNode },\r\n) {\r\n  const theme = useTheme();\r\n  return (\r\n    <PaperCard\r\n      {...props}\r\n      mode=\"outlined\"\r\n      // elevation={0}\r\n      style={[{ backgroundColor: theme.colors.background }, props?.style]}\r\n    >\r\n      {props.children}\r\n    </PaperCard>\r\n  );\r\n}\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { StyleProp, View, ViewStyle } from \"react-native\";\r\nimport { TextInput, useTheme } from \"react-native-paper\";\r\nimport { GameState, StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  loadBase64Data,\r\n  makeCompatible,\r\n  saveDataUnsafe,\r\n} from \"../../backend/SaveData\";\r\nimport { compareVersions } from \"../../utils/CoreUtils\";\r\nimport {\r\n  LOAD_FROM_FILE_SUPPORTED,\r\n  loadSaveFromFile,\r\n} from \"../../utils/FilesystemSave\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport {\r\n  getCurrentVersion,\r\n  getCurrentVersionTimestamp,\r\n} from \"../../utils/Versioning\";\r\nimport { Button } from \"./Button\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport default function LoadGameContainer(props: {\r\n  style?: StyleProp<ViewStyle>;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  const [loadMessage, setLoadMessage] = useState<string | null>(\"\");\r\n  const [loadSaveContents, setLoadSaveContents] = useState(\"\");\r\n\r\n  const loadSaveFromDeserializedData = useCallback(\r\n    async (deserializedData: GameState) => {\r\n      try {\r\n        // Only in the demo version, fail loading saves coming from the full version.\r\n        const isDemo = false;\r\n        if (isDemo && deserializedData.global.isFullVersionSave) {\r\n          setLoadMessage(\r\n            t(\r\n              \"Failed to load save. This save data belongs to the full version of the game, and cannot be used in the demo version.\",\r\n            ),\r\n          );\r\n          return;\r\n        }\r\n\r\n        // Only in the full version, fail loading saves coming from the full version\r\n        // if they come from a future version.\r\n        const currentAppVersionTimestamp =\r\n          getCurrentVersionTimestamp() || +Infinity;\r\n        const currentAppVersion = getCurrentVersion() ?? \"99.99.99\";\r\n        const versionCompare = compareVersions(\r\n          currentAppVersion,\r\n          deserializedData.global.appVersionString,\r\n          2,\r\n        );\r\n        if (\r\n          !isDemo &&\r\n          deserializedData.global.isFullVersionSave &&\r\n          (currentAppVersionTimestamp <\r\n            deserializedData.global.appVersionTimestamp -\r\n              1000 * 60 * 60 * 24 * 30 ||\r\n            versionCompare < 0)\r\n        ) {\r\n          setLoadMessage(\r\n            t(\r\n              \"Failed to load save. This save data was made with a more recent version of the game. Please update your game and try again. If no update is available, please try restarting the game or your device several times and loading the save again.\",\r\n            ),\r\n          );\r\n          return;\r\n        }\r\n        const compatibleData = makeCompatible(deserializedData);\r\n        const skipAheadTime = Math.max(\r\n          Math.min(\r\n            60 * 60 * 48,\r\n            (Date.now() - compatibleData.run.lastProcessedTime) / 1000,\r\n          ),\r\n          0,\r\n        );\r\n        compatibleData.run.skipAheadTime = skipAheadTime;\r\n        stateRef.current.overwrite((_oldState) => {\r\n          return compatibleData;\r\n        });\r\n        await saveDataUnsafe(compatibleData);\r\n        setLoadMessage(t(\"Load successful!\"));\r\n      } catch (e) {\r\n        setLoadMessage(\r\n          t(\r\n            \"Failed to load save because of an unexpected error! Is the data valid?\",\r\n          ),\r\n        );\r\n      }\r\n    },\r\n    [],\r\n  );\r\n  const importSavefile = useCallback(async () => {\r\n    if (loadSaveContents === \"\") {\r\n      setLoadMessage(\r\n        t(\"Please paste your save in the text field above this message first!\"),\r\n      );\r\n      return;\r\n    }\r\n    try {\r\n      const deserializedData = await loadBase64Data(loadSaveContents);\r\n      if (deserializedData != null) {\r\n        await loadSaveFromDeserializedData(deserializedData);\r\n      } else {\r\n        setLoadMessage(\r\n          t(\"Failed to load save. Make sure you have copied the full text!\"),\r\n        );\r\n      }\r\n    } catch (e) {\r\n      setLoadMessage(\r\n        t(\"Failed to load save. Make sure you have copied the full text!\"),\r\n      );\r\n    }\r\n  }, [loadSaveContents, loadSaveFromDeserializedData]);\r\n  useEffect(() => setLoadMessage(\"\"), [loadSaveContents]);\r\n\r\n  const theme = useTheme();\r\n\r\n  const showByFile = LOAD_FROM_FILE_SUPPORTED;\r\n\r\n  const importSavefileFromFile = useCallback(async () => {\r\n    try {\r\n      const result = await loadSaveFromFile();\r\n      if (result.result === \"error\") {\r\n        setLoadMessage(\r\n          t(\r\n            \"There was an error reading from the file. Is it a valid Magic Research save? {{error}}\",\r\n            { error: result.error },\r\n          ),\r\n        );\r\n      }\r\n      if (result.result === \"success\") {\r\n        await loadSaveFromDeserializedData(result.data);\r\n      }\r\n    } catch (e) {\r\n      setLoadMessage(\r\n        t(\r\n          \"There was an error reading from the file. Is it a valid Magic Research save?\",\r\n        ),\r\n      );\r\n    }\r\n  }, [loadSaveFromDeserializedData]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={props.style}>\r\n        <TextInput\r\n          multiline={true}\r\n          onChangeText={setLoadSaveContents}\r\n          value={loadSaveContents}\r\n          mode=\"outlined\"\r\n          label={t(\"Save text\") ?? \"Save text\"}\r\n          style={{ maxHeight: 120 }}\r\n        />\r\n        {loadMessage != \"\" && (\r\n          <View style={Styles.mt8}>\r\n            <Text style={{ color: theme.colors.error }}>{loadMessage}</Text>\r\n          </View>\r\n        )}\r\n        {loadSaveContents != \"\" || !showByFile ? (\r\n          <Button style={Styles.mt16} onPress={importSavefile}>\r\n            {t(\"Import savefile\")}\r\n          </Button>\r\n        ) : (\r\n          <Button style={Styles.mt16} onPress={importSavefileFromFile}>\r\n            {t(\"Load from file\")}\r\n          </Button>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      setLoadSaveContents,\r\n      loadSaveContents,\r\n      loadMessage,\r\n      importSavefile,\r\n      importSavefileFromFile,\r\n    ],\r\n  );\r\n}\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport { StyleSheet, View, useWindowDimensions } from \"react-native\";\r\nimport { Card, RadioButton } from \"react-native-paper\";\r\nimport { clearAllCaches } from \"../backend/Caching\";\r\nimport { isDemo } from \"../backend/Demo\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport {\r\n  Challenges,\r\n  getVisibleChallenges,\r\n} from \"../backend/challenges/Challenges\";\r\nimport {\r\n  CombatClasses,\r\n  getSelectableCombatClasses,\r\n} from \"../backend/classes/CombatClasses\";\r\nimport { DualFlexibilityStoryline } from \"../backend/events/storyline/cavern/DualFlexibilityStoryline\";\r\nimport {\r\n  SpellElement,\r\n  getMaxPrimaryElementLevel,\r\n  getUnlockedElements,\r\n  grantStartingExp,\r\n  selectPrimaryElement,\r\n  selectSecondaryElement,\r\n  translateElement,\r\n} from \"../backend/spells/Elements\";\r\nimport { runGameStartupListeners } from \"../backend/spells/GameStartup\";\r\nimport { LOAD_FROM_FILE_SUPPORTED } from \"../utils/FilesystemSave\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { Button } from \"./utility/Button\";\r\nimport { Card as UtilityCard } from \"./utility/Card\";\r\nimport LoadGameContainer from \"./utility/LoadGameContainer\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport default function Intro() {\r\n  const state = useContext(StateContext);\r\n  const [selectedElement, setSelectedElement] = useState(null as string | null);\r\n  const elements = getUnlockedElements(state);\r\n\r\n  const selectedMPL =\r\n    selectedElement != null\r\n      ? getMaxPrimaryElementLevel(state, selectedElement as SpellElement)\r\n      : 0;\r\n  const isFirstTime =\r\n    (state.world.totalTimesResetted ?? 0) === 0 &&\r\n    (state.global.newGamePlusCount ?? 0) === 0;\r\n  const showLoadGameContainer = isFirstTime && !isDemo();\r\n\r\n  const loadText = LOAD_FROM_FILE_SUPPORTED\r\n    ? t(\r\n        \"If you have save data from the demo version of the game, you may load it by opening the save file, or pasting it here.\",\r\n      )\r\n    : t(\r\n        \"If you have save data from the demo version of the game, you may load it by pasting it here.\",\r\n      );\r\n  const primarySchoolText = t(`Please choose a primary element.`);\r\n\r\n  const elementDescriptionMap: Record<SpellElement, string> = {\r\n    Fire: t(\r\n      \"You have selected **Fire**! Fire specializes in high temperatures and raw power, as well as Catalysts, which increase the efficiency with which you can generate resources.\",\r\n    ),\r\n    Earth: t(\r\n      \"You have selected **Earth**! Earth is defensive and strongly protective. It specializes in Storages, which allow you to hold more resources at a time.\",\r\n    ),\r\n    Water: t(\r\n      \"You have selected **Water**! Water has a focus on health and basic Mana generation, the source of all Magic. Allows for more frequent spellcasting.\",\r\n    ),\r\n    Air: t(\r\n      \"You have selected **Air**! Air is speedy, but also plentiful. It is great for making large amounts of Coins, efficiently and quickly, as well as moving fast.\",\r\n    ),\r\n    Poison: t(\r\n      \"You have selected **Poison**! Poison can deal damage over time regardless of defense (and is sometimes even unavoidable), and is a key ingredient in many alchemical potions, Monstium gathering, and more.\",\r\n    ),\r\n    Mind: t(\r\n      \"You have selected **Mind**! Mind is a mysterious element with multiple applications, affecting various things about the game. It is also good for guaranteed damage that doesn't miss.\",\r\n    ),\r\n    Life: t(\r\n      \"You have selected **Life**! Apparently there is some of this element in each living being, from the tiniest plant to the largest animal. Key for healing and staying healthy.\",\r\n    ),\r\n    Electric: t(\r\n      \"You have selected **Electric**! Energy in one of its purest forms. Powerful, fast attacks, with a high critical hit chance that can pierce defenses.\",\r\n    ),\r\n    Death: t(\r\n      \"You have selected **Death**! One of the strongest elements, it is intensely powerful, but those who delve in it too much are said to become corrupt... It allows game-changing Rituals.\",\r\n    ),\r\n    Holy: t(\r\n      \"You have selected **Holy**! Power granted directly from a Divine, it can purify corruption.\",\r\n    ),\r\n    Time: t(\r\n      \"You have selected **Time**! A secret element, very few know about it.\",\r\n    ),\r\n    Space: t(\r\n      \"You have selected **Space**! A secret element, very few know about it.\",\r\n    ),\r\n  };\r\n\r\n  const [selectedClassId, setSelectedClassId] = useState(\r\n    undefined as string | undefined,\r\n  );\r\n  const classes = getSelectableCombatClasses(state);\r\n  const showClassSelection = classes.length > 0;\r\n  const selectedClass =\r\n    selectedClassId != null ? CombatClasses.getById(selectedClassId) : null;\r\n\r\n  const [selectedSecondaryElement, setSelectedSecondaryElement] = useState(\r\n    null as string | null,\r\n  );\r\n  const selectedSecondaryMPL =\r\n    selectedSecondaryElement != null\r\n      ? getMaxPrimaryElementLevel(\r\n          state,\r\n          selectedSecondaryElement as SpellElement,\r\n        )\r\n      : 0;\r\n  const secondarySchoolText = t(\r\n    \"Please choose a second primary element. It will gain identical bonuses to the first.\",\r\n  );\r\n  const showSecondaryElementSelection =\r\n    DualFlexibilityStoryline.isBonusActive(state);\r\n\r\n  useEffect(() => setSelectedSecondaryElement(null), [selectedElement]);\r\n\r\n  const [selectedChallengeId, setSelectedChallengeId] = useState(\r\n    undefined as string | undefined,\r\n  );\r\n  const challenges = getVisibleChallenges(state);\r\n  const showChallenges = challenges.length > 0;\r\n  const selectedChallenge =\r\n    selectedChallengeId != null\r\n      ? Challenges.getById(selectedChallengeId)\r\n      : null;\r\n\r\n  const allowMovingForward =\r\n    selectedElement != null &&\r\n    (!showClassSelection || selectedClassId != null) &&\r\n    (!showSecondaryElementSelection || selectedSecondaryElement != null);\r\n\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  return (\r\n    <View style={[styles.container, width < 600 && { width }]}>\r\n      <View>\r\n        <View>\r\n          <Text h1>{t(\"Welcome to Magic Research 2!\")}</Text>\r\n          <Text style={Styles.mt8}>\r\n            {t(\r\n              \"In Magic Research 2, you are a rookie wizard with a single ambition: to find or create the Philosopher's Stone, a legendary magical item that is said to be able to cure any illness. As you do so, you will learn more than you ever imagined about Magic and about the world around you. What kinds of adventures await you?\",\r\n            )}\r\n          </Text>\r\n          <Text style={Styles.mt8}>\r\n            {t(\r\n              \"Before starting your story, you will need to choose a primary element. While you will need to utilize every element at your disposal to succeed, choosing an element as a primary will make it much easier to become proficient on that element, and might allow you to access some specific content related to that element.\",\r\n            )}\r\n          </Text>\r\n        </View>\r\n        <UtilityCard style={Styles.mt16}>\r\n          <Card.Title title={t(\"Elements\")} accessibilityRole=\"header\" />\r\n          <Card.Content>\r\n            <Markdown>{primarySchoolText}</Markdown>\r\n            <View style={Styles.mt8}>\r\n              <RadioButton.Group\r\n                onValueChange={setSelectedElement}\r\n                value={selectedElement ?? \"\"}\r\n              >\r\n                {elements.map((element, idx) => (\r\n                  <RadioButton.Item\r\n                    value={element}\r\n                    key={element}\r\n                    label={translateElement(element)}\r\n                  />\r\n                ))}\r\n              </RadioButton.Group>\r\n            </View>\r\n            <View style={Styles.mt8}>\r\n              {selectedElement != undefined && (\r\n                <View>\r\n                  <Markdown>{elementDescriptionMap[selectedElement]}</Markdown>\r\n                  {selectedMPL > 0 ? (\r\n                    <Text style={Styles.mt8}>\r\n                      {t(\r\n                        \"Your Maximum Primary Level (MPL) for this element is {{mpl}}.\",\r\n                        { mpl: selectedMPL },\r\n                      )}\r\n                    </Text>\r\n                  ) : (\r\n                    false\r\n                  )}\r\n                </View>\r\n              )}\r\n            </View>\r\n            {showSecondaryElementSelection && selectedElement != undefined && (\r\n              <View style={Styles.mt16}>\r\n                <Markdown>{secondarySchoolText}</Markdown>\r\n                <View style={Styles.mt8}>\r\n                  <RadioButton.Group\r\n                    onValueChange={setSelectedSecondaryElement}\r\n                    value={selectedSecondaryElement ?? \"\"}\r\n                  >\r\n                    {elements\r\n                      .filter((element) => element != selectedElement)\r\n                      .map((element, idx) => (\r\n                        <RadioButton.Item\r\n                          value={element}\r\n                          key={element}\r\n                          label={translateElement(element)}\r\n                        />\r\n                      ))}\r\n                  </RadioButton.Group>\r\n                </View>\r\n                <View style={Styles.mt8}>\r\n                  {selectedSecondaryElement != undefined && (\r\n                    <View>\r\n                      <Markdown>\r\n                        {elementDescriptionMap[selectedSecondaryElement]}\r\n                      </Markdown>\r\n                      {selectedSecondaryMPL > 0 ? (\r\n                        <Text style={Styles.mt8}>\r\n                          {t(\r\n                            \"Your Maximum Primary Level (MPL) for this element is {{mpl}}.\",\r\n                            { mpl: selectedSecondaryMPL },\r\n                          )}\r\n                        </Text>\r\n                      ) : (\r\n                        false\r\n                      )}\r\n                    </View>\r\n                  )}\r\n                </View>\r\n              </View>\r\n            )}\r\n          </Card.Content>\r\n        </UtilityCard>\r\n        {showClassSelection && (\r\n          <UtilityCard style={Styles.mt16}>\r\n            <Card.Title title={t(\"Classes\")} accessibilityRole=\"header\" />\r\n            <Card.Content>\r\n              <Markdown>{t(\"Choose a class.\")}</Markdown>\r\n              <View style={Styles.mt8}>\r\n                <RadioButton.Group\r\n                  onValueChange={setSelectedClassId}\r\n                  value={selectedClassId ?? \"\"}\r\n                >\r\n                  {classes.map((combatClass, idx) => (\r\n                    <RadioButton.Item\r\n                      value={combatClass.getId()}\r\n                      key={combatClass.getId()}\r\n                      label={combatClass.getDisplayName()}\r\n                    />\r\n                  ))}\r\n                </RadioButton.Group>\r\n              </View>\r\n              <View style={Styles.mt8}>\r\n                {selectedClass != null && (\r\n                  <View>\r\n                    <View>\r\n                      <Markdown>\r\n                        {selectedClass.getDisplayDescription(state)}\r\n                      </Markdown>\r\n                    </View>\r\n                    <View>\r\n                      <Markdown>\r\n                        {t(\"Effect: **{{combatClassEffect}}**\", {\r\n                          combatClassEffect:\r\n                            selectedClass.getDisplayEffect(state),\r\n                        })}\r\n                      </Markdown>\r\n                    </View>\r\n                  </View>\r\n                )}\r\n              </View>\r\n            </Card.Content>\r\n          </UtilityCard>\r\n        )}\r\n        {showChallenges && (\r\n          <UtilityCard style={Styles.mt16}>\r\n            <Card.Title title={t(\"Challenges\")} accessibilityRole=\"header\" />\r\n            <Card.Content>\r\n              <Markdown>\r\n                {t(\r\n                  \"You may optionally select a challenge for the current retirement. Challenges strongly increase the difficulty of your journey; however, if you are able to complete them, you will gain permanent bonuses!\",\r\n                )}\r\n              </Markdown>\r\n              <View style={Styles.mt8}>\r\n                <RadioButton.Group\r\n                  onValueChange={setSelectedChallengeId}\r\n                  value={selectedChallengeId ?? \"\"}\r\n                >\r\n                  <RadioButton.Item\r\n                    value={\"\"}\r\n                    key={\"none\"}\r\n                    label={t(\"No Challenge\")}\r\n                  />\r\n                  {challenges.map((challenge, idx) => (\r\n                    <RadioButton.Item\r\n                      value={challenge.getId()}\r\n                      key={challenge.getId()}\r\n                      label={t(\"{{challenge}}{{completed}}\", {\r\n                        challenge: challenge.getName(),\r\n                        completed: challenge.isCompleted(state)\r\n                          ? t(\" (Complete!)\")\r\n                          : \"\",\r\n                      })}\r\n                    />\r\n                  ))}\r\n                </RadioButton.Group>\r\n              </View>\r\n              <View style={Styles.mt8}>\r\n                {selectedChallenge != null && (\r\n                  <View>\r\n                    <View>\r\n                      <Markdown>\r\n                        {t(\"{{description}} **{{effect}}**\", {\r\n                          description: selectedChallenge.getDescription(state),\r\n                          effect: selectedChallenge.getEffect(state),\r\n                        })}\r\n                      </Markdown>\r\n                    </View>\r\n                    <View style={Styles.mt4}>\r\n                      <Markdown>\r\n                        {t(\"To win: **{{objective}}**\", {\r\n                          objective: selectedChallenge.getObjective(state),\r\n                        })}\r\n                      </Markdown>\r\n                    </View>\r\n                    {selectedChallenge.isCompleted(state) && (\r\n                      <View style={Styles.mt4}>\r\n                        <Markdown>\r\n                          {t(\r\n                            \"*You have already completed this Challenge!* It is giving you the following permanent bonus: **{{reward}}**\",\r\n                            {\r\n                              reward: selectedChallenge.getReward(state),\r\n                            },\r\n                          )}\r\n                        </Markdown>\r\n                      </View>\r\n                    )}\r\n                  </View>\r\n                )}\r\n              </View>\r\n            </Card.Content>\r\n          </UtilityCard>\r\n        )}\r\n        <Button\r\n          style={styles.startButton}\r\n          disabled={!allowMovingForward}\r\n          onPress={() => {\r\n            state.apply((state) => {\r\n              state.run.combatClassId = selectedClassId;\r\n              state.run.currentChallengeId = selectedChallengeId;\r\n              state.run.lastProcessedTime = Date.now();\r\n              state = selectPrimaryElement(selectedElement as SpellElement)(\r\n                state,\r\n              );\r\n              if (selectedSecondaryElement != null) {\r\n                state = selectSecondaryElement(\r\n                  selectedSecondaryElement as SpellElement,\r\n                )(state);\r\n              }\r\n              // Grant the starting exp. Must be done after selecting primary elements\r\n              // due to Primary challenge.\r\n              state = grantStartingExp(state);\r\n              state = runGameStartupListeners(state);\r\n              // Clear all caches just in case\r\n              state = clearAllCaches(state);\r\n              return state;\r\n            });\r\n          }}\r\n        >\r\n          {t(\"Start the Game!\")}\r\n        </Button>\r\n        {showLoadGameContainer && (\r\n          <View>\r\n            <Markdown>{loadText}</Markdown>\r\n            <LoadGameContainer style={Styles.mt8} />\r\n          </View>\r\n        )}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n\r\n    maxWidth: 600,\r\n    paddingHorizontal: 16,\r\n    paddingTop: 8,\r\n  },\r\n  buttonGroupText: {\r\n    fontSize: 14,\r\n  },\r\n  startButton: {\r\n    marginVertical: 24,\r\n  },\r\n  mplText: {\r\n    marginTop: 8,\r\n  },\r\n});\r\n","import React, { useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  EquipmentSlot,\r\n  getEquippedExtraSlotItem,\r\n  getEquippedItem,\r\n  getMaxEquippedItemsPerSlot,\r\n  getUnequipAction,\r\n} from \"../../backend/items/Equipment\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { EquippableItem } from \"../../backend/items/equipment/EquippableItem\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemInfo } from \"./ItemInfo\";\r\nimport { ItemTile } from \"./ItemTile\";\r\n\r\nfunction EquippedItemSlot(props: {\r\n  slot: EquipmentSlot;\r\n  position?: number;\r\n  onPressEquippedItem?: (slot: EquipmentSlot) => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const slot = props.slot;\r\n  const position = props.position;\r\n  const equippedItem = getEquippedExtraSlotItem(state, slot, position);\r\n  const actualEquippedItem = getEquippedItem(state, slot, position);\r\n  const unequipAction = getUnequipAction(state, slot, position ?? 0);\r\n\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const item = equippedItem && Items.getById(equippedItem.itemId);\r\n  if (item && !(item instanceof EquippableItem)) {\r\n    throw new Error(\"Only equippable items should be equipped\");\r\n  }\r\n\r\n  const showAsDisabled = equippedItem != actualEquippedItem;\r\n  return useMemo(() => {\r\n    if (!equippedItem) {\r\n      return (\r\n        <View key={slot + position}>\r\n          <ItemTile title={t(\"Empty\")} />\r\n          <Button\r\n            compact={true}\r\n            style={[styles.button, { height: 20 }]}\r\n            labelStyle={{\r\n              marginHorizontal: 0,\r\n              flex: 1,\r\n              marginVertical: 0,\r\n              height: 20,\r\n            }}\r\n            contentStyle={{\r\n              marginHorizontal: 0,\r\n              height: 20,\r\n            }}\r\n            disabled={true}\r\n            onPress={() =>\r\n              unequipAction.transform &&\r\n              stateRef.current.apply(unequipAction.transform)\r\n            }\r\n          >\r\n            {unequipAction.description}\r\n          </Button>\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View key={slot + position}>\r\n        <ItemTile\r\n          icon={(item as EquippableItem).getId()}\r\n          quality={equippedItem?.params?.itemQuality}\r\n          disabled={showAsDisabled}\r\n          title={(item as EquippableItem).getName(equippedItem.params)}\r\n          tooltip={\r\n            <ItemInfo\r\n              showTile={false}\r\n              itemStack={{ itemOccurrence: equippedItem, amount: 1 }}\r\n            />\r\n          }\r\n          tooltipIdSuffix={slot}\r\n        />\r\n        <Button\r\n          compact={true}\r\n          style={[styles.button, { height: 20 }]}\r\n          labelStyle={{\r\n            marginHorizontal: 0,\r\n            flex: 1,\r\n            marginVertical: 0,\r\n            height: 20,\r\n          }}\r\n          contentStyle={{\r\n            marginHorizontal: 0,\r\n            height: 20,\r\n          }}\r\n          disabled={!unequipAction.isEnabled}\r\n          onPress={() =>\r\n            unequipAction.transform &&\r\n            stateRef.current.apply(unequipAction.transform)\r\n          }\r\n        >\r\n          {unequipAction.description}\r\n        </Button>\r\n      </View>\r\n    );\r\n  }, [\r\n    JSON.stringify(equippedItem),\r\n    showAsDisabled,\r\n    slot,\r\n    position,\r\n    unequipAction.description,\r\n    unequipAction.isEnabled,\r\n    unequipAction.transform,\r\n    stateRef,\r\n    item?.getName(equippedItem?.params || {}),\r\n  ]);\r\n}\r\n\r\nexport default function EquippedItems(props: {\r\n  onPressEquippedItem?: (slot: EquipmentSlot) => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const slots = [\r\n    EquipmentSlot.Hand,\r\n    EquipmentSlot.Body,\r\n    EquipmentSlot.Accessory,\r\n  ];\r\n  const slotComponents = slots.map((slot) => {\r\n    const max = getMaxEquippedItemsPerSlot(state, slot);\r\n    const components = [];\r\n    for (let i = 0; i < max; i++) {\r\n      components.push(\r\n        <EquippedItemSlot\r\n          key={slot + i}\r\n          position={i}\r\n          slot={slot as EquipmentSlot}\r\n          onPressEquippedItem={props.onPressEquippedItem}\r\n        />,\r\n      );\r\n    }\r\n    return components;\r\n  });\r\n\r\n  return (\r\n    <View style={Styles.flexRowAlignCenter}>\r\n      <View>\r\n        <Text h4>{t(\"Equip:\")}</Text>\r\n      </View>\r\n      <View\r\n        style={[\r\n          Styles.ml16,\r\n          Styles.flexRowAlignCenter,\r\n          { flex: 1, gap: 4, flexWrap: \"wrap\" },\r\n        ]}\r\n      >\r\n        {slotComponents.flat()}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  equipmentRow: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"flex-start\",\r\n    flex: 1,\r\n  },\r\n  labelStyle: {\r\n    marginHorizontal: 8,\r\n    flex: 1,\r\n  },\r\n  button: {\r\n    height: 20,\r\n  },\r\n});\r\n","import React, { useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  EquipmentSlot,\r\n  getEquippedExtraSlotItem,\r\n  getEquippedItem,\r\n  getMaxEquippedItemsPerSlot,\r\n  getUnequipAction,\r\n} from \"../../backend/items/Equipment\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { EquippableItem } from \"../../backend/items/equipment/EquippableItem\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemInfo } from \"./ItemInfo\";\r\nimport { ItemTile } from \"./ItemTile\";\r\n\r\nfunction EquippedPouchSlot(props: { index: number }) {\r\n  const state = useContext(StateContext);\r\n  const index = props.index;\r\n  const equippedItem = getEquippedExtraSlotItem(\r\n    state,\r\n    EquipmentSlot.Pouch,\r\n    index,\r\n  );\r\n  const actualEquippedItem = getEquippedItem(state, EquipmentSlot.Pouch, index);\r\n  const unequipAction = getUnequipAction(state, EquipmentSlot.Pouch, index);\r\n\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const item = equippedItem && Items.getById(equippedItem.itemId);\r\n  if (item && !(item instanceof EquippableItem)) {\r\n    throw new Error(\"Only equippable items should be equipped\");\r\n  }\r\n\r\n  const showAsDisabled = equippedItem != actualEquippedItem;\r\n\r\n  return useMemo(() => {\r\n    if (!equippedItem) {\r\n      return (\r\n        <View key={index}>\r\n          <ItemTile title={t(\"Empty\")} />\r\n          <Button\r\n            compact={true}\r\n            style={[styles.button, { height: 20 }]}\r\n            labelStyle={{\r\n              marginHorizontal: 0,\r\n              flex: 1,\r\n              marginVertical: 0,\r\n              height: 20,\r\n            }}\r\n            contentStyle={{\r\n              marginHorizontal: 0,\r\n              height: 20,\r\n            }}\r\n            disabled={true}\r\n            onPress={() =>\r\n              unequipAction.transform &&\r\n              stateRef.current.apply(unequipAction.transform)\r\n            }\r\n          >\r\n            {unequipAction.description}\r\n          </Button>\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View key={index}>\r\n        <ItemTile\r\n          icon={(item as EquippableItem).getId()}\r\n          quality={equippedItem?.params?.itemQuality}\r\n          disabled={showAsDisabled}\r\n          title={(item as EquippableItem).getName(equippedItem.params)}\r\n          tooltip={\r\n            <ItemInfo\r\n              showTile={false}\r\n              itemStack={{ itemOccurrence: equippedItem, amount: 1 }}\r\n            />\r\n          }\r\n          tooltipIdSuffix=\"pouch\"\r\n        />\r\n        <Button\r\n          compact={true}\r\n          style={[styles.button, { height: 20 }]}\r\n          labelStyle={{\r\n            marginHorizontal: 0,\r\n            flex: 1,\r\n            marginVertical: 0,\r\n            height: 20,\r\n          }}\r\n          contentStyle={{\r\n            marginHorizontal: 0,\r\n            height: 20,\r\n          }}\r\n          disabled={!unequipAction.isEnabled}\r\n          onPress={() =>\r\n            unequipAction.transform &&\r\n            stateRef.current.apply(unequipAction.transform)\r\n          }\r\n        >\r\n          {unequipAction.description}\r\n        </Button>\r\n      </View>\r\n    );\r\n  }, [\r\n    JSON.stringify(equippedItem),\r\n    showAsDisabled,\r\n    index,\r\n    unequipAction.description,\r\n    unequipAction.isEnabled,\r\n    unequipAction.transform,\r\n    stateRef,\r\n    item?.getName(equippedItem?.params || {}),\r\n  ]);\r\n}\r\n\r\nexport default function EquippedPouch(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const capacity = getMaxEquippedItemsPerSlot(state, EquipmentSlot.Pouch);\r\n  const slotComponents = useMemo(() => {\r\n    let slotComponents = [];\r\n    for (let i = 0; i < capacity; i++) {\r\n      slotComponents.push(<EquippedPouchSlot key={i} index={i} />);\r\n    }\r\n    return slotComponents;\r\n  }, [capacity]);\r\n\r\n  return useMemo(\r\n    () =>\r\n      capacity == 0 ? (\r\n        <View />\r\n      ) : (\r\n        <View style={Styles.flexRowAlignCenter}>\r\n          <View>\r\n            <Text h4>{t(\"Pouch:\")}</Text>\r\n          </View>\r\n          <View\r\n            style={[\r\n              Styles.ml16,\r\n              Styles.flexRowAlignCenter,\r\n              { flex: 1, gap: 4, flexWrap: \"wrap\" },\r\n            ]}\r\n          >\r\n            {slotComponents}\r\n          </View>\r\n        </View>\r\n      ),\r\n    [slotComponents, capacity],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  button: {\r\n    height: 20,\r\n  },\r\n});\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../action/ActionAreas\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"./Building\";\r\n\r\nconst BASE_TIME = 30;\r\nconst saleStallTags = [TransformationTags.TimePerAutoSalePerStall, \"saleStall\"];\r\nfunction getSaleStallSecsPerSale(state: GameState): number {\r\n  return applyTransformations(saleStallTags, state, BASE_TIME);\r\n}\r\nconst secsPerSaleUnit = memoize(() => ({\r\n  unit: t(\" sec\"),\r\n}));\r\nfunction getSaleStallSecsPerSaleExplanation(state: GameState): string {\r\n  return explainTransformationsText(\r\n    saleStallTags,\r\n    state,\r\n    BASE_TIME,\r\n    secsPerSaleUnit(),\r\n  );\r\n}\r\n\r\nclass SaleStall extends Building {\r\n  getId(): string {\r\n    return \"saleStall\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Market Stall\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A public-facing area of your home used to sell things you have marked for sale.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"Sells one item every ^{{amount}}^<{{timeExplanation}}> sec for ^{{multiplier}}x^<{{multiplierExplanation}}> the normal price\",\r\n      {\r\n        amount: formatNumber(getSaleStallSecsPerSale(state), {\r\n          showDecimals: true,\r\n        }),\r\n        timeExplanation: getSaleStallSecsPerSaleExplanation(state),\r\n        multiplier: formatNumber(getSaleStallPriceMultiplier(state), {\r\n          showDecimals: true,\r\n        }),\r\n        multiplierExplanation: getSaleStallPriceMultiplierExplanation(state),\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 3;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nconst saleStall = new SaleStall();\r\n\r\nclass BuildSaleStall extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.OTHER] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return saleStall;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 200,\r\n      AirEssence: 400,\r\n      EarthEssence: 100,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 1.35,\r\n      AirEssence: 1.35,\r\n      EarthEssence: 1.35,\r\n    };\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 10;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return isMarketUnlocked(state) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport function isMarketUnlocked(state: GameState) {\r\n  return hasFlag(state, Flag.SaleStallsUnlocked);\r\n}\r\n\r\nconst saleStallRevenueTags = [TransformationTags.SaleStallRevenue];\r\nexport function getSaleStallPriceMultiplier(state: GameState): number {\r\n  return applyTransformations(saleStallRevenueTags, state, 2.5);\r\n}\r\n\r\nconst multiplierUnit = memoize(() => ({\r\n  unit: t(\"x\"),\r\n}));\r\n\r\nexport function getSaleStallPriceMultiplierExplanation(\r\n  state: GameState,\r\n): string {\r\n  return explainTransformationsText(\r\n    saleStallRevenueTags,\r\n    state,\r\n    2.5,\r\n    multiplierUnit(),\r\n  );\r\n}\r\n\r\nconst buildSaleStall = new BuildSaleStall();\r\n\r\nexport { buildSaleStall as BuildSaleStall, saleStall as SaleStall };\r\n","import { t } from \"../../utils/I18n\";\r\nimport { getBuildingAmountTurnedOn } from \"../buildings/Buildings\";\r\nimport { getSaleStallPriceMultiplier, SaleStall } from \"../buildings/SaleStall\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getAmountOfItem } from \"../items/Inventory\";\r\nimport { ItemOccurrence } from \"../items/Item\";\r\nimport { Items } from \"../items/Items\";\r\nimport { getResourceAmount, getResourceCap, Resource } from \"../Resources\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\n\r\nfunction autosellOneItem(state: GameState): GameState {\r\n  const autosellItemOccurrences = state.run.saleStallItems;\r\n  const currentlyInInventory = autosellItemOccurrences.filter(\r\n    (itemOccurrence) => getAmountOfItem(itemOccurrence, state) > 0,\r\n  );\r\n  const distinctItemCount = currentlyInInventory.length;\r\n  if (distinctItemCount > 0) {\r\n    const selectedItem =\r\n      currentlyInInventory[Math.floor(Math.random() * distinctItemCount)];\r\n    const item = Items.getById(selectedItem.itemId);\r\n    const sellAction = item.getSellOneAction(state, selectedItem.params, [\r\n      TransformationTags.FromSaleStalls,\r\n    ]);\r\n    state = sellAction?.transform?.(state) ?? state;\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function isItemBeingAutosold(state: GameState, item: ItemOccurrence) {\r\n  return (\r\n    state.run.saleStallItems.find(\r\n      (i) =>\r\n        i.itemId == item.itemId &&\r\n        JSON.stringify(i.params) == JSON.stringify(item.params),\r\n    ) != null\r\n  );\r\n}\r\n\r\nexport function toggleItemAutosold(state: GameState, item: ItemOccurrence) {\r\n  if (isItemBeingAutosold(state, item)) {\r\n    state.run.saleStallItems = state.run.saleStallItems.filter(\r\n      (i) =>\r\n        i.itemId != item.itemId ||\r\n        JSON.stringify(i.params) != JSON.stringify(item.params),\r\n    );\r\n  } else {\r\n    state.run.saleStallItems.push(item);\r\n  }\r\n  return state;\r\n}\r\n\r\nexport function disableAllAutosold(state: GameState) {\r\n  state.run.saleStallItems = [];\r\n  return state;\r\n}\r\n\r\nexport function loadMarket() {\r\n  registerTransformation(\r\n    [[TransformationTags.ItemSalePrice, TransformationTags.FromSaleStalls]],\r\n    \"saleStallRevenue\",\r\n    t(\"From Market Stalls\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getSaleStallPriceMultiplier(state),\r\n  );\r\n  const tags = [TransformationTags.TimePerAutoSalePerStall];\r\n  registerTimeTickListener(\"Autosale\", (state, timeElapsedSec, isWarp) => {\r\n    const timePerSale = applyTransformations(tags, state, 60);\r\n    const saleStalls = getBuildingAmountTurnedOn(state, SaleStall);\r\n    if (saleStalls > 0) {\r\n      const previousProgress = state.run.saleStallProgressRatio;\r\n      const additionalProgress = (saleStalls * timeElapsedSec) / timePerSale;\r\n      let totalProgress = previousProgress + additionalProgress;\r\n      while (\r\n        totalProgress >= 1.0 &&\r\n        getResourceAmount(state, Resource.Coins) <\r\n          getResourceCap(state, Resource.Coins)\r\n      ) {\r\n        totalProgress -= 1.0;\r\n        state = autosellOneItem(state);\r\n      }\r\n      state.run.saleStallProgressRatio = Math.min(1.0, totalProgress);\r\n    }\r\n\r\n    return state;\r\n  });\r\n}\r\n","import { t } from \"i18next\";\r\nimport mem from \"mem\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasEverHadFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { getAmountOfItem, removeFromInventory } from \"../Inventory\";\r\nimport { Item, ItemAction, ItemParams } from \"../Item\";\r\nimport { Items } from \"../Items\";\r\nimport { ItemTagEnum } from \"../ItemTagEnum\";\r\nimport { TransmutationSpell } from \"../transmute/TransmutationSpell\";\r\n\r\nconst memoizedPrimary = mem(\r\n  (\r\n    enabled: boolean,\r\n    active: boolean,\r\n    familiarId: string,\r\n    requireConfirm: boolean,\r\n    id: string,\r\n    params: ItemParams,\r\n  ) => {\r\n    return {\r\n      description: t(\"Use\"),\r\n      isEnabled: enabled,\r\n      isActive: active,\r\n      requireConfirm: requireConfirm,\r\n      transform: (state: GameState) => {\r\n        // Re-check enabled\r\n        const item = Items.getById(id) as FamiliarItem;\r\n        const refreshedPrimary = item.getFamiliarAction(\r\n          state,\r\n          params,\r\n          familiarId,\r\n        );\r\n        if (refreshedPrimary?.isEnabled) {\r\n          state = removeFromInventory({ itemId: id, params }, 1, state);\r\n          state.run.lastItemUsedTimes[id] = getSecondsPlayed(state);\r\n          state = (Items.getById(id) as FamiliarItem).doFamiliarItemEffect(\r\n            state,\r\n            params,\r\n            familiarId,\r\n          );\r\n        }\r\n        return state;\r\n      },\r\n    };\r\n  },\r\n  { cacheKey: JSON.stringify },\r\n);\r\n\r\n/**\r\n * A consumable item that requires a familiar.\r\n */\r\nexport abstract class FamiliarItem extends Item {\r\n  abstract doFamiliarItemEffect(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    familiarId: string,\r\n  ): GameState;\r\n\r\n  canUseOnFamiliar(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    familiarId: string,\r\n  ): boolean {\r\n    return true;\r\n  }\r\n\r\n  getFamiliarAction(\r\n    state: GameState,\r\n    params: ItemParams,\r\n    familiarId: string,\r\n  ): ItemAction | undefined {\r\n    const numberInInventory = getAmountOfItem(\r\n      { itemId: this.getId(), params },\r\n      state,\r\n    );\r\n    const active = this.isActive(state);\r\n    const enabled =\r\n      numberInInventory > 0 && this.canUseOnFamiliar(state, params, familiarId);\r\n    return memoizedPrimary(\r\n      enabled,\r\n      active,\r\n      familiarId,\r\n      this.shouldConfirm(),\r\n      this.getId(),\r\n      params,\r\n    );\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Familiar];\r\n  }\r\n\r\n  shouldConfirm(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport abstract class FamiliarTransmutationSpell extends TransmutationSpell {\r\n  abstract getItem(): FamiliarItem;\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      hasEverHadFlag(state, Flag.FamiliarsUnlocked) && super.isVisible(state)\r\n    );\r\n  }\r\n}\r\n","import { useCallback, useContext, useMemo, useRef, useState } from \"react\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { ItemAction } from \"../../backend/items/Item\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActiveMark } from \"../utility/ActiveMark\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport Styles from \"../utility/Styles\";\r\n\r\nexport function ItemDetailsAction(props: {\r\n  action: ItemAction;\r\n  extraOnPress?: () => void;\r\n}) {\r\n  const action = props.action;\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const [pressedOnce, setPressedOnce] = useState(false);\r\n  const onPressCallback = useCallback(() => {\r\n    if (action.requireConfirm && !pressedOnce) {\r\n      setPressedOnce(true);\r\n      return;\r\n    }\r\n    action.transform && stateRef.current.apply(action.transform);\r\n    props.extraOnPress && props.extraOnPress();\r\n  }, [\r\n    action.requireConfirm,\r\n    action.requireConfirm && setPressedOnce,\r\n    action.requireConfirm && pressedOnce,\r\n    action.transform,\r\n    props.extraOnPress,\r\n  ]);\r\n  return useMemo(() => {\r\n    return (\r\n      <Button\r\n        key={action.id}\r\n        icon={\r\n          action.isActive\r\n            ? () => <ActiveMark disabled={!action.isEnabled} />\r\n            : undefined\r\n        }\r\n        disabled={!action.isEnabled}\r\n        style={Styles.mr8}\r\n        enableAutoRepress={true}\r\n        autoRepressConfig={{\r\n          dropoffMultiplier: 0.8,\r\n          startingThreshold: 300,\r\n          startingRepressTime: 200,\r\n          minTimeMs: 50,\r\n        }}\r\n        compact={true}\r\n        onPress={onPressCallback}\r\n        TextComponent={Markdown}\r\n      >\r\n        {action.requireConfirm && pressedOnce\r\n          ? t(\"Press again to confirm\")\r\n          : action.description}\r\n      </Button>\r\n    );\r\n  }, [\r\n    action.id,\r\n    action.description,\r\n    action.isEnabled,\r\n    action.isActive,\r\n    action.requireConfirm,\r\n    action.requireConfirm && pressedOnce,\r\n    onPressCallback,\r\n  ]);\r\n}\r\n","import { useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Surface } from \"react-native-paper\";\r\nimport { Familiars, getFamiliarData } from \"../../backend/familiars/Familiar\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { FamiliarItem } from \"../../backend/items/consumable/FamiliarItem\";\r\nimport { getTotalAmountOfItem } from \"../../backend/items/Inventory\";\r\nimport { keysOf } from \"../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemDetailsAction } from \"./ItemDetailsAction\";\r\n\r\nfunction FamiliarRow(props: {\r\n  familiarId: string;\r\n  item: FamiliarItem;\r\n  params: any;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const familiarData = getFamiliarData(state, props.familiarId);\r\n  const familiar = Familiars.getById(familiarData.familiarClassId);\r\n  const familiarLevel = familiar.getLevel(state, props.familiarId);\r\n\r\n  const familiarAction = props.item.getFamiliarAction(\r\n    state,\r\n    props.params,\r\n    props.familiarId,\r\n  );\r\n  return (\r\n    <Surface mode=\"flat\" key={props.familiarId} style={styles.rowContainer}>\r\n      <View style={Styles.flexRowSpaceBetween}>\r\n        <Text h4 style={Styles.bold}>\r\n          {t(\"{{familiarName}} - Lv{{familiarLevel}}\", {\r\n            familiarName: familiar.getName(),\r\n            familiarLevel: familiarLevel,\r\n          })}\r\n        </Text>\r\n        <View style={Styles.ml16}>\r\n          <ItemDetailsAction action={familiarAction} />\r\n        </View>\r\n      </View>\r\n    </Surface>\r\n  );\r\n}\r\n\r\nexport function ItemFamiliarModalContents(props: {\r\n  onClose: () => void;\r\n  item: FamiliarItem;\r\n  params: any;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const familiarIds = keysOf(state.run.familiars);\r\n  const amount = getTotalAmountOfItem(props.item, state);\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View>\r\n        <View style={Styles.mb8}>\r\n          <Text h3>\r\n            {t(\"Use {{item}} ({{amount}} left) on...\", {\r\n              item: props.item.getName(props.params),\r\n              amount: formatNumber(amount),\r\n            })}\r\n          </Text>\r\n        </View>\r\n        {familiarIds.map((familiarId) => (\r\n          <FamiliarRow\r\n            familiarId={familiarId}\r\n            key={familiarId}\r\n            item={props.item}\r\n            params={props.params}\r\n          />\r\n        ))}\r\n        <View style={Styles.mt8}>\r\n          <Button onPress={props.onClose}>{t(\"Close\")}</Button>\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [familiarIds.join(), props.item, props.params, amount]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  rowContainer: {\r\n    marginVertical: 8,\r\n    padding: 8,\r\n    borderRadius: 8,\r\n  },\r\n});\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Portal, Switch } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  isItemBeingAutosold,\r\n  toggleItemAutosold,\r\n} from \"../../backend/autocast/Market\";\r\nimport { isMarketUnlocked } from \"../../backend/buildings/SaleStall\";\r\nimport {\r\n  ItemAction,\r\n  ItemOccurrence,\r\n  ItemStack,\r\n} from \"../../backend/items/Item\";\r\nimport { Items } from \"../../backend/items/Items\";\r\nimport { FamiliarItem } from \"../../backend/items/consumable/FamiliarItem\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { FullscreenModal } from \"../utility/FullscreenModal\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { ItemDetailsAction } from \"./ItemDetailsAction\";\r\nimport { ItemFamiliarModalContents } from \"./ItemFamiliarModalContents\";\r\nimport { ItemInfo } from \"./ItemInfo\";\r\n\r\nexport interface ItemDetailsProps {\r\n  itemStack: ItemStack;\r\n  selectItem: (item: ItemOccurrence) => void;\r\n  disableSelling?: boolean;\r\n  showQuickbar?: boolean;\r\n}\r\n\r\nexport function ItemDetails(props: ItemDetailsProps) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const { itemId, params } = props.itemStack.itemOccurrence;\r\n  const item = Items.getById(itemId);\r\n  const name = item.getName(params);\r\n  const description = item.getDescription(state, params);\r\n  const effect = item.getEffect(state, params);\r\n\r\n  const isFamiliarItem = item instanceof FamiliarItem;\r\n  const [familiarItemModalVisible, setFamiliarItemModalVisible] =\r\n    useState(false);\r\n  const dismissFamiliarItemModal = useCallback(\r\n    () => setFamiliarItemModalVisible(false),\r\n    [],\r\n  );\r\n  const familiarPrimaryAction = useMemo(\r\n    () => ({\r\n      id: \"familiarPrimary\",\r\n      description: t(\"Use\"),\r\n      isEnabled: true,\r\n      transform: (state) => {\r\n        setFamiliarItemModalVisible(true);\r\n        return state;\r\n      },\r\n    }),\r\n    [setFamiliarItemModalVisible],\r\n  );\r\n\r\n  const disableSelling =\r\n    props.disableSelling || item.getBaseSalePrice(state, params) == 0;\r\n\r\n  const primaryAction: ItemAction = isFamiliarItem\r\n    ? familiarPrimaryAction\r\n    : item.getPrimaryAction(state, params);\r\n  const saleActions = disableSelling\r\n    ? undefined\r\n    : item.getSaleActions(state, params);\r\n  const quickbarAction = props.showQuickbar\r\n    ? item.getQuickbarAction(state, params)\r\n    : undefined;\r\n  const combineActions = props.disableSelling\r\n    ? undefined\r\n    : item.getCombineActions(state, params);\r\n  const extraActions = item.getExtraActions(state, params);\r\n\r\n  const onCombineAllExtraPress = useCallback(() => {\r\n    const newQuality =\r\n      (props.itemStack.itemOccurrence.params.itemQuality ?? 0) + 1;\r\n    const newOccurrence = {\r\n      itemId: props.itemStack.itemOccurrence.itemId,\r\n      params: {\r\n        ...props.itemStack.itemOccurrence.params,\r\n        itemQuality: newQuality,\r\n      },\r\n    };\r\n    props.selectItem(newOccurrence);\r\n  }, [props.itemStack.itemOccurrence, props.selectItem]);\r\n\r\n  const actions = [\r\n    { action: primaryAction },\r\n    ...(saleActions?.map((saleAction) => ({ action: saleAction })) ?? []),\r\n    { action: quickbarAction },\r\n    ...(combineActions?.map((combineAction, idx) => ({\r\n      action: combineAction,\r\n      extraPress: idx == combineActions.length - 1 && onCombineAllExtraPress,\r\n    })) ?? []),\r\n    ...(extraActions?.map((action) => ({ action: action })) ?? []),\r\n  ].filter((action) => action.action != undefined) as {\r\n    action: ItemAction;\r\n    requireConfirm?: boolean;\r\n    extraPress?: () => void;\r\n  }[];\r\n\r\n  const itemInfo = useMemo(() => {\r\n    return <ItemInfo itemStack={props.itemStack} showTile={true} />;\r\n  }, [JSON.stringify(props.itemStack)]);\r\n\r\n  const onAutosoldPress = useCallback(() => {\r\n    stateRef.current.apply((s) =>\r\n      toggleItemAutosold(s, props.itemStack.itemOccurrence),\r\n    );\r\n  }, [props.itemStack.itemOccurrence]);\r\n\r\n  return (\r\n    <View style={styles.itemDetailsContainer}>\r\n      {itemInfo}\r\n      {isMarketUnlocked(state) && !disableSelling && (\r\n        <View style={[Styles.mt8, Styles.flexRowAlignCenter, Styles.flex]}>\r\n          <Text>{t(\"Sell automatically through Market Stalls\")}</Text>\r\n          <Switch\r\n            style={Styles.ml8}\r\n            value={isItemBeingAutosold(state, props.itemStack.itemOccurrence)}\r\n            onValueChange={onAutosoldPress}\r\n          />\r\n        </View>\r\n      )}\r\n      <View style={styles.actionRow}>\r\n        {actions.map((action) => (\r\n          <ItemDetailsAction\r\n            key={action.action.id}\r\n            action={action.action}\r\n            extraOnPress={action.extraPress}\r\n          />\r\n        ))}\r\n      </View>\r\n      {isFamiliarItem && (\r\n        <Portal>\r\n          <FullscreenModal\r\n            visible={familiarItemModalVisible}\r\n            onDismiss={dismissFamiliarItemModal}\r\n          >\r\n            <ItemFamiliarModalContents\r\n              item={item as FamiliarItem}\r\n              onClose={dismissFamiliarItemModal}\r\n              params={params}\r\n            />\r\n          </FullscreenModal>\r\n        </Portal>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  itemDetailsContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  actionRow: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    marginTop: 8,\r\n    rowGap: 8,\r\n  },\r\n  actionButtonContainer: {\r\n    marginRight: 8,\r\n  },\r\n});\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { Menu } from \"react-native-paper\";\r\nimport { memoizeWithLimit } from \"sonic-memoize\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { disableAllAutosold } from \"../../backend/autocast/Market\";\r\nimport { isMarketUnlocked } from \"../../backend/buildings/SaleStall\";\r\nimport {\r\n  getAmountOfItem,\r\n  getItemStackFromInventory,\r\n  isItemOccurrenceEqual,\r\n} from \"../../backend/items/Inventory\";\r\nimport {\r\n  ItemOccurrence,\r\n  ItemTag,\r\n  translateItemTag,\r\n} from \"../../backend/items/Item\";\r\nimport { ItemTagEnum } from \"../../backend/items/ItemTagEnum\";\r\nimport {\r\n  Items,\r\n  combineAll,\r\n  isItemQualityUnlocked,\r\n  sellLowQualityItems,\r\n} from \"../../backend/items/Items\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ITEM_TAG_ORDER } from \"../Transmute\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { Picker as UtilityPicker } from \"../utility/Picker\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"../utility/UIContext\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\nimport { ItemDetails } from \"./ItemDetails\";\r\nimport { ItemGrid, ItemGridElement } from \"./ItemGrid\";\r\n\r\nconst itemFilterer = (selectedTag, itemStack) =>\r\n  selectedTag === \"All\" ||\r\n  Items.getById(itemStack.itemOccurrence.itemId)\r\n    .getTags()\r\n    .includes(selectedTag);\r\n\r\nconst itemSorter = (a, b) => {\r\n  const itemA = Items.getById(a.itemOccurrence.itemId);\r\n  const itemB = Items.getById(b.itemOccurrence.itemId);\r\n  for (let tag of ITEM_TAG_ORDER) {\r\n    if (itemA.getTags().includes(tag) && !itemB.getTags().includes(tag)) {\r\n      return -1;\r\n    }\r\n    if (itemB.getTags().includes(tag) && !itemA.getTags().includes(tag)) {\r\n      return 1;\r\n    }\r\n  }\r\n  if (itemA == itemB) {\r\n    return (\r\n      (b.itemOccurrence.params.itemQuality ?? 0) -\r\n      (a.itemOccurrence.params.itemQuality ?? 0)\r\n    );\r\n  }\r\n  return (\r\n    Items.getNumericId(a.itemOccurrence.itemId) -\r\n    Items.getNumericId(b.itemOccurrence.itemId)\r\n  );\r\n};\r\n\r\nconst getItemGridElement = memoizeWithLimit(\r\n  (itemId, amount, params, disableTooltip) => ({\r\n    itemOrSpellId: itemId,\r\n    amount: amount,\r\n    params: JSON.parse(params),\r\n    disableTooltip,\r\n  }),\r\n  10000,\r\n);\r\n\r\nexport default function InventoryItems(props: {\r\n  disableSelling?: boolean;\r\n  showQuickbar?: boolean;\r\n  showExtraActions?: boolean;\r\n  isFullBleed?: boolean;\r\n  overrideMaxHeight?: number;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const uiContext = useContext(UIContext);\r\n  const [selectedTagString, setSelectedTag] = useUIStateFromContext(\r\n    uiContext,\r\n    \"InventoryTag\",\r\n    \"All\",\r\n  );\r\n  const selectedTag = selectedTagString as ItemTagEnum | \"All\";\r\n  const [selectedItem, setSelectedItem] = useState(\r\n    null as ItemOccurrence | null,\r\n  );\r\n  const inventory = state.run.inventory;\r\n\r\n  const tagSet = new Set<string>();\r\n  inventory.forEach((itemStack) => {\r\n    const tags = Items.getById(itemStack.itemOccurrence.itemId).getTags();\r\n    tags.forEach((tag) => tagSet.add(tag));\r\n  });\r\n  const tags = Array.from(tagSet).sort((a, b) => {\r\n    const indexA = ITEM_TAG_ORDER.findIndex((tag) => tag == a);\r\n    const indexB = ITEM_TAG_ORDER.findIndex((tag) => tag == b);\r\n    return indexA - indexB;\r\n  });\r\n  useEffect(() => {\r\n    if (!tags.includes(selectedTag)) {\r\n      setSelectedTag(\"All\");\r\n    }\r\n  }, [tags.join(), selectedTag]);\r\n\r\n  const tagButtons = useMemo(() => {\r\n    return (\r\n      <UtilityPicker\r\n        onValueChange={setSelectedTag}\r\n        selectedValue={selectedTag}\r\n        data={[\"All\", ...tags].map((tag) => ({\r\n          label: tag == \"All\" ? t(\"All\") : translateItemTag(tag as ItemTag),\r\n          value: tag,\r\n          key: tag,\r\n        }))}\r\n        disablePlaceholder={true}\r\n      />\r\n    );\r\n  }, [setSelectedTag, selectedTag, JSON.stringify(tags)]);\r\n\r\n  const sortedInventory = inventory\r\n    .filter(itemFilterer.bind(null, selectedTag))\r\n    .sort(itemSorter);\r\n\r\n  useEffect(() => {\r\n    if (selectedItem != null) {\r\n      const paramsJSON = JSON.stringify(selectedItem.params);\r\n      if (\r\n        !sortedInventory.some(\r\n          (itemStack) =>\r\n            itemStack.itemOccurrence.itemId == selectedItem.itemId &&\r\n            JSON.stringify(itemStack.itemOccurrence.params) == paramsJSON,\r\n        )\r\n      ) {\r\n        setSelectedItem(null);\r\n      }\r\n    }\r\n  }, [selectedTag]);\r\n\r\n  const itemGridElements = sortedInventory.map((itemStack, index) => {\r\n    return getItemGridElement(\r\n      itemStack.itemOccurrence.itemId,\r\n      itemStack.amount,\r\n      JSON.stringify(itemStack.itemOccurrence.params),\r\n      isItemOccurrenceEqual(itemStack.itemOccurrence, selectedItem),\r\n    );\r\n  });\r\n\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setSelectedItem(null);\r\n    }\r\n  }, [visible]);\r\n\r\n  useEffect(() => {\r\n    if (visible && selectedItem != null) {\r\n      if (getAmountOfItem(selectedItem, state) <= 0) {\r\n        setSelectedItem(null);\r\n      }\r\n    }\r\n  }, [selectedItem, visible, state]);\r\n\r\n  const itemDetails = selectedItem != null &&\r\n    getItemStackFromInventory(state, selectedItem) != null && (\r\n      <ItemDetails\r\n        disableSelling={props.disableSelling}\r\n        showQuickbar={props.showQuickbar}\r\n        itemStack={getItemStackFromInventory(state, selectedItem)}\r\n        selectItem={setSelectedItem}\r\n      />\r\n    );\r\n\r\n  const sortedInventoryRef = useRef(sortedInventory);\r\n  sortedInventoryRef.current = sortedInventory;\r\n\r\n  const onPressItem = React.useCallback(\r\n    (item: ItemGridElement) => {\r\n      setSelectedItem({ itemId: item.itemOrSpellId, params: item.params });\r\n    },\r\n    [setSelectedItem],\r\n  );\r\n\r\n  const onDoublePressItem = React.useCallback((item: ItemGridElement) => {\r\n    stateRef.current.apply((state) => {\r\n      const selectedItem = { itemId: item.itemOrSpellId, params: item.params };\r\n      if (selectedItem?.itemId != null) {\r\n        const item = Items.getById(selectedItem.itemId);\r\n        const primaryAction = item?.getPrimaryAction(\r\n          state,\r\n          selectedItem.params,\r\n        );\r\n        if (primaryAction != null && primaryAction?.isEnabled) {\r\n          const transform = primaryAction.transform;\r\n          return transform != null ? transform(state) : state;\r\n        }\r\n      }\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const itemGrid = useMemo(\r\n    () => (\r\n      <ItemGrid\r\n        items={itemGridElements}\r\n        onPressItem={onPressItem}\r\n        onDoublePressItem={onDoublePressItem}\r\n        overrideMaxHeight={props.overrideMaxHeight}\r\n      />\r\n    ),\r\n    [\r\n      JSON.stringify(itemGridElements),\r\n      onPressItem,\r\n      onDoublePressItem,\r\n      props.overrideMaxHeight,\r\n    ],\r\n  );\r\n\r\n  const [menuVisible, setMenuVisible] = useState(false);\r\n  const toggleMenuVisible = useCallback(\r\n    () => setMenuVisible(!menuVisible),\r\n    [menuVisible, setMenuVisible],\r\n  );\r\n\r\n  const menuButton = useMemo(\r\n    () => (\r\n      <Button compact={true} onPress={toggleMenuVisible}>\r\n        {t(\"More actions...\")}\r\n      </Button>\r\n    ),\r\n    [toggleMenuVisible],\r\n  );\r\n  const combineAllAction = useMemo(\r\n    () => (\r\n      <Menu.Item\r\n        key=\"combineAll\"\r\n        title={t(\"Combine all\")}\r\n        onPress={() => {\r\n          stateRef.current.apply(combineAll);\r\n          setMenuVisible(false);\r\n        }}\r\n      />\r\n    ),\r\n    [setMenuVisible],\r\n  );\r\n  const sellLowQualityAction = useMemo(\r\n    () => (\r\n      <Menu.Item\r\n        key=\"sellLowQuality\"\r\n        title={t(\"Sell low quality items\")}\r\n        onPress={() => {\r\n          stateRef.current.apply(sellLowQualityItems);\r\n          setMenuVisible(false);\r\n        }}\r\n      />\r\n    ),\r\n    [setMenuVisible],\r\n  );\r\n  const removeAllFromSaleStallsAction = useMemo(\r\n    () => (\r\n      <Menu.Item\r\n        key=\"removeAllFromSaleStalls\"\r\n        title={t(\"Clear market stall marks\")}\r\n        onPress={() => {\r\n          stateRef.current.apply(disableAllAutosold);\r\n          setMenuVisible(false);\r\n        }}\r\n      />\r\n    ),\r\n    [setMenuVisible],\r\n  );\r\n  const menuDismiss = useCallback(\r\n    () => setMenuVisible(false),\r\n    [setMenuVisible],\r\n  );\r\n  const menuActions = useMemo(() => {\r\n    const menuActions = [];\r\n    if (isItemQualityUnlocked(state)) {\r\n      menuActions.push(combineAllAction);\r\n      menuActions.push(sellLowQualityAction);\r\n    }\r\n    if (isMarketUnlocked(state)) {\r\n      menuActions.push(removeAllFromSaleStallsAction);\r\n    }\r\n    return menuActions;\r\n  }, [combineAllAction, sellLowQualityAction, isItemQualityUnlocked(state)]);\r\n\r\n  const menu = useMemo(\r\n    () =>\r\n      menuActions.length > 0 &&\r\n      props.showExtraActions && (\r\n        <Menu visible={menuVisible} anchor={menuButton} onDismiss={menuDismiss}>\r\n          {menuActions}\r\n        </Menu>\r\n      ),\r\n    [props.showExtraActions, menuActions, menuVisible, menuButton, menuDismiss],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (inventory.length == 0) {\r\n      return (\r\n        <View style={Styles.p8}>\r\n          <Text style={{ fontStyle: \"italic\" }}>\r\n            {t(\"You are not holding any items yet!\")}\r\n          </Text>\r\n        </View>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <View>\r\n        <View style={[Styles.mb8, Styles.ml8, Styles.flexRowSpaceBetween]}>\r\n          <View style={styles.tagPickerContainer}>{tagButtons}</View>\r\n          {menu}\r\n        </View>\r\n        {itemGrid}\r\n        <View\r\n          style={[\r\n            styles.detailsContainer,\r\n            props.isFullBleed && styles.detailsContainerPadding,\r\n          ]}\r\n        >\r\n          {itemDetails}\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [\r\n    inventory.length,\r\n    tagButtons,\r\n    menu,\r\n    itemGrid,\r\n    itemDetails,\r\n    props.isFullBleed,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  detailsContainer: {\r\n    marginTop: 18,\r\n  },\r\n  detailsContainerPadding: {\r\n    paddingHorizontal: 8,\r\n    paddingBottom: 8,\r\n  },\r\n  tagPickerContainer: {\r\n    width: 180,\r\n    ...Platform.select({\r\n      android: { backgroundColor: \"#eee\", borderRadius: 10, default: {} },\r\n    }),\r\n  },\r\n});\r\n","import React from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { EquipmentSetButtons } from \"./inventory/EquipmentSetButtons\";\r\nimport EquippedItems from \"./inventory/EquippedItems\";\r\nimport EquippedPouch from \"./inventory/EquippedPouch\";\r\nimport InventoryItems from \"./inventory/InventoryItems\";\r\nimport Styles from \"./utility/Styles\";\r\n\r\nexport default function Inventory() {\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.fullBleedPadding}>\r\n        <View style={styles.equippedItemsContainer}>\r\n          <EquippedItems />\r\n        </View>\r\n        <View style={Styles.mb16}>\r\n          <EquippedPouch />\r\n        </View>\r\n        <View style={styles.equipmentSetButtonsRow}>\r\n          <EquipmentSetButtons />\r\n        </View>\r\n      </View>\r\n      <InventoryItems isFullBleed={true} showExtraActions={true} />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  topRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginBottom: 16,\r\n    height: 48,\r\n  },\r\n  arrowBack: {\r\n    marginRight: 8,\r\n  },\r\n  equippedItemsContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  row: {\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  topButtons: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  craftButton: {\r\n    marginLeft: 16,\r\n  },\r\n  fullBleedPadding: {\r\n    paddingHorizontal: 8,\r\n    marginTop: 8,\r\n  },\r\n  equipmentSetButtonsRow: {\r\n    marginBottom: 16,\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n});\r\n","export function OrientationLockManager() {\r\n  // Do not lock anything on web\r\n  return null;\r\n}\r\n","import { StatusBar } from \"expo-status-bar\";\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport {\r\n  ActivityIndicator,\r\n  Animated,\r\n  Easing,\r\n  Platform,\r\n  SafeAreaView,\r\n  StyleSheet,\r\n  View,\r\n} from \"react-native\";\r\nimport { MD3Theme, Provider as PaperProvider } from \"react-native-paper\";\r\nimport {\r\n  SafeAreaProvider,\r\n  initialWindowMetrics,\r\n} from \"react-native-safe-area-context\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { OrientationLockManager } from \"../utils/OrientationLockManager\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nexport function Loading(props: { theme: MD3Theme }) {\r\n  const theme = props.theme;\r\n\r\n  const loadingAnim = useRef(new Animated.Value(0.0)).current;\r\n\r\n  useEffect(() => {\r\n    Animated.timing(loadingAnim, {\r\n      useNativeDriver: true,\r\n      toValue: 400,\r\n      duration: 60000,\r\n      easing: Easing.out(Easing.poly(5)),\r\n    }).start();\r\n  }, []);\r\n\r\n  return (\r\n    <SafeAreaProvider initialMetrics={initialWindowMetrics}>\r\n      <PaperProvider theme={theme}>\r\n        <OrientationLockManager />\r\n        <StatusBar style={theme.dark ? \"light\" : \"dark\"} />\r\n        <SafeAreaView\r\n          style={[\r\n            styles.safeAreaContainer,\r\n            {\r\n              backgroundColor: theme.colors.background,\r\n            },\r\n          ]}\r\n        >\r\n          <View style={{ alignItems: \"center\", width: \"100%\" }}>\r\n            <ActivityIndicator size=\"large\" />\r\n            {Platform.OS != \"web\" && (\r\n              <View\r\n                style={{\r\n                  width: 200,\r\n                  marginVertical: 8,\r\n                  borderWidth: 1,\r\n                  borderRadius: 3,\r\n                  height: 6,\r\n                  overflow: \"hidden\",\r\n                  borderColor: theme.colors.primary,\r\n                }}\r\n              >\r\n                <Animated.View\r\n                  style={{\r\n                    height: 4,\r\n                    width: 1,\r\n                    transform: [{ scaleX: loadingAnim }],\r\n                    backgroundColor: theme.colors.primary,\r\n                  }}\r\n                />\r\n              </View>\r\n            )}\r\n            <Text\r\n              style={{\r\n                color: theme.colors.onBackground,\r\n              }}\r\n            >\r\n              {t(\"Loading game. Please wait a moment...\")}\r\n            </Text>\r\n          </View>\r\n        </SafeAreaView>\r\n      </PaperProvider>\r\n    </SafeAreaProvider>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  safeAreaContainer: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n  },\r\n});\r\n","import { useContext, useEffect } from \"react\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { electron, isElectron } from \"./ElectronUtils\";\r\n\r\nexport const ZOOM_SUPPORTED = isElectron();\r\n\r\nexport function ZoomChecker() {\r\n  if (!isElectron()) {\r\n    return null;\r\n  }\r\n\r\n  const state = useContext(StateContext);\r\n\r\n  useEffect(() => {\r\n    electron().webFrame.setZoomFactor(state.options.zoomLevel);\r\n  }, [state.options.zoomLevel]);\r\n\r\n  return null;\r\n}\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport * as Clipboard from \"expo-clipboard\";\r\nimport React, {\r\n  RefObject,\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport {\r\n  Platform,\r\n  StyleSheet,\r\n  TouchableWithoutFeedback,\r\n  View,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\nimport DraggableFlatList, {\r\n  DragEndParams,\r\n  RenderItemParams,\r\n  ScaleDecorator,\r\n} from \"react-native-draggable-flatlist\";\r\nimport { TextInput, useTheme } from \"react-native-paper\";\r\nimport { Flag } from \"../backend/Flag\";\r\nimport { hasFlag } from \"../backend/Flags\";\r\nimport {\r\n  GameStateValue,\r\n  INITIAL_STATE,\r\n  StateContext,\r\n} from \"../backend/GameState\";\r\nimport { serializeSaveData } from \"../backend/SaveData\";\r\nimport { EventTag } from \"../backend/events/GameEvent\";\r\nimport {\r\n  SpellElement,\r\n  getFullyUnlockedElements,\r\n  translateElement,\r\n} from \"../backend/spells/Elements\";\r\nimport { clone } from \"../utils/CoreUtils\";\r\nimport {\r\n  LOAD_FROM_FILE_SUPPORTED,\r\n  SAVE_TO_FILE_SUPPORTED,\r\n  loadTranslationsFromFile,\r\n  saveToFile,\r\n} from \"../utils/FilesystemSave\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { Storage } from \"../utils/Storage\";\r\nimport { ZOOM_SUPPORTED } from \"../utils/Zoom\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { CheckBox } from \"./utility/CheckBox\";\r\nimport LoadGameContainer from \"./utility/LoadGameContainer\";\r\nimport {\r\n  DEFAULT_SECTION_ORDER,\r\n  getAllMenuItems,\r\n  getSectionInfo,\r\n} from \"./utility/Miscellaneous\";\r\nimport { Picker as UtilityPicker } from \"./utility/Picker\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { GameIcon } from \"./utility/icons/GameIcon\";\r\n\r\nconst FPS_DATA = [\"10\", \"12\", \"15\", \"20\", \"24\", \"30\", \"40\", \"50\", \"60\"].map(\r\n  (x) => ({ label: x, key: x, value: x }),\r\n);\r\n\r\nconst ZOOM_DATA = [\r\n  0.5, 0.6, 0.7, 0.8, 0.85, 0.9, 0.95, 0.98, 1.0, 1.02, 1.05, 1.1, 1.151, 1.2,\r\n  1.25, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.25, 2.5, 2.75, 3.0,\r\n].map((x) => ({\r\n  label: formatNumber(x, { showDecimals: true }) + \"x\",\r\n  key: x.toString(),\r\n  value: x.toString(),\r\n}));\r\n\r\nfunction useEventTagToggle(stateRef: RefObject<GameStateValue>, tag: EventTag) {\r\n  return useCallback(() => {\r\n    stateRef.current?.apply((oldState) => {\r\n      if (oldState.options.hideEventTags.includes(tag)) {\r\n        oldState.options.hideEventTags.splice(\r\n          oldState.options.hideEventTags.findIndex(\r\n            (innerTag) => innerTag === tag,\r\n          ),\r\n          1,\r\n        );\r\n      } else {\r\n        oldState.options.hideEventTags.push(tag);\r\n      }\r\n      return oldState;\r\n    });\r\n  }, []);\r\n}\r\n\r\nfunction useHiddenFromBottomMenuToggle(\r\n  stateRef: RefObject<GameStateValue>,\r\n  section: string,\r\n) {\r\n  return useCallback(() => {\r\n    stateRef.current?.apply((oldState) => {\r\n      if (oldState.options.hiddenFromBottomMenu.includes(section)) {\r\n        oldState.options.hiddenFromBottomMenu.splice(\r\n          oldState.options.hiddenFromBottomMenu.findIndex(\r\n            (innerSection) => innerSection === section,\r\n          ),\r\n          1,\r\n        );\r\n      } else {\r\n        oldState.options.hiddenFromBottomMenu.push(section);\r\n      }\r\n      return oldState;\r\n    });\r\n  }, []);\r\n}\r\n\r\nfunction BottomMenuToggle(props: { section: string }) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const onPress = useHiddenFromBottomMenuToggle(stateRef, props.section);\r\n\r\n  const title = useMemo(\r\n    () => (\r\n      <View style={styles.toggleMenuRow}>\r\n        <GameIcon icon={props.section.toLowerCase()} small />\r\n        <View style={styles.toggleMenuTextContainer}>\r\n          <Text>{getSectionInfo(props.section).name}</Text>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [props.section],\r\n  );\r\n\r\n  return (\r\n    <View style={[Styles.mt8, Styles.mr8]}>\r\n      <CheckBox\r\n        title={title}\r\n        checked={!state.options.hiddenFromBottomMenu.includes(props.section)}\r\n        onPress={onPress}\r\n        containerStyle={styles.toggleMenuCheckboxContainer}\r\n      />\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction MenuSection(props: { drag: () => void; section: string }) {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n  const sectionInfo = getSectionInfo(props.section);\r\n\r\n  const visible =\r\n    sectionInfo == null ? false : sectionInfo?.isVisible?.(state) ?? true;\r\n  const title = sectionInfo?.name;\r\n\r\n  return useMemo(\r\n    () =>\r\n      visible && (\r\n        <ScaleDecorator>\r\n          <View style={Styles.flexRowAlignCenter}>\r\n            <View\r\n              importantForAccessibility=\"no-hide-descendants\"\r\n              accessibilityElementsHidden={true}\r\n              style={styles.dragHandle}\r\n            >\r\n              <TouchableWithoutFeedback\r\n                onPressIn={props.drag}\r\n                hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}\r\n                importantForAccessibility=\"no-hide-descendants\"\r\n                accessibilityElementsHidden={true}\r\n              >\r\n                <MaterialIcons\r\n                  name=\"drag-indicator\"\r\n                  size={24}\r\n                  color={theme.colors.onSecondaryContainer}\r\n                />\r\n              </TouchableWithoutFeedback>\r\n            </View>\r\n            <View style={[Styles.flex, Styles.flexRowAlignCenter]}>\r\n              {sectionInfo != null && (\r\n                <GameIcon icon={props.section.toLowerCase()} />\r\n              )}\r\n              <View style={[Styles.flex, Styles.ml16]}>\r\n                <Text>{title}</Text>\r\n              </View>\r\n            </View>\r\n          </View>\r\n        </ScaleDecorator>\r\n      ),\r\n    [props.drag, theme, title, visible],\r\n  );\r\n}\r\n\r\nfunction MenuSectionsOrder(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const renderItem = useCallback(\r\n    ({ item, getIndex, drag, isActive }: RenderItemParams<string>) => (\r\n      <MenuSection drag={drag} section={item} />\r\n    ),\r\n    [],\r\n  );\r\n  const keyExtractor = useCallback((section: string) => section, []);\r\n  const onDragEnd = useCallback((params: DragEndParams<string>) => {\r\n    stateRef.current.apply((state) => {\r\n      state.options.sectionOrder = params.data;\r\n      return state;\r\n    });\r\n  }, []);\r\n\r\n  const data =\r\n    state.options.sectionOrder.length > 0\r\n      ? state.options.sectionOrder\r\n      : DEFAULT_SECTION_ORDER;\r\n\r\n  return (\r\n    <DraggableFlatList\r\n      renderItem={renderItem}\r\n      data={data}\r\n      keyExtractor={keyExtractor}\r\n      onDragEnd={onDragEnd}\r\n      nestedScrollEnabled={true}\r\n    />\r\n  );\r\n}\r\n\r\nexport default function Options() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const [copyToClipboardError, setCopyToClipboardError] = useState(null);\r\n\r\n  const copyToClipboard = useCallback(async () => {\r\n    const serializedData = await serializeSaveData(stateRef.current);\r\n    await Clipboard.setStringAsync(serializedData);\r\n\r\n    if (Platform.OS == \"android\" || Platform.OS == \"ios\") {\r\n      const savedData = await Clipboard.getStringAsync();\r\n      if (savedData != serializedData) {\r\n        setCopyToClipboardError(\r\n          t(\"Warning: save did not copy to clipboard correctly!\"),\r\n        );\r\n      } else {\r\n        setCopyToClipboardError(null);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const targetFpsChange = useCallback((value: string) => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.targetFps = Number.parseInt(value);\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const zoomChange = useCallback((value: string) => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.zoomLevel = Number.parseFloat(value);\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const elementOverrideChange = useCallback((value: string) => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.overrideElementDisplay = value as SpellElement | \"no\";\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const elementOptions = [\r\n    {\r\n      label: t(\"Primary Element\"),\r\n      key: \"no\",\r\n      value: \"no\",\r\n    },\r\n    ...getFullyUnlockedElements(state).map((x) => ({\r\n      label: translateElement(x),\r\n      key: x,\r\n      value: x,\r\n    })),\r\n  ];\r\n\r\n  const hideBottomResourceViewerToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.hideBottomResourceViewer =\r\n        !oldState.options.hideBottomResourceViewer;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const hideDamageEffectsToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.hideDamageEffects = !oldState.options.hideDamageEffects;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const doNotUseNativeDriverToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.doNotUseNativeDriver =\r\n        !oldState.options.doNotUseNativeDriver;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const darkModeToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.themeMode =\r\n        oldState.options.themeMode === \"dark\" ? \"light\" : \"dark\";\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const colorSpellToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.colorSpellButtonsByElement =\r\n        !oldState.options.colorSpellButtonsByElement;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const compactUIToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.compactUI = !oldState.options.compactUI;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const expandedUIToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.saveExpandedUI = !oldState.options.saveExpandedUI;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const hideTooltipsToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.hideTooltips = !oldState.options.hideTooltips;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const wakeLockCallback = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.wakeLock = !oldState.options.wakeLock;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const enableBottomMenuCallback = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.enableBottomMenu = !oldState.options.enableBottomMenu;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const leftHandedModeCallback = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.leftHandedMode = !oldState.options.leftHandedMode;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const putCastSpellOnBottomMenuCallback = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.putCastSpellOnBottomMenu =\r\n        !oldState.options.putCastSpellOnBottomMenu;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const doNotShowEventsCallback = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.doNotShowEventsOnWideScreens =\r\n        !oldState.options.doNotShowEventsOnWideScreens;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const eventTagLevelUpAlreadyReachedToggle = useEventTagToggle(\r\n    stateRef,\r\n    EventTag.LEVEL_UP_ALREADY_REACHED,\r\n  );\r\n  const eventTagLevelUpEmptyToggle = useEventTagToggle(\r\n    stateRef,\r\n    EventTag.LEVEL_UP_EMPTY,\r\n  );\r\n  const eventTagLevelUpAllToggle = useEventTagToggle(\r\n    stateRef,\r\n    EventTag.LEVEL_UP,\r\n  );\r\n  const eventTagInconsequentialRandomEventsToggle = useEventTagToggle(\r\n    stateRef,\r\n    EventTag.INCONSEQUENTIAL_RANDOM_EVENT,\r\n  );\r\n  const eventTagMainQuestSeenBeforeEventsToggle = useEventTagToggle(\r\n    stateRef,\r\n    EventTag.MAIN_QUEST_SEEN_BEFORE,\r\n  );\r\n  const eventTagBossFightToggle = useCallback(() => {\r\n    stateRef.current.apply((oldState) => {\r\n      oldState.options.doNotPopupEventsDuringBossFights =\r\n        !oldState.options.doNotPopupEventsDuringBossFights;\r\n      return oldState;\r\n    });\r\n  }, []);\r\n\r\n  const [eraseText, setEraseText] = useState(\"\");\r\n  const eraseGame = useCallback(() => {\r\n    stateRef.current.overwrite((state) => {\r\n      return clone(INITIAL_STATE);\r\n    });\r\n    AsyncStorage.removeItem(\"MR2.GameState\");\r\n    AsyncStorage.removeItem(\"MR2.LastSaveSecondsPlayed\");\r\n  }, []);\r\n\r\n  const theme = useTheme();\r\n\r\n  const loadText = LOAD_FROM_FILE_SUPPORTED\r\n    ? t(\r\n        \"You may import save data by loading it from a file, or by pasting it here.\",\r\n      )\r\n    : t(\"You may import save data by pasting it here.\");\r\n\r\n  const saveToFileCallback = useCallback(async () => {\r\n    const result = await saveToFile(stateRef.current);\r\n  }, []);\r\n\r\n  const hasTranslations = Storage.getString(\"uploadedTranslationsJSON\") != null;\r\n\r\n  const [translationMessage, setTranslationMessage] = useState(\"\");\r\n\r\n  const importTranslationFileCallback = useCallback(async () => {\r\n    try {\r\n      const result = await loadTranslationsFromFile();\r\n      if (result.result === \"error\") {\r\n        setTranslationMessage(\r\n          t(\r\n            \"There was an error reading from the file. Is it a valid translation file? {{error}}\",\r\n            { error: result.error },\r\n          ),\r\n        );\r\n      }\r\n      if (result.result === \"success\") {\r\n        Storage.set(\"uploadedTranslationsJSON\", JSON.stringify(result.data));\r\n        setTranslationMessage(\r\n          t(\r\n            \"Successfully loaded translations file! Restart the app for it to take effect.\",\r\n          ),\r\n        );\r\n      }\r\n    } catch (e) {\r\n      setTranslationMessage(\r\n        t(\r\n          \"There was an error reading from the file. Is it a valid translation file?\",\r\n        ),\r\n      );\r\n    }\r\n  }, [setTranslationMessage]);\r\n\r\n  const clearTranslationFileCallback = useCallback(() => {\r\n    Storage.delete(\"uploadedTranslationsJSON\");\r\n    // Intentionally not translating the following line\r\n    setTranslationMessage(\r\n      \"Successfully deleted translations! Restart the app for it to take effect.\",\r\n    );\r\n  }, [setTranslationMessage]);\r\n\r\n  const { width, height } = useWindowDimensions();\r\n\r\n  const bottomMenuToggles = useMemo(\r\n    () =>\r\n      getAllMenuItems(state).map((section) => (\r\n        <BottomMenuToggle key={section} section={section} />\r\n      )),\r\n    [getAllMenuItems(state).join()],\r\n  );\r\n\r\n  const labelColor = useMemo(\r\n    () => ({ color: theme.colors.onBackground }),\r\n    [theme],\r\n  );\r\n\r\n  const performanceCategory = useMemo(() => {\r\n    return (\r\n      <CategoryContainer title=\"Performance\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            {t(\r\n              `You may set your target UI updates per second (UUPS) here. Higher UUPS will make the game elements refresh quicker but it could affect battery power and CPU usage.`,\r\n            )}\r\n          </Text>\r\n          <View style={[Styles.mt8, Styles.flexRowAlignCenter]}>\r\n            <Text style={labelColor}>{t(\"Target UUPS:\")}</Text>\r\n            <View style={styles.targetFpsDropdownContainer}>\r\n              <UtilityPicker\r\n                onValueChange={targetFpsChange}\r\n                selectedValue={state.options.targetFps.toString()}\r\n                style={styles.targetFpsPicker}\r\n                data={FPS_DATA}\r\n              />\r\n            </View>\r\n          </View>\r\n          <View style={styles.hideDamageEffectsContainer}>\r\n            <Text>\r\n              {t(\r\n                \"The following options may help improve performance in various screens.\",\r\n              )}\r\n            </Text>\r\n            <View>\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\"Hide bottom resource viewer\")}\r\n                  checked={state.options.hideBottomResourceViewer}\r\n                  onPress={hideBottomResourceViewerToggle}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n            </View>\r\n          </View>\r\n          {hasFlag(state, Flag.ExplorationUnlocked) && (\r\n            <View style={styles.hideDamageEffectsContainer}>\r\n              <Text>\r\n                {t(\r\n                  \"If you are seeing performance problems specifically in the Exploration screen, you may turn off damage effects here, which should improve performance somewhat. The alternate animation code for the bars is less smooth, and may or may not improve performance; you may want to try both.\",\r\n                )}\r\n              </Text>\r\n              <View>\r\n                <View>\r\n                  <CheckBox\r\n                    title={t(\"Hide damage effects\")}\r\n                    checked={state.options.hideDamageEffects}\r\n                    onPress={hideDamageEffectsToggle}\r\n                    containerStyle={styles.checkboxContainer}\r\n                  />\r\n                </View>\r\n                <View>\r\n                  <CheckBox\r\n                    title={t(\"Use alternate animation code for the bars\")}\r\n                    checked={state.options.doNotUseNativeDriver}\r\n                    onPress={doNotUseNativeDriverToggle}\r\n                    containerStyle={styles.checkboxContainer}\r\n                  />\r\n                </View>\r\n              </View>\r\n            </View>\r\n          )}\r\n        </View>\r\n      </CategoryContainer>\r\n    );\r\n  }, [\r\n    hideBottomResourceViewerToggle,\r\n    state.options.hideBottomResourceViewer,\r\n    doNotUseNativeDriverToggle,\r\n    state.options.doNotUseNativeDriver,\r\n    hideDamageEffectsToggle,\r\n    state.options.hideDamageEffects,\r\n    hasFlag(state, Flag.ExplorationUnlocked),\r\n    targetFpsChange,\r\n    state.options.targetFps.toString(),\r\n    FPS_DATA,\r\n    labelColor,\r\n  ]);\r\n\r\n  const keepAwakeCategory = useMemo(\r\n    () => (\r\n      <CategoryContainer title={t(\"Keep Awake\")}>\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            {t(\r\n              `By default, devices go to sleep after a period of inactivity, to save battery. You can disable this behavior while you are playing Magic Research actively in the foreground.`,\r\n            )}\r\n          </Text>\r\n          <CheckBox\r\n            title={t(\"Prevent device from sleeping\")}\r\n            checked={state.options.wakeLock}\r\n            onPress={wakeLockCallback}\r\n            containerStyle={Styles.mt8}\r\n          />\r\n        </View>\r\n      </CategoryContainer>\r\n    ),\r\n    [state.options.wakeLock, wakeLockCallback],\r\n  );\r\n\r\n  const hideEventPopupsCategory = useMemo(\r\n    () => (\r\n      <CategoryContainer title=\"Hide Event Popups\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            {t(\r\n              \"Hide certain kinds of events, so that they don't disrupt gameplay. Hidden events will not show a popup, but will still be accessible through the Event Menu.\",\r\n            )}\r\n          </Text>\r\n          <View style={styles.eventPopupsContainer}>\r\n            {state.world.totalTimesResetted > 0 && (\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\r\n                    \"Hide element level up events of levels that you have reached in previous retirements\",\r\n                  )}\r\n                  checked={state.options.hideEventTags.includes(\r\n                    EventTag.LEVEL_UP_ALREADY_REACHED,\r\n                  )}\r\n                  onPress={eventTagLevelUpAlreadyReachedToggle}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n            )}\r\n            <View>\r\n              <CheckBox\r\n                title={t(\r\n                  \"Hide element level up events if nothing new is unlocked\",\r\n                )}\r\n                checked={state.options.hideEventTags.includes(\r\n                  EventTag.LEVEL_UP_EMPTY,\r\n                )}\r\n                onPress={eventTagLevelUpEmptyToggle}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\"Hide all element level up events\")}\r\n                checked={state.options.hideEventTags.includes(\r\n                  EventTag.LEVEL_UP,\r\n                )}\r\n                onPress={eventTagLevelUpAllToggle}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            {state.world.totalTimesResetted > 0 && (\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\r\n                    \"Hide and skip main progression events that require no action and that you have seen in previous retirements\",\r\n                  )}\r\n                  checked={state.options.hideEventTags.includes(\r\n                    EventTag.MAIN_QUEST_SEEN_BEFORE,\r\n                  )}\r\n                  onPress={eventTagMainQuestSeenBeforeEventsToggle}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n            )}\r\n            <View>\r\n              <CheckBox\r\n                title={t(\r\n                  \"Hide common random events (random events which are not Storylines and which appear more than once)\",\r\n                )}\r\n                checked={state.options.hideEventTags.includes(\r\n                  EventTag.INCONSEQUENTIAL_RANDOM_EVENT,\r\n                )}\r\n                onPress={eventTagInconsequentialRandomEventsToggle}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\r\n                  \"Hide events when you are in the middle of a boss fight\",\r\n                )}\r\n                checked={state.options.doNotPopupEventsDuringBossFights}\r\n                onPress={eventTagBossFightToggle}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </CategoryContainer>\r\n    ),\r\n    [\r\n      state.options.hideEventTags.join(),\r\n      eventTagInconsequentialRandomEventsToggle,\r\n      eventTagLevelUpAllToggle,\r\n      eventTagLevelUpEmptyToggle,\r\n      eventTagLevelUpAlreadyReachedToggle,\r\n      eventTagMainQuestSeenBeforeEventsToggle,\r\n      state.options.doNotPopupEventsDuringBossFights,\r\n      eventTagBossFightToggle,\r\n      state.world.totalTimesResetted,\r\n    ],\r\n  );\r\n\r\n  const bottomMenuCategory = useMemo(\r\n    () =>\r\n      width < 700 && (\r\n        <CategoryContainer title={t(\"Bottom Menu\")}>\r\n          <View style={styles.categoryContainer}>\r\n            <Text>\r\n              {t(\r\n                \"In smaller screens, there is a menu at the bottom to quickly switch between screens. You can customize the menu in this section. If you are left handed, you can swap the position of the Cast Spell button to be able to use it more easily. If you prefer to have the extra screen space instead, you can also disable this menu here.\",\r\n              )}\r\n            </Text>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\"Enable bottom menu\")}\r\n                checked={state.options.enableBottomMenu}\r\n                onPress={enableBottomMenuCallback}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\"Show Cast Spell button in bottom menu\")}\r\n                checked={state.options.putCastSpellOnBottomMenu}\r\n                onPress={putCastSpellOnBottomMenuCallback}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\"Left handed mode\")}\r\n                checked={state.options.leftHandedMode}\r\n                onPress={leftHandedModeCallback}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n            <View style={Styles.mt16}>\r\n              <Text>\r\n                {t(\r\n                  \"You can also customize which screens will show up on the bottom menu. You will always be able to navigate to these screens by using the main menu on the left hand side. The bottom menu will show the following screens:\",\r\n                )}\r\n              </Text>\r\n              <View style={styles.hideBottomMenuContainer}>\r\n                {bottomMenuToggles}\r\n              </View>\r\n            </View>\r\n            <View style={Styles.mt16}>\r\n              <Text>\r\n                {t(\r\n                  \"In addition, you may re-order the screens in the bottom menu expanding the following:\",\r\n                )}\r\n              </Text>\r\n              <CategoryContainer\r\n                title={t(\"Re-order Bottom Menu Items\")}\r\n                initiallyExpanded={false}\r\n              >\r\n                <View style={Styles.mt8}>\r\n                  <MenuSectionsOrder />\r\n                </View>\r\n              </CategoryContainer>\r\n            </View>\r\n          </View>\r\n        </CategoryContainer>\r\n      ),\r\n    [\r\n      width,\r\n      state.options.enableBottomMenu,\r\n      state.options.putCastSpellOnBottomMenu,\r\n      state.options.leftHandedMode,\r\n      enableBottomMenuCallback,\r\n      putCastSpellOnBottomMenuCallback,\r\n      leftHandedModeCallback,\r\n      bottomMenuToggles,\r\n    ],\r\n  );\r\n\r\n  const themingAndUICategory = useMemo(\r\n    () => (\r\n      <CategoryContainer title=\"Theming and UI\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>{t(\"Change the colors to be easier on the eyes.\")}</Text>\r\n          <View>\r\n            <CheckBox\r\n              title={t(\"Enable dark mode\")}\r\n              checked={state.options.themeMode === \"dark\"}\r\n              onPress={darkModeToggle}\r\n              containerStyle={styles.checkboxContainer}\r\n            />\r\n          </View>\r\n          <View style={Styles.mt16}>\r\n            <Text>\r\n              {t(\r\n                \"The game remembers whether you had certain UI elements expanded or not, so that when you open the game again, they stay in the same status. You can turn off this functionality here.\",\r\n              )}\r\n            </Text>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\"Remember expanded / collapsed UI status\")}\r\n                checked={state.options.saveExpandedUI}\r\n                onPress={expandedUIToggle}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n          </View>\r\n          {Platform.OS === \"web\" && (\r\n            <View style={Styles.mt16}>\r\n              <Text>\r\n                {t(\"You can disable tooltips if they get in the way.\")}\r\n              </Text>\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\"Disable tooltips\")}\r\n                  checked={state.options.hideTooltips}\r\n                  onPress={hideTooltipsToggle}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n            </View>\r\n          )}\r\n          {width >= 1350 && (\r\n            <View style={Styles.mt16}>\r\n              <Text>\r\n                {t(\r\n                  \"If you have a wide screen, you can make the Events menu collapsible in order to get more out of your screen space.\",\r\n                )}\r\n              </Text>\r\n              <View>\r\n                <CheckBox\r\n                  title={t(\"Collapse Events menu on the right\")}\r\n                  checked={state.options.doNotShowEventsOnWideScreens}\r\n                  onPress={doNotShowEventsCallback}\r\n                  containerStyle={styles.checkboxContainer}\r\n                />\r\n              </View>\r\n            </View>\r\n          )}\r\n          <View style={Styles.mt16}>\r\n            <Text>\r\n              {t(\r\n                \"By default, the game changes the colors of the buttons and interface depending on the chosen element. If you'd like, you can instead choose to always show buttons with the looks of the element of your choice.\",\r\n              )}\r\n            </Text>\r\n            <View style={[Styles.mt8, Styles.flexRowAlignCenter]}>\r\n              <Text style={labelColor}>{t(\"Game UI color:\")}</Text>\r\n              <View style={styles.targetFpsDropdownContainer}>\r\n                <UtilityPicker\r\n                  onValueChange={elementOverrideChange}\r\n                  selectedValue={state.options.overrideElementDisplay}\r\n                  style={styles.uiColorPicker}\r\n                  disablePlaceholder={true}\r\n                  data={elementOptions}\r\n                />\r\n              </View>\r\n            </View>\r\n          </View>\r\n          <View style={Styles.mt16}>\r\n            <Text>\r\n              {t(\r\n                \"Buttons to cast spells are colored by the spell's Element by default, but you can turn off this behavior.\",\r\n              )}\r\n            </Text>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\"Color spell buttons by Element\")}\r\n                checked={state.options.colorSpellButtonsByElement}\r\n                onPress={colorSpellToggle}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n          </View>\r\n          <View style={Styles.mt16}>\r\n            <Text>\r\n              {t(\r\n                \"In very small screens, you can opt for an extra-compact UI to see more on the screen, at the expense of buttons being harder to press. Not recommended for large screens. {{extra}}\",\r\n                {\r\n                  extra:\r\n                    Platform.OS != \"web\"\r\n                      ? t(\r\n                          \"Changing the device's font size (making it smaller) might also help somewhat.\",\r\n                        )\r\n                      : \"\",\r\n                },\r\n              )}\r\n            </Text>\r\n            <View>\r\n              <CheckBox\r\n                title={t(\"Compact UI (Experimental)\")}\r\n                checked={state.options.compactUI}\r\n                onPress={compactUIToggle}\r\n                containerStyle={styles.checkboxContainer}\r\n              />\r\n            </View>\r\n          </View>\r\n          {ZOOM_SUPPORTED && (\r\n            <View style={styles.elementOverrideContainer}>\r\n              <Text>\r\n                {t(\"You can also adjust the zoom level on the game.\")}\r\n              </Text>\r\n              <View style={[Styles.mt8, Styles.flexRowAlignCenter]}>\r\n                <Text style={labelColor}>{t(\"Zoom scale:\")}</Text>\r\n                <View style={styles.targetFpsDropdownContainer}>\r\n                  <UtilityPicker\r\n                    onValueChange={zoomChange}\r\n                    selectedValue={state.options.zoomLevel.toString()}\r\n                    style={styles.uiColorPicker}\r\n                    data={ZOOM_DATA}\r\n                  />\r\n                </View>\r\n              </View>\r\n            </View>\r\n          )}\r\n        </View>\r\n      </CategoryContainer>\r\n    ),\r\n    [\r\n      state.options.themeMode,\r\n      darkModeToggle,\r\n      state.options.saveExpandedUI,\r\n      expandedUIToggle,\r\n      labelColor,\r\n      state.options.overrideElementDisplay,\r\n      elementOverrideChange,\r\n      state.options.colorSpellButtonsByElement,\r\n      colorSpellToggle,\r\n      state.options.doNotShowEventsOnWideScreens,\r\n      doNotShowEventsCallback,\r\n      state.options.compactUI,\r\n      compactUIToggle,\r\n      ZOOM_SUPPORTED,\r\n      state.options.zoomLevel,\r\n      zoomChange,\r\n      ZOOM_DATA,\r\n      state.options.hideTooltips,\r\n      hideTooltipsToggle,\r\n      width,\r\n    ],\r\n  );\r\n\r\n  const saveFileCategory = useMemo(\r\n    () => (\r\n      <CategoryContainer title={t(\"Save File\")}>\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            {t(\r\n              \"You may persist your save data by copying it to the clipboard and storing it anywhere you'd like.\",\r\n            )}\r\n          </Text>\r\n          <Button onPress={copyToClipboard} style={Styles.mt8}>\r\n            {t(\"Copy savefile to clipboard\")}\r\n          </Button>\r\n          {copyToClipboardError != null && (\r\n            <View style={Styles.mt8}>\r\n              <Text style={{ color: theme.colors.error }}>\r\n                {copyToClipboardError}\r\n              </Text>\r\n            </View>\r\n          )}\r\n        </View>\r\n        {SAVE_TO_FILE_SUPPORTED && (\r\n          <View style={styles.categoryContainer}>\r\n            <Text>\r\n              {t(\r\n                \"You can also save your data directly to a file or elsewhere.\",\r\n              )}\r\n            </Text>\r\n            <Button onPress={saveToFileCallback} style={Styles.mt8}>\r\n              {t(\"Save to file\")}\r\n            </Button>\r\n          </View>\r\n        )}\r\n      </CategoryContainer>\r\n    ),\r\n    [\r\n      copyToClipboard,\r\n      SAVE_TO_FILE_SUPPORTED,\r\n      saveToFileCallback,\r\n      copyToClipboardError,\r\n      theme,\r\n    ],\r\n  );\r\n\r\n  const loadFileCategory = useMemo(\r\n    () => (\r\n      <CategoryContainer title={t(\"Load File\")}>\r\n        <View style={styles.categoryContainer}>\r\n          <Text>{loadText}</Text>\r\n          <Text style={{ fontWeight: \"bold\", color: theme.colors.error }}>\r\n            {t(\r\n              `WARNING: This will erase your current save! Make sure you have backed up your data!`,\r\n            )}\r\n          </Text>\r\n          <LoadGameContainer />\r\n        </View>\r\n      </CategoryContainer>\r\n    ),\r\n    [theme.colors.error, loadText],\r\n  );\r\n\r\n  const languageCategory = useMemo(\r\n    () =>\r\n      LOAD_FROM_FILE_SUPPORTED && (\r\n        <CategoryContainer title={t(\"Language\")}>\r\n          <View style={styles.categoryContainer}>\r\n            <Text>\r\n              {t(\r\n                \"Although the game does not provide official translations, if you would rather play in a different language, the game supports loading a translations file which will replace the text in the game. If you have such a file, you can load it below.\",\r\n              )}\r\n            </Text>\r\n            <Button onPress={importTranslationFileCallback} style={Styles.mt8}>\r\n              {t(\"Load translations file\")}\r\n            </Button>\r\n            {hasTranslations && (\r\n              <Button onPress={clearTranslationFileCallback} style={Styles.mt8}>\r\n                {t(\"Clear translations\")}\r\n              </Button>\r\n            )}\r\n            {translationMessage != \"\" && (\r\n              <Text style={{ color: theme.colors.error }}>\r\n                {translationMessage}\r\n              </Text>\r\n            )}\r\n          </View>\r\n        </CategoryContainer>\r\n      ),\r\n    [\r\n      theme.colors.error,\r\n      translationMessage,\r\n      LOAD_FROM_FILE_SUPPORTED,\r\n      importTranslationFileCallback,\r\n    ],\r\n  );\r\n\r\n  const eraseSavedDataCategory = useMemo(\r\n    () => (\r\n      <CategoryContainer title=\"Erase Saved Data\">\r\n        <View style={styles.categoryContainer}>\r\n          <Text>\r\n            {t(\r\n              `If you want to start all over again and retirement isn't enough, you can delete your save data entirely.`,\r\n            )}\r\n          </Text>\r\n          <Text style={{ fontWeight: \"bold\", color: theme.colors.error }}>\r\n            {t(\r\n              `WARNING: This will erase your current save, including all your progress with Storylines and retirement! Make sure you have backed up your data! Once you have done this, there is no going back! If you are sure you want to do this, write \"erase\" in the text field below.`,\r\n            )}\r\n          </Text>\r\n          <TextInput\r\n            style={Styles.mt16}\r\n            value={eraseText}\r\n            onChangeText={setEraseText}\r\n          />\r\n          <View style={Styles.mt8}>\r\n            <Button\r\n              disabled={eraseText.toLowerCase() != \"erase\"}\r\n              buttonColor={theme.colors.errorContainer}\r\n              textColor={theme.colors.onErrorContainer}\r\n              onPress={eraseGame}\r\n            >\r\n              {t(\"Permanently erase all saved data\")}\r\n            </Button>\r\n          </View>\r\n        </View>\r\n      </CategoryContainer>\r\n    ),\r\n    [\r\n      eraseText,\r\n      eraseGame,\r\n      setEraseText,\r\n      eraseText,\r\n      theme.colors.error,\r\n      theme.colors.errorContainer,\r\n    ],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.container}>\r\n        {performanceCategory}\r\n        {keepAwakeCategory}\r\n        {hideEventPopupsCategory}\r\n        {bottomMenuCategory}\r\n        {themingAndUICategory}\r\n        {saveFileCategory}\r\n        {loadFileCategory}\r\n        {languageCategory}\r\n        {eraseSavedDataCategory}\r\n      </View>\r\n    ),\r\n    [\r\n      performanceCategory,\r\n      keepAwakeCategory,\r\n      hideEventPopupsCategory,\r\n      bottomMenuCategory,\r\n      themingAndUICategory,\r\n      saveFileCategory,\r\n      loadFileCategory,\r\n      languageCategory,\r\n      eraseSavedDataCategory,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  headerContainer: {\r\n    marginBottom: 16,\r\n  },\r\n  categoryContainer: {\r\n    marginTop: 8,\r\n    paddingHorizontal: 8,\r\n  },\r\n  eventPopupsContainer: {\r\n    marginTop: 8,\r\n  },\r\n  targetFpsDropdownContainer: {\r\n    ...Platform.select({\r\n      android: { backgroundColor: \"#eee\", borderRadius: 10, default: {} },\r\n    }),\r\n    marginLeft: 16,\r\n  },\r\n  targetFpsPicker: {\r\n    width: 100,\r\n  },\r\n  uiColorPicker: {\r\n    width: 160,\r\n  },\r\n  sliderContainer: {\r\n    width: 200,\r\n    marginLeft: 16,\r\n  },\r\n  sliderTextContainer: {\r\n    width: 120,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    marginTop: 8,\r\n    padding: 0,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n  saveButton: {\r\n    marginTop: 8,\r\n  },\r\n  loadMessageContainer: {\r\n    marginBottom: 8,\r\n  },\r\n  inputContainer: {\r\n    borderWidth: 1,\r\n    marginTop: 16,\r\n    maxHeight: 48,\r\n  },\r\n  toggleMenuCheckboxContainer: {\r\n    padding: 0,\r\n    marginLeft: 0,\r\n  },\r\n  toggleMenuRow: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  hideBottomMenuContainer: {\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  toggleMenuTextContainer: {\r\n    paddingLeft: 4,\r\n  },\r\n  bottomMenuCustomizationContainer: {\r\n    marginTop: 8,\r\n  },\r\n  hideDamageEffectsContainer: {\r\n    marginTop: 8,\r\n  },\r\n  elementOverrideContainer: {\r\n    marginTop: 8,\r\n  },\r\n  dragHandle: {\r\n    cursor: \"grab\",\r\n    marginRight: 8,\r\n  },\r\n});\r\n","import React, { useContext, useEffect, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { retire } from \"../backend/Retire\";\r\nimport { Storylines } from \"../backend/storylines/Storylines\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext, createHypotheticalState } from \"../backend/GameState\";\r\nimport { getEventMessageById } from \"../backend/events/Events\";\r\nimport {\r\n  mplIsTooHigh,\r\n  mplIsTooLow,\r\n} from \"../backend/exploration/dungeons/Dungeons\";\r\nimport {\r\n  getElementLevel,\r\n  getMaxOfMaxPrimaryElementLevels,\r\n  getPrimaryElementMaxLevelForRun,\r\n  getUnlockedElements,\r\n  grantStartingExp,\r\n  maximumElementLevelExpMultiplier,\r\n  maximumElementLevelProductionMultiplierDx,\r\n  startingExpForElement,\r\n  translateElement,\r\n} from \"../backend/spells/Elements\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { Button } from \"./utility/Button\";\r\nimport { VisibilityContext } from \"./utility/VisibilityContext\";\r\n\r\nexport default function Retirement() {\r\n  const state = useContext(StateContext);\r\n\r\n  const allElementLevels = getUnlockedElements(state).map((eachElement) =>\r\n    getElementLevel(state, eachElement),\r\n  );\r\n  const allStorylines = Storylines.getAll()\r\n    .filter((storyline) => storyline.isCompletedThisRun(state))\r\n    .map((storyline) => storyline.id)\r\n    .join();\r\n  const modifiedState = useMemo(() => {\r\n    let retiredState = retire(createHypotheticalState(state), true);\r\n    retiredState = grantStartingExp(retiredState);\r\n    return retiredState;\r\n  }, [JSON.stringify(allElementLevels), allStorylines]);\r\n  const newExpMultiplier = maximumElementLevelExpMultiplier(modifiedState);\r\n  const newProductionMultiplier =\r\n    maximumElementLevelProductionMultiplierDx(modifiedState);\r\n  const oldExpMultiplier = maximumElementLevelExpMultiplier(state);\r\n  const oldProductionMultiplier =\r\n    maximumElementLevelProductionMultiplierDx(state);\r\n  const expDeltaPct =\r\n    ((newExpMultiplier - oldExpMultiplier) * 100.0) / oldExpMultiplier;\r\n  const productionDeltaPct =\r\n    ((newProductionMultiplier - oldProductionMultiplier) * 100.0) /\r\n    oldProductionMultiplier;\r\n  const stuckOnBoss = false; //TBD isStuckOnBoss(state);\r\n\r\n  const newStorylines = Storylines.getAll().filter((storyline) => {\r\n    return storyline.isCompletedThisRun(state);\r\n  });\r\n\r\n  let storylineBonusMessage = \"\";\r\n  if (newStorylines.length > 0) {\r\n    storylineBonusMessage = t(\r\n      `\r\n      \r\nAdditionally, in this retirement, you have completed the following Storylines, which will be fully activated after retirement:\r\n    \r\n{{storylineList}}`,\r\n      {\r\n        storylineList: newStorylines\r\n          .map((storyline) =>\r\n            t(\"* **{{storylineName}}**: {{storylineBonus}}\", {\r\n              storylineName: storyline.getName(),\r\n              storylineBonus: storyline.getBonusDescription(state),\r\n            }),\r\n          )\r\n          .join(t(\"\\n\")),\r\n      },\r\n    );\r\n  }\r\n\r\n  const startingExp = startingExpForElement(\r\n    modifiedState,\r\n    state.run.primaryElement,\r\n  );\r\n  const startingLevel = getElementLevel(\r\n    modifiedState,\r\n    state.run.primaryElement,\r\n  );\r\n\r\n  const startingExpSecondary =\r\n    state.run.secondaryElement != null\r\n      ? startingExpForElement(modifiedState, state.run.secondaryElement)\r\n      : 0;\r\n  const startingLevelSecondary =\r\n    state.run.secondaryElement != null\r\n      ? getElementLevel(modifiedState, state.run.secondaryElement)\r\n      : 0;\r\n\r\n  const retirementEffects = t(\r\n    `**If you retire now, your element exp gain multiplier will become {{newExp}}x (+{{expDeltaPct}}%) and your channeling, production and loot multiplier will become {{newProduction}}x (+{{productionDeltaPct}}%). You will also begin all subsequent retirements with {{startingExp}} {{element}} exp (meaning it will start on at least Lv{{startingLevel}}){{secondaryElementText}}.**`,\r\n    {\r\n      newExp: formatNumber(newExpMultiplier, { showDecimals: true }),\r\n      expDeltaPct: formatNumber(expDeltaPct, {\r\n        showDecimals: true,\r\n      }),\r\n      newProduction: formatNumber(newProductionMultiplier, {\r\n        showDecimals: true,\r\n      }),\r\n      productionDeltaPct: formatNumber(productionDeltaPct, {\r\n        showDecimals: true,\r\n      }),\r\n      startingExp: formatNumber(startingExp),\r\n      startingLevel: formatNumber(startingLevel),\r\n      element: translateElement(state.run.primaryElement),\r\n      secondaryElementText:\r\n        state.run.secondaryElement != null\r\n          ? t(\r\n              \" and {{startingExp}} {{element}} exp (meaning it will start on at least Lv{{startingLevel}})\",\r\n              {\r\n                startingExp: formatNumber(startingExpSecondary),\r\n                startingLevel: formatNumber(startingLevelSecondary),\r\n                element: translateElement(state.run.secondaryElement),\r\n              },\r\n            )\r\n          : \"\",\r\n    },\r\n  );\r\n\r\n  const text = t(\r\n    `You have gone through a lot, even if it wasn't quite enough. You feel tired and contemplate giving up and retiring from your quest.\r\n\r\nIf you retire, **you will reset the game.** Everything will revert back to its initial state, except:\r\n* Any bonuses you obtained from \"(Storyline)\" events will remain;\r\n* You will gain a boost to exp gain, building and channeling production, and loot based on the maximum level you have ever attained on your primary element (MPL), as well as on the sum of the MPLs you have attained on each element;\r\n* You will additionally start with some exp on elements for which your MPL is higher than 1;\r\n* If you have obtained any :timepiece:Time Pieces from time spent away from the game, these will also remain.\r\n\r\nWhen you retire, you will be able to choose a new primary element.\r\n\r\n{{retirementEffects}}{{storylineBonusMessage}}\r\n\r\n*Do you want to retire?*`,\r\n    { retirementEffects, storylineBonusMessage },\r\n  );\r\n\r\n  const [hasClicked, setHasClicked] = useState(false);\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setHasClicked(false);\r\n    }\r\n  }, [visible]);\r\n  const showOngoingEventsWarning = Object.values(\r\n    state.run.eventOccurrences,\r\n  ).some((event) => {\r\n    return (\r\n      event.currentMessageId &&\r\n      !getEventMessageById(event.currentMessageId).isTerminal()\r\n    );\r\n  });\r\n  const showMPLTooLowWarning =\r\n    mplIsTooLow(state) &&\r\n    getPrimaryElementMaxLevelForRun(state) >\r\n      getMaxOfMaxPrimaryElementLevels(state) + 4;\r\n  const showMPLTooHighWarning = mplIsTooHigh(state);\r\n  const theme = useTheme();\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text h1>{t(\"Retirement\")}</Text>\r\n      <View style={styles.explanation}>\r\n        <Markdown>{text}</Markdown>\r\n      </View>\r\n      {showMPLTooLowWarning && (\r\n        <View style={styles.warning}>\r\n          <Text style={{ fontStyle: \"italic\" }}>\r\n            {t(`It looks like your multipliers might be too low for your current\r\nprogression in Exploration, and your retirement bonus seems\r\nreasonably high. This might be a good time to retire!`)}\r\n          </Text>\r\n        </View>\r\n      )}\r\n      {showMPLTooHighWarning && (\r\n        <View style={styles.warning}>\r\n          <Text style={{ color: theme.colors.error }}>\r\n            {t(`Warning: Your multipliers seem to be very high for your current\r\nprogression in Exploration. You might benefit more by making more\r\nprogress in Exploration. Are you sure you want to retire?`)}\r\n          </Text>\r\n        </View>\r\n      )}\r\n      {stuckOnBoss && (\r\n        <View style={styles.warning}>\r\n          <Text style={{ color: theme.colors.error }}>\r\n            {t(`Warning: It looks like you could be stuck on a boss. If you cannot\r\ndefeat a boss, and you have already tried retiring once to defeat it\r\nwithout success, you may possibly have better results by thinking\r\nharder about how to defeat the boss rather than starting over again.\r\nAre you sure you want to retire?`)}\r\n          </Text>\r\n        </View>\r\n      )}\r\n      {showOngoingEventsWarning && (\r\n        <View style={styles.warning}>\r\n          <Text style={{ color: theme.colors.error }}>\r\n            {t(\r\n              `Warning: You still have ongoing events! Are you sure you want to retire?`,\r\n            )}\r\n          </Text>\r\n        </View>\r\n      )}\r\n      <View style={styles.buttonContainer}>\r\n        {!hasClicked && (\r\n          <Button onPress={() => setHasClicked(true)}>{t(\"Retire\")}</Button>\r\n        )}\r\n        {hasClicked && (\r\n          <Button\r\n            onPress={() => {\r\n              state.apply((state) => retire(state, false));\r\n            }}\r\n          >\r\n            {t(\"Are you sure? Press again to confirm\")}\r\n          </Button>\r\n        )}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  explanation: {\r\n    marginTop: 16,\r\n  },\r\n  buttonContainer: {\r\n    marginTop: 16,\r\n  },\r\n  warning: {\r\n    marginTop: 8,\r\n  },\r\n});\r\n","import { useContext } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  getCorruption,\r\n  getCorruptionCap,\r\n  getCorruptionExpPenaltyMultiplier,\r\n  getCorruptionHPPenaltyMultiplier,\r\n  getCorruptionTransmutePenaltyMultiplier,\r\n  isCorruptionExpPenaltyActive,\r\n  isCorruptionHPPenaltyActive,\r\n  isCorruptionTransmutePenaltyActive,\r\n} from \"../../backend/rituals/Rituals\";\r\nimport { formatMultiplier, formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport Styles from \"../utility/Styles\";\r\n\r\nexport function CorruptionDetails(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const isHPPenaltyActive = isCorruptionHPPenaltyActive(state);\r\n  const isExpPenaltyActive = isCorruptionExpPenaltyActive(state);\r\n  const isTransmutePenaltyActive = isCorruptionTransmutePenaltyActive(state);\r\n\r\n  const corruptionAmount = getCorruption(state);\r\n  const corruptionCap = getCorruptionCap(state);\r\n\r\n  const penalties = [];\r\n\r\n  if (isHPPenaltyActive) {\r\n    penalties.push(\r\n      t(`* {{multiplier}} Max:hp:`, {\r\n        multiplier: formatMultiplier(getCorruptionHPPenaltyMultiplier(state)),\r\n      }),\r\n    );\r\n  }\r\n  if (isExpPenaltyActive) {\r\n    penalties.push(\r\n      t(`* {{multiplier}} Element Exp gained`, {\r\n        multiplier: formatMultiplier(getCorruptionExpPenaltyMultiplier(state)),\r\n      }),\r\n    );\r\n  }\r\n  if (isTransmutePenaltyActive) {\r\n    penalties.push(\r\n      t(\r\n        `* +{{multiplier}}% resources and items needed for all Transmutation (rounded up)`,\r\n        {\r\n          multiplier: formatNumber(\r\n            getCorruptionTransmutePenaltyMultiplier(state) * 100 - 100,\r\n            { showDecimals: true },\r\n          ),\r\n        },\r\n      ),\r\n    );\r\n  }\r\n\r\n  const penaltyText = penalties.length > 0 ? penalties.join(\"\\n\") : \"\";\r\n\r\n  const corruptionExplanation = t(\r\n    `Your active Rituals will give you Corruption (:corruption:). Your soul cannot take on too much :corruption: at a time; if you activate too many Rituals at once, you will grow weak.`,\r\n  );\r\n  const corruptionPenalties =\r\n    corruptionAmount <= corruptionCap\r\n      ? t(\r\n          `You currently have {{amount}}:corruption:, which is *below* your safe limit of {{cap}}:corruption:. Your soul is strong; you have no penalties.`,\r\n          {\r\n            amount: formatNumber(corruptionAmount, { showDecimals: true }),\r\n            cap: formatNumber(corruptionCap, { showDecimals: true }),\r\n          },\r\n        )\r\n      : t(\r\n          `You currently have {{amount}}:corruption:, which is *above* your safe limit of {{cap}}:corruption:. The extra Corruption is giving you the following penalties:\r\n  \r\n{{penaltyText}}`,\r\n          {\r\n            amount: formatNumber(corruptionAmount, { showDecimals: true }),\r\n            cap: formatNumber(corruptionCap, { showDecimals: true }),\r\n            penaltyText,\r\n          },\r\n        );\r\n  return (\r\n    <View>\r\n      <View>\r\n        <Markdown>{corruptionExplanation}</Markdown>\r\n      </View>\r\n      <View style={Styles.mt8}>\r\n        <Markdown>{corruptionPenalties}</Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport { useCallback, useContext, useMemo, useRef, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { TouchableWithoutFeedback } from \"react-native-gesture-handler\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { Ritual } from \"../../backend/rituals/Ritual\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { DescriptionViewer } from \"../utility/Miscellaneous\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nexport function RitualDetails(props: { ritual: Ritual }) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  const ritual = props.ritual;\r\n  const descriptionContents = t(\r\n    `{{ritualDescription}} **{{ritualEffect}}; {{corruptionCost}}:corruption:**`,\r\n    {\r\n      ritualDescription: ritual.getDescription(state),\r\n      ritualEffect: ritual.getEffect(state),\r\n      corruptionCost: formatNumber(ritual.getCorruptionCost(state), {\r\n        showDecimals: true,\r\n      }),\r\n    },\r\n  );\r\n\r\n  const isActive = ritual.isActive(state);\r\n  const toggleRitual = useCallback(\r\n    () =>\r\n      stateRef.current.apply((state) =>\r\n        ritual.isActive(state) ? ritual.turnOff(state) : ritual.turnOn(state),\r\n      ),\r\n    [ritual],\r\n  );\r\n  const buttonRow = useMemo(() => {\r\n    if (isActive) {\r\n      return (\r\n        <View style={Styles.flexRowAlignCenter}>\r\n          <Button compact={true} onPress={toggleRitual}>\r\n            {t(\"Stop Ritual\")}\r\n          </Button>\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View style={Styles.flexRowAlignCenter}>\r\n        <Button compact={true} onPress={toggleRitual}>\r\n          {t(\"Start Ritual\")}\r\n        </Button>\r\n      </View>\r\n    );\r\n  }, [toggleRitual, isActive]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={Styles.mv8}>\r\n        <DescriptionViewer>{descriptionContents}</DescriptionViewer>\r\n        <View style={Styles.mt8}>{buttonRow}</View>\r\n      </View>\r\n    ),\r\n    [descriptionContents, buttonRow],\r\n  );\r\n}\r\n\r\nexport function RitualView(props: { ritual: Ritual }) {\r\n  const ritual = props.ritual;\r\n  const [collapsed, setCollapsed] = useState(true);\r\n  const theme = useTheme();\r\n  const state = useContext(StateContext);\r\n  const name = ritual.getDisplayName(state);\r\n  const toggleCollapsed = useCallback(\r\n    () => setCollapsed(!collapsed),\r\n    [collapsed, setCollapsed],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View style={Styles.pv4}>\r\n        <TouchableWithoutFeedback\r\n          accessibilityRole=\"button\"\r\n          accessibilityHint={t(\"Expand\")}\r\n          onPress={toggleCollapsed}\r\n        >\r\n          <View style={styles.topRowContainer}>\r\n            <Text h2 accessibilityRole=\"none\" style={styles.topContainer}>\r\n              {name}\r\n            </Text>\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.colors.onBackground}\r\n              />\r\n            </View>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        {!collapsed && (\r\n          <View style={Styles.ph8}>\r\n            <RitualDetails ritual={ritual} />\r\n          </View>\r\n        )}\r\n      </View>\r\n    ),\r\n    [toggleCollapsed, name, collapsed, theme, ritual],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  topRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginBottom: 8,\r\n    marginTop: 8,\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  descriptionViewer: { flex: 1, justifyContent: \"center\" },\r\n  effectContainer: {\r\n    flex: 1,\r\n  },\r\n  effectSubcontainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  topContainer: {\r\n    flex: 1,\r\n    marginLeft: 8,\r\n  },\r\n  disabledStorylineText: {\r\n    color: \"#aaa\",\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { getVisibleRituals } from \"../../backend/rituals/Rituals\";\r\nimport Divider from \"../utility/Divider\";\r\nimport { RitualView } from \"./RitualView\";\r\n\r\nexport default function RitualsView(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const rituals = getVisibleRituals(state);\r\n  const ritualsIdString = rituals.map((ritual) => ritual.getId()).join(\"\");\r\n\r\n  const ritualContainers = useMemo(\r\n    () =>\r\n      rituals.map((ritual) => {\r\n        return <RitualView key={ritual.getId()} ritual={ritual} />;\r\n      }),\r\n    [ritualsIdString],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (rituals.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <View>\r\n        <View key={rituals[0].getId()}>{ritualContainers[0]}</View>\r\n        {ritualContainers.slice(1).map((ritualContainer, idx) => {\r\n          return (\r\n            <View key={rituals[idx].getId()}>\r\n              <Divider />\r\n              {ritualContainer}\r\n            </View>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  }, [ritualsIdString, ritualContainers]);\r\n}\r\n","import React, { useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { CorruptionDetails } from \"./rituals/CorruptionDetails\";\r\nimport RitualsView from \"./rituals/RitualsView\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport Styles from \"./utility/Styles\";\r\n\r\nexport function RitualsComponent() {\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.campusContainer}>\r\n        <CategoryContainer title={t(`Corruption`)}>\r\n          <View style={Styles.mt8}>\r\n            <CorruptionDetails />\r\n          </View>\r\n        </CategoryContainer>\r\n        <View style={Styles.mt8}>\r\n          <CategoryContainer title={t(`Rituals`)}>\r\n            <View style={Styles.mt8}>\r\n              <RitualsView />\r\n            </View>\r\n          </CategoryContainer>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  campusContainer: {\r\n    height: \"100%\",\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n","import { keysOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../action/ActionAreas\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport {\r\n  createNewVat,\r\n  isSpellcraftUnlocked,\r\n} from \"../spellcraft/SpellcraftUtils\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport { Building, BuildingSpell } from \"./Building\";\r\nimport { BuildingAmountListeners, getBuildingAmount } from \"./Buildings\";\r\n\r\nclass SpellcraftingVat extends Building {\r\n  getId(): string {\r\n    return \"spellcraftingVat\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Spellcrafting Vat\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"An oversized tube meant to hold large amounts of items, so that their power may be routed into a spell.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"+1 Spellcraft slot. Note: Cannot be demolished - destroy the vat instead from the Spellcraft screen\",\r\n    );\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 15;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const spellcraftingVat = new SpellcraftingVat();\r\n\r\nclass BuildSpellcraftingVat extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.OTHER] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return spellcraftingVat;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 10000,\r\n      AirEssence: 12000,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 4.0,\r\n      AirEssence: 4.0,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return isSpellcraftUnlocked(state) && super.isVisible(state);\r\n  }\r\n\r\n  shouldHideDemolish(): boolean {\r\n    return true;\r\n  }\r\n\r\n  canDemolish(state: GameState, amount: number): boolean {\r\n    return false;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const buildSpellcraftingVat = new BuildSpellcraftingVat();\r\n\r\nfunction vatEqualizer(state: GameState) {\r\n  const buildingAmt = getBuildingAmount(state, spellcraftingVat);\r\n  const vatAmt = keysOf(state.run.spellcrafts).length;\r\n  if (vatAmt < buildingAmt) {\r\n    const buildingAmt = getBuildingAmount(state, spellcraftingVat);\r\n    let vatAmt = keysOf(state.run.spellcrafts).length;\r\n    while (vatAmt < buildingAmt) {\r\n      state = createNewVat(state);\r\n      vatAmt++;\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\nBuildingAmountListeners.register(vatEqualizer, \"spellcraftingVats\");\r\n","import { useCallback, useContext, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { ScrollView } from \"react-native-gesture-handler\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { getThemeByElementAndDarkMode } from \"../../Themes\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { ActionArea } from \"../../backend/action/ActionAreas\";\r\nimport { SpellElement } from \"../../backend/spells/Elements\";\r\nimport { Spell } from \"../../backend/spells/Spell\";\r\nimport { Spells, getVisibleSpellsByElement } from \"../../backend/spells/Spells\";\r\nimport { keysOf, useComponentDidUpdate } from \"../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { SpellElementSelector } from \"../spells/SpellElementSelector\";\r\nimport { Button } from \"./Button\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\n\r\nfunction SpellSelectSpellButton(props: {\r\n  spell: Spell;\r\n  onPress: (spell: Spell) => void;\r\n  theme: any;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const spell = props.spell;\r\n  const onSpellPress = useCallback(\r\n    () => props.onPress(spell),\r\n    [props.onPress, spell],\r\n  );\r\n  const spellDisplayName = spell.getBasicDisplayName(state);\r\n  const spellCost = spell.getManaCost(state);\r\n  const theme = props.theme;\r\n  const buttonTitleStyles = useMemo(\r\n    () => [\r\n      {\r\n        color: theme.colors.onPrimary,\r\n      },\r\n      {\r\n        fontSize: 12,\r\n      },\r\n    ],\r\n    [theme],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <Button\r\n        key={spell.getId()}\r\n        compact={true}\r\n        enableAutoRepress={true}\r\n        onPress={onSpellPress}\r\n        style={[Styles.flex]}\r\n        labelStyle={{\r\n          marginHorizontal: 16,\r\n          flex: 1,\r\n          marginVertical: 0,\r\n          height: 40,\r\n        }}\r\n        contentStyle={{ marginHorizontal: 0, flex: 1, height: 40 }}\r\n        // @ts-ignore I added this myself\r\n        TextComponent={View}\r\n        theme={theme}\r\n      >\r\n        <View style={styles.spellButtonTitleContainer}>\r\n          <View style={styles.spellButtonTitleOnlyContainer}>\r\n            <Text style={[buttonTitleStyles, Styles.flex]} numberOfLines={1}>\r\n              {spellDisplayName}\r\n            </Text>\r\n          </View>\r\n          <View\r\n            style={[styles.spellButtonCostContainer, Styles.flexRowAlignCenter]}\r\n          >\r\n            {spellCost > 0 && (\r\n              <View style={[Styles.flexRowAlignCenter, Styles.ml8]}>\r\n                <Text style={buttonTitleStyles} doNotScaleFonts={true}>\r\n                  {formatNumber(spellCost, { showDecimals: false })}\r\n                </Text>\r\n                <GameIcon icon=\"mana\" style={styles.spellManaIcon} />\r\n              </View>\r\n            )}\r\n          </View>\r\n        </View>\r\n      </Button>\r\n    ),\r\n    [spellDisplayName, buttonTitleStyles, spellCost, onSpellPress, theme],\r\n  );\r\n}\r\n\r\nexport function SpellSelect(props: {\r\n  onSelect: (spellId: string) => void;\r\n  spellId: string;\r\n}) {\r\n  const state = useContext(StateContext);\r\n\r\n  const [spellId, setSpellId] = useState(props.spellId);\r\n  const spell = Spells.getByIdNullable(spellId);\r\n\r\n  const spellsByElement = getVisibleSpellsByElement(\r\n    state,\r\n    ActionArea.SPELL_MENU,\r\n  );\r\n\r\n  const elements =\r\n    keysOf(getVisibleSpellsByElement(state, ActionArea.SPELL_MENU)) ?? [];\r\n\r\n  const [selectedSubcategory, setSelectedSubcategory] = useState<SpellElement>(\r\n    spell?.getElement?.(),\r\n  );\r\n\r\n  const spellsToShow =\r\n    spellsByElement?.[selectedSubcategory as SpellElement] ?? [];\r\n\r\n  const onSpellSelect = useCallback(\r\n    (spell: Spell) => props.onSelect(spell.getId()),\r\n    [props.onSelect],\r\n  );\r\n\r\n  useComponentDidUpdate(() => setSpellId(undefined), [selectedSubcategory]);\r\n\r\n  const subcategoryPickerComponent = useMemo(\r\n    () => (\r\n      <SpellElementSelector\r\n        selected={selectedSubcategory}\r\n        onPress={setSelectedSubcategory}\r\n        elements={elements}\r\n        style={{ width: 216 }}\r\n      />\r\n    ),\r\n    [selectedSubcategory, setSelectedSubcategory, [JSON.stringify(elements)]],\r\n  );\r\n\r\n  const theme = useTheme();\r\n  const elementTheme =\r\n    state.options.colorSpellButtonsByElement && selectedSubcategory != null\r\n      ? getThemeByElementAndDarkMode(selectedSubcategory, theme.dark)\r\n      : theme;\r\n\r\n  const spellButtons = useMemo(\r\n    () => (\r\n      <View style={Styles.mv4}>\r\n        {spellsToShow.map((spell) => (\r\n          <View key={spell.getId()} style={Styles.mv4}>\r\n            <SpellSelectSpellButton\r\n              spell={spell}\r\n              onPress={onSpellSelect}\r\n              theme={elementTheme}\r\n            />\r\n          </View>\r\n        ))}\r\n      </View>\r\n    ),\r\n    [spellsToShow, onSpellSelect, elementTheme],\r\n  );\r\n\r\n  return (\r\n    <View style={[Styles.flex, styles.topContainer]}>\r\n      <View style={Styles.flexCenter}>\r\n        {elements.length > 0 && subcategoryPickerComponent}\r\n      </View>\r\n      <View style={Styles.flex}>\r\n        <ScrollView style={[{ flexGrow: 0 }, Styles.mt8]}>\r\n          {spellButtons}\r\n        </ScrollView>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  spellButtonTitleContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  spellButtonTitleOnlyContainer: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  spellButtonCostContainer: {\r\n    flexDirection: \"row\",\r\n    width: 100,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  spellManaIcon: {\r\n    height: 16,\r\n    width: 16,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"center\",\r\n    marginLeft: 2,\r\n  },\r\n  topContainer: {\r\n    minWidth: 300,\r\n  },\r\n});\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { StyleSheet, View, useWindowDimensions } from \"react-native\";\r\nimport { TouchableOpacity } from \"react-native-gesture-handler\";\r\nimport {\r\n  Modal,\r\n  Portal,\r\n  Surface,\r\n  ThemeProvider,\r\n  useTheme,\r\n} from \"react-native-paper\";\r\nimport { getThemeByElementAndDarkMode } from \"../Themes\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { buildSpellcraftingVat } from \"../backend/buildings/SpellcraftingVat\";\r\nimport { Spellcraft } from \"../backend/spellcraft/Spellcraft\";\r\nimport {\r\n  assignSpellToVat,\r\n  destroyVat,\r\n  getVisibleSpellcraftsForSpell,\r\n  removeSpellcraftFromVat,\r\n} from \"../backend/spellcraft/SpellcraftUtils\";\r\nimport { Spellcrafts } from \"../backend/spellcraft/Spellcrafts\";\r\nimport { Spells } from \"../backend/spells/Spells\";\r\nimport { keysOf } from \"../utils/CoreUtils\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport {\r\n  ItemGrid,\r\n  ItemGridElement,\r\n  ItemGridElementUsage,\r\n} from \"./inventory/ItemGrid\";\r\nimport { SpellcraftDetails } from \"./spellcraft/SpellcraftDetails\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { GameStateFreezer } from \"./utility/GameStateFreezer\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { SpellSelect } from \"./utility/SpellSelect\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"./utility/UIContext\";\r\nimport { GameIcon } from \"./utility/icons/GameIcon\";\r\n\r\nfunction SpellcraftRow(props: { vatId: string; index: number }) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const theme = useTheme();\r\n\r\n  const [collapsed, setCollapsed] = useState(true);\r\n  const [selectedElement, setSelectedElement] = useState(\r\n    null as ItemGridElement | null,\r\n  );\r\n\r\n  const onPressItem = React.useCallback(\r\n    (item: ItemGridElement) => {\r\n      setSelectedElement(item);\r\n    },\r\n    [setSelectedElement],\r\n  );\r\n\r\n  const selectedElementRef = useRef(selectedElement);\r\n  selectedElementRef.current = selectedElement;\r\n\r\n  const vatId = props.vatId;\r\n  const spellcraftData = state.run.spellcrafts[vatId];\r\n  const spellcraft = Spellcrafts.getByIdNullable(spellcraftData.spellcraftId);\r\n\r\n  const spellcraftName = spellcraft != null ? spellcraft.getName() : t(\"Empty\");\r\n  const spellcraftSpell =\r\n    spellcraftData.spellId != null\r\n      ? Spells.getById(spellcraftData.spellId)\r\n      : null;\r\n\r\n  const title = t(\"Vat {{index}} - {{spellcraftName}}\", {\r\n    index: formatNumber(props.index + 1),\r\n    spellcraftName,\r\n  });\r\n  const subtitle =\r\n    spellcraftSpell != null\r\n      ? t(\"On spell: {{spell}}\", { spell: spellcraftSpell.getSpellName() })\r\n      : \"\";\r\n\r\n  const uiContext = useContext(UIContext);\r\n  const [_isModalSelectorOpen, setIsModalSelectorOpen] = useUIStateFromContext(\r\n    uiContext,\r\n    \"picker_open\",\r\n    false,\r\n  );\r\n  const [showingSpellSelector, setShowingSpellSelector] = useState(false);\r\n\r\n  const showModal = useCallback(() => {\r\n    setShowingSpellSelector(true);\r\n    setIsModalSelectorOpen(true);\r\n  }, [setShowingSpellSelector, setIsModalSelectorOpen]);\r\n  const hideModal = useCallback(() => {\r\n    setShowingSpellSelector(false);\r\n    setIsModalSelectorOpen(false);\r\n  }, [setShowingSpellSelector, setIsModalSelectorOpen]);\r\n\r\n  const [confirmDestroy, setConfirmDestroy] = useState(false);\r\n  const destroyVatCallback = useCallback(() => {\r\n    if (confirmDestroy) {\r\n      stateRef.current.apply((state) => {\r\n        state = destroyVat(state, vatId);\r\n        buildSpellcraftingVat._demolishUnsafe(state, 1);\r\n        return state;\r\n      });\r\n    } else {\r\n      setConfirmDestroy(true);\r\n    }\r\n  }, [confirmDestroy]);\r\n\r\n  const setSpellCallback = useCallback(\r\n    (spellId: string) => {\r\n      stateRef.current.apply((state) =>\r\n        assignSpellToVat(state, vatId, spellId),\r\n      );\r\n      hideModal();\r\n    },\r\n    [vatId, hideModal],\r\n  );\r\n\r\n  const removeSpellcraftCallback = useCallback(() => {\r\n    stateRef.current.apply((state) => removeSpellcraftFromVat(state, vatId));\r\n  }, [vatId]);\r\n\r\n  const spellcrafts =\r\n    spellcraftSpell != null\r\n      ? getVisibleSpellcraftsForSpell(state, spellcraftSpell)\r\n      : [];\r\n\r\n  const itemGridElements = useMemo(\r\n    () =>\r\n      spellcraftSpell != null && spellcraft == null\r\n        ? spellcrafts.map((spellcraft) => ({\r\n            itemOrSpellId: spellcraft.getBaseItem().getId(),\r\n            amount: 1,\r\n            params: spellcraft.getBaseItem().getDefaultParams(),\r\n            disabled: !spellcraft.isSpellCompatible(spellcraftSpell),\r\n          }))\r\n        : [],\r\n    [\r\n      spellcrafts.map((spellcraft) => spellcraft.getId()).join(),\r\n      spellcraftSpell,\r\n      spellcraft,\r\n    ],\r\n  );\r\n\r\n  const itemGridElementsJSON = useMemo(\r\n    () => JSON.stringify(itemGridElements),\r\n    [itemGridElements],\r\n  );\r\n\r\n  useEffect(() => setSelectedElement(undefined), [itemGridElementsJSON]);\r\n\r\n  const selectedSpellcraft =\r\n    selectedElement != null\r\n      ? (Spellcrafts.getAll().find(\r\n          (spellcraft) =>\r\n            spellcraft.getBaseItem().getId() == selectedElement?.itemOrSpellId,\r\n        ) as Spellcraft)\r\n      : undefined;\r\n\r\n  const itemGrid = useMemo(\r\n    () => (\r\n      <ItemGrid\r\n        items={itemGridElements}\r\n        location={ItemGridElementUsage.SPELLCRAFT}\r\n        onPressItem={onPressItem}\r\n      />\r\n    ),\r\n    [itemGridElementsJSON, onPressItem],\r\n  );\r\n\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  const modal = useMemo(\r\n    () => (\r\n      <Modal\r\n        key=\"changeSpell\"\r\n        visible={showingSpellSelector}\r\n        onDismiss={hideModal}\r\n        contentContainerStyle={[\r\n          styles.overlay,\r\n          {\r\n            maxWidth: Math.min(width - 16, 640),\r\n            maxHeight: height - 32,\r\n            backgroundColor: theme.colors.background,\r\n          },\r\n        ]}\r\n      >\r\n        <View style={[Styles.flex, Styles.p16]}>\r\n          <SpellSelect\r\n            onSelect={setSpellCallback}\r\n            spellId={spellcraftData.spellId}\r\n          />\r\n        </View>\r\n      </Modal>\r\n    ),\r\n    [\r\n      showingSpellSelector,\r\n      hideModal,\r\n      width,\r\n      height,\r\n      theme,\r\n      setSpellCallback,\r\n      spellcraftData.spellId,\r\n    ],\r\n  );\r\n\r\n  const elementTheme =\r\n    spellcraftSpell != null\r\n      ? getThemeByElementAndDarkMode(spellcraftSpell.getElement(), theme.dark)\r\n      : theme;\r\n\r\n  const backgroundColor = elementTheme.colors.secondaryContainer;\r\n\r\n  const icon = useMemo(\r\n    () =>\r\n      spellcraft != null ? (\r\n        <View\r\n          style={[styles.tile, { borderColor: elementTheme.colors.outline }]}\r\n        >\r\n          <GameIcon icon={spellcraft.getBaseItem().getId()} />\r\n        </View>\r\n      ) : (\r\n        <View\r\n          style={[styles.tile, { borderColor: elementTheme.colors.outline }]}\r\n        ></View>\r\n      ),\r\n    [spellcraft, elementTheme],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      // @ts-ignore It works\r\n      <ThemeProvider theme={elementTheme}>\r\n        <Surface\r\n          mode=\"flat\"\r\n          key={props.vatId}\r\n          style={[styles.rowContainer, { backgroundColor }]}\r\n        >\r\n          <TouchableOpacity\r\n            onPress={() => setCollapsed(!collapsed)}\r\n            style={styles.expandTouchable}\r\n          >\r\n            <View style={Styles.flexRowSpaceBetween}>\r\n              <View style={Styles.flexRowAlignCenter}>\r\n                {icon}\r\n                <View style={Styles.ml8}>\r\n                  <Text h4 style={Styles.bold}>\r\n                    {title}\r\n                  </Text>\r\n                  {subtitle != \"\" && <Text>{subtitle}</Text>}\r\n                </View>\r\n              </View>\r\n              <Entypo\r\n                name={collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={elementTheme.colors.onBackground}\r\n              />\r\n            </View>\r\n          </TouchableOpacity>\r\n          <GameStateFreezer isVisible={!collapsed}>\r\n            <View style={collapsed ? { display: \"none\" } : null}>\r\n              <View style={Styles.mt16}>\r\n                <View style={Styles.flexRowSpaceBetween}>\r\n                  <Markdown>\r\n                    {t(\"Spell: **{{spell}}**\", {\r\n                      spell: spellcraftSpell?.getSpellName?.() ?? t(\"None\"),\r\n                    })}\r\n                  </Markdown>\r\n                  <Button onPress={showModal} compact={true}>\r\n                    {t(\"Select spell\")}\r\n                  </Button>\r\n                  <Portal>{modal}</Portal>\r\n                </View>\r\n              </View>\r\n              {spellcraftSpell != null && (\r\n                <View style={Styles.mt16}>\r\n                  <View style={Styles.flexRowAlignCenter}>\r\n                    <View style={[Styles.flex, Styles.mr16]}>\r\n                      <Markdown>\r\n                        {spellcraft != null\r\n                          ? t(\"Spellcraft: **{{spellcraft}} - {{effect}}**\", {\r\n                              spellcraft: spellcraftName,\r\n                              effect: spellcraft.getEffect(state),\r\n                            })\r\n                          : t(\"Spellcraft: **Empty**\")}\r\n                      </Markdown>\r\n                    </View>\r\n                    {spellcraft != null && (\r\n                      <Button onPress={removeSpellcraftCallback} compact={true}>\r\n                        {t(\"Remove\")}\r\n                      </Button>\r\n                    )}\r\n                  </View>\r\n                  {itemGridElements.length == 0 && spellcraft == null && (\r\n                    <View style={Styles.mt8}>\r\n                      <Text style={{ fontStyle: \"italic\" }}>\r\n                        {t(\r\n                          \"You have no known Spellcrafts that could affect this spell!\",\r\n                        )}\r\n                      </Text>\r\n                    </View>\r\n                  )}\r\n                  {itemGridElements.length > 0 && (\r\n                    <View style={Styles.mt8}>{itemGrid}</View>\r\n                  )}\r\n                  {selectedElement != null && (\r\n                    <View style={Styles.mt8}>\r\n                      <SpellcraftDetails\r\n                        vatId={vatId}\r\n                        spellcraftId={selectedSpellcraft.getId()}\r\n                      />\r\n                    </View>\r\n                  )}\r\n                </View>\r\n              )}\r\n              <View style={[Styles.mt16, Styles.ph8]}>\r\n                <CategoryContainer\r\n                  title={t(\"Destroy Vat\")}\r\n                  initiallyExpanded={false}\r\n                  dividerColor={elementTheme.colors.outline}\r\n                >\r\n                  <View style={Styles.mt8}>\r\n                    <Markdown>\r\n                      {t(\r\n                        \"If you want to recover the land used by a Spellcrafting Vat, you can destroy the vat here. If you have an active Spellcraft, you will regain the items you used.\",\r\n                      )}\r\n                    </Markdown>\r\n                    <View style={[Styles.mt8, Styles.flexCenter]}>\r\n                      <Button onPress={destroyVatCallback}>\r\n                        {confirmDestroy\r\n                          ? t(\"Press again to confirm\")\r\n                          : t(\"Destroy Vat\")}\r\n                      </Button>\r\n                    </View>\r\n                  </View>\r\n                </CategoryContainer>\r\n              </View>\r\n            </View>\r\n          </GameStateFreezer>\r\n        </Surface>\r\n      </ThemeProvider>\r\n    ),\r\n    [\r\n      collapsed,\r\n      setCollapsed,\r\n      elementTheme,\r\n      title,\r\n      subtitle,\r\n      icon,\r\n      !collapsed && spellcraftSpell,\r\n      !collapsed && hideModal,\r\n      !collapsed && spellcraft?.getEffect?.(state),\r\n      !collapsed && spellcraftName,\r\n      !collapsed && selectedElement,\r\n      !collapsed && JSON.stringify(spellcraftData),\r\n      !collapsed && destroyVatCallback,\r\n      !collapsed && removeSpellcraftCallback,\r\n      !collapsed && confirmDestroy,\r\n      elementTheme,\r\n      modal,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function SpellcraftsComponent() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const vatIds = keysOf(state.run.spellcrafts);\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={styles.topContainer}>\r\n        {vatIds.length > 0 ? (\r\n          <View>\r\n            {vatIds.map((vatId, index) => (\r\n              <View key={vatId} style={Styles.pv4}>\r\n                <SpellcraftRow index={index} vatId={vatId} key={vatId} />\r\n              </View>\r\n            ))}\r\n          </View>\r\n        ) : (\r\n          <Markdown>\r\n            {t(\r\n              \"In this screen, you can do Spellcrafting to modify the effects of your spells. However, you have no vats right now, which are needed to do so. Build a Spellcrafting Vat in your Home to get one!\",\r\n            )}\r\n          </Markdown>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [vatIds.join()]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    width: \"100%\",\r\n  },\r\n  contentContainer: {\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 4,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  hintProgress: {\r\n    marginTop: 4,\r\n  },\r\n  loadoutsContainer: {\r\n    borderTopWidth: 1,\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 4,\r\n  },\r\n  categoryTitle: {\r\n    marginLeft: 8,\r\n  },\r\n  categoryContainer: {\r\n    paddingTop: 4,\r\n    marginBottom: 8,\r\n  },\r\n  campusContainer: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  campusHintWarning: {\r\n    marginTop: 16,\r\n  },\r\n  optionRow: {\r\n    marginTop: 8,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    gap: 8,\r\n    justifyContent: \"space-around\",\r\n  },\r\n  overlay: {\r\n    alignSelf: \"center\",\r\n    marginHorizontal: 16,\r\n    maxWidth: 640,\r\n  },\r\n  messageLogContainer: {\r\n    padding: 8,\r\n    borderColor: \"#444\",\r\n    borderWidth: 1,\r\n    maxHeight: 320,\r\n  },\r\n  rowContainer: {\r\n    padding: 8,\r\n    borderRadius: 8,\r\n  },\r\n  topContainer: {\r\n    gap: 8,\r\n  },\r\n  expandTouchable: {\r\n    // @ts-ignore This is a valid property\r\n    cursor: \"pointer\",\r\n  },\r\n  tile: {\r\n    borderWidth: 0.5,\r\n    height: 32,\r\n    width: 32,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n});\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { setFlag } from \"../../../Flags\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport { registerPostRetirementListener } from \"../../../Retire\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nexport const convenienceStoryline = new Storyline(\r\n  \"convenience\",\r\n  t(\"Convenience\"),\r\n  327,\r\n  10,\r\n  (state) => t(\"Expand your home at least 20 times\"),\r\n  (state) =>\r\n    t('Unlock \"Auto purchase max\" option for furniture and \"Expand Home\"'),\r\n  (state) => true,\r\n);\r\n\r\nexport function loadConvenience() {\r\n  Storylines.register(convenienceStoryline);\r\n  const eventBuilder = buildEvent(\"convenience\", t(\"(Storyline) Convenience\"), [\r\n    EventTag.STORYLINE,\r\n  ]).setStorylineIds(convenienceStoryline.getId());\r\n\r\n  eventBuilder.message(\r\n    t(`Your home has come a long way since you started working towards obtaining the Philosopher's Stone. It is now much, much bigger than it initially was - you think it is at least five times larger!\r\n    \r\nAnd yet, even with all the furniture you have, it feels almost as if you could never have enough...`),\r\n  );\r\n  eventBuilder\r\n    .message(\r\n      t(`The process of building furniture and expanding your home has left you frankly quite tired. If only there was a way to make it at least a little easier...\r\n    \r\n...even if just a little...\r\n\r\n...*wait*, you think there *might* be a way!`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = convenienceStoryline.complete(state);\r\n          state = convenienceStoryline.activateBonus(state);\r\n          state = setFlag(Flag.AutoPurchaseUnlocked)(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    );\r\n  eventBuilder\r\n    .message(\r\n      t(`Of course. Magic spells are difficult, but... you could definitely make building furniture and expanding your home *happen automatically*! Why didn't you think of this before?\r\n      \r\nYou write down the idea in your diary. You can't wait to apply it... right away.\r\n\r\n**You have completed the \"Convenience\" Storyline! You have permanently unlocked a feature to automatically build furniture, expand your home or purchase Enhancements (and a few other things) once you can afford to. You can toggle this feature for each individual furniture in the Home screen, by expanding its details. Tip: this is especially useful for Catalysts!**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const event = eventBuilder.build();\r\n\r\n  addGameStateListener(event.getId(), (state) => {\r\n    if (\r\n      !event.hasTriggered(state) &&\r\n      !convenienceStoryline.isCompleted(state) &&\r\n      state.run.landPurchaseCount >= 20\r\n    ) {\r\n      return triggerEvent(event);\r\n    }\r\n  });\r\n\r\n  registerPostRetirementListener(\r\n    convenienceStoryline.getId(),\r\n    (state, isMock) => {\r\n      if (convenienceStoryline.isBonusActive(state)) {\r\n        state = setFlag(Flag.AutoPurchaseUnlocked)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport { registerSpell } from \"../../spells/Spells\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport { Buildings, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass EssenceCatalyst extends Building {\r\n  getId(): string {\r\n    return \"essenceCatalyst\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Essence Catalyst\");\r\n  }\r\n\r\n  catalystTags = memoize(() => [\r\n    TransformationTags.CatalystEffectivity,\r\n    this.getId(),\r\n  ]);\r\n\r\n  getPerCatalystBonusMultiplier(state: GameState): number {\r\n    return 1.0 + applyTransformations(this.catalystTags(), state, 0.15);\r\n  }\r\n\r\n  catalystEffectivityParams = {\r\n    valueType: TransformationValueType.Percent,\r\n  };\r\n\r\n  getPerCatalystBonusMultiplierExplanation(state: GameState): string {\r\n    return explainTransformationsText(\r\n      this.catalystTags(),\r\n      state,\r\n      0.15,\r\n      this.catalystEffectivityParams,\r\n    );\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A catalyst for channeling. Greatly empowers channeling strength for all elements.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effectPct = (this.getPerCatalystBonusMultiplier(state) - 1.0) * 100;\r\n    return t(\"^+{{effectPct}}%^<{{explanation}}> production from Channeling\", {\r\n      effectPct: formatNumber(effectPct),\r\n      explanation: this.getPerCatalystBonusMultiplierExplanation(state),\r\n    });\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 10;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst essenceCatalyst = new EssenceCatalyst();\r\n\r\nclass BuildEssenceCatalyst extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.CATALYSTS] };\r\n  }\r\n\r\n  getBuilding(): EssenceCatalyst {\r\n    return essenceCatalyst;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      FireEssence: 200,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      FireEssence: 2.0,\r\n    };\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 20;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.CatalystsUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nconst buildEssenceCatalyst = new BuildEssenceCatalyst();\r\n\r\nexport function loadEssenceCatalysts() {\r\n  Buildings.register(essenceCatalyst);\r\n  registerSpell(buildEssenceCatalyst);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.ChannelingEfficiency]],\r\n    \"essenceCatalyst\",\r\n    t(\"Essence Catalyst\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      const building = Buildings.getById(\"essenceCatalyst\") as EssenceCatalyst;\r\n      return Math.pow(\r\n        building.getPerCatalystBonusMultiplier(state),\r\n        getBuildingAmount(state, building),\r\n      );\r\n    },\r\n  );\r\n}\r\n\r\nexport { buildEssenceCatalyst, essenceCatalyst };\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n  clearCalculatedIncomeCache,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport { BuildingAmountListeners, getBuildingAmount } from \"../Buildings\";\r\n\r\nconst BASE_REGEN = 0.75;\r\nconst productionTags = [\r\n  TransformationTags.Production,\r\n  Resource.Mana,\r\n  \"manaSpout\",\r\n];\r\nfunction getManaRegenPerSec(state: GameState): number {\r\n  return applyTransformations(productionTags, state, BASE_REGEN);\r\n}\r\n\r\nclass ManaSpout extends Building {\r\n  getId(): string {\r\n    return \"manaSpout\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Mana Spout\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A small piece of furniture that automatically produces Mana. Key for any wizard.\",\r\n    );\r\n  }\r\n\r\n  effectUnit = memoize(() => ({ unit: t(\":mana:/sec\") }));\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"^+{{manaRegenPerSec}}^<{{explanation}}>:mana:/sec\", {\r\n      manaRegenPerSec: formatNumber(getManaRegenPerSec(state), {\r\n        showDecimals: true,\r\n      }),\r\n      explanation: explainTransformationsText(\r\n        productionTags,\r\n        state,\r\n        BASE_REGEN,\r\n        this.effectUnit(),\r\n      ),\r\n    });\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 2;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst manaSpout = new ManaSpout();\r\n\r\nclass BuildManaSpout extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.MANA] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return manaSpout;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      WaterEssence: 10,\r\n      AirEssence: 5,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      WaterEssence: 1.25,\r\n      AirEssence: 1.25,\r\n    };\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 10;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.ManaSpoutsUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nconst buildManaSpout = new BuildManaSpout();\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\r\n    manaSpout.getId(),\r\n    manaSpout.getName(),\r\n    (state) => ({\r\n      Mana: getManaRegenPerSec(state) * getBuildingAmount(state, manaSpout),\r\n    }),\r\n  ),\r\n);\r\n\r\nBuildingAmountListeners.register((state, building) => {\r\n  if (building == manaSpout) {\r\n    state = clearCalculatedIncomeCache(state);\r\n  }\r\n  return state;\r\n});\r\n\r\nexport { buildManaSpout as BuildManaSpout, manaSpout as ManaSpout };\r\n","import memoize from \"sonic-memoize\";\r\nimport { valuesOf } from \"../../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { cacheByArbitraryVersion } from \"../../Caching\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource, clearResourceCapCache } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { SpellElement, getUnlockedElements } from \"../../spells/Elements\";\r\nimport { registerSpell } from \"../../spells/Spells\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../spells/channeling/ChannelingResources\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformationsCached,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport {\r\n  BuildingAmountListeners,\r\n  Buildings,\r\n  getBuildingAmount,\r\n} from \"../Buildings\";\r\n\r\nclass EssenceStorage extends Building {\r\n  getId(): string {\r\n    return \"essenceStorage\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Essence Storage\");\r\n  }\r\n\r\n  perBuildingCapTags = memoize((resource) => [\r\n    TransformationTags.PerBuildingCap,\r\n    resource,\r\n    this.getId(),\r\n  ]);\r\n\r\n  perBuildingCapParams = memoize((resource) => ({ resource }));\r\n\r\n  getPerStorageBonusCap(state: GameState, resource: Resource): number {\r\n    return applyTransformationsCached(\r\n      this.perBuildingCapTags(resource),\r\n      state,\r\n      400,\r\n      this.perBuildingCapParams(resource),\r\n    );\r\n  }\r\n\r\n  perBuildingCapExplanationParams = memoize((resource) => ({\r\n    resource,\r\n    unit: t(\" Max{{resourceIcon}}\", {\r\n      resourceIcon: `:${resource.toLowerCase()}:`,\r\n    }),\r\n  }));\r\n\r\n  getPerStorageBonusCapExplanation(\r\n    state: GameState,\r\n    resource: Resource,\r\n  ): string {\r\n    return explainTransformationsText(\r\n      this.perBuildingCapTags(resource),\r\n      state,\r\n      400,\r\n      this.perBuildingCapExplanationParams(resource),\r\n    );\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A magical storage that allows you to accumulate more elemental Essence.\",\r\n    );\r\n  }\r\n\r\n  _getDisplayEffectUncached(state: GameState): string {\r\n    return getUnlockedElements(state)\r\n      .map((element) => {\r\n        return t(\"^+{{amount}}^<{{explanation}}> Max{{resourceIcon}}\", {\r\n          amount: formatNumber(\r\n            this.getPerStorageBonusCap(state, RESOURCE_FOR_ELEMENT[element]),\r\n          ),\r\n          resourceIcon: `:${RESOURCE_FOR_ELEMENT[element].toLowerCase()}:`,\r\n          explanation: this.getPerStorageBonusCapExplanation(\r\n            state,\r\n            RESOURCE_FOR_ELEMENT[element],\r\n          ),\r\n        });\r\n      })\r\n      .join(t(\", \"));\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return cacheByArbitraryVersion(\r\n      state,\r\n      \"essenceStoragesEffect\",\r\n      (state) => this._getDisplayEffectUncached(state),\r\n      (state) =>\r\n        JSON.stringify(\r\n          getUnlockedElements(state).map((element) => {\r\n            return this.getPerStorageBonusCap(\r\n              state,\r\n              RESOURCE_FOR_ELEMENT[element],\r\n            );\r\n          }),\r\n        ),\r\n    );\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 5;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst essenceStorage = new EssenceStorage();\r\n\r\nclass BuildEssenceStorage extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.STORAGE] };\r\n  }\r\n\r\n  getBuilding(): EssenceStorage {\r\n    return essenceStorage;\r\n  }\r\n\r\n  shouldNeverHaveDemolishBlockers(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return { EarthEssence: 60 };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      EarthEssence: 1.4,\r\n    };\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 20;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.StoragesUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst buildEssenceStorage = new BuildEssenceStorage();\r\n\r\nexport function loadEssenceStorages() {\r\n  Buildings.register(essenceStorage);\r\n  registerSpell(buildEssenceStorage);\r\n\r\n  for (let element of valuesOf(SpellElement)) {\r\n    registerTransformation(\r\n      [[TransformationTags.Cap, RESOURCE_FOR_ELEMENT[element]]],\r\n      \"essenceStorage\" + element,\r\n      t(\"Essence Storage\"),\r\n      TransformationType.Addition,\r\n      (state, params) => {\r\n        return (\r\n          getBuildingAmount(state, essenceStorage) *\r\n          essenceStorage.getPerStorageBonusCap(\r\n            state,\r\n            RESOURCE_FOR_ELEMENT[element],\r\n          )\r\n        );\r\n      },\r\n    );\r\n  }\r\n\r\n  BuildingAmountListeners.register((state, building) => {\r\n    if (building == essenceStorage) {\r\n      state = clearResourceCapCache(state);\r\n    }\r\n    return state;\r\n  }, essenceStorage.getId());\r\n}\r\n\r\nexport { buildEssenceStorage, essenceStorage };\r\n","import memoize from \"sonic-memoize\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource, clearResourceCapCache } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport { clearManaCostCache } from \"../../spells/Spells\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport { BuildingAmountListeners, getBuildingAmount } from \"../Buildings\";\r\n\r\nconst BASE_BONUS = 100;\r\nconst perBuildingCapTags = [\r\n  TransformationTags.PerBuildingCap,\r\n  Resource.Mana,\r\n  \"manaShard\",\r\n];\r\nfunction getMaxManaBonus(state: GameState): number {\r\n  return applyTransformations(perBuildingCapTags, state, BASE_BONUS, {\r\n    resource: Resource.Mana,\r\n  });\r\n}\r\nconst explanationParams = memoize(() => ({\r\n  resource: Resource.Mana,\r\n  unit: t(\" Max:mana:\"),\r\n}));\r\nfunction getMaxManaBonusExplanation(state: GameState): string {\r\n  return explainTransformationsText(\r\n    perBuildingCapTags,\r\n    state,\r\n    BASE_BONUS,\r\n    explanationParams(),\r\n  );\r\n}\r\n\r\nclass ManaShard extends Building {\r\n  getId(): string {\r\n    return \"manaShard\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Mana Shard\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A small furniture that allows you to accumulate more Mana, to cast more powerful spells.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"^+{{maxMana}}^<{{explanation}}> Max:mana:\", {\r\n      maxMana: getMaxManaBonus(state),\r\n      explanation: getMaxManaBonusExplanation(state),\r\n    });\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 2;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst manaShard = new ManaShard();\r\n\r\nclass BuildManaShard extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.MANA] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return manaShard;\r\n  }\r\n\r\n  shouldNeverHaveDemolishBlockers(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      EarthEssence: 40,\r\n      WaterEssence: 20,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      EarthEssence: 1.25,\r\n      WaterEssence: 1.25,\r\n    };\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 10;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.ManaShardsUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst buildManaShard = new BuildManaShard();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cap, Resource.Mana]],\r\n  \"manaShards\",\r\n  t(\"Mana Shards\"),\r\n  TransformationType.Addition,\r\n  (state, params) =>\r\n    getBuildingAmount(state, manaShard) * getMaxManaBonus(state),\r\n);\r\n\r\nBuildingAmountListeners.register((state, building) => {\r\n  if (building == manaShard) {\r\n    state = clearResourceCapCache(state);\r\n    state = clearManaCostCache(state);\r\n  }\r\n  return state;\r\n}, manaShard.getId());\r\n\r\nexport { buildManaShard as BuildManaShard, manaShard as ManaShard };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport { TransmutationSpell } from \"../TransmutationSpell\";\r\n\r\nclass CopperOre extends Item {\r\n  getId(): string {\r\n    return \"copperOre\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./copperOre.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Ore\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"Ore. Needs to be processed to be able to actually utilize it.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 36;\r\n  }\r\n}\r\n\r\nexport const copperOre = new CopperOre();\r\n\r\nclass TransmuteCopperOre extends TransmutationSpell {\r\n  getItem(): Item {\r\n    return copperOre;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 24,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        EarthEssence: 10000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteCopperOre = new TransmuteCopperOre();\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport {\r\n  modifyCompanionCurrentHP,\r\n  modifyEnemyCurrentHP,\r\n  modifyPlayerCurrentHP,\r\n} from \"../exploration/Exploration\";\r\nimport { GameState } from \"../GameState\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { applyTransformations } from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffects,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Poison extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"poison\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Poison\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./poison.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  poisonDoTAmountTags = memoize((target) => [\r\n    this.getId(),\r\n    TransformationTags.PoisonDoTAmount,\r\n    target,\r\n  ]);\r\n  getDamagePerSec(state: GameState, temporaryEffectData: TemporaryEffectData) {\r\n    return applyTransformations(\r\n      this.poisonDoTAmountTags(temporaryEffectData.target),\r\n      state,\r\n      temporaryEffectData.params.magnitude ?? 0,\r\n      { target: temporaryEffectData.target },\r\n    );\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-{{amount}}:hp:/sec\", {\r\n      amount: formatNumber(this.getDamagePerSec(state, temporaryEffectData), {\r\n        showDecimals: true,\r\n      }),\r\n    });\r\n  }\r\n  // For Poison, if the damage per sec is different, keep the one with the\r\n  // higher total damage left\r\n  mergeData(\r\n    state: GameState,\r\n    oldData: TemporaryEffectData,\r\n    newData: TemporaryEffectData,\r\n    mode: \"add\" | \"replace\",\r\n  ): TemporaryEffectData {\r\n    if (oldData.params.magnitude == newData.params.magnitude) {\r\n      return super.mergeData(state, oldData, newData, mode);\r\n    }\r\n    const now = getSecondsPlayed(state);\r\n    const totalDamageOld = (oldData.endTime - now) * oldData.params.magnitude;\r\n    const totalDamageNew = (newData.endTime - now) * newData.params.magnitude;\r\n    if (totalDamageNew < totalDamageOld) {\r\n      return oldData;\r\n    }\r\n    return newData;\r\n  }\r\n}\r\n\r\nexport const poison = new Poison();\r\n\r\nexport function loadPoison() {\r\n  TemporaryEffects.register(poison);\r\n\r\n  registerTimeTickListener(\"PoisonDoT\", (state, timeElapsedSec) => {\r\n    const temporaryEffects = getTemporaryEffects(\r\n      state,\r\n      (state, effect) => effect.id == poison.getId(),\r\n    );\r\n    temporaryEffects.forEach((effect) => {\r\n      if (effect.target === AttackTarget.Enemy) {\r\n        state = modifyEnemyCurrentHP(\r\n          state,\r\n          -poison.getDamagePerSec(state, effect) * timeElapsedSec,\r\n        );\r\n      } else if (effect.target === AttackTarget.Familiar) {\r\n        state = modifyCompanionCurrentHP(\r\n          state,\r\n          -poison.getDamagePerSec(state, effect) * timeElapsedSec,\r\n          poison.getDisplayName(),\r\n        );\r\n      } else {\r\n        state = modifyPlayerCurrentHP(\r\n          state,\r\n          -poison.getDamagePerSec(state, effect) * timeElapsedSec,\r\n          poison.getDisplayName(),\r\n        );\r\n      }\r\n    });\r\n    return state;\r\n  });\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatActionResultListeners } from \"../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../GameState\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { poison } from \"./Poison\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass NoxiousCloak extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"noxiousCloak\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Noxious Cloak\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./noxiousCloak.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"Applies Poison (-{{magnitude}}:hp:/sec for {{duration}} sec) when hit\",\r\n      {\r\n        magnitude: formatNumber(temporaryEffectData.params.magnitude, {\r\n          showDecimals: true,\r\n        }),\r\n        duration: formatNumber(temporaryEffectData.params.duration),\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const noxiousCloak = new NoxiousCloak();\r\n\r\nexport function loadNoxiousCloak() {\r\n  TemporaryEffects.register(noxiousCloak);\r\n\r\n  CombatActionResultListeners.register((state, result) => {\r\n    if (\r\n      (result.tags.includes(TransformationTags.AutoAttack) ||\r\n        result.source == AttackTarget.Enemy ||\r\n        result.source == AttackTarget.Familiar) &&\r\n      hasTemporaryEffect(state, noxiousCloak.getId(), result.target)\r\n    ) {\r\n      const temporaryEffectData = getTemporaryEffectData(\r\n        state,\r\n        noxiousCloak.getId(),\r\n        result.target,\r\n      );\r\n      state = grantTemporaryEffect(\r\n        poison.getId(),\r\n        temporaryEffectData.params.duration,\r\n        {\r\n          target: result.source,\r\n          params: { magnitude: temporaryEffectData.params.magnitude },\r\n        },\r\n      )(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport SlimeDrop from \"../../../items/material/SlimeDrop\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { noxiousCloak } from \"../../../temporaryeffects/NoxiousCloak\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass EvolvedSlime extends Enemy {\r\n  getId(): string {\r\n    return \"evolvedSlime\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Evolved Slime\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 550,\r\n      attack: 32,\r\n      defense: 10,\r\n      attackDelay: 2.5,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./evolvedSlime.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 9;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 48;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 15;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (!hasTemporaryEffect(state, noxiousCloak.getId(), AttackTarget.Enemy)) {\r\n      return {\r\n        name: t(\"Noxious Cloak\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) =>\r\n          grantTemporaryEffect(noxiousCloak.getId(), 60, {\r\n            target: AttackTarget.Enemy,\r\n            params: {\r\n              magnitude: this.getAttack(state) / 8,\r\n              duration: 1,\r\n            },\r\n          })(state),\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: SlimeDrop.getId(),\r\n        amount: 1,\r\n        chance: 1.0,\r\n      },\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 1,\r\n        chance: 0.35,\r\n      },\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 1,\r\n        chance: 0.4,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new EvolvedSlime();\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Airborne extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"airborne\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Airborne\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t('-20:accuracy:; immune to Earth damage and to \"Grounded\"');\r\n  }\r\n}\r\n\r\nexport const airborne = new Airborne();\r\n\r\nexport function loadAirborne() {\r\n  TemporaryEffects.register(airborne);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"airborneDamage\",\r\n    airborne.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(state, airborne.getId(), params.target) &&\r\n        (params.tags ?? []).includes(SpellElement.Earth)\r\n        ? 0\r\n        : 1.0;\r\n    },\r\n  );\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.Accuracy, target]],\r\n      \"airborne\" + target,\r\n      airborne.getDisplayName(),\r\n      TransformationType.Addition,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, airborne.getId(), target) ? -20 : 0;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    airborne.getId(),\r\n    CombatStat.Accuracy,\r\n  );\r\n\r\n  registerTemporaryEffectListener(\r\n    \"airborneGroundedPrevention\",\r\n    (state, temporaryEffect) => {\r\n      if (\r\n        !hasTemporaryEffect(state, airborne.getId(), temporaryEffect.target)\r\n      ) {\r\n        return temporaryEffect;\r\n      }\r\n      if (temporaryEffect.id != \"grounded\") {\r\n        return temporaryEffect;\r\n      }\r\n      // Prevent!\r\n      temporaryEffect.endTime = getSecondsPlayed(state) - 1.0;\r\n      return temporaryEffect;\r\n    },\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass ResistAttackSpell extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"attackSpellProtection\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Spell Barrier\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"{{amount}} damage received from attack spells\", {\r\n      amount: formatMultiplier(temporaryEffectData.params.damageMultiplier),\r\n    });\r\n  }\r\n}\r\n\r\nexport const resistAttackSpell = new ResistAttackSpell();\r\n\r\nexport function loadResistAttackSpell() {\r\n  TemporaryEffects.register(resistAttackSpell);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"attackSpellProtection\",\r\n    t(\"Resist Attack Spells\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(\r\n        state,\r\n        resistAttackSpell.getId(),\r\n        params.target,\r\n      ) && (params.tags ?? []).includes(TransformationTags.AttackSpell)\r\n        ? getTemporaryEffectData(\r\n            state,\r\n            resistAttackSpell.getId(),\r\n            params.target,\r\n          ).params.damageMultiplier\r\n        : 1.0;\r\n    },\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass ResistAutoAttack extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"autoAttackProtection\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Physical Barrier\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"{{amount}} damage received from physical attacks (auto-attacks)\",\r\n      {\r\n        amount: formatMultiplier(temporaryEffectData.params.damageMultiplier),\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const resistAutoAttack = new ResistAutoAttack();\r\n\r\nexport function loadResistAutoAttack() {\r\n  TemporaryEffects.register(resistAutoAttack);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"autoAttackProtection\",\r\n    t(\"Physical Barrier\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(\r\n        state,\r\n        resistAutoAttack.getId(),\r\n        params.target,\r\n      ) && (params.tags ?? []).includes(TransformationTags.AutoAttack)\r\n        ? getTemporaryEffectData(state, resistAutoAttack.getId(), params.target)\r\n            .params.damageMultiplier\r\n        : 1.0;\r\n    },\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { formatMultiplier, formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport {\r\n  getStatFromTarget,\r\n  modifyTargetCurrentHP,\r\n} from \"../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../exploration/ExplorationUtils\";\r\nimport { GameState } from \"../GameState\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  getTemporaryEffects,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Berserk extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"berserk\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Berserk\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getDamagePerSec(state: GameState, temporaryEffectData: TemporaryEffectData) {\r\n    const target = temporaryEffectData.target;\r\n    const maxHP = getStatFromTarget(state, target, CombatStat.MaxHP);\r\n    const fraction = temporaryEffectData.params.damageMagnitude;\r\n    return maxHP * fraction;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"{{multiplier}}:attack:; -{{amount}}:hp:/sec while in combat\", {\r\n      multiplier: formatMultiplier(temporaryEffectData.params.attackMultiplier),\r\n      amount: formatNumber(this.getDamagePerSec(state, temporaryEffectData), {\r\n        showDecimals: true,\r\n      }),\r\n    });\r\n  }\r\n}\r\n\r\nexport const berserk = new Berserk();\r\n\r\nexport function loadBerserk() {\r\n  TemporaryEffects.register(berserk);\r\n\r\n  registerTimeTickListener(\"BerserkDoT\", (state, timeElapsedSec) => {\r\n    const temporaryEffects = getTemporaryEffects(\r\n      state,\r\n      (state, effect) => effect.id == berserk.getId(),\r\n    );\r\n    temporaryEffects.forEach((effect) => {\r\n      if (getExplorationStatus(state) == ExplorationStatus.Combat) {\r\n        state = modifyTargetCurrentHP(\r\n          state,\r\n          effect.target,\r\n          -berserk.getDamagePerSec(state, effect) * timeElapsedSec,\r\n          t(\"Berserk\"),\r\n        );\r\n      }\r\n    });\r\n    return state;\r\n  });\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[target, CombatStat.Attack]],\r\n      \"berserk\" + target,\r\n      berserk.getDisplayName(),\r\n      TransformationType.Multiplier,\r\n      (state) => {\r\n        if (!hasTemporaryEffect(state, berserk.getId(), target)) {\r\n          return 1.0;\r\n        }\r\n        return getTemporaryEffectData(state, berserk.getId(), target).params\r\n          .attackMultiplier;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    berserk.getId(),\r\n    CombatStat.Attack,\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { CombatActionResultListeners } from \"../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../GameState\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Wet extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"wet\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Wet\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"+10%:attackDelay:; next Fire attack received is halved in damage\",\r\n    );\r\n  }\r\n}\r\n\r\nconst wet = new Wet();\r\n\r\nexport { wet as Wet };\r\n\r\nexport function loadWet() {\r\n  TemporaryEffects.register(wet);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"wet\",\r\n    wet.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(state, wet.getId(), params.target) &&\r\n        (params.tags ?? []).includes(SpellElement.Fire)\r\n        ? 0.5\r\n        : 1.0;\r\n    },\r\n  );\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.AttackDelay, target]],\r\n      \"wet\" + target,\r\n      wet.getDisplayName(),\r\n      TransformationType.Multiplier,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, wet.getId(), target) ? 1.1 : 1.0;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    wet.getId(),\r\n    CombatStat.AttackDelay,\r\n  );\r\n\r\n  CombatActionResultListeners.register((state, result) => {\r\n    if (\r\n      result.tags.includes(SpellElement.Fire) &&\r\n      result.isHit &&\r\n      hasTemporaryEffect(state, wet.getId(), result.target)\r\n    ) {\r\n      state = clearTemporaryEffect(wet.getId(), result.target)(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { CombatActionResultListeners } from \"../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\nimport { Wet } from \"./Wet\";\r\n\r\nclass Chilled extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"chilled\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Chilled\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"+25%:attackDelay:; next Fire attack received is halved in damage\",\r\n    );\r\n  }\r\n}\r\n\r\nconst chilled = new Chilled();\r\n\r\nexport { chilled as Chilled };\r\n\r\nexport function loadChilled() {\r\n  TemporaryEffects.register(chilled);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"chilled\",\r\n    chilled.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(state, chilled.getId(), params.target) &&\r\n        (params.tags ?? []).includes(SpellElement.Fire)\r\n        ? 0.5\r\n        : 1.0;\r\n    },\r\n  );\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.AttackDelay, target]],\r\n      \"chilled\" + target,\r\n      chilled.getDisplayName(),\r\n      TransformationType.Multiplier,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, chilled.getId(), target) ? 1.25 : 1.0;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    chilled.getId(),\r\n    CombatStat.AttackDelay,\r\n  );\r\n\r\n  CombatActionResultListeners.register((state, result) => {\r\n    if (\r\n      result.tags.includes(SpellElement.Fire) &&\r\n      result.isHit &&\r\n      hasTemporaryEffect(state, chilled.getId(), result.target)\r\n    ) {\r\n      state = clearTemporaryEffect(chilled.getId(), result.target)(state);\r\n    }\r\n    return state;\r\n  });\r\n\r\n  addGameStateListener(\"wetClearerIfChilled\", (state) => {\r\n    for (let target of valuesOf(AttackTarget)) {\r\n      if (\r\n        hasTemporaryEffect(state, chilled.getId(), target) &&\r\n        hasTemporaryEffect(state, Wet.getId(), target)\r\n      ) {\r\n        return clearTemporaryEffect(Wet.getId(), target);\r\n      }\r\n    }\r\n  });\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { modifyTargetCurrentHP } from \"../exploration/Exploration\";\r\nimport {\r\n  CombatActionResult,\r\n  CombatActionResultListeners,\r\n  pushCombatActionResult,\r\n} from \"../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../GameState\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass CloakOfFlames extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"cloakOfFlames\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Cloak of Flames\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getIcon() {\r\n    return require(\"./cloakOfFlames.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"Reflects back {{multiplier}}x of the damage received as Fire damage\",\r\n      {\r\n        multiplier: formatNumber(temporaryEffectData.params.magnitude, {\r\n          showDecimals: true,\r\n        }),\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const cloakOfFlames = new CloakOfFlames();\r\n\r\nexport function loadCloakOfFlames() {\r\n  TemporaryEffects.register(cloakOfFlames);\r\n\r\n  CombatActionResultListeners.register((state, result) => {\r\n    if (!hasTemporaryEffect(state, cloakOfFlames.getId(), result.target)) {\r\n      return state;\r\n    }\r\n\r\n    if (\r\n      !result.isHit ||\r\n      result.damage <= 0 ||\r\n      result.tags.includes(TransformationTags.Reflected) ||\r\n      result.source == result.target\r\n    ) {\r\n      return state;\r\n    }\r\n\r\n    const data = getTemporaryEffectData(\r\n      state,\r\n      cloakOfFlames.getId(),\r\n      result.target,\r\n    );\r\n    const magnitude = data.params.magnitude;\r\n\r\n    const damageReflected = result.damage * magnitude;\r\n    state = modifyTargetCurrentHP(\r\n      state,\r\n      result.source,\r\n      -damageReflected,\r\n      cloakOfFlames.getDisplayName(),\r\n    );\r\n\r\n    const actionResult: CombatActionResult = {\r\n      id: Math.random().toString(),\r\n      damage: damageReflected,\r\n      isHit: true,\r\n      isCrit: false,\r\n      source: result.target,\r\n      time: getSecondsPlayed(state),\r\n      target: result.source,\r\n      tags: [SpellElement.Fire, TransformationTags.Reflected],\r\n    };\r\n    state = pushCombatActionResult(state, actionResult);\r\n\r\n    return state;\r\n  });\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport {\r\n  modifyCompanionCurrentHP,\r\n  modifyEnemyCurrentHP,\r\n  modifyPlayerCurrentHP,\r\n} from \"../exploration/Exploration\";\r\nimport { GameState } from \"../GameState\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { applyTransformations } from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffects,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Corrosion extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"corrosion\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Corrosion\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./corrosion.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  corrosionDoTAmountTags = memoize((target) => [\r\n    this.getId(),\r\n    TransformationTags.CorrosionDoTAmount,\r\n    target,\r\n  ]);\r\n  getDamagePerSec(state: GameState, temporaryEffectData: TemporaryEffectData) {\r\n    return applyTransformations(\r\n      this.corrosionDoTAmountTags(temporaryEffectData.target),\r\n      state,\r\n      temporaryEffectData.params.magnitude,\r\n      { target: temporaryEffectData.target },\r\n    );\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-{{amount}}:hp:/sec\", {\r\n      amount: formatNumber(this.getDamagePerSec(state, temporaryEffectData), {\r\n        showDecimals: true,\r\n      }),\r\n    });\r\n  }\r\n  // For Corrosion, if the damage per sec is different, keep the one with the\r\n  // higher total damage left\r\n  mergeData(\r\n    state: GameState,\r\n    oldData: TemporaryEffectData,\r\n    newData: TemporaryEffectData,\r\n    mode: \"add\" | \"replace\",\r\n  ): TemporaryEffectData {\r\n    if (oldData.params.magnitude == newData.params.magnitude) {\r\n      return super.mergeData(state, oldData, newData, mode);\r\n    }\r\n    const now = getSecondsPlayed(state);\r\n    const totalDamageOld = (oldData.endTime - now) * oldData.params.magnitude;\r\n    const totalDamageNew = (newData.endTime - now) * newData.params.magnitude;\r\n    if (totalDamageNew < totalDamageOld) {\r\n      return oldData;\r\n    }\r\n    return newData;\r\n  }\r\n}\r\n\r\nexport const corrosion = new Corrosion();\r\n\r\nexport function loadCorrosion() {\r\n  TemporaryEffects.register(corrosion);\r\n\r\n  registerTimeTickListener(\"CorrosionDoT\", (state, timeElapsedSec) => {\r\n    const temporaryEffects = getTemporaryEffects(\r\n      state,\r\n      (state, effect) => effect.id == corrosion.getId(),\r\n    );\r\n    temporaryEffects.forEach((effect) => {\r\n      if (effect.target === AttackTarget.Enemy) {\r\n        state = modifyEnemyCurrentHP(\r\n          state,\r\n          -corrosion.getDamagePerSec(state, effect) * timeElapsedSec,\r\n        );\r\n      } else if (effect.target === AttackTarget.Familiar) {\r\n        state = modifyCompanionCurrentHP(\r\n          state,\r\n          -corrosion.getDamagePerSec(state, effect) * timeElapsedSec,\r\n          corrosion.getDisplayName(),\r\n        );\r\n      } else {\r\n        state = modifyPlayerCurrentHP(\r\n          state,\r\n          -corrosion.getDamagePerSec(state, effect) * timeElapsedSec,\r\n          corrosion.getDisplayName(),\r\n        );\r\n      }\r\n    });\r\n    return state;\r\n  });\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { modifyTargetCurrentHP } from \"../exploration/Exploration\";\r\nimport {\r\n  CombatActionResultListeners,\r\n  pushCombatActionResult,\r\n} from \"../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Cursed extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"cursed\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Cursed\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./cursed.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  isCombatOnly(): boolean {\r\n    return true;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"Explicit healing effects, in addition to the healing, cause damage of the same amount\",\r\n    );\r\n  }\r\n}\r\n\r\nexport const cursed = new Cursed();\r\n\r\nexport function loadCursed() {\r\n  TemporaryEffects.register(cursed);\r\n\r\n  CombatActionResultListeners.register((state, result) => {\r\n    if (\r\n      result.damage < 0 &&\r\n      hasTemporaryEffect(state, cursed.getId(), result.target)\r\n    ) {\r\n      state = modifyTargetCurrentHP(\r\n        state,\r\n        result.target,\r\n        result.damage,\r\n        cursed.getDisplayName(),\r\n      );\r\n      const actionResult = {\r\n        id: Math.random().toString(),\r\n        damage: -result.damage,\r\n        isCrit: false,\r\n        isHit: true,\r\n        time: getSecondsPlayed(state),\r\n        source: result.target,\r\n        target: result.target,\r\n        tags: [cursed.getId()],\r\n      };\r\n      state = pushCombatActionResult(state, actionResult);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { clearCombatStatCache, CombatStat } from \"../exploration/CombatStats\";\r\nimport { getCurrentHPFromTarget } from \"../exploration/Exploration\";\r\nimport { GameState } from \"../GameState\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Disease extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"disease\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Disease\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Lowers Max HP to the current HP\");\r\n  }\r\n}\r\n\r\nexport const disease = new Disease();\r\n\r\nexport function loadDisease() {\r\n  TemporaryEffects.register(disease);\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[target, CombatStat.MaxHP]],\r\n      target + \"disease\",\r\n      disease.getDisplayName(),\r\n      TransformationType.Override,\r\n      (state) => {\r\n        if (hasTemporaryEffect(state, disease.getId(), target)) {\r\n          return Math.max(getCurrentHPFromTarget(state, target), 1);\r\n        }\r\n        return null;\r\n      },\r\n    );\r\n    registerTimeTickListener(\r\n      \"diseaseCacheClearerHP\" + target,\r\n      (state, timeElapsedSec) => {\r\n        if (hasTemporaryEffect(state, disease.getId(), target)) {\r\n          return clearCombatStatCache(state, target, CombatStat.MaxHP);\r\n        }\r\n        return state;\r\n      },\r\n    );\r\n  }\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    disease.getId(),\r\n    CombatStat.MaxHP,\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass DivineImmunityTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"divineImmunity\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Divine Immunity\");\r\n  }\r\n\r\n  isCombatOnly(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./divineImmunity.png\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Immune to all damage and debuffs\");\r\n  }\r\n}\r\n\r\nexport const divineImmunityTemporaryEffect =\r\n  new DivineImmunityTemporaryEffect();\r\n\r\nexport function loadDivineImmunity() {\r\n  TemporaryEffects.register(divineImmunityTemporaryEffect);\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[TransformationTags.AttackDamageReceived, target]],\r\n      \"DivineImmunityDamage\" + target,\r\n      divineImmunityTemporaryEffect.getDisplayName(),\r\n      TransformationType.Multiplier,\r\n      (state) => {\r\n        if (\r\n          !hasTemporaryEffect(\r\n            state,\r\n            divineImmunityTemporaryEffect.getId(),\r\n            target,\r\n          )\r\n        ) {\r\n          return 1.0;\r\n        }\r\n        return 0;\r\n      },\r\n    );\r\n\r\n    registerTemporaryEffectListener(\r\n      \"divineImmunityDebuffPrevention\",\r\n      (state, temporaryEffect) => {\r\n        if (\r\n          !hasTemporaryEffect(\r\n            state,\r\n            divineImmunityTemporaryEffect.getId(),\r\n            temporaryEffect.target,\r\n          )\r\n        ) {\r\n          return temporaryEffect;\r\n        }\r\n        const effect = TemporaryEffects.getById(temporaryEffect.id);\r\n        if (effect.isBeneficial()) {\r\n          return temporaryEffect;\r\n        }\r\n        // Prevent!\r\n        temporaryEffect.endTime = getSecondsPlayed(state) - 1.0;\r\n        return temporaryEffect;\r\n      },\r\n    );\r\n  }\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { SpellElement, translateElement } from \"../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass ResistElementBase extends TemporaryEffect {\r\n  constructor(element: SpellElement) {\r\n    super();\r\n    this.element = element;\r\n  }\r\n  element: SpellElement;\r\n  getId(): string {\r\n    return \"elementalProtection\" + this.element;\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Resist {{element}}\", { element: translateElement(this.element) });\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"{{amount}} {{element}} damage received\", {\r\n      amount: formatMultiplier(temporaryEffectData.params.damageMultiplier),\r\n      element: translateElement(this.element),\r\n    });\r\n  }\r\n}\r\n\r\nexport function resistElementTemporaryEffect(\r\n  element: SpellElement,\r\n): ResistElementBase {\r\n  return TemporaryEffects.getById(\r\n    \"elementalProtection\" + element,\r\n  ) as ResistElementBase;\r\n}\r\n\r\nexport function loadElementalProtection() {\r\n  for (let element of valuesOf(SpellElement)) {\r\n    TemporaryEffects.register(new ResistElementBase(element));\r\n    registerTransformation(\r\n      [[TransformationTags.AttackDamageReceived]],\r\n      \"elementalProtection\" + element,\r\n      t(\"Resist {{element}}\", { element: translateElement(element) }),\r\n      TransformationType.Multiplier,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(\r\n          state,\r\n          \"elementalProtection\" + element,\r\n          params.target,\r\n        ) && (params.tags ?? []).includes(element)\r\n          ? getTemporaryEffectData(\r\n              state,\r\n              \"elementalProtection\" + element,\r\n              params.target,\r\n            ).params.damageMultiplier\r\n          : 1.0;\r\n      },\r\n    );\r\n  }\r\n  registerTransformation(\r\n    [\r\n      [TransformationTags.PoisonDoTAmount],\r\n      [TransformationTags.CorrosionDoTAmount],\r\n    ],\r\n    \"poisonResistanceFromElementalProtection\",\r\n    t(\"Resist Poison\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(\r\n        state,\r\n        \"elementalProtectionPoison\",\r\n        params.target,\r\n      )\r\n        ? getTemporaryEffectData(\r\n            state,\r\n            \"elementalProtectionPoison\",\r\n            params.target,\r\n          ).params.damageMultiplier\r\n        : 1.0;\r\n    },\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { GameState } from \"../GameState\";\r\nimport { SpellElement, translateElement } from \"../spells/Elements\";\r\nimport { registerCanCastSpellClearer } from \"../spells/Spells\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass SilenceElementBase extends TemporaryEffect {\r\n  constructor(element: SpellElement) {\r\n    super();\r\n    this.element = element;\r\n  }\r\n  element: SpellElement;\r\n  getId(): string {\r\n    return \"elementalSilence\" + this.element;\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Silence {{element}}\", {\r\n      element: translateElement(this.element),\r\n    });\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  isCombatOnly(): boolean {\r\n    return true;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Prevented from using {{element}} elemental spells\", {\r\n      element: translateElement(this.element),\r\n    });\r\n  }\r\n}\r\n\r\nexport function silenceElementTemporaryEffect(\r\n  element: SpellElement,\r\n): SilenceElementBase {\r\n  return TemporaryEffects.getById(\r\n    \"elementalSilence\" + element,\r\n  ) as SilenceElementBase;\r\n}\r\n\r\nexport function loadElementalSilence() {\r\n  for (let element of valuesOf(SpellElement)) {\r\n    TemporaryEffects.register(new SilenceElementBase(element));\r\n    registerTransformation(\r\n      [[TransformationTags.CanCastSpell, element]],\r\n      \"elementalSilence\" + element,\r\n      t(\"Silence {{element}}\", { element: translateElement(element) }),\r\n      TransformationType.Override,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(\r\n          state,\r\n          \"elementalSilence\" + element,\r\n          AttackTarget.Player,\r\n        )\r\n          ? 0\r\n          : undefined;\r\n      },\r\n    );\r\n    registerCanCastSpellClearer(\"elementalSilence\" + element, (state) =>\r\n      hasTemporaryEffect(\r\n        state,\r\n        \"elementalSilence\" + element,\r\n        AttackTarget.Player,\r\n      ),\r\n    );\r\n  }\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { poison } from \"./Poison\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Frail extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"frail\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Frail\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./frail.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-10%:defense:; takes double damage from Poison effect\");\r\n  }\r\n}\r\n\r\nexport const frail = new Frail();\r\n\r\nexport function loadFrail() {\r\n  TemporaryEffects.register(frail);\r\n\r\n  registerTransformation(\r\n    [[poison.getId(), TransformationTags.PoisonDoTAmount]],\r\n    frail.getId() + \"poison\",\r\n    frail.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state, params) =>\r\n      hasTemporaryEffect(state, frail.getId(), params.target) ? 2.0 : 1.0,\r\n  );\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[target, CombatStat.Defense]],\r\n      frail.getId() + \"defense\",\r\n      frail.getDisplayName(),\r\n      TransformationType.Multiplier,\r\n      (state, params) =>\r\n        hasTemporaryEffect(state, frail.getId(), target) ? 0.9 : 1.0,\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    frail.getId(),\r\n    CombatStat.Defense,\r\n  );\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { CombatActionResultListeners } from \"../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../GameState\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  getTemporaryEffectEndTime,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Frozen extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"frozen\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Frozen\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getIcon() {\r\n    return require(\"./frozen.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"Attack gauge does not increase; next Fire attack received is reduced to 0\",\r\n    );\r\n  }\r\n}\r\n\r\nexport const frozen = new Frozen();\r\n\r\nclass FrozenProtection extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"frozenProtection\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Frozen Protection\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getIcon() {\r\n    return require(\"./frozenProtection.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t('Immune to \"Frozen\"');\r\n  }\r\n}\r\n\r\nexport const frozenProtection = new FrozenProtection();\r\n\r\nconst postFrozenProtectionDurationTags = memoize((target) => [\r\n  target,\r\n  TransformationTags.PostFrozenProtectionDuration,\r\n]);\r\n\r\nexport function loadFrozen() {\r\n  TemporaryEffects.register(frozen);\r\n  TemporaryEffects.register(frozenProtection);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"frozen\",\r\n    frozen.getDisplayName(),\r\n    TransformationType.Override,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(state, frozen.getId(), params.target) &&\r\n        (params.tags ?? []).includes(SpellElement.Fire)\r\n        ? 0\r\n        : undefined;\r\n    },\r\n  );\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.AttackDelay, target]],\r\n      \"frozen\" + target,\r\n      frozen.getDisplayName(),\r\n      TransformationType.Override,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, frozen.getId(), target)\r\n          ? Infinity\r\n          : undefined;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    frozen.getId(),\r\n    CombatStat.AttackDelay,\r\n  );\r\n\r\n  CombatActionResultListeners.register((state, result) => {\r\n    if (\r\n      result.tags.includes(SpellElement.Fire) &&\r\n      hasTemporaryEffect(state, frozen.getId(), result.target)\r\n    ) {\r\n      state = clearTemporaryEffect(frozen.getId(), result.target)(state);\r\n    }\r\n    return state;\r\n  });\r\n\r\n  registerTemporaryEffectListener(\r\n    \"frozenClearer\",\r\n    (newState, temporaryEffect) => {\r\n      if (\r\n        temporaryEffect.id === frozen.getId() &&\r\n        temporaryEffect.endTime > temporaryEffect.setTime\r\n      ) {\r\n        // Someone's been frozen, but does it have temporary immunity?\r\n        if (\r\n          hasTemporaryEffect(\r\n            newState,\r\n            frozenProtection.getId(),\r\n            temporaryEffect.target,\r\n          )\r\n        ) {\r\n          temporaryEffect.endTime = getTemporaryEffectEndTime(\r\n            newState,\r\n            frozen.getId(),\r\n            temporaryEffect.target,\r\n          );\r\n          return temporaryEffect;\r\n        }\r\n\r\n        // If no immunity, we should grant the immunity\r\n        newState = grantTemporaryEffect(\r\n          frozenProtection.getId(),\r\n          applyTransformations(\r\n            postFrozenProtectionDurationTags(temporaryEffect.target),\r\n            newState,\r\n            3.0,\r\n          ) +\r\n            temporaryEffect.endTime -\r\n            getSecondsPlayed(newState),\r\n          { mode: \"add\", target: temporaryEffect.target },\r\n        )(newState);\r\n      }\r\n      return temporaryEffect;\r\n    },\r\n    true,\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Grounded extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"grounded\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Grounded\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t('-40:dodge:; immune to \"Airborne\"');\r\n  }\r\n}\r\n\r\nexport const grounded = new Grounded();\r\n\r\nexport function loadGrounded() {\r\n  TemporaryEffects.register(grounded);\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.Dodge, target]],\r\n      \"grounded\" + target,\r\n      grounded.getDisplayName(),\r\n      TransformationType.Addition,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, grounded.getId(), target) ? -40 : 0;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    grounded.getId(),\r\n    CombatStat.Dodge,\r\n  );\r\n\r\n  registerTemporaryEffectListener(\r\n    \"groundedAirbornePrevention\",\r\n    (state, temporaryEffect) => {\r\n      if (\r\n        !hasTemporaryEffect(state, grounded.getId(), temporaryEffect.target)\r\n      ) {\r\n        return temporaryEffect;\r\n      }\r\n      if (temporaryEffect.id != \"airborne\") {\r\n        return temporaryEffect;\r\n      }\r\n      // Prevent!\r\n      temporaryEffect.endTime = getSecondsPlayed(state) - 1.0;\r\n      return temporaryEffect;\r\n    },\r\n  );\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { CombatActionResultListeners } from \"../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Guard extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"guard\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Guard\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-{{amount}}% damage received from next attack\", {\r\n      amount: formatNumber(100 * (1.0 - temporaryEffectData.params.multiplier)),\r\n    });\r\n  }\r\n}\r\n\r\nconst guard = new Guard();\r\n\r\nexport { guard as GuardTemporaryEffect };\r\n\r\nexport function loadGuard() {\r\n  TemporaryEffects.register(guard);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"guard\",\r\n    guard.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(state, guard.getId(), params.target)\r\n        ? getTemporaryEffectData(state, guard.getId(), params.target).params\r\n            .multiplier\r\n        : 1.0;\r\n    },\r\n  );\r\n\r\n  CombatActionResultListeners.register((state, result) => {\r\n    if (\r\n      result.isHit &&\r\n      result.damage >= 0 &&\r\n      hasTemporaryEffect(state, guard.getId(), result.target)\r\n    ) {\r\n      state = clearTemporaryEffect(guard.getId(), result.target)(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Paralyzed extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"paralyzed\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Paralyzed\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getIcon() {\r\n    return require(\"./paralyzed.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+300%:attackDelay:\");\r\n  }\r\n}\r\n\r\nexport const paralyzed = new Paralyzed();\r\n\r\nexport function loadParalyzed() {\r\n  TemporaryEffects.register(paralyzed);\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.AttackDelay, target]],\r\n      \"paralyzed\" + target,\r\n      paralyzed.getDisplayName(),\r\n      TransformationType.Multiplier,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, paralyzed.getId(), target) ? 4.0 : 1.0;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    paralyzed.getId(),\r\n    CombatStat.AttackDelay,\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Petrified extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"petrified\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Petrified\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getIcon() {\r\n    return require(\"./petrified.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"All explicit attack damage received is reduced to 0; Attack gauge does not increase\",\r\n    );\r\n  }\r\n}\r\n\r\nexport const petrified = new Petrified();\r\n\r\nexport function loadPetrified() {\r\n  TemporaryEffects.register(petrified);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AttackDamageReceived]],\r\n    \"petrified\",\r\n    petrified.getDisplayName(),\r\n    TransformationType.Override,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(state, petrified.getId(), params.target)\r\n        ? 0\r\n        : undefined;\r\n    },\r\n  );\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.AttackDelay, target]],\r\n      \"petrified\" + target,\r\n      petrified.getDisplayName(),\r\n      TransformationType.Override,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, petrified.getId(), target)\r\n          ? Infinity\r\n          : undefined;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    petrified.getId(),\r\n    CombatStat.AttackDelay,\r\n  );\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { poison } from \"./Poison\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass PoisonImmunity extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"poisonImmunity\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Poison Immunity\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./poisonImmunity.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t('Immune to \"Poison\" debuff');\r\n  }\r\n}\r\n\r\nexport const poisonImmunity = new PoisonImmunity();\r\n\r\nexport function loadPoisonImmunity() {\r\n  TemporaryEffects.register(poisonImmunity);\r\n\r\n  registerTemporaryEffectListener(\r\n    \"poisonImmunityPoisonPrevention\",\r\n    (state, temporaryEffect) => {\r\n      if (temporaryEffect.id != poison.getId()) {\r\n        return temporaryEffect;\r\n      }\r\n      if (\r\n        !hasTemporaryEffect(\r\n          state,\r\n          poisonImmunity.getId(),\r\n          temporaryEffect.target,\r\n        )\r\n      ) {\r\n        return temporaryEffect;\r\n      }\r\n      // Prevent!\r\n      temporaryEffect.endTime = getSecondsPlayed(state) - 1.0;\r\n      return temporaryEffect;\r\n    },\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\nimport { Wet } from \"./Wet\";\r\n\r\nclass Seared extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"seared\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Seared\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-30%:defense:\");\r\n  }\r\n}\r\n\r\nconst seared = new Seared();\r\n\r\nexport { seared as Seared };\r\n\r\nexport function loadSeared() {\r\n  TemporaryEffects.register(seared);\r\n\r\n  for (let target of valuesOf(AttackTarget)) {\r\n    registerTransformation(\r\n      [[CombatStat.Defense, target]],\r\n      \"seared\" + target,\r\n      seared.getDisplayName(),\r\n      TransformationType.Multiplier,\r\n      (state, params) => {\r\n        return hasTemporaryEffect(state, seared.getId(), target) ? 0.7 : 1.0;\r\n      },\r\n    );\r\n  }\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    seared.getId(),\r\n    CombatStat.Defense,\r\n  );\r\n\r\n  addGameStateListener(\"searedClearerIfWet\", (state) => {\r\n    for (let target of valuesOf(AttackTarget)) {\r\n      if (\r\n        hasTemporaryEffect(state, Wet.getId(), target) &&\r\n        hasTemporaryEffect(state, seared.getId(), target)\r\n      ) {\r\n        return clearTemporaryEffect(seared.getId(), target);\r\n      }\r\n    }\r\n  });\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { TransformationType } from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport { TemporaryEffectData, TemporaryEffects } from \"./TemporaryEffects\";\r\n\r\nclass Shapeshifted extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"shapeshifted\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Shapeshifted\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./shapeshifted.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return valuesOf(CombatStat)\r\n      .map((stat) => [\r\n        { stat, type: TransformationType.Addition },\r\n        { stat, type: TransformationType.Multiplier },\r\n      ])\r\n      .flat();\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Temporarily shapeshifted into {{what}}. Various stats altered.\", {\r\n      what: temporaryEffectData.params.what,\r\n    });\r\n  }\r\n}\r\n\r\nexport const shapeshifted = new Shapeshifted();\r\n\r\nexport function loadShapeshifted() {\r\n  TemporaryEffects.register(shapeshifted);\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { TransformationType } from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport { TemporaryEffectData, TemporaryEffects } from \"./TemporaryEffects\";\r\n\r\nclass Shrunken extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"shrunken\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Shrunken\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./shrunken.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [{ stat: CombatStat.Dodge, type: TransformationType.Addition }];\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{amount}}:dodge:\", {\r\n      amount: formatNumber(temporaryEffectData.params.commonBuff.Dodge),\r\n    });\r\n  }\r\n}\r\n\r\nexport const shrunken = new Shrunken();\r\n\r\nexport function loadShrunken() {\r\n  TemporaryEffects.register(shrunken);\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { cursed } from \"./Cursed\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass StatusImmunityBase extends TemporaryEffect {\r\n  constructor(effect: TemporaryEffect) {\r\n    super();\r\n    this.effect = effect;\r\n  }\r\n  effect: TemporaryEffect;\r\n  getId(): string {\r\n    return \"statusImmunity\" + this.effect.getId();\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Protection from {{status}}\", {\r\n      status: this.effect.getDisplayName(),\r\n    });\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Immunity to {{status}}\", {\r\n      status: this.effect.getDisplayName(),\r\n    });\r\n  }\r\n}\r\n\r\n// Status immunity only works for these temporary effects\r\nconst ALLOWED_STATUS_IMMUNITY_EFFECTS = [cursed];\r\n\r\nexport function specificStatusImmunityTemporaryEffect(\r\n  effect: TemporaryEffect,\r\n): StatusImmunityBase {\r\n  return TemporaryEffects.getById(\r\n    \"statusImmunity\" + effect.getId(),\r\n  ) as StatusImmunityBase;\r\n}\r\n\r\nexport function loadSpecificStatusImmunity() {\r\n  for (let effect of ALLOWED_STATUS_IMMUNITY_EFFECTS) {\r\n    const statusImmunity = new StatusImmunityBase(effect);\r\n    TemporaryEffects.register(statusImmunity);\r\n    registerTemporaryEffectListener(\r\n      \"statusImmunityDebuffPrevention\" + effect.getId(),\r\n      (state, temporaryEffect) => {\r\n        if (\r\n          !hasTemporaryEffect(\r\n            state,\r\n            statusImmunity.getId(),\r\n            temporaryEffect.target,\r\n          ) ||\r\n          temporaryEffect.id != effect.getId()\r\n        ) {\r\n          return temporaryEffect;\r\n        }\r\n        // Prevent!\r\n        temporaryEffect.endTime = getSecondsPlayed(state) - 1.0;\r\n        return temporaryEffect;\r\n      },\r\n    );\r\n    // On grant, dispel the effect\r\n    registerTemporaryEffectListener(\r\n      \"statusImmunityDispelling\" + effect.getId(),\r\n      (state, temporaryEffect) => {\r\n        if (\r\n          temporaryEffect.id == statusImmunity.getId() &&\r\n          temporaryEffect.endTime > getSecondsPlayed(state)\r\n        ) {\r\n          state = clearTemporaryEffect(\r\n            effect.getId(),\r\n            temporaryEffect.target,\r\n          )(state);\r\n        }\r\n        return temporaryEffect;\r\n      },\r\n    );\r\n  }\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass StatusImmunity extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"statusImmunity\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Status Immunity\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./statusImmunity.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Immune to all debuffs\");\r\n  }\r\n}\r\n\r\nexport const statusImmunity = new StatusImmunity();\r\n\r\nexport function loadStatusImmunity() {\r\n  TemporaryEffects.register(statusImmunity);\r\n\r\n  registerTemporaryEffectListener(\r\n    \"statusImmunityDebuffPrevention\",\r\n    (state, temporaryEffect) => {\r\n      if (\r\n        !hasTemporaryEffect(\r\n          state,\r\n          statusImmunity.getId(),\r\n          temporaryEffect.target,\r\n        )\r\n      ) {\r\n        return temporaryEffect;\r\n      }\r\n      const effect = TemporaryEffects.getById(temporaryEffect.id);\r\n      if (effect.isBeneficial()) {\r\n        return temporaryEffect;\r\n      }\r\n      // Prevent!\r\n      temporaryEffect.endTime = getSecondsPlayed(state) - 1.0;\r\n      return temporaryEffect;\r\n    },\r\n  );\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport {\r\n  getEnemyTurnCounter,\r\n  resetEnemyNextAction,\r\n  resetFamiliarNextAction,\r\n} from \"../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../exploration/ExplorationUtils\";\r\nimport { setCombatVariable } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectEndTime,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectCombatStatCacheClearer,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass Stunned extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"stun\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Stunned!\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getIcon() {\r\n    return require(\"./stunned.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Cannot use spells or attack; Current attack is canceled\");\r\n  }\r\n}\r\n\r\nexport const stunned = new Stunned();\r\n\r\nclass StunProtection extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"stunProtection\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Stun Protection\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n  getIcon() {\r\n    return require(\"./stunProtection.png\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t('Immune to \"Stunned!\"');\r\n  }\r\n}\r\n\r\nexport const stunProtection = new StunProtection();\r\n\r\nexport function loadStunning() {\r\n  TemporaryEffects.register(stunned);\r\n  TemporaryEffects.register(stunProtection);\r\n\r\n  // While stunned, enemies and players both have a giant attack delay\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n    \"PlayerStunAttackDelay\",\r\n    t(\"Stunned!\"),\r\n    TransformationType.Override,\r\n    (state) =>\r\n      hasTemporaryEffect(state, stunned.getId(), AttackTarget.Player)\r\n        ? +Infinity\r\n        : null,\r\n  );\r\n  registerTransformation(\r\n    [[AttackTarget.Familiar, CombatStat.AttackDelay]],\r\n    \"FamiliarStunAttackDelay\",\r\n    t(\"Stunned!\"),\r\n    TransformationType.Override,\r\n    (state) =>\r\n      hasTemporaryEffect(state, stunned.getId(), AttackTarget.Familiar)\r\n        ? +Infinity\r\n        : null,\r\n  );\r\n  registerTransformation(\r\n    [[AttackTarget.Enemy, CombatStat.AttackDelay]],\r\n    \"EnemyStunAttackDelay\",\r\n    t(\"Stunned!\"),\r\n    TransformationType.Override,\r\n    (state) =>\r\n      hasTemporaryEffect(state, stunned.getId(), AttackTarget.Enemy)\r\n        ? +Infinity\r\n        : null,\r\n  );\r\n\r\n  registerTemporaryEffectCombatStatCacheClearer(\r\n    stunned.getId(),\r\n    CombatStat.AttackDelay,\r\n  );\r\n\r\n  registerTemporaryEffectListener(\"stunning\", (newState, temporaryEffect) => {\r\n    if (\r\n      temporaryEffect.id === stunned.getId() &&\r\n      temporaryEffect.endTime > temporaryEffect.setTime\r\n    ) {\r\n      // Someone's been stunned, but does it have temporary immunity?\r\n      if (\r\n        hasTemporaryEffect(\r\n          newState,\r\n          stunProtection.getId(),\r\n          temporaryEffect.target,\r\n        )\r\n      ) {\r\n        temporaryEffect.endTime = getTemporaryEffectEndTime(\r\n          newState,\r\n          stunned.getId(),\r\n          temporaryEffect.target,\r\n        );\r\n        return temporaryEffect;\r\n      }\r\n    }\r\n    return temporaryEffect;\r\n  });\r\n\r\n  addGameStateListener(\r\n    \"PlayerStunning\",\r\n    (newState) => {\r\n      if (hasTemporaryEffect(newState, stunned.getId(), AttackTarget.Player)) {\r\n        const stunDuration =\r\n          getTemporaryEffectEndTime(\r\n            newState,\r\n            stunned.getId(),\r\n            AttackTarget.Player,\r\n          ) - getSecondsPlayed(newState);\r\n\r\n        // Player's stun has been set. Set attack timer start time to estimated stun end\r\n        // so that on heal we don't immediately attack. Also give stun protection.\r\n        return (state) => {\r\n          state.run.exploration.playerActionProgress = 0.0;\r\n          state = grantTemporaryEffect(\r\n            stunProtection.getId(),\r\n            applyTransformations(\r\n              [\r\n                AttackTarget.Player,\r\n                TransformationTags.PostStunProtectionDuration,\r\n              ],\r\n              newState,\r\n              6.0,\r\n            ) + stunDuration,\r\n            { mode: \"add\", target: AttackTarget.Player },\r\n          )(state);\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) =>\r\n      getTemporaryEffectEndTime(state, stunned.getId(), AttackTarget.Player),\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"PlayerStunningRecovery\",\r\n    (newState) => {\r\n      if (!hasTemporaryEffect(newState, stunned.getId(), AttackTarget.Player)) {\r\n        // Player's stun has run out, so restart the attack timer\r\n        return (state) => {\r\n          state.run.exploration.playerActionProgress = 0.0;\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) => hasTemporaryEffect(state, stunned.getId(), AttackTarget.Player),\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"FamiliarStunning\",\r\n    (newState) => {\r\n      if (\r\n        hasTemporaryEffect(newState, stunned.getId(), AttackTarget.Familiar)\r\n      ) {\r\n        const stunDuration =\r\n          getTemporaryEffectEndTime(\r\n            newState,\r\n            stunned.getId(),\r\n            AttackTarget.Familiar,\r\n          ) - getSecondsPlayed(newState);\r\n\r\n        // Player's stun has been set. Set attack timer start time to estimated stun end\r\n        // so that on heal we don't immediately attack. Also give stun protection.\r\n        return (state) => {\r\n          state.run.exploration.familiarActionProgress = 0.0;\r\n          state = grantTemporaryEffect(\r\n            stunProtection.getId(),\r\n            applyTransformations(\r\n              [\r\n                AttackTarget.Familiar,\r\n                TransformationTags.PostStunProtectionDuration,\r\n              ],\r\n              newState,\r\n              6.0,\r\n            ) + stunDuration,\r\n            { mode: \"add\", target: AttackTarget.Familiar },\r\n          )(state);\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) =>\r\n      getTemporaryEffectEndTime(state, stunned.getId(), AttackTarget.Familiar),\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"FamiliarStunningRecovery\",\r\n    (newState) => {\r\n      if (\r\n        !hasTemporaryEffect(newState, stunned.getId(), AttackTarget.Familiar)\r\n      ) {\r\n        // Player's stun has run out, so restart the attack timer\r\n        return (state) => {\r\n          resetFamiliarNextAction();\r\n          state.run.exploration.familiarActionProgress = 0.0;\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) =>\r\n      hasTemporaryEffect(state, stunned.getId(), AttackTarget.Familiar),\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"EnemyStunning\",\r\n    (newState) => {\r\n      if (hasTemporaryEffect(newState, stunned.getId(), AttackTarget.Enemy)) {\r\n        const stunDuration =\r\n          getTemporaryEffectEndTime(\r\n            newState,\r\n            stunned.getId(),\r\n            AttackTarget.Enemy,\r\n          ) - getSecondsPlayed(newState);\r\n\r\n        // Enemy's stun has been set. Set attack timer start time to estimated stun end\r\n        // so that on heal we don't immediately attack. Also give stun protection.\r\n        // Also advance turn counter by 1.\r\n        return (state) => {\r\n          state.run.exploration.enemyActionProgress = 0.0;\r\n          state = setCombatVariable(\r\n            \"enemyTurnCounter\",\r\n            getEnemyTurnCounter(state) + 1,\r\n          )(state);\r\n          if (getExplorationStatus(state) === ExplorationStatus.Combat) {\r\n            state = grantTemporaryEffect(\r\n              stunProtection.getId(),\r\n              applyTransformations(\r\n                [\r\n                  AttackTarget.Enemy,\r\n                  TransformationTags.PostStunProtectionDuration,\r\n                ],\r\n                newState,\r\n                6.0,\r\n              ) + stunDuration,\r\n              { mode: \"add\", target: AttackTarget.Enemy },\r\n            )(state);\r\n          }\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) =>\r\n      getTemporaryEffectEndTime(state, stunned.getId(), AttackTarget.Enemy),\r\n  );\r\n\r\n  addGameStateListener(\r\n    \"EnemyStunningRecovery\",\r\n    (newState) => {\r\n      if (!hasTemporaryEffect(newState, stunned.getId(), AttackTarget.Enemy)) {\r\n        // Enemy's stun has run out, so restart the attack timer\r\n        return (state) => {\r\n          resetEnemyNextAction();\r\n          state.run.exploration.enemyActionProgress = 0.0;\r\n          return state;\r\n        };\r\n      }\r\n    },\r\n    (state) => hasTemporaryEffect(state, stunned.getId(), AttackTarget.Enemy),\r\n  );\r\n}\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport { TransformationType } from \"../transformation/Transformation\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport { TemporaryEffectData, TemporaryEffects } from \"./TemporaryEffects\";\r\n\r\nclass Weakened extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"weakened\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Weakened\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./weakened.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [{ stat: CombatStat.Attack, type: TransformationType.Multiplier }];\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-{{amount}}%:attack:\", {\r\n      amount: formatNumber(\r\n        100 * (1.0 - temporaryEffectData.params.commonBuff.AttackMultiplier),\r\n      ),\r\n    });\r\n  }\r\n}\r\n\r\nexport const weakened = new Weakened();\r\n\r\nexport function loadWeakened() {\r\n  TemporaryEffects.register(weakened);\r\n}\r\n","import { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { TemporaryEffect } from \"./TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\n\r\nclass WizardDisarray extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"wizardDisarray\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Wizard Disarray\");\r\n  }\r\n  getIcon() {\r\n    return require(\"./wizardDisarray.png\");\r\n  }\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"{{amount}}:wizardpower: production\", {\r\n      amount: formatMultiplier(temporaryEffectData.params.multiplier),\r\n    });\r\n  }\r\n}\r\n\r\nexport const wizardDisarray = new WizardDisarray();\r\n\r\nexport function loadWizardDisarray() {\r\n  TemporaryEffects.register(wizardDisarray);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AutocastPointsProduction]],\r\n    wizardDisarray.getId(),\r\n    wizardDisarray.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      return hasTemporaryEffect(\r\n        state,\r\n        wizardDisarray.getId(),\r\n        AttackTarget.Player,\r\n      )\r\n        ? getTemporaryEffectData(\r\n            state,\r\n            wizardDisarray.getId(),\r\n            AttackTarget.Player,\r\n          ).params.multiplier\r\n        : 1.0;\r\n    },\r\n  );\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { clearCombatStatCache, CombatStat } from \"../exploration/CombatStats\";\r\nimport {\r\n  getCurrentEnemyHP,\r\n  getCurrentFamiliarHP,\r\n  getCurrentHPFromTarget,\r\n  getCurrentPlayerHP,\r\n  modifyCompanionCurrentHP,\r\n  modifyEnemyCurrentHP,\r\n  modifyPlayerCurrentHP,\r\n} from \"../exploration/Exploration\";\r\nimport { GameState } from \"../GameState\";\r\nimport { registerTimeTickListener } from \"../timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"../timetick/TotalTimePlayed\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { loadAirborne } from \"./Airborne\";\r\nimport { loadResistAttackSpell } from \"./AttackSpellProtection\";\r\nimport { loadResistAutoAttack } from \"./AutoAttackProtection\";\r\nimport { loadBerserk } from \"./Berserk\";\r\nimport { loadChilled } from \"./Chilled\";\r\nimport { loadCloakOfFlames } from \"./CloakOfFlames\";\r\nimport { loadCorrosion } from \"./Corrosion\";\r\nimport { cursed, loadCursed } from \"./Cursed\";\r\nimport { loadDisease } from \"./Disease\";\r\nimport { loadDivineImmunity } from \"./DivineImmunity\";\r\nimport { loadElementalProtection } from \"./ElementalProtection\";\r\nimport { loadElementalSilence } from \"./ElementalSilence\";\r\nimport { loadFrail } from \"./Frail\";\r\nimport { loadFrozen } from \"./Frozen\";\r\nimport { loadGrounded } from \"./Grounded\";\r\nimport { loadGuard } from \"./Guard\";\r\nimport { loadNoxiousCloak } from \"./NoxiousCloak\";\r\nimport { loadParalyzed } from \"./Paralyzed\";\r\nimport { loadPetrified } from \"./Petrified\";\r\nimport { loadPoison } from \"./Poison\";\r\nimport { loadPoisonImmunity } from \"./PoisonImmunity\";\r\nimport { loadSeared } from \"./Seared\";\r\nimport { loadShapeshifted } from \"./Shapeshifted\";\r\nimport { loadShrunken } from \"./Shrunken\";\r\nimport { loadSpecificStatusImmunity } from \"./SpecificStatusImmunity\";\r\nimport { loadStatusImmunity } from \"./StatusImmunity\";\r\nimport { loadStunning } from \"./Stunning\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  getTemporaryEffects,\r\n  getTemporaryEffectsForCommonBuff,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectExpirationListeners,\r\n  TemporaryEffects,\r\n} from \"./TemporaryEffects\";\r\nimport { loadWeakened } from \"./Weakened\";\r\nimport { loadWet } from \"./Wet\";\r\nimport { loadWizardDisarray } from \"./WizardDisarray\";\r\n\r\nexport function isHealingPossible(\r\n  state: GameState,\r\n  target: AttackTarget,\r\n): boolean {\r\n  return (\r\n    !hasTemporaryEffect(state, cursed.getId(), target) &&\r\n    getCurrentHPFromTarget(state, target) > 0\r\n  );\r\n}\r\n\r\nexport function loadCommonTemporaryEffects() {\r\n  registerTimeTickListener(\"CommonDoT\", (state, timeElapsedSec) => {\r\n    const temporaryEffects = getTemporaryEffects(\r\n      state,\r\n      (state, effect) => effect.params?.commonDoTAmount != null,\r\n    );\r\n    temporaryEffects.forEach((effect) => {\r\n      const effectObject = TemporaryEffects.getById(effect.id);\r\n      if (effect.target === AttackTarget.Enemy) {\r\n        if (\r\n          effect.params.commonDoTAmount < 0 &&\r\n          getCurrentEnemyHP(state) <= 0\r\n        ) {\r\n          return state;\r\n        }\r\n        state = modifyEnemyCurrentHP(\r\n          state,\r\n          -effect.params.commonDoTAmount * timeElapsedSec,\r\n        );\r\n      } else if (effect.target === AttackTarget.Familiar) {\r\n        if (\r\n          effect.params.commonDoTAmount < 0 &&\r\n          getCurrentFamiliarHP(state) <= 0\r\n        ) {\r\n          return state;\r\n        }\r\n        state = modifyCompanionCurrentHP(\r\n          state,\r\n          -effect.params.commonDoTAmount * timeElapsedSec,\r\n          effectObject.getDisplayName(),\r\n        );\r\n      } else {\r\n        if (\r\n          effect.params.commonDoTAmount < 0 &&\r\n          getCurrentPlayerHP(state) <= 0\r\n        ) {\r\n          return state;\r\n        }\r\n        state = modifyPlayerCurrentHP(\r\n          state,\r\n          -effect.params.commonDoTAmount * timeElapsedSec,\r\n          effectObject.getDisplayName(),\r\n        );\r\n      }\r\n    });\r\n    return state;\r\n  });\r\n\r\n  valuesOf(AttackTarget).forEach((target) => {\r\n    valuesOf(CombatStat).forEach((stat) => {\r\n      registerTransformation(\r\n        [[target, stat]],\r\n        \"CommonBuff\" + target + stat,\r\n        t(\"Buffs and debuffs\"),\r\n        TransformationType.Addition,\r\n        (state) => {\r\n          let totalValue = 0;\r\n          const temporaryEffectList = getTemporaryEffectsForCommonBuff(\r\n            stat,\r\n            TransformationType.Addition,\r\n          );\r\n          temporaryEffectList.forEach((effect) => {\r\n            const data = getTemporaryEffectData(state, effect.getId(), target);\r\n            totalValue += data?.params?.commonBuff?.[stat] ?? 0;\r\n          });\r\n          return totalValue;\r\n        },\r\n      );\r\n      registerTransformation(\r\n        [[target, stat]],\r\n        \"CommonBuffMultiplication\" + target + stat,\r\n        t(\"Buffs and debuffs\"),\r\n        TransformationType.Multiplier,\r\n        (state) => {\r\n          let totalValue = 1.0;\r\n          const multiplierStr = stat + \"Multiplier\";\r\n          const temporaryEffectList = getTemporaryEffectsForCommonBuff(\r\n            stat,\r\n            TransformationType.Multiplier,\r\n          );\r\n          temporaryEffectList.forEach((effect) => {\r\n            const data = getTemporaryEffectData(state, effect.getId(), target);\r\n            totalValue *= data?.params?.commonBuff?.[multiplierStr] ?? 1.0;\r\n          });\r\n          return totalValue;\r\n        },\r\n      );\r\n    });\r\n  });\r\n\r\n  registerTemporaryEffectListener(\r\n    \"TemporaryEffectCombatStatCacheClearer\",\r\n    (state, effect) => {\r\n      // Blanket clear cache to save work\r\n      const temporaryEffect = TemporaryEffects.getById(effect.id);\r\n      const commonBuffs = temporaryEffect.isCommonBuffEnabled();\r\n      if (commonBuffs.length > 0) {\r\n        for (let commonBuff of commonBuffs) {\r\n          state = clearCombatStatCache(state, effect.target, commonBuff.stat);\r\n        }\r\n      }\r\n      return effect;\r\n    },\r\n  );\r\n\r\n  // This deletes stray temporary effects at the end of each time tick, keeping things trimmed down\r\n  registerTimeTickListener(\r\n    \"TemporaryEffectDeleterAndCacheCleaerer\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      const secondsPlayed = getSecondsPlayed(state);\r\n      const notClearedEffects = valuesOf(state.run.temporaryEffects).filter(\r\n        (effect) => !effect.registeredClear && effect.endTime < secondsPlayed,\r\n      );\r\n      if (notClearedEffects.length > 0) {\r\n        for (let effect of notClearedEffects) {\r\n          effect.registeredClear = true;\r\n          // Clear cache if an effect expired!\r\n          state = clearCombatStatCache(state, effect.target);\r\n          TemporaryEffectExpirationListeners.getAll().forEach((listener) =>\r\n            listener(state, effect),\r\n          );\r\n        }\r\n      }\r\n      return state;\r\n    },\r\n    100000,\r\n  );\r\n\r\n  loadWet();\r\n  loadChilled();\r\n  loadFrozen();\r\n  loadSeared();\r\n  loadGuard();\r\n  loadPoison();\r\n  loadNoxiousCloak();\r\n  loadShrunken();\r\n  loadDisease();\r\n  loadWeakened();\r\n  loadGrounded();\r\n  loadAirborne();\r\n  loadCloakOfFlames();\r\n  loadStunning();\r\n  loadWizardDisarray();\r\n  loadFrail();\r\n  loadBerserk();\r\n  loadPetrified();\r\n  loadShapeshifted();\r\n  loadPoisonImmunity();\r\n  loadCorrosion();\r\n  loadElementalProtection();\r\n  loadCursed();\r\n  loadStatusImmunity();\r\n  loadParalyzed();\r\n  loadResistAttackSpell();\r\n  loadElementalSilence();\r\n  loadSpecificStatusImmunity();\r\n  loadDivineImmunity();\r\n  loadResistAutoAttack();\r\n\r\n  // Need to redo reflect\r\n  // addGameStateListener(\r\n  //   \"EnemyReflect\",\r\n  //   (newState) => {\r\n  //     if (!hasTemporaryEffect(newState, \"EnemyReflect\")) {\r\n  //       return;\r\n  //     }\r\n  //     const isSpellAttack =\r\n  //       newState.run.exploration.lastPlayerActionResult?.tags?.includes(\r\n  //         TransformationTags.Spell,\r\n  //       );\r\n  //     const damage =\r\n  //       newState.run.exploration.lastPlayerActionResult?.damage || 0;\r\n  //     if (isSpellAttack && damage > 0) {\r\n  //       return (state) => {\r\n  //         state = modifyPlayerCurrentHP(state, -damage, \"Spell Mirror\");\r\n\r\n  //         const actionResult = {\r\n  //           id: Math.random().toString(),\r\n  //           damage: damage,\r\n  //           isHit: true,\r\n  //           isCrit: false,\r\n  //           time: getSecondsPlayed(state),\r\n  //           target: AttackTarget.Player,\r\n  //           tags: [],\r\n  //         };\r\n  //         state.run.exploration.lastEnemyActionResult = actionResult;\r\n  //         state.run.exploration.actionResultQueue.push(actionResult);\r\n  //         return state;\r\n  //       };\r\n  //     }\r\n  //   },\r\n  //   (state) => state.run.exploration.lastPlayerActionResult?.id ?? \"none\",\r\n  // );\r\n}\r\n","import { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { EquippableItem } from \"../equipment/EquippableItem\";\r\nimport { isItemQualityUnlocked } from \"../Items\";\r\nimport { TransmutationSpell } from \"./TransmutationSpell\";\r\n\r\nexport abstract class EquipmentTransmutationSpell extends TransmutationSpell {\r\n  abstract getItem(): EquippableItem;\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.ExplorationUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  timesCraftable(state: GameState): number {\r\n    return isItemQualityUnlocked(state)\r\n      ? Math.min(9999, super.timesCraftable(state))\r\n      : 1;\r\n  }\r\n\r\n  simplifyCrafting(): boolean {\r\n    return false;\r\n  }\r\n}\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport { calculatePlayerMaxHP } from \"../../../exploration/CombatStats\";\r\nimport {\r\n  getCurrentPlayerHP,\r\n  modifyPlayerCurrentHP,\r\n} from \"../../../exploration/Exploration\";\r\nimport { pushCombatActionResult } from \"../../../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { isHealingPossible } from \"../../../temporaryeffects/CommonTemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { PouchItem } from \"../PouchItem\";\r\n\r\nclass HealthPotion extends PouchItem {\r\n  getId(): string {\r\n    return \"healthPotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./healthPotion.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Health Potion\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A basic potion that cures minor wounds.\");\r\n  }\r\n\r\n  hpHealTags = [];\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      hpHeal: {\r\n        value: 25,\r\n        tags: this.hpHealTags,\r\n        unit: \":hp:\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getHPHealAmount(state: GameState, params: ItemParams): number {\r\n    return this.getItemEffects(state, params, \"hpHeal\").hpHeal;\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string {\r\n    return t(\"^+{{amount}}^<{{explanation}}>:hp:\", {\r\n      amount: formatNumber(this.getHPHealAmount(state, params)),\r\n      explanation: this.getItemEffectExplanations(state, params, \"hpHeal\")\r\n        .hpHeal,\r\n    });\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 150;\r\n  }\r\n\r\n  doPouchItemEffect(state: GameState, params: ItemParams): GameState {\r\n    const healAmt = this.getHPHealAmount(state, params);\r\n    state = modifyPlayerCurrentHP(state, healAmt, this.getBaseName(params));\r\n    const actionResult = {\r\n      id: Math.random().toString(),\r\n      damage: -healAmt,\r\n      isCrit: false,\r\n      isHit: true,\r\n      time: getSecondsPlayed(state),\r\n      source: AttackTarget.Player,\r\n      target: AttackTarget.Player,\r\n      tags: this.getTags(),\r\n    };\r\n    state = pushCombatActionResult(state, actionResult);\r\n    return state;\r\n  }\r\n\r\n  shouldAutoUse(state: GameState, params: ItemParams): boolean {\r\n    const maxHP = calculatePlayerMaxHP(state);\r\n    const currentHP = getCurrentPlayerHP(state);\r\n    return (\r\n      (maxHP - currentHP > this.getHPHealAmount(state, params) ||\r\n        currentHP / maxHP < 0.3) &&\r\n      isHealingPossible(state, AttackTarget.Player)\r\n    );\r\n  }\r\n\r\n  getUsesPerCombatBase(params: ItemParams): number {\r\n    return 3;\r\n  }\r\n}\r\n\r\nconst healthPotion = new HealthPotion();\r\n\r\nclass TransmuteHealthPotion extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return healthPotion;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 6,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        WaterEssence: 2000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n        wildgrass: 10,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nconst transmuteHealthPotion = new TransmuteHealthPotion();\r\n\r\nexport {\r\n  healthPotion as HealthPotion,\r\n  transmuteHealthPotion as TransmuteHealthPotion,\r\n};\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport { TransmutationSpell } from \"../TransmutationSpell\";\r\n\r\nclass Cotton extends Item {\r\n  getId(): string {\r\n    return \"cotton\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./cotton.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Cotton\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A thread of cotton. Strong and durable, useful for making many kinds of clothing.\",\r\n    );\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 80;\r\n  }\r\n}\r\n\r\nexport const cotton = new Cotton();\r\n\r\nclass TransmuteCotton extends TransmutationSpell {\r\n  getItem(): Item {\r\n    return cotton;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 22,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 600,\r\n        AirEssence: 18000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const transmuteCotton = new TransmuteCotton();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { incrementAccumulatorVariable } from \"../../../AccumulatorVariables\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { HealthPotion } from \"../../../items/equipment/pouch/HealthPotion\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass Goblin extends Enemy {\r\n  getId(): string {\r\n    return \"goblin\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Goblin\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 799,\r\n      attack: 39,\r\n      defense: 25,\r\n      attackDelay: 1.8,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./goblin.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 13;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 46;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 23;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (\r\n      getResourceAmount(state, Resource.Coins) >= 250 &&\r\n      Math.random() < 0.1\r\n    ) {\r\n      return {\r\n        name: t(\"Steal Coins\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) =>\r\n          grantResource(Resource.Coins, -(50 + 200 * Math.random()))(state),\r\n      };\r\n    }\r\n    if (Math.random() < 0.7) {\r\n      return {\r\n        name: t(\"Double Attack\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 2,\r\n        chance: 0.45,\r\n      },\r\n      {\r\n        itemId: cotton.getId(),\r\n        amount: 1,\r\n        chance: 0.12,\r\n      },\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 1,\r\n        chance: 0.25,\r\n      },\r\n      {\r\n        itemId: HealthPotion.getId(),\r\n        amount: 1,\r\n        chance: 0.01,\r\n      },\r\n    ];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    if (!isFromCreatures) {\r\n      state = incrementAccumulatorVariable(state, \"goblinKills\", 1);\r\n    }\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new Goblin();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Chilled } from \"../../../temporaryeffects/Chilled\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../../temporaryeffects/Wet\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport {\r\n  getEnemyTurnCounter,\r\n  modifyEnemyCurrentHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { pushCombatActionResult } from \"../../ExplorationActionResult\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass MutatedFish extends Enemy {\r\n  getId(): string {\r\n    return \"mutatedFish\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Mutated Fish\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 3000,\r\n      attack: 40,\r\n      defense: 30,\r\n      attackDelay: 2.5,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./mutatedFish.png\");\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 13;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 99;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 60;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (getEnemyTurnCounter(state) % 12 == 0) {\r\n      return {\r\n        name: t(\"Tsunami\"),\r\n        delay: this.getAttackDelay(state) * 3,\r\n        transform: (state) => {\r\n          state = grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Enemy,\r\n          })(state);\r\n          state = grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Player,\r\n          })(state);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 3, {\r\n            tags: [SpellElement.Water],\r\n          });\r\n          state = modifyEnemyCurrentHP(state, -300);\r\n          state = pushCombatActionResult(state, {\r\n            id: Math.random().toString(),\r\n            damage: 300,\r\n            isCrit: false,\r\n            isHit: true,\r\n            source: AttackTarget.Enemy,\r\n            target: AttackTarget.Enemy,\r\n            tags: [],\r\n            time: getSecondsPlayed(state),\r\n          });\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (\r\n      (!hasTemporaryEffect(state, Wet.getId(), AttackTarget.Enemy) &&\r\n        !hasTemporaryEffect(state, Chilled.getId(), AttackTarget.Enemy)) ||\r\n      Math.random() < 0.5\r\n    ) {\r\n      return {\r\n        name: t(\"Ripple\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) => {\r\n          state = grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Enemy,\r\n          })(state);\r\n          state = grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Player,\r\n          })(state);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state), {\r\n            tags: [SpellElement.Water],\r\n          });\r\n          state = modifyEnemyCurrentHP(state, -30);\r\n          state = pushCombatActionResult(state, {\r\n            id: Math.random().toString(),\r\n            damage: 30,\r\n            isCrit: false,\r\n            isHit: true,\r\n            source: AttackTarget.Enemy,\r\n            target: AttackTarget.Enemy,\r\n            tags: [],\r\n            time: getSecondsPlayed(state),\r\n          });\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (\r\n      Math.random() < 0.05 &&\r\n      !hasTemporaryEffect(state, poison.getId(), AttackTarget.Player)\r\n    ) {\r\n      return {\r\n        name: t(\"Poisonous Bite\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.6);\r\n          state = grantTemporaryEffect(poison.getId(), 15, {\r\n            target: AttackTarget.Player,\r\n            params: {\r\n              magnitude: this.getAttack(state) / 20,\r\n            },\r\n          })(state);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.4) {\r\n      return {\r\n        name: t(\"Fast Attack\"),\r\n        delay: this.getAttackDelay(state) * 0.5,\r\n        transform: (state) =>\r\n          standardEnemyAttackEffect(state, this.getAttack(state) * 0.8),\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 4,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      `This might have used to be a Sewer Fish, but something odd has happened to it! It is strong. It will use Water attacks that also hit itself. This will make them Wet, which will reduce the effectivity of your Fire attacks. It also seems to have a really strong Tsunami attack... watch out! The Guard skill might come in handy, if your Earth is Lv12 or higher.`,\r\n    );\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = setDungeonFloorCompleted(state, \"sewerEntrance\");\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new MutatedFish();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Item, ItemParams } from \"../Item\";\r\nimport { ItemTagEnum } from \"../ItemTagEnum\";\r\n\r\nclass VenomPowder extends Item {\r\n  getId(): string {\r\n    return \"venomPowder\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./venomPowder.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Venom Powder\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A toxic extract. Useful for making equally toxic items.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 30;\r\n  }\r\n}\r\n\r\nexport default new VenomPowder();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport VenomPowder from \"../../../items/material/VenomPowder\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport { shrunken } from \"../../../temporaryeffects/Shrunken\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass PoisonousToad extends Enemy {\r\n  getId(): string {\r\n    return \"poisonousToad\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Poisonous Toad\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 450,\r\n      attack: 34,\r\n      defense: 12,\r\n      attackDelay: 1.8,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./poisonousToad.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 9;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 50;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 16;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (\r\n      !hasTemporaryEffect(state, poison.getId(), AttackTarget.Player) &&\r\n      Math.random() < 0.2\r\n    ) {\r\n      return {\r\n        name: t(\"Poisonous Spit\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) =>\r\n          grantTemporaryEffect(poison.getId(), 15, {\r\n            target: AttackTarget.Player,\r\n            params: {\r\n              magnitude: this.getAttack(state) / 12,\r\n            },\r\n          })(state),\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(state, shrunken.getId(), AttackTarget.Enemy) &&\r\n      Math.random() < 0.1\r\n    ) {\r\n      return {\r\n        name: t(\"Shrink!\"),\r\n        delay: this.getAttackDelay(state) * 1.15,\r\n        transform: (state) =>\r\n          grantTemporaryEffect(shrunken.getId(), 15, {\r\n            target: AttackTarget.Enemy,\r\n            params: {\r\n              commonBuff: { Dodge: 100 },\r\n            },\r\n          })(state),\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 1,\r\n        chance: 0.25,\r\n      },\r\n      {\r\n        itemId: VenomPowder.getId(),\r\n        amount: 2,\r\n        chance: 0.15,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new PoisonousToad();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { Chilled } from \"../../../temporaryeffects/Chilled\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../../temporaryeffects/Wet\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass SewerFish extends Enemy {\r\n  getId(): string {\r\n    return \"sewerFish\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Sewer Fish\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 640,\r\n      attack: 35,\r\n      defense: 16,\r\n      attackDelay: 2.0,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./sewerFish.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 11;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 65;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 22;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (\r\n      !hasTemporaryEffect(state, Wet.getId(), AttackTarget.Enemy) &&\r\n      !hasTemporaryEffect(state, Chilled.getId(), AttackTarget.Enemy)\r\n    ) {\r\n      return {\r\n        name: t(\"Soak\"),\r\n        delay: this.getAttackDelay(state) * 0.2,\r\n        transform: (state) =>\r\n          grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Enemy,\r\n          })(state),\r\n      };\r\n    }\r\n    if (Math.random() < 0.4) {\r\n      return {\r\n        name: t(\"Fast Attack\"),\r\n        delay: this.getAttackDelay(state) * 0.5,\r\n        transform: (state) =>\r\n          standardEnemyAttackEffect(state, this.getAttack(state) * 0.8),\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 2,\r\n        chance: 0.55,\r\n      },\r\n      {\r\n        itemId: cotton.getId(),\r\n        amount: 1,\r\n        chance: 0.15,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new SewerFish();\r\n","import memoize from \"sonic-memoize\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { cacheBooleanTrueOnly, cacheByTickCount } from \"../../Caching\";\r\nimport { GameState, GameStateTransform } from \"../../GameState\";\r\nimport {\r\n  Familiars,\r\n  getFamiliarData,\r\n  pushToFamiliarMessageLog,\r\n} from \"../../familiars/Familiar\";\r\nimport { Identifiable } from \"../../generic/Identifiable\";\r\nimport { applyTransformations } from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { getSuccessfulExplorationsForFloor, startCombat } from \"../Exploration\";\r\nimport { Enemy } from \"../enemies/Enemy\";\r\nimport { isDungeonFloorCompletedThisRun } from \"./Dungeons\";\r\n\r\nexport interface ExplorationPossibility {\r\n  weight: number;\r\n  transforms: ExplorationOutcome;\r\n}\r\n\r\nexport interface ExplorationOutcome {\r\n  enemy?: Enemy;\r\n  normal: GameStateTransform;\r\n  familiar: (state: GameState, familiarId: string) => GameState;\r\n}\r\n\r\nexport function encounterEnemy(enemy: Enemy): ExplorationOutcome {\r\n  return {\r\n    enemy: enemy,\r\n    normal: startCombat(enemy),\r\n    familiar: (state, familiarId) => {\r\n      // Determine success rate\r\n      const familiarData = getFamiliarData(state, familiarId);\r\n      const familiar = Familiars.getById(familiarData.familiarClassId);\r\n      const familiarLevel = familiar.getLevel(state, familiarId);\r\n      const enemyLevel = enemy.getLevel();\r\n      let successRate = 1.0;\r\n      if (familiarLevel < enemyLevel) {\r\n        successRate = Math.pow(0.5, enemyLevel - familiarLevel);\r\n      }\r\n      if (Math.random() < successRate) {\r\n        state = pushToFamiliarMessageLog(\r\n          state,\r\n          familiarId,\r\n          t(`Your familiar defeated {{enemy}}!`, { enemy: enemy.getName() }),\r\n        );\r\n        state = enemy.onDeath(state, true, familiarId);\r\n      } else {\r\n        state = pushToFamiliarMessageLog(\r\n          state,\r\n          familiarId,\r\n          t(`Your familiar faced {{enemy}}, but was defeated!`, {\r\n            enemy: enemy.getName(),\r\n          }),\r\n        );\r\n      }\r\n      return state;\r\n    },\r\n  };\r\n}\r\n\r\nconst explorationBossRequirementTags = [\r\n  TransformationTags.ExplorationBossRequirement,\r\n];\r\n\r\nexport abstract class DungeonFloor implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getFloorName(): string;\r\n\r\n  getIdForTallyingClears(): string {\r\n    return this.getId();\r\n  }\r\n\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 5.0;\r\n  }\r\n\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 50;\r\n  }\r\n\r\n  getExplorationSuccessesForBoss(state: GameState): number {\r\n    return Math.max(\r\n      Math.ceil(\r\n        applyTransformations(\r\n          explorationBossRequirementTags,\r\n          state,\r\n          this._getExplorationSuccessesForBossBase(),\r\n          { floor: this },\r\n        ),\r\n      ),\r\n      1,\r\n    );\r\n  }\r\n\r\n  doExplore(\r\n    state: GameState,\r\n    isFromFamiliars: boolean,\r\n    forcedRoll?: number | undefined,\r\n  ): ExplorationOutcome | null {\r\n    const possibilities = cacheByTickCount(\r\n      state,\r\n      this.getId() + \"ExplorationPossibilities\" + isFromFamiliars,\r\n      (state) => {\r\n        const possibilities = this.getExplorationPossibilities(\r\n          state,\r\n          isFromFamiliars,\r\n        );\r\n        return possibilities;\r\n      },\r\n    );\r\n    const totalWeight = possibilities.reduce(\r\n      (sumToNow, possibility) => sumToNow + possibility.weight,\r\n      0,\r\n    );\r\n    let explorationRoll = (forcedRoll ?? Math.random()) * totalWeight;\r\n    for (let idx in possibilities) {\r\n      const possibility = possibilities[idx];\r\n      const weight = possibility.weight;\r\n      explorationRoll -= weight;\r\n      if (explorationRoll < 0) {\r\n        return possibility.transforms;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  abstract getBoss(state: GameState): Enemy | undefined;\r\n\r\n  abstract getBreedingLevel(): number;\r\n\r\n  doFightBoss(state: GameState): GameStateTransform | undefined {\r\n    const boss = this.getBoss(state);\r\n    if (boss) {\r\n      return startCombat(boss);\r\n    }\r\n  }\r\n\r\n  canFightBoss(state: GameState): boolean {\r\n    return cacheBooleanTrueOnly(\r\n      state,\r\n      \"dungeonFloorFightBoss.\" + this.getId(),\r\n      (state) => {\r\n        const couldFightBoss =\r\n          (getSuccessfulExplorationsForFloor(state, this.getId()) >=\r\n            this.getExplorationSuccessesForBoss(state) ||\r\n            isDungeonFloorCompletedThisRun(state, this)) &&\r\n          this.getBoss(state) != undefined;\r\n        return couldFightBoss;\r\n      },\r\n    );\r\n  }\r\n\r\n  isUnlocked(state: GameState): boolean {\r\n    return false;\r\n  }\r\n\r\n  getNextFloor(state: GameState): DungeonFloor | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  abstract isMainStoryDungeonFloor(): boolean;\r\n\r\n  getMinimumMPLRecommendation(): number | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getMaximumMPLRecommendation(): number | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  abstract getBaseExplorationPossibilities(\r\n    state: GameState,\r\n  ): ExplorationPossibility[];\r\n\r\n  getExplorationPossibilities(\r\n    state: GameState,\r\n    isFromFamiliars: boolean,\r\n  ): ExplorationPossibility[] {\r\n    const basePossibilities = this.getBaseExplorationPossibilities(state);\r\n    return basePossibilities.map((possibility) => ({\r\n      weight: applyTransformations(\r\n        getExplorationPossibilityTags(\r\n          this.getId(),\r\n          possibility.transforms.enemy?.getId(),\r\n          isFromFamiliars,\r\n        ),\r\n        state,\r\n        possibility.weight,\r\n      ),\r\n      transforms: possibility.transforms,\r\n    }));\r\n  }\r\n\r\n  isDangerousForFamiliar(state: GameState, familiarId: string): boolean {\r\n    const familiarData = getFamiliarData(state, familiarId);\r\n    const familiar = Familiars.getById(familiarData.familiarClassId);\r\n    const familiarLevel = familiar.getLevel(state, familiarId);\r\n    const explorationPossibilities = this.getExplorationPossibilities(\r\n      state,\r\n      true,\r\n    );\r\n\r\n    let succeedWeight = 0,\r\n      failWeight = 0;\r\n    for (let possibility of explorationPossibilities) {\r\n      const weight = possibility.weight;\r\n      const enemy = possibility.transforms.enemy;\r\n      const enemyLevel = enemy.getLevel();\r\n      let successRate = 1.0;\r\n      if (familiarLevel < enemyLevel) {\r\n        successRate = Math.pow(0.5, enemyLevel - familiarLevel);\r\n      }\r\n      succeedWeight += weight * successRate;\r\n      failWeight += weight * (1 - successRate);\r\n    }\r\n\r\n    const succeedPercent = succeedWeight / (succeedWeight + failWeight);\r\n    return succeedPercent < 0.8;\r\n  }\r\n\r\n  calculateAverageEnemyLevelForFamiliars(state: GameState): number {\r\n    const explorationPossibilities = this.getExplorationPossibilities(\r\n      state,\r\n      true,\r\n    );\r\n\r\n    let totalWeight = 0,\r\n      levelSum = 0;\r\n\r\n    for (let possibility of explorationPossibilities) {\r\n      const weight = possibility.weight;\r\n      const enemy = possibility.transforms.enemy;\r\n      const enemyLevel = enemy.getLevel();\r\n      totalWeight += weight;\r\n      levelSum += enemyLevel * weight;\r\n    }\r\n\r\n    return levelSum / totalWeight;\r\n  }\r\n}\r\n\r\nconst getExplorationPossibilityTags = memoize(\r\n  (floorId: string, enemyId: string | undefined, isFromFamiliars: boolean) => [\r\n    floorId,\r\n    enemyId,\r\n    TransformationTags.ExplorationWeight,\r\n    isFromFamiliars\r\n      ? TransformationTags.FromFamiliarExploration\r\n      : TransformationTags.FromExploration,\r\n  ],\r\n);\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { PouchItem } from \"../PouchItem\";\r\n\r\nclass AntidotePotion extends PouchItem {\r\n  getId(): string {\r\n    return \"antidotePotion\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./antidotePotion.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Antidote Potion\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"Although built from extracted venom, it neutralizes it instead.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return t('Cures \"Poison\"');\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 250;\r\n  }\r\n\r\n  doPouchItemEffect(state: GameState, params: ItemParams): GameState {\r\n    return clearTemporaryEffect(poison.getId(), AttackTarget.Player)(state);\r\n  }\r\n\r\n  shouldAutoUse(state: GameState, params: ItemParams): boolean {\r\n    return hasTemporaryEffect(state, poison.getId(), AttackTarget.Player);\r\n  }\r\n\r\n  getUsesPerCombatBase(params: ItemParams): number {\r\n    return 8;\r\n  }\r\n}\r\n\r\nexport const antidotePotion = new AntidotePotion();\r\n\r\nclass TransmuteAntidotePotion extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return antidotePotion;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 15,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        PoisonEssence: 1000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n        elementalShardPoison: 5,\r\n        venomPowder: 5,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteAntidotePotion = new TransmuteAntidotePotion();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { incrementAccumulatorVariable } from \"../../../AccumulatorVariables\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { antidotePotion } from \"../../../items/equipment/pouch/AntidotePotion\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  calculateAttackTarget,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { getLastQueuedActionResult } from \"../../ExplorationUtils\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass GoblinSharpshooter extends Enemy {\r\n  getId(): string {\r\n    return \"goblinSharpshooter\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Goblin Sharpshooter\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 899,\r\n      attack: 60,\r\n      defense: 25,\r\n      attackDelay: 1.9,\r\n      accuracy: 70,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./goblinSharpshooter.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 15;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 68;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 29;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (\r\n      getResourceAmount(state, Resource.Coins) >= 250 &&\r\n      Math.random() < 0.1\r\n    ) {\r\n      return {\r\n        name: t(\"Steal Coins\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) =>\r\n          grantResource(Resource.Coins, -(50 + 200 * Math.random()))(state),\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(state, poison.getId(), target) &&\r\n      Math.random() < 0.2\r\n    ) {\r\n      return {\r\n        name: t(\"Poisonous Arrow\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 1.0);\r\n          const lastActionResult = getLastQueuedActionResult(state);\r\n          if (lastActionResult.isHit) {\r\n            state = grantTemporaryEffect(poison.getId(), 15, {\r\n              target: lastActionResult.target,\r\n              params: {\r\n                magnitude: this.getAttack(state) / 19,\r\n              },\r\n            })(state);\r\n          }\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.2) {\r\n      return {\r\n        name: t(\"Barrage\"),\r\n        delay: this.getAttackDelay(state) * 2.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.6);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.6);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.6);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.6);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 2,\r\n        chance: 0.5,\r\n      },\r\n      {\r\n        itemId: cotton.getId(),\r\n        amount: 1,\r\n        chance: 0.25,\r\n      },\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 1,\r\n        chance: 0.5,\r\n      },\r\n      {\r\n        itemId: antidotePotion.getId(),\r\n        amount: 1,\r\n        chance: 0.01,\r\n      },\r\n    ];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    if (!isFromCreatures) {\r\n      state = incrementAccumulatorVariable(state, \"goblinKills\", 1);\r\n    }\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new GoblinSharpshooter();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport VenomPowder from \"../../../items/material/VenomPowder\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { disease } from \"../../../temporaryeffects/Disease\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  calculateAttackTarget,\r\n  drainingEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass SewerFly extends Enemy {\r\n  getId(): string {\r\n    return \"sewerFly\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Sewer Fly\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 420,\r\n      attack: 37,\r\n      defense: 10,\r\n      attackDelay: 1.1,\r\n      accuracy: 100,\r\n      dodge: 120,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./sewerFly.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 14;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 30;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 24;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (\r\n      !hasTemporaryEffect(state, disease.getId(), target) &&\r\n      Math.random() < 0.1\r\n    ) {\r\n      return {\r\n        name: t(\"Diseased Leech\"),\r\n        delay: this.getAttackDelay(state) * 1.3,\r\n        transform: (state: GameState) => {\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state));\r\n          state = grantTemporaryEffect(disease.getId(), 12, { target: target })(\r\n            state,\r\n          );\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.5) {\r\n      return {\r\n        name: t(\"Leech\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state: GameState) => {\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state));\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 1,\r\n        chance: 0.55,\r\n      },\r\n      {\r\n        itemId: cotton.getId(),\r\n        amount: 1,\r\n        chance: 0.13,\r\n      },\r\n      {\r\n        itemId: VenomPowder.getId(),\r\n        amount: 1,\r\n        chance: 0.35,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new SewerFly();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { Chilled } from \"../../../temporaryeffects/Chilled\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../../temporaryeffects/Wet\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport {\r\n  getEnemyTurnCounter,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass Sicklefish extends Enemy {\r\n  getId(): string {\r\n    return \"sicklefish\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Sicklefish\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 900,\r\n      attack: 52,\r\n      defense: 30,\r\n      attackDelay: 2.1,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./sicklefish.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 15;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 54;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 31;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (getEnemyTurnCounter(state) % 4 == 0) {\r\n      return {\r\n        name: t(\"Strong Attack\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 2.0);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (getEnemyTurnCounter(state) % 4 == 3) {\r\n      return {\r\n        name: t(\"Charging...\"),\r\n        delay: this.getAttackDelay(state) * 1.5,\r\n        transform: (state) => state,\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(state, Wet.getId(), AttackTarget.Enemy) &&\r\n      !hasTemporaryEffect(state, Chilled.getId(), AttackTarget.Enemy)\r\n    ) {\r\n      return {\r\n        name: t(\"Soak\"),\r\n        delay: this.getAttackDelay(state) * 0.2,\r\n        transform: (state) =>\r\n          grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Enemy,\r\n          })(state),\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 4,\r\n        chance: 0.2,\r\n      },\r\n      {\r\n        itemId: cotton.getId(),\r\n        amount: 1,\r\n        chance: 0.3,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new Sicklefish();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport VenomPowder from \"../../../items/material/VenomPowder\";\r\nimport { disease } from \"../../../temporaryeffects/Disease\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport { calculateAttackTarget } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass SludgeMass extends Enemy {\r\n  getId(): string {\r\n    return \"sludgeMass\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Sludge Mass\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 6500,\r\n      attack: 47,\r\n      defense: 10,\r\n      attackDelay: 4.5,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./sludgeMass.png\");\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 17;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 199;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 110;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (!hasTemporaryEffect(state, disease.getId(), target)) {\r\n      return {\r\n        name: t(\"Plague\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) => {\r\n          const target = calculateAttackTarget(state);\r\n          state = grantTemporaryEffect(disease.getId(), 25, {\r\n            target,\r\n          })(state);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(state, poison.getId(), target) &&\r\n      Math.random() < 0.5\r\n    ) {\r\n      return {\r\n        name: t(\"Poison\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) => {\r\n          const target = calculateAttackTarget(state);\r\n          state = grantTemporaryEffect(poison.getId(), 12, {\r\n            target,\r\n            params: {\r\n              magnitude: this.getAttack(state) / 7,\r\n            },\r\n          })(state);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: VenomPowder.getId(),\r\n        amount: 2,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      `What is this *monstrosity*?! It really, *really* stinks! It is so powerful that it's leaving us sick, making us unable to get healthy again! On top of that, it is also highly poisonous! But, at least, we can try and prevent that. Let's make sure we go prepared with something to counter the poison, like with a Charm of Poison Resistance (requires Poison Lv4), and ready to heal as soon as the disease subsides.`,\r\n    );\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = setDungeonFloorCompleted(state, \"sewerHazardousSector\");\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new SludgeMass();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Item, ItemParams } from \"../Item\";\r\nimport { ItemTagEnum } from \"../ItemTagEnum\";\r\n\r\nclass EtherealEelExtract extends Item {\r\n  getId(): string {\r\n    return \"etherealEelExtract\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.QuestItem];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./etherealEelExtract.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Ethereal Eel Extract\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A substance obtained from an Ethereal Eel. Proof of its defeat.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 100000;\r\n  }\r\n}\r\n\r\nexport default new EtherealEelExtract();\r\n","import { ActionArea, ActionSubcategory } from \"../action/ActionAreas\";\r\nimport { ExplorationStatus } from \"../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../exploration/ExplorationUtils\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Spell } from \"./Spell\";\r\n\r\nexport abstract class CombatSpellBase extends Spell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return {\r\n      SPELL_MENU: [this.getElement()],\r\n      EXPLORATION: [this.getElement()],\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      hasEverHadFlag(state, Flag.ExplorationUnlocked) && super.isVisible(state)\r\n    );\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return false;\r\n  }\r\n\r\n  isEnabled(state: GameState, skipAffordabilityChecks?: boolean): boolean {\r\n    return (\r\n      (this.canUseOutsideOfCombat() ||\r\n        getExplorationStatus(state) == ExplorationStatus.Combat) &&\r\n      super.isEnabled(state, skipAffordabilityChecks)\r\n    );\r\n  }\r\n}\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  grantTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationType } from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass HasteTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"haste\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Haste\");\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./haste.png\");\r\n  }\r\n\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [\r\n      { stat: CombatStat.AttackDelay, type: TransformationType.Multiplier },\r\n    ];\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    const attackDelayRatio =\r\n      temporaryEffectData.params.commonBuff.AttackDelayMultiplier;\r\n    return t(\"{{ratio}}:attackDelay:\", {\r\n      ratio: formatMultiplier(attackDelayRatio),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new HasteTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nconst BASE = 0.13637;\r\n\r\nclass Haste extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"haste\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Haste\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 700;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 2.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Log2Divisor,\r\n        base: BASE,\r\n      },\r\n      duration: {\r\n        value: 60.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: {\r\n        commonBuff: {\r\n          AttackDelayMultiplier:\r\n            1.0 / (1 + BASE * Math.max(0, Math.log2(effects.magnitude))),\r\n        },\r\n      },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Enchant your body to be able to move faster.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^{{magnitude}}^<{{magnitudeExplanation}}>:attackDelay: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatMultiplier(\r\n          1.0 / (1 + BASE * Math.max(Math.log2(effects.magnitude))),\r\n        ),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 8 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 52 };\r\n  }\r\n}\r\n\r\nconst haste = new Haste();\r\n\r\nregisterEmpowerEffects(haste, [TransformationTags.Cost, Resource.Mana], 10);\r\nregisterEmpowerEffects(haste, [TransformationTags.TemporaryEffectMagnitude], 2);\r\n\r\nexport { haste as Haste, temporaryEffect as HasteTemporaryEffect };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport EtherealEelExtract from \"../../../items/quest/EtherealEelExtract\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { HasteTemporaryEffect } from \"../../../spells/air/Haste\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Chilled } from \"../../../temporaryeffects/Chilled\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../../temporaryeffects/Wet\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport {\r\n  aoeEnemyAttackEffect,\r\n  calculateAttackTarget,\r\n  getCurrentEnemyHPFraction,\r\n  getEnemyTurnCounter,\r\n  modifyEnemyCurrentHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { pushCombatActionResult } from \"../../ExplorationActionResult\";\r\nimport { hasCurrentActiveCompanion } from \"../../Summoning\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass EtherealEel extends Enemy {\r\n  getId(): string {\r\n    return \"etherealEel\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Ethereal Eel\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 150000,\r\n      attack: 400,\r\n      defense: 250,\r\n      attackDelay: 1.5,\r\n      accuracy: 160,\r\n      dodge: 400,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./etherealEel.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 55;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 99999;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 9999;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (getEnemyTurnCounter(state) % 5 == 0 && Math.random() < 0.5) {\r\n      return {\r\n        name: t(\"Wide Tsunami\"),\r\n        delay: this.getAttackDelay(state) * 3,\r\n        transform: (state) => {\r\n          state = grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Enemy,\r\n          })(state);\r\n          state = grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Player,\r\n          })(state);\r\n          if (hasCurrentActiveCompanion(state)) {\r\n            state = grantTemporaryEffect(Wet.getId(), 60, {\r\n              target: AttackTarget.Familiar,\r\n            })(state);\r\n          }\r\n          state = aoeEnemyAttackEffect(state, this.getAttack(state) * 3, {\r\n            tags: [SpellElement.Water],\r\n          });\r\n          state = modifyEnemyCurrentHP(state, -300);\r\n          state = pushCombatActionResult(state, {\r\n            id: Math.random().toString(),\r\n            damage: 300,\r\n            isCrit: false,\r\n            isHit: true,\r\n            source: AttackTarget.Enemy,\r\n            target: AttackTarget.Enemy,\r\n            tags: [],\r\n            time: getSecondsPlayed(state),\r\n          });\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(state, Wet.getId(), AttackTarget.Enemy) &&\r\n      !hasTemporaryEffect(state, Chilled.getId(), AttackTarget.Enemy)\r\n    ) {\r\n      return {\r\n        name: t(\"Soak\"),\r\n        delay: this.getAttackDelay(state) * 0.2,\r\n        transform: (state) =>\r\n          grantTemporaryEffect(Wet.getId(), 60, {\r\n            target: AttackTarget.Enemy,\r\n          })(state),\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(\r\n        state,\r\n        HasteTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      ) &&\r\n      getCurrentEnemyHPFraction(state) < 0.5\r\n    ) {\r\n      return {\r\n        name: t(\"Haste\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: grantTemporaryEffect(HasteTemporaryEffect.getId(), 30, {\r\n          target: AttackTarget.Enemy,\r\n          params: { commonBuff: { AttackDelayMultiplier: 0.75 } },\r\n        }),\r\n      };\r\n    }\r\n    if (Math.random() < 0.5) {\r\n      return {\r\n        name: t(\"Splash\"),\r\n        delay: this.getAttackDelay(state) * 1.1,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.1,\r\n            {\r\n              tags: [SpellElement.Water],\r\n              cause: t(\"Splash\"),\r\n              onHit: (state, result) => {\r\n                if (result.isHit) {\r\n                  state = grantTemporaryEffect(Wet.getId(), 15, {\r\n                    target: result.target,\r\n                  })(state);\r\n                }\r\n                return state;\r\n              },\r\n            },\r\n          );\r\n\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 24,\r\n        chance: 1.0,\r\n      },\r\n      {\r\n        itemId: EtherealEelExtract.getId(),\r\n        amount: 1,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"This eel is... it's almost as if it *wasn't there*! It is very hard to find, and it is mighty strong. **If we're not actively looking for it, we probably will not stand a chance!** That said, if we somehow ARE hunting for this enemy in particular, then we probably ARE strong enough; and in that case, this fight might not be THAT difficult... Just watch out for Wide Tsunami and avoid using Fire spells - and it'll be OK!\",\r\n    );\r\n  }\r\n}\r\n\r\nexport default new EtherealEel();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { incrementAccumulatorVariable } from \"../../../AccumulatorVariables\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport { Seared } from \"../../../temporaryeffects/Seared\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport {\r\n  calculateAttackTarget,\r\n  getCurrentEnemyHPFraction,\r\n  modifyEnemyCurrentHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { pushCombatActionResult } from \"../../ExplorationActionResult\";\r\nimport { getLastQueuedActionResult } from \"../../ExplorationUtils\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass GoblinDoctor extends Enemy {\r\n  getId(): string {\r\n    return \"goblinDoctor\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Goblin Doctor\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 1199,\r\n      attack: 60,\r\n      defense: 25,\r\n      attackDelay: 2.3,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./goblinDoctor.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 18;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 62;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 45;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (\r\n      getResourceAmount(state, Resource.Coins) >= 250 &&\r\n      Math.random() < 0.1\r\n    ) {\r\n      return {\r\n        name: t(\"Steal Coins\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) =>\r\n          grantResource(Resource.Coins, -(50 + 200 * Math.random()))(state),\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(state, poison.getId(), target) &&\r\n      Math.random() < 0.2\r\n    ) {\r\n      return {\r\n        name: t(\"Sting\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.0,\r\n            { tags: [SpellElement.Poison] },\r\n          );\r\n          const lastActionResult = getLastQueuedActionResult(state);\r\n          if (lastActionResult.isHit) {\r\n            state = grantTemporaryEffect(poison.getId(), 12, {\r\n              target: lastActionResult.target,\r\n              params: {\r\n                magnitude: this.getAttack(state) / 16,\r\n              },\r\n            })(state);\r\n          }\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.1) {\r\n      return {\r\n        name: t(\"Sear\"),\r\n        delay: this.getAttackDelay(state) * 2.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 2.0,\r\n            { tags: [SpellElement.Fire] },\r\n          );\r\n          const lastActionResult = getLastQueuedActionResult(state);\r\n          if (lastActionResult.isHit) {\r\n            state = grantTemporaryEffect(Seared.getId(), 12, {\r\n              target: lastActionResult.target,\r\n            })(state);\r\n          }\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (\r\n      hasTemporaryEffect(state, Seared.getId(), target) &&\r\n      Math.random() < 0.8\r\n    ) {\r\n      return {\r\n        name: t(\"Air Blast\"),\r\n        delay: this.getAttackDelay(state) * 0.5,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 0.7,\r\n            { tags: [SpellElement.Air] },\r\n          );\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.2) {\r\n      return {\r\n        name: t(\"Fireball\"),\r\n        delay: this.getAttackDelay(state) * 1.5,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.5,\r\n            { tags: [SpellElement.Fire] },\r\n          );\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.2 && getCurrentEnemyHPFraction(state) < 1.0) {\r\n      return {\r\n        name: t(\"Droplet of Healing\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          const healAmt = this.getMaxHP(state) * (0.05 + Math.random() * 0.025);\r\n          state = modifyEnemyCurrentHP(state, healAmt);\r\n          const actionResult = {\r\n            id: Math.random().toString(),\r\n            damage: -healAmt,\r\n            isCrit: false,\r\n            isHit: true,\r\n            time: getSecondsPlayed(state),\r\n            source: AttackTarget.Enemy,\r\n            target: AttackTarget.Enemy,\r\n            tags: [],\r\n          };\r\n          state = pushCombatActionResult(state, actionResult);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: copperOre.getId(),\r\n        amount: 2,\r\n        chance: 1.0,\r\n      },\r\n      {\r\n        itemId: cotton.getId(),\r\n        amount: 2,\r\n        chance: 0.2,\r\n      },\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 1,\r\n        chance: 0.8,\r\n      },\r\n    ];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    if (!isFromCreatures) {\r\n      state = incrementAccumulatorVariable(state, \"goblinKills\", 1);\r\n    }\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new GoblinDoctor();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport {\r\n  calculateAttackTarget,\r\n  drainingEnemyAttackEffect,\r\n  getCurrentEnemyHPFraction,\r\n  modifyEnemyCurrentHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { pushCombatActionResult } from \"../../ExplorationActionResult\";\r\nimport { Enemies, getCurrentEnemy } from \"../Enemies\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass DoubleTroubleTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"doubleTrouble\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Double Trouble\");\r\n  }\r\n  isDispellable(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Transforms into a different form\");\r\n  }\r\n}\r\n\r\nclass BotanicalSwarmTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"botanicalSwarm\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Botanical Swarm\");\r\n  }\r\n  isDispellable(): boolean {\r\n    return false;\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Transforms into a different form\");\r\n  }\r\n}\r\n\r\nconst doubleTroubleTemporaryEffect = new DoubleTroubleTemporaryEffect();\r\nconst botanicalSwarmTemporaryEffect = new BotanicalSwarmTemporaryEffect();\r\n\r\nclass ManEatingPlant extends Enemy {\r\n  getId(): string {\r\n    return \"manEatingPlant\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Man-Eating Plant\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 8000,\r\n      attack: 60,\r\n      defense: 50,\r\n      attackDelay: 2.8,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPhase(state: GameState): number {\r\n    if (getCurrentEnemy(state) != this) {\r\n      return 1;\r\n    }\r\n    if (\r\n      hasTemporaryEffect(\r\n        state,\r\n        botanicalSwarmTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      )\r\n    ) {\r\n      return 3;\r\n    }\r\n    if (\r\n      hasTemporaryEffect(\r\n        state,\r\n        doubleTroubleTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      )\r\n    ) {\r\n      return 2;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    switch (this.getPhase(state)) {\r\n      case 3:\r\n        return require(\"./manEatingPlant3.png\");\r\n      case 2:\r\n        return require(\"./manEatingPlant2.png\");\r\n      default:\r\n        return require(\"./manEatingPlant.png\");\r\n    }\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 20;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 500;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 200;\r\n  }\r\n\r\n  getNextActionPhase3(state: GameState): BattlerAction {\r\n    if (Math.random() < 0.4) {\r\n      return {\r\n        name: t(\"Triple Absorb\"),\r\n        delay: this.getAttackDelay(state) * 1.5,\r\n        transform: (state: GameState) => {\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: t(\"Triple Attack\"),\r\n      delay: this.getAttackDelay(state) * 1.2,\r\n      transform: (state) => {\r\n        state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n        state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n        state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n        return state;\r\n      },\r\n    };\r\n  }\r\n\r\n  getNextActionPhase2(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (\r\n      !hasTemporaryEffect(state, poison.getId(), target) &&\r\n      Math.random() < 0.1\r\n    ) {\r\n      return {\r\n        name: t(\"Slow-Acting Poison\"),\r\n        delay: this.getAttackDelay(state) * 1.4,\r\n        transform: (state) => {\r\n          const target = calculateAttackTarget(state);\r\n          state = grantTemporaryEffect(poison.getId(), 60, {\r\n            target,\r\n            params: {\r\n              magnitude: this.getAttack(state) / 20,\r\n            },\r\n          })(state);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    if (Math.random() < 0.4) {\r\n      return {\r\n        name: t(\"Double Absorb\"),\r\n        delay: this.getAttackDelay(state) * 1.3,\r\n        transform: (state: GameState) => {\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: t(\"Double Attack\"),\r\n      delay: this.getAttackDelay(state) * 1.1,\r\n      transform: (state) => {\r\n        state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n        state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n        return state;\r\n      },\r\n    };\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const phase = this.getPhase(state);\r\n    if (getCurrentEnemyHPFraction(state) < 0.2 && phase < 3) {\r\n      // Switch to phase 3\r\n      return {\r\n        name: t(\"Mutate\"),\r\n        delay: this.getAttackDelay(state) * 2.0,\r\n        transform: (state) => {\r\n          state = grantTemporaryEffect(\r\n            botanicalSwarmTemporaryEffect.getId(),\r\n            600,\r\n            {\r\n              target: AttackTarget.Enemy,\r\n            },\r\n          )(state);\r\n          state = clearTemporaryEffect(\r\n            doubleTroubleTemporaryEffect.getId(),\r\n            AttackTarget.Enemy,\r\n          )(state);\r\n          const healAmt = this.getMaxHP(state) * 0.2;\r\n          state = modifyEnemyCurrentHP(state, healAmt);\r\n          const actionResult = {\r\n            id: Math.random().toString(),\r\n            damage: -healAmt,\r\n            isCrit: false,\r\n            isHit: true,\r\n            time: getSecondsPlayed(state),\r\n            source: AttackTarget.Enemy,\r\n            target: AttackTarget.Enemy,\r\n            tags: [],\r\n          };\r\n          state = pushCombatActionResult(state, actionResult);\r\n          return state;\r\n        },\r\n      };\r\n    } else if (getCurrentEnemyHPFraction(state) < 0.6 && phase < 2) {\r\n      // Switch to phase 2\r\n      return {\r\n        name: t(\"Mutate\"),\r\n        delay: this.getAttackDelay(state) * 1.5,\r\n        transform: (state) => {\r\n          state = grantTemporaryEffect(\r\n            doubleTroubleTemporaryEffect.getId(),\r\n            600,\r\n            {\r\n              target: AttackTarget.Enemy,\r\n            },\r\n          )(state);\r\n          state = clearTemporaryEffect(\r\n            botanicalSwarmTemporaryEffect.getId(),\r\n            AttackTarget.Enemy,\r\n          )(state);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    if (phase == 3) {\r\n      return this.getNextActionPhase3(state);\r\n    } else if (phase == 2) {\r\n      return this.getNextActionPhase2(state);\r\n    }\r\n\r\n    const target = calculateAttackTarget(state);\r\n\r\n    if (\r\n      !hasTemporaryEffect(state, poison.getId(), target) &&\r\n      Math.random() < 0.2\r\n    ) {\r\n      return {\r\n        name: t(\"Deadly Poison\"),\r\n        delay: this.getAttackDelay(state) * 1.2,\r\n        transform: (state) => {\r\n          const target = calculateAttackTarget(state);\r\n          state = grantTemporaryEffect(poison.getId(), 12, {\r\n            target,\r\n            params: {\r\n              magnitude: this.getAttack(state) / 6,\r\n            },\r\n          })(state);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    if (Math.random() < 0.4) {\r\n      return {\r\n        name: t(\"Absorb\"),\r\n        delay: this.getAttackDelay(state) * 1.1,\r\n        transform: (state: GameState) => {\r\n          state = drainingEnemyAttackEffect(state, this.getAttack(state));\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getBackdropColor(): string {\r\n    return \"#84a\";\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = setDungeonFloorCompleted(state, \"sewerHideout\");\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"This giant plant is unbelievably strong. It might be the hardest fight we have done so far. Very strong attacks, very strong poison. Using Antidote (needs Poison Lv7) can certainly help us here, too, as we can neutralize the very strong poison it has. But the worst part is that it mutates into even more dangerous forms eventually! I wonder if higher :defense: would help us on the later forms...\",\r\n    );\r\n  }\r\n}\r\n\r\nexport const manEatingPlant = new ManEatingPlant();\r\n\r\nexport function loadManEatingPlant() {\r\n  TemporaryEffects.register(doubleTroubleTemporaryEffect);\r\n  TemporaryEffects.register(botanicalSwarmTemporaryEffect);\r\n  Enemies.register(manEatingPlant);\r\n}\r\n","import { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { PouchItem } from \"../PouchItem\";\r\n\r\n// Note: This class expects an action effect called \"duration\"\r\n// It will pass all other item effects as params to the temporary effect\r\nexport abstract class BuffingPouchItem extends PouchItem {\r\n  abstract getTemporaryEffect(): TemporaryEffect;\r\n\r\n  getId(): string {\r\n    return this.getTemporaryEffect().getId();\r\n  }\r\n\r\n  getPicture() {\r\n    return this.getTemporaryEffect().getIcon();\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return this.getTemporaryEffect().getDisplayName();\r\n  }\r\n\r\n  getTarget() {\r\n    return AttackTarget.Player;\r\n  }\r\n\r\n  doPouchItemEffect(state: GameState, params: ItemParams): GameState {\r\n    const { duration, ...other } = this.getItemEffects(state, params);\r\n    state = grantTemporaryEffect(this.getTemporaryEffect().getId(), duration, {\r\n      target: this.getTarget(),\r\n      params: other,\r\n    })(state);\r\n    return state;\r\n  }\r\n\r\n  doCleanup(state: GameState, params: ItemParams): GameState {\r\n    state = super.doCleanup(state, params);\r\n    state = clearTemporaryEffect(\r\n      this.getTemporaryEffect().getId(),\r\n      this.getTarget(),\r\n    )(state);\r\n    return state;\r\n  }\r\n\r\n  shouldAutoUse(state: GameState, params: ItemParams): boolean {\r\n    return !hasTemporaryEffect(\r\n      state,\r\n      this.getTemporaryEffect().getId(),\r\n      this.getTarget(),\r\n    );\r\n  }\r\n}\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { BuffingPouchItem } from \"./BuffingPouchItem\";\r\n\r\nclass VenomousBrew extends BuffingPouchItem {\r\n  getId(): string {\r\n    return \"venomousBrew\";\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Venomous Brew\");\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./venomousBrew.png\");\r\n  }\r\n\r\n  getTemporaryEffect(): TemporaryEffect {\r\n    return poison;\r\n  }\r\n\r\n  getTarget(): AttackTarget {\r\n    return AttackTarget.Enemy;\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A toxic compound. Holds a potent poison.\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n\r\n    return t(\r\n      'Apply ^-{{magnitude}}^<{{explanation}}>:hp:/sec \"Poison\" for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        magnitude: formatNumber(effects.magnitude),\r\n        explanation: explanations?.magnitude,\r\n        duration: formatNumber(Math.floor(effects.duration)),\r\n        durationExplanation: explanations?.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 700;\r\n  }\r\n\r\n  getUsesPerCombatBase(params: ItemParams): number {\r\n    return 3;\r\n  }\r\n}\r\n\r\nexport const venomousBrew = new VenomousBrew();\r\n\r\nclass TransmuteVenomousBrew extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return venomousBrew;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 10,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        PoisonEssence: 3500,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n        venomPowder: 10,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteVenomousBrew = new TransmuteVenomousBrew();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { venomousBrew } from \"../../../items/equipment/pouch/VenomousBrew\";\r\nimport VenomPowder from \"../../../items/material/VenomPowder\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { poison } from \"../../../temporaryeffects/Poison\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { weakened } from \"../../../temporaryeffects/Weakened\";\r\nimport {\r\n  calculateAttackTarget,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { getLastQueuedActionResult } from \"../../ExplorationUtils\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass VenomousSpider extends Enemy {\r\n  getId(): string {\r\n    return \"venomousSpider\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Venomous Spider\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 1100,\r\n      attack: 57,\r\n      defense: 10,\r\n      attackDelay: 1.5,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./venomousSpider.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 17;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 72;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 38;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (\r\n      !hasTemporaryEffect(state, weakened.getId(), target) &&\r\n      Math.random() < 0.3\r\n    ) {\r\n      return {\r\n        name: t(\"Debilitating Venom\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.0,\r\n            { tags: [SpellElement.Poison] },\r\n          );\r\n          const lastActionResult = getLastQueuedActionResult(state);\r\n          if (lastActionResult.isHit) {\r\n            state = grantTemporaryEffect(weakened.getId(), 18, {\r\n              target: lastActionResult.target,\r\n              params: {\r\n                commonBuff: { AttackMultiplier: 0.7 },\r\n              },\r\n            })(state);\r\n          }\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (\r\n      !hasTemporaryEffect(state, poison.getId(), target) &&\r\n      Math.random() < 0.2\r\n    ) {\r\n      return {\r\n        name: t(\"Sting\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.0,\r\n            { tags: [SpellElement.Poison] },\r\n          );\r\n          const lastActionResult = getLastQueuedActionResult(state);\r\n          if (lastActionResult.isHit) {\r\n            state = grantTemporaryEffect(poison.getId(), 12, {\r\n              target: lastActionResult.target,\r\n              params: {\r\n                magnitude: this.getAttack(state) / 12,\r\n              },\r\n            })(state);\r\n          }\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.1) {\r\n      return {\r\n        name: t(\"Hop\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) => state,\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: VenomPowder.getId(),\r\n        amount: 1,\r\n        chance: 0.5,\r\n      },\r\n      {\r\n        itemId: cotton.getId(),\r\n        amount: 2,\r\n        chance: 0.35,\r\n      },\r\n      {\r\n        itemId: venomousBrew.getId(),\r\n        amount: 1,\r\n        chance: 0.01,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new VenomousSpider();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport EtherealEel from \"../../enemies/sewers/EtherealEel\";\r\nimport GoblinDoctor from \"../../enemies/sewers/GoblinDoctor\";\r\nimport GoblinSharpshooter from \"../../enemies/sewers/GoblinSharpshooter\";\r\nimport { manEatingPlant } from \"../../enemies/sewers/ManEatingPlant\";\r\nimport Sicklefish from \"../../enemies/sewers/Sicklefish\";\r\nimport VenomousSpider from \"../../enemies/sewers/VenomousSpider\";\r\nimport {\r\n  DungeonFloor,\r\n  ExplorationPossibility,\r\n  encounterEnemy,\r\n} from \"../DungeonFloor\";\r\nimport { DungeonFloors, isDungeonFloorCompletedThisRun } from \"../Dungeons\";\r\n\r\nconst EXPLORATION_POSSIBILITIES = [\r\n  {\r\n    weight: 30,\r\n    transforms: encounterEnemy(GoblinSharpshooter),\r\n  },\r\n  {\r\n    weight: 100,\r\n    transforms: encounterEnemy(GoblinDoctor),\r\n  },\r\n  {\r\n    weight: 20,\r\n    transforms: encounterEnemy(Sicklefish),\r\n  },\r\n  {\r\n    weight: 100,\r\n    transforms: encounterEnemy(VenomousSpider),\r\n  },\r\n  {\r\n    weight: 1,\r\n    transforms: encounterEnemy(EtherealEel),\r\n  },\r\n];\r\nclass SewerHideout extends DungeonFloor {\r\n  getId(): string {\r\n    return \"sewerHideout\";\r\n  }\r\n  getFloorName(): string {\r\n    return t(\"Sewer Hideout\");\r\n  }\r\n  getBoss(state: GameState): Enemy {\r\n    return manEatingPlant;\r\n  }\r\n  getBreedingLevel(): number {\r\n    return 16;\r\n  }\r\n  isMainStoryDungeonFloor(): boolean {\r\n    return true;\r\n  }\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 5.5;\r\n  }\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 30;\r\n  }\r\n  getBaseExplorationPossibilities(state: GameState): ExplorationPossibility[] {\r\n    return EXPLORATION_POSSIBILITIES;\r\n  }\r\n  isUnlocked(state: GameState): boolean {\r\n    return isDungeonFloorCompletedThisRun(state, \"sewerHazardousSector\");\r\n  }\r\n  getNextFloor(state: GameState): DungeonFloor {\r\n    // Indirect reference due to demo\r\n    return DungeonFloors.getByIdNullable(\"vastDesertFloor\");\r\n  }\r\n}\r\n\r\nexport default new SewerHideout();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport Goblin from \"../../enemies/sewers/Goblin\";\r\nimport GoblinSharpshooter from \"../../enemies/sewers/GoblinSharpshooter\";\r\nimport SewerFly from \"../../enemies/sewers/SewerFly\";\r\nimport Sicklefish from \"../../enemies/sewers/Sicklefish\";\r\nimport SludgeMass from \"../../enemies/sewers/SludgeMass\";\r\nimport {\r\n  DungeonFloor,\r\n  encounterEnemy,\r\n  ExplorationPossibility,\r\n} from \"../DungeonFloor\";\r\nimport { isDungeonFloorCompletedThisRun } from \"../Dungeons\";\r\nimport SewerHideout from \"./SewerHideout\";\r\n\r\nconst EXPLORATION_POSSIBILITIES = [\r\n  {\r\n    weight: 70,\r\n    transforms: encounterEnemy(Goblin),\r\n  },\r\n  {\r\n    weight: 60,\r\n    transforms: encounterEnemy(GoblinSharpshooter),\r\n  },\r\n  {\r\n    weight: 80,\r\n    transforms: encounterEnemy(Sicklefish),\r\n  },\r\n  {\r\n    weight: 80,\r\n    transforms: encounterEnemy(SewerFly),\r\n  },\r\n];\r\nclass SewerHazardousSector extends DungeonFloor {\r\n  getId(): string {\r\n    return \"sewerHazardousSector\";\r\n  }\r\n  getFloorName(): string {\r\n    return t(\"Hazardous Sector\");\r\n  }\r\n  getBoss(state: GameState): Enemy {\r\n    return SludgeMass;\r\n  }\r\n  getBreedingLevel(): number {\r\n    return 13;\r\n  }\r\n  isMainStoryDungeonFloor(): boolean {\r\n    return true;\r\n  }\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 5.25;\r\n  }\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 30;\r\n  }\r\n  getBaseExplorationPossibilities(state: GameState): ExplorationPossibility[] {\r\n    return EXPLORATION_POSSIBILITIES;\r\n  }\r\n  getNextFloor(state: GameState): DungeonFloor {\r\n    return SewerHideout;\r\n  }\r\n  isUnlocked(state: GameState): boolean {\r\n    return isDungeonFloorCompletedThisRun(state, \"sewerEntrance\");\r\n  }\r\n}\r\n\r\nexport default new SewerHazardousSector();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport EvolvedSlime from \"../../enemies/sewers/EvolvedSlime\";\r\nimport Goblin from \"../../enemies/sewers/Goblin\";\r\nimport MutatedFish from \"../../enemies/sewers/MutatedFish\";\r\nimport PoisonousToad from \"../../enemies/sewers/PoisonousToad\";\r\nimport SewerFish from \"../../enemies/sewers/SewerFish\";\r\nimport {\r\n  DungeonFloor,\r\n  encounterEnemy,\r\n  ExplorationPossibility,\r\n} from \"../DungeonFloor\";\r\nimport SewerHazardousSector from \"./SewerHazardousSector\";\r\n\r\nconst EXPLORATION_POSSIBILITIES = [\r\n  {\r\n    weight: 100,\r\n    transforms: encounterEnemy(EvolvedSlime),\r\n  },\r\n  {\r\n    weight: 70,\r\n    transforms: encounterEnemy(PoisonousToad),\r\n  },\r\n  {\r\n    weight: 70,\r\n    transforms: encounterEnemy(SewerFish),\r\n  },\r\n  {\r\n    weight: 10,\r\n    transforms: encounterEnemy(Goblin),\r\n  },\r\n];\r\nclass SewerEntrance extends DungeonFloor {\r\n  getId(): string {\r\n    return \"sewerEntrance\";\r\n  }\r\n  getFloorName(): string {\r\n    return t(\"Sewer Entrance\");\r\n  }\r\n  getBoss(state: GameState): Enemy {\r\n    return MutatedFish;\r\n  }\r\n  getBreedingLevel(): number {\r\n    return 10;\r\n  }\r\n  isMainStoryDungeonFloor(): boolean {\r\n    return true;\r\n  }\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 5.0;\r\n  }\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 30;\r\n  }\r\n  getBaseExplorationPossibilities(state: GameState): ExplorationPossibility[] {\r\n    return EXPLORATION_POSSIBILITIES;\r\n  }\r\n  getNextFloor(state: GameState): DungeonFloor {\r\n    return SewerHazardousSector;\r\n  }\r\n  isUnlocked(state: GameState): boolean {\r\n    return hasFlag(state, Flag.SewersUnlocked);\r\n  }\r\n}\r\n\r\nexport default new SewerEntrance();\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { Building } from \"../../../buildings/Building\";\r\nimport { getBuildingAmount } from \"../../../buildings/Buildings\";\r\nimport { essenceCatalyst } from \"../../../buildings/catalysts/EssenceCatalyst\";\r\nimport { ManaSpout } from \"../../../buildings/mana/ManaSpout\";\r\nimport { SaleStall } from \"../../../buildings/SaleStall\";\r\nimport { essenceStorage } from \"../../../buildings/storages/EssenceStorage\";\r\nimport { ManaShard } from \"../../../buildings/storages/ManaShard\";\r\nimport SewerEntrance from \"../../../exploration/dungeons/sewers/SewerEntrance\";\r\nimport {\r\n  addEnemyDeathListener,\r\n  getSuccessfulExplorationsForFloor,\r\n} from \"../../../exploration/Exploration\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { setFlag } from \"../../../Flags\";\r\nimport { registerPostRetirementListener } from \"../../../Retire\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nexport const FURNITURE_PRESERVATION_OPTIONS: {\r\n  furniture: Building;\r\n  amount: number;\r\n}[] = [\r\n  { furniture: ManaSpout, amount: 12 }, // 24 land\r\n  { furniture: ManaShard, amount: 8 }, // 16 land\r\n  { furniture: essenceStorage, amount: 5 }, // 25 land\r\n  { furniture: essenceCatalyst, amount: 2 }, // 20 land\r\n  { furniture: SaleStall, amount: 3 }, // 12 land\r\n];\r\n\r\nexport function loadFurniturePreservation() {\r\n  function createStorylineForOption(option: {\r\n    furniture: Building;\r\n    amount: number;\r\n  }) {\r\n    const { furniture, amount } = option;\r\n    return new Storyline(\r\n      \"furniturePreservation-\" + furniture.getId(),\r\n      t(\"Furniture Preservation ({{furniture}})\", {\r\n        furniture: furniture.getName(),\r\n      }),\r\n      210 + FURNITURE_PRESERVATION_OPTIONS.indexOf(option),\r\n      20,\r\n      (state) =>\r\n        !furniturePreservationEvent.hasTriggered(state)\r\n          ? t(\"Explore the Sewer Entrance\", {\r\n              amount: formatNumber(amount),\r\n              furniture: furniture.getName(),\r\n            })\r\n          : t(\r\n              \"This Storyline can be found in the Sewers, but you cannot get it this run\",\r\n            ),\r\n      t(\"Begin with {{amount}} {{furniture}} after retirement\", {\r\n        amount: formatNumber(amount),\r\n        furniture: furniture.getName(),\r\n      }),\r\n      (_state) => true,\r\n    );\r\n  }\r\n\r\n  const furniturePreservationStorylines: Storyline[] =\r\n    FURNITURE_PRESERVATION_OPTIONS.map((option) =>\r\n      createStorylineForOption(option),\r\n    );\r\n\r\n  const furniturePreservationEventBuilder = buildEvent(\r\n    \"furniturePreservation\",\r\n    t(\"(Storyline) Furniture Preservation\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(\r\n    furniturePreservationStorylines.map((storyline) => storyline.getId()),\r\n  );\r\n\r\n  furniturePreservationEventBuilder.message(\r\n    t(\r\n      `While traversing the Sewers, you find a curious item on the floor: a container of some kind of... substance? Gel? Cream? You are not sure exactly what it is. There is a label, however: \"Furniture Preserver\". You decide to bring it home.\r\n      \r\nBut when you show your hired wizard, she exclaims, really excited: \"*Furniture Preserver*?! I've been wanting some of that for a very long time! It is so rare and yet so useful! Can I have it? Pretty please...?\" She proceeds to look at you with a puppy face.\r\n\r\nShe then explains herself: like the label says, this substance can be applied to furniture for it to last very, very long, almost indefinitely long.`,\r\n    ),\r\n  );\r\n\r\n  const messageBuilder = furniturePreservationEventBuilder.message(\r\n    t(\r\n      `You think about the furniture you already own. There isn't so much of this preserver. You tell your hired wizard that you are planning to use half of it, and that she can have the rest. She bursts in happiness and thanks you, full of joy.\r\n      \r\nAnd then, you have to think of how you are going to use your half...`,\r\n    ),\r\n  );\r\n\r\n  for (let idx in FURNITURE_PRESERVATION_OPTIONS) {\r\n    const option = FURNITURE_PRESERVATION_OPTIONS[idx];\r\n    const storyline = furniturePreservationStorylines[idx];\r\n    const tParams = {\r\n      amount: formatNumber(option.amount),\r\n      furniture: option.furniture.getName(),\r\n    };\r\n    messageBuilder.option(\r\n      t(\"Preserve {{amount}} {{furniture}}\", tParams),\r\n      {\r\n        transform: (state) => storyline.complete(state),\r\n        isVisible: (state) => !storyline.isCompleted(state),\r\n        isEnabled: (state) =>\r\n          getBuildingAmount(state, option.furniture) >= option.amount,\r\n      },\r\n      \"end-\" + option.furniture.getId(),\r\n    );\r\n    furniturePreservationEventBuilder\r\n      .message(\r\n        t(\r\n          `You carefully apply the preserver to your furniture. As you do, it begins to glow with a strange, yet gentle blue light. It was actually a *magical* product?\r\n      \r\nFinishing up, you give the remaining preserver to your hired wizard. She thanks you, and proceeds to quickly apply it *on herself*. You try to tell her that it's probably not going to work, but she quickly says it's none of your business...\r\n\r\n**You have completed the Storyline \"Furniture Preservation ({{furniture}})\"! In future retirements, you will begin with {{amount}} {{furniture}} already in your Home!**`,\r\n          tParams,\r\n        ),\r\n      )\r\n      .tag(\"end-\" + option.furniture.getId())\r\n      .end();\r\n  }\r\n\r\n  messageBuilder.option(t(\"Decide later\")).end();\r\n\r\n  for (let idx in FURNITURE_PRESERVATION_OPTIONS) {\r\n    Storylines.register(furniturePreservationStorylines[idx]);\r\n  }\r\n\r\n  const furniturePreservationEvent = furniturePreservationEventBuilder.build();\r\n\r\n  addEnemyDeathListener(\r\n    furniturePreservationEvent.getId() + \"Triggerer\",\r\n    (state) => {\r\n      if (\r\n        !furniturePreservationEvent.hasTriggered(state) &&\r\n        furniturePreservationStorylines.some(\r\n          (storyline) => !storyline.isCompleted(state),\r\n        ) &&\r\n        (getSuccessfulExplorationsForFloor(state, \"sewerEntrance\") >= 8 ||\r\n          SewerEntrance.canFightBoss(state))\r\n      ) {\r\n        return triggerEvent(furniturePreservationEvent)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  FURNITURE_PRESERVATION_OPTIONS.forEach((option, idx) => {\r\n    const id = option.furniture.getId();\r\n    const storyline = furniturePreservationStorylines[idx];\r\n    registerPostRetirementListener(\"furniturePreservation\" + id, (state) => {\r\n      if (storyline.isBonusActive(state)) {\r\n        state.run.buildings[id] = {\r\n          current: option.amount,\r\n          turnedOn: option.amount,\r\n        };\r\n      }\r\n\r\n      return state;\r\n    });\r\n  });\r\n\r\n  registerPostRetirementListener(\r\n    \"furniturePreservationAutoUnlockStuff\",\r\n    (state) => {\r\n      // Mana Spouts\r\n      if (furniturePreservationStorylines[0].isBonusActive(state)) {\r\n        state = setFlag(Flag.ManaSpoutsUnlocked)(state);\r\n      }\r\n      // Mana Shards\r\n      if (furniturePreservationStorylines[1].isBonusActive(state)) {\r\n        state = setFlag(Flag.ManaShardsUnlocked)(state);\r\n      }\r\n      // Essence Storages\r\n      if (furniturePreservationStorylines[2].isBonusActive(state)) {\r\n        state = setFlag(Flag.StoragesUnlocked)(state);\r\n      }\r\n      // Essence Catalysts\r\n      if (furniturePreservationStorylines[3].isBonusActive(state)) {\r\n        state = setFlag(Flag.CatalystsUnlocked)(state);\r\n      }\r\n      // Market Stalls\r\n      if (furniturePreservationStorylines[4].isBonusActive(state)) {\r\n        state = setFlag(Flag.SaleStallsUnlocked)(state);\r\n      }\r\n\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport {\r\n  getAutocastStatusByRule,\r\n  getCurrentAutocastStrategy,\r\n} from \"../../../autocast/Autocast\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { setFlag } from \"../../../Flags\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport { registerPostRetirementListener } from \"../../../Retire\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nexport const permacastStoryline = new Storyline(\r\n  \"permaCast\",\r\n  t(\"Perma-Cast\"),\r\n  295,\r\n  10,\r\n  (state) =>\r\n    t(\r\n      \"Have at least 15 rules in your Wizards' current strategy that each have at least 1 Wizard assigned\",\r\n    ),\r\n  (state) => t('Unlock \"Perma-Cast\" option for spells'),\r\n  (state) => true,\r\n);\r\n\r\nexport function loadPermaCast() {\r\n  Storylines.register(permacastStoryline);\r\n  const eventBuilder = buildEvent(\"permaCast\", t(\"(Storyline) Perma-Cast\"), [\r\n    EventTag.STORYLINE,\r\n  ]).setStorylineIds(permacastStoryline.getId());\r\n\r\n  eventBuilder\r\n    .message(\r\n      t(`One more spell to be cast by Wizards! You watch as your :mana: reserves empty with each spell cast, only to quickly recover and go down again.\r\n    \r\nYour set of instructions is growing more and more complicated, and yet, you are starting to realize that many of them are simply: \"cast this spell as often as necessary or possible\".`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = permacastStoryline.complete(state);\r\n          state = permacastStoryline.activateBonus(state);\r\n          state = setFlag(Flag.PermaCastUnlocked)(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    );\r\n  eventBuilder\r\n    .message(\r\n      t(`Those are much simpler instructions. You realize it should be a lot easier to give these instructions and quickly come up with a method. And you're just about ready to try it out...\r\n\r\n**You have completed the \"Perma-Cast\" Storyline! You have permanently unlocked a feature to \"Perma-Cast\" many spells, including things like buffs, or anything with a cooldown. You may set spells to \"Perma-Cast\" by expanding the spell's details in the Spell menu, and otherwise manage these spells in the Wizards screen!**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const event = eventBuilder.build();\r\n\r\n  addGameStateListener(event.getId(), (state) => {\r\n    if (\r\n      !event.hasTriggered(state) &&\r\n      !permacastStoryline.isCompleted(state) &&\r\n      getCurrentAutocastStrategy(state).rules.filter(\r\n        (rule) => getAutocastStatusByRule(state, rule)?.wizardsAssigned > 0,\r\n      ).length >= 15\r\n    ) {\r\n      return triggerEvent(event);\r\n    }\r\n  });\r\n\r\n  registerPostRetirementListener(\r\n    permacastStoryline.getId(),\r\n    (state, isMock) => {\r\n      if (permacastStoryline.isBonusActive(state)) {\r\n        state = setFlag(Flag.PermaCastUnlocked)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"tictactoe\",\r\n  t(\"Tic-Tac-Toe\"),\r\n  225,\r\n  10,\r\n  t(\"Defeat the Sludge Mass in the Hazardous Sewers\"),\r\n  t(\"Unlock the Synchro screen\"),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as TicTacToeStoryline };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"tomeOfToxicKnowledge\",\r\n  t(\"Tome of Toxic Knowledge\"),\r\n  299,\r\n  20,\r\n  t('Clear the area \"The Hideout\" in the Sewers'),\r\n  t(\r\n    \"Unlock the Poison element and begin new retirements with Monstruariums and Monstium Catalysts unlocked\",\r\n  ),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as TomeOfToxicKnowledge };\r\n","import { clone, valuesOfCached } from \"../utils/CoreUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { CombatClassesStoryline } from \"./classes/CombatClassesStoryline\";\r\nimport { hasEverTriggeredEnding } from \"./ending/Endings\";\r\nimport { convenienceStoryline } from \"./events/storyline/desert/Convenience\";\r\nimport { FURNITURE_PRESERVATION_OPTIONS } from \"./events/storyline/sewers/FurniturePreservation\";\r\nimport { permacastStoryline } from \"./events/storyline/sewers/PermaCast\";\r\nimport { TicTacToeStoryline } from \"./events/storyline/sewers/TicTacToeStoryline\";\r\nimport { TomeOfToxicKnowledge } from \"./events/storyline/sewers/TomeOfToxicKnowledgeStoryline\";\r\nimport { AttackTarget } from \"./exploration/AttackTarget\";\r\nimport { CombatStat } from \"./exploration/CombatStats\";\r\nimport { GameState, RUN_INITIAL_STATE, WORLD_INITIAL_STATE } from \"./GameState\";\r\nimport { Resource } from \"./Resources\";\r\nimport { retire } from \"./Retire\";\r\nimport { SpellElement } from \"./spells/Elements\";\r\nimport { Storyline } from \"./storylines/Storyline\";\r\nimport { Storylines } from \"./storylines/Storylines\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"./transformation/Transformation\";\r\nimport { TransformationTags } from \"./transformation/TransformationTags\";\r\n\r\nfunction newGamePlusReset(state: GameState): GameState {\r\n  state = retire(state, false);\r\n\r\n  state.world.totalTimesResetted = 0;\r\n  return state;\r\n}\r\n\r\nexport const MAX_DIFFICULTY_LEVEL = 11;\r\nexport const MAX_BOON_LEVEL = 10;\r\n\r\nexport function getMaxPossibleDifficultyLevel(state: GameState): number {\r\n  return Math.min(\r\n    state.global.newGamePlusMax +\r\n      (hasEverTriggeredEnding(state, \"ending_1\") &&\r\n      (state.world.worldDifficultyLevel >= 10 ||\r\n        state.global.newGamePlusMax < 10)\r\n        ? 1\r\n        : 0),\r\n    MAX_DIFFICULTY_LEVEL,\r\n  );\r\n}\r\n\r\nexport const BASE_BOON_POINTS_PER_WORLD = 15;\r\nconst BOON_POINTS_TAGS = [TransformationTags.BoonPointsEarned];\r\n\r\nexport function getTotalAvailableBoonPoints(state: GameState): number {\r\n  return getNewBoonPointsAvailable(state) + state.global.totalBoonPointsEarned;\r\n}\r\n\r\nexport function getNewBoonPointsAvailable(state: GameState): number {\r\n  return applyTransformations(\r\n    BOON_POINTS_TAGS,\r\n    state,\r\n    BASE_BOON_POINTS_PER_WORLD,\r\n  );\r\n}\r\n\r\nexport function triggerNewGamePlus(\r\n  state: GameState,\r\n  sheerPowerLevel: number,\r\n  storylineOracleLevel: number,\r\n  blazingSpeedLevel: number,\r\n  worldDifficultyLevel: number,\r\n): GameState {\r\n  // First, validate the parameters\r\n  if (\r\n    worldDifficultyLevel > getMaxPossibleDifficultyLevel(state) ||\r\n    getTotalAvailableBoonPoints(state) <\r\n      getPointsRequiredForConfiguration(\r\n        sheerPowerLevel,\r\n        storylineOracleLevel,\r\n        blazingSpeedLevel,\r\n      ) ||\r\n    sheerPowerLevel > MAX_BOON_LEVEL ||\r\n    storylineOracleLevel > MAX_BOON_LEVEL ||\r\n    blazingSpeedLevel > MAX_BOON_LEVEL\r\n  ) {\r\n    // Do nothing\r\n    return state;\r\n  }\r\n\r\n  state.global.newGamePlusCount++;\r\n  state.global.newGamePlusMax = getMaxPossibleDifficultyLevel(state);\r\n  state.global.totalBoonPointsEarned += getNewBoonPointsAvailable(state);\r\n  state.world = clone(WORLD_INITIAL_STATE);\r\n  state.world.startTimestamp = Date.now();\r\n  state.world.sheerPowerLevel = sheerPowerLevel;\r\n  state.world.storylineOracleLevel = storylineOracleLevel;\r\n  state.world.blazingSpeedLevel = blazingSpeedLevel;\r\n  state.world.worldDifficultyLevel = worldDifficultyLevel;\r\n  state.run = clone(RUN_INITIAL_STATE);\r\n\r\n  // Must apply all the Storylines for the Oracle\r\n  let storylinesToGrant: Storyline[] = [];\r\n  if (storylineOracleLevel >= 10) {\r\n    const storylinesToAvoid = getStorylinesToAvoidForOracle10();\r\n    storylinesToGrant = Storylines.getAll().filter(\r\n      (storyline) => !storylinesToAvoid.includes(storyline),\r\n    );\r\n  } else {\r\n    let oracleLevel = storylineOracleLevel;\r\n    while (oracleLevel > 0) {\r\n      storylinesToGrant = storylinesToGrant.concat(\r\n        getStorylinesToUnlockForSpecificOracleLevel(oracleLevel),\r\n      );\r\n      oracleLevel--;\r\n    }\r\n  }\r\n  for (let storyline of storylinesToGrant) {\r\n    state = storyline.complete(state);\r\n    state = storyline.activateBonus(state);\r\n  }\r\n\r\n  state = newGamePlusReset(state);\r\n  return state;\r\n}\r\n\r\nfunction fibonacci(n: number) {\r\n  if (n <= 1) {\r\n    return 1;\r\n  }\r\n  return fibonacci(n - 1) + fibonacci(n - 2);\r\n}\r\n\r\nexport function getIncrementalPointsRequiredForLevel(level: number): number {\r\n  return fibonacci(3 + level);\r\n}\r\n\r\nexport function getTotalPointsRequiredForLevel(level: number): number {\r\n  let points = 0;\r\n  for (let l = 1; l <= level; l++) {\r\n    points += getIncrementalPointsRequiredForLevel(l);\r\n  }\r\n  return points;\r\n}\r\n\r\nexport function getPointsRequiredForConfiguration(\r\n  sheerPowerLevel: number,\r\n  storylineOracleLevel: number,\r\n  blazingSpeedLevel: number,\r\n): number {\r\n  return (\r\n    getTotalPointsRequiredForLevel(sheerPowerLevel) +\r\n    getTotalPointsRequiredForLevel(storylineOracleLevel) +\r\n    getTotalPointsRequiredForLevel(blazingSpeedLevel)\r\n  );\r\n}\r\n\r\nexport function getNewGamePlusCount(state: GameState): number {\r\n  return state.global.newGamePlusCount;\r\n}\r\n\r\nexport function getSheerPowerLevel(state: GameState): number {\r\n  return state.world.sheerPowerLevel;\r\n}\r\n\r\nexport function getStorylineOracleLevel(state: GameState): number {\r\n  return state.world.storylineOracleLevel;\r\n}\r\n\r\nexport function getBlazingSpeedLevel(state: GameState): number {\r\n  return state.world.blazingSpeedLevel;\r\n}\r\n\r\nexport function getWorldDifficultyLevel(state: GameState): number {\r\n  return state.world.worldDifficultyLevel;\r\n}\r\n\r\nexport function getNewGamePlusElementMaxLevelBonus(\r\n  sheerPowerLevel: number,\r\n): number {\r\n  if (sheerPowerLevel < 8) {\r\n    return Math.ceil(sheerPowerLevel / 2.0) * 10;\r\n  }\r\n  return Math.floor(sheerPowerLevel / 2.0) * 10;\r\n}\r\n\r\nexport function getNewGamePlusFamiliarMaxLevelBonus(\r\n  sheerPowerLevel: number,\r\n): number {\r\n  return sheerPowerLevel * 4;\r\n}\r\n\r\nexport function getNewGamePlusItemQualityMaxBonus(\r\n  sheerPowerLevel: number,\r\n): number {\r\n  return sheerPowerLevel * 1;\r\n}\r\n\r\nexport function getNewGamePlusStorageMultiplier(\r\n  sheerPowerLevel: number,\r\n): number {\r\n  return Math.pow(1.5, sheerPowerLevel);\r\n}\r\n\r\nexport function getNewGamePlusProductionMultiplier(\r\n  sheerPowerLevel: number,\r\n): number {\r\n  return Math.pow(1.1, sheerPowerLevel);\r\n}\r\n\r\nexport function getNewGamePlusChannelingAndSalePriceMultiplier(\r\n  blazingSpeedLevel: number,\r\n): number {\r\n  return Math.pow(1.8, blazingSpeedLevel);\r\n}\r\n\r\nexport function getNewGamePlusExpGainMultiplier(\r\n  blazingSpeedLevel: number,\r\n): number {\r\n  return Math.pow(1.6, blazingSpeedLevel);\r\n}\r\n\r\nexport function getNewGamePlusLootMultiplier(\r\n  blazingSpeedLevel: number,\r\n): number {\r\n  return Math.pow(1.3, blazingSpeedLevel);\r\n}\r\n\r\nexport function getNewGamePlusHpMultiplier(difficultyLevel: number): number {\r\n  return difficultyLevel > 10 ? 200 : Math.pow(1.6, difficultyLevel);\r\n}\r\n\r\nexport function getNewGamePlusAttackDelayMultiplier(\r\n  difficultyLevel: number,\r\n): number {\r\n  return difficultyLevel > 10 ? 0.25 : Math.pow(0.9, difficultyLevel);\r\n}\r\n\r\nexport function getNewGamePlusAccuracyAndDodgeMultiplier(\r\n  difficultyLevel: number,\r\n): number {\r\n  return difficultyLevel > 10 ? 4.0 : Math.pow(1.1, difficultyLevel);\r\n}\r\n\r\nexport function getNewGamePlusOtherStatMultiplier(\r\n  difficultyLevel: number,\r\n): number {\r\n  return difficultyLevel > 10 ? 25 : Math.pow(1.3, difficultyLevel);\r\n}\r\n\r\nexport function getNewGamePlusBoonPointsEarnedMultiplier(\r\n  difficultyLevel: number,\r\n): number {\r\n  return Math.pow(1.6, difficultyLevel);\r\n}\r\n\r\nexport function getStorylinesToUnlockForSpecificOracleLevel(\r\n  storylineOracleLevel: number,\r\n): Storyline[] {\r\n  switch (storylineOracleLevel) {\r\n    case 1:\r\n      return [\r\n        permacastStoryline,\r\n        convenienceStoryline,\r\n        Storylines.getById(\"terrainAdvantage\"),\r\n      ];\r\n    case 2:\r\n      return [\r\n        TomeOfToxicKnowledge,\r\n        Storylines.getById(\"tomeOfMentalKnowledge\"),\r\n        Storylines.getById(\"tomeOfLivingKnowledge\"),\r\n        Storylines.getById(\"tomeOfElectricalKnowledge\"),\r\n      ];\r\n    case 3:\r\n      return FURNITURE_PRESERVATION_OPTIONS.map((option) =>\r\n        Storylines.getById(\"furniturePreservation-\" + option.furniture.getId()),\r\n      ).concat([Storylines.getById(\"theBigPurchase\")]);\r\n    case 4:\r\n      return [\r\n        Storylines.getById(\"schematics\"),\r\n        Storylines.getById(\"transmutationPrayer1\"),\r\n        TicTacToeStoryline,\r\n      ];\r\n    case 5:\r\n      return [\r\n        Storylines.getById(\"tomeOfDeathlyKnowledge\"),\r\n        Storylines.getById(\"tomeOfDivineKnowledge\"),\r\n        Storylines.getById(\"mysteriousBox\"),\r\n        Storylines.getById(\"starryNight\"),\r\n      ];\r\n    case 6:\r\n      return [\r\n        Storylines.getById(\"varietyCollector\"),\r\n        Storylines.getById(\"boostingMachine\"),\r\n        Storylines.getById(\"transmutationPrayer2\"),\r\n        Storylines.getById(\"artisanOfMagic\"),\r\n      ];\r\n    case 7:\r\n      return valuesOfCached(SpellElement).map((element) =>\r\n        Storylines.getById(\"masteryOf\" + element),\r\n      );\r\n    case 8:\r\n      return [\r\n        CombatClassesStoryline,\r\n        Storylines.getById(\"ritualistsSecret\"),\r\n        Storylines.getById(\"etherealTruthWeapon\"),\r\n        Storylines.getById(\"etherealTruthGarment\"),\r\n        Storylines.getById(\"etherealTruthFootwear\"),\r\n      ];\r\n    case 9:\r\n      return [\r\n        Storylines.getById(\"blessedLand\"),\r\n        Storylines.getById(\"divineCombination\"),\r\n      ];\r\n  }\r\n  return [];\r\n}\r\n\r\nexport function getStorylinesToAvoidForOracle10() {\r\n  // Avoid any \"ending\" or \"challenge\"\r\n  return Storylines.getAll().filter(\r\n    (storyline) =>\r\n      storyline.getId().startsWith(\"ending\") ||\r\n      storyline.getId().startsWith(\"challenge\"),\r\n  );\r\n}\r\n\r\nexport function loadNewGamePlus() {\r\n  // Backend transformations related to New Game Plus\r\n  // Grant extra Boon Points if completed ending_4\r\n  registerTransformation(\r\n    [[TransformationTags.BoonPointsEarned]],\r\n    \"ending1BoonPointsEarned\",\r\n    t(\"World Not Cleared\"),\r\n    TransformationType.Multiplier,\r\n    (state) => (!hasEverTriggeredEnding(state, \"ending_1\") ? 0 : 1.0),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.BoonPointsEarned]],\r\n    \"ending4BoonPointsEarned\",\r\n    t(\"Transcended Humanity\"),\r\n    TransformationType.Multiplier,\r\n    (state) => (hasEverTriggeredEnding(state, \"ending_4\") ? 2.0 : 1.0),\r\n  );\r\n\r\n  // Sheer Power\r\n  registerTransformation(\r\n    [[TransformationTags.MaxElementLevel]],\r\n    \"newGamePlusMaxLevel\",\r\n    t(\"Sheer Power level\"),\r\n    TransformationType.Addition,\r\n    (state) => getNewGamePlusElementMaxLevelBonus(getSheerPowerLevel(state)),\r\n  );\r\n  registerTransformation(\r\n    [[TransformationTags.MaxFamiliarLevel]],\r\n    \"newGamePlusMaxFamiliarLevel\",\r\n    t(\"Sheer Power level\"),\r\n    TransformationType.Addition,\r\n    (state) => getNewGamePlusFamiliarMaxLevelBonus(getSheerPowerLevel(state)),\r\n  );\r\n  registerTransformation(\r\n    [[TransformationTags.ItemQualityMax]],\r\n    \"newGamePlusMaxQuality\",\r\n    t(\"Sheer Power level\"),\r\n    TransformationType.Addition,\r\n    (state) => getNewGamePlusItemQualityMaxBonus(getSheerPowerLevel(state)),\r\n  );\r\n  for (let resource in Resource) {\r\n    if (resource != Resource.Mana && resource != Resource.TimePiece) {\r\n      registerTransformation(\r\n        [[resource, TransformationTags.Cap]],\r\n        resource + \"NewGamePlusStorage\",\r\n        t(\"Sheer Power level\"),\r\n        TransformationType.Multiplier,\r\n        (state) => getNewGamePlusStorageMultiplier(getSheerPowerLevel(state)),\r\n      );\r\n    }\r\n  }\r\n  registerTransformation(\r\n    [[TransformationTags.Production]],\r\n    \"newGamePlusProduction\",\r\n    t(\"Sheer Power level\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getNewGamePlusProductionMultiplier(getSheerPowerLevel(state)),\r\n  );\r\n\r\n  // Blazing Speed\r\n  registerTransformation(\r\n    [[TransformationTags.ExpGain], [TransformationTags.FamiliarExp]],\r\n    \"newGamePlusExpGain\",\r\n    t(\"Blazing Speed level\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getNewGamePlusExpGainMultiplier(getBlazingSpeedLevel(state)),\r\n  );\r\n  registerTransformation(\r\n    [\r\n      [TransformationTags.ChannelingEfficiency],\r\n      [TransformationTags.ItemSalePrice],\r\n    ],\r\n    \"newGamePlusChannelingAndSalePriceGain\",\r\n    t(\"Blazing Speed level\"),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      getNewGamePlusChannelingAndSalePriceMultiplier(\r\n        getBlazingSpeedLevel(state),\r\n      ),\r\n  );\r\n  registerTransformation(\r\n    [[TransformationTags.Loot], [TransformationTags.LootChance]],\r\n    \"newGamePlusLootGain\",\r\n    t(\"Blazing Speed level\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getNewGamePlusLootMultiplier(getBlazingSpeedLevel(state)),\r\n  );\r\n\r\n  // World Difficulty\r\n  registerTransformation(\r\n    [[AttackTarget.Enemy, CombatStat.MaxHP]],\r\n    \"newGamePlusDifficultyHP\",\r\n    t(\"World Difficulty level\"),\r\n    TransformationType.Multiplier,\r\n    (state) => getNewGamePlusHpMultiplier(getWorldDifficultyLevel(state)),\r\n  );\r\n  registerTransformation(\r\n    [[AttackTarget.Enemy, CombatStat.AttackDelay]],\r\n    \"newGamePlusDifficultyAttackDelay\",\r\n    t(\"World Difficulty level\"),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      getNewGamePlusAttackDelayMultiplier(getWorldDifficultyLevel(state)),\r\n  );\r\n  registerTransformation(\r\n    [\r\n      [AttackTarget.Enemy, CombatStat.Attack],\r\n      [AttackTarget.Enemy, CombatStat.Defense],\r\n    ],\r\n    \"newGamePlusEnemyStats\",\r\n    t(\"World Difficulty level\"),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      getNewGamePlusOtherStatMultiplier(getWorldDifficultyLevel(state)),\r\n  );\r\n  registerTransformation(\r\n    [\r\n      [AttackTarget.Enemy, CombatStat.Accuracy],\r\n      [AttackTarget.Enemy, CombatStat.Dodge],\r\n    ],\r\n    \"newGamePlusEnemyStats\",\r\n    t(\"World Difficulty level\"),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      getNewGamePlusAccuracyAndDodgeMultiplier(getWorldDifficultyLevel(state)),\r\n  );\r\n  registerTransformation(\r\n    [[TransformationTags.BoonPointsEarned]],\r\n    \"newGamePlusBoonPointsEarned\",\r\n    t(\"World Difficulty level\"),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      getNewGamePlusBoonPointsEarnedMultiplier(getWorldDifficultyLevel(state)),\r\n  );\r\n}\r\n","import moment from \"moment\";\r\nimport React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet } from \"react-native\";\r\nimport { FlatList } from \"react-native-gesture-handler\";\r\nimport { List } from \"react-native-paper\";\r\nimport { EndingStats, StateContext } from \"../../backend/GameState\";\r\nimport { addUICommand } from \"../../backend/UICommands\";\r\nimport { Challenges } from \"../../backend/challenges/Challenges\";\r\nimport { Endings } from \"../../backend/ending/Endings\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\n\r\nfunction EndingHistoryRow(props: {\r\n  endingData: EndingStats;\r\n  onPress: () => void;\r\n}) {\r\n  const endingData = props.endingData;\r\n  const ending = Endings.getById(endingData.endingId);\r\n  const timestamp = moment(endingData.timestamp).format(\"Y-MM-DD h:mm A\");\r\n  const worldStats =\r\n    endingData.worldsCreated > 0\r\n      ? t(\r\n          \"{{sheerPower}}/{{storylineOracle}}/{{blazingSpeed}} - D{{worldDifficulty}}\",\r\n          {\r\n            sheerPower: formatNumber(endingData.sheerPowerLevel),\r\n            storylineOracle: formatNumber(endingData.storylineOracleLevel),\r\n            blazingSpeed: formatNumber(endingData.blazingSpeedLevel),\r\n            worldDifficulty: formatNumber(endingData.worldDifficultyLevel),\r\n          },\r\n        )\r\n      : \"\";\r\n  const challengeStats =\r\n    endingData.challengeId != null\r\n      ? Challenges.getById(endingData.challengeId).getName()\r\n      : \"\";\r\n  const extraStats =\r\n    worldStats != \"\" || challengeStats != \"\"\r\n      ? t(\" ({{extraStatsText}})\", {\r\n          extraStatsText: [worldStats, challengeStats]\r\n            .filter((text) => text != \"\")\r\n            .join(t(\"; \")),\r\n        })\r\n      : \"\";\r\n  const title = t(\"{{ending}}{{extraStats}}\", {\r\n    ending: ending.title,\r\n    extraStats,\r\n  });\r\n  const description = timestamp;\r\n  return (\r\n    <List.Item\r\n      title={title}\r\n      description={description}\r\n      onPress={props.onPress}\r\n      right={() => <List.Icon icon=\"chevron-right\" />}\r\n    />\r\n  );\r\n}\r\n\r\nexport default function EndingHistoryContainer(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const endings = state.global.endingsHistory ?? [];\r\n\r\n  const renderItem = useCallback(\r\n    (params: { item: EndingStats; index: number }) => (\r\n      <EndingHistoryRow\r\n        endingData={params.item}\r\n        onPress={() =>\r\n          stateRef.current.apply((s) => {\r\n            s = addUICommand(\r\n              s,\r\n              \"endingHistoryOverride:\" +\r\n                (endings.length - 1 - params.index).toString(),\r\n            );\r\n            s = addUICommand(s, \"goToEnding\");\r\n            return s;\r\n          })\r\n        }\r\n      />\r\n    ),\r\n    [],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (endings.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <FlatList data={endings?.toReversed?.() ?? []} renderItem={renderItem} />\r\n    );\r\n  }, [endings.length]);\r\n}\r\n\r\nconst styles = StyleSheet.create({});\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"diviningTheWorld\",\r\n  t(\"Divining the World\"),\r\n  310,\r\n  30,\r\n  t(\"Reach Mind Lv10\"),\r\n  t(\r\n    \"Permanently reveal hints for Storylines depending on your Mind element level and your progression through the game\",\r\n  ),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as DiviningTheWorld };\r\n","import {\r\n  Entypo,\r\n  MaterialCommunityIcons,\r\n  MaterialIcons,\r\n} from \"@expo/vector-icons\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { DiviningTheWorld } from \"../../backend/events/storyline/desert/DiviningTheWorldStoryline\";\r\nimport { SpellElement, getElementLevel } from \"../../backend/spells/Elements\";\r\nimport { Storyline } from \"../../backend/storylines/Storyline\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Markdown } from \"./Markdown\";\r\nimport { DescriptionViewer } from \"./Miscellaneous\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function StorylineContainer(props: {\r\n  storyline: Storyline;\r\n  collapsed?: boolean;\r\n  onPressExpand?: () => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const storyline = props.storyline;\r\n\r\n  const isCompleted = storyline.isCompleted(state);\r\n  const isBonusActive = storyline.isBonusActive(state);\r\n  const isHintRevealed = storyline.isHintRevealed(state);\r\n  const isHintUnlockable =\r\n    storyline.isHintUnlockable(state) && DiviningTheWorld.isBonusActive(state);\r\n\r\n  const isEnabled =\r\n    isCompleted || isBonusActive || isHintRevealed || isHintUnlockable;\r\n\r\n  const descriptionContainer = useMemo(() => {\r\n    let descriptionContents = t(\"???\");\r\n    if (isHintUnlockable) {\r\n      descriptionContents = t(\r\n        \"You may learn more about this Storyline if your Mind is Lv{{level}} or higher...\",\r\n        { level: storyline.mindRequirementForHint },\r\n      );\r\n    }\r\n    if (isHintRevealed) {\r\n      descriptionContents = t(\"Hint to unlock: *{{hint}}*\", {\r\n        hint: storyline.hintDescription(state),\r\n      });\r\n    }\r\n    if (isCompleted) {\r\n      descriptionContents = t(\r\n        \"You have completed this Storyline, but not all of its bonuses are active. Retire to obtain the rest!\",\r\n      );\r\n    }\r\n    if (isBonusActive) {\r\n      descriptionContents = storyline.getBonusDescription(state);\r\n    }\r\n    return (\r\n      <View style={styles.descriptionTextContainer}>\r\n        {isBonusActive ? (\r\n          <View style={styles.effectContainer}>\r\n            <Text>{t(\"Storyline completed!\")}</Text>\r\n            <Markdown>\r\n              {t(\"Bonus: **{{description}}**\", {\r\n                description: descriptionContents,\r\n              })}\r\n            </Markdown>\r\n          </View>\r\n        ) : (\r\n          <DescriptionViewer style={styles.descriptionViewer}>\r\n            {descriptionContents}\r\n          </DescriptionViewer>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [\r\n    storyline.getBonusDescription(state),\r\n    isCompleted,\r\n    isBonusActive,\r\n    getElementLevel(state, SpellElement.Mind),\r\n    isHintUnlockable,\r\n    isHintRevealed,\r\n    storyline.hintDescription(state),\r\n  ]);\r\n\r\n  const theme = useTheme();\r\n\r\n  const icon = useMemo(() => {\r\n    let icon = (\r\n      <MaterialIcons\r\n        accessibilityLabel=\"Locked\"\r\n        name=\"lock\"\r\n        size={20}\r\n        color={theme.colors.onSurfaceDisabled}\r\n      />\r\n    );\r\n    if (isHintUnlockable) {\r\n      icon = (\r\n        <MaterialCommunityIcons\r\n          accessibilityLabel=\"Discoverable\"\r\n          name=\"lock-open-variant\"\r\n          size={20}\r\n          color={theme.colors.onBackground}\r\n        />\r\n      );\r\n    }\r\n    if (isHintRevealed) {\r\n      icon = (\r\n        <MaterialIcons\r\n          accessibilityLabel=\"Discovered\"\r\n          name=\"more-horiz\"\r\n          size={20}\r\n          color={theme.colors.onBackground}\r\n        />\r\n      );\r\n    }\r\n    if (isCompleted) {\r\n      icon = (\r\n        <MaterialIcons\r\n          accessibilityLabel=\"Completed but Inactive\"\r\n          name=\"error-outline\"\r\n          size={21}\r\n          color={theme.colors.onBackground}\r\n        />\r\n      );\r\n    }\r\n    if (isBonusActive) {\r\n      icon = (\r\n        <MaterialIcons\r\n          accessibilityLabel=\"Completed\"\r\n          name=\"check\"\r\n          size={20}\r\n          color={theme.colors.onBackground}\r\n        />\r\n      );\r\n    }\r\n    return icon;\r\n  }, [isHintUnlockable, isHintRevealed, isCompleted, isBonusActive, theme]);\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View style={styles.storylineContainer} key={storyline.name}>\r\n        <TouchableWithoutFeedback\r\n          accessibilityRole=\"button\"\r\n          accessibilityHint=\"Expand\"\r\n          onPress={props.onPressExpand}\r\n        >\r\n          <View style={styles.topRowContainer}>\r\n            {icon}\r\n            <Text\r\n              h3\r\n              accessibilityRole=\"none\"\r\n              key={storyline.name}\r\n              onPress={props.onPressExpand}\r\n              style={[\r\n                styles.topContainer,\r\n                !isEnabled && styles.disabledStorylineText,\r\n              ]}\r\n            >\r\n              {isCompleted || isBonusActive\r\n                ? storyline.name\r\n                : isHintRevealed\r\n                ? t(\"{{storylineTeaser}}...\", {\r\n                    storylineTeaser: storyline.name.substring(0, 3),\r\n                  })\r\n                : t(\"???\")}\r\n            </Text>\r\n            <View style={styles.expandContainer}>\r\n              <Entypo\r\n                name={props.collapsed ? \"chevron-right\" : \"chevron-down\"}\r\n                size={24}\r\n                color={theme.colors.onBackground}\r\n              />\r\n            </View>\r\n          </View>\r\n        </TouchableWithoutFeedback>\r\n        {!props.collapsed && <View>{descriptionContainer}</View>}\r\n      </View>\r\n    );\r\n  }, [\r\n    storyline.name,\r\n    isEnabled,\r\n    isCompleted,\r\n    isBonusActive,\r\n    icon,\r\n    theme,\r\n    !props.collapsed && descriptionContainer,\r\n    props.collapsed,\r\n    props.onPressExpand,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  storylineContainer: { marginVertical: 8 },\r\n  topRowContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  expandContainer: {\r\n    width: 40,\r\n  },\r\n  descriptionTextContainer: {\r\n    marginBottom: 8,\r\n    marginTop: 8,\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  descriptionViewer: { flex: 1, justifyContent: \"center\" },\r\n  effectContainer: {\r\n    flex: 1,\r\n  },\r\n  effectSubcontainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"flex-start\",\r\n    flexWrap: \"wrap\",\r\n  },\r\n  smallButtonTitle: {\r\n    fontSize: 12,\r\n  },\r\n  topContainer: {\r\n    flex: 1,\r\n    marginLeft: 8,\r\n  },\r\n  disabledStorylineText: {\r\n    color: \"#aaa\",\r\n  },\r\n});\r\n","import React, { useCallback, useContext, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { StorylineStatus } from \"../../backend/storylines/Storyline\";\r\nimport { getSortedStorylines } from \"../../backend/storylines/Storylines\";\r\nimport Divider from \"./Divider\";\r\nimport { StorylineContainer } from \"./StorylineContainer\";\r\n\r\ntype StorylinesContainerProps = {\r\n  onlyStorylineStatus?: StorylineStatus;\r\n};\r\n\r\nexport default function StorylinesContainer(props: StorylinesContainerProps) {\r\n  const [expandedStoryline, setExpandedStoryline] = useState(\"\");\r\n  const state = useContext(StateContext);\r\n  const onlyStorylineStatus = props.onlyStorylineStatus;\r\n  const setStorylineCallback = useCallback(\r\n    (storylineName: string) => {\r\n      if (expandedStoryline == storylineName) {\r\n        setExpandedStoryline(\"\");\r\n      } else {\r\n        setExpandedStoryline(storylineName);\r\n      }\r\n    },\r\n    [expandedStoryline],\r\n  );\r\n\r\n  const storylines = getSortedStorylines().filter(\r\n    (storyline) =>\r\n      !storyline.isHidden(state) &&\r\n      (onlyStorylineStatus == null ||\r\n        onlyStorylineStatus == storyline.getStatus(state)),\r\n  );\r\n  const storylineNameString = storylines\r\n    .map((storyline) => storyline.name)\r\n    .join(\",\");\r\n\r\n  const storylineContainers = useMemo(\r\n    () =>\r\n      storylines.map((storyline) => {\r\n        return (\r\n          <StorylineContainer\r\n            key={storyline.name}\r\n            storyline={storyline}\r\n            collapsed={expandedStoryline != storyline.name}\r\n            onPressExpand={setStorylineCallback.bind(null, storyline.name)}\r\n          />\r\n        );\r\n      }),\r\n    [storylineNameString, expandedStoryline, setExpandedStoryline],\r\n  );\r\n\r\n  return useMemo(() => {\r\n    if (storylines.length === 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <View>\r\n        <View key={storylines[0].name}>{storylineContainers[0]}</View>\r\n        {storylineContainers.slice(1).map((storylineContainer, idx) => {\r\n          return (\r\n            <View key={storylines[idx].name}>\r\n              <Divider />\r\n              {storylineContainer}\r\n            </View>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  }, [storylineNameString, storylineContainers]);\r\n}\r\n\r\nconst styles = StyleSheet.create({});\r\n","import moment from \"moment\";\r\nimport React, { useContext, useMemo, useState } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { Card, List } from \"react-native-paper\";\r\nimport { clearAllCaches } from \"../backend/Caching\";\r\nimport { StateContext, createHypotheticalState } from \"../backend/GameState\";\r\nimport {\r\n  getBlazingSpeedLevel,\r\n  getNewGamePlusCount,\r\n  getSheerPowerLevel,\r\n  getStorylineOracleLevel,\r\n  getWorldDifficultyLevel,\r\n} from \"../backend/NewGamePlus\";\r\nimport { ActionArea } from \"../backend/action/ActionAreas\";\r\nimport { getCurrentChallenge } from \"../backend/challenges/Challenges\";\r\nimport { getCurrentCombatClass } from \"../backend/classes/CombatClasses\";\r\nimport {\r\n  getMarkdownTextForSpell,\r\n  getMarkdownTextForSpellEmpowerment,\r\n  getMarkdownTextForTransmutationSpell,\r\n} from \"../backend/events/progression/LevelUp\";\r\nimport { getVisibleTransmutationSpells } from \"../backend/items/transmute/TransmutationSpell\";\r\nimport {\r\n  SpellElement,\r\n  getElementExp,\r\n  getElementLevel,\r\n  getMaxElementLevel,\r\n  getMaxPrimaryElementLevel,\r\n  getPrimaryElements,\r\n  getRankForLevel,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedElements,\r\n  maximumElementLevelExpMultiplier,\r\n  maximumElementLevelProductionMultiplierDx,\r\n  translateElement,\r\n} from \"../backend/spells/Elements\";\r\nimport { Spell } from \"../backend/spells/Spell\";\r\nimport { getVisibleSpellsForElement } from \"../backend/spells/Spells\";\r\nimport {\r\n  STORYLINE_STATUS_ORDER,\r\n  StorylineStatus,\r\n  translateStorylineStatus,\r\n} from \"../backend/storylines/Storyline\";\r\nimport {\r\n  getSortedStorylines,\r\n  getTotalStorylineCount,\r\n} from \"../backend/storylines/Storylines\";\r\nimport { getResearcherExpPerSecForElements } from \"../backend/study/Study\";\r\nimport { fromEntries, keysOf } from \"../utils/CoreUtils\";\r\nimport { formatNumber, formatTimeLong } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { Card as UtilityCard } from \"./utility/Card\";\r\nimport EndingHistoryContainer from \"./utility/EndingHistoryContainer\";\r\nimport { GameStateFreezer } from \"./utility/GameStateFreezer\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Picker } from \"./utility/Picker\";\r\nimport StorylinesContainer from \"./utility/StorylinesContainer\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nfunction StatsSingleElement(props: { element: SpellElement }) {\r\n  const element = props.element;\r\n  const state = useContext(StateContext);\r\n  const allElementLevels = fromEntries(\r\n    getUnlockedElements(state).map((eachElement) => [\r\n      eachElement,\r\n      getElementLevel(state, eachElement),\r\n    ]),\r\n  );\r\n\r\n  const researchEstimate = getResearcherExpPerSecForElements(state);\r\n\r\n  const currentRank = getRankForLevel(allElementLevels[element]);\r\n  const newSpellsText = useMemo(() => {\r\n    const thisLevelSpells = getVisibleSpellsForElement(\r\n      state,\r\n      element,\r\n      ActionArea.SPELL_MENU,\r\n    );\r\n    const thisLevelCrafts = getVisibleTransmutationSpells(state);\r\n    const thisLevelEmpowerments = thisLevelSpells.filter((spell) =>\r\n      spell.isEmpoweringPossible(state),\r\n    );\r\n    const currentElementLevel = getElementLevel(state, element);\r\n    let nextUnlockLevelAdd = 0;\r\n    let foundNewSpellsOrItems = false;\r\n    let extraSpells: Spell[] = [];\r\n    let extraCrafts: Spell[] = [];\r\n    let extraEmpowerments: Spell[] = [];\r\n    let fakeState = createHypotheticalState(state);\r\n    while (\r\n      !foundNewSpellsOrItems &&\r\n      currentElementLevel + nextUnlockLevelAdd < getMaxElementLevel(state)\r\n    ) {\r\n      nextUnlockLevelAdd += 1;\r\n      fakeState.run.elementExperience[element] = getTotalExpRequiredForLevel(\r\n        fakeState,\r\n        getElementLevel(state, element) + nextUnlockLevelAdd,\r\n        element,\r\n      );\r\n      fakeState = clearAllCaches(fakeState);\r\n      const nextLevelSpells = getVisibleSpellsForElement(\r\n        fakeState,\r\n        element,\r\n        ActionArea.SPELL_MENU,\r\n      );\r\n      const nextLevelTransmutations = getVisibleTransmutationSpells(fakeState);\r\n      const nextLevelEmpowerments = nextLevelSpells.filter((spell) =>\r\n        spell.isEmpoweringPossible(fakeState),\r\n      );\r\n      extraSpells = nextLevelSpells.filter(\r\n        (spell) => !thisLevelSpells.includes(spell),\r\n      );\r\n      extraCrafts = nextLevelTransmutations.filter(\r\n        (item) => !thisLevelCrafts.includes(item),\r\n      );\r\n      extraEmpowerments = nextLevelEmpowerments.filter(\r\n        (spell) => !thisLevelEmpowerments.includes(spell),\r\n      );\r\n      if (\r\n        extraSpells.length > 0 ||\r\n        extraCrafts.length > 0 ||\r\n        extraEmpowerments.length > 0\r\n      ) {\r\n        foundNewSpellsOrItems = true;\r\n      }\r\n    }\r\n    const newSpells = extraSpells.map(getMarkdownTextForSpell);\r\n    const newTransmutations = extraCrafts.map(\r\n      getMarkdownTextForTransmutationSpell.bind(null, state),\r\n    );\r\n    const newEmpowerments = extraEmpowerments.map(\r\n      getMarkdownTextForSpellEmpowerment,\r\n    );\r\n    const newUnlocks = [...newSpells, ...newEmpowerments, ...newTransmutations];\r\n\r\n    return newUnlocks.length > 0\r\n      ? t(\r\n          `Your next unlock is at level {{level}}:\r\n      \r\n{{unlocks}}`,\r\n          {\r\n            level: nextUnlockLevelAdd + currentElementLevel,\r\n            unlocks: newUnlocks.join(t(\"\\n\")),\r\n          },\r\n        )\r\n      : t(\r\n          `If you only level up this element, you will not unlock anything new!`,\r\n        );\r\n  }, [JSON.stringify(allElementLevels)]);\r\n\r\n  const nextLevelRequiredExp =\r\n    getTotalExpRequiredForLevel(\r\n      state,\r\n      getElementLevel(state, element) + 1,\r\n      element,\r\n    ) - getElementExp(state, element);\r\n\r\n  return (\r\n    <View>\r\n      <View style={styles.row}>\r\n        <Text>{t(\"Rank:\")}</Text>\r\n        <Text style={styles.valueText}>{currentRank}</Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>{t(\"Level:\")}</Text>\r\n        <Text style={styles.valueText}>{getElementLevel(state, element)}</Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>{t(\"To Next Level:\")}</Text>\r\n        <Text style={styles.valueText}>\r\n          {formatNumber(nextLevelRequiredExp)}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text>{t(\"To Next Level (Time):\")}</Text>\r\n        <Text style={styles.valueText}>\r\n          {(researchEstimate?.[element] ?? 0) == 0 ||\r\n          nextLevelRequiredExp == Infinity\r\n            ? \"\"\r\n            : formatTimeLong(\r\n                moment.duration(\r\n                  (1000 * nextLevelRequiredExp) /\r\n                    (researchEstimate?.[element] ?? 0),\r\n                ),\r\n              )}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.row}>\r\n        <Text style={{ flex: 1 }}>\r\n          {t(\"Maximum Primary Level in previous runs (MPL):\")}\r\n        </Text>\r\n        <Text style={styles.valueText}>\r\n          {formatNumber(getMaxPrimaryElementLevel(state, element))}\r\n        </Text>\r\n      </View>\r\n      <View style={styles.insideBlock}>\r\n        <Markdown>{newSpellsText}</Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst StatsElementViewerElement = React.memo(\r\n  (props: { element: SpellElement }) => {\r\n    const state = useContext(StateContext);\r\n\r\n    const element = props.element;\r\n    const level = getElementLevel(state, element);\r\n    const title = t(\"{{element}} Lv{{level}}{{primary}} - {{rank}}\", {\r\n      element: translateElement(element),\r\n      level: formatNumber(level),\r\n      primary: getPrimaryElements(state).includes(element)\r\n        ? t(\" (Primary)\")\r\n        : \"\",\r\n      rank: getRankForLevel(level),\r\n    });\r\n\r\n    return useMemo(\r\n      () => (\r\n        <View key={element}>\r\n          <List.Accordion title={title}>\r\n            <View style={styles.elementElementContainer}>\r\n              <StatsSingleElement element={element} />\r\n            </View>\r\n          </List.Accordion>\r\n        </View>\r\n      ),\r\n      [title, element],\r\n    );\r\n  },\r\n);\r\n\r\nfunction StatsElementViewer() {\r\n  const state = useContext(StateContext);\r\n\r\n  const elements = getUnlockedElements(state);\r\n\r\n  const perElement = elements.map((element, index) => {\r\n    return <StatsElementViewerElement key={element} element={element} />;\r\n  });\r\n\r\n  return <View>{perElement}</View>;\r\n}\r\n\r\nfunction StorylineViewer() {\r\n  const state = useContext(StateContext);\r\n  const allStorylines = getSortedStorylines();\r\n  const completedStorylines = allStorylines.filter((storyline) =>\r\n    storyline.isCompleted(state),\r\n  );\r\n  const storylineCount = getTotalStorylineCount();\r\n\r\n  const storylineStatusMap: Partial<Record<StorylineStatus, number>> = {};\r\n  for (let storyline of allStorylines) {\r\n    const status = storyline.getStatus(state);\r\n    storylineStatusMap[status] = (storylineStatusMap[status] ?? 0) + 1;\r\n  }\r\n\r\n  const storylineStatusSet = new Set(keysOf(storylineStatusMap));\r\n\r\n  const [storylineStatus, setStorylineStatus] = useState<string>(\r\n    storylineStatusSet.has(StorylineStatus.HINT_REVEALED)\r\n      ? StorylineStatus.HINT_REVEALED\r\n      : storylineStatusSet.has(StorylineStatus.UNLOCKED)\r\n      ? StorylineStatus.UNLOCKED\r\n      : storylineStatusSet.has(StorylineStatus.COMPLETED)\r\n      ? StorylineStatus.COMPLETED\r\n      : StorylineStatus.BONUS_ACTIVE,\r\n  );\r\n\r\n  const storylineStatuses = Array.from(storylineStatusSet)\r\n    .sort((a, b) => {\r\n      const indexA = STORYLINE_STATUS_ORDER.findIndex((status) => status == a);\r\n      const indexB = STORYLINE_STATUS_ORDER.findIndex((status) => status == b);\r\n      return indexA - indexB;\r\n    })\r\n    .filter((status) => status != StorylineStatus.HIDDEN);\r\n\r\n  const statusPicker = useMemo(() => {\r\n    return (\r\n      <Picker\r\n        onValueChange={setStorylineStatus}\r\n        selectedValue={storylineStatus}\r\n        data={[...storylineStatuses].map((status: string) => ({\r\n          label: t(\"{{storylineStatus}} ({{amount}})\", {\r\n            storylineStatus: translateStorylineStatus(\r\n              status as StorylineStatus,\r\n            ),\r\n            amount: formatNumber(storylineStatusMap[status] ?? 0),\r\n          }),\r\n          value: status,\r\n          key: status,\r\n        }))}\r\n      />\r\n    );\r\n  }, [\r\n    setStorylineStatus,\r\n    storylineStatus,\r\n    JSON.stringify(storylineStatuses),\r\n    JSON.stringify(storylineStatusMap),\r\n  ]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={styles.row}>\r\n          <Text>{t(\"Total Completed Storylines:\")}</Text>\r\n          <Text style={styles.valueText}>\r\n            {t(\"{{completedStorylines}} / {{allStorylines}}\", {\r\n              completedStorylines: formatNumber(completedStorylines.length),\r\n              allStorylines: formatNumber(storylineCount),\r\n            })}\r\n          </Text>\r\n        </View>\r\n        <View style={styles.row}>\r\n          <Text>{t(\"Completion Percentage:\")}</Text>\r\n          <Text style={styles.valueText}>\r\n            {t(\"{{completedStorylinesPct}}%\", {\r\n              completedStorylinesPct: formatNumber(\r\n                completedStorylines.length > storylineCount\r\n                  ? 100 + (completedStorylines.length - storylineCount)\r\n                  : (100 * completedStorylines.length) / storylineCount,\r\n              ),\r\n            })}\r\n          </Text>\r\n        </View>\r\n        <View style={[Styles.mt16, Styles.flexRowAlignCenter]}>\r\n          <Text>{t(\"Filter Storylines:\")}</Text>\r\n          <View style={[Styles.ml8, { width: 180 }]}>{statusPicker}</View>\r\n        </View>\r\n        <View style={Styles.mt8}>\r\n          {STORYLINE_STATUS_ORDER.map((status) => (\r\n            <View\r\n              style={storylineStatus != status && { display: \"none\" }}\r\n              key={status}\r\n            >\r\n              <GameStateFreezer isVisible={storylineStatus == status}>\r\n                <StorylinesContainer onlyStorylineStatus={status} />\r\n              </GameStateFreezer>\r\n            </View>\r\n          ))}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      completedStorylines.length,\r\n      allStorylines.length,\r\n      statusPicker,\r\n      storylineStatus,\r\n    ],\r\n  );\r\n}\r\n\r\nfunction StatsOtherViewer() {\r\n  const state = useContext(StateContext);\r\n  const thisRunDuration = moment.duration(state.run.secondsPlayed, \"seconds\");\r\n  const thisWorldDuration = moment.duration(\r\n    state.world.secondsPlayed,\r\n    \"seconds\",\r\n  );\r\n  const totalDuration = moment.duration(state.global?.secondsPlayed, \"seconds\");\r\n  const thisRunActiveDuration = formatTimeLong(\r\n    moment.duration(state.run.activeSecondsPlayed, \"seconds\"),\r\n  );\r\n  const thisWorldActiveDuration = formatTimeLong(\r\n    moment.duration(state.world.activeSecondsPlayed, \"seconds\"),\r\n  );\r\n  const totalActiveDuration = formatTimeLong(\r\n    moment.duration(state.global.activeSecondsPlayed, \"seconds\"),\r\n  );\r\n  const thisRunTimePieces = state.run.timePiecesConsumed;\r\n  const thisWorldTimePieces = state.world.timePiecesConsumed;\r\n  const totalTimePieces = state.global.timePiecesConsumed;\r\n  const thisRunRealWorldDuration = moment.duration(\r\n    Date.now() - state.run.startTimestamp ?? 0,\r\n  );\r\n  const thisWorldRealWorldDuration = moment.duration(\r\n    Date.now() - state.world.startTimestamp ?? 0,\r\n  );\r\n  const totalRealWorldDuration = moment.duration(\r\n    Date.now() - state.global.startTimestamp ?? 0,\r\n  );\r\n\r\n  const newGamePlusCount = getNewGamePlusCount(state);\r\n  const sheerPowerLevel = getSheerPowerLevel(state);\r\n  const storylineOracleLevel = getStorylineOracleLevel(state);\r\n  const blazingSpeedLevel = getBlazingSpeedLevel(state);\r\n  const worldDifficultyLevel = getWorldDifficultyLevel(state);\r\n\r\n  const expMultiplier = maximumElementLevelExpMultiplier(state);\r\n  const productionMultiplier = maximumElementLevelProductionMultiplierDx(state);\r\n\r\n  const currentChallenge = getCurrentChallenge(state);\r\n\r\n  const primaryElement = getPrimaryElements(state)\r\n    .map((element) => translateElement(element))\r\n    .join(t(\", \"));\r\n\r\n  const primaryElementRow = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={2}>\r\n          {t(\"Primary element:\")}\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {primaryElement}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [primaryElement],\r\n  );\r\n\r\n  const inGameTimeTotalRow = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={2}>\r\n          {t(\"In-game time played (total):\")}\r\n        </Text>\r\n        <Text\r\n          style={[styles.valueText, styles.valueTextLong]}\r\n          numberOfLines={3}\r\n        >\r\n          {formatTimeLong(totalDuration)}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [formatTimeLong(totalDuration)],\r\n  );\r\n\r\n  const inGameTimeThisWorldRow = useMemo(\r\n    () =>\r\n      newGamePlusCount > 0 && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"In-game time played (this World):\")}\r\n          </Text>\r\n          <Text style={[styles.valueText, styles.valueTextLong]}>\r\n            {formatTimeLong(thisWorldDuration)}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [newGamePlusCount, formatTimeLong(thisWorldDuration)],\r\n  );\r\n\r\n  const inGameTimeThisRunRow = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={3}>\r\n          {t(\"In-game time played (this run):\")}\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {formatTimeLong(thisRunDuration)}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [formatTimeLong(thisRunDuration)],\r\n  );\r\n\r\n  const activeDurationTotalRow = useMemo(\r\n    () =>\r\n      totalActiveDuration != null && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Real world time played (total):\")}\r\n          </Text>\r\n          <Text style={[styles.valueText, styles.valueTextLong]}>\r\n            {totalActiveDuration}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [totalActiveDuration],\r\n  );\r\n\r\n  const activeDurationThisWorldRow = useMemo(\r\n    () =>\r\n      newGamePlusCount > 0 && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Real world time played (this World):\")}\r\n          </Text>\r\n          <Text style={[styles.valueText, styles.valueTextLong]}>\r\n            {thisWorldActiveDuration}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [newGamePlusCount, thisWorldActiveDuration],\r\n  );\r\n\r\n  const timePiecesThisRunRow = useMemo(\r\n    () =>\r\n      thisRunTimePieces > 0 && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Time Pieces consumed (this run):\")}\r\n          </Text>\r\n          <Text style={[styles.valueText, styles.valueTextLong]}>\r\n            {formatNumber(thisRunTimePieces)}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [thisRunTimePieces],\r\n  );\r\n\r\n  const timePiecesTotalRow = useMemo(\r\n    () =>\r\n      totalTimePieces > 0 && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Time Pieces consumed (total):\")}\r\n          </Text>\r\n          <Text style={[styles.valueText, styles.valueTextLong]}>\r\n            {formatNumber(totalTimePieces)}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [totalTimePieces],\r\n  );\r\n\r\n  const timePiecesThisWorldRow = useMemo(\r\n    () =>\r\n      newGamePlusCount > 0 &&\r\n      thisWorldTimePieces > 0 && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Time Pieces consumed (this World):\")}\r\n          </Text>\r\n          <Text style={[styles.valueText, styles.valueTextLong]}>\r\n            {formatNumber(thisWorldTimePieces)}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [newGamePlusCount, thisWorldTimePieces],\r\n  );\r\n\r\n  const activeDurationThisRunRow = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={3}>\r\n          {t(\"Real world time played (this run):\")}\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {thisRunActiveDuration}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [thisRunActiveDuration],\r\n  );\r\n\r\n  const realWorldDurationTotalRow = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={3}>\r\n          {t(\"Real world time since starting the game:\")}\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {formatTimeLong(totalRealWorldDuration)}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [formatTimeLong(totalRealWorldDuration)],\r\n  );\r\n\r\n  const realWorldDurationThisWorldRow = useMemo(\r\n    () =>\r\n      newGamePlusCount > 0 && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Real world time since starting this World:\")}\r\n          </Text>\r\n          <Text style={[styles.valueText, styles.valueTextLong]}>\r\n            {formatTimeLong(thisWorldRealWorldDuration)}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [newGamePlusCount, formatTimeLong(thisWorldRealWorldDuration)],\r\n  );\r\n\r\n  const realWorldDurationThisRunRow = useMemo(\r\n    () => (\r\n      <View style={styles.row}>\r\n        <Text style={styles.captionText} numberOfLines={3}>\r\n          {t(\"Real world time since starting this run:\")}\r\n        </Text>\r\n        <Text style={[styles.valueText, styles.valueTextLong]}>\r\n          {formatTimeLong(thisRunRealWorldDuration)}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [formatTimeLong(thisRunRealWorldDuration)],\r\n  );\r\n\r\n  const combatClassRow = useMemo(\r\n    () =>\r\n      getCurrentCombatClass(state) != null && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Class:\")}\r\n          </Text>\r\n          <Text style={styles.valueText}>\r\n            {getCurrentCombatClass(state).getDisplayName()}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [getCurrentCombatClass(state)],\r\n  );\r\n\r\n  const challengeRow = useMemo(\r\n    () =>\r\n      getCurrentChallenge(state) != null && (\r\n        <View style={styles.row}>\r\n          <Text style={styles.captionText} numberOfLines={3}>\r\n            {t(\"Challenge:\")}\r\n          </Text>\r\n          <Text style={[styles.valueText]}>\r\n            {getCurrentChallenge(state).getName()}\r\n          </Text>\r\n        </View>\r\n      ),\r\n    [getCurrentChallenge(state)],\r\n  );\r\n\r\n  const newGamePlusRows = useMemo(\r\n    () =>\r\n      newGamePlusCount > 0 && (\r\n        <>\r\n          <View style={styles.row}>\r\n            <Text style={styles.captionText} numberOfLines={2}>\r\n              {t(\"Other Worlds visited:\")}\r\n            </Text>\r\n            <Text style={[styles.valueText, styles.valueTextLong]}>\r\n              {formatNumber(newGamePlusCount)}\r\n            </Text>\r\n          </View>\r\n          <View style={styles.row}>\r\n            <Text style={styles.captionText} numberOfLines={2}>\r\n              {t(\"World modifiers:\")}\r\n            </Text>\r\n            <Text style={[styles.valueText, styles.valueTextLong]}>\r\n              {t(\r\n                \"{{sheerPower}}/{{storylineOracle}}/{{blazingSpeed}} - D{{worldDifficulty}}\",\r\n                {\r\n                  sheerPower: formatNumber(sheerPowerLevel),\r\n                  storylineOracle: formatNumber(storylineOracleLevel),\r\n                  blazingSpeed: formatNumber(blazingSpeedLevel),\r\n                  worldDifficulty: formatNumber(worldDifficultyLevel),\r\n                },\r\n              )}\r\n            </Text>\r\n          </View>\r\n        </>\r\n      ),\r\n    [\r\n      newGamePlusCount,\r\n      sheerPowerLevel,\r\n      storylineOracleLevel,\r\n      blazingSpeedLevel,\r\n      worldDifficultyLevel,\r\n    ],\r\n  );\r\n\r\n  const retirementRows = useMemo(\r\n    () => (\r\n      <>\r\n        <View style={styles.row}>\r\n          <Text>{t(\"Total times retired:\")}</Text>\r\n          <Text style={styles.valueText}>{state.world.totalTimesResetted}</Text>\r\n        </View>\r\n        <View style={styles.row}>\r\n          <Text>{t(\"Global experience multiplier:\")}</Text>\r\n          <Text style={styles.valueText}>\r\n            {formatNumber(expMultiplier, { showDecimals: true })}x\r\n          </Text>\r\n        </View>\r\n        <View style={styles.row}>\r\n          <Text>{t(\"Global production multiplier:\")}</Text>\r\n          <Text style={styles.valueText}>\r\n            {formatNumber(productionMultiplier, { showDecimals: true })}x\r\n          </Text>\r\n        </View>\r\n      </>\r\n    ),\r\n    [state.world.totalTimesResetted, expMultiplier, productionMultiplier],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View>\r\n        {challengeRow}\r\n        {primaryElementRow}\r\n        {combatClassRow}\r\n        {inGameTimeTotalRow}\r\n        {inGameTimeThisWorldRow}\r\n        {inGameTimeThisRunRow}\r\n        {activeDurationTotalRow}\r\n        {activeDurationThisWorldRow}\r\n        {activeDurationThisRunRow}\r\n        {timePiecesThisRunRow}\r\n        {timePiecesThisWorldRow}\r\n        {timePiecesTotalRow}\r\n        {realWorldDurationTotalRow}\r\n        {realWorldDurationThisWorldRow}\r\n        {realWorldDurationThisRunRow}\r\n        {newGamePlusRows}\r\n        {retirementRows}\r\n      </View>\r\n    ),\r\n    [\r\n      challengeRow,\r\n      primaryElementRow,\r\n      combatClassRow,\r\n      inGameTimeTotalRow,\r\n      inGameTimeThisWorldRow,\r\n      inGameTimeThisRunRow,\r\n      activeDurationTotalRow,\r\n      activeDurationThisWorldRow,\r\n      activeDurationThisRunRow,\r\n      timePiecesTotalRow,\r\n      timePiecesThisWorldRow,\r\n      timePiecesThisRunRow,\r\n      realWorldDurationTotalRow,\r\n      realWorldDurationThisWorldRow,\r\n      realWorldDurationThisRunRow,\r\n      newGamePlusRows,\r\n      retirementRows,\r\n    ],\r\n  );\r\n}\r\n\r\nexport default function Stats() {\r\n  const state = useContext(StateContext);\r\n  const showEndings = state.global.endingsHistory.length > 0;\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.container}>\r\n        <UtilityCard>\r\n          <Card.Title title={t(\"Stats\")} accessibilityRole=\"header\" />\r\n          <Card.Content>\r\n            <StatsOtherViewer />\r\n          </Card.Content>\r\n        </UtilityCard>\r\n        <UtilityCard style={Styles.mt16}>\r\n          <Card.Title title={t(\"Elements\")} accessibilityRole=\"header\" />\r\n          <Card.Content>\r\n            <StatsElementViewer />\r\n          </Card.Content>\r\n        </UtilityCard>\r\n        <UtilityCard style={Styles.mt16}>\r\n          <Card.Title title={t(\"Storylines\")} accessibilityRole=\"header\" />\r\n          <Card.Content>\r\n            <StorylineViewer />\r\n          </Card.Content>\r\n        </UtilityCard>\r\n        {showEndings && (\r\n          <UtilityCard style={Styles.mt16}>\r\n            <Card.Title\r\n              title={t(\"Ending History\")}\r\n              accessibilityRole=\"header\"\r\n            />\r\n            <Card.Content>\r\n              <EndingHistoryContainer />\r\n            </Card.Content>\r\n          </UtilityCard>\r\n        )}\r\n        {/* {hasSecrets && (\r\n          <Card>\r\n            <RNECard.Title accessibilityRole=\"header\">Secrets</RNECard.Title>\r\n            <SecretsContainer secretType={SecretType.Basic} />\r\n          </Card>\r\n        )} */}\r\n      </View>\r\n    ),\r\n    [showEndings],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  elementElementContainer: {\r\n    margin: 8,\r\n    marginBottom: 24,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    marginBottom: 4,\r\n  },\r\n  insideBlock: {\r\n    marginTop: 16,\r\n  },\r\n  valueText: {\r\n    minWidth: 60,\r\n    textAlign: \"right\",\r\n    marginLeft: 8,\r\n  },\r\n  valueTextLong: {\r\n    minWidth: 112,\r\n  },\r\n  captionText: {\r\n    flex: 1,\r\n  },\r\n});\r\n","import { Entypo } from \"@expo/vector-icons\";\r\nimport color from \"color\";\r\nimport moment from \"moment\";\r\nimport React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { StyleSheet, TouchableWithoutFeedback, View } from \"react-native\";\r\nimport { Card, useTheme } from \"react-native-paper\";\r\nimport { clearAllCaches } from \"../backend/Caching\";\r\nimport {\r\n  ResearcherAutoAssignStrategy,\r\n  StateContext,\r\n  createHypotheticalState,\r\n} from \"../backend/GameState\";\r\nimport { ActionArea } from \"../backend/action/ActionAreas\";\r\nimport {\r\n  TransmutationSpell,\r\n  getVisibleTransmutationSpells,\r\n} from \"../backend/items/transmute/TransmutationSpell\";\r\nimport { Ritual } from \"../backend/rituals/Ritual\";\r\nimport { getVisibleRituals } from \"../backend/rituals/Rituals\";\r\nimport {\r\n  SpellElement,\r\n  getElementExp,\r\n  getElementLevel,\r\n  getMaxElementLevel,\r\n  getPrimaryElements,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedElements,\r\n  translateElement,\r\n} from \"../backend/spells/Elements\";\r\nimport { Spell } from \"../backend/spells/Spell\";\r\nimport { getVisibleSpellsForElement } from \"../backend/spells/Spells\";\r\nimport { translateResearcherAutoAssignStrategy } from \"../backend/study/ResearcherAutoAssignStrategy\";\r\nimport {\r\n  allocateResearchersToElement,\r\n  explainBaseResearchRate,\r\n  getBaseResearchRate,\r\n  getFreeResearchers,\r\n  getResearcherExpPerSecForElements,\r\n  getTotalResearchers,\r\n} from \"../backend/study/Study\";\r\nimport { keysOf, valuesOfCached } from \"../utils/CoreUtils\";\r\nimport { formatNumber, formatTimeLong } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport ActionsContainer from \"./utility/ActionsContainer\";\r\nimport { Card as UtilityCard } from \"./utility/Card\";\r\nimport { CheckBox } from \"./utility/CheckBox\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Picker } from \"./utility/Picker\";\r\nimport { PlusMinusAllocator } from \"./utility/PlusMinusAllocator\";\r\nimport { useExpandedUIFromContext } from \"./utility/StatePersistedExpandedUI\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"./utility/UIContext\";\r\nimport Tooltip from \"./utility/tooltip/PaperTooltip\";\r\n\r\nfunction StudyRowDetails(props: { element: SpellElement }) {\r\n  const element = props.element;\r\n  const state = useContext(StateContext);\r\n\r\n  const allElementLevels = getUnlockedElements(state).map((eachElement) =>\r\n    getElementLevel(state, eachElement),\r\n  );\r\n\r\n  const researchEstimate = getResearcherExpPerSecForElements(state);\r\n\r\n  const newSpellsText = useMemo(() => {\r\n    // Avoid weird caching issues...\r\n    state.temp.spellRequirementsCache = {};\r\n    const thisLevelSpells = getVisibleSpellsForElement(\r\n      state,\r\n      element,\r\n      ActionArea.SPELL_MENU,\r\n    );\r\n    const thisLevelCrafts = getVisibleTransmutationSpells(state);\r\n    const thisLevelEmpowerments = thisLevelSpells.filter((spell) =>\r\n      spell.isEmpoweringPossible(state),\r\n    );\r\n    const thisLevelRituals = getVisibleRituals(state);\r\n    const currentElementLevel = getElementLevel(state, element);\r\n    let nextUnlockLevelAdd = 0;\r\n    let foundNewSpellsOrItems = false;\r\n    let extraSpells: Spell[] = [];\r\n    let extraCrafts: Spell[] = [];\r\n    let extraEmpowerments: Spell[] = [];\r\n    let extraRituals: Ritual[] = [];\r\n    let fakeState = createHypotheticalState(state);\r\n    while (\r\n      !foundNewSpellsOrItems &&\r\n      currentElementLevel + nextUnlockLevelAdd < getMaxElementLevel(state)\r\n    ) {\r\n      nextUnlockLevelAdd += 1;\r\n      fakeState.run.elementExperience[element] = getTotalExpRequiredForLevel(\r\n        fakeState,\r\n        getElementLevel(state, element) + nextUnlockLevelAdd,\r\n        element,\r\n      );\r\n      fakeState = clearAllCaches(fakeState);\r\n      const nextLevelSpells = getVisibleSpellsForElement(\r\n        fakeState,\r\n        element,\r\n        ActionArea.SPELL_MENU,\r\n      );\r\n      const nextLevelTransmutations = getVisibleTransmutationSpells(fakeState);\r\n      const nextLevelEmpowerments = nextLevelSpells.filter((spell) =>\r\n        spell.isEmpoweringPossible(fakeState),\r\n      );\r\n      const nextLevelRituals = getVisibleRituals(fakeState);\r\n      extraSpells = nextLevelSpells.filter(\r\n        (spell) => !thisLevelSpells.includes(spell),\r\n      );\r\n      extraCrafts = nextLevelTransmutations.filter(\r\n        (item) => !thisLevelCrafts.includes(item),\r\n      );\r\n      extraEmpowerments = nextLevelEmpowerments.filter(\r\n        (spell) => !thisLevelEmpowerments.includes(spell),\r\n      );\r\n      extraRituals = nextLevelRituals.filter(\r\n        (ritual) => !thisLevelRituals.includes(ritual),\r\n      );\r\n      if (\r\n        extraSpells.length > 0 ||\r\n        extraCrafts.length > 0 ||\r\n        extraEmpowerments.length > 0 ||\r\n        extraRituals.length > 0\r\n      ) {\r\n        foundNewSpellsOrItems = true;\r\n      }\r\n    }\r\n    const newSpells = extraSpells.map(\r\n      (spell) => `*${spell.getBasicDisplayName(state)}*`,\r\n    );\r\n    const newTransmutations = extraCrafts.map((spell: TransmutationSpell) =>\r\n      t(\"{{itemIcon}} *{{itemName}}*\", {\r\n        itemIcon: `:${spell.getItem().getId()}:`,\r\n        itemName: spell.getItem().getName(spell.getItem().getDefaultParams()),\r\n      }),\r\n    );\r\n    const newEmpowerments = extraEmpowerments.map(\r\n      (spell) => `*${spell.getBasicDisplayName(state)}+*`,\r\n    );\r\n    const newRituals = extraRituals.map(\r\n      (ritual) => `*${ritual.getBaseName()}*`,\r\n    );\r\n\r\n    const newUnlocks = [\r\n      ...newSpells,\r\n      ...newEmpowerments,\r\n      ...newTransmutations,\r\n      ...newRituals,\r\n    ];\r\n\r\n    return newUnlocks.length > 0\r\n      ? t(`Your next unlock is at level {{level}}: {{unlocks}}`, {\r\n          level: nextUnlockLevelAdd + currentElementLevel,\r\n          unlocks: newUnlocks.join(t(\", \")),\r\n        })\r\n      : t(\r\n          `If you only level up this element, you will not unlock anything new!`,\r\n        );\r\n  }, [JSON.stringify(allElementLevels)]);\r\n\r\n  const nextLevelRequiredExp =\r\n    getTotalExpRequiredForLevel(\r\n      state,\r\n      getElementLevel(state, element) + 1,\r\n      element,\r\n    ) - getElementExp(state, element);\r\n\r\n  return (\r\n    <View style={Styles.p8}>\r\n      <View>\r\n        <Text>\r\n          {t(\"To Next Level: {{exp}} Exp ({{time}})\", {\r\n            exp: formatNumber(nextLevelRequiredExp),\r\n            time:\r\n              (researchEstimate?.[element] ?? 0) == 0 ||\r\n              nextLevelRequiredExp == Infinity\r\n                ? \"\"\r\n                : formatTimeLong(\r\n                    moment.duration(\r\n                      (1000 * nextLevelRequiredExp) /\r\n                        (researchEstimate?.[element] ?? 0),\r\n                    ),\r\n                  ),\r\n          })}\r\n        </Text>\r\n      </View>\r\n      <View style={Styles.mt4}>\r\n        <Markdown>{newSpellsText}</Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction StudyRow(props: {\r\n  element: SpellElement;\r\n  applyAll: boolean;\r\n  isOdd: boolean;\r\n}) {\r\n  const element = props.element;\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const [expanded, setExpanded] = useExpandedUIFromContext(\r\n    state,\r\n    \"study:\" + element,\r\n    false,\r\n  );\r\n  const toggleExpanded = useCallback(() => setExpanded(!expanded), [expanded]);\r\n  const freeResearchers = getFreeResearchers(state);\r\n  const hasFreeResearchers = freeResearchers > 0;\r\n\r\n  const current = state.run.studyAllocation?.[element] || 0;\r\n  const onPressMinus = useCallback(\r\n    () =>\r\n      stateRef.current.apply(\r\n        allocateResearchersToElement(element, props.applyAll ? -Infinity : -1),\r\n      ),\r\n    [element, props.applyAll],\r\n  );\r\n  const onPressPlus = useCallback(\r\n    () =>\r\n      stateRef.current.apply(\r\n        allocateResearchersToElement(element, props.applyAll ? Infinity : 1),\r\n      ),\r\n    [element, props.applyAll],\r\n  );\r\n  const elementLevel = getElementLevel(state, element);\r\n\r\n  const theme = useTheme();\r\n\r\n  const elementText = useMemo(\r\n    () => (\r\n      <Text numberOfLines={3}>\r\n        {t(\"{{element}}{{elementPrimaryText}}: Lv{{level}}\", {\r\n          element: translateElement(element),\r\n          elementPrimaryText: getPrimaryElements(state).includes(element)\r\n            ? t(\" (Primary)\")\r\n            : \"\",\r\n          level: formatNumber(elementLevel),\r\n        })}\r\n      </Text>\r\n    ),\r\n    [element, getPrimaryElements(state).join(), elementLevel],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        key={element}\r\n        style={[\r\n          styles.singleElementContainer,\r\n          props.isOdd && {\r\n            backgroundColor: color(theme.colors.primary).alpha(0.1),\r\n          },\r\n        ]}\r\n      >\r\n        <View style={styles.row}>\r\n          <View style={styles.elementTextContainer}>{elementText}</View>\r\n          <View style={[styles.row, styles.rightHandSide]}>\r\n            <Text>{formatNumber(current)}</Text>\r\n            <View style={styles.plusMinusAllocatorContainer}>\r\n              <PlusMinusAllocator\r\n                disableMinus={current === 0}\r\n                disablePlus={!hasFreeResearchers}\r\n                onPressMinus={onPressMinus}\r\n                onPressPlus={onPressPlus}\r\n              />\r\n            </View>\r\n            <TouchableWithoutFeedback\r\n              onPress={toggleExpanded}\r\n              accessibilityRole=\"header\"\r\n              accessibilityLabel={expanded ? t(\"Collapse\") : t(\"Expand\")}\r\n            >\r\n              <View style={styles.expansionContainer}>\r\n                <Entypo\r\n                  name={expanded ? \"chevron-down\" : \"chevron-right\"}\r\n                  size={24}\r\n                  color={theme.colors.onBackground}\r\n                />\r\n              </View>\r\n            </TouchableWithoutFeedback>\r\n          </View>\r\n        </View>\r\n        {expanded && (\r\n          <View>\r\n            <StudyRowDetails element={element} />\r\n          </View>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      elementText,\r\n      current,\r\n      hasFreeResearchers,\r\n      onPressMinus,\r\n      onPressPlus,\r\n      theme,\r\n      props.isOdd,\r\n      expanded,\r\n      toggleExpanded,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function Study() {\r\n  const state = useContext(StateContext);\r\n  const uiContext = useContext(UIContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const freeResearchers = getFreeResearchers(state);\r\n  const totalResearchers = getTotalResearchers(state);\r\n\r\n  const [applyAll, setApplyAll] = useUIStateFromContext(\r\n    uiContext,\r\n    \"research_applyall\",\r\n    false,\r\n  );\r\n\r\n  const toggleApplyAll = useCallback(() => {\r\n    setApplyAll(!applyAll);\r\n  }, [applyAll, setApplyAll]);\r\n\r\n  const autoAssign = state.options.researcherAutoAssignStrategy;\r\n  const setAutoAssign = useCallback((value: ResearcherAutoAssignStrategy) => {\r\n    stateRef.current.apply((s) => {\r\n      s.options.researcherAutoAssignStrategy = value;\r\n      return s;\r\n    });\r\n  }, []);\r\n\r\n  const autoAssignPicker = useMemo(() => {\r\n    const items = valuesOfCached(ResearcherAutoAssignStrategy).map((value) => ({\r\n      key: value,\r\n      value,\r\n      label: translateResearcherAutoAssignStrategy(value),\r\n    }));\r\n    return (\r\n      <Picker\r\n        onValueChange={setAutoAssign}\r\n        selectedValue={autoAssign}\r\n        disablePlaceholder={true}\r\n        data={items}\r\n        style={{ maxWidth: 120 }}\r\n        maxLength={16}\r\n      />\r\n    );\r\n  }, [autoAssign, setAutoAssign]);\r\n\r\n  const rateExplanation = explainBaseResearchRate(state);\r\n  const expRateContents = t(\"{{exp}} / sec\", {\r\n    exp: formatNumber(getBaseResearchRate(state), {\r\n      showDecimals: true,\r\n    }),\r\n  });\r\n\r\n  const bottomSection = useMemo(\r\n    () => (\r\n      <View>\r\n        <View style={styles.assignAllContainer}>\r\n          <CheckBox\r\n            title={t(\"Assign / unassign all at once\")}\r\n            checked={applyAll}\r\n            onPress={toggleApplyAll}\r\n          />\r\n        </View>\r\n        <View style={[Styles.mt4, Styles.ph16, Styles.flexRowSpaceBetween]}>\r\n          <Text>{t(\"Auto-assign researchers: \")}</Text>\r\n          <View style={Styles.ml16}>{autoAssignPicker}</View>\r\n        </View>\r\n        <View style={[styles.row, styles.researcherCapacityContainer]}>\r\n          <Text>{t(\"Researchers available: \")}</Text>\r\n          <Text>\r\n            {t(\"{{free}}/{{total}}\", {\r\n              free: formatNumber(freeResearchers),\r\n              total: formatNumber(totalResearchers),\r\n            })}\r\n          </Text>\r\n        </View>\r\n        <View style={[styles.row, styles.researcherCapacityContainer]}>\r\n          <Text>{t(\"Exp per researcher: \")}</Text>\r\n          {rateExplanation != null ? (\r\n            <Tooltip title={rateExplanation}>\r\n              <Text style={Styles.underlined}>{expRateContents}</Text>\r\n            </Tooltip>\r\n          ) : (\r\n            <Text>{expRateContents}</Text>\r\n          )}\r\n        </View>\r\n        <View>\r\n          <ActionsContainer area={ActionArea.STUDY} />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      expRateContents,\r\n      rateExplanation,\r\n      totalResearchers,\r\n      freeResearchers,\r\n      applyAll,\r\n      toggleApplyAll,\r\n      autoAssignPicker,\r\n    ],\r\n  );\r\n\r\n  const elements = getUnlockedElements(state);\r\n\r\n  const disableAllMinus = freeResearchers === totalResearchers;\r\n  const disableAllPlus = freeResearchers <= 0;\r\n  const onPressMinusAll = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      for (let element of keysOf(state.run.studyAllocation)) {\r\n        allocateResearchersToElement(element, applyAll ? -Infinity : -1)(state);\r\n      }\r\n      return state;\r\n    });\r\n  }, [applyAll]);\r\n  const onPressPlusAll = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      do {\r\n        for (let element of getUnlockedElements(state)) {\r\n          allocateResearchersToElement(element, 1)(state);\r\n        }\r\n      } while (applyAll && getFreeResearchers(state) > 0);\r\n      return state;\r\n    });\r\n  }, [applyAll]);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(() => {\r\n    return (\r\n      <View>\r\n        <UtilityCard>\r\n          <Card.Title title={t(\"Elements\")} accessibilityRole=\"header\" />\r\n          <View style={[Styles.ph8, Styles.pb8]}>\r\n            {elements.map((element, index) => {\r\n              return (\r\n                <StudyRow\r\n                  key={element}\r\n                  element={element}\r\n                  applyAll={applyAll}\r\n                  isOdd={index % 2 != 0}\r\n                />\r\n              );\r\n            })}\r\n            <View\r\n              key=\"All\"\r\n              style={[\r\n                styles.row,\r\n                styles.singleElementContainer,\r\n                elements.length % 2 != 0 && {\r\n                  backgroundColor: color(theme.colors.primary).alpha(0.1),\r\n                },\r\n              ]}\r\n            >\r\n              <View style={styles.elementTextContainer}>\r\n                <Text numberOfLines={3}>{t(\"Assign to every Element\")}</Text>\r\n              </View>\r\n              <View style={[styles.row, styles.rightHandSide]}>\r\n                <View style={styles.plusMinusAllocatorContainer}>\r\n                  <PlusMinusAllocator\r\n                    disableMinus={disableAllMinus}\r\n                    disablePlus={disableAllPlus}\r\n                    onPressMinus={onPressMinusAll}\r\n                    onPressPlus={onPressPlusAll}\r\n                  />\r\n                </View>\r\n              </View>\r\n              <View style={styles.expansionPlaceholder} />\r\n            </View>\r\n          </View>\r\n        </UtilityCard>\r\n        {bottomSection}\r\n      </View>\r\n    );\r\n  }, [\r\n    elements.length,\r\n    bottomSection,\r\n    applyAll,\r\n    disableAllMinus,\r\n    disableAllPlus,\r\n    onPressMinusAll,\r\n    onPressPlusAll,\r\n    theme,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  plusMinusAllocatorContainer: {\r\n    marginLeft: 16,\r\n  },\r\n  assignAllContainer: {\r\n    marginTop: 8,\r\n    paddingHorizontal: 16,\r\n  },\r\n  researcherCapacityContainer: {\r\n    marginTop: 4,\r\n    paddingHorizontal: 16,\r\n  },\r\n  singleElementContainer: {\r\n    padding: 4,\r\n  },\r\n  checkboxContainer: {\r\n    marginLeft: 0,\r\n    marginTop: 8,\r\n    padding: 0,\r\n  },\r\n  checkboxText: {\r\n    fontWeight: \"normal\",\r\n  },\r\n  rightHandSide: {\r\n    marginLeft: 16,\r\n  },\r\n  elementTextContainer: {\r\n    flex: 1,\r\n  },\r\n  valueText: {\r\n    minWidth: 60,\r\n    textAlign: \"right\",\r\n    marginLeft: 8,\r\n  },\r\n  expansionContainer: {\r\n    // @ts-ignore \"pointer\" is allowed here\r\n    cursor: \"pointer\",\r\n  },\r\n  expansionPlaceholder: {\r\n    width: 24,\r\n  },\r\n});\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { StyleSheet, TouchableOpacity, View } from \"react-native\";\r\nimport { ScrollView } from \"react-native-gesture-handler\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { Flag } from \"../backend/Flag\";\r\nimport { hasWorldFlag } from \"../backend/Flags\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport {\r\n  SpellElement,\r\n  getFullyUnlockedElements,\r\n  translateElement,\r\n} from \"../backend/spells/Elements\";\r\nimport {\r\n  SYNCHRO_COLS,\r\n  SYNCHRO_ROWS,\r\n  calculateMaxOccurrencesInSynchroGrid,\r\n  getCurrentSynchroStrategy,\r\n  getSortedSynchroBonuses,\r\n  getSynchroPosition,\r\n  getTotalOccurrencesInSynchroGrid,\r\n  hasNegativeSynchroBonusOnTile,\r\n  setCurrentSynchroPosition,\r\n} from \"../backend/synchro/Synchro\";\r\nimport { SynchroBonus } from \"../backend/synchro/SynchroBonus\";\r\nimport { valuesOfCached } from \"../utils/CoreUtils\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { SynchroGridSelectors } from \"./synchro/SynchroGridSelectors\";\r\nimport Divider from \"./utility/Divider\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { GameIcon } from \"./utility/icons/GameIcon\";\r\n\r\nfunction SynchroBonusRow(props: { bonus: SynchroBonus; amount: number }) {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n\r\n  const visible = props.bonus.isVisible(state);\r\n  const effect = props.bonus.getEffect(\r\n    state,\r\n    props.amount < 1 ? 1 : props.amount,\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          Styles.flexRowAlignCenter,\r\n          props.amount == 0 && { opacity: 0.5 },\r\n        ]}\r\n      >\r\n        <GameIcon\r\n          icon={props.bonus.getElement1().toLowerCase()}\r\n          style={Styles.mr4}\r\n        />\r\n        <GameIcon\r\n          icon={props.bonus.getElement2().toLowerCase()}\r\n          style={Styles.mr4}\r\n        />\r\n        <View style={Styles.ml4}>\r\n          <Text style={{ fontWeight: \"bold\" }}>\r\n            {t(\"x{{amount}}\", { amount: formatNumber(props.amount) })}\r\n          </Text>\r\n        </View>\r\n        <View style={[Styles.ml16, Styles.flex]}>\r\n          <Markdown\r\n            style={\r\n              !props.bonus.isBeneficial() &&\r\n              props.amount > 0 && { color: theme.colors.error }\r\n            }\r\n          >\r\n            {visible ? effect : t(\"???\")}\r\n          </Markdown>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [visible, effect, props.amount],\r\n  );\r\n}\r\n\r\nfunction SynchroBottomComponent(props) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const activeBonuses = getSortedSynchroBonuses(state);\r\n\r\n  const topPart = useMemo(\r\n    () => (\r\n      <View>\r\n        <Divider />\r\n        <View style={Styles.mv8}>\r\n          <Text h3>{t(\"Bonuses\")}</Text>\r\n        </View>\r\n        {activeBonuses.length == 0 && (\r\n          <Text style={{ fontStyle: \"italic\" }}>{t(\"No bonuses yet!\")}</Text>\r\n        )}\r\n      </View>\r\n    ),\r\n    [activeBonuses.length],\r\n  );\r\n\r\n  return (\r\n    <View style={Styles.flex}>\r\n      {topPart}\r\n      <ScrollView style={Styles.flex}>\r\n        {activeBonuses.map(({ bonus, amount }) => (\r\n          <View key={bonus.getId()} style={Styles.pv4}>\r\n            <SynchroBonusRow bonus={bonus} amount={amount} />\r\n          </View>\r\n        ))}\r\n      </ScrollView>\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction SynchroGridItem(props: {\r\n  x: number;\r\n  y: number;\r\n  selected: boolean;\r\n  error: boolean;\r\n  onPress?: () => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n\r\n  const element = getSynchroPosition(state, props.x, props.y);\r\n\r\n  const translationArgs = {\r\n    x: formatNumber(props.x + 1),\r\n    y: formatNumber(props.y + 1),\r\n    element: element != null ? translateElement(element) : t(\"Empty\"),\r\n  };\r\n\r\n  return useMemo(\r\n    () => (\r\n      <TouchableOpacity\r\n        onPress={props.onPress}\r\n        accessible={true}\r\n        accessibilityLabel={\r\n          props.selected\r\n            ? t(\r\n                \"Position {{x}}, {{y}} - Selected - {{element}}\",\r\n                translationArgs,\r\n              )\r\n            : t(\"Position {{x}}, {{y}} - {{element}}\", translationArgs)\r\n        }\r\n        accessibilityRole=\"button\"\r\n      >\r\n        <View\r\n          style={{\r\n            width: 34,\r\n            height: 34,\r\n            borderWidth: 1,\r\n            borderColor: props.error\r\n              ? theme.colors.error\r\n              : theme.colors.outline,\r\n            backgroundColor:\r\n              props.selected && props.error\r\n                ? theme.colors.onErrorContainer\r\n                : props.selected\r\n                ? theme.colors.secondaryContainer\r\n                : props.error\r\n                ? theme.colors.errorContainer\r\n                : undefined,\r\n          }}\r\n        >\r\n          {element != null && <GameIcon icon={element.toLowerCase()} />}\r\n        </View>\r\n      </TouchableOpacity>\r\n    ),\r\n    [\r\n      props.x,\r\n      props.y,\r\n      element,\r\n      props.onPress,\r\n      props.selected,\r\n      props.error,\r\n      theme,\r\n    ],\r\n  );\r\n}\r\n\r\nfunction SynchroGrid(props: {\r\n  onGridPress: (x: number, y: number) => void;\r\n  selectedPosition: { x: number; y: number } | undefined;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n\r\n  const rows = useMemo(() => {\r\n    const rows = [];\r\n    for (let i = 0; i < SYNCHRO_ROWS; i++) {\r\n      const currentRow = [];\r\n      for (let j = 0; j < SYNCHRO_COLS; j++) {\r\n        currentRow.push(\r\n          <SynchroGridItem\r\n            x={j}\r\n            y={i}\r\n            selected={\r\n              props.selectedPosition?.x == j && props.selectedPosition?.y == i\r\n            }\r\n            error={hasNegativeSynchroBonusOnTile(state, j, i)}\r\n            key={i.toString() + j.toString()}\r\n            onPress={props.onGridPress.bind(null, j, i)}\r\n          />,\r\n        );\r\n      }\r\n      rows.push(\r\n        <View key={i} style={Styles.flexRowAlignCenter}>\r\n          {currentRow}\r\n        </View>,\r\n      );\r\n    }\r\n    return rows;\r\n  }, [\r\n    JSON.stringify(getCurrentSynchroStrategy(state)),\r\n    props.selectedPosition?.x,\r\n    props.selectedPosition?.y,\r\n  ]);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={{ borderWidth: 1, borderColor: theme.colors.outline }}>\r\n        {rows}\r\n      </View>\r\n    ),\r\n    [theme, rows],\r\n  );\r\n}\r\n\r\nfunction SynchroElement(props: {\r\n  element: SpellElement | undefined;\r\n  onPress: (element: SpellElement | undefined) => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n\r\n  const element = props.element;\r\n\r\n  const uses = getTotalOccurrencesInSynchroGrid(state, element);\r\n  const max = calculateMaxOccurrencesInSynchroGrid(state, element);\r\n\r\n  return useMemo(() => {\r\n    if (element == undefined) {\r\n      return (\r\n        <View style={[Styles.flexCenter, { alignSelf: \"flex-start\" }]}>\r\n          <TouchableOpacity\r\n            onPress={props.onPress.bind(null, element)}\r\n            accessible={true}\r\n            accessibilityLabel={t(\"Clear position\")}\r\n            accessibilityRole=\"button\"\r\n          >\r\n            <View\r\n              style={[\r\n                styles.itemContainerStyle,\r\n                { borderColor: theme.colors.outlineVariant },\r\n              ]}\r\n            >\r\n              <GameIcon icon=\"x\" />\r\n            </View>\r\n          </TouchableOpacity>\r\n        </View>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <View style={Styles.flexCenter}>\r\n        <TouchableOpacity\r\n          onPress={props.onPress.bind(null, element)}\r\n          accessible={true}\r\n          accessibilityLabel={t(\"Set to {{element}}\", {\r\n            element: translateElement(element),\r\n          })}\r\n          accessibilityRole=\"button\"\r\n        >\r\n          <View\r\n            style={[\r\n              styles.itemContainerStyle,\r\n              { borderColor: theme.colors.outlineVariant },\r\n            ]}\r\n          >\r\n            <GameIcon icon={element.toLowerCase()} />\r\n          </View>\r\n        </TouchableOpacity>\r\n        <View style={Styles.mt4}>\r\n          <Text style={{ fontSize: 12 }}>\r\n            {t(\"{{left}}/{{max}}\", {\r\n              left: formatNumber(max - uses),\r\n              max: formatNumber(max),\r\n            })}\r\n          </Text>\r\n        </View>\r\n      </View>\r\n    );\r\n  }, [element, props.onPress, theme, max, uses]);\r\n}\r\n\r\nexport default function Synchro(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const [selectedPosition, setSelectedPosition] = useState<{\r\n    x: number;\r\n    y: number;\r\n  }>(null);\r\n  const onGridPress = useCallback(\r\n    (x: number, y: number) => setSelectedPosition({ x, y }),\r\n    [setSelectedPosition],\r\n  );\r\n\r\n  useEffect(\r\n    () => setSelectedPosition(undefined),\r\n    [state.world.synchro.currentGrid],\r\n  );\r\n\r\n  const onElementPress = useCallback(\r\n    (element: SpellElement) =>\r\n      stateRef.current.apply((state) => {\r\n        return setCurrentSynchroPosition(\r\n          state,\r\n          selectedPosition.x,\r\n          selectedPosition.y,\r\n          element,\r\n        );\r\n      }),\r\n    [selectedPosition],\r\n  );\r\n\r\n  const synchroGrid = useMemo(\r\n    () => (\r\n      <SynchroGrid\r\n        onGridPress={onGridPress}\r\n        selectedPosition={selectedPosition}\r\n      />\r\n    ),\r\n    [onGridPress, selectedPosition],\r\n  );\r\n\r\n  const synchroElementButtons = useMemo(() => {\r\n    const buttons = getFullyUnlockedElements(state)\r\n      .sort(\r\n        (a, b) =>\r\n          valuesOfCached(SpellElement).indexOf(a) -\r\n          valuesOfCached(SpellElement).indexOf(b),\r\n      )\r\n      .map((element) => (\r\n        <SynchroElement\r\n          key={element}\r\n          onPress={onElementPress}\r\n          element={element}\r\n        />\r\n      ));\r\n    buttons.push(\r\n      <SynchroElement\r\n        key=\"clear\"\r\n        onPress={onElementPress}\r\n        element={undefined}\r\n      />,\r\n    );\r\n    return buttons;\r\n  }, [JSON.stringify(getFullyUnlockedElements(state)), onElementPress]);\r\n\r\n  const showIntroMessage = !hasWorldFlag(state, Flag.EverUsedSynchro);\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={[Styles.p4, Styles.flex]}>\r\n        <Text h1>{t(\"Synchro\")}</Text>\r\n        <View style={[Styles.flexCenter, Styles.mt8]}>{synchroGrid}</View>\r\n        <View style={[Styles.flexCenter, Styles.mt8, { minHeight: 120 }]}>\r\n          <View\r\n            style={[\r\n              Styles.flexRowAlignCenter,\r\n              {\r\n                width: 34 * 7 + 8 * 6,\r\n                gap: 8,\r\n                flexWrap: \"wrap\",\r\n                justifyContent: \"center\",\r\n              },\r\n            ]}\r\n          >\r\n            {selectedPosition != null && synchroElementButtons}\r\n            {selectedPosition == null && showIntroMessage && (\r\n              <Text style={{ fontStyle: \"italic\" }}>\r\n                {t(\r\n                  \"Welcome to the Synchro screen! You can get started with your Synchro Board by pressing any of the tiles in the grid above.\",\r\n                )}\r\n              </Text>\r\n            )}\r\n          </View>\r\n        </View>\r\n        <View style={Styles.mt8}>\r\n          <SynchroGridSelectors />\r\n        </View>\r\n        <View style={[Styles.flex, Styles.mt8]}>\r\n          <SynchroBottomComponent />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [selectedPosition, synchroElementButtons, synchroGrid, showIntroMessage],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  itemContainerStyle: {\r\n    width: 34,\r\n    height: 34,\r\n    borderWidth: 1,\r\n  },\r\n});\r\n","import { fromEntries, keysOf } from \"../../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { cacheByArbitraryVersion, cacheByTickCount } from \"../../Caching\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport {\r\n  Resource,\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n} from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { ActionArea, ActionSubcategory } from \"../../action/ActionAreas\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport {\r\n  SpellElement,\r\n  getElementExpByUsage,\r\n  getUnlockedElements,\r\n} from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"./ChannelingResources\";\r\n\r\nexport abstract class BasicChannelingSpellBase extends Spell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    const parentAreas = super.getAreas();\r\n    return parentAreas;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.CHANNELING;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return Math.floor(\r\n      getResourceCap(state, Resource.Mana) * this.getManaCostProportion(),\r\n    );\r\n  }\r\n\r\n  getBaseEssenceEfficiency() {\r\n    return 1.0;\r\n  }\r\n\r\n  getManaCostProportion() {\r\n    return 0.1;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      essenceEfficiency: {\r\n        value: this.getBaseEssenceEfficiency(),\r\n        tags: [TransformationTags.ChannelingEfficiency],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEssencesToGrant(): Resource | \"all\" {\r\n    return RESOURCE_FOR_ELEMENT[this.getElement()];\r\n  }\r\n\r\n  getEssenceAmountToGrant(state: GameState): number {\r\n    return cacheByTickCount(\r\n      state,\r\n      \"essenceAmountToGrant\" + this.getId(),\r\n      (state) => {\r\n        const effects = this.getActionEffects(state);\r\n        const amount = this.getBaseManaCost(state) * effects.essenceEfficiency;\r\n        return amount;\r\n      },\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const resource = this.getEssencesToGrant();\r\n    const amount = this.getEssenceAmountToGrant(state);\r\n    if (resource === \"all\") {\r\n      const resourceTexts: string[] = [];\r\n      for (let element of getUnlockedElements(state)) {\r\n        resourceTexts.push(\r\n          t(\"+{{amount}}{{resourceIcon}}\", {\r\n            amount: formatNumber(amount),\r\n            resourceIcon:\r\n              \":\" + RESOURCE_FOR_ELEMENT[element].toLowerCase() + \":\",\r\n          }),\r\n        );\r\n      }\r\n      return resourceTexts.join(t(\", \"));\r\n    }\r\n    return t(\r\n      \"^+{{amount}}^<{{resourceIcon}}/:mana: calculation: {{explanation}}>{{resourceIcon}}\",\r\n      {\r\n        amount: formatNumber(amount),\r\n        resourceIcon: `:${resource.toLowerCase()}:`,\r\n        explanation: this.getActionEffectExplanations(\r\n          state,\r\n          \"essenceEfficiency\",\r\n        ).essenceEfficiency,\r\n      },\r\n    );\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.ChannelingUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  isEnabled(state: GameState, skipAffordabilityChecks?: boolean): boolean {\r\n    return (\r\n      super.isEnabled(state, skipAffordabilityChecks) &&\r\n      this.isCastingRecommended(state)\r\n    );\r\n  }\r\n\r\n  getExpFromUsage(state: GameState): Partial<Record<SpellElement, number>> {\r\n    return cacheByArbitraryVersion(\r\n      state,\r\n      this.getId() + \"expFromUsage\",\r\n      (state) => {\r\n        const elementRequirements = this.getLevelRequirements();\r\n        return fromEntries(\r\n          keysOf(elementRequirements).map((element) => {\r\n            return [\r\n              element,\r\n              getElementExpByUsage(\r\n                state,\r\n                element,\r\n                elementRequirements[element],\r\n                (this.getCost(state).resources[Resource.Mana] ?? 0) *\r\n                  Math.log10(Math.max(1, this.getEssenceAmountToGrant(state))),\r\n                true,\r\n                this.getTags(),\r\n              ),\r\n            ];\r\n          }),\r\n        );\r\n      },\r\n      (state) => Math.floor(Date.now() / 500),\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const resource = this.getEssencesToGrant();\r\n    const amount = this.getEssenceAmountToGrant(state);\r\n\r\n    if (resource === \"all\") {\r\n      for (let element of getUnlockedElements(state)) {\r\n        state = grantResource(RESOURCE_FOR_ELEMENT[element], amount)(state);\r\n      }\r\n      return state;\r\n    }\r\n\r\n    return grantResource(resource, amount)(state);\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    const resource = this.getEssencesToGrant();\r\n    if (resource != \"all\") {\r\n      return (\r\n        getResourceAmount(state, resource) < getResourceCap(state, resource)\r\n      );\r\n    }\r\n    for (let element of getUnlockedElements(state)) {\r\n      if (\r\n        (resource == \"all\" || resource == RESOURCE_FOR_ELEMENT[element]) &&\r\n        getResourceAmount(state, RESOURCE_FOR_ELEMENT[element]) <\r\n          getResourceCap(state, RESOURCE_FOR_ELEMENT[element])\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { BasicChannelingSpellBase } from \"./BasicChannelingSpellBase\";\r\n\r\nclass ChannelFire extends BasicChannelingSpellBase {\r\n  getId(): string {\r\n    return \"channelFire\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Channel Fire\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getBaseEssenceEfficiency(): number {\r\n    return 0.75;\r\n  }\r\n\r\n  getManaCostProportion(): number {\r\n    return 0.2;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Channel some of your Mana into Fire Essence, a basic resource.\");\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 1 };\r\n  }\r\n}\r\n\r\nexport default new ChannelFire();\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport {\r\n  NestableDraggableFlatList,\r\n  NestableScrollContainer,\r\n  RenderItem,\r\n  RenderItemParams,\r\n} from \"react-native-draggable-flatlist\";\r\nimport { IconButton, Switch, TextInput, useTheme } from \"react-native-paper\";\r\nimport { getThemeByElementAndDarkMode } from \"../Themes\";\r\nimport { cacheByArbitraryVersion } from \"../backend/Caching\";\r\nimport { Flag } from \"../backend/Flag\";\r\nimport { hasEverHadFlag } from \"../backend/Flags\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport { Resource, getResourceCap } from \"../backend/Resources\";\r\nimport {\r\n  AutocastConditionData,\r\n  AutocastRule,\r\n  assignWizardsToPermaCast,\r\n  assignWizardsToRule,\r\n  clearAutocastStrategy,\r\n  estimateExpGainPerSecPerStrategy,\r\n  estimateIntervalBetweenCastsForRule,\r\n  estimateManaConsumptionPerSecPerRule,\r\n  estimateManaConsumptionPerSecPerStrategy,\r\n  estimateManaConsumptionPerSecPermaCast,\r\n  estimateWizardPowerConsumptionPerSecPermaCast,\r\n  estimateWizardsNeededPermaCast,\r\n  explainAutocastPointIncomePerSecPerWizard,\r\n  explainWizardAmount,\r\n  getAutocastPointIncomePerSecPerWizard,\r\n  getAutocastRuleById,\r\n  getAutocastRuleIndexByRule,\r\n  getAutocastStatusByRule,\r\n  getConditionFromData,\r\n  getCurrentAutocastStrategy,\r\n  getFreeWizards,\r\n  getSortedPermaCastSpellList,\r\n  getWizardAmount,\r\n  saveCurrentAutocastStrategy,\r\n  toggleAutocastRuleDisabled,\r\n  toggleAutocastRuleHidden,\r\n  translateSpellAutocastCategory,\r\n} from \"../backend/autocast/Autocast\";\r\nimport { permacastStoryline } from \"../backend/events/storyline/sewers/PermaCast\";\r\nimport { SpellElement, translateElement } from \"../backend/spells/Elements\";\r\nimport { Spells } from \"../backend/spells/Spells\";\r\nimport ChannelFire from \"../backend/spells/channeling/ChannelFire\";\r\nimport { calculateIncomePerSecond } from \"../backend/timetick/IncomeOverTime\";\r\nimport { keysOf, nullthrows } from \"../utils/CoreUtils\";\r\nimport { formatNumber } from \"../utils/FormattingUtils\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { AutocastLoadoutLoadContainer } from \"./utility/AutocastLoadoutLoadContainer\";\r\nimport { Button } from \"./utility/Button\";\r\nimport CategoryContainer from \"./utility/CategoryContainer\";\r\nimport { CheckBox } from \"./utility/CheckBox\";\r\nimport { DragHandle } from \"./utility/DragHandle\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Picker } from \"./utility/Picker\";\r\nimport { PlusMinusAllocator } from \"./utility/PlusMinusAllocator\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { Text } from \"./utility/Text\";\r\nimport { GameIcon } from \"./utility/icons/GameIcon\";\r\n\r\nfunction ConditionRow(props: { condition: AutocastConditionData }) {\r\n  const condition = getConditionFromData(props.condition);\r\n  const state = useContext(StateContext);\r\n  const explanation = condition.getDisplayExplanation(\r\n    state,\r\n    props.condition.values,\r\n  );\r\n  return useMemo(() => <Markdown>{explanation}</Markdown>, [explanation]);\r\n}\r\n\r\nfunction PermaCastRow() {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const theme = useTheme();\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n\r\n  const onPressPlus = useCallback(\r\n    () => stateRef.current.apply((state) => assignWizardsToPermaCast(state, 1)),\r\n    [],\r\n  );\r\n  const onPressMinus = useCallback(\r\n    () =>\r\n      stateRef.current.apply((state) => assignWizardsToPermaCast(state, -1)),\r\n    [],\r\n  );\r\n\r\n  const hasPermaCastSpells = keysOf(strategy.permaCastRules).length > 0;\r\n  const permaCastSpells = cacheByArbitraryVersion(\r\n    state,\r\n    \"permaCastSpellListSorted\",\r\n    (state) => getSortedPermaCastSpellList(state, strategy),\r\n    (state) => Math.floor(Date.now() / 500),\r\n  );\r\n\r\n  const permaCastSpellList =\r\n    permaCastSpells.length == 0\r\n      ? t(\r\n          \"No spells yet! You can assign spells to Perma-Cast by opening a spell's details in the Spell menu.\",\r\n        )\r\n      : t(\r\n          \"{{number}} spell(s), most expensive by :mana: and :wizardpower:: {{actualSpellList}}\",\r\n          {\r\n            number: permaCastSpells.length,\r\n            actualSpellList: permaCastSpells\r\n              .slice(-5)\r\n              .reverse()\r\n              .map((spell) => spell.getBasicDisplayName(state))\r\n              .join(t(\", \")),\r\n          },\r\n        );\r\n\r\n  const powerNeededPerSec = estimateWizardPowerConsumptionPerSecPermaCast(\r\n    state,\r\n    strategy,\r\n  );\r\n  const manaNeededPerSec = estimateManaConsumptionPerSecPermaCast(\r\n    state,\r\n    strategy,\r\n  );\r\n  const wizardsNeeded = estimateWizardsNeededPermaCast(state, strategy);\r\n  const manaIncome = calculateIncomePerSecond(state).Mana ?? 0;\r\n  const maxManaCost = Math.max(\r\n    ...permaCastSpells.map((spell) => spell.getManaCost(state)),\r\n  );\r\n  const manaCap = getResourceCap(state, Resource.Mana);\r\n\r\n  const warningWizardPower = useMemo(() => {\r\n    let warningWizardPower = null;\r\n    if (strategy.wizardsAssignedToPermaCast < wizardsNeeded) {\r\n      warningWizardPower = (\r\n        <View>\r\n          <Markdown style={{ color: theme.colors.error }}>\r\n            {t(\r\n              \"*Warning: you do not have enough wizards assigned to Perma-Cast! Some of your Perma-Cast spells may not actually get cast.*\",\r\n            )}\r\n          </Markdown>\r\n        </View>\r\n      );\r\n    }\r\n    return warningWizardPower;\r\n  }, [wizardsNeeded, strategy.wizardsAssignedToPermaCast]);\r\n  const warningManaConsumption = useMemo(() => {\r\n    let warningManaConsumption = null;\r\n    if (manaIncome < manaNeededPerSec) {\r\n      warningManaConsumption = (\r\n        <View>\r\n          <Markdown style={{ color: theme.colors.error }}>\r\n            {t(\r\n              \"*Warning: your :mana: income is not enough to support all your Perma-Cast spells! Some of your Perma-Cast spells may not actually get cast, and your :mana: may not increase.*\",\r\n            )}\r\n          </Markdown>\r\n        </View>\r\n      );\r\n    }\r\n    return warningManaConsumption;\r\n  }, [manaIncome, manaNeededPerSec]);\r\n  const warningManaCap = useMemo(() => {\r\n    let warningManaCap = null;\r\n    if (manaCap < maxManaCost) {\r\n      warningManaCap = (\r\n        <View>\r\n          <Markdown style={{ color: theme.colors.error }}>\r\n            {t(\r\n              \"*Warning: your Max:mana: is not high enough to cast at least one of your Perma-Cast spells! Those spells will not get cast, but they will also not consume :mana: or :wizardpower:.*\",\r\n            )}\r\n          </Markdown>\r\n        </View>\r\n      );\r\n    }\r\n    return warningManaCap;\r\n  }, [manaCap, maxManaCost]);\r\n\r\n  const helperText = useMemo(\r\n    () =>\r\n      hasPermaCastSpells\r\n        ? t(\r\n            `*({{wizardPower}}:wizardpower:/s ({{wiz}} Wizards); {{mana}}:mana:/s)*`,\r\n            {\r\n              wizardPower: formatNumber(powerNeededPerSec, {\r\n                showDecimals: true,\r\n              }),\r\n              wiz: formatNumber(wizardsNeeded),\r\n              mana: formatNumber(manaNeededPerSec, { showDecimals: true }),\r\n            },\r\n          )\r\n        : \"\",\r\n    [hasPermaCastSpells, powerNeededPerSec, wizardsNeeded, manaNeededPerSec],\r\n  );\r\n  const topHalf = useMemo(\r\n    () => (\r\n      <View style={Styles.flexRowAlignCenter}>\r\n        <View style={Styles.flex}>\r\n          <Markdown>\r\n            {t(\"***Perma-Cast spells:** {{permaCastSpellList}}*\", {\r\n              permaCastSpellList,\r\n            })}\r\n          </Markdown>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [permaCastSpellList],\r\n  );\r\n  const explanationComponent = useMemo(\r\n    () => (\r\n      <View style={Styles.flexRowAlignCenter}>\r\n        {helperText != \"\" ? <Markdown>{helperText}</Markdown> : null}\r\n      </View>\r\n    ),\r\n    [helperText],\r\n  );\r\n\r\n  const warningComponent = useMemo(\r\n    () => (\r\n      <View>\r\n        {warningWizardPower}\r\n        {warningManaConsumption}\r\n        {warningManaCap}\r\n      </View>\r\n    ),\r\n    [warningWizardPower, warningManaConsumption, warningManaCap],\r\n  );\r\n\r\n  const viewStyle = useMemo(\r\n    () => [\r\n      Styles.flexRowAlignCenter,\r\n      Styles.flex,\r\n      Styles.mv4,\r\n      Styles.p8,\r\n      {\r\n        backgroundColor: !hasPermaCastSpells\r\n          ? theme.colors.surfaceDisabled\r\n          : theme.colors.secondaryContainer,\r\n        borderRadius: 8,\r\n      },\r\n    ],\r\n    [hasPermaCastSpells, theme],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View style={viewStyle}>\r\n        <View style={Styles.flex}>\r\n          {topHalf}\r\n          {explanationComponent}\r\n          {warningComponent}\r\n        </View>\r\n        <View style={[Styles.flexRowAlignCenter, Styles.ml16]}>\r\n          <View style={Styles.mr4}>\r\n            <Text>{strategy.wizardsAssignedToPermaCast}</Text>\r\n          </View>\r\n          <PlusMinusAllocator\r\n            disableMinus={strategy.wizardsAssignedToPermaCast <= 0}\r\n            disablePlus={getFreeWizards(state) <= 0}\r\n            onPressPlus={onPressPlus}\r\n            onPressMinus={onPressMinus}\r\n          />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      topHalf,\r\n      explanationComponent,\r\n      warningComponent,\r\n      strategy.wizardsAssignedToPermaCast,\r\n      getFreeWizards(state),\r\n      onPressPlus,\r\n      onPressMinus,\r\n      viewStyle,\r\n    ],\r\n  );\r\n}\r\n\r\nfunction AutocastRuleRow(props: {\r\n  ruleId: string;\r\n  // setEditRow: (ruleId: string) => void;\r\n  toggleDisabled: (ruleId: string) => void;\r\n  onPressMinus: (ruleId: string) => void;\r\n  onPressPlus: (ruleId: string) => void;\r\n  onDelete: (ruleId: string) => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const { ruleId, onPressMinus, onPressPlus, toggleDisabled, onDelete } = props;\r\n  const rule = getAutocastRuleById(state, ruleId);\r\n  const ruleStatus = getAutocastStatusByRule(state, rule);\r\n  const spell = Spells.getByIdNullable(rule?.spellId);\r\n  const wizardPointCap = spell?.getAutocastPointsRequirement(state);\r\n  const manaCost = spell?.getCost(state)?.resources[Resource.Mana];\r\n  const isSpellVisible = spell?.isVisible(state);\r\n  const intervalBetweenCasts = estimateIntervalBetweenCastsForRule(\r\n    state,\r\n    rule,\r\n    ruleStatus,\r\n  );\r\n  const manaCostPerSec = estimateManaConsumptionPerSecPerRule(\r\n    state,\r\n    rule,\r\n    ruleStatus,\r\n  );\r\n  const hideRule = useCallback(\r\n    () => stateRef.current.apply((s) => toggleAutocastRuleHidden(s, rule)),\r\n    [rule],\r\n  );\r\n  const helperText = useMemo(\r\n    () =>\r\n      ruleStatus.wizardsAssigned > 0 && !ruleStatus.disabled\r\n        ? t(`*({{secs}}s/cast; {{mana}}:mana:/s)*`, {\r\n            secs: formatNumber(intervalBetweenCasts, { showDecimals: true }),\r\n            mana: formatNumber(manaCostPerSec, { showDecimals: true }),\r\n          })\r\n        : \"\",\r\n    [\r\n      intervalBetweenCasts,\r\n      ruleStatus.wizardsAssigned,\r\n      ruleStatus.disabled,\r\n      manaCostPerSec,\r\n    ],\r\n  );\r\n  const wizardPointStatusComponent = useMemo(\r\n    () => (\r\n      <View style={[Styles.flexRowAlignCenter, Styles.mr8, { marginTop: 2 }]}>\r\n        <GameIcon icon=\"wizardpower\" small={true} style={Styles.mr4} />\r\n        <Text>\r\n          {t(\"{{amount}}/{{cap}}\", {\r\n            amount: formatNumber(ruleStatus.currentPoints),\r\n            cap: formatNumber(wizardPointCap) ?? 0,\r\n          })}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [formatNumber(ruleStatus.currentPoints), wizardPointCap],\r\n  );\r\n  const topHalf = useMemo(\r\n    () => (\r\n      <View style={Styles.flexRowAlignCenter}>\r\n        <View style={[Styles.flex, { marginTop: -4 }]}>\r\n          {rule.spellId == \"checkOnly\" ? (\r\n            <Markdown>\r\n              {t(\"Stop processing rules below if conditions not met:\")}\r\n            </Markdown>\r\n          ) : !isSpellVisible ? (\r\n            <Markdown>{t(\"[Rule hidden as spell is not unlocked]\")}</Markdown>\r\n          ) : rule.conditions.length == 0 ? (\r\n            <Markdown>\r\n              {t(\"*{{spellName}}*\", {\r\n                spellName: nullthrows(spell).getBasicDisplayName(state),\r\n              })}\r\n            </Markdown>\r\n          ) : (\r\n            <Markdown>\r\n              {t(\"*{{spellName}}*) if:\", {\r\n                spellName: nullthrows(spell).getBasicDisplayName(state),\r\n              })}\r\n            </Markdown>\r\n          )}\r\n          {rule.conditions.map((condition, idx) => (\r\n            <ConditionRow condition={condition} key={idx} />\r\n          ))}\r\n        </View>\r\n        {spell != null && (\r\n          <View style={[Styles.flexRowAlignCenter, Styles.ml8]}>\r\n            <View style={Styles.mr4}>\r\n              <Text>{ruleStatus.wizardsAssigned}</Text>\r\n            </View>\r\n            <PlusMinusAllocator\r\n              disableMinus={!isSpellVisible || ruleStatus.wizardsAssigned <= 0}\r\n              disablePlus={!isSpellVisible || getFreeWizards(state) <= 0}\r\n              onPressPlus={onPressPlus.bind(null, ruleId)}\r\n              onPressMinus={onPressMinus.bind(null, ruleId)}\r\n            />\r\n          </View>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      ruleId,\r\n      JSON.stringify(rule.conditions),\r\n      isSpellVisible,\r\n      spell != null && spell.getBasicDisplayName(state),\r\n      manaCost,\r\n      ruleStatus.wizardsAssigned,\r\n      getFreeWizards(state),\r\n      onPressMinus,\r\n      onPressPlus,\r\n    ],\r\n  );\r\n  const rightSide = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          Styles.ml4,\r\n          Styles.mr4,\r\n          {\r\n            alignSelf: \"stretch\",\r\n            alignItems: \"center\",\r\n            justifyContent: \"space-around\",\r\n          },\r\n        ]}\r\n      >\r\n        <Switch\r\n          value={!ruleStatus.disabled}\r\n          onValueChange={toggleDisabled.bind(null, ruleId)}\r\n        />\r\n        <View style={Styles.flexRowAlignCenter}>\r\n          <IconButton\r\n            icon={(props) => (\r\n              <MaterialIcons name=\"remove\" size={20} color={props.color} />\r\n            )}\r\n            style={[{ margin: 0, width: 20, height: 20 }, Styles.mr4]}\r\n            onPress={hideRule}\r\n          />\r\n          <IconButton\r\n            icon={(props) => (\r\n              <MaterialIcons name=\"close\" size={20} color={props.color} />\r\n            )}\r\n            style={{ margin: 0, width: 20, height: 20 }}\r\n            onPress={() => onDelete(ruleId)}\r\n          />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [ruleStatus.disabled, toggleDisabled, ruleId, onDelete, hideRule],\r\n  );\r\n  const explanationComponent = useMemo(\r\n    () =>\r\n      spell != null &&\r\n      isSpellVisible && (\r\n        <View style={Styles.flexRowAlignCenter}>\r\n          {wizardPointStatusComponent}\r\n          <Markdown>{helperText}</Markdown>\r\n        </View>\r\n      ),\r\n    [wizardPointStatusComponent, helperText, rule.spellId, isSpellVisible],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View style={[Styles.flexRowAlignCenter, Styles.flex]}>\r\n        <View style={Styles.flex}>\r\n          {topHalf}\r\n          {explanationComponent}\r\n        </View>\r\n        {rightSide}\r\n      </View>\r\n    ),\r\n    [topHalf, rightSide, explanationComponent],\r\n  );\r\n}\r\n\r\nfunction AutocastRuleRowContainer(props: {\r\n  params: RenderItemParams<AutocastRule>;\r\n  // editRow: number;\r\n  saveRule: (rule: AutocastRule) => void;\r\n  deleteRule: (ruleId: string) => void;\r\n  // setEditRow: (ruleId: string) => void;\r\n  toggleDisabled: (ruleId: string) => void;\r\n  onPressMinus: (ruleId: string) => void;\r\n  onPressPlus: (ruleId: string) => void;\r\n}) {\r\n  const {\r\n    params,\r\n    // editRow,\r\n    saveRule,\r\n    deleteRule,\r\n    // setEditRow,\r\n    toggleDisabled,\r\n    onPressMinus,\r\n    onPressPlus,\r\n  } = props;\r\n  const rule = params.item;\r\n  //const idx = params.getIndex();\r\n  const theme = useTheme();\r\n  const spell = Spells.getByIdNullable(rule.spellId);\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const ruleStatus = getAutocastStatusByRule(state, rule);\r\n  const ruleDisabled =\r\n    ruleStatus.disabled ||\r\n    (spell != null && ruleStatus.wizardsAssigned <= 0) ||\r\n    (spell != null && !spell.isVisible(state));\r\n\r\n  const dragHandle = useMemo(\r\n    () => <DragHandle drag={params.drag} />,\r\n    [params.drag],\r\n  );\r\n\r\n  const isDark = theme.dark;\r\n  const isHidden = ruleStatus.hidden;\r\n\r\n  const surfaceColor =\r\n    spell != null && spell.getElement() != null\r\n      ? getThemeByElementAndDarkMode(spell.getElement(), isDark).colors\r\n          .secondaryContainer\r\n      : theme.colors.secondaryContainer;\r\n\r\n  const viewStyle = useMemo(\r\n    () => [\r\n      Styles.flexRowAlignCenter,\r\n      Styles.flex,\r\n      Styles.mv4,\r\n      Styles.p4,\r\n      {\r\n        backgroundColor: ruleDisabled\r\n          ? theme.colors.surfaceDisabled\r\n          : surfaceColor,\r\n        borderRadius: 8,\r\n      },\r\n    ],\r\n    [ruleDisabled, theme, surfaceColor],\r\n  );\r\n\r\n  const boundSave = useMemo(() => saveRule.bind(null), [saveRule]);\r\n  const boundDelete = useMemo(\r\n    () => deleteRule.bind(null, rule.id),\r\n    [rule.id, deleteRule],\r\n  );\r\n\r\n  const unhideRule = useCallback(\r\n    () => stateRef.current.apply((s) => toggleAutocastRuleHidden(s, rule)),\r\n    [rule.id],\r\n  );\r\n  const unhideIconFn = useCallback(\r\n    (props) => (\r\n      <MaterialIcons name=\"unfold-more\" size={20} color={props.color} />\r\n    ),\r\n    [],\r\n  );\r\n\r\n  const hiddenViewStyle = useMemo(\r\n    () => [Styles.flexRowSpaceBetween, Styles.ph8],\r\n    [],\r\n  );\r\n  const hiddenText = useMemo(\r\n    () =>\r\n      t(\"{{spellName}} (hidden){{wizardCount}}\", {\r\n        spellName: spell.getBasicDisplayName(state),\r\n        wizardCount:\r\n          ruleStatus.wizardsAssigned > 0\r\n            ? t(\" ({{wizardCount}})\", {\r\n                wizardCount: formatNumber(ruleStatus.wizardsAssigned),\r\n              })\r\n            : \"\",\r\n      }),\r\n    [spell.getDisplayName(state), ruleStatus.wizardsAssigned],\r\n  );\r\n  return useMemo(\r\n    () =>\r\n      !isHidden ? (\r\n        <View style={viewStyle}>\r\n          {dragHandle}\r\n          <AutocastRuleRow\r\n            ruleId={rule.id}\r\n            // setEditRow={setEditRow}\r\n            onPressMinus={onPressMinus}\r\n            onPressPlus={onPressPlus}\r\n            onDelete={deleteRule}\r\n            toggleDisabled={toggleDisabled}\r\n          />\r\n        </View>\r\n      ) : (\r\n        <View style={hiddenViewStyle}>\r\n          <Text key=\"hiddenText\">{hiddenText}</Text>\r\n          <IconButton\r\n            key=\"unhide\"\r\n            icon={unhideIconFn}\r\n            style={styles.unfoldButton}\r\n            onPress={unhideRule}\r\n          />\r\n        </View>\r\n      ),\r\n    [\r\n      isHidden,\r\n      viewStyle,\r\n      dragHandle,\r\n      rule.id,\r\n      rule,\r\n      boundSave,\r\n      boundDelete,\r\n      // setEditRow,\r\n      onPressMinus,\r\n      onPressPlus,\r\n      toggleDisabled,\r\n      hiddenViewStyle,\r\n      hiddenText,\r\n      unhideIconFn,\r\n      unhideRule,\r\n    ],\r\n  );\r\n}\r\n\r\nfunction WizardsBottomComponent(props) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n\r\n  const theme = useTheme();\r\n\r\n  const manaConsumption = estimateManaConsumptionPerSecPerStrategy(\r\n    state,\r\n    strategy,\r\n  );\r\n  const manaIncome = calculateIncomePerSecond(state)?.Mana ?? 0;\r\n\r\n  const expGain = estimateExpGainPerSecPerStrategy(\r\n    state,\r\n    getCurrentAutocastStrategy(state),\r\n  );\r\n  let maxExpGain = 0,\r\n    maxExpGainElement = SpellElement.Fire;\r\n  for (let element of keysOf(expGain)) {\r\n    if (expGain[element] > maxExpGain) {\r\n      maxExpGainElement = element;\r\n      maxExpGain = expGain[element];\r\n    }\r\n  }\r\n\r\n  const wizardPowerProductionPerWizard =\r\n    getAutocastPointIncomePerSecPerWizard(state);\r\n  const wizardPowerProductionPerWizardExplanation =\r\n    explainAutocastPointIncomePerSecPerWizard(state);\r\n\r\n  const totalWizards = getWizardAmount(state);\r\n  const explainTotalWizards = explainWizardAmount(state);\r\n\r\n  const bottomComponent = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.loadoutsContainer,\r\n          { borderColor: theme.colors.outlineVariant },\r\n        ]}\r\n      >\r\n        <View style={[Styles.flexRowAlignCenter]}>\r\n          <View style={[Styles.flex, Styles.mr8]}>\r\n            <Markdown>{t(\"Wizards remaining:\")}</Markdown>\r\n          </View>\r\n          <View>\r\n            <Markdown>\r\n              {t(\r\n                \"{{remainingWizards}}/^{{totalWizards}}^<{{explainTotalWizards}}>\",\r\n                {\r\n                  remainingWizards: getFreeWizards(state),\r\n                  totalWizards: totalWizards,\r\n                  explainTotalWizards: explainTotalWizards,\r\n                },\r\n              )}\r\n            </Markdown>\r\n          </View>\r\n        </View>\r\n        <View style={[Styles.flexRowAlignCenter]}>\r\n          <View style={[Styles.flex, Styles.mr8]}>\r\n            <Markdown>{t(\"Wizard Power production per Wizard:\")}</Markdown>\r\n          </View>\r\n          <View>\r\n            <Markdown>\r\n              {t(\"^{{amount}}^<{{explanation}}>:wizardpower:/sec\", {\r\n                amount: formatNumber(wizardPowerProductionPerWizard, {\r\n                  showDecimals: true,\r\n                }),\r\n                explanation: wizardPowerProductionPerWizardExplanation,\r\n              })}\r\n            </Markdown>\r\n          </View>\r\n        </View>\r\n        <View style={[Styles.flexRowAlignCenter]}>\r\n          <View style={[Styles.flex, Styles.mr8]}>\r\n            <Markdown>{t(\"Estimated Mana consumption:\")}</Markdown>\r\n          </View>\r\n          <View>\r\n            <Markdown\r\n              style={\r\n                manaConsumption > manaIncome && { color: theme.colors.error }\r\n              }\r\n            >\r\n              {t(\"{{amount}}:mana:/sec\", {\r\n                amount: formatNumber(manaConsumption, { showDecimals: true }),\r\n              })}\r\n            </Markdown>\r\n          </View>\r\n        </View>\r\n        <View style={[Styles.flexRowAlignCenter]}>\r\n          <View style={[Styles.flex, Styles.mr8]}>\r\n            <Markdown>{t(\"Estimated exp gain:\")}</Markdown>\r\n          </View>\r\n          <View>\r\n            <Markdown>\r\n              {maxExpGain > 0\r\n                ? t(\"{{amount}} {{mainElement}} + others / min\", {\r\n                    amount: formatNumber(maxExpGain * 60, {\r\n                      showDecimals: true,\r\n                    }),\r\n                    mainElement: translateElement(maxExpGainElement),\r\n                  })\r\n                : t(\"-\")}\r\n            </Markdown>\r\n          </View>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      theme,\r\n      getFreeWizards(state),\r\n      totalWizards,\r\n      explainTotalWizards,\r\n      wizardPowerProductionPerWizard,\r\n      wizardPowerProductionPerWizardExplanation,\r\n      manaConsumption,\r\n      manaIncome,\r\n      maxExpGain,\r\n      maxExpGainElement,\r\n    ],\r\n  );\r\n  return bottomComponent;\r\n}\r\n\r\nfunction WizardsMainComponent(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const theme = useTheme();\r\n\r\n  const strategy = getCurrentAutocastStrategy(state);\r\n\r\n  // const [editRow, setEditRow] = useState<number | undefined>(undefined);\r\n\r\n  const saveRule = useCallback((rule: AutocastRule) => {\r\n    stateRef.current.apply((s) => {\r\n      const currentStrategy = getCurrentAutocastStrategy(s);\r\n      const idx = getAutocastRuleIndexByRule(state, rule);\r\n      currentStrategy.rules[idx] = rule;\r\n      s.run.autocast.rules[rule.id] = {\r\n        currentPoints: 0,\r\n        wizardsAssigned: rule.wizardsAssigned,\r\n        disabled: rule.disabled,\r\n        hidden: false,\r\n      };\r\n      return s;\r\n    });\r\n    // setEditRow(undefined);\r\n  }, []);\r\n\r\n  const deleteRule = useCallback((ruleId: string) => {\r\n    stateRef.current.apply((s) => {\r\n      const currentStrategy = getCurrentAutocastStrategy(s);\r\n      currentStrategy.rules = currentStrategy.rules.filter(\r\n        (rule) => rule.id != ruleId,\r\n      );\r\n      return s;\r\n    });\r\n    // setEditRow(undefined);\r\n  }, []);\r\n\r\n  const toggleDisabled = useCallback((ruleId: string) => {\r\n    stateRef.current.apply((s) =>\r\n      toggleAutocastRuleDisabled(s, getAutocastRuleById(s, ruleId)),\r\n    );\r\n  }, []);\r\n\r\n  const onPressPlus = useCallback((ruleId: string) => {\r\n    stateRef.current.apply((s) =>\r\n      assignWizardsToRule(s, getAutocastRuleById(s, ruleId), 1),\r\n    );\r\n  }, []);\r\n\r\n  const onPressMinus = useCallback((ruleId: string) => {\r\n    stateRef.current.apply((s) =>\r\n      assignWizardsToRule(s, getAutocastRuleById(s, ruleId), -1),\r\n    );\r\n  }, []);\r\n\r\n  const renderItem: RenderItem<AutocastRule> = useCallback(\r\n    (params: RenderItemParams<AutocastRule>) => (\r\n      <AutocastRuleRowContainer\r\n        params={params}\r\n        saveRule={saveRule}\r\n        deleteRule={deleteRule}\r\n        // editRow={editRow}\r\n        // setEditRow={setEditRow}\r\n        onPressMinus={onPressMinus}\r\n        onPressPlus={onPressPlus}\r\n        toggleDisabled={toggleDisabled}\r\n      />\r\n    ),\r\n    [\r\n      saveRule,\r\n      deleteRule,\r\n      // editRow,\r\n      // setEditRow,\r\n      onPressMinus,\r\n      onPressPlus,\r\n      toggleDisabled,\r\n    ],\r\n  );\r\n  const keyExtractor = useCallback(\r\n    (rule: AutocastRule, idx: number) => rule.id,\r\n    [],\r\n  );\r\n\r\n  const addNewRule = useCallback(() => {\r\n    stateRef.current.apply((s) => {\r\n      const currentStrategy = getCurrentAutocastStrategy(s);\r\n      currentStrategy.rules.push({\r\n        id: Math.random().toString(),\r\n        disabled: true,\r\n        wizardsAssigned: 0,\r\n        spellId: ChannelFire.getId(),\r\n        conditions: [],\r\n      });\r\n      s.global.autocast.currentStrategy = currentStrategy;\r\n      return s;\r\n    });\r\n  }, []);\r\n\r\n  const showPermaCast = permacastStoryline.isBonusActive(state);\r\n\r\n  const rulesByAutocastCategory = useMemo(() => {\r\n    const rulesByAutocastCategory = {};\r\n    for (let rule of strategy.rules) {\r\n      const category = Spells.getById(rule.spellId).getAutocastCategory();\r\n      if (rulesByAutocastCategory[category] == null) {\r\n        rulesByAutocastCategory[category] = [];\r\n      }\r\n      rulesByAutocastCategory[category].push(rule);\r\n    }\r\n    return rulesByAutocastCategory;\r\n  }, [JSON.stringify(strategy.rules)]);\r\n\r\n  const togglePause = useCallback(() => {\r\n    stateRef.current.apply(() => {\r\n      state.run.autocast.autocastPaused = !state.run.autocast.autocastPaused;\r\n      return state;\r\n    });\r\n  }, []);\r\n  const paused = state.run.autocast.autocastPaused;\r\n\r\n  const mainComponent = useMemo(\r\n    () => (\r\n      <NestableScrollContainer>\r\n        {(keysOf(rulesByAutocastCategory).length > 0 || showPermaCast) && (\r\n          <View style={[Styles.ph4, Styles.mt8]}>\r\n            <CheckBox\r\n              title={\r\n                <View style={Styles.flex}>\r\n                  <Text style={paused && { color: theme.colors.error }}>\r\n                    {t(\"Pause all Wizards\")}\r\n                  </Text>\r\n                </View>\r\n              }\r\n              checked={paused}\r\n              onPress={togglePause}\r\n            />\r\n          </View>\r\n        )}\r\n        {showPermaCast ? (\r\n          <View style={[Styles.ph4, Styles.mt8]}>\r\n            <PermaCastRow />\r\n          </View>\r\n        ) : undefined}\r\n        {keysOf(rulesByAutocastCategory).length == 0 && !showPermaCast && (\r\n          <Markdown>\r\n            {t(\r\n              \"*You have no rules currently set for your Wizards! You can tell them to cast spells for you from the Spell menu (by expanding a spell's details) or from the Transmute screen.*\",\r\n            )}\r\n          </Markdown>\r\n        )}\r\n        {keysOf(rulesByAutocastCategory).map((category) => (\r\n          <CategoryContainer\r\n            key={category}\r\n            title={translateSpellAutocastCategory(category)}\r\n            containerStyle={Styles.ph4}\r\n          >\r\n            <NestableDraggableFlatList\r\n              style={styles.container}\r\n              containerStyle={[Styles.flex, styles.contentContainer]}\r\n              // containerStyle={Styles.flex}\r\n              // style={Styles.flex}\r\n              data={rulesByAutocastCategory[category]}\r\n              renderItem={renderItem}\r\n              keyExtractor={keyExtractor}\r\n              onDragEnd={(params) => {\r\n                stateRef.current.apply((state) => {\r\n                  const strategy = getCurrentAutocastStrategy(state);\r\n                  const ruleIndices = [];\r\n                  const ruleIds = params.data.map((rule) => rule.id);\r\n                  for (let idx in strategy.rules) {\r\n                    const rule = strategy.rules[idx];\r\n                    if (ruleIds.includes(rule.id)) {\r\n                      ruleIndices.push(idx);\r\n                    }\r\n                  }\r\n                  for (let idx in params.data) {\r\n                    const rule = params.data[idx];\r\n                    strategy.rules[ruleIndices[idx]] = rule;\r\n                  }\r\n                  state.global.autocast.currentStrategy = strategy;\r\n                  return state;\r\n                });\r\n              }}\r\n            />\r\n          </CategoryContainer>\r\n        ))}\r\n      </NestableScrollContainer>\r\n    ),\r\n    [\r\n      renderItem,\r\n      keyExtractor,\r\n      showPermaCast,\r\n      rulesByAutocastCategory,\r\n      theme,\r\n      paused,\r\n      togglePause,\r\n    ],\r\n  );\r\n\r\n  // const mainComponent = useMemo(\r\n  //   () => (\r\n  //     // <ScrollView\r\n  //     //\r\n  //     // >\r\n  //     <DraggableFlatList\r\n  //       style={styles.container}\r\n  //       containerStyle={[Styles.flex, styles.contentContainer]}\r\n  //       // containerStyle={Styles.flex}\r\n  //       // style={Styles.flex}\r\n  //       data={strategy.rules}\r\n  //       renderItem={renderItem}\r\n  //       keyExtractor={keyExtractor}\r\n  //       ListHeaderComponent={showPermaCast ? <PermaCastRow /> : undefined}\r\n  //       onDragEnd={(params) => {\r\n  //         stateRef.current.apply((state) => {\r\n  //           const strategy = getCurrentAutocastStrategy(state);\r\n  //           strategy.rules = params.data;\r\n  //           state.global.autocast.currentStrategy = strategy;\r\n  //           return state;\r\n  //         });\r\n  //       }}\r\n  //       ListEmptyComponent={\r\n  //         !showPermaCast ? (\r\n  //           <Markdown>\r\n  //             {t(\r\n  //               \"*You have no rules currently set for your Wizards! You can tell them to cast spells for you from the Spell menu (by expanding a spell's details) or from the Transmute screen.*\",\r\n  //             )}\r\n  //           </Markdown>\r\n  //         ) : undefined\r\n  //       }\r\n  //     ></DraggableFlatList>\r\n  //     // </ScrollView>\r\n  //   ),\r\n  //   [renderItem, keyExtractor, showPermaCast, JSON.stringify(strategy.rules)],\r\n  // );\r\n  return mainComponent;\r\n}\r\n\r\nexport default function Wizards(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const [slotNumber, setSlotNumber] = useState<string>(\r\n    state.global.autocast.lastStrategyIndex?.toString?.() ?? \"0\",\r\n  );\r\n\r\n  const loadoutAmount = 8;\r\n  const loadoutsSlotPicker = useMemo(() => {\r\n    const items = [];\r\n    for (let i = 0; i < loadoutAmount; i++) {\r\n      items.push({\r\n        key: i.toString(),\r\n        value: i.toString(),\r\n        label: t(\"Slot {{idx}}\", { idx: i + 1 }),\r\n      });\r\n    }\r\n    return (\r\n      <Picker\r\n        onValueChange={setSlotNumber}\r\n        selectedValue={slotNumber}\r\n        disablePlaceholder={true}\r\n        data={items}\r\n      />\r\n    );\r\n  }, [loadoutAmount, setSlotNumber, slotNumber]);\r\n\r\n  const loadoutObjects = state.global.autocast.savedStrategies;\r\n\r\n  const [loadoutName, setLoadoutName] = useState(\"\");\r\n\r\n  useEffect(\r\n    () =>\r\n      setLoadoutName(\r\n        slotNumber != null\r\n          ? loadoutObjects?.[Number.parseInt(slotNumber)]?.name ?? \"\"\r\n          : \"\",\r\n      ),\r\n    [slotNumber],\r\n  );\r\n\r\n  useEffect(() => {\r\n    setSlotNumber(state.global.autocast.lastStrategyIndex?.toString?.() ?? \"0\");\r\n  }, [state.global.autocast.lastStrategyIndex]);\r\n\r\n  const showHeader = hasEverHadFlag(state, Flag.AssignedWizard);\r\n\r\n  const headerComponent = useMemo(\r\n    () => (\r\n      <View style={Styles.ph4}>\r\n        <CategoryContainer title={t(\"Strategies\")}>\r\n          <View key=\"strat\" style={Styles.mt8}>\r\n            <View key=\"strat\">\r\n              <View style={Styles.flexRowAlignCenter}>\r\n                <View style={Styles.flex}>\r\n                  <Text>{t(\"Save:\")}</Text>\r\n                </View>\r\n                {loadoutsSlotPicker}\r\n              </View>\r\n              <View key=\"strat\" style={[Styles.flexRowAlignCenter, Styles.mt4]}>\r\n                <TextInput\r\n                  key=\"strat\"\r\n                  label={t(\"Strategy name\")}\r\n                  value={loadoutName}\r\n                  onChangeText={(text) => setLoadoutName(text)}\r\n                  mode=\"outlined\"\r\n                  dense={true}\r\n                  style={Styles.flex}\r\n                  maxLength={20}\r\n                />\r\n                <View style={[Styles.ml8, Styles.flexRowAlignCenter]}>\r\n                  <Button\r\n                    compact={true}\r\n                    onPress={() => {\r\n                      stateRef.current.apply((state) =>\r\n                        saveCurrentAutocastStrategy(\r\n                          state,\r\n                          loadoutName,\r\n                          Number.parseInt(slotNumber),\r\n                        ),\r\n                      );\r\n                    }}\r\n                  >\r\n                    {t(\"Save\")}\r\n                  </Button>\r\n                  <Button\r\n                    compact={true}\r\n                    style={Styles.ml4}\r\n                    onPress={() => {\r\n                      setLoadoutName(\"\");\r\n                      stateRef.current.apply((state) =>\r\n                        clearAutocastStrategy(\r\n                          state,\r\n                          Number.parseInt(slotNumber),\r\n                        ),\r\n                      );\r\n                    }}\r\n                  >\r\n                    {t(\"Clear\")}\r\n                  </Button>\r\n                </View>\r\n              </View>\r\n            </View>\r\n            <View style={Styles.mt8}>\r\n              <AutocastLoadoutLoadContainer />\r\n            </View>\r\n          </View>\r\n        </CategoryContainer>\r\n      </View>\r\n    ),\r\n    [slotNumber, loadoutName, setLoadoutName, loadoutsSlotPicker],\r\n  );\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.campusContainer}>\r\n        {showHeader && headerComponent}\r\n        <WizardsMainComponent />\r\n        <WizardsBottomComponent />\r\n      </View>\r\n    ),\r\n    [showHeader, headerComponent],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    width: \"100%\",\r\n  },\r\n  contentContainer: {\r\n    paddingVertical: 8,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  hintContents: {\r\n    marginLeft: 16,\r\n    marginTop: 8,\r\n    paddingRight: 32,\r\n  },\r\n  hintContentsText: {\r\n    fontStyle: \"italic\",\r\n  },\r\n  hintProgress: {\r\n    marginTop: 4,\r\n  },\r\n  loadoutsContainer: {\r\n    borderTopWidth: 1,\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 4,\r\n  },\r\n  categoryTitle: {\r\n    marginLeft: 8,\r\n  },\r\n  categoryContainer: {\r\n    paddingTop: 4,\r\n    marginBottom: 8,\r\n  },\r\n  campusContainer: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  campusHintWarning: {\r\n    marginTop: 16,\r\n  },\r\n  unfoldButton: { margin: 0, width: 20, height: 20 },\r\n});\r\n","import color from \"color\";\r\nimport * as Clipboard from \"expo-clipboard\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Platform, StyleSheet, View } from \"react-native\";\r\nimport { Card } from \"react-native-paper\";\r\nimport { formatMultiplier, formatNumber } from \"../utils/FormattingUtils\";\r\nimport { Card as UtilityCard } from \"./utility/Card\";\r\nimport { Markdown } from \"./utility/Markdown\";\r\nimport { Text } from \"./utility/Text\";\r\n\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../backend/GameState\";\r\nimport {\r\n  BASE_BOON_POINTS_PER_WORLD,\r\n  MAX_BOON_LEVEL,\r\n  getBlazingSpeedLevel,\r\n  getIncrementalPointsRequiredForLevel,\r\n  getMaxPossibleDifficultyLevel,\r\n  getNewBoonPointsAvailable,\r\n  getNewGamePlusAccuracyAndDodgeMultiplier,\r\n  getNewGamePlusAttackDelayMultiplier,\r\n  getNewGamePlusBoonPointsEarnedMultiplier,\r\n  getNewGamePlusChannelingAndSalePriceMultiplier,\r\n  getNewGamePlusElementMaxLevelBonus,\r\n  getNewGamePlusExpGainMultiplier,\r\n  getNewGamePlusFamiliarMaxLevelBonus,\r\n  getNewGamePlusHpMultiplier,\r\n  getNewGamePlusItemQualityMaxBonus,\r\n  getNewGamePlusLootMultiplier,\r\n  getNewGamePlusOtherStatMultiplier,\r\n  getNewGamePlusProductionMultiplier,\r\n  getNewGamePlusStorageMultiplier,\r\n  getPointsRequiredForConfiguration,\r\n  getSheerPowerLevel,\r\n  getStorylineOracleLevel,\r\n  getStorylinesToUnlockForSpecificOracleLevel,\r\n  getTotalAvailableBoonPoints,\r\n  getTotalPointsRequiredForLevel,\r\n  getWorldDifficultyLevel,\r\n  triggerNewGamePlus,\r\n} from \"../backend/NewGamePlus\";\r\nimport { serializeSaveData } from \"../backend/SaveData\";\r\nimport { FAMILIAR_LEVEL_CAP_BASE } from \"../backend/familiars/FamiliarClass\";\r\nimport { INITIAL_MAX_ITEM_QUALITY } from \"../backend/items/Item\";\r\nimport { ELEMENT_LEVEL_CAP_BASE } from \"../backend/spells/Elements\";\r\nimport { SAVE_TO_FILE_SUPPORTED, saveToFile } from \"../utils/FilesystemSave\";\r\nimport { t } from \"../utils/I18n\";\r\nimport { Button } from \"./utility/Button\";\r\nimport { PlusMinusAllocator } from \"./utility/PlusMinusAllocator\";\r\nimport Styles from \"./utility/Styles\";\r\nimport { VisibilityContext } from \"./utility/VisibilityContext\";\r\n\r\nconst SheerPowerDescription = React.memo((props: { level: number }) => {\r\n  const level = props.level;\r\n\r\n  const explanationBase = (\r\n    <Markdown>\r\n      {t(\r\n        `The Sheer Power Boon increases the limit of how strong you can be. It increases level and item quality caps and maximum Storage, as well as boosting production slightly across the board. At some point, if you hope to defeat ever more difficult foes, this Boon will be necessary.`,\r\n      )}\r\n    </Markdown>\r\n  );\r\n\r\n  if (level == 0) {\r\n    return (\r\n      <View>\r\n        <View>{explanationBase}</View>\r\n        <View>\r\n          <Markdown>\r\n            {t(`Your Sheer Power level will be 0. You will get no benefits.`)}\r\n          </Markdown>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  const elementMaxLevelBonus = getNewGamePlusElementMaxLevelBonus(level);\r\n  const familiarMaxLevelBonus = getNewGamePlusFamiliarMaxLevelBonus(level);\r\n  const itemQualityBonus = getNewGamePlusItemQualityMaxBonus(level);\r\n\r\n  return (\r\n    <View>\r\n      <View>{explanationBase}</View>\r\n      <View>\r\n        <Markdown>\r\n          {t(\r\n            `Your Sheer Power level will be {{level}}. You will get the following benefits:\r\n    \r\n* Your maximum Element level will become **{{maxElementLevel}}**;\r\n* Your maximum Familiar level will become **{{maxFamiliarLevel}}**;\r\n* The maximum item quality will become **+{{maxItemQuality}}**;\r\n* **{{storageMultiplier}}** bonus to all Storage maximums (except :mana: and :timepiece:);\r\n* **{{productionMultiplier}}** bonus to all Production`,\r\n            {\r\n              level: formatNumber(level),\r\n              maxElementLevel: formatNumber(\r\n                ELEMENT_LEVEL_CAP_BASE + elementMaxLevelBonus,\r\n              ),\r\n              maxFamiliarLevel: formatNumber(\r\n                FAMILIAR_LEVEL_CAP_BASE + familiarMaxLevelBonus,\r\n              ),\r\n              maxItemQuality: formatNumber(\r\n                INITIAL_MAX_ITEM_QUALITY + itemQualityBonus,\r\n              ),\r\n              storageMultiplier: formatMultiplier(\r\n                getNewGamePlusStorageMultiplier(level),\r\n              ),\r\n              productionMultiplier: formatMultiplier(\r\n                getNewGamePlusProductionMultiplier(level),\r\n              ),\r\n            },\r\n          )}\r\n        </Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n});\r\n\r\nconst StorylineOracleDescription = React.memo((props: { level: number }) => {\r\n  const level = props.level;\r\n\r\n  const explanationBase = (\r\n    <Markdown>\r\n      {t(\r\n        `The Storyline Oracle Boon lets you manifest bonuses from Storylines that might originally have happened in the future, immediately at the beginning - effectively having a large impact in the early game. Obtain powerful bonuses without the need to progress throughout most of the game to unlock them!`,\r\n      )}\r\n    </Markdown>\r\n  );\r\n\r\n  if (level == 0) {\r\n    return (\r\n      <View>\r\n        <View>{explanationBase}</View>\r\n        <View>\r\n          <Markdown>\r\n            {t(\r\n              `Your Storyline Oracle level will be 0. You will get no benefits.`,\r\n            )}\r\n          </Markdown>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  if (level == 10) {\r\n    return (\r\n      <View>\r\n        <View>{explanationBase}</View>\r\n        <View>\r\n          <Markdown>\r\n            {t(\r\n              `Your Storyline Oracle level will be 10. This means **you will start with all Storylines, except endings and Challenges, already completed!**`,\r\n            )}\r\n          </Markdown>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  const storylineBonusesLines = [];\r\n  for (let i = 1; i <= level; i++) {\r\n    const storylines = getStorylinesToUnlockForSpecificOracleLevel(i);\r\n    const storylineText = storylines\r\n      .map((storyline) => storyline.getName())\r\n      .join(t(\", \"));\r\n    storylineBonusesLines.push(\r\n      t(`* Storyline Oracle level {{i}}: **{{storylineText}}**`, {\r\n        i: formatNumber(i),\r\n        storylineText,\r\n      }),\r\n    );\r\n  }\r\n  const storylineBonusesText = storylineBonusesLines.join(t(\"\\n\"));\r\n\r\n  return (\r\n    <View>\r\n      <View>{explanationBase}</View>\r\n      <View>\r\n        <Markdown>\r\n          {t(\r\n            `Your Storyline Oracle level will be {{level}}. This means you will begin the new World with the following Storylines already completed and their bonus active:\r\n      \r\n{{storylineBonusesText}}`,\r\n            { level: formatNumber(level), storylineBonusesText },\r\n          )}\r\n        </Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n});\r\n\r\nconst BlazingSpeedDescription = React.memo((props: { level: number }) => {\r\n  const level = props.level;\r\n\r\n  const explanationBase = (\r\n    <Markdown>\r\n      {t(\r\n        `The Blazing Speed Boon generally increases how fast you can make progress throughout the game. It affects exp and loot gain, as well as Channeling efficiency and item sale prices. This Boon can help make progress through a World significantly shorter.`,\r\n      )}\r\n    </Markdown>\r\n  );\r\n\r\n  if (level == 0) {\r\n    return (\r\n      <View>\r\n        <View>{explanationBase}</View>\r\n        <View>\r\n          <Markdown>\r\n            {t(`Your Blazing Speed level will be 0. You will get no benefits.`)}\r\n          </Markdown>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <View>\r\n      <View>{explanationBase}</View>\r\n      <View>\r\n        <Markdown>\r\n          {t(\r\n            `Your Blazing Speed level will be {{level}}. You will get the following benefits:\r\n    \r\n* **{{expMultiplier}}** bonus to Element and Familiar exp gain;\r\n* **{{channelingMultiplier}}** bonus to Channeling efficiency and item sale prices;\r\n* **{{lootMultiplier}}** bonus to :coins: and :monstium: obtained from enemies, as well as to the chance of looting items.`,\r\n            {\r\n              level: formatNumber(level),\r\n              expMultiplier: formatMultiplier(\r\n                getNewGamePlusExpGainMultiplier(level),\r\n              ),\r\n              channelingMultiplier: formatMultiplier(\r\n                getNewGamePlusChannelingAndSalePriceMultiplier(level),\r\n              ),\r\n              lootMultiplier: formatMultiplier(\r\n                getNewGamePlusLootMultiplier(level),\r\n              ),\r\n            },\r\n          )}\r\n        </Markdown>\r\n      </View>\r\n    </View>\r\n  );\r\n});\r\n\r\nconst WorldDifficultyDescription = React.memo((props: { level: number }) => {\r\n  const state = useContext(StateContext);\r\n  const level = props.level;\r\n\r\n  if (level == 0) {\r\n    return (\r\n      <View>\r\n        <Markdown>\r\n          {t(\r\n            `Your World Difficulty level will be 0. It will be exactly the same as the first time you played through the game.`,\r\n          )}\r\n        </Markdown>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <View>\r\n      <Markdown>\r\n        {t(\r\n          `Your World Difficulty level will be {{level}}.{{ultimateChallengeText}} Enemies will have the following bonuses:\r\n    \r\n* **{{hpMultiplier}}** bonus to Max:hp:;\r\n* **{{attackMultiplier}}** bonus to :attack: and :defense:;\r\n* **{{attackDelayMultiplier}}** bonus to :attackDelay:;\r\n* **{{accuracyMultiplier}}** bonus to :accuracy: and :dodge:.\r\n\r\nHowever, if you manage to clear the World, you will get a **{{boonPointMultiplier}}** bonus to the amount of Boon Points you will earn. This means you will get **{{boonPoints}}** Boon Points if you reach the ending \"To Save a Life\", and **{{doubleBoonPoints}}** Boon Points if you complete the Universal Challenge and reach the ending \"Transcend Humanity\".{{penUltimateChallengeRewardText}}`,\r\n          {\r\n            level: formatNumber(level),\r\n            hpMultiplier: formatMultiplier(getNewGamePlusHpMultiplier(level)),\r\n            attackMultiplier: formatMultiplier(\r\n              getNewGamePlusOtherStatMultiplier(level),\r\n            ),\r\n            attackDelayMultiplier: formatMultiplier(\r\n              getNewGamePlusAttackDelayMultiplier(level),\r\n            ),\r\n            accuracyMultiplier: formatMultiplier(\r\n              getNewGamePlusAccuracyAndDodgeMultiplier(level),\r\n            ),\r\n            boonPointMultiplier: formatMultiplier(\r\n              getNewGamePlusBoonPointsEarnedMultiplier(level),\r\n            ),\r\n            boonPoints: formatNumber(\r\n              getNewGamePlusBoonPointsEarnedMultiplier(level) *\r\n                BASE_BOON_POINTS_PER_WORLD,\r\n            ),\r\n            doubleBoonPoints: formatNumber(\r\n              getNewGamePlusBoonPointsEarnedMultiplier(level) *\r\n                BASE_BOON_POINTS_PER_WORLD *\r\n                2,\r\n            ),\r\n            ultimateChallengeText:\r\n              level > 10 ? t(\" **This is the maximum World Difficulty!**\") : \"\",\r\n            penUltimateChallengeRewardText:\r\n              level == 10 && getMaxPossibleDifficultyLevel(state) == 10\r\n                ? t(\r\n                    \" **And if you clear the World, you may unlock something special...**\",\r\n                  )\r\n                : \"\",\r\n          },\r\n        )}\r\n      </Markdown>\r\n    </View>\r\n  );\r\n});\r\n\r\nfunction BoonRow(props: {\r\n  level: number;\r\n  title: string;\r\n  decreasingPossible: boolean;\r\n  increasingPossible: boolean;\r\n  onPressMinus: () => void;\r\n  onPressPlus: () => void;\r\n}) {\r\n  return (\r\n    <View style={Styles.flexRowAlignCenter}>\r\n      <View style={Styles.flex}>\r\n        <Text style={Styles.bold}>{props.title}</Text>\r\n        <Text>\r\n          {props.level >= MAX_BOON_LEVEL\r\n            ? t(\"Next level: -\")\r\n            : t(\"Next level: {{points}} pts\", {\r\n                points: formatNumber(\r\n                  getIncrementalPointsRequiredForLevel(props.level + 1),\r\n                ),\r\n              })}\r\n        </Text>\r\n      </View>\r\n      <View style={Styles.flexRowAlignCenter}>\r\n        <Text>\r\n          {t(`Lv{{level}} ({{points}} pts)`, {\r\n            level: formatNumber(props.level),\r\n            points: formatNumber(getTotalPointsRequiredForLevel(props.level)),\r\n          })}\r\n        </Text>\r\n        <View style={Styles.ml16}>\r\n          <PlusMinusAllocator\r\n            disableMinus={!props.decreasingPossible}\r\n            disablePlus={!props.increasingPossible}\r\n            onPressMinus={props.onPressMinus}\r\n            onPressPlus={props.onPressPlus}\r\n          />\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction useBoonManipulation(level, remainingPoints, setLevel) {\r\n  const decreasingPossible = level > 0;\r\n  const increasingPossible =\r\n    level < MAX_BOON_LEVEL &&\r\n    remainingPoints >= getIncrementalPointsRequiredForLevel(level + 1);\r\n\r\n  const onPressMinus = useCallback(() => {\r\n    if (decreasingPossible) {\r\n      setLevel(level - 1);\r\n    }\r\n  }, [level, setLevel, decreasingPossible]);\r\n  const onPressPlus = useCallback(() => {\r\n    if (increasingPossible) {\r\n      setLevel(level + 1);\r\n    }\r\n  }, [level, setLevel, increasingPossible]);\r\n\r\n  return { decreasingPossible, increasingPossible, onPressMinus, onPressPlus };\r\n}\r\n\r\nexport default function Worlds() {\r\n  const state = useContext(StateContext);\r\n  const theme = useTheme();\r\n\r\n  const totalPointsAvailable = getTotalAvailableBoonPoints(state);\r\n  const newBoonPointsAvailable = getNewBoonPointsAvailable(state);\r\n  const maxDifficultyLevel = getMaxPossibleDifficultyLevel(state);\r\n\r\n  const [sheerPower, setSheerPower] = useState(getSheerPowerLevel(state));\r\n  const [storylineOracle, setStorylineOracle] = useState(\r\n    getStorylineOracleLevel(state),\r\n  );\r\n  const [blazingSpeed, setBlazingSpeed] = useState(getBlazingSpeedLevel(state));\r\n  const [worldDifficulty, setWorldDifficulty] = useState(\r\n    getWorldDifficultyLevel(state),\r\n  );\r\n\r\n  const pointsRequiredForConfig = getPointsRequiredForConfiguration(\r\n    sheerPower,\r\n    storylineOracle,\r\n    blazingSpeed,\r\n  );\r\n  const remainingPoints = totalPointsAvailable - pointsRequiredForConfig;\r\n\r\n  const topMessage =\r\n    t(`You now possess the ability to travel to other Worlds! You feel like, perhaps, you'd like a do-over of your grand adventure, but this time, in another World, a slightly different one. All the possibilities are laid bare before you...\r\n  \r\nBy traveling a new world, **you will start over the game from the very beginning, and will forfeit everything:**\r\n\r\n* Unlocked elements and Storylines will generally **not** carry over;\r\n* Your MPL values, as well as your global element exp, production and loot multipliers, will **not** carry over.\r\n\r\nHowever, you will continue having access to the Worlds screen - you will not need to unlock it again.`);\r\n\r\n  const noContentWarning = (\r\n    <Text style={[styles.error, { color: theme.colors.error }]}>\r\n      {t(\r\n        \"Traveling to a different World does not unlock any new content! It is only meant as a way to experience the game again.\",\r\n      )}\r\n    </Text>\r\n  );\r\n\r\n  const explanationForBoonsMessage = t(\r\n    `Your prowess as a World traveler has granted you a total of **{{totalPointsAvailable}}** (**+{{newPointsAvailable}}**) Boon Points. You can use Boon Points to obtain powerful advantages across three different categories in the next World. Your Boon Points accumulate through Worlds, and you can reallocate them whenever traveling to a new World.`,\r\n    {\r\n      totalPointsAvailable: formatNumber(totalPointsAvailable),\r\n      newPointsAvailable: formatNumber(newBoonPointsAvailable),\r\n    },\r\n  );\r\n\r\n  const sheerPowerManipulation = useBoonManipulation(\r\n    sheerPower,\r\n    remainingPoints,\r\n    setSheerPower,\r\n  );\r\n  const storylineOracleManipulation = useBoonManipulation(\r\n    storylineOracle,\r\n    remainingPoints,\r\n    setStorylineOracle,\r\n  );\r\n  const blazingSpeedManipulation = useBoonManipulation(\r\n    blazingSpeed,\r\n    remainingPoints,\r\n    setBlazingSpeed,\r\n  );\r\n\r\n  const difficultyExplanation = (\r\n    <Markdown>\r\n      {t(\r\n        `Perhaps the adventure was too easy? For your next adventure, you can search for a World that is more difficult. They say that the higher the challenge, naturally, the higher the reward...\r\n        \r\nThe maximum World Difficulty you can access is {{maxDifficulty}}.{{clearText}}`,\r\n        {\r\n          maxDifficulty: getMaxPossibleDifficultyLevel(state),\r\n          clearText:\r\n            getMaxPossibleDifficultyLevel(state) < 10\r\n              ? t(\r\n                  ' You can access higher difficulties by traveling to a new World and reaching the ending \"To Save a Life\".',\r\n                )\r\n              : \"\",\r\n        },\r\n      )}\r\n    </Markdown>\r\n  );\r\n\r\n  const onPressDifficultyMinus = useCallback(() => {\r\n    if (worldDifficulty > 0) {\r\n      setWorldDifficulty(worldDifficulty - 1);\r\n    }\r\n  }, [worldDifficulty, setWorldDifficulty]);\r\n  const onPressDifficultyPlus = useCallback(() => {\r\n    if (worldDifficulty <= maxDifficultyLevel) {\r\n      setWorldDifficulty(worldDifficulty + 1);\r\n    }\r\n  }, [worldDifficulty, setWorldDifficulty, maxDifficultyLevel]);\r\n\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const [hasExportedGame, setHasExportedGame] = useState(false);\r\n  const visible = useContext(VisibilityContext);\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setHasExportedGame(false);\r\n    }\r\n  }, [visible]);\r\n\r\n  const [copyToClipboardError, setCopyToClipboardError] = useState(null);\r\n\r\n  const copyToClipboard = useCallback(async () => {\r\n    const serializedData = await serializeSaveData(stateRef.current);\r\n    await Clipboard.setStringAsync(serializedData);\r\n\r\n    if (Platform.OS == \"android\" || Platform.OS == \"ios\") {\r\n      const savedData = await Clipboard.getStringAsync();\r\n      if (savedData != serializedData) {\r\n        setCopyToClipboardError(\r\n          t(\"Warning: save did not copy to clipboard correctly!\"),\r\n        );\r\n        return;\r\n      }\r\n    }\r\n\r\n    setHasExportedGame(true);\r\n    setCopyToClipboardError(null);\r\n  }, [setHasExportedGame]);\r\n\r\n  const saveToFileCallback = useCallback(async () => {\r\n    const result = await saveToFile(stateRef.current);\r\n    setHasExportedGame(true);\r\n  }, [setHasExportedGame]);\r\n\r\n  const saveFileCategory = useMemo(\r\n    () => (\r\n      <View>\r\n        <View>\r\n          <Text>\r\n            {t(\r\n              \"Since traveling to a new World is irreversible, you will need to export your save data first before being able to use your ability.\",\r\n            )}\r\n          </Text>\r\n        </View>\r\n        <View style={Styles.mt8}>\r\n          <Button onPress={copyToClipboard}>\r\n            {t(\"Copy savefile to clipboard\")}\r\n          </Button>\r\n        </View>\r\n        {SAVE_TO_FILE_SUPPORTED && (\r\n          <View style={Styles.mt4}>\r\n            <Button onPress={saveToFileCallback}>{t(\"Save to File\")}</Button>\r\n          </View>\r\n        )}\r\n        {copyToClipboardError != null && (\r\n          <View style={Styles.mt8}>\r\n            <Text style={{ color: theme.colors.error }}>\r\n              {copyToClipboardError}\r\n            </Text>\r\n          </View>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      copyToClipboard,\r\n      SAVE_TO_FILE_SUPPORTED,\r\n      saveToFileCallback,\r\n      copyToClipboardError,\r\n      theme,\r\n    ],\r\n  );\r\n\r\n  const doNewGamePlus = useCallback(() => {\r\n    stateRef.current.apply((state) => {\r\n      return triggerNewGamePlus(\r\n        state,\r\n        sheerPower,\r\n        storylineOracle,\r\n        blazingSpeed,\r\n        worldDifficulty,\r\n      );\r\n    });\r\n  }, [sheerPower, storylineOracle, blazingSpeed, worldDifficulty]);\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text h1>{t(\"Worlds\")}</Text>\r\n      <View style={Styles.mt16}>\r\n        <Markdown>{topMessage}</Markdown>\r\n        {noContentWarning}\r\n      </View>\r\n      <UtilityCard style={Styles.mt16}>\r\n        <Card.Title title={t(\"Boons\")} />\r\n        <Card.Content>\r\n          <Markdown>{explanationForBoonsMessage}</Markdown>\r\n          <View\r\n            style={[\r\n              Styles.mt16,\r\n              Styles.p8,\r\n              { backgroundColor: color(theme.colors.primary).alpha(0.1) },\r\n            ]}\r\n          >\r\n            <BoonRow\r\n              decreasingPossible={sheerPowerManipulation.decreasingPossible}\r\n              increasingPossible={sheerPowerManipulation.increasingPossible}\r\n              level={sheerPower}\r\n              title={t(\"Sheer Power\")}\r\n              onPressMinus={sheerPowerManipulation.onPressMinus}\r\n              onPressPlus={sheerPowerManipulation.onPressPlus}\r\n            />\r\n            <View style={Styles.mt8}>\r\n              <SheerPowerDescription level={sheerPower} />\r\n            </View>\r\n          </View>\r\n          <View style={Styles.p8}>\r\n            <BoonRow\r\n              decreasingPossible={\r\n                storylineOracleManipulation.decreasingPossible\r\n              }\r\n              increasingPossible={\r\n                storylineOracleManipulation.increasingPossible\r\n              }\r\n              level={storylineOracle}\r\n              title={t(\"Storyline Oracle\")}\r\n              onPressMinus={storylineOracleManipulation.onPressMinus}\r\n              onPressPlus={storylineOracleManipulation.onPressPlus}\r\n            />\r\n            <View style={Styles.mt8}>\r\n              <StorylineOracleDescription level={storylineOracle} />\r\n            </View>\r\n          </View>\r\n          <View\r\n            style={[\r\n              Styles.p8,\r\n              { backgroundColor: color(theme.colors.primary).alpha(0.1) },\r\n            ]}\r\n          >\r\n            <BoonRow\r\n              decreasingPossible={blazingSpeedManipulation.decreasingPossible}\r\n              increasingPossible={blazingSpeedManipulation.increasingPossible}\r\n              level={blazingSpeed}\r\n              title={t(\"Blazing Speed\")}\r\n              onPressMinus={blazingSpeedManipulation.onPressMinus}\r\n              onPressPlus={blazingSpeedManipulation.onPressPlus}\r\n            />\r\n            <View style={Styles.mt8}>\r\n              <BlazingSpeedDescription level={blazingSpeed} />\r\n            </View>\r\n          </View>\r\n        </Card.Content>\r\n      </UtilityCard>\r\n      <UtilityCard style={Styles.mt16}>\r\n        <Card.Title title={t(\"Difficulty\")} />\r\n        <Card.Content>\r\n          {difficultyExplanation}\r\n          <View style={Styles.mt16}>\r\n            <View style={Styles.flexRowAlignCenter}>\r\n              <View style={Styles.flex}>\r\n                <Text style={Styles.bold}>{t(\"World Difficulty\")}</Text>\r\n              </View>\r\n              <View style={Styles.flexRowAlignCenter}>\r\n                <Text>\r\n                  {t(`Lv{{level}}`, {\r\n                    level: formatNumber(worldDifficulty),\r\n                  })}\r\n                </Text>\r\n                <View style={Styles.ml16}>\r\n                  <PlusMinusAllocator\r\n                    disableMinus={worldDifficulty <= 0}\r\n                    disablePlus={worldDifficulty >= maxDifficultyLevel}\r\n                    onPressMinus={onPressDifficultyMinus}\r\n                    onPressPlus={onPressDifficultyPlus}\r\n                  />\r\n                </View>\r\n              </View>\r\n            </View>\r\n            <View style={Styles.mt8}>\r\n              <WorldDifficultyDescription level={worldDifficulty} />\r\n            </View>\r\n          </View>\r\n        </Card.Content>\r\n      </UtilityCard>\r\n      <View style={Styles.mt16}>{saveFileCategory}</View>\r\n      <View style={Styles.mt16}>\r\n        <Button\r\n          buttonColor={theme.colors.errorContainer}\r\n          textColor={theme.colors.onErrorContainer}\r\n          onPress={doNewGamePlus}\r\n          disabled={!hasExportedGame}\r\n        >\r\n          {t(\"Travel to a new World\")}\r\n        </Button>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"stretch\",\r\n    justifyContent: \"flex-start\",\r\n    width: \"100%\",\r\n  },\r\n  explanation: {\r\n    marginTop: 16,\r\n  },\r\n  buttonContainer: {\r\n    marginTop: 16,\r\n  },\r\n  warning: {\r\n    marginTop: 8,\r\n  },\r\n  error: {\r\n    fontWeight: \"bold\",\r\n  },\r\n});\r\n","import { EvilIcons, MaterialIcons } from \"@expo/vector-icons\";\r\nimport moment from \"moment\";\r\nimport React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport { FlatList, StyleSheet, View } from \"react-native\";\r\nimport { List, useTheme } from \"react-native-paper\";\r\nimport { INITIAL_STATE, StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  EventOccurrenceData,\r\n  addOccurrenceToQueue,\r\n  getEventMessageById,\r\n} from \"../../backend/events/Events\";\r\nimport { clone } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { useAuxOptions } from \"../utility/AuxOptionsContext\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport Divider from \"../utility/Divider\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { Text } from \"../utility/Text\";\r\n\r\nconst INITIAL_STATE_CLONED = clone(INITIAL_STATE);\r\n\r\nfunction EventListItem(props: {\r\n  item: EventOccurrenceData;\r\n  onPress: () => void;\r\n}) {\r\n  if (!props.item.currentMessageId) {\r\n    return null;\r\n  }\r\n  const currentMessageData = getEventMessageById(props.item.currentMessageId);\r\n  if (!currentMessageData) {\r\n    return null;\r\n  }\r\n  const title = currentMessageData.getTitle(props.item?.params);\r\n  const state = useContext(StateContext);\r\n  const description = useMemo(\r\n    () =>\r\n      moment(props.item.timestamp).format(\"h:mm A\") +\r\n      \" - \" +\r\n      currentMessageData.getDescription(\r\n        INITIAL_STATE_CLONED,\r\n        props.item?.params,\r\n      ),\r\n    [props.item.timestamp],\r\n  );\r\n  const theme = useTheme();\r\n  const auxOptions = useAuxOptions();\r\n  return useMemo(() => {\r\n    return (\r\n      <View>\r\n        <List.Item\r\n          onPress={props.onPress}\r\n          accessible={true}\r\n          accessibilityLabel={title}\r\n          accessibilityRole=\"button\"\r\n          title={title}\r\n          description={description}\r\n          descriptionNumberOfLines={1}\r\n          style={auxOptions.compactLayout && { paddingVertical: 0 }}\r\n          left={() =>\r\n            currentMessageData.isActionable(state, props.item?.params) && (\r\n              <View style={[Styles.ml16, Styles.flexCenter]}>\r\n                <EvilIcons\r\n                  name=\"exclamation\"\r\n                  type=\"evilicon\"\r\n                  size={24}\r\n                  style={{ height: 24 }}\r\n                  color={theme.colors.onBackground}\r\n                />\r\n              </View>\r\n            )\r\n          }\r\n          right={() => (\r\n            <List.Icon\r\n              icon={currentMessageData.isTerminal() ? \"check\" : \"chevron-right\"}\r\n            />\r\n          )}\r\n        />\r\n        <Divider />\r\n      </View>\r\n    );\r\n  }, [\r\n    title,\r\n    description,\r\n    currentMessageData.isTerminal(),\r\n    currentMessageData.isActionable(state, props.item?.params),\r\n    theme,\r\n    auxOptions.compactLayout,\r\n  ]);\r\n}\r\n\r\nconst EventListItemMemoized = React.memo(\r\n  EventListItem,\r\n  (prevProps, nextProps) => {\r\n    return prevProps.item.currentMessageId === nextProps.item.currentMessageId;\r\n  },\r\n);\r\n\r\nexport function EventList(props: { style?: any }) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const keyExtractor = useCallback(\r\n    (item: EventOccurrenceData, index: number) => item.eventOccurrenceId,\r\n    [],\r\n  );\r\n\r\n  const renderItem = useCallback((props: any) => {\r\n    const onPress = () => {\r\n      stateRef.current.apply(\r\n        addOccurrenceToQueue(props.item.eventOccurrenceId),\r\n      );\r\n    };\r\n    return <EventListItemMemoized {...props} onPress={onPress} />;\r\n  }, []);\r\n\r\n  const sortedEvents = Object.values(state.run.eventOccurrences).sort(\r\n    (a, b) => b.timestamp - a.timestamp,\r\n  );\r\n\r\n  const stringifiedEvents = useMemo(\r\n    () => JSON.stringify(state.run.eventOccurrences),\r\n    [sortedEvents],\r\n  );\r\n\r\n  const terminalEvents = useMemo(\r\n    () =>\r\n      sortedEvents\r\n        .filter((event) => {\r\n          return (\r\n            event.currentMessageId &&\r\n            getEventMessageById(event.currentMessageId).isTerminal()\r\n          );\r\n        })\r\n        .slice(0, 20),\r\n    [stringifiedEvents],\r\n  );\r\n  const ongoingEvents = useMemo(\r\n    () =>\r\n      sortedEvents.filter((event) => {\r\n        return (\r\n          event.currentMessageId &&\r\n          !getEventMessageById(event.currentMessageId).isTerminal()\r\n        );\r\n      }),\r\n    [stringifiedEvents],\r\n  );\r\n\r\n  const eventCategories = useMemo(() => {\r\n    const eventCategories: { title: string; data: EventOccurrenceData[] }[] =\r\n      [];\r\n    if (ongoingEvents.length > 0) {\r\n      eventCategories.push({ title: t(\"Ongoing\"), data: ongoingEvents });\r\n    }\r\n    if (terminalEvents.length > 0) {\r\n      eventCategories.push({ title: t(\"Finished\"), data: terminalEvents });\r\n    }\r\n    return eventCategories;\r\n  }, [ongoingEvents, terminalEvents]);\r\n\r\n  const categoryKeyExtractor = useCallback(\r\n    (item: { title: string; data: EventOccurrenceData[] }, index: number) =>\r\n      item.title,\r\n    [],\r\n  );\r\n\r\n  const categoryRenderItem = useCallback(\r\n    (props: any) => {\r\n      return (\r\n        <CategoryContainer\r\n          titleStyle={styles.categoryTitle}\r\n          title={props.item.title}\r\n        >\r\n          <FlatList\r\n            keyExtractor={keyExtractor}\r\n            data={props.item.data}\r\n            renderItem={renderItem}\r\n          />\r\n        </CategoryContainer>\r\n      );\r\n    },\r\n    [keyExtractor, renderItem],\r\n  );\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          { backgroundColor: theme.colors.background },\r\n          Styles.flex,\r\n          props.style,\r\n        ]}\r\n      >\r\n        <View\r\n          accessible={true}\r\n          accessibilityLabel={t(\"Events\")}\r\n          accessibilityRole=\"header\"\r\n          style={styles.emptyTitleContainer}\r\n        >\r\n          <MaterialIcons\r\n            size={24}\r\n            name=\"notifications\"\r\n            style={styles.titleIcon}\r\n            color={theme.colors.onBackground}\r\n          />\r\n          <Text h2>{t(\"Events\")}</Text>\r\n        </View>\r\n        <FlatList\r\n          keyExtractor={categoryKeyExtractor}\r\n          data={eventCategories}\r\n          renderItem={categoryRenderItem}\r\n          style={Styles.flex}\r\n        />\r\n      </View>\r\n    ),\r\n    [theme, categoryKeyExtractor, categoryRenderItem, eventCategories],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  categoryTitle: {\r\n    marginLeft: 8,\r\n  },\r\n  emptyTitleContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    marginTop: 8,\r\n  },\r\n  titleIcon: {\r\n    paddingRight: 8,\r\n    height: 28,\r\n  },\r\n  eventTitleContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  titleText: {\r\n    flex: 1,\r\n  },\r\n  actionableIcon: {\r\n    marginRight: 4,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport {\r\n  ScrollView,\r\n  StyleSheet,\r\n  View,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\nimport { Modal, useTheme } from \"react-native-paper\";\r\nimport { GameState, StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  addGameStateListener,\r\n  clearGameStateListener,\r\n} from \"../../backend/GameStateListeners\";\r\nimport { getUICommands } from \"../../backend/UICommands\";\r\nimport {\r\n  EventOccurrenceData,\r\n  executeEventOccurrenceAction,\r\n  getEventMessageById,\r\n  getEventOccurrenceById,\r\n  removeOccurrenceFromQueue,\r\n} from \"../../backend/events/Events\";\r\nimport { EventMessage } from \"../../backend/events/GameEvent\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport { IconButton } from \"../utility/IconButton\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport { disabledColorByTheme } from \"../utility/Miscellaneous\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { UIContext, useUIStateFromContext } from \"../utility/UIContext\";\r\n\r\nexport function EventOverlay() {\r\n  const state = useContext(StateContext);\r\n  const uiContext = useContext(UIContext);\r\n  const isPickerOpen = uiContext.getUIState(\"picker_open\");\r\n  const isEndingOpen = uiContext\r\n    .getUIState(\"active_sections\")\r\n    ?.includes(\"Ending\");\r\n  const [currentEventOccurrenceId, setCurrentEventOccurrenceId] =\r\n    useUIStateFromContext(\r\n      uiContext,\r\n      \"current_event_occurrence_id\",\r\n      undefined as string | undefined,\r\n    );\r\n\r\n  const processUICommand = useCallback((uiCommand: string) => {\r\n    if (uiCommand == \"closeEventOverlay\") {\r\n      setCurrentEventOccurrenceId(undefined);\r\n      setCurrentLookbackMessageId(\"\");\r\n    }\r\n  }, []);\r\n\r\n  const processUICommands = useCallback((state: GameState) => {\r\n    const uiCommands = getUICommands(state);\r\n    uiCommands.forEach(processUICommand);\r\n    state.run.uiCommands = uiCommands.filter(\r\n      (uiCommand) => uiCommand != \"closeEventOverlay\",\r\n    );\r\n    return state;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    addGameStateListener(\"eventOverlayUiCommand\", (newState) => {\r\n      const uiCommands = getUICommands(newState);\r\n      if (\r\n        uiCommands.filter((command) => command === \"closeEventOverlay\").length >\r\n        0\r\n      ) {\r\n        return (state) => processUICommands(state);\r\n      }\r\n    });\r\n    return () => clearGameStateListener(\"eventOverlayUiCommand\");\r\n  }, []);\r\n\r\n  const currentEventOccurrenceIdRef = useRef(currentEventOccurrenceId);\r\n  currentEventOccurrenceIdRef.current = currentEventOccurrenceId;\r\n\r\n  const [currentLookbackMessageId, setCurrentLookbackMessageId] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    addGameStateListener(\"event_overlay\", (newState) => {\r\n      if (isPickerOpen || isEndingOpen) {\r\n        return;\r\n      }\r\n      if (\r\n        newState.run.eventQueue.length > 0 &&\r\n        (!currentEventOccurrenceIdRef.current ||\r\n          getEventOccurrenceById(\r\n            newState,\r\n            currentEventOccurrenceIdRef.current,\r\n          ) == null)\r\n      ) {\r\n        // Get a new event\r\n        let newEventOccurrenceId: string | null | undefined = null;\r\n        const eventsToRemoveFromQueue: string[] = [];\r\n\r\n        do {\r\n          newEventOccurrenceId = newState.run.eventQueue.pop();\r\n          if (newEventOccurrenceId != null) {\r\n            eventsToRemoveFromQueue.push(newEventOccurrenceId);\r\n            const occurrence = getEventOccurrenceById(\r\n              newState,\r\n              newEventOccurrenceId,\r\n            );\r\n            const message = occurrence?.currentMessageId;\r\n            if (occurrence != null && message != null) {\r\n              if (\r\n                (occurrence?.timestampSecondsPlayed ?? 0) <= 0.1 &&\r\n                getEventMessageById(message)?.isTerminal()\r\n              ) {\r\n                newEventOccurrenceId = null;\r\n              }\r\n            }\r\n          }\r\n        } while (\r\n          newState.run.eventQueue.length > 0 &&\r\n          newEventOccurrenceId == null\r\n        );\r\n\r\n        if (newEventOccurrenceId) {\r\n          setCurrentEventOccurrenceId(newEventOccurrenceId);\r\n          setCurrentLookbackMessageId(\"\");\r\n\r\n          // This next line is required because otherwise, if many events are\r\n          // in the queue before the next rerender, we will swallow them\r\n          currentEventOccurrenceIdRef.current = newEventOccurrenceId;\r\n        }\r\n\r\n        return (state) =>\r\n          eventsToRemoveFromQueue.reduce(\r\n            (accumulatedState, eventToRemove) =>\r\n              removeOccurrenceFromQueue(eventToRemove)(accumulatedState),\r\n            state,\r\n          );\r\n      }\r\n    });\r\n    return () => clearGameStateListener(\"event_overlay\");\r\n  }, [isPickerOpen, isEndingOpen]);\r\n\r\n  let eventOccurrence: EventOccurrenceData | null | undefined = null,\r\n    eventMessage: EventMessage | null | undefined = null,\r\n    optionDescriptions: string[] | null = null,\r\n    totalText: string | null = null,\r\n    messageInLookbackIdx: number = -1,\r\n    messageLength: number = 0,\r\n    totalMessageCount: number = -1;\r\n  if (currentEventOccurrenceId != null) {\r\n    eventOccurrence = getEventOccurrenceById(state, currentEventOccurrenceId);\r\n    messageInLookbackIdx =\r\n      eventOccurrence?.messageHistory?.findIndex(\r\n        (value) => value === currentLookbackMessageId,\r\n      ) ?? -1;\r\n    if (messageInLookbackIdx < 0) {\r\n      eventMessage = (eventOccurrence?.currentMessageId &&\r\n        getEventMessageById(eventOccurrence.currentMessageId)) as EventMessage;\r\n    } else {\r\n      eventMessage = getEventMessageById(\r\n        currentLookbackMessageId as string,\r\n      ) as EventMessage;\r\n    }\r\n    if (eventMessage) {\r\n      optionDescriptions = eventMessage\r\n        .getAllowedOptions(state, eventOccurrence?.params)\r\n        .map((option) => option.description + option.isEnabled);\r\n    }\r\n    messageLength = eventOccurrence?.messageHistory?.length ?? 0;\r\n    if (messageLength > 0) {\r\n      totalMessageCount = messageLength + 1;\r\n      const idxToDisplay =\r\n        messageInLookbackIdx >= 0\r\n          ? messageInLookbackIdx + 1\r\n          : totalMessageCount;\r\n      if (idxToDisplay < totalMessageCount) {\r\n        totalText = `(${idxToDisplay}/${totalMessageCount})`;\r\n      }\r\n    }\r\n  }\r\n\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  const theme = useTheme();\r\n\r\n  const disabledIconColor = disabledColorByTheme(theme);\r\n\r\n  return useMemo(() => {\r\n    if (currentEventOccurrenceId && eventMessage) {\r\n      const disableBackArrow =\r\n        messageInLookbackIdx === 0 || messageLength === 0;\r\n      const disableForwardArrow =\r\n        messageInLookbackIdx < 0 ||\r\n        messageInLookbackIdx > totalMessageCount - 2;\r\n      return (\r\n        <Modal\r\n          visible={true}\r\n          dismissable={false}\r\n          contentContainerStyle={[\r\n            styles.overlay,\r\n            {\r\n              maxWidth: Math.min(width - 16, 640),\r\n              maxHeight: height - 64,\r\n              backgroundColor: theme.colors.background,\r\n            },\r\n          ]}\r\n        >\r\n          <View style={styles.overlayContainer}>\r\n            <IconButton\r\n              icon={() => (\r\n                <MaterialIcons\r\n                  name=\"close\"\r\n                  size={24}\r\n                  color={theme.colors.onPrimary}\r\n                />\r\n              )}\r\n              accessibilityLabel=\"Close\"\r\n              style={styles.overlayCloseButton}\r\n              mode=\"contained\"\r\n              containerColor={theme.colors.primary}\r\n              onPress={() => {\r\n                setCurrentEventOccurrenceId(undefined);\r\n                setCurrentLookbackMessageId(\"\");\r\n              }}\r\n            />\r\n\r\n            <View style={styles.titleContainer}>\r\n              <View\r\n                style={[\r\n                  styles.titleTextContainer,\r\n                  { maxWidth: messageLength > 0 ? width - 164 : width - 68 },\r\n                ]}\r\n              >\r\n                <Text h1>\r\n                  {eventMessage.getTitle(eventOccurrence?.params)} {totalText}{\" \"}\r\n                </Text>\r\n              </View>\r\n              {messageLength > 0 && (\r\n                <View style={styles.historyContainer}>\r\n                  <IconButton\r\n                    disabled={disableBackArrow}\r\n                    icon={() => (\r\n                      <MaterialIcons\r\n                        name=\"arrow-back\"\r\n                        size={24}\r\n                        color={\r\n                          disableBackArrow\r\n                            ? theme.colors.onSurfaceDisabled\r\n                            : theme.colors.onPrimary\r\n                        }\r\n                      />\r\n                    )}\r\n                    accessibilityLabel={t(\"Previous Message\")}\r\n                    style={styles.historyButton}\r\n                    containerColor={\r\n                      disableBackArrow\r\n                        ? theme.colors.surfaceDisabled\r\n                        : theme.colors.primary\r\n                    }\r\n                    onPress={() =>\r\n                      setCurrentLookbackMessageId(\r\n                        messageInLookbackIdx > 0\r\n                          ? eventOccurrence?.messageHistory?.[\r\n                              messageInLookbackIdx - 1\r\n                            ] ?? \"\"\r\n                          : eventOccurrence?.messageHistory?.[\r\n                              totalMessageCount - 2\r\n                            ] ?? \"\",\r\n                      )\r\n                    }\r\n                  />\r\n                  <IconButton\r\n                    disabled={disableForwardArrow}\r\n                    accessibilityLabel={t(\"Next Message\")}\r\n                    containerColor={\r\n                      disableForwardArrow\r\n                        ? theme.colors.surfaceDisabled\r\n                        : theme.colors.primary\r\n                    }\r\n                    style={styles.historyButton}\r\n                    icon={() => (\r\n                      <MaterialIcons\r\n                        name=\"arrow-forward\"\r\n                        size={24}\r\n                        color={\r\n                          disableForwardArrow\r\n                            ? theme.colors.onSurfaceDisabled\r\n                            : theme.colors.onPrimary\r\n                        }\r\n                      />\r\n                    )}\r\n                    onPress={() =>\r\n                      setCurrentLookbackMessageId(\r\n                        messageInLookbackIdx < totalMessageCount - 2\r\n                          ? eventOccurrence?.messageHistory?.[\r\n                              messageInLookbackIdx + 1\r\n                            ] ?? \"\"\r\n                          : \"\",\r\n                      )\r\n                    }\r\n                  />\r\n                </View>\r\n              )}\r\n            </View>\r\n            <View style={{ maxHeight: height - 150 }}>\r\n              <ScrollView style={styles.scrollView}>\r\n                <View style={styles.description}>\r\n                  <Markdown>\r\n                    {eventMessage.getDescription(\r\n                      state,\r\n                      eventOccurrence?.params,\r\n                    )}\r\n                  </Markdown>\r\n                </View>\r\n                {messageInLookbackIdx < 0 && (\r\n                  <View style={styles.optionRow}>\r\n                    {eventMessage\r\n                      .getAllowedOptions(state, eventOccurrence?.params)\r\n                      .map((option) => {\r\n                        const optionPress = () => {\r\n                          if (!option.nextMessage && !option.transform) {\r\n                            setCurrentEventOccurrenceId(undefined);\r\n                            setCurrentLookbackMessageId(\"\");\r\n                            return;\r\n                          }\r\n                          state.apply(\r\n                            executeEventOccurrenceAction(\r\n                              currentEventOccurrenceId,\r\n                              option,\r\n                            ),\r\n                          );\r\n                        };\r\n                        return (\r\n                          <Button\r\n                            key={option.description}\r\n                            onPress={optionPress}\r\n                            style={[\r\n                              styles.optionButton,\r\n                              { maxWidth: Math.min(width - 70, 586) },\r\n                            ]}\r\n                            TextComponent={View}\r\n                            disabled={!option.isEnabled}\r\n                          >\r\n                            <Text\r\n                              style={[\r\n                                {\r\n                                  color: theme.colors.onPrimary,\r\n                                },\r\n                                !option.isEnabled && {\r\n                                  color: theme.colors.onSurfaceDisabled,\r\n                                },\r\n                              ]}\r\n                            >\r\n                              {option.description}\r\n                            </Text>\r\n                          </Button>\r\n                        );\r\n                      })}\r\n                  </View>\r\n                )}\r\n              </ScrollView>\r\n            </View>\r\n          </View>\r\n        </Modal>\r\n      );\r\n    }\r\n    return null;\r\n  }, [\r\n    JSON.stringify(eventOccurrence),\r\n    optionDescriptions?.join(\",\"),\r\n    messageInLookbackIdx,\r\n    currentLookbackMessageId,\r\n    width,\r\n    height,\r\n    theme,\r\n    disabledIconColor,\r\n  ]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  overlay: {\r\n    alignSelf: \"center\",\r\n    marginHorizontal: 16,\r\n    maxWidth: 640,\r\n  },\r\n  overlayContainer: {\r\n    paddingVertical: 16,\r\n    paddingHorizontal: 8,\r\n  },\r\n  historyButton: {\r\n    height: 32,\r\n    width: 32,\r\n    borderRadius: 16,\r\n    marginLeft: 8,\r\n  },\r\n  overlayCloseButton: {\r\n    height: 32,\r\n    width: 32,\r\n    position: \"absolute\",\r\n    right: -16,\r\n    top: -16,\r\n  },\r\n  overlayCloseButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 32,\r\n  },\r\n  titleContainer: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  titleTextContainer: {},\r\n  historyContainer: {\r\n    marginLeft: 8,\r\n    flexDirection: \"row\",\r\n    width: 80,\r\n    marginRight: 32,\r\n  },\r\n  description: {\r\n    marginBottom: 8,\r\n  },\r\n  scrollView: {\r\n    flexGrow: 0,\r\n    marginTop: 8,\r\n  },\r\n  optionRow: {\r\n    marginTop: 8,\r\n    flexDirection: \"row\",\r\n    flexWrap: \"wrap\",\r\n    gap: 12,\r\n    justifyContent: \"space-around\",\r\n  },\r\n  optionButton: {\r\n    maxWidth: 600,\r\n  },\r\n});\r\n","import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport {\r\n  FlatList,\r\n  ListRenderItemInfo,\r\n  NativeScrollEvent,\r\n  NativeSyntheticEvent,\r\n  Platform,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\nimport { Badge, useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { getUnreadNotificationsByGroup } from \"../../backend/Notifications\";\r\nimport Divider from \"../utility/Divider\";\r\nimport {\r\n  DEFAULT_SECTION_ORDER,\r\n  getAllMenuItems,\r\n  getSectionInfo,\r\n  useHorizontalScrollRef,\r\n} from \"../utility/Miscellaneous\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\n\r\nconst SelectedContext = React.createContext(\"Campus\");\r\n\r\nfunction MenuComponent(props: {\r\n  title: string;\r\n  showBadge: boolean;\r\n  onPress: () => void;\r\n}) {\r\n  const { title, onPress } = { ...props };\r\n  const theme = useTheme();\r\n  const selected = useContext(SelectedContext);\r\n  const shouldHighlight = selected == title;\r\n  return useMemo(\r\n    () => (\r\n      <TouchableOpacity\r\n        onPress={onPress}\r\n        accessible={true}\r\n        accessibilityLabel={title}\r\n        accessibilityRole=\"tab\"\r\n      >\r\n        <View\r\n          style={[\r\n            styles.itemContainerStyle,\r\n            shouldHighlight\r\n              ? { backgroundColor: theme.colors.secondaryContainer }\r\n              : null,\r\n          ]}\r\n        >\r\n          <View>\r\n            <GameIcon icon={title.toLowerCase()} />\r\n            {props.showBadge && (\r\n              <View style={styles.notificationBadge}>\r\n                <Badge size={12} />\r\n              </View>\r\n            )}\r\n          </View>\r\n          <Text\r\n            doNotScaleFonts={true}\r\n            style={[\r\n              styles.itemStyle,\r\n              shouldHighlight\r\n                ? { color: theme.colors.onSecondaryContainer }\r\n                : null,\r\n            ]}\r\n          >\r\n            {getSectionInfo(title).name}\r\n          </Text>\r\n        </View>\r\n      </TouchableOpacity>\r\n    ),\r\n    [title, onPress, shouldHighlight, theme, props.showBadge],\r\n  );\r\n}\r\n\r\nconst SCROLL_VIEW_EPSILON = 10;\r\n\r\nexport function BottomMenu(props: {\r\n  onNavigationPress: (section: string) => void;\r\n  onSpellMenuPress: () => void;\r\n  selected: string;\r\n  leftHanded: boolean;\r\n  showCastSpellButton: boolean;\r\n}) {\r\n  const state = useContext(StateContext);\r\n\r\n  const menuOrder =\r\n    state.options.sectionOrder.length > 0\r\n      ? state.options.sectionOrder\r\n      : DEFAULT_SECTION_ORDER;\r\n\r\n  const menuItemsCalculated = getAllMenuItems(state)\r\n    .filter((item) => !state.options.hiddenFromBottomMenu.includes(item))\r\n    .sort((a, b) => menuOrder.indexOf(a) - menuOrder.indexOf(b));\r\n\r\n  const navigationPressCallback = useCallback(\r\n    (item: string) => {\r\n      props.onNavigationPress(item);\r\n    },\r\n    [props.onNavigationPress],\r\n  );\r\n\r\n  const menuItems = useMemo(\r\n    () => menuItemsCalculated,\r\n    [menuItemsCalculated.join()],\r\n  );\r\n  const callbacks = useMemo(\r\n    () => menuItems.map((item) => () => navigationPressCallback(item)),\r\n    [menuItems, navigationPressCallback],\r\n  );\r\n  const sectionsWithBadges = menuItems.filter(\r\n    (group) =>\r\n      getUnreadNotificationsByGroup(state, group).length > 0 ||\r\n      getSectionInfo(group).isBadged?.(state),\r\n  );\r\n  const renderItem = useCallback(\r\n    (item: ListRenderItemInfo<string>) => (\r\n      <View style={{ flexDirection: \"row\" }}>\r\n        {item.index === 0 && <Divider orientation=\"vertical\" />}\r\n        <MenuComponent\r\n          title={item.item}\r\n          showBadge={sectionsWithBadges.includes(item.item)}\r\n          onPress={callbacks[item.index]}\r\n        />\r\n        <Divider orientation=\"vertical\" />\r\n      </View>\r\n    ),\r\n    [callbacks, navigationPressCallback, sectionsWithBadges.join()],\r\n  );\r\n\r\n  const keyExtractor = useCallback((item: string) => item, []);\r\n\r\n  const theme = useTheme();\r\n  const [scrollEnd, setScrollEnd] = useState(false);\r\n  const [scrollStart, setScrollStart] = useState(true);\r\n  const onScroll = useCallback(\r\n    (e: NativeSyntheticEvent<NativeScrollEvent>) => {\r\n      const position = e.nativeEvent.contentOffset.x;\r\n      const contentWidth = e.nativeEvent.contentSize.width;\r\n      const scrollViewWidth = e.nativeEvent.layoutMeasurement.width;\r\n      const isStart = position < SCROLL_VIEW_EPSILON;\r\n      const isEnd =\r\n        contentWidth - scrollViewWidth - position < SCROLL_VIEW_EPSILON;\r\n      if (isStart != scrollStart) {\r\n        setScrollStart(isStart);\r\n      }\r\n      if (isEnd != scrollEnd) {\r\n        setScrollEnd(isEnd);\r\n      }\r\n    },\r\n    [scrollEnd, scrollStart, setScrollEnd, setScrollStart],\r\n  );\r\n\r\n  const flatListBackgroundStyle = useMemo(\r\n    () => [\r\n      styles.scrollContentContainer,\r\n      { backgroundColor: theme.colors.background },\r\n    ],\r\n    [theme],\r\n  );\r\n\r\n  const wheelScrollRef =\r\n    Platform.OS === \"web\" ? useHorizontalScrollRef() : useRef();\r\n\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.bottomMenuContainer,\r\n          { backgroundColor: theme.colors.background },\r\n        ]}\r\n      >\r\n        {props.leftHanded && props.showCastSpellButton && (\r\n          <View style={styles.spellButtonPlaceholder} />\r\n        )}\r\n        <View style={[styles.chevron, scrollStart && { opacity: 0 }]}>\r\n          <MaterialIcons\r\n            name=\"chevron-left\"\r\n            size={24}\r\n            color={theme.colors.onBackground}\r\n          />\r\n        </View>\r\n        <SelectedContext.Provider value={props.selected}>\r\n          <FlatList\r\n            ref={wheelScrollRef}\r\n            data={menuItems}\r\n            renderItem={renderItem}\r\n            keyExtractor={keyExtractor}\r\n            horizontal={true}\r\n            snapToInterval={71}\r\n            style={styles.scrollContainer}\r\n            contentContainerStyle={flatListBackgroundStyle}\r\n            scrollEventThrottle={100}\r\n            onScroll={onScroll}\r\n            overScrollMode=\"never\"\r\n            showsHorizontalScrollIndicator={false}\r\n            nestedScrollEnabled={true}\r\n          />\r\n        </SelectedContext.Provider>\r\n        <View style={[styles.chevron, scrollEnd && { opacity: 0 }]}>\r\n          <MaterialIcons\r\n            name=\"chevron-right\"\r\n            size={24}\r\n            color={theme.colors.onBackground}\r\n          />\r\n        </View>\r\n        {!props.leftHanded && props.showCastSpellButton && (\r\n          <View style={styles.spellButtonPlaceholder} />\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      menuItems,\r\n      renderItem,\r\n      theme,\r\n      scrollStart,\r\n      scrollEnd,\r\n      flatListBackgroundStyle,\r\n      onScroll,\r\n      props.selected,\r\n      props.leftHanded,\r\n      props.showCastSpellButton,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  scrollContainer: {\r\n    flex: 1,\r\n    height: 48,\r\n  },\r\n  scrollContentContainer: {\r\n    paddingVertical: 0,\r\n    justifyContent: \"center\",\r\n  },\r\n  navigationBlock: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  itemContainerStyle: {\r\n    width: 70,\r\n    alignItems: \"center\",\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n  },\r\n  itemStyle: {\r\n    fontSize: 10,\r\n  },\r\n  gradient: {\r\n    flex: 1,\r\n  },\r\n  spellButtonPlaceholder: {\r\n    width: 84,\r\n    height: 48,\r\n  },\r\n  bottomMenuContainer: { flexDirection: \"row\", alignItems: \"center\" },\r\n  spellMenuButtonPlaceholder: {\r\n    height: 48,\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"flex-end\",\r\n    overflow: \"visible\",\r\n  },\r\n  chevron: {\r\n    width: 24,\r\n    height: 48,\r\n    justifyContent: \"center\",\r\n  },\r\n  notificationBadge: {\r\n    position: \"absolute\",\r\n    top: 4,\r\n    right: 4,\r\n  },\r\n});\r\n","import { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { cleanup } from \"../../backend/Cleanup\";\r\nimport { hasFlag } from \"../../backend/Flags\";\r\nimport { GameState, StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  nextFrame,\r\n  processOfflineTicks,\r\n  processTimeTick,\r\n  processWarpTime,\r\n} from \"../../backend/timetick/TimeTick\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformations,\r\n  registerTransformation,\r\n} from \"../../backend/transformation/Transformation\";\r\nimport { TransformationTags } from \"../../backend/transformation/TransformationTags\";\r\nimport { t } from \"../../utils/I18n\";\r\n// import {\r\n//   clearTimeout,\r\n//   setInterval,\r\n//   setTimeout,\r\n// } from \"../utility/FailSafeTimers\";\r\n\r\nconst TARGET_FPS = 20;\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.GameSpeed]],\r\n  \"CombatPausedMagicTap\",\r\n  t(\"Combat paused for accessibility\"),\r\n  TransformationType.Multiplier,\r\n  (state) => (hasFlag(state, \"combat_paused_magic_tap\") ? 0 : 1),\r\n);\r\n\r\nconst gameSpeedTags = [TransformationTags.GameSpeed];\r\n\r\nexport default function GameTickProcessor(props: {\r\n  setPlayerState: (state: GameState) => void;\r\n  onLoadingProgress: (ticksProcessedSoFar: number, ticksTotal: number) => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n\r\n  // The use of ref is needed here because:\r\n  // 1. We don't want to reset the interval if the context changes,\r\n  //    because that will lead to delayed updates\r\n  // 2. If we don't use playerContextRef and use playerContext instead,\r\n  //    it will refer to an old context,\r\n  //    and it will miss updates\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const [currentError, setCurrentError] = useState(null);\r\n\r\n  const [lastTickTime, setLastTickTime] = useState(state.run.lastProcessedTime);\r\n\r\n  const [randomValueForReprocessing, setRandomValueForReprocessing] = useState(\r\n    Math.random(),\r\n  );\r\n\r\n  const [warping, setWarping] = useState(false);\r\n\r\n  if (currentError != null) {\r\n    // If we have an error, stop all processing by throwing\r\n    // and letting the error handler handle it\r\n    throw currentError;\r\n  }\r\n\r\n  const timeTickCallback = useCallback(async () => {\r\n    let nowTime = Date.now();\r\n    let lastTickTimeConsidered = lastTickTime;\r\n\r\n    if (warping) {\r\n      // Skip ticks entirely if warping\r\n      return;\r\n    }\r\n\r\n    if (stateRef.current.run.warpTimeSecs > 0) {\r\n      // Trigger a time warp!\r\n      let { apply, ...currentState } = stateRef.current;\r\n      setWarping(true);\r\n      await processWarpTime(\r\n        currentState,\r\n        () => Date.now(),\r\n        props.onLoadingProgress,\r\n        props.setPlayerState,\r\n      );\r\n      // Processing can take a while, so overwrite this so we don't end up with a long tick...\r\n      nowTime = Date.now();\r\n      setWarping(false);\r\n      lastTickTimeConsidered = nowTime;\r\n    }\r\n\r\n    const elapsedSec =\r\n      (nowTime - lastTickTimeConsidered) / 1000 +\r\n      stateRef.current.run.skipAheadTime;\r\n    if (stateRef.current.run.skipAheadTime > 0) {\r\n      stateRef.current.apply((state) => {\r\n        state.run.skipAheadTime = 0;\r\n        return state;\r\n      });\r\n    }\r\n    // console.log(\"elapsed sec: \", elapsedSec, new Date().toTimeString());\r\n    if (elapsedSec <= 0) {\r\n      // Someone is skipping time. Do not do anything!!\r\n      // Or maybe the system clock adjusted itself. In which case, although we do not\r\n      // want to do anything, we do want the time tick to resume later, so\r\n      // just set a random value so it refreshes...\r\n      setRandomValueForReprocessing(Math.random());\r\n      return;\r\n    }\r\n    if (elapsedSec > 600) {\r\n      // console.warn(\"elapsed sec is too large\", elapsedSec);\r\n      // Trigger a loading update\r\n      const secsTotal = Math.floor(Math.min(60 * 60 * 48, elapsedSec));\r\n      let { apply, ...currentState } = stateRef.current;\r\n      await processOfflineTicks(\r\n        currentState,\r\n        secsTotal,\r\n        nowTime,\r\n        props.setPlayerState,\r\n      );\r\n    } else if (elapsedSec > 30) {\r\n      // Start a warp!\r\n      stateRef.current.apply((state) => {\r\n        state.run.warpTimeSecs += elapsedSec;\r\n        state.run.lastProcessedTime = nowTime;\r\n        return state;\r\n      });\r\n    } else {\r\n      stateRef.current.apply((state) => {\r\n        const beginTimestamp = Date.now();\r\n        let remainingSec = elapsedSec;\r\n        let ticksRun = 0;\r\n        const speedMultiplier = applyTransformations(\r\n          gameSpeedTags,\r\n          state,\r\n          1.0,\r\n          {\r\n            isWarp: false,\r\n          },\r\n        );\r\n        do {\r\n          // Attempt to do a tick once every 100 in-game milliseconds at most.\r\n          // However, if we would need to execute more than 20 ticks, just do 20 ticks to avoid locking the game.\r\n          const tickTime = Math.min(\r\n            Math.max(0.1 / speedMultiplier, elapsedSec / 19.999),\r\n            remainingSec,\r\n          );\r\n          state = processTimeTick(tickTime, false)(state);\r\n          state.run.lastProcessedTime = nowTime;\r\n          remainingSec -= tickTime;\r\n          ticksRun++;\r\n        } while (remainingSec > 0);\r\n        const endTimestamp = Date.now();\r\n        state.global.debugLastUpdateTimestamps.push(endTimestamp);\r\n        state.global.debugLastUpdateBeginEndTimestamps.push({\r\n          begin: beginTimestamp,\r\n          end: endTimestamp,\r\n          ticksRun,\r\n        });\r\n        state.global.debugLastUpdateTimestamps =\r\n          state.global.debugLastUpdateTimestamps.slice(-10);\r\n        state.global.debugLastUpdateBeginEndTimestamps =\r\n          state.global.debugLastUpdateBeginEndTimestamps.slice(-10);\r\n        return state;\r\n      });\r\n    }\r\n\r\n    setLastTickTime(nowTime);\r\n  }, [lastTickTime, warping, randomValueForReprocessing]);\r\n\r\n  const cleanupCallback = useCallback(async () => {\r\n    stateRef.current.apply(cleanup);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const interval = setTimeout(async () => {\r\n      try {\r\n        await timeTickCallback();\r\n        await nextFrame();\r\n      } catch (e: any) {\r\n        setCurrentError(e);\r\n      }\r\n    }, 1000 / (state.options?.targetFps ?? TARGET_FPS));\r\n    return () => clearTimeout(interval);\r\n  }, [timeTickCallback]);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        await cleanupCallback();\r\n        await nextFrame();\r\n      } catch (e: any) {\r\n        setCurrentError(e);\r\n      }\r\n    }, 3000);\r\n    return () => clearTimeout(interval);\r\n  }, [cleanupCallback]);\r\n\r\n  // Do not render anything\r\n  return null;\r\n}\r\n","import { LinearGradient } from \"expo-linear-gradient\";\r\nimport React, { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport { Animated, Platform, StyleSheet, View } from \"react-native\";\r\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  Resource,\r\n  getResourceAmount,\r\n  getResourceCap,\r\n} from \"../../backend/Resources\";\r\nimport {\r\n  estimateManaConsumptionPerSecPermaCast,\r\n  getCurrentAutocastStrategy,\r\n} from \"../../backend/autocast/Autocast\";\r\nimport { calculateIncomePerSecond } from \"../../backend/timetick/IncomeOverTime\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { useAuxOptions } from \"../utility/AuxOptionsContext\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\n\r\n/*\r\n * This component displays a mana bar. However, it's a total hack and will\r\n * certainly not look ok if it's not full-screen-width.\r\n */\r\nexport default function ManaBar() {\r\n  const auxOptions = useAuxOptions();\r\n  const state = useContext(StateContext);\r\n  const mana = getResourceAmount(state, Resource.Mana);\r\n  const manaCap = getResourceCap(state, Resource.Mana);\r\n  const insets = useSafeAreaInsets();\r\n  const ratioFilled = Math.min(1.0, mana / manaCap);\r\n\r\n  const filledAnimWithNativeDriver = useRef(\r\n    new Animated.Value(ratioFilled),\r\n  ).current;\r\n  const filledAnimWithoutNativeDriver = useRef(\r\n    new Animated.Value(ratioFilled),\r\n  ).current;\r\n\r\n  const manaIncome = calculateIncomePerSecond(state)?.Mana ?? 0;\r\n  const permaCastCost = estimateManaConsumptionPerSecPermaCast(\r\n    state,\r\n    getCurrentAutocastStrategy(state),\r\n  );\r\n\r\n  const incomeText =\r\n    manaIncome != 0\r\n      ? \" (\" +\r\n        (manaIncome > 0 ? \"+\" : \"\") +\r\n        formatNumber(manaIncome, { showDecimals: true }) +\r\n        \"/s\" +\r\n        (permaCastCost != 0\r\n          ? \"; -\" + formatNumber(permaCastCost, { showDecimals: true }) + \"/s\"\r\n          : \"\") +\r\n        \")\"\r\n      : \"\";\r\n\r\n  useEffect(() => {\r\n    if (state.options.doNotUseNativeDriver) {\r\n      Animated.timing(filledAnimWithoutNativeDriver, {\r\n        toValue: Math.max(ratioFilled, 1e-5),\r\n        duration: 100,\r\n        useNativeDriver: false,\r\n      }).start();\r\n    } else {\r\n      Animated.timing(filledAnimWithNativeDriver, {\r\n        toValue: Math.max(ratioFilled, 1e-5),\r\n        duration: 100,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    }\r\n  }, [ratioFilled]);\r\n  const animatedStyle = useMemo(\r\n    () => [\r\n      styles.filled,\r\n      {\r\n        transform: [\r\n          {\r\n            scaleX: state.options.doNotUseNativeDriver\r\n              ? filledAnimWithoutNativeDriver\r\n              : filledAnimWithNativeDriver,\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n    [state.options.doNotUseNativeDriver],\r\n  );\r\n  const animatedComponent = useMemo(\r\n    () => (\r\n      <Animated.View\r\n        key={state.options.doNotUseNativeDriver ? \"yes\" : \"no\"}\r\n        style={[\r\n          animatedStyle,\r\n          insets.bottom < 10 && { backgroundColor: \"#04c\" },\r\n        ]}\r\n      >\r\n        {insets.bottom >= 10 && (\r\n          <LinearGradient\r\n            colors={[`#04c`, `#04c0`]}\r\n            style={[\r\n              styles.gradient,\r\n              {\r\n                height: Math.max(\r\n                  48,\r\n                  (auxOptions.compactLayout ? 21 : 29) + insets.bottom,\r\n                ),\r\n              },\r\n            ]}\r\n          />\r\n        )}\r\n      </Animated.View>\r\n    ),\r\n    [\r\n      state.options.doNotUseNativeDriver,\r\n      animatedStyle,\r\n      insets.bottom,\r\n      auxOptions.compactLayout,\r\n    ],\r\n  );\r\n  const incomeTextComponent = useMemo(\r\n    () => <Text style={styles.income}>{incomeText}</Text>,\r\n    [incomeText],\r\n  );\r\n  const manaTextComponent = useMemo(\r\n    () => (\r\n      <Text style={styles.textOverlay}>\r\n        {formatNumber(mana)}/{formatNumber(manaCap)}\r\n        {incomeTextComponent}\r\n      </Text>\r\n    ),\r\n    [mana, manaCap, incomeTextComponent],\r\n  );\r\n  const accessibilityLabel = useMemo(\r\n    () => `Mana: ${formatNumber(mana)}/${formatNumber(manaCap)} ${incomeText}`,\r\n    [mana, manaCap, incomeText],\r\n  );\r\n  return useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.container,\r\n          { height: (auxOptions.compactLayout ? 21 : 29) + insets.bottom },\r\n        ]}\r\n      >\r\n        {animatedComponent}\r\n        <View>\r\n          <View\r\n            style={styles.row}\r\n            accessible={true}\r\n            accessibilityRole={Platform.OS !== \"web\" ? \"header\" : undefined}\r\n            accessibilityLabel={accessibilityLabel}\r\n          >\r\n            <GameIcon icon=\"mana\" style={styles.icon} />\r\n            {manaTextComponent}\r\n          </View>\r\n          <View style={{ height: insets.bottom }} />\r\n        </View>\r\n      </View>\r\n    ),\r\n    [\r\n      animatedComponent,\r\n      accessibilityLabel,\r\n      manaTextComponent,\r\n      insets.bottom,\r\n      auxOptions.compactLayout,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    alignItems: \"center\",\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n    width: \"100%\",\r\n    backgroundColor: \"#014\",\r\n    height: 29,\r\n  },\r\n  gradient: {\r\n    width: \"100%\",\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n  filled: {\r\n    position: \"absolute\",\r\n    left: \"-100%\",\r\n    top: 0,\r\n    height: \"100%\",\r\n    width: \"200%\",\r\n    overflow: \"hidden\",\r\n  },\r\n  textOverlay: {\r\n    color: \"#fff\",\r\n    fontWeight: \"bold\",\r\n  },\r\n  income: {\r\n    color: \"#fff\",\r\n    fontWeight: \"normal\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    height: 16,\r\n    width: 16,\r\n    marginRight: 4,\r\n  },\r\n  accessibilityHidden: {\r\n    width: 1,\r\n    height: 1,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n});\r\n","import { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { buildEvent } from \"../events/EventMessageBuilder\";\r\nimport {\r\n  EventOccurrenceData,\r\n  getEventOccurrenceById,\r\n  triggerEvent,\r\n} from \"../events/Events\";\r\nimport { clearFlag, hasFlag, hasWorldFlag, setWorldFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../Resources\";\r\nimport {\r\n  registerPostRetirementListener,\r\n  registerRetirementListener,\r\n} from \"../Retire\";\r\nimport {\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport {\r\n  OfflineTickListener,\r\n  OfflineTickListeners,\r\n} from \"./OfflineTickListeners\";\r\nimport { registerTimeTickListener } from \"./TimeTick\";\r\n\r\nexport function getCurrentTimePieceSpeedupSpeed(state: GameState) {\r\n  return hasFlag(state, \"time_piece_5x_speedup_enabled\")\r\n    ? 5\r\n    : hasFlag(state, \"time_piece_speedup_enabled\")\r\n    ? 2\r\n    : 1;\r\n}\r\n\r\n// Returns cost per extra REAL LIFE second gained.\r\nexport function getCurrentTimePieceSpeedupCost(state: GameState) {\r\n  if (hasFlag(state, \"time_piece_5x_speedup_enabled\")) {\r\n    return applyTransformations(\r\n      [TransformationTags.TimePiecePerFasterSpeedup],\r\n      state,\r\n      4.0,\r\n    );\r\n  } else if (hasFlag(state, \"time_piece_speedup_enabled\")) {\r\n    return applyTransformations(\r\n      [TransformationTags.TimePiecePerFastSpeedup],\r\n      state,\r\n      3.0,\r\n    );\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\n// Returns cost per real-life second.\r\nexport function getCurrentTimePieceSpeedupCostPerRealSecond(state: GameState) {\r\n  const speed = getCurrentTimePieceSpeedupSpeed(state);\r\n  if (speed > 1) {\r\n    const cost = getCurrentTimePieceSpeedupCost(state);\r\n    return (speed - 1) * cost;\r\n  }\r\n  return 0;\r\n}\r\n\r\nconst gameSpeedTags = [TransformationTags.GameSpeed];\r\n\r\n/**\r\n * Returns the total speed multiplier. This includes time pieces,\r\n * Time Contraction, and everything else.\r\n */\r\nfunction calculateSpeedMultiplier(state: GameState): number {\r\n  return applyTransformations(gameSpeedTags, state, 1.0, { isWarp: false });\r\n}\r\n\r\nfunction getCurrentTimePieceSpeedupCostPerGameSecond(state: GameState) {\r\n  const speed = getCurrentTimePieceSpeedupSpeed(state);\r\n  if (speed > 1) {\r\n    const cost = getCurrentTimePieceSpeedupCost(state);\r\n    const totalSpeed = calculateSpeedMultiplier(state);\r\n    return ((speed - 1) * cost) / totalSpeed;\r\n  }\r\n  return 0;\r\n}\r\n\r\nexport function recordTimePieceConsumption(\r\n  state: GameState,\r\n  amount: number,\r\n): GameState {\r\n  state.global.timePiecesConsumed += amount;\r\n  state.world.timePiecesConsumed += amount;\r\n  state.run.timePiecesConsumed += amount;\r\n  return state;\r\n}\r\n\r\nexport function loadTimePieces() {\r\n  registerTransformation(\r\n    [[TransformationTags.GameSpeed]],\r\n    \"TimePieceGameSpeed\",\r\n    t(\"Time Pieces game speedup\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) =>\r\n      !params.isWarp ? getCurrentTimePieceSpeedupSpeed(state) : 1,\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.GameSpeed]],\r\n    \"Debug2xGameSpeed\",\r\n    t(\"Debug game speedup\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) =>\r\n      hasFlag(state, \"debug_2x_speed\") && !params?.isWarp ? 2 : 1,\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.GameSpeed]],\r\n    \"Debug0xGameSpeed\",\r\n    t(\"Debug game speed frozen\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) =>\r\n      hasFlag(state, \"debug_0x_speed\") && !params?.isWarp ? 0 : 1,\r\n  );\r\n\r\n  registerTimeTickListener(\r\n    \"TimePieceConsumer\",\r\n    (state, timeElapsedSec, isWarp) => {\r\n      if (!isWarp) {\r\n        const costPerSecond =\r\n          getCurrentTimePieceSpeedupCostPerGameSecond(state);\r\n        if (costPerSecond > 0) {\r\n          const amount = costPerSecond * timeElapsedSec;\r\n          state = grantResource(Resource.TimePiece, -amount)(state);\r\n          state = recordTimePieceConsumption(state, amount);\r\n        }\r\n        if (getResourceAmount(state, Resource.TimePiece) <= 0) {\r\n          state = clearFlag(\"time_piece_5x_speedup_enabled\")(state);\r\n          state = clearFlag(\"time_piece_speedup_enabled\")(state);\r\n        }\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  const timePieceEventBuilder = buildEvent(\r\n    \"TimePieceEvent\",\r\n    t(\"Offline Progress\"),\r\n    [],\r\n  );\r\n  timePieceEventBuilder.message(\r\n    t(`Welcome back to Magic Research!\r\n        \r\n  **You obtained /amount/:timepiece: Time Pieces!**`),\r\n  );\r\n  const timePieceEvent = timePieceEventBuilder.build();\r\n\r\n  const timePieceEventBuilderFirstTime = buildEvent(\r\n    \"TimePieceEventFirstTime\",\r\n    t(\"Offline Progress\"),\r\n    [],\r\n  ).setOnTrigger(setWorldFlag(\"has_seen_offline_progress\"));\r\n  timePieceEventBuilderFirstTime.message(\r\n    t(`Welcome back to Magic Research!\r\n        \r\n  **You obtained /amount/:timepiece: Time Pieces! Time Pieces allow you to make time pass faster for a duration. You can do so from the left side menu!**`),\r\n  );\r\n  const timePieceEventFirstTime = timePieceEventBuilderFirstTime.build();\r\n\r\n  const timePieceGranter = new OfflineTickListener(\r\n    \"TimePieceGranter\",\r\n    (totalSecs) => {\r\n      return (state) => {\r\n        const transformedSecs = applyTransformations(\r\n          [TransformationTags.OfflineTimePieceGain, Resource.TimePiece],\r\n          state,\r\n          totalSecs,\r\n        );\r\n        const oldTimePiece = getResourceAmount(state, Resource.TimePiece);\r\n        // console.log(\"Granting time pieces\", transformedSecs);\r\n        state = grantResource(Resource.TimePiece, transformedSecs)(state);\r\n        const newTimePiece = getResourceAmount(state, Resource.TimePiece);\r\n        const amount = newTimePiece - oldTimePiece;\r\n        if (amount > 0) {\r\n          if (hasWorldFlag(state, \"has_seen_offline_progress\")) {\r\n            const lastEventOccurrenceId = state.run.eventQueue.find(\r\n              (eventOccurrenceId) =>\r\n                getEventOccurrenceById(state, eventOccurrenceId)?.eventId ===\r\n                timePieceEvent.getId(),\r\n            );\r\n            if (lastEventOccurrenceId != null) {\r\n              const eventOccurrence = getEventOccurrenceById(\r\n                state,\r\n                lastEventOccurrenceId,\r\n              ) as EventOccurrenceData;\r\n              const newAmount =\r\n                amount + (eventOccurrence?.params?.rawAmount ?? 0);\r\n              eventOccurrence.params.amount = formatNumber(newAmount);\r\n              eventOccurrence.params.rawAmount = newAmount;\r\n              state.run.eventOccurrences[lastEventOccurrenceId] =\r\n                eventOccurrence;\r\n            } else {\r\n              if (amount > 60) {\r\n                state = triggerEvent(timePieceEvent, {\r\n                  amount: formatNumber(amount),\r\n                  rawAmount: amount,\r\n                })(state);\r\n              }\r\n            }\r\n          } else {\r\n            state = triggerEvent(timePieceEventFirstTime, {\r\n              amount: formatNumber(amount),\r\n              rawAmount: amount,\r\n            })(state);\r\n          }\r\n        }\r\n        return state;\r\n      };\r\n    },\r\n  );\r\n  OfflineTickListeners.register(timePieceGranter);\r\n\r\n  registerRetirementListener(\"TimePieceRecorder\", (state) => {\r\n    state.world.variables[\"timePiecesLastRun\"] = getResourceAmount(\r\n      state,\r\n      Resource.TimePiece,\r\n    );\r\n    return state;\r\n  });\r\n\r\n  registerPostRetirementListener(\"TimePieceRetirementGranter\", (state) => {\r\n    state = grantResource(\r\n      Resource.TimePiece,\r\n      state.world.variables[\"timePiecesLastRun\"] as number,\r\n    )(state);\r\n    return state;\r\n  });\r\n}\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  getElementExp,\r\n  getElementLevel,\r\n  getPrimaryElements,\r\n  getTotalExpRequiredForLevel,\r\n  getUnlockedElements,\r\n} from \"../../backend/spells/Elements\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Text } from \"./Text\";\r\n\r\nfunction ElementRow(props: {\r\n  name: string;\r\n  level: number;\r\n  isPrimary: boolean;\r\n  currentExp: string;\r\n  toNextLevel: string;\r\n}) {\r\n  return (\r\n    <View style={styles.row} accessible={true}>\r\n      <Text\r\n        doNotScaleFonts={true}\r\n        style={props.isPrimary && styles.primaryText}\r\n      >\r\n        {t(\"{{name}}: Lv{{level}}\", { name: props.name, level: props.level })}\r\n      </Text>\r\n      <Text\r\n        doNotScaleFonts={true}\r\n        style={props.isPrimary && styles.primaryText}\r\n      >\r\n        {t(\"Exp {{currentExp}}/{{nextLevelExp}}\", {\r\n          currentExp: props.currentExp,\r\n          nextLevelExp: props.toNextLevel,\r\n        })}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst SchoolRowMemo = React.memo(ElementRow);\r\n\r\nexport function ElementViewer(props: { isVisible: boolean }) {\r\n  const state = useContext(StateContext);\r\n  const keys = getUnlockedElements(state);\r\n  const rows = useMemo(\r\n    () =>\r\n      keys.map((key) => {\r\n        const level = getElementLevel(state, key);\r\n        const currentExp = getElementExp(state, key);\r\n        const toNextLevel = getTotalExpRequiredForLevel(state, level + 1, key);\r\n        return (\r\n          <SchoolRowMemo\r\n            name={key}\r\n            level={level}\r\n            isPrimary={getPrimaryElements(state).includes(key)}\r\n            currentExp={formatNumber(currentExp)}\r\n            toNextLevel={formatNumber(toNextLevel)}\r\n            key={key}\r\n          />\r\n        );\r\n      }),\r\n    [\r\n      props.isVisible !== false\r\n        ? JSON.stringify(state.run.elementExperience)\r\n        : false,\r\n      getPrimaryElements(state).join(),\r\n    ],\r\n  );\r\n  return <View style={styles.container}>{rows}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  primaryText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  getResourceInfo,\r\n  getSortedResourceKeys,\r\n  Resource,\r\n  translateResource,\r\n} from \"../../backend/Resources\";\r\nimport {\r\n  calculateIncomePerSecond,\r\n  explainIncomePerSecText,\r\n} from \"../../backend/timetick/IncomeOverTime\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameIcon } from \"./icons/GameIcon\";\r\nimport Styles from \"./Styles\";\r\nimport { Text } from \"./Text\";\r\nimport Tooltip from \"./tooltip/PaperTooltip\";\r\n\r\nconst EPSILON = 1e-6;\r\n\r\nfunction ResourceRow(props: {\r\n  resource: Resource;\r\n  current: number;\r\n  cap: number;\r\n  income: number;\r\n  hideIncome: boolean;\r\n  explanation: string;\r\n}) {\r\n  const resourceInfo = getResourceInfo(props.resource);\r\n  const isCapped = props.current >= props.cap - EPSILON;\r\n  const theme = useTheme();\r\n  const incomeComponent = useMemo(() => {\r\n    if (props.hideIncome) {\r\n      return null;\r\n    }\r\n    if (props.explanation != \"\") {\r\n      return (\r\n        <View style={styles.income}>\r\n          {props.income != 0 && (\r\n            <Tooltip title={props.explanation}>\r\n              <Text\r\n                style={[\r\n                  props.income < 0 && { color: theme.colors.error },\r\n                  Styles.underlined,\r\n                ]}\r\n                doNotScaleFonts={true}\r\n              >\r\n                {t(\"{{incomeSign}}{{income}}/s\", {\r\n                  incomeSign: props.income > 0 ? \"+\" : \"-\",\r\n                  income: formatNumber(Math.abs(props.income), {\r\n                    showDecimals: true,\r\n                  }),\r\n                })}\r\n              </Text>\r\n            </Tooltip>\r\n          )}\r\n        </View>\r\n      );\r\n    }\r\n    return (\r\n      <View style={styles.income}>\r\n        {props.income != 0 && (\r\n          <Text\r\n            style={props.income < 0 && { color: theme.colors.error }}\r\n            doNotScaleFonts={true}\r\n          >\r\n            {t(\"{{incomeSign}}{{income}}/s\", {\r\n              incomeSign: props.income > 0 ? \"+\" : \"-\",\r\n              income: formatNumber(Math.abs(props.income), {\r\n                showDecimals: true,\r\n              }),\r\n            })}\r\n          </Text>\r\n        )}\r\n      </View>\r\n    );\r\n  }, [props.income, props.hideIncome, props.explanation, theme]);\r\n\r\n  const firstComponent = useMemo(\r\n    () => (\r\n      <View style={styles.inlineRow}>\r\n        <GameIcon\r\n          icon={resourceInfo.icon}\r\n          style={styles.icon}\r\n          small\r\n          accessibilityLabel=\"\"\r\n        />\r\n        <Text doNotScaleFonts={true}>\r\n          {t(\"{{resource}}: \", { resource: translateResource(props.resource) })}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [props.resource, resourceInfo.icon],\r\n  );\r\n\r\n  return (\r\n    <View style={styles.row} accessible={true}>\r\n      {firstComponent}\r\n      <View style={styles.inlineRow}>\r\n        <Text\r\n          style={isCapped && { color: theme.colors.secondary }}\r\n          doNotScaleFonts={true}\r\n        >\r\n          {t(\"{{current}}/{{cap}}\", {\r\n            current: formatNumber(props.current, { showDecimals: true }),\r\n            cap: formatNumber(props.cap),\r\n          })}\r\n        </Text>\r\n        {incomeComponent}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst ResourceRowMemo = React.memo(ResourceRow);\r\n\r\nexport function ResourceViewer(props: { isVisible?: boolean }) {\r\n  const state = useContext(StateContext);\r\n  const resourceKeys = getSortedResourceKeys(state) as Array<Resource>;\r\n  const income = calculateIncomePerSecond(state);\r\n  const incomeExplanation = explainIncomePerSecText(state);\r\n  const hasAnyIncome = Object.keys(income).some(\r\n    (resource) => income[resource as Resource] != 0,\r\n  );\r\n  const rows = useMemo(\r\n    () =>\r\n      resourceKeys.map((resourceName) => {\r\n        return (\r\n          <ResourceRowMemo\r\n            resource={resourceName}\r\n            current={getResourceAmount(state, resourceName)}\r\n            cap={getResourceCap(state, resourceName)}\r\n            income={income?.[resourceName] ?? 0}\r\n            hideIncome={!hasAnyIncome}\r\n            explanation={incomeExplanation?.[resourceName] ?? \"\"}\r\n            key={resourceName}\r\n          />\r\n        );\r\n      }),\r\n    [props.isVisible !== false ? state : false],\r\n  );\r\n  return <View style={styles.container}>{rows}</View>;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"center\",\r\n    alignItems: \"stretch\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"flex-end\",\r\n  },\r\n  inlineRow: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  icon: {\r\n    marginRight: 2,\r\n  },\r\n  income: {\r\n    width: 65,\r\n    marginLeft: 8,\r\n  },\r\n});\r\n","import { Ionicons } from \"@expo/vector-icons\";\r\nimport React, { useCallback, useContext, useMemo, useRef } from \"react\";\r\nimport {\r\n  Platform,\r\n  ScrollView,\r\n  StyleSheet,\r\n  TouchableNativeFeedback,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\nimport { Badge, useTheme } from \"react-native-paper\";\r\nimport { clearFlag, setFlag } from \"../../backend/Flags\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { Resource, getResourceAmount } from \"../../backend/Resources\";\r\nimport { isExplorationUnlocked } from \"../../backend/exploration/Exploration\";\r\nimport { getTemporaryEffects } from \"../../backend/temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  getCurrentTimePieceSpeedupCost,\r\n  getCurrentTimePieceSpeedupSpeed,\r\n} from \"../../backend/timetick/TimePieces\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { Button } from \"../utility/Button\";\r\nimport CategoryContainer from \"../utility/CategoryContainer\";\r\nimport { PlayerCombatStatsViewer } from \"../utility/CombatStatsViewer\";\r\nimport { ElementViewer } from \"../utility/ElementViewer\";\r\nimport { KeyboardListener } from \"../utility/KeyboardListener\";\r\nimport { Markdown } from \"../utility/Markdown\";\r\nimport {\r\n  getAllMenuItems,\r\n  getAllSections,\r\n  getSectionInfo,\r\n  useLayoutType,\r\n} from \"../utility/Miscellaneous\";\r\nimport { ResourceViewer } from \"../utility/ResourceViewer\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { TemporaryEffectsViewer } from \"../utility/TemporaryEffectsViewer\";\r\nimport { Text } from \"../utility/Text\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\nimport { GameIcon } from \"../utility/icons/GameIcon\";\r\n\r\nconst boldHotkeyLetter = (title: string, hotkey: string, theme: any) => {\r\n  const hotkeyPos = title.toLowerCase().indexOf(hotkey.toLowerCase());\r\n  let firstHalf = \"\";\r\n  let lastHalf = \"\";\r\n\r\n  if (hotkeyPos == 0) {\r\n    lastHalf = title.substring(1);\r\n  } else {\r\n    firstHalf = title.substring(0, hotkeyPos);\r\n    lastHalf = title.substring(hotkeyPos + 1);\r\n  }\r\n\r\n  return (\r\n    <Text>\r\n      {firstHalf}\r\n      <Text style={[styles.hotkeyText, { color: theme.colors.tertiary }]}>\r\n        {hotkeyPos == 0 ? hotkey.toUpperCase() : hotkey.toLowerCase()}\r\n      </Text>\r\n      {lastHalf}\r\n    </Text>\r\n  );\r\n};\r\n\r\nconst MenuComponent = (\r\n  props: {\r\n    title: string;\r\n    section: string;\r\n    onPress: () => void;\r\n    showBadge: boolean;\r\n    showFavoriteIcon: boolean;\r\n    favorited: boolean;\r\n    onPressFavorite: () => void;\r\n    hotkey?: string;\r\n    wide?: boolean;\r\n    children: React.ReactNode;\r\n  } & any,\r\n) => {\r\n  const { title, onPress, showBadge, ...others } = props;\r\n  const theme = useTheme();\r\n  const visible = useContext(VisibilityContext);\r\n  const onKeyboard = useCallback(\r\n    (ev: KeyboardEvent) => {\r\n      if (!visible || props.hotkey == null) {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        ((!ev.shiftKey && !ev.ctrlKey) || (ev.shiftKey && ev.ctrlKey)) &&\r\n        ev.key.toLowerCase() == props.hotkey.toLowerCase()\r\n      ) {\r\n        onPress();\r\n      }\r\n    },\r\n    [visible, onPress],\r\n  );\r\n  const favoriteButton = useMemo(\r\n    () => (\r\n      <TouchableOpacity\r\n        accessibilityLabel={\r\n          props.favorited ? t(\"Unpin Section\") : t(\"Pin Section\")\r\n        }\r\n        onPress={props.onPressFavorite}\r\n        style={styles.favoriteButton}\r\n      >\r\n        <Ionicons\r\n          name={props.favorited ? \"heart\" : \"heart-outline\"}\r\n          color={theme.colors.onBackground}\r\n          size={14}\r\n        />\r\n      </TouchableOpacity>\r\n    ),\r\n    [props.favorited, props.onPressFavorite, theme],\r\n  );\r\n  return (\r\n    <View>\r\n      <KeyboardListener callback={onKeyboard} />\r\n      <TouchableOpacity\r\n        onPress={onPress}\r\n        Component={Platform.select<any>({\r\n          android: TouchableNativeFeedback,\r\n          default: TouchableOpacity,\r\n        })}\r\n        accessibilityLabel={title}\r\n        accessibilityRole=\"button\"\r\n        accessible={true}\r\n        focusable={true}\r\n        {...others}\r\n        style={[\r\n          styles.menuComponentTouch,\r\n          { borderColor: theme.colors.outlineVariant },\r\n          props.wide && { width: 96 },\r\n        ]}\r\n      >\r\n        <View style={styles.menuComponentButton}>\r\n          <GameIcon\r\n            /* @ts-expect-error accessibilityHidden is supported in web */\r\n            focusable={false}\r\n            accessibilityHidden={true}\r\n            icon={props.section.toLowerCase()}\r\n          />\r\n          {showBadge && <Badge style={styles.notificationBadge} size={8} />}\r\n          {props.showFavoriteIcon && favoriteButton}\r\n          <View style={Styles.mt2}>\r\n            {Platform.OS === \"web\" && props.hotkey ? (\r\n              <Text\r\n                style={[styles.menuItemText, props.wide && { fontSize: 13 }]}\r\n                numberOfLines={1}\r\n              >\r\n                {boldHotkeyLetter(title, props.hotkey, theme)}\r\n              </Text>\r\n            ) : (\r\n              <Text\r\n                style={[styles.menuItemText, props.wide && { fontSize: 13 }]}\r\n                numberOfLines={1}\r\n              >\r\n                {title}\r\n              </Text>\r\n            )}\r\n          </View>\r\n        </View>\r\n      </TouchableOpacity>\r\n    </View>\r\n  );\r\n};\r\n\r\nexport function MenuContents(props: {\r\n  visible: boolean;\r\n  pinnedSections: string[];\r\n  wide: boolean;\r\n  onPressFavorite: (section: string) => void;\r\n  onNavigationPress: (section: string) => void;\r\n}) {\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n\r\n  const layout = useLayoutType();\r\n\r\n  const favoritesFull =\r\n    props.pinnedSections.length >= layout.activeContentTabs - 1;\r\n\r\n  const menuComponent = useCallback(\r\n    (sectionKey: string, sectionTitle: string, menuProps?: any) => {\r\n      const sectionInfo = getSectionInfo(sectionKey);\r\n      return (\r\n        <MenuComponent\r\n          title={sectionTitle}\r\n          section={sectionKey}\r\n          key={sectionKey}\r\n          onPress={() => props.onNavigationPress(sectionKey)}\r\n          onPressFavorite={() => props.onPressFavorite(sectionKey)}\r\n          favorited={props.pinnedSections.includes(sectionKey)}\r\n          showFavoriteIcon={\r\n            (props.pinnedSections.includes(sectionKey) || !favoritesFull) &&\r\n            !sectionInfo.fullScreen\r\n          }\r\n          wide={props.wide}\r\n          {...(menuProps ?? {})}\r\n        />\r\n      );\r\n    },\r\n    [\r\n      props.onNavigationPress,\r\n      props.onPressFavorite,\r\n      props.wide,\r\n      props.pinnedSections.join(),\r\n      favoritesFull,\r\n    ],\r\n  );\r\n\r\n  const menuItems = getAllMenuItems(state);\r\n  const sectionInfo = getAllSections();\r\n  const badgeCacheKey = sectionInfo\r\n    .map((section) => (section.isBadged?.(state) ? \"y\" : \"n\"))\r\n    .join();\r\n\r\n  const navigation = useMemo(\r\n    () => (\r\n      <View style={[styles.navigationBlock, props.wide && { width: 300 }]}>\r\n        {menuItems.map((item, idx) =>\r\n          menuComponent(\r\n            item,\r\n            sectionInfo.find((section) => section.id == item)?.name,\r\n            {\r\n              topDivider: idx == 0,\r\n              showBadge: sectionInfo\r\n                .find((section) => section.id == item)\r\n                ?.isBadged?.(state),\r\n              hotkey: sectionInfo.find((section) => section.id == item)?.hotkey,\r\n            },\r\n          ),\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      props.onNavigationPress,\r\n      props.onPressFavorite,\r\n      menuComponent,\r\n      menuItems.join(\",\"),\r\n      badgeCacheKey,\r\n    ],\r\n  );\r\n\r\n  const hasTemporaryEffects = getTemporaryEffects(state).length > 0;\r\n\r\n  const gameSpeed = getCurrentTimePieceSpeedupSpeed(state);\r\n  const hasTimePieces = getResourceAmount(state, Resource.TimePiece) > 0;\r\n  const speedupCost = getCurrentTimePieceSpeedupCost(state);\r\n  const timePieceCost = t(\"{{timepiecePerSec}}:timepiece:/extra sec\", {\r\n    timepiecePerSec: formatNumber(speedupCost),\r\n  });\r\n\r\n  const showExploration = isExplorationUnlocked(state);\r\n\r\n  const theme = useTheme();\r\n\r\n  return useMemo(\r\n    () => (\r\n      <ScrollView\r\n        style={[\r\n          styles.scrollContainer,\r\n          { backgroundColor: theme.colors.background },\r\n        ]}\r\n        contentContainerStyle={styles.scrollContentContainer}\r\n      >\r\n        <View style={styles.titleContainer}>\r\n          <Text h1>{t(\"Magic Research 2\")}</Text>\r\n        </View>\r\n        {navigation}\r\n        {hasTimePieces && (\r\n          <CategoryContainer title={t(\"Speed up time\")}>\r\n            <View style={styles.timePieceButtonsContainer}>\r\n              <Text>{t(\"Set game speed:\")}</Text>\r\n              <Button\r\n                onPress={() =>\r\n                  stateRef.current.apply((state) => {\r\n                    state = clearFlag(\"time_piece_5x_speedup_enabled\")(state);\r\n                    state = clearFlag(\"time_piece_speedup_enabled\")(state);\r\n                    return state;\r\n                  })\r\n                }\r\n                compact={true}\r\n                labelStyle={styles.timePieceButtonTitle}\r\n                style={[styles.timePieceButtonContainer]}\r\n              >\r\n                {t(\"Normal\")}\r\n              </Button>\r\n              <Button\r\n                onPress={() =>\r\n                  stateRef.current.apply((state) => {\r\n                    state = clearFlag(\"time_piece_5x_speedup_enabled\")(state);\r\n                    state = setFlag(\"time_piece_speedup_enabled\")(state);\r\n                    return state;\r\n                  })\r\n                }\r\n                compact={true}\r\n                labelStyle={styles.timePieceButtonTitle}\r\n                style={[styles.timePieceButtonContainer]}\r\n              >\r\n                {t(\"2x\")}\r\n              </Button>\r\n              <Button\r\n                onPress={() =>\r\n                  stateRef.current.apply((state) => {\r\n                    state = setFlag(\"time_piece_5x_speedup_enabled\")(state);\r\n                    state = clearFlag(\"time_piece_speedup_enabled\")(state);\r\n                    return state;\r\n                  })\r\n                }\r\n                compact={true}\r\n                labelStyle={styles.timePieceButtonTitle}\r\n                style={[styles.timePieceButtonContainer]}\r\n              >\r\n                {t(\"5x\")}\r\n              </Button>\r\n            </View>\r\n            <View style={styles.timePieceTextRows}>\r\n              <Text>{t(\"Current speed:\")}</Text>\r\n              <Text>{t(\"{{speed}}x\", { speed: gameSpeed })}</Text>\r\n            </View>\r\n            {gameSpeed > 1 && (\r\n              <View style={styles.timePieceTextRows}>\r\n                <View>\r\n                  <Text>{t(\"Time Piece cost:\")}</Text>\r\n                </View>\r\n                <View>\r\n                  <Markdown>{timePieceCost}</Markdown>\r\n                </View>\r\n              </View>\r\n            )}\r\n          </CategoryContainer>\r\n        )}\r\n        <CategoryContainer title={t(\"Resources\")}>\r\n          <View style={styles.statViewer}>\r\n            <ResourceViewer isVisible={props.visible} />\r\n          </View>\r\n        </CategoryContainer>\r\n        <CategoryContainer title={t(\"Elements\")}>\r\n          <View style={styles.statViewer}>\r\n            <ElementViewer isVisible={props.visible} />\r\n          </View>\r\n        </CategoryContainer>\r\n        {showExploration && (\r\n          <CategoryContainer title=\"Combat\">\r\n            <View style={styles.statViewer}>\r\n              <PlayerCombatStatsViewer isVisible={props.visible} />\r\n            </View>\r\n          </CategoryContainer>\r\n        )}\r\n        {hasTemporaryEffects && (\r\n          <CategoryContainer title={t(\"Buffs\")}>\r\n            <TemporaryEffectsViewer isVisible={props.visible} />\r\n          </CategoryContainer>\r\n        )}\r\n      </ScrollView>\r\n    ),\r\n    [\r\n      navigation,\r\n      hasTemporaryEffects,\r\n      hasTimePieces,\r\n      gameSpeed,\r\n      props.visible,\r\n      theme,\r\n    ],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"stretch\",\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: 300,\r\n    left: 0,\r\n    top: 0,\r\n    zIndex: 140,\r\n  },\r\n  scrollContainer: {\r\n    padding: 8,\r\n    flex: 1,\r\n  },\r\n  scrollContentContainer: {\r\n    paddingBottom: 16,\r\n  },\r\n  titleContainer: { marginBottom: 8 },\r\n  navigationBlock: {\r\n    marginTop: 16,\r\n    width: 261,\r\n    flexWrap: \"wrap\",\r\n    flexDirection: \"row\",\r\n  },\r\n  navigationRowTitle: { paddingVertical: 0 },\r\n  timePieceButtonContainer: { marginLeft: 4 },\r\n  timePieceButtonTitle: { fontSize: 12 },\r\n  statViewer: {\r\n    marginTop: 4,\r\n  },\r\n  timePieceButtonsContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n    marginTop: 8,\r\n  },\r\n  timePieceTextRows: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n    marginTop: 4,\r\n  },\r\n  expandContainer: {\r\n    width: 32,\r\n    alignSelf: \"center\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    cursor: \"pointer\",\r\n  },\r\n  favoriteButton: {\r\n    position: \"absolute\",\r\n    top: 4,\r\n    left: 4,\r\n  },\r\n  // notificationBadge: {\r\n  //   position: \"absolute\",\r\n  //   top: 4,\r\n  //   right: 4,\r\n  // },\r\n  notificationBadge: {\r\n    position: \"absolute\",\r\n    top: 4,\r\n    right: 24,\r\n  },\r\n  notificationBadgeSize: {\r\n    height: 12,\r\n    width: 12,\r\n  },\r\n  hotkeyText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n  menuComponentTouch: {\r\n    height: 56,\r\n    width: 83,\r\n    margin: 2,\r\n    borderWidth: StyleSheet.hairlineWidth,\r\n  },\r\n  menuComponentButton: {\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    flex: 1,\r\n  },\r\n  menuItemText: {\r\n    fontSize: 11,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport {\r\n  Platform,\r\n  ScrollView,\r\n  StyleSheet,\r\n  View,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\nimport { useTheme } from \"react-native-paper\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { ActionArea } from \"../../backend/action/ActionAreas\";\r\nimport { getFavoriteSpells } from \"../../backend/spells/Spells\";\r\nimport Styles from \"../utility/Styles\";\r\nimport { VisibilityContext } from \"../utility/VisibilityContext\";\r\nimport { FavoriteSpellsContainer } from \"./FavoriteSpellsContainer\";\r\nimport SpellsContainer from \"./SpellsContainer\";\r\n\r\ntype Props = {\r\n  favoritesOnBottom: boolean;\r\n};\r\n\r\nexport function SpellMenuContents(props: { favoritesOnBottom: boolean }) {\r\n  const theme = useTheme();\r\n  const state = useContext(StateContext);\r\n  const visible = useContext(VisibilityContext);\r\n  const isBottomMenuEnabled = state.options.enableBottomMenu;\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  const heightWithoutBottomMenu =\r\n    height - (isBottomMenuEnabled && width < 640 ? 48 : 0);\r\n  const hasFavorites = getFavoriteSpells(state).length > 0;\r\n  return useMemo(\r\n    () => (\r\n      <View style={{ flex: 1, backgroundColor: theme.colors.background }}>\r\n        <ScrollView\r\n          style={{ flex: 1 }}\r\n          contentContainerStyle={styles.magicContainer}\r\n        >\r\n          <SpellsContainer\r\n            uiKey=\"SpellMenuContainer\"\r\n            area={ActionArea.SPELL_MENU}\r\n            onlyBySchool={props.favoritesOnBottom}\r\n            showWizards={true}\r\n            isVisible={visible}\r\n          />\r\n        </ScrollView>\r\n        {props.favoritesOnBottom && hasFavorites && (\r\n          <View\r\n            style={{\r\n              height: Math.max(\r\n                Math.min(heightWithoutBottomMenu - 472, 270),\r\n                180,\r\n              ),\r\n              borderTopColor: theme.colors.outlineVariant,\r\n              borderTopWidth: 1,\r\n            }}\r\n          >\r\n            {Platform.select({\r\n              default: (\r\n                <View style={[styles.favoritesContainer, Styles.flex]}>\r\n                  <FavoriteSpellsContainer />\r\n                </View>\r\n              ),\r\n              web: (\r\n                <ScrollView contentContainerStyle={styles.favoritesContainer}>\r\n                  <FavoriteSpellsContainer />\r\n                </ScrollView>\r\n              ),\r\n            })}\r\n          </View>\r\n        )}\r\n      </View>\r\n    ),\r\n    [\r\n      theme,\r\n      hasFavorites,\r\n      props.favoritesOnBottom,\r\n      heightWithoutBottomMenu,\r\n      visible,\r\n    ],\r\n  );\r\n}\r\n\r\nexport function SpellMenu(props: Props) {\r\n  return useMemo(() => {\r\n    return <SpellMenuContents favoritesOnBottom={props.favoritesOnBottom} />;\r\n  }, [props.favoritesOnBottom]);\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  backdrop: {\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n    backgroundColor: \"#000\",\r\n    zIndex: 80,\r\n  },\r\n  backdropTouchable: {\r\n    position: \"absolute\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n    zIndex: 90,\r\n  },\r\n  container: {\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"stretch\",\r\n    position: \"absolute\",\r\n    zIndex: 100,\r\n    height: \"100%\",\r\n    width: 300,\r\n    right: 0,\r\n    top: 0,\r\n  },\r\n  magicContainer: {\r\n    padding: 8,\r\n  },\r\n  favoritesContainer: {\r\n    paddingHorizontal: 8,\r\n    paddingBottom: 8,\r\n  },\r\n});\r\n","import React, { useContext, useMemo } from \"react\";\r\nimport { StyleSheet, View } from \"react-native\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { Text } from \"./Text\";\r\n\r\nexport function DebugUPSOverlay(props: {}) {\r\n  const state = useContext(StateContext);\r\n  const showOverlay = state.global.debugShowUpdatesPerSec;\r\n  if (!showOverlay) {\r\n    return null;\r\n  }\r\n  const timestamps = state.global.debugLastUpdateTimestamps;\r\n  if (timestamps.length < 2) {\r\n    return null;\r\n  }\r\n  const startEndTimestamps = state.global.debugLastUpdateBeginEndTimestamps;\r\n  if (startEndTimestamps.length < 1) {\r\n    return null;\r\n  }\r\n  const msPerUpdate =\r\n    (timestamps[timestamps.length - 1] - timestamps[0]) /\r\n    (timestamps.length - 1);\r\n  if (msPerUpdate <= 0) {\r\n    return null;\r\n  }\r\n  const backendMsPerUpdate =\r\n    startEndTimestamps\r\n      .map((value) => value.end - value.begin)\r\n      .reduce((prev, current) => prev + current, 0) / startEndTimestamps.length;\r\n  const ticksPerUpdate =\r\n    startEndTimestamps\r\n      .map((value) => value.ticksRun)\r\n      .reduce((prev, current) => prev + current, 0) / startEndTimestamps.length;\r\n  const updatesPerSec = 1000 / msPerUpdate;\r\n  const estimatedMsPerUpdate = msPerUpdate - 1000.0 / state.options.targetFps;\r\n  return useMemo(\r\n    () => (\r\n      <View style={styles.overlay}>\r\n        <View>\r\n          <Text>\r\n            Actual UPS: {formatNumber(updatesPerSec, { showDecimals: true })}\r\n          </Text>\r\n        </View>\r\n        <View>\r\n          <Text>\r\n            Time/update:{\" \"}\r\n            {formatNumber(estimatedMsPerUpdate, { showDecimals: true })}ms\r\n          </Text>\r\n        </View>\r\n        <View>\r\n          <Text>\r\n            Backend ms:{\" \"}\r\n            {formatNumber(backendMsPerUpdate, { showDecimals: true })}\r\n            ms\r\n          </Text>\r\n        </View>\r\n        <View>\r\n          <Text>\r\n            Ticks/update: {formatNumber(ticksPerUpdate, { showDecimals: true })}\r\n          </Text>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [Math.floor(Date.now() / 1000)],\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  overlay: {\r\n    position: \"absolute\",\r\n    right: 50,\r\n    top: 50,\r\n    opacity: 0.8,\r\n    zIndex: 999999,\r\n  },\r\n});\r\n","import React, { ErrorInfo } from \"react\";\r\n\r\ntype Props = { children: React.ReactNode; errorFallback: React.ReactNode };\r\n\r\nexport class ErrorBoundary extends React.Component<Props> {\r\n  state = {\r\n    hasError: false,\r\n    error: null,\r\n  };\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  static getDerivedStateFromError(error: any) {\r\n    return { hasError: true, error: error };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    // TODO: we probably want to log this somewhere\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return this.props.errorFallback;\r\n    }\r\n    return this.props.children;\r\n  }\r\n}\r\n","import { useCallback } from \"react\";\r\nimport { electron, isElectron } from \"../../utils/ElectronUtils\";\r\nimport { KeyboardListener } from \"./KeyboardListener\";\r\n\r\nexport function FullScreenListener() {\r\n  if (!isElectron()) {\r\n    return null;\r\n  }\r\n\r\n  const callback = useCallback((e: KeyboardEvent) => {\r\n    if (e.key == \"F11\" || (e.key == \"Enter\" && e.altKey)) {\r\n      electron().ipcRenderer.send(\"toggleFullscreen\");\r\n    }\r\n  }, []);\r\n\r\n  return <KeyboardListener callback={callback} />;\r\n}\r\n","import { useKeepAwake } from \"expo-keep-awake\";\r\n\r\nexport function KeepAwake() {\r\n  useKeepAwake();\r\n  return null;\r\n}\r\n","import { useCallback, useContext, useEffect, useRef } from \"react\";\r\nimport { StateContext } from \"../../backend/GameState\";\r\nimport { serializeSaveData } from \"../../backend/SaveData\";\r\nimport { electron, isElectron } from \"../../utils/ElectronUtils\";\r\n\r\nexport function SaveDataBackupper() {\r\n  if (!isElectron()) {\r\n    return null;\r\n  }\r\n\r\n  const state = useContext(StateContext);\r\n\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n\r\n  const backupCallback = useCallback(async () => {\r\n    electron().ipcRenderer.send(\r\n      \"saveFileBackup\",\r\n      await serializeSaveData(stateRef.current),\r\n    );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        await backupCallback();\r\n      } catch (e: any) {\r\n        throw e;\r\n      }\r\n    }, 15 * 60 * 1000); // 15 min\r\n    return () => {\r\n      clearTimeout(interval);\r\n    };\r\n  }, [backupCallback]);\r\n\r\n  useEffect(() => {\r\n    window.addEventListener(\"beforeunload\", backupCallback);\r\n    return () => window.removeEventListener(\"beforeunload\", backupCallback);\r\n  }, [backupCallback]);\r\n\r\n  // Do not render anything\r\n  return null;\r\n}\r\n","import { MaterialIcons, SimpleLineIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport * as Clipboard from \"expo-clipboard\";\r\nimport * as NavigationBar from \"expo-navigation-bar\";\r\nimport { StatusBar } from \"expo-status-bar\";\r\nimport React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n  useTransition,\r\n} from \"react\";\r\nimport {\r\n  AccessibilityInfo,\r\n  ActivityIndicator,\r\n  Animated,\r\n  BackHandler,\r\n  I18nManager,\r\n  Platform,\r\n  SafeAreaView,\r\n  ScrollView,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  View,\r\n  useWindowDimensions,\r\n} from \"react-native\";\r\nimport { Drawer } from \"react-native-drawer-layout\";\r\nimport \"react-native-gesture-handler\";\r\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\r\nimport {\r\n  Appbar,\r\n  Badge,\r\n  IconButton,\r\n  Button as PaperButton,\r\n  Provider as PaperProvider,\r\n  Portal,\r\n  Text,\r\n  useTheme,\r\n} from \"react-native-paper\";\r\nimport {\r\n  SafeAreaProvider,\r\n  initialWindowMetrics,\r\n  useSafeAreaInsets,\r\n} from \"react-native-safe-area-context\";\r\nimport { getThemeByElementAndDarkMode } from \"./Themes\";\r\nimport { clearAllCaches } from \"./backend/Caching\";\r\nimport { clearFlag, hasFlag, setFlag } from \"./backend/Flags\";\r\nimport {\r\n  GameState,\r\n  GameStateTransform,\r\n  INITIAL_STATE,\r\n  StateContext,\r\n  StateContextValue,\r\n} from \"./backend/GameState\";\r\nimport {\r\n  addGameStateListener,\r\n  applyAllTransforms,\r\n  clearGameStateListener,\r\n} from \"./backend/GameStateListeners\";\r\nimport { loadData, saveData, serializeSaveData } from \"./backend/SaveData\";\r\nimport { getUICommands } from \"./backend/UICommands\";\r\nimport { EndingCloseListeners } from \"./backend/ending/Endings\";\r\nimport { getEventMessageById } from \"./backend/events/Events\";\r\nimport { nextFrame } from \"./backend/timetick/TimeTick\";\r\nimport { getSecondsPlayed } from \"./backend/timetick/TotalTimePlayed\";\r\nimport About from \"./components/About\";\r\nimport Boosts from \"./components/Boosts\";\r\nimport Compendium from \"./components/Compendium\";\r\nimport Debug from \"./components/Debug\";\r\nimport Ending from \"./components/Ending\";\r\nimport Enhance from \"./components/Enhance\";\r\nimport Exploration from \"./components/Exploration\";\r\nimport { FamiliarsComponent } from \"./components/Familiars\";\r\nimport Help from \"./components/Help\";\r\nimport Home from \"./components/Home\";\r\nimport Intro from \"./components/Intro\";\r\nimport Inventory from \"./components/Inventory\";\r\nimport { Loading } from \"./components/Loading\";\r\nimport Options from \"./components/Options\";\r\nimport Retirement from \"./components/Retirement\";\r\nimport { RitualsComponent } from \"./components/Rituals\";\r\nimport { SpellcraftsComponent } from \"./components/Spellcraft\";\r\nimport Stats from \"./components/Stats\";\r\nimport { Study } from \"./components/Study\";\r\nimport Synchro from \"./components/Synchro\";\r\nimport Transmute from \"./components/Transmute\";\r\nimport Wizards from \"./components/Wizards\";\r\nimport Worlds from \"./components/Worlds\";\r\nimport { EventList } from \"./components/events/EventList\";\r\nimport { EventOverlay } from \"./components/events/EventOverlay\";\r\nimport { BottomMenu } from \"./components/main/BottomMenu\";\r\nimport GameTickProcessor from \"./components/main/GameTickProcessor\";\r\nimport ManaBar from \"./components/main/ManaBar\";\r\nimport { MenuContents } from \"./components/main/Menu\";\r\nimport { SpellMenu } from \"./components/spells/SpellMenu\";\r\nimport { AccessibilityContext } from \"./components/utility/AccessibilityContext\";\r\nimport {\r\n  AuxOptionsContext,\r\n  useAuxOptions,\r\n} from \"./components/utility/AuxOptionsContext\";\r\nimport { BottomResourceViewer } from \"./components/utility/BottomResourceViewer\";\r\nimport { DebugUPSOverlay } from \"./components/utility/DebugUPSOverlay\";\r\nimport { ErrorBoundary } from \"./components/utility/ErrorBoundary\";\r\nimport { FullScreenListener } from \"./components/utility/FullScreenListener\";\r\nimport { GameStateFreezer } from \"./components/utility/GameStateFreezer\";\r\nimport { KeepAwake } from \"./components/utility/KeepAwake\";\r\nimport {\r\n  getAllSections,\r\n  getLayoutType,\r\n} from \"./components/utility/Miscellaneous\";\r\nimport { SaveDataBackupper } from \"./components/utility/SaveDataBackupper\";\r\nimport Styles from \"./components/utility/Styles\";\r\nimport { Text as UtilityText } from \"./components/utility/Text\";\r\nimport { TooltipDisplay } from \"./components/utility/Tooltip\";\r\nimport {\r\n  EMPTY_TOOLTIP_CONTEXT,\r\n  TooltipContent,\r\n  TooltipContext,\r\n  TooltipControlContext,\r\n  TooltipPosition,\r\n} from \"./components/utility/TooltipContext\";\r\nimport {\r\n  UIContext,\r\n  useUIStateFromContext,\r\n} from \"./components/utility/UIContext\";\r\nimport { VisibilityContext } from \"./components/utility/VisibilityContext\";\r\nimport { clone, keysOf } from \"./utils/CoreUtils\";\r\nimport { SAVE_TO_FILE_SUPPORTED, saveToFile } from \"./utils/FilesystemSave\";\r\nimport { formatNumber } from \"./utils/FormattingUtils\";\r\nimport { t } from \"./utils/I18n\";\r\nimport { OrientationLockManager } from \"./utils/OrientationLockManager\";\r\nimport {\r\n  getCurrentVersion,\r\n  getCurrentVersionTimestamp,\r\n} from \"./utils/Versioning\";\r\nimport { ZoomChecker } from \"./utils/Zoom\";\r\n\r\nI18nManager.allowRTL(false);\r\n\r\nfunction BottomSafeAreaPadding() {\r\n  const safeAreaInsets = useSafeAreaInsets();\r\n  const theme = useTheme();\r\n  if (Platform.OS != \"ios\" && Platform.OS != \"android\") {\r\n    return null;\r\n  }\r\n  return (\r\n    <View\r\n      style={{\r\n        backgroundColor: theme.colors.surface,\r\n        height: safeAreaInsets.bottom,\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nfunction IntroContents() {\r\n  const theme = useTheme();\r\n  const headerContainerStyle = useMemo(\r\n    () => ({\r\n      borderBottomColor: theme.colors.outlineVariant,\r\n      borderBottomWidth: 2,\r\n    }),\r\n    [theme],\r\n  );\r\n  const centerComponent = useMemo(\r\n    () => (\r\n      <View style={styles.centerText}>\r\n        <Text\r\n          accessibilityRole=\"header\"\r\n          style={{ color: theme.colors.primary }}\r\n        >\r\n          {t(\"Magic Research 2\")}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [theme],\r\n  );\r\n  return (\r\n    <View style={styles.maxContainer} nativeID={theme.dark ? \"dark\" : \"light\"}>\r\n      <OrientationLockManager />\r\n      <View style={styles.safeAreaContainer}>\r\n        <Appbar.Header style={headerContainerStyle}>\r\n          {centerComponent}\r\n        </Appbar.Header>\r\n        <View\r\n          style={[\r\n            styles.biggerContainer,\r\n            { backgroundColor: theme.colors.background },\r\n          ]}\r\n        >\r\n          <View style={styles.introContainer}>\r\n            <ScrollView>\r\n              <Intro />\r\n            </ScrollView>\r\n            <BottomSafeAreaPadding />\r\n          </View>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\ntype MainAppContentsProps = {\r\n  setPlayerState: any;\r\n  onLoadingProgress: any;\r\n};\r\n\r\nfunction resetKeys(pinnedSectionObjects: { section: string; key: number }[]) {\r\n  for (let idx in pinnedSectionObjects) {\r\n    pinnedSectionObjects[idx].key = Number.parseInt(idx) + 1;\r\n  }\r\n  return pinnedSectionObjects;\r\n}\r\n\r\nfunction MainAppContents(props: MainAppContentsProps) {\r\n  const { height, width } = useWindowDimensions();\r\n  const auxOptions = useAuxOptions();\r\n  const state = useContext(StateContext);\r\n  const stateRef = useRef(state);\r\n  stateRef.current = state;\r\n  const uiContext = useContext(UIContext);\r\n\r\n  const [menuShown, setMenuShown] = useState(false);\r\n  const [rightMenuShown, setRightMenuShown] = useState(\"none\");\r\n  const layout = getLayoutType(state, height, width);\r\n\r\n  const allSections = getAllSections();\r\n  const sectionData = Object.fromEntries(\r\n    allSections.map((section) => [section.id, section]),\r\n  );\r\n\r\n  const [section, setSection] = useState(\"Home\");\r\n  const [pinnedSectionObjects, setPinnedSectionObjects] = useState<\r\n    { section: string; key: number }[]\r\n  >([]);\r\n  const pinnedSectionObjectsRef = useRef(pinnedSectionObjects);\r\n  pinnedSectionObjectsRef.current = pinnedSectionObjects;\r\n\r\n  const activeSections = [\r\n    section,\r\n    ...pinnedSectionObjects.map((pinnedSection) => pinnedSection.section),\r\n  ];\r\n  const [_uiActiveSections, setUiActiveSections] = useUIStateFromContext(\r\n    uiContext,\r\n    \"active_sections\",\r\n    activeSections,\r\n  );\r\n\r\n  useEffect(() => {\r\n    setUiActiveSections(activeSections);\r\n  }, [JSON.stringify(activeSections)]);\r\n\r\n  useEffect(() => {\r\n    if (layout.activeContentTabs == 1) {\r\n      setPinnedSectionObjects([]);\r\n    }\r\n    const newSectionObjects = pinnedSectionObjectsRef.current.slice(\r\n      0,\r\n      layout.activeContentTabs - 1,\r\n    );\r\n    setPinnedSectionObjects(resetKeys(newSectionObjects));\r\n  }, [layout.activeContentTabs]);\r\n\r\n  const togglePinnedSection = useCallback(\r\n    (section: string) => {\r\n      // If the section is already there, remove it\r\n      if (pinnedSectionObjectsRef.current.find((s) => s.section == section)) {\r\n        setPinnedSectionObjects(\r\n          pinnedSectionObjectsRef.current.filter((s) => s.section != section),\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Otherwise, choose the smallest possible index, and push it to the end\r\n      // Obtain the lowest free key, so that we are constantly reusing numbers\r\n      // so that we don't need to re-load things\r\n      const usedIndices = pinnedSectionObjectsRef.current.map((s) => s.key);\r\n      let lowestFreeIndex = 1;\r\n      while (usedIndices.includes(lowestFreeIndex)) {\r\n        lowestFreeIndex++;\r\n      }\r\n      const newPinnedSectionObjects = [\r\n        ...pinnedSectionObjectsRef.current,\r\n        { section: section, key: lowestFreeIndex },\r\n      ];\r\n      setPinnedSectionObjects(\r\n        newPinnedSectionObjects.slice(0, layout.activeContentTabs - 1),\r\n      );\r\n\r\n      // Finally, if the current selected section is the one that was pinned,\r\n      // we want to reset it to something new\r\n    },\r\n    [setPinnedSectionObjects, JSON.stringify(layout)],\r\n  );\r\n\r\n  const theme = useTheme();\r\n\r\n  const [endingHistoryIndex, setEndingHistoryIndex] = useState(null);\r\n\r\n  const processUICommand = useCallback(\r\n    (uiCommand: string) => {\r\n      if (\r\n        uiCommand == \"goToExploration\" &&\r\n        !activeSections.includes(\"Exploration\")\r\n      ) {\r\n        setSection(\"Exploration\");\r\n      } else if (\r\n        uiCommand == \"goToEnding\" &&\r\n        !activeSections.includes(\"Ending\")\r\n      ) {\r\n        setSection(\"Ending\");\r\n        setPinnedSectionObjects([]);\r\n      } else if (uiCommand == \"goToDebug\") {\r\n        setSection(\"Debug\");\r\n      } else if (uiCommand == \"closeAllMenus\") {\r\n        setMenuShown(false);\r\n        setRightMenuShown(\"none\");\r\n      } else if (uiCommand.startsWith(\"endingHistoryOverride:\")) {\r\n        setEndingHistoryIndex(uiCommand.split(\":\")[1]);\r\n      }\r\n    },\r\n    [\r\n      setSection,\r\n      activeSections,\r\n      setPinnedSectionObjects,\r\n      setEndingHistoryIndex,\r\n    ],\r\n  );\r\n\r\n  const processUICommands = useCallback(\r\n    (state: GameState) => {\r\n      const uiCommands = getUICommands(state);\r\n      uiCommands.forEach(processUICommand);\r\n      state.run.uiCommands = uiCommands.filter(\r\n        (uiCommand) =>\r\n          uiCommand != \"goToExploration\" &&\r\n          uiCommand != \"goToEnding\" &&\r\n          uiCommand != \"closeAllMenus\" &&\r\n          !uiCommand.startsWith(\"endingHistoryOverride:\") &&\r\n          uiCommand != \"goToDebug\",\r\n      );\r\n      return state;\r\n    },\r\n    [processUICommand],\r\n  );\r\n\r\n  useEffect(() => {\r\n    addGameStateListener(\"appUiCommand\", (newState) => {\r\n      const uiCommands = getUICommands(newState);\r\n      if (\r\n        uiCommands.filter(\r\n          (command) =>\r\n            [\r\n              \"goToExploration\",\r\n              \"goToEnding\",\r\n              \"closeAllMenus\",\r\n              \"goToDebug\",\r\n            ].includes(command) || command.startsWith(\"endingHistoryOverride:\"),\r\n        ).length > 0\r\n      ) {\r\n        return (state) => processUICommands(state);\r\n      }\r\n    });\r\n    return () => clearGameStateListener(\"appUiCommand\");\r\n  }, [processUICommands]);\r\n\r\n  const onMenuPress = useCallback(() => {\r\n    setMenuShown(!menuShown);\r\n    setRightMenuShown(\"none\");\r\n  }, [menuShown]);\r\n  const onMenuOpen = useCallback(() => {\r\n    setMenuShown(true);\r\n    setRightMenuShown(\"none\");\r\n  }, []);\r\n  const onMenuClose = useCallback(() => {\r\n    setMenuShown(false);\r\n  }, []);\r\n  const onEventMenuPress = useCallback(() => {\r\n    if (rightMenuShown !== \"event\") {\r\n      setRightMenuShown(\"event\");\r\n    } else {\r\n      setRightMenuShown(\"none\");\r\n    }\r\n    setMenuShown(false);\r\n  }, [rightMenuShown]);\r\n  const onEventMenuOpen = useCallback(() => {\r\n    setMenuShown(false);\r\n    setRightMenuShown(\"event\");\r\n  }, []);\r\n  const onSpellMenuOpen = useCallback(() => {\r\n    setMenuShown(false);\r\n    setRightMenuShown(\"spell\");\r\n  }, []);\r\n  const onRightMenuClose = useCallback(() => {\r\n    setMenuShown(false);\r\n    setRightMenuShown(\"none\");\r\n  }, []);\r\n  const onSpellMenuPress = useCallback(() => {\r\n    if (rightMenuShown !== \"spell\") {\r\n      setRightMenuShown(\"spell\");\r\n    } else {\r\n      setRightMenuShown(\"none\");\r\n    }\r\n    setMenuShown(false);\r\n  }, [rightMenuShown]);\r\n  const onNavigationPress = useCallback(\r\n    (section: string) => {\r\n      setSection(section);\r\n      setMenuShown(false);\r\n      setRightMenuShown(\"none\");\r\n    },\r\n    [setSection],\r\n  );\r\n\r\n  const ongoingEventCount = Object.values(state.run.eventOccurrences).filter(\r\n    (event) => {\r\n      return (\r\n        event.currentMessageId &&\r\n        !getEventMessageById(event.currentMessageId).isTerminal() &&\r\n        getEventMessageById(event.currentMessageId).isActionable(\r\n          state,\r\n          event.params,\r\n        )\r\n      );\r\n    },\r\n  ).length;\r\n\r\n  useEffect(() => {\r\n    setSection(\"Home\");\r\n    setPinnedSectionObjects([]);\r\n  }, [state.world.totalTimesResetted]);\r\n\r\n  const showBottomResourceBar =\r\n    !layout.wideLayout &&\r\n    !sectionData[activeSections[0]]?.hideBottomResourceBar &&\r\n    !state.options.hideBottomResourceViewer &&\r\n    keysOf(state.run.resources).length > 1;\r\n\r\n  const centerComponent = useMemo(\r\n    () => (\r\n      <View style={styles.centerText}>\r\n        <Text\r\n          accessibilityRole=\"header\"\r\n          style={{ color: theme.colors.primary }}\r\n        >\r\n          {activeSections.length == 1\r\n            ? activeSections[0]\r\n            : t(\"Magic Research 2\")}\r\n        </Text>\r\n      </View>\r\n    ),\r\n    [activeSections.join(), theme],\r\n  );\r\n\r\n  const scrollRefs = Object.fromEntries(\r\n    allSections.map((section) => [section.id, useRef<ScrollView>()]),\r\n  );\r\n  scrollRefs[\"Main\"] = useRef<ScrollView>();\r\n\r\n  const [scrollPositions, setScrollPositions] = useUIStateFromContext<\r\n    Record<string, number>\r\n  >(uiContext, \"mainScrollPositions\", {});\r\n  const onScrollPerSection = useMemo(() => {\r\n    return Object.fromEntries(\r\n      allSections.map((sectionData) => [\r\n        sectionData.id,\r\n        (event: any) => {\r\n          const scrollValue = event.nativeEvent.contentOffset.y;\r\n          scrollPositions[sectionData.id] = scrollValue;\r\n          // console.warn(\r\n          //   \"setting \" +\r\n          //     sectionData.id +\r\n          //     \" to \" +\r\n          //     scrollPositions?.[sectionData.id],\r\n          // );\r\n          setScrollPositions(scrollPositions);\r\n        },\r\n      ]),\r\n    );\r\n  }, []);\r\n  useEffect(() => {\r\n    for (let section of activeSections) {\r\n      if (!sectionData[section]?.scrollable) {\r\n        return;\r\n      }\r\n      const shouldScroll = Platform.select({ default: true, web: false });\r\n      if (!shouldScroll) {\r\n        return;\r\n      }\r\n      // console.warn(\"scrolling\" + section + \" to \" + scrollPositions?.[section]);\r\n      if (sectionData[section].scrollView) {\r\n        scrollRefs[\"Main\"].current.scrollTo({\r\n          y: scrollPositions?.[section] ?? 0,\r\n          animated: false,\r\n        });\r\n      } else {\r\n        scrollRefs[section]?.current?.scrollTo?.({\r\n          y: scrollPositions?.[section] ?? 0,\r\n          animated: false,\r\n        });\r\n      }\r\n    }\r\n  }, [activeSections.join(\",\")]);\r\n\r\n  const showBottomMenu = state.options.enableBottomMenu;\r\n  const leftHandedMode = state.options.leftHandedMode;\r\n  const putCastSpellOnBottomMenu = state.options.putCastSpellOnBottomMenu;\r\n\r\n  function wrapInSection(\r\n    component: React.ReactElement,\r\n    sectionTitle: string,\r\n    activeSection: string,\r\n    keepInMemory: boolean,\r\n    insets: { top?: number; bottom?: number },\r\n    fullScreen?: boolean,\r\n    backgroundColor?: string,\r\n  ) {\r\n    let contents = null;\r\n    if (!keepInMemory) {\r\n      contents =\r\n        activeSection != sectionTitle ? (\r\n          <View key={sectionTitle} />\r\n        ) : (\r\n          <View key={sectionTitle}>{component}</View>\r\n        );\r\n    } else {\r\n      contents = (\r\n        <View\r\n          key={sectionTitle}\r\n          style={activeSection != sectionTitle && { display: \"none\" }}\r\n        >\r\n          <GameStateFreezer isVisible={activeSection == sectionTitle}>\r\n            {component}\r\n          </GameStateFreezer>\r\n        </View>\r\n      );\r\n    }\r\n\r\n    if (fullScreen) {\r\n      return activeSection == sectionTitle ? (\r\n        <Portal key={sectionTitle}>\r\n          <View\r\n            style={[\r\n              styles.fullscreenContainer,\r\n              {\r\n                backgroundColor,\r\n                paddingTop: insets?.top,\r\n                paddingBottom: insets?.bottom,\r\n              },\r\n            ]}\r\n          >\r\n            <ScrollView style={styles.fullscreenContainerInside}>\r\n              {contents}\r\n            </ScrollView>\r\n          </View>\r\n        </Portal>\r\n      ) : null;\r\n    } else {\r\n      return contents;\r\n    }\r\n  }\r\n\r\n  const onEndingClose = useCallback(() => {\r\n    if (endingHistoryIndex != null) {\r\n      setEndingHistoryIndex(null);\r\n      setSection(\"Stats\");\r\n    } else {\r\n      setSection(\"Home\");\r\n    }\r\n    stateRef.current.apply((state) => {\r\n      for (let listener of EndingCloseListeners.getAll()) {\r\n        state = listener(state);\r\n      }\r\n      return state;\r\n    });\r\n  }, [endingHistoryIndex]);\r\n\r\n  const sectionIndices = useMemo(() => {\r\n    const indices: number[] = [];\r\n    for (let i = 0; i < layout.activeContentTabs; i++) {\r\n      indices.push(i);\r\n    }\r\n    return indices;\r\n  }, [layout.activeContentTabs]);\r\n\r\n  const safeAreaInsets = useSafeAreaInsets();\r\n\r\n  const mainSections = useMemo(() => {\r\n    let unusedIndex = 1;\r\n    return (\r\n      <View\r\n        accessibilityElementsHidden={menuShown || rightMenuShown != \"none\"}\r\n        importantForAccessibility={\r\n          menuShown || rightMenuShown != \"none\" ? \"no-hide-descendants\" : \"auto\"\r\n        }\r\n        style={{\r\n          flex: 1,\r\n          flexDirection: \"row\",\r\n          alignItems: \"stretch\",\r\n          justifyContent: \"space-evenly\",\r\n        }}\r\n      >\r\n        {sectionIndices.map((index) => {\r\n          if (layout.activeContentTabs == 1 && index > 0) {\r\n            // Optimization for phones and similar\r\n            return null;\r\n          }\r\n          const currentSection =\r\n            index == 0\r\n              ? section\r\n              : pinnedSectionObjects[index - 1]?.section ?? \"-\";\r\n          let sectionKey =\r\n            index == 0 ? 0 : pinnedSectionObjects?.[index - 1]?.key;\r\n          if (sectionKey === undefined) {\r\n            while (pinnedSectionObjects.find((s) => s.key == unusedIndex)) {\r\n              unusedIndex++;\r\n            }\r\n            sectionKey = unusedIndex;\r\n            unusedIndex++;\r\n          }\r\n          const showHeader = pinnedSectionObjects.length > 0;\r\n\r\n          const scrollViewContents = (\r\n            <ScrollView\r\n              //@ts-ignore Not sure why this is giving error\r\n              ref={scrollRefs[\"Main\"]}\r\n              style={styles.mainContainer}\r\n              onScroll={onScrollPerSection[currentSection]}\r\n              contentContainerStyle={\r\n                currentSection != \"Inventory\" &&\r\n                currentSection != \"Transmute\" &&\r\n                styles.container\r\n              }\r\n            >\r\n              {wrapInSection(\r\n                <Study />,\r\n                \"Study\",\r\n                currentSection,\r\n                sectionData[\"Study\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Inventory />,\r\n                \"Inventory\",\r\n                currentSection,\r\n                sectionData[\"Inventory\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Transmute />,\r\n                \"Transmute\",\r\n                currentSection,\r\n                sectionData[\"Transmute\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Enhance />,\r\n                \"Enhance\",\r\n                currentSection,\r\n                sectionData[\"Enhance\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Boosts />,\r\n                \"Boosts\",\r\n                currentSection,\r\n                sectionData[\"Boosts\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <FamiliarsComponent />,\r\n                \"Familiars\",\r\n                currentSection,\r\n                sectionData[\"Familiars\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <SpellcraftsComponent />,\r\n                \"Spellcraft\",\r\n                currentSection,\r\n                sectionData[\"Spellcraft\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <RitualsComponent />,\r\n                \"Rituals\",\r\n                currentSection,\r\n                sectionData[\"Rituals\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Ending\r\n                  close={onEndingClose}\r\n                  overrideEnding={\r\n                    endingHistoryIndex != null\r\n                      ? state.global.endingsHistory[endingHistoryIndex]\r\n                      : undefined\r\n                  }\r\n                />,\r\n                \"Ending\",\r\n                currentSection,\r\n                sectionData[\"Ending\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n                sectionData[\"Ending\"]?.fullScreen,\r\n                theme.colors.background,\r\n              )}\r\n              {wrapInSection(\r\n                <Worlds />,\r\n                \"Worlds\",\r\n                currentSection,\r\n                sectionData[\"Worlds\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Retirement />,\r\n                \"Retirement\",\r\n                currentSection,\r\n                sectionData[\"Retirement\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Compendium />,\r\n                \"Compendium\",\r\n                currentSection,\r\n                sectionData[\"Compendium\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Stats />,\r\n                \"Stats\",\r\n                currentSection,\r\n                sectionData[\"Stats\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Options />,\r\n                \"Options\",\r\n                currentSection,\r\n                sectionData[\"Options\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <Help />,\r\n                \"Help\",\r\n                currentSection,\r\n                sectionData[\"Help\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {wrapInSection(\r\n                <About />,\r\n                \"About\",\r\n                currentSection,\r\n                sectionData[\"About\"]?.keepInMemory,\r\n                safeAreaInsets,\r\n              )}\r\n              {currentSection === \"Debug\" && <Debug />}\r\n            </ScrollView>\r\n          );\r\n          const explorationContents = (\r\n            <View style={styles.mainContainer}>\r\n              <GameStateFreezer isVisible={currentSection == \"Exploration\"}>\r\n                <Exploration />\r\n              </GameStateFreezer>\r\n            </View>\r\n          );\r\n          const synchroContents = (\r\n            <View style={styles.mainContainer}>\r\n              <GameStateFreezer isVisible={currentSection == \"Synchro\"}>\r\n                <Synchro />\r\n              </GameStateFreezer>\r\n            </View>\r\n          );\r\n          return (\r\n            <VisibilityContext.Provider\r\n              key={sectionKey ?? index}\r\n              value={index < layout.activeContentTabs}\r\n            >\r\n              <View\r\n                key={sectionKey ?? index}\r\n                style={[\r\n                  showHeader && {\r\n                    marginHorizontal: 4,\r\n                    borderLeftWidth: 1,\r\n                    borderRightWidth: 1,\r\n                    borderColor: theme.colors.outlineVariant,\r\n                  },\r\n                  {\r\n                    flex: 1,\r\n                    display: currentSection == \"-\" ? \"none\" : undefined,\r\n                  },\r\n                ]}\r\n              >\r\n                {showHeader && (\r\n                  <View\r\n                    style={[\r\n                      {\r\n                        height: 56,\r\n                        paddingVertical: 8,\r\n                        paddingHorizontal: 16,\r\n                        flexDirection: \"row\",\r\n                        alignItems: \"center\",\r\n                        borderBottomWidth: 1,\r\n                        borderBottomColor: theme.colors.outlineVariant,\r\n                      },\r\n                    ]}\r\n                  >\r\n                    <View style={{ flex: 1 }}>\r\n                      <UtilityText h2>{currentSection}</UtilityText>\r\n                    </View>\r\n                    {index > 0 && (\r\n                      <View\r\n                        style={{\r\n                          flexDirection: \"row\",\r\n                          alignItems: \"center\",\r\n                        }}\r\n                      >\r\n                        <MaterialIcons\r\n                          name=\"close\"\r\n                          size={20}\r\n                          color={theme.colors.onBackground}\r\n                          onPress={() => togglePinnedSection(currentSection)}\r\n                          style={{ marginLeft: 8 }}\r\n                          accessibilityRole=\"button\"\r\n                          accessibilityLabel={\"Close Section\"}\r\n                        />\r\n                      </View>\r\n                    )}\r\n                  </View>\r\n                )}\r\n                <View\r\n                  style={[\r\n                    { flex: 1 },\r\n                    !sectionData[currentSection]?.scrollView && {\r\n                      display: \"none\",\r\n                    },\r\n                  ]}\r\n                >\r\n                  {scrollViewContents}\r\n                </View>\r\n                <View\r\n                  style={[\r\n                    styles.mainContainer,\r\n                    currentSection !== \"Home\" && { display: \"none\" },\r\n                  ]}\r\n                >\r\n                  <GameStateFreezer isVisible={currentSection == \"Home\"}>\r\n                    <Home\r\n                      onScroll={onScrollPerSection[\"Home\"]}\r\n                      scrollRef={scrollRefs[\"Home\"]}\r\n                    />\r\n                  </GameStateFreezer>\r\n                </View>\r\n                <View\r\n                  style={[\r\n                    styles.mainContainer,\r\n                    currentSection !== \"Wizards\" && { display: \"none\" },\r\n                  ]}\r\n                >\r\n                  <GameStateFreezer isVisible={currentSection == \"Wizards\"}>\r\n                    <Wizards />\r\n                  </GameStateFreezer>\r\n                </View>\r\n                <View\r\n                  style={[\r\n                    styles.mainContainer,\r\n                    currentSection !== \"Exploration\" && { display: \"none\" },\r\n                  ]}\r\n                >\r\n                  {explorationContents}\r\n                </View>\r\n                <View\r\n                  style={[\r\n                    styles.mainContainer,\r\n                    currentSection !== \"Synchro\" && { display: \"none\" },\r\n                  ]}\r\n                >\r\n                  {synchroContents}\r\n                </View>\r\n              </View>\r\n            </VisibilityContext.Provider>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  }, [\r\n    theme,\r\n    menuShown,\r\n    rightMenuShown,\r\n    pinnedSectionObjects,\r\n    sectionIndices,\r\n    section,\r\n    togglePinnedSection,\r\n    endingHistoryIndex,\r\n    safeAreaInsets,\r\n  ]);\r\n\r\n  const backCallback = useCallback(() => {\r\n    if (menuShown) {\r\n      setMenuShown(false);\r\n      return true;\r\n    }\r\n    if (rightMenuShown != \"none\") {\r\n      setRightMenuShown(\"none\");\r\n      return true;\r\n    }\r\n    return false;\r\n  }, [menuShown, rightMenuShown, setMenuShown, setRightMenuShown]);\r\n\r\n  useEffect(() => {\r\n    const handler = BackHandler.addEventListener(\r\n      \"hardwareBackPress\",\r\n      backCallback,\r\n    );\r\n\r\n    return () => handler.remove();\r\n  }, [backCallback]);\r\n\r\n  const contentsWide = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.biggerContainer,\r\n          { backgroundColor: theme.colors.background },\r\n        ]}\r\n        onAccessibilityEscape={\r\n          menuShown || rightMenuShown != \"none\" ? backCallback : undefined\r\n        }\r\n      >\r\n        <View style={styles.horizontalContainer}>\r\n          <Drawer\r\n            drawerPosition=\"right\"\r\n            drawerType={layout.showEventsMenu ? \"permanent\" : \"front\"}\r\n            open={rightMenuShown == \"event\"}\r\n            onOpen={onEventMenuOpen}\r\n            onClose={onRightMenuClose}\r\n            swipeEnabled={rightMenuShown == \"event\"}\r\n            renderDrawerContent={() => (\r\n              <GameStateFreezer\r\n                isVisible={layout.showEventsMenu || rightMenuShown === \"event\"}\r\n              >\r\n                <EventList />\r\n              </GameStateFreezer>\r\n            )}\r\n          >\r\n            <Drawer\r\n              drawerPosition=\"right\"\r\n              drawerType={layout.showSpellMenu ? \"permanent\" : \"front\"}\r\n              open={rightMenuShown == \"spell\"}\r\n              onOpen={onSpellMenuOpen}\r\n              onClose={onRightMenuClose}\r\n              renderDrawerContent={() => (\r\n                <GameStateFreezer\r\n                  isVisible={layout.showSpellMenu || rightMenuShown === \"spell\"}\r\n                >\r\n                  <SpellMenu favoritesOnBottom={false} />\r\n                </GameStateFreezer>\r\n              )}\r\n            >\r\n              <Drawer\r\n                open={true}\r\n                drawerType=\"permanent\"\r\n                onOpen={onMenuOpen}\r\n                onClose={onMenuClose}\r\n                renderDrawerContent={() => (\r\n                  <MenuContents\r\n                    visible={true}\r\n                    wide={true}\r\n                    pinnedSections={pinnedSectionObjects.map((s) => s.section)}\r\n                    onPressFavorite={togglePinnedSection}\r\n                    onNavigationPress={onNavigationPress}\r\n                  />\r\n                )}\r\n              >\r\n                {mainSections}\r\n              </Drawer>\r\n            </Drawer>\r\n          </Drawer>\r\n        </View>\r\n\r\n        <ManaBar />\r\n      </View>\r\n    ),\r\n    [\r\n      theme,\r\n      JSON.stringify(layout),\r\n      height,\r\n      rightMenuShown,\r\n      mainSections,\r\n      JSON.stringify(pinnedSectionObjects),\r\n      backCallback,\r\n    ],\r\n  );\r\n\r\n  const contents = useMemo(\r\n    () => (\r\n      <View\r\n        style={[\r\n          styles.biggerContainer,\r\n          { backgroundColor: theme.colors.background },\r\n        ]}\r\n        onAccessibilityEscape={\r\n          menuShown || rightMenuShown != \"none\" ? backCallback : undefined\r\n        }\r\n      >\r\n        <Drawer\r\n          open={menuShown}\r\n          onOpen={onMenuOpen}\r\n          onClose={onMenuClose}\r\n          renderDrawerContent={() => (\r\n            <GameStateFreezer isVisible={menuShown}>\r\n              <MenuContents\r\n                visible={menuShown}\r\n                wide={false}\r\n                pinnedSections={pinnedSectionObjects.map((s) => s.section)}\r\n                onPressFavorite={togglePinnedSection}\r\n                onNavigationPress={onNavigationPress}\r\n              />\r\n            </GameStateFreezer>\r\n          )}\r\n        >\r\n          <View style={[Styles.flex, styles.mainContainerPhone]}>\r\n            <Drawer\r\n              drawerPosition=\"right\"\r\n              open={rightMenuShown == \"event\"}\r\n              onOpen={onEventMenuOpen}\r\n              onClose={onRightMenuClose}\r\n              swipeEnabled={rightMenuShown == \"event\"}\r\n              renderDrawerContent={() => (\r\n                <GameStateFreezer isVisible={rightMenuShown === \"event\"}>\r\n                  <EventList />\r\n                </GameStateFreezer>\r\n              )}\r\n            >\r\n              <Drawer\r\n                drawerPosition=\"right\"\r\n                open={rightMenuShown == \"spell\"}\r\n                onOpen={onSpellMenuOpen}\r\n                onClose={onRightMenuClose}\r\n                renderDrawerContent={() => (\r\n                  <GameStateFreezer isVisible={rightMenuShown === \"spell\"}>\r\n                    <SpellMenu favoritesOnBottom={putCastSpellOnBottomMenu} />\r\n                  </GameStateFreezer>\r\n                )}\r\n              >\r\n                <View style={Styles.flex}>{mainSections}</View>\r\n              </Drawer>\r\n            </Drawer>\r\n            {showBottomResourceBar && (\r\n              <Animated.View\r\n                style={[\r\n                  {\r\n                    borderTopWidth: 2.0,\r\n                    borderTopColor: theme.colors.outlineVariant,\r\n                  },\r\n                ]}\r\n              >\r\n                <View\r\n                  style={styles.accessibilityHidden}\r\n                  accessible={true}\r\n                  accessibilityLabel=\"Resources\"\r\n                  accessibilityRole=\"header\"\r\n                  accessibilityElementsHidden={false}\r\n                />\r\n                <BottomResourceViewer />\r\n              </Animated.View>\r\n            )}\r\n            {showBottomMenu && (\r\n              <>\r\n                {leftHandedMode && putCastSpellOnBottomMenu && (\r\n                  <View\r\n                    style={{\r\n                      left: -142,\r\n                      bottom: -122,\r\n                      position: \"absolute\",\r\n                      zIndex: 120,\r\n                    }}\r\n                  >\r\n                    <IconButton\r\n                      accessibilityLabel={t(\"Cast Spell\")}\r\n                      hitSlop={{ top: 50, left: 50, bottom: 20, right: 20 }}\r\n                      onPressIn={onSpellMenuPress}\r\n                      onPress={() => {}}\r\n                      mode=\"contained\"\r\n                      containerColor={theme.colors.primary}\r\n                      style={{\r\n                        borderRadius: 0,\r\n                        borderTopRightRadius: 100,\r\n                        width: 240,\r\n                        height: 168,\r\n                      }}\r\n                      icon={() => (\r\n                        <SimpleLineIcons\r\n                          style={{\r\n                            position: \"relative\",\r\n                            left: 50,\r\n                            bottom: 52,\r\n                            width: 24,\r\n                            height: 24,\r\n                            overflow: \"visible\",\r\n                          }}\r\n                          name=\"magic-wand\"\r\n                          color={theme.colors.primaryContainer}\r\n                          size={24}\r\n                        />\r\n                      )}\r\n                    ></IconButton>\r\n                  </View>\r\n                )}\r\n                <View\r\n                  style={{\r\n                    borderTopWidth: 2.0,\r\n                    borderTopColor: theme.colors.outlineVariant,\r\n                  }}\r\n                >\r\n                  <BottomMenu\r\n                    onNavigationPress={onNavigationPress}\r\n                    onSpellMenuPress={onSpellMenuPress}\r\n                    selected={activeSections[0]}\r\n                    leftHanded={leftHandedMode}\r\n                    showCastSpellButton={putCastSpellOnBottomMenu}\r\n                  />\r\n                </View>\r\n                {!leftHandedMode && putCastSpellOnBottomMenu && (\r\n                  <View\r\n                    style={{\r\n                      right: -142,\r\n                      bottom: -122,\r\n                      position: \"absolute\",\r\n                      zIndex: 120,\r\n                    }}\r\n                  >\r\n                    <IconButton\r\n                      accessibilityLabel={t(\"Cast Spell\")}\r\n                      hitSlop={{ top: 50, left: 50, bottom: 20, right: 20 }}\r\n                      onPressIn={onSpellMenuPress}\r\n                      onPress={() => {}}\r\n                      mode=\"contained\"\r\n                      containerColor={theme.colors.primary}\r\n                      style={{\r\n                        borderRadius: 0,\r\n                        borderTopLeftRadius: 100,\r\n                        width: 240,\r\n                        height: 168,\r\n                      }}\r\n                      icon={() => (\r\n                        <SimpleLineIcons\r\n                          style={{\r\n                            position: \"relative\",\r\n                            right: 50,\r\n                            bottom: 52,\r\n                            width: 24,\r\n                            height: 24,\r\n                            overflow: \"visible\",\r\n                          }}\r\n                          name=\"magic-wand\"\r\n                          color={theme.colors.primaryContainer}\r\n                          size={24}\r\n                        />\r\n                      )}\r\n                    ></IconButton>\r\n                  </View>\r\n                )}\r\n              </>\r\n            )}\r\n          </View>\r\n        </Drawer>\r\n        <ManaBar />\r\n      </View>\r\n    ),\r\n    [\r\n      theme,\r\n      menuShown,\r\n      mainSections,\r\n      onMenuPress,\r\n      onNavigationPress,\r\n      onSpellMenuPress,\r\n      height,\r\n      showBottomMenu,\r\n      putCastSpellOnBottomMenu,\r\n      leftHandedMode,\r\n      backCallback,\r\n      JSON.stringify(pinnedSectionObjects),\r\n      showBottomResourceBar,\r\n    ],\r\n  );\r\n\r\n  const headerContainerStyle = useMemo(\r\n    () => ({\r\n      borderBottomColor: theme.colors.outlineVariant,\r\n      borderBottomWidth: 2,\r\n      height: auxOptions.compactLayout ? 40 : 48,\r\n    }),\r\n    [auxOptions.compactLayout, theme],\r\n  );\r\n\r\n  const menuButton = useMemo(\r\n    () => (\r\n      <TouchableOpacity\r\n        accessibilityLabel=\"Menu\"\r\n        accessibilityRole=\"button\"\r\n        onPressIn={onMenuPress}\r\n        hitSlop={{ top: 20, left: 20, bottom: 20, right: 20 }}\r\n      >\r\n        <MaterialIcons name=\"menu\" size={24} color=\"#fff\" />\r\n      </TouchableOpacity>\r\n    ),\r\n    [onMenuPress],\r\n  );\r\n\r\n  const accessibilityContext = useContext(AccessibilityContext);\r\n\r\n  const onMagicTap = useCallback(() => {\r\n    if (!activeSections.includes(\"Exploration\")) {\r\n      return;\r\n    }\r\n    const isPaused = hasFlag(stateRef.current, \"combat_paused_magic_tap\");\r\n    stateRef.current.apply((state) =>\r\n      isPaused\r\n        ? clearFlag(\"combat_paused_magic_tap\")(state)\r\n        : setFlag(\"combat_paused_magic_tap\")(state),\r\n    );\r\n    accessibilityContext.announceForAccessibility(\r\n      isPaused ? t(\"Resuming Exploration\") : t(\"Pausing Exploration\"),\r\n    );\r\n  }, [accessibilityContext, activeSections.join()]);\r\n\r\n  return useMemo(() => {\r\n    if (layout.wideLayout) {\r\n      return (\r\n        <GestureHandlerRootView\r\n          style={[\r\n            styles.maxContainer,\r\n            { backgroundColor: theme.colors.background },\r\n          ]}\r\n          onMagicTap={onMagicTap}\r\n        >\r\n          <GameTickProcessor\r\n            setPlayerState={props.setPlayerState}\r\n            onLoadingProgress={props.onLoadingProgress}\r\n          />\r\n          <Appbar.Header style={headerContainerStyle}>\r\n            {centerComponent}\r\n            {!layout.showSpellMenu && (\r\n              <Appbar.Action\r\n                key=\"spellMenu\"\r\n                icon={() => (\r\n                  <SimpleLineIcons\r\n                    name=\"magic-wand\"\r\n                    size={24}\r\n                    color={theme.colors.primary}\r\n                  />\r\n                )}\r\n                onPress={onSpellMenuPress}\r\n              />\r\n            )}\r\n            {!layout.showEventsMenu && (\r\n              <Appbar.Action\r\n                key=\"eventsMenu\"\r\n                icon={() => (\r\n                  <>\r\n                    <MaterialIcons\r\n                      name=\"notifications\"\r\n                      size={24}\r\n                      color={theme.colors.primary}\r\n                    />\r\n                    {ongoingEventCount > 0 && (\r\n                      <Badge style={styles.notificationsBadge}>\r\n                        {ongoingEventCount}\r\n                      </Badge>\r\n                    )}\r\n                  </>\r\n                )}\r\n                onPress={onEventMenuPress}\r\n              />\r\n            )}\r\n          </Appbar.Header>\r\n          {contentsWide}\r\n          <EventOverlay />\r\n        </GestureHandlerRootView>\r\n      );\r\n    }\r\n    return (\r\n      <GestureHandlerRootView\r\n        style={[\r\n          styles.maxContainer,\r\n          { backgroundColor: theme.colors.background },\r\n        ]}\r\n        onMagicTap={onMagicTap}\r\n      >\r\n        <GameTickProcessor\r\n          setPlayerState={props.setPlayerState}\r\n          onLoadingProgress={props.onLoadingProgress}\r\n        />\r\n        <Appbar.Header style={headerContainerStyle}>\r\n          {!layout.showMenu && (\r\n            <Appbar.Action\r\n              key=\"menu\"\r\n              icon={() => (\r\n                <MaterialIcons\r\n                  name=\"menu\"\r\n                  size={24}\r\n                  color={theme.colors.primary}\r\n                />\r\n              )}\r\n              onPress={onMenuPress}\r\n            />\r\n          )}\r\n          {centerComponent}\r\n          {!layout.showSpellMenu &&\r\n            !(showBottomMenu && putCastSpellOnBottomMenu) && (\r\n              <Appbar.Action\r\n                key=\"spellMenu\"\r\n                icon={() => (\r\n                  <SimpleLineIcons\r\n                    name=\"magic-wand\"\r\n                    size={24}\r\n                    color={theme.colors.primary}\r\n                  />\r\n                )}\r\n                onPress={onSpellMenuPress}\r\n              />\r\n            )}\r\n          {!layout.showEventsMenu && (\r\n            <Appbar.Action\r\n              key=\"eventsMenu\"\r\n              icon={() => (\r\n                <>\r\n                  <MaterialIcons\r\n                    name=\"notifications\"\r\n                    size={24}\r\n                    color={theme.colors.primary}\r\n                  />\r\n                  {ongoingEventCount > 0 && (\r\n                    <Badge style={styles.notificationsBadge}>\r\n                      {ongoingEventCount}\r\n                    </Badge>\r\n                  )}\r\n                </>\r\n              )}\r\n              onPress={onEventMenuPress}\r\n            />\r\n          )}\r\n        </Appbar.Header>\r\n        {contents}\r\n        <EventOverlay />\r\n      </GestureHandlerRootView>\r\n    );\r\n  }, [\r\n    props.setPlayerState,\r\n    props.onLoadingProgress,\r\n    onMenuPress,\r\n    onSpellMenuPress,\r\n    onEventMenuPress,\r\n    mainSections,\r\n    ongoingEventCount,\r\n    menuShown,\r\n    rightMenuShown,\r\n    onNavigationPress,\r\n    JSON.stringify(layout),\r\n    height,\r\n    theme,\r\n    contents,\r\n    contentsWide,\r\n    headerContainerStyle,\r\n    menuButton,\r\n    onMagicTap,\r\n    showBottomMenu,\r\n    putCastSpellOnBottomMenu,\r\n  ]);\r\n}\r\n\r\nfunction OfflineProgress(props: { currentTicks: number; totalTicks: number }) {\r\n  const theme = useTheme();\r\n  return (\r\n    <View\r\n      style={[\r\n        styles.offlineProgressContainer,\r\n        { backgroundColor: theme.colors.background },\r\n      ]}\r\n    >\r\n      <ActivityIndicator size=\"large\" />\r\n      <Text>\r\n        {t(\"Warping through time... {{current}} / {{total}}\", {\r\n          current: formatNumber(props.currentTicks, { showDecimals: false }),\r\n          total: formatNumber(props.totalTicks, { showDecimals: false }),\r\n        })}\r\n      </Text>\r\n    </View>\r\n  );\r\n}\r\n\r\nexport default function AppContents() {\r\n  const [playerState, setPlayerState] = useState(() => clone(INITIAL_STATE));\r\n  const [localUiState, setLocalUiState] = useState<any>({});\r\n\r\n  const [processingBigTime, setProcessingBigTime] = useState(false);\r\n  const [totalTicks, setTotalTicks] = useState(0);\r\n  const [currentTicks, setCurrentTicks] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (Platform.OS == \"android\") {\r\n      // enables edge-to-edge mode\r\n      NavigationBar.setPositionAsync(\"absolute\");\r\n      // transparent backgrounds to see through\r\n      NavigationBar.setBackgroundColorAsync(\"#ffffff00\");\r\n      // do not resize safe area\r\n      NavigationBar.setBehaviorAsync(\"overlay-swipe\");\r\n    }\r\n  }, []);\r\n\r\n  const onLoadingProgress = useCallback(\r\n    (currentTicks: number, totalTicks: number) => {\r\n      setCurrentTicks(currentTicks);\r\n      setTotalTicks(totalTicks);\r\n      if (currentTicks == totalTicks) {\r\n        setProcessingBigTime(false);\r\n      } else {\r\n        setProcessingBigTime(true);\r\n      }\r\n    },\r\n    [],\r\n  );\r\n\r\n  const uiContextValue = useMemo(() => {\r\n    return {\r\n      getUIState: (id: string) => {\r\n        return localUiState?.[id];\r\n      },\r\n      setUIState: (id: string, value: any) => {\r\n        localUiState[id] = value;\r\n        setLocalUiState(localUiState);\r\n      },\r\n    };\r\n  }, [localUiState, setLocalUiState]);\r\n\r\n  type TooltipData = {\r\n    content: TooltipContent;\r\n    position: TooltipPosition;\r\n    measurementId: number;\r\n    postMeasurementId: number;\r\n    mouseEnterTimestamp: number;\r\n    mouseLeaveTimestamp: number;\r\n  };\r\n  const [tooltips, setTooltips] = useState<Record<string, TooltipData>>({});\r\n\r\n  const tooltipsRef = useRef(tooltips);\r\n  tooltipsRef.current = tooltips;\r\n  const setTooltip = useCallback(\r\n    (\r\n      id: string,\r\n      tooltip: TooltipContent,\r\n      position: TooltipPosition,\r\n      measurementId?: number,\r\n    ) => {\r\n      const newTooltips = Object.assign({}, tooltipsRef.current);\r\n      if (!newTooltips[id]) {\r\n        newTooltips[id] = {\r\n          content: tooltip,\r\n          position: position,\r\n          postMeasurementId: 1,\r\n          measurementId: 0,\r\n          mouseEnterTimestamp: 0,\r\n          mouseLeaveTimestamp: 0,\r\n        };\r\n      }\r\n      newTooltips[id].content = tooltip;\r\n      newTooltips[id].position = position;\r\n      if (measurementId != null) {\r\n        newTooltips[id].postMeasurementId = measurementId;\r\n      }\r\n      tooltipsRef.current = newTooltips;\r\n      setTooltips(newTooltips);\r\n    },\r\n    [setTooltips],\r\n  );\r\n  const clearTooltip = useCallback(\r\n    (id: string) => {\r\n      const newTooltips = Object.assign({}, tooltipsRef.current);\r\n      const found = newTooltips[id] != null;\r\n      if (!found) {\r\n        return;\r\n      }\r\n      newTooltips[id].content = null;\r\n      tooltipsRef.current = newTooltips;\r\n      setTooltips(newTooltips);\r\n    },\r\n    [setTooltips],\r\n  );\r\n  const onUnmountTooltip = useCallback(\r\n    (id: string) => {\r\n      const newTooltips = tooltipsRef.current;\r\n      const found = newTooltips[id] != null;\r\n      if (!found) {\r\n        return;\r\n      }\r\n      delete newTooltips[id];\r\n      delete tooltipsRef.current[id];\r\n      setTooltips(Object.assign({}, newTooltips));\r\n    },\r\n    [setTooltips],\r\n  );\r\n  const onMouseLeave = useCallback(\r\n    (id: string) => {\r\n      if (!tooltipsRef.current?.[id]) {\r\n        return;\r\n      }\r\n      const newTooltips = Object.assign({}, tooltipsRef.current);\r\n      newTooltips[id].mouseLeaveTimestamp = Date.now();\r\n      tooltipsRef.current = newTooltips;\r\n      setTooltips(newTooltips);\r\n    },\r\n    [setTooltips],\r\n  );\r\n  const onMouseEnter = useCallback(\r\n    (id: string, measurementId: number) => {\r\n      const newTooltips = Object.assign({}, tooltipsRef.current);\r\n      if (!newTooltips[id]) {\r\n        newTooltips[id] = {\r\n          content: null,\r\n          position: { containerWidth: 1 },\r\n          postMeasurementId: 1,\r\n          measurementId: 0,\r\n          mouseEnterTimestamp: 0,\r\n          mouseLeaveTimestamp: 0,\r\n        };\r\n      }\r\n      newTooltips[id].measurementId = measurementId;\r\n      newTooltips[id].mouseEnterTimestamp = Date.now();\r\n      tooltipsRef.current = newTooltips;\r\n      setTooltips(newTooltips);\r\n    },\r\n    [setTooltips],\r\n  );\r\n  let tooltip: null | TooltipData = null;\r\n  for (let tooltipId in tooltips) {\r\n    if (\r\n      tooltips[tooltipId].mouseEnterTimestamp >\r\n        tooltips[tooltipId].mouseLeaveTimestamp &&\r\n      tooltips[tooltipId].measurementId ===\r\n        tooltips[tooltipId].postMeasurementId &&\r\n      tooltips[tooltipId].content != null\r\n    ) {\r\n      tooltip = tooltips[tooltipId];\r\n      break;\r\n    }\r\n  }\r\n  const tooltipContextValue = useMemo(() => {\r\n    return {\r\n      tooltip: tooltip?.content,\r\n      position: tooltip?.position ?? { containerWidth: 1 },\r\n    };\r\n  }, [tooltip?.content, tooltip?.position]);\r\n  const tooltipControlContextValue = useMemo(() => {\r\n    return {\r\n      setTooltip: setTooltip,\r\n      clearTooltip: clearTooltip,\r\n      onMouseLeave: onMouseLeave,\r\n      onMouseEnter: onMouseEnter,\r\n      onUnmountTooltip: onUnmountTooltip,\r\n    };\r\n  }, [setTooltip, clearTooltip, onMouseLeave, onMouseEnter, onUnmountTooltip]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [criticalError, setCriticalError] = useState(false);\r\n  const [lessCriticalError, setLessCriticalError] = useState(false);\r\n\r\n  const playerStateRef = useRef(playerState);\r\n  playerStateRef.current = playerState;\r\n\r\n  const apply = useCallback(\r\n    (transform: GameStateTransform) => {\r\n      const newState = applyAllTransforms(playerStateRef.current, transform);\r\n      newState.global.appVersionTimestamp = getCurrentVersionTimestamp() || 0;\r\n      newState.global.appVersionString = getCurrentVersion() ?? \"0.0.0\";\r\n      newState.global.isFullVersionSave = true;\r\n\r\n      setPlayerState(newState);\r\n    },\r\n    [playerStateRef, setPlayerState],\r\n  );\r\n\r\n  const overwrite = useCallback(\r\n    (transform: GameStateTransform) => {\r\n      let transformedState = transform(playerStateRef.current);\r\n      transformedState = clearAllCaches(transformedState);\r\n      setPlayerState(transformedState);\r\n    },\r\n    [playerStateRef, setPlayerState],\r\n  );\r\n\r\n  const stateContextValue: StateContextValue = useMemo(() => {\r\n    return {\r\n      ...playerState,\r\n      apply: apply,\r\n      overwrite: overwrite,\r\n    };\r\n  }, [playerState, apply, overwrite]);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        let loadedState = await loadData();\r\n        loadedState = clearAllCaches(loadedState);\r\n        setPlayerState(loadedState);\r\n        await nextFrame();\r\n        setLoading(false);\r\n      } catch (error) {\r\n        console.error(\"Error loading data\");\r\n        setCriticalError(true);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  const [lastTimeFailedToSave, setLastTimeFailedToSave] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const storeData = async () => {\r\n      if (lessCriticalError || criticalError) {\r\n        // Do not save if there's an error!!\r\n        return;\r\n      }\r\n      try {\r\n        await saveData(playerState);\r\n        if (lastTimeFailedToSave > 0) {\r\n          setLastTimeFailedToSave(0);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error saving data\", error);\r\n        if (\r\n          lastTimeFailedToSave > 0 &&\r\n          lastTimeFailedToSave <\r\n            Math.floor(getSecondsPlayed(playerState) / 5.0) - 10.0\r\n        ) {\r\n          setLessCriticalError(true);\r\n        } else {\r\n          if (lastTimeFailedToSave <= 0) {\r\n            setLastTimeFailedToSave(\r\n              Math.floor(getSecondsPlayed(playerState) / 5.0),\r\n            );\r\n          }\r\n        }\r\n      }\r\n    };\r\n    if (!loading && !processingBigTime) {\r\n      storeData();\r\n    }\r\n  }, [\r\n    Math.floor(getSecondsPlayed(playerState) / 5.0),\r\n    loading,\r\n    processingBigTime,\r\n    lastTimeFailedToSave,\r\n    setLastTimeFailedToSave,\r\n    lessCriticalError,\r\n    criticalError,\r\n  ]);\r\n\r\n  const [isTransition, setTransition] = useTransition();\r\n\r\n  const theme = getThemeByElementAndDarkMode(\r\n    stateContextValue.options.overrideElementDisplay != \"no\"\r\n      ? stateContextValue.options.overrideElementDisplay\r\n      : stateContextValue.run.primaryElement,\r\n    stateContextValue.options.themeMode === \"dark\",\r\n  );\r\n\r\n  const auxOptions = useMemo(\r\n    () => ({\r\n      compactLayout: stateContextValue.options.compactUI,\r\n    }),\r\n    [stateContextValue.options.compactUI],\r\n  );\r\n\r\n  const shouldShowIntro = stateContextValue.run.primaryElement == undefined;\r\n\r\n  const [showIntro, setShowIntro] = useState(shouldShowIntro);\r\n\r\n  useEffect(() => {\r\n    if (showIntro != shouldShowIntro) {\r\n      setTimeout(() => setShowIntro(shouldShowIntro), 0);\r\n    }\r\n  }, [showIntro, shouldShowIntro, setTransition, setShowIntro]);\r\n\r\n  const { height, width } = useWindowDimensions();\r\n\r\n  const copyToClipboard = useCallback(async () => {\r\n    const serializedData = await serializeSaveData(playerStateRef.current);\r\n    await Clipboard.setStringAsync(serializedData);\r\n  }, []);\r\n\r\n  const saveToFileCallback = useCallback(async () => {\r\n    const result = await saveToFile(playerStateRef.current);\r\n  }, []);\r\n\r\n  const copyAsyncStorageToClipboard = useCallback(async () => {\r\n    const jsonValue = await AsyncStorage.getItem(\"GameState\");\r\n    await Clipboard.setStringAsync(jsonValue ?? \"null\");\r\n  }, []);\r\n\r\n  const criticalErrorView = useMemo(\r\n    () => (\r\n      <View style={styles.errorContainer}>\r\n        <View style={styles.errorWrapper}>\r\n          <View style={styles.errorHeader}>\r\n            <Text variant=\"headlineMedium\">\r\n              {t(\"Something went very wrong!\")}\r\n            </Text>\r\n          </View>\r\n          <Text>\r\n            {t(`It looks like an unexpected error happened while loading the game.\r\nPlease try closing the app and opening it again. If the error\r\npersists, please contact magic.research.game@gmail.com and send your\r\ndebug saved data for further support.`)}\r\n          </Text>\r\n          <PaperButton\r\n            onPress={copyAsyncStorageToClipboard}\r\n            style={styles.saveButton}\r\n          >\r\n            {t(\"Copy debug save data to clipboard\")}\r\n          </PaperButton>\r\n        </View>\r\n      </View>\r\n    ),\r\n    [copyAsyncStorageToClipboard],\r\n  );\r\n\r\n  const errorView = useMemo(\r\n    () => (\r\n      <View style={styles.errorContainer}>\r\n        <View style={styles.errorWrapper}>\r\n          <View style={styles.errorHeader}>\r\n            <Text variant=\"headlineMedium\">{t(\"Something went wrong!\")}</Text>\r\n          </View>\r\n          <Text>\r\n            {t(`It looks like an unexpected error happened. Please try closing the\r\napp and opening it again. If the error persists, please contact\r\nmagic.research.game@gmail.com and send your saved data for further\r\nsupport.`)}\r\n          </Text>\r\n          <PaperButton onPress={copyToClipboard} style={styles.saveButton}>\r\n            {t(\"Copy savefile to clipboard\")}\r\n          </PaperButton>\r\n          {SAVE_TO_FILE_SUPPORTED && (\r\n            <PaperButton onPress={saveToFileCallback} style={styles.saveButton}>\r\n              {t(\"Save to file\")}\r\n            </PaperButton>\r\n          )}\r\n        </View>\r\n      </View>\r\n    ),\r\n    [copyToClipboard, saveToFileCallback],\r\n  );\r\n\r\n  const [accessibilityItems, setAccessibilityItems] = useState<\r\n    { text: string; key: string }[]\r\n  >([]);\r\n\r\n  const wakeLock = useMemo(\r\n    () => (stateContextValue.options.wakeLock ? <KeepAwake /> : null),\r\n    [stateContextValue.options.wakeLock],\r\n  );\r\n\r\n  const accessibilityItemsRef = useRef(accessibilityItems);\r\n  accessibilityItemsRef.current = accessibilityItems;\r\n\r\n  const accessibilityContext = useMemo(() => {\r\n    return Platform.select({\r\n      default: {\r\n        announceForAccessibility: (announcement: string) =>\r\n          AccessibilityInfo.announceForAccessibilityWithOptions(announcement, {\r\n            queue: false,\r\n          }),\r\n      },\r\n      web: {\r\n        announceForAccessibility: (announcement: string) => {\r\n          const newItem = { text: announcement, key: Math.random().toString() };\r\n          const oldItem = accessibilityItemsRef.current?.[0];\r\n          if (oldItem?.text == newItem.text) {\r\n            setAccessibilityItems([]);\r\n            // Fix for same attack used in quick succession...\r\n            setTimeout(() => setAccessibilityItems([newItem]), 100);\r\n          } else {\r\n            setAccessibilityItems([newItem]);\r\n          }\r\n        },\r\n      },\r\n    });\r\n  }, []);\r\n\r\n  const [visibilityState, setVisibilityState] = useState(\"visible\");\r\n\r\n  useEffect(() => {\r\n    if (Platform.OS != \"web\") {\r\n      return;\r\n    }\r\n\r\n    const onVisibilityChange = () => {\r\n      setVisibilityState(document.visibilityState);\r\n    };\r\n\r\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\r\n\r\n    return () =>\r\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      Platform.OS == \"web\" &&\r\n      visibilityState == \"visible\" &&\r\n      JSON.stringify(getLayoutType(stateContextValue, height, width)) ==\r\n        JSON.stringify(getLayoutType(stateContextValue, height, width + 1))\r\n    ) {\r\n      // Hack fix for alt tab out and back into window breaking screen readers\r\n      // Does not work if window is maximized\r\n      window.resizeBy(1, 0);\r\n      window.resizeBy(-1, 0);\r\n    }\r\n  }, [visibilityState]);\r\n\r\n  const offlineProgressView = useMemo(\r\n    () => (\r\n      <View style={[{ flex: 1 }, !processingBigTime && { display: \"none\" }]}>\r\n        <SafeAreaView style={[styles.safeAreaContainer, styles.centerAligned]}>\r\n          <OfflineProgress\r\n            currentTicks={currentTicks}\r\n            totalTicks={totalTicks}\r\n          />\r\n        </SafeAreaView>\r\n      </View>\r\n    ),\r\n    [currentTicks, totalTicks, processingBigTime],\r\n  );\r\n\r\n  const accessibilityView = useMemo(\r\n    () =>\r\n      Platform.OS === \"web\" &&\r\n      visibilityState == \"visible\" && (\r\n        <div style={styles.accessibilityView} aria-live=\"polite\" role=\"status\">\r\n          {accessibilityItems.map((item) => (\r\n            <div key={item.key} role=\"none\">\r\n              <UtilityText key={item.key}>{item.text}</UtilityText>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ),\r\n    [accessibilityItems.map((item) => item.key).join(), visibilityState],\r\n  );\r\n\r\n  const mainView = useMemo(\r\n    () => (\r\n      <View\r\n        style={[{ flex: 1 }, processingBigTime && { display: \"none\" }]}\r\n        nativeID={theme.dark ? \"dark\" : \"light\"}\r\n      >\r\n        <GameStateFreezer isVisible={!showIntro && !processingBigTime}>\r\n          <MainAppContents\r\n            setPlayerState={setPlayerState}\r\n            onLoadingProgress={onLoadingProgress}\r\n          />\r\n        </GameStateFreezer>\r\n      </View>\r\n    ),\r\n    [\r\n      processingBigTime,\r\n      theme.dark,\r\n      showIntro,\r\n      setPlayerState,\r\n      onLoadingProgress,\r\n    ],\r\n  );\r\n\r\n  const safeAreaProviderStyle = useMemo(\r\n    () => [\r\n      {\r\n        backgroundColor: theme.colors.background,\r\n      },\r\n      Platform.OS === \"web\" && { height: height, flex: \"auto\" },\r\n    ],\r\n    [theme, height],\r\n  );\r\n\r\n  const internalToPaperContextComponent = useMemo(\r\n    () => (\r\n      <PaperProvider theme={theme}>\r\n        <ErrorBoundary errorFallback={errorView}>\r\n          <AccessibilityContext.Provider value={accessibilityContext}>\r\n            <TooltipControlContext.Provider value={tooltipControlContextValue}>\r\n              <AuxOptionsContext.Provider value={auxOptions}>\r\n                <TooltipContext.Provider value={EMPTY_TOOLTIP_CONTEXT}>\r\n                  <ZoomChecker />\r\n                  <StatusBar style={theme.dark ? \"light\" : \"dark\"} />\r\n                  <FullScreenListener />\r\n                  <SaveDataBackupper />\r\n                  <OrientationLockManager />\r\n                  <DebugUPSOverlay />\r\n                  {wakeLock}\r\n                  {accessibilityView}\r\n                  {offlineProgressView}\r\n                  {mainView}\r\n                </TooltipContext.Provider>\r\n                {!stateContextValue.options.hideTooltips && <TooltipDisplay />}\r\n              </AuxOptionsContext.Provider>\r\n            </TooltipControlContext.Provider>\r\n          </AccessibilityContext.Provider>\r\n        </ErrorBoundary>\r\n      </PaperProvider>\r\n    ),\r\n    [\r\n      theme,\r\n      errorView,\r\n      accessibilityContext,\r\n      tooltipControlContextValue,\r\n      wakeLock,\r\n      accessibilityView,\r\n      offlineProgressView,\r\n      mainView,\r\n      auxOptions,\r\n      stateContextValue?.options?.hideTooltips,\r\n    ],\r\n  );\r\n\r\n  const internalToUIContextComponent = useMemo(\r\n    () => (\r\n      <UIContext.Provider value={uiContextValue}>\r\n        <SafeAreaProvider\r\n          initialMetrics={initialWindowMetrics}\r\n          // @ts-expect-error In react-native-web, flex: \"auto\" works\r\n          style={safeAreaProviderStyle}\r\n        >\r\n          <TooltipContext.Provider value={tooltipContextValue}>\r\n            {internalToPaperContextComponent}\r\n          </TooltipContext.Provider>\r\n        </SafeAreaProvider>\r\n      </UIContext.Provider>\r\n    ),\r\n    [\r\n      initialWindowMetrics,\r\n      safeAreaProviderStyle,\r\n      tooltipContextValue,\r\n      uiContextValue,\r\n      internalToPaperContextComponent,\r\n    ],\r\n  );\r\n\r\n  if (criticalError) {\r\n    return criticalErrorView;\r\n  }\r\n\r\n  if (lessCriticalError) {\r\n    return errorView;\r\n  }\r\n\r\n  if (loading || shouldShowIntro != showIntro) {\r\n    return (\r\n      <ErrorBoundary errorFallback={errorView}>\r\n        <AccessibilityContext.Provider value={accessibilityContext}>\r\n          <Loading theme={theme} />\r\n        </AccessibilityContext.Provider>\r\n      </ErrorBoundary>\r\n    );\r\n  }\r\n\r\n  if (showIntro) {\r\n    return (\r\n      <SafeAreaProvider\r\n        initialMetrics={initialWindowMetrics}\r\n        // @ts-expect-error In react-native-web, flex: \"auto\" works\r\n        style={safeAreaProviderStyle}\r\n      >\r\n        <TooltipContext.Provider value={tooltipContextValue}>\r\n          <PaperProvider theme={theme}>\r\n            <ErrorBoundary errorFallback={errorView}>\r\n              <AccessibilityContext.Provider value={accessibilityContext}>\r\n                <TooltipControlContext.Provider\r\n                  value={tooltipControlContextValue}\r\n                >\r\n                  <AuxOptionsContext.Provider value={auxOptions}>\r\n                    <StateContext.Provider value={stateContextValue}>\r\n                      <UIContext.Provider value={uiContextValue}>\r\n                        <ZoomChecker />\r\n                        <StatusBar style={theme.dark ? \"light\" : \"dark\"} />\r\n                        <FullScreenListener />\r\n                        {wakeLock}\r\n                        <IntroContents />\r\n                        {!stateContextValue.options.hideTooltips && (\r\n                          <TooltipDisplay />\r\n                        )}\r\n                      </UIContext.Provider>\r\n                    </StateContext.Provider>\r\n                  </AuxOptionsContext.Provider>\r\n                </TooltipControlContext.Provider>\r\n              </AccessibilityContext.Provider>\r\n            </ErrorBoundary>\r\n          </PaperProvider>\r\n        </TooltipContext.Provider>\r\n      </SafeAreaProvider>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <StateContext.Provider value={stateContextValue}>\r\n      {internalToUIContextComponent}\r\n    </StateContext.Provider>\r\n  );\r\n}\r\n\r\n/*export default function Test() {\r\n  return (\r\n    <Markdown debugPrintTree>\r\n      Focus your thoughts :close: and gather mana. And don't forget to lock the\r\n      door!\r\n    </Markdown>\r\n  );\r\n}*/\r\n\r\nconst headerPadding =\r\n  Platform.OS === \"android\" ? 16 : Platform.OS === \"web\" ? 8 : 0;\r\n\r\nconst styles = StyleSheet.create({\r\n  headerContainer: {\r\n    paddingTop: headerPadding,\r\n  },\r\n  rightHeaderContainer: {\r\n    flexDirection: \"row\",\r\n  },\r\n  rightHeaderIcon: {\r\n    marginLeft: 20,\r\n  },\r\n  gestureRecognizer: {\r\n    flex: 1,\r\n  },\r\n  safeAreaContainer: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n  },\r\n  centerAligned: {\r\n    alignItems: \"center\",\r\n  },\r\n  maxContainer: {\r\n    flex: 1,\r\n    height: \"100%\",\r\n  },\r\n  biggerContainer: {\r\n    flex: 1,\r\n    backgroundColor: \"#fff\",\r\n  },\r\n  mainContainerPhone: {\r\n    overflow: \"hidden\",\r\n  },\r\n  introContainer: {\r\n    flex: 1,\r\n    alignItems: \"center\",\r\n  },\r\n  horizontalContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"stretch\",\r\n    overflow: \"hidden\",\r\n    flex: 1,\r\n  },\r\n  mainContainer: {\r\n    flex: 1,\r\n  },\r\n  webMenuContainer: {\r\n    width: 284,\r\n    paddingRight: 8,\r\n  },\r\n  webRightMenuContainer: {\r\n    width: 300,\r\n    paddingLeft: 8,\r\n  },\r\n  notificationsBadge: {\r\n    position: \"absolute\",\r\n    top: -4,\r\n    right: -4,\r\n    fontWeight: \"bold\",\r\n  },\r\n  menuContainer: {\r\n    position: \"absolute\",\r\n  },\r\n  container: {\r\n    padding: 8,\r\n  },\r\n  centerText: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  offlineProgressContainer: {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  saveButton: {\r\n    marginTop: 8,\r\n  },\r\n  errorContainer: {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  errorWrapper: {\r\n    maxWidth: 600,\r\n    marginHorizontal: 16,\r\n  },\r\n  errorHeader: {\r\n    marginBottom: 8,\r\n  },\r\n  accessibilityView: {\r\n    height: 0,\r\n    width: 0,\r\n    overflow: \"hidden\",\r\n    position: \"absolute\",\r\n    left: 100,\r\n    top: 100,\r\n  },\r\n  accessibilityHidden: {\r\n    width: 1,\r\n    height: 1,\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n  closeButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 32,\r\n    width: 32,\r\n    borderRadius: 16,\r\n  },\r\n  pinButtonInner: {\r\n    paddingHorizontal: 0,\r\n    paddingVertical: 0,\r\n    height: 32,\r\n    width: 32,\r\n  },\r\n  fullscreenContainer: {\r\n    alignItems: \"center\",\r\n    flex: 1,\r\n  },\r\n  fullscreenContainerInside: {\r\n    marginHorizontal: 16,\r\n    marginVertical: 16,\r\n    maxWidth: 600,\r\n  },\r\n});\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { clearLandCache } from \"../../buildings/Buildings\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport {\r\n  clearResourceCapCache,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport { Storylines } from \"../../storylines/Storylines\";\r\nimport {\r\n  applyMultiplierTransformations,\r\n  applyTransformations,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Action, DoActionArgs } from \"../Action\";\r\nimport { ActionArea, ActionSubcategories } from \"../ActionAreas\";\r\n\r\nclass ExpandHome extends Action {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      hasFlag(state, Flag.LandPurchaseUnlocked) &&\r\n      !Storylines.getByIdNullable(\"blessedLand\")?.isBonusActive?.(state)\r\n    );\r\n  }\r\n\r\n  getId(): string {\r\n    return \"expandHome\";\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategories[]>> {\r\n    return { HOME: [ActionSubcategories.ACTIONS] };\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    const amount = state.run.landPurchaseCount;\r\n    if (amount == 0) {\r\n      return t(\"Expand Home\");\r\n    } else {\r\n      return t(\"Expand Home ({{amount}})\", { amount: formatNumber(amount) });\r\n    }\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return t(\r\n      \"Get a new parcel of land for your home so you can have more space for furniture.\",\r\n    );\r\n  }\r\n\r\n  landCapTags = [TransformationTags.Land, TransformationTags.Cap];\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+{{amount}}:land:\", {\r\n      amount: formatNumber(\r\n        applyMultiplierTransformations(this.landCapTags, state, 20),\r\n      ),\r\n    });\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return [...super.getTags(), TransformationTags.Land];\r\n  }\r\n\r\n  costScaleTags = [...this.getTags(), TransformationTags.CostScale];\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    const fractionAddedPerLandPurchase = applyTransformations(\r\n      this.costScaleTags,\r\n      state,\r\n      0.666667,\r\n    );\r\n    return {\r\n      resources: {\r\n        Coins:\r\n          Math.pow(\r\n            1.0 + fractionAddedPerLandPurchase,\r\n            state.run.landPurchaseCount,\r\n          ) * 1250,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n    state = grantResource(\r\n      Resource.Coins,\r\n      -(this.getCost(state).resources.Coins ?? 0),\r\n    )(state);\r\n    state.run.landPurchaseCount += 1;\r\n    state.world.maxLandsPurchased = Math.max(\r\n      state.run.landPurchaseCount,\r\n      state.world.maxLandsPurchased,\r\n    );\r\n    state = clearLandCache(state);\r\n    state = clearResourceCapCache(state);\r\n    return state;\r\n  }\r\n\r\n  canAutoPurchaseMax(): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nconst expandHome = new ExpandHome();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Land, TransformationTags.Cap]],\r\n  expandHome.getId(),\r\n  t(\"Purchased Land\"),\r\n  TransformationType.Addition,\r\n  (state, params) => 20 * state.run.landPurchaseCount,\r\n);\r\n\r\nexport default expandHome;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Action, ActionEffect, DoActionArgs } from \"../Action\";\r\nimport { ActionArea, ActionSubcategories } from \"../ActionAreas\";\r\n\r\nclass GatherMana extends Action {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  getId(): string {\r\n    return \"gatherMana\";\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategories[]>> {\r\n    return { HOME: [ActionSubcategories.ACTIONS] };\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    return t(\"Gather Mana\");\r\n  }\r\n\r\n  isVisible(): boolean {\r\n    return true;\r\n  }\r\n\r\n  isEnabled(state: GameState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.Mana) <\r\n      getResourceCap(state, Resource.Mana)\r\n    );\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return [\r\n      ...super.getTags(),\r\n      TransformationTags.ManualGathering,\r\n      TransformationTags.Production,\r\n      Resource.Mana,\r\n    ];\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return t(\r\n      \"Focus your thoughts and gather mana. *Tip: You can press and hold buttons to auto-press them!*\",\r\n    );\r\n  }\r\n\r\n  getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      mana: { value: 1 },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    return t(`+{{amount}}:mana:`, {\r\n      amount: formatNumber(effects.mana, {\r\n        showDecimals: true,\r\n      }),\r\n    });\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return { resources: {}, items: {} };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    return grantResource(\r\n      Resource.Mana,\r\n      this.getActionEffects(state).mana,\r\n    )(state);\r\n  }\r\n}\r\n\r\nexport default new GatherMana();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasEverHadFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource, getResourceAmount, grantResource } from \"../../Resources\";\r\nimport { triggerRandomEvent } from \"../../events/autorandom/RandomEventTrigger\";\r\nimport { recordTimePieceConsumption } from \"../../timetick/TimePieces\";\r\nimport { Action, ActionEffect, DoActionArgs } from \"../Action\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../ActionAreas\";\r\n\r\nclass UseTimePiecesEvent extends Action {\r\n  getId(): string {\r\n    return \"useTimePiecesEvent\";\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    return t(\"Use Time Pieces (Event)\");\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.TimePiece) > 0 &&\r\n      hasEverHadFlag(state, Flag.ExplorationUnlocked)\r\n    );\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return {\r\n      HOME: [ActionSubcategories.TIME_PIECES],\r\n    };\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Use your time pieces to immediately trigger a random occurrence.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(`Instantly trigger the next random event`);\r\n  }\r\n\r\n  canAfford(state: GameState): boolean {\r\n    return (\r\n      super.canAfford(state) &&\r\n      getResourceAmount(state, Resource.TimePiece) >= 1800\r\n    );\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        TimePiece: 1800,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    state = grantResource(\r\n      Resource.TimePiece,\r\n      -(this.getCost(state).resources[Resource.TimePiece] ?? 0),\r\n    )(state);\r\n\r\n    state = recordTimePieceConsumption(\r\n      state,\r\n      this.getCost(state).resources[Resource.TimePiece] ?? 0,\r\n    );\r\n\r\n    return triggerRandomEvent(state);\r\n  }\r\n}\r\n\r\nexport default new UseTimePiecesEvent();\r\n","import { keysOf } from \"../../../utils/CoreUtils\";\r\nimport { formatNumber, formatTime } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource, getResourceAmount, grantResource } from \"../../Resources\";\r\nimport { grantElementExp } from \"../../spells/Elements\";\r\nimport {\r\n  BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER,\r\n  getBaseResearchRate,\r\n} from \"../../study/Study\";\r\nimport { recordTimePieceConsumption } from \"../../timetick/TimePieces\";\r\nimport { applyTransformations } from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Action, ActionEffect, DoActionArgs } from \"../Action\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../ActionAreas\";\r\n\r\nclass UseTimePiecesStudy extends Action {\r\n  getId(): string {\r\n    return \"useTimePiecesStudy\";\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    return t(\"Use Time Pieces (Study)\");\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      getResourceAmount(state, Resource.TimePiece) > 0 &&\r\n      hasFlag(state, Flag.StudyUnlocked)\r\n    );\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return {\r\n      HOME: [ActionSubcategories.TIME_PIECES],\r\n      STUDY: [ActionSubcategories.TIME_PIECES],\r\n    };\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Use your time pieces to fast-forward Studying.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      timePiecesPerResearchSecond: {\r\n        value: 2,\r\n        tags: [TransformationTags.TimePiecePerStudy],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const timePiecesPerResearchSecond =\r\n      this.getActionEffects(state).timePiecesPerResearchSecond;\r\n    const secs = 3000 / timePiecesPerResearchSecond;\r\n    const timeString = formatTime(secs, {\r\n      shortForm: true,\r\n      showDecimals: true,\r\n    });\r\n    const expPerResearcherPerSec = getBaseResearchRate(state);\r\n    const transformedSecs = applyTransformations(\r\n      [TransformationTags.GameSpeed],\r\n      state,\r\n      secs,\r\n      { isWarp: true },\r\n    );\r\n    const expPerResearcher = expPerResearcherPerSec * transformedSecs;\r\n    return t(\r\n      `Instantly obtain {{timeString}} (Real World time) of Study ({{exp}} exp per researcher)`,\r\n      {\r\n        timeString: timeString,\r\n        exp: formatNumber(expPerResearcher),\r\n      },\r\n    );\r\n  }\r\n\r\n  canAfford(state: GameState): boolean {\r\n    return (\r\n      super.canAfford(state) &&\r\n      getResourceAmount(state, Resource.TimePiece) >= 3000\r\n    );\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        TimePiece: 3000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  isEnabled(state: GameState): boolean {\r\n    return (\r\n      super.isEnabled(state) &&\r\n      keysOf(state.run.studyAllocation).some(\r\n        (element) => (state.run.studyAllocation[element] ?? 0) > 0,\r\n      )\r\n    );\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    const timePiecesPerResearchSecond =\r\n      this.getActionEffects(state).timePiecesPerResearchSecond;\r\n    const timePieces = this.getCost(state).resources[Resource.TimePiece] ?? 0;\r\n    const secs = timePieces / timePiecesPerResearchSecond;\r\n    const transformedSecs = applyTransformations(\r\n      [TransformationTags.GameSpeed],\r\n      state,\r\n      secs,\r\n      { isWarp: true },\r\n    );\r\n\r\n    state = grantResource(Resource.TimePiece, -timePieces)(state);\r\n    state = recordTimePieceConsumption(state, timePieces);\r\n\r\n    keysOf(state.run.studyAllocation).forEach((element) => {\r\n      const researchersAllocated = state.run.studyAllocation[element] ?? 0;\r\n      if (researchersAllocated > 0) {\r\n        const expPerResearcherPerSec = applyTransformations(\r\n          [element, TransformationTags.Study, TransformationTags.ExpGain],\r\n          state,\r\n          BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER,\r\n          { isWarp: true, fromResearch: true },\r\n        );\r\n        state = grantElementExp(\r\n          element,\r\n          researchersAllocated * expPerResearcherPerSec * transformedSecs,\r\n        )(state);\r\n      }\r\n    });\r\n\r\n    return state;\r\n  }\r\n}\r\n\r\nexport default new UseTimePiecesStudy();\r\n","import { formatTime } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../Resources\";\r\nimport { recordTimePieceConsumption } from \"../../timetick/TimePieces\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Action, ActionEffect, DoActionArgs } from \"../Action\";\r\nimport { ActionArea, ActionSubcategories } from \"../ActionAreas\";\r\n\r\nclass UseTimePiecesWarp extends Action {\r\n  getId(): string {\r\n    return \"useTimePiecesWarp\";\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return getResourceAmount(state, Resource.TimePiece) > 0;\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Use Time Pieces (Warp)\");\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategories[]>> {\r\n    return { HOME: [ActionSubcategories.TIME_PIECES] };\r\n  }\r\n\r\n  getDisplayDescription(): string {\r\n    return \"Use your time pieces to warp time, affecting every aspect of the game.\";\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      timePiecePerWarpedSec: {\r\n        value: 5,\r\n        tags: [TransformationTags.TimePiecePerWarpedSec],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const cost = this.getCost(state).resources[Resource.TimePiece] ?? 1;\r\n    const effect = this.getActionEffects(state);\r\n    const totalSecs = cost / effect.timePiecePerWarpedSec;\r\n    return t(\"Warp time forward by {{formattedTime}} (Real World)\", {\r\n      formattedTime: formatTime(totalSecs, {\r\n        shortForm: false,\r\n        showDecimals: false,\r\n      }),\r\n    });\r\n  }\r\n\r\n  canAfford(state: GameState): boolean {\r\n    return (\r\n      super.canAfford(state) &&\r\n      getResourceAmount(state, Resource.TimePiece) >= 3000\r\n    );\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        TimePiece: 3000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n    const cost = this.getCost(state).resources.TimePiece ?? 1;\r\n    const effect = this.getActionEffects(state);\r\n    const totalSecs = cost / effect.timePiecePerWarpedSec;\r\n    state = grantResource(Resource.TimePiece, -cost)(state);\r\n    state = recordTimePieceConsumption(state, cost);\r\n    state.run.warpTimeSecs = totalSecs;\r\n\r\n    return state;\r\n  }\r\n\r\n  canSpam(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default new UseTimePiecesWarp();\r\n","import { loadActionsCommonLogic, registerAction } from \"./Actions\";\r\nimport ExpandHome from \"./actions/ExpandHome\";\r\nimport GatherMana from \"./actions/GatherMana\";\r\nimport UseTimePiecesEvent from \"./actions/UseTimePiecesEvent\";\r\nimport UseTimePiecesStudy from \"./actions/UseTimePiecesStudy\";\r\nimport UseTimePiecesWarp from \"./actions/UseTimePiecesWarp\";\r\n\r\nexport function loadActions() {\r\n  loadActionsCommonLogic();\r\n  registerAction(GatherMana);\r\n  registerAction(ExpandHome);\r\n  registerAction(UseTimePiecesWarp);\r\n  registerAction(UseTimePiecesStudy);\r\n  registerAction(UseTimePiecesEvent);\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport { TransmutationSpell } from \"../TransmutationSpell\";\r\n\r\nclass MonstiumPaper extends Item {\r\n  getId(): string {\r\n    return \"monstiumPaper\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./monstiumPaper.png\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Mind;\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Monstium Paper\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"Monstium Paper. Used for stronger Enhancements.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2000;\r\n  }\r\n}\r\n\r\nexport const monstiumPaper = new MonstiumPaper();\r\n\r\nclass TransmuteMonstiumPaper extends TransmutationSpell {\r\n  getItem(): Item {\r\n    return monstiumPaper;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Mind: 1,\r\n    };\r\n  }\r\n\r\n  canCraft(state: GameState): boolean {\r\n    return hasFlag(state, Flag.DeepCavernsUnlocked) && super.canCraft(state);\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.DeepCavernsUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 800,\r\n        Monstium: 4000,\r\n        MindEssence: 25000,\r\n      },\r\n      items: {\r\n        paper: 1,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Mind;\r\n  }\r\n}\r\n\r\nexport const transmuteMonstiumPaper = new TransmuteMonstiumPaper();\r\n","import { GameState } from \"../GameState\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Enhancement } from \"./Enhancement\";\r\n\r\nexport const EnhancementPurchaseListeners = new DataStore<\r\n  (state: GameState, enhancement: Enhancement) => GameState\r\n>();\r\n","import { keysOf } from \"../../utils/CoreUtils\";\r\nimport { Action, DoActionArgs } from \"../action/Action\";\r\nimport { ActionArea, ActionSubcategory } from \"../action/ActionAreas\";\r\nimport { hasEverHadFlag, hasFlag, setFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  monstiumPaper,\r\n  transmuteMonstiumPaper,\r\n} from \"../items/transmute/materials/MonstiumPaper\";\r\nimport { Resource } from \"../Resources\";\r\nimport { EnhancementPurchaseListeners } from \"./EnhancementPurchaseListeners\";\r\n\r\nexport abstract class Enhancement extends Action {\r\n  abstract getBaseName(): string;\r\n  abstract getSubcategory(): ActionSubcategory;\r\n  abstract getBaseResourceCost(): Partial<Record<Resource, number>>;\r\n  abstract getItemCost(): Record<string, number>;\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { ENHANCEMENT: [this.getSubcategory()] };\r\n  }\r\n\r\n  getDisplayName(state: GameState): string {\r\n    return this.getBaseName();\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      !this.isPurchased(state) &&\r\n      this.getRequiredEnhancements().every((enhancement) =>\r\n        enhancement.isPurchased(state),\r\n      )\r\n    );\r\n  }\r\n\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [];\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    // TODO: transformations\r\n    return {\r\n      resources: this.getBaseResourceCost(),\r\n      items: this.getItemCost(),\r\n    };\r\n  }\r\n\r\n  isCapEnough(state: GameState): boolean {\r\n    return (\r\n      super.isCapEnough(state) &&\r\n      (keysOf(this.getItemCost()).includes(monstiumPaper.getId())\r\n        ? transmuteMonstiumPaper.isVisible(state)\r\n        : true)\r\n    );\r\n  }\r\n\r\n  isPurchased(state: GameState): boolean {\r\n    return hasFlag(state, \"enhancement-\" + this.getId());\r\n  }\r\n\r\n  hasEverBeenPurchased(state: GameState): boolean {\r\n    return hasEverHadFlag(state, \"enhancement-\" + this.getId());\r\n  }\r\n\r\n  setPurchased(state: GameState): GameState {\r\n    state = setFlag(\"enhancement-\" + this.getId())(state);\r\n    EnhancementPurchaseListeners.getAll().forEach((transform) => {\r\n      state = transform(state, this);\r\n    });\r\n    return state;\r\n  }\r\n\r\n  doAction(args: DoActionArgs, state: GameState): GameState {\r\n    if (!this.canAfford(state)) {\r\n      return state;\r\n    }\r\n\r\n    state = this.payCost(state);\r\n\r\n    return this.setPurchased(state);\r\n  }\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\n\r\nclass MonstiumCollection extends Enhancement {\r\n  getId(): string {\r\n    return \"monstiumCollection\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Monstium Collection\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 400,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 4,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Enhance your ability to collect loot from defeated enemies.\");\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+40%:monstium: obtained from Exploration\");\r\n  }\r\n}\r\n\r\nexport const monstiumCollection = new MonstiumCollection();\r\n\r\nregisterTransformation(\r\n  [\r\n    [\r\n      TransformationTags.Loot,\r\n      TransformationTags.FromExploration,\r\n      Resource.Monstium,\r\n    ],\r\n  ],\r\n  monstiumCollection.getId(),\r\n  monstiumCollection.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (monstiumCollection.isPurchased(state) ? 1.4 : 1.0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { essenceCatalyst } from \"../../buildings/catalysts/EssenceCatalyst\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\n\r\nclass SuperheatedCatalysts extends Enhancement {\r\n  getId(): string {\r\n    return \"superheatedCatalysts\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Superheated Catalysts\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_CATALYSTS;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 400,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 3,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Apply a special technique to Essence Catalysts to increase their effectivity.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+15% effectivity of Essence Catalysts\");\r\n  }\r\n}\r\n\r\nconst superheatedCatalysts = new SuperheatedCatalysts();\r\n\r\nregisterTransformation(\r\n  [[essenceCatalyst.getId(), TransformationTags.CatalystEffectivity]],\r\n  superheatedCatalysts.getId(),\r\n  superheatedCatalysts.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (superheatedCatalysts.isPurchased(state) ? 1.15 : 1.0),\r\n);\r\n\r\nexport { superheatedCatalysts };\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { getUnlockedElements, SpellElement } from \"../../spells/Elements\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { monstiumCollection } from \"../exploration/MonstiumCollection\";\r\nimport { superheatedCatalysts } from \"../production/SuperheatedCatalysts\";\r\n\r\nclass MonstiumCatalysts extends Enhancement {\r\n  getId(): string {\r\n    return \"monstiumCatalysts\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Monstium Catalysts\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_CATALYSTS;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 2000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 12,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [monstiumCollection, superheatedCatalysts];\r\n  }\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      super.isVisible(state) &&\r\n      getUnlockedElements(state).includes(SpellElement.Poison)\r\n    );\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Discover a new type of furniture, which is able to increase the amount of Monstium obtained from enemies.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t('Unlock furniture \"Monstium Catalyst\"');\r\n  }\r\n}\r\n\r\nexport const monstiumCatalysts = new MonstiumCatalysts();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { monstiumCatalysts } from \"../../enhancement/other/MonstiumCatalysts\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport { registerSpell } from \"../../spells/Spells\";\r\nimport {\r\n  applyTransformationsCached,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport { Buildings, getBuildingAmount } from \"../Buildings\";\r\n\r\nclass MonstiumCatalyst extends Building {\r\n  getId(): string {\r\n    return \"monstiumCatalyst\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Monstium Catalyst\");\r\n  }\r\n\r\n  catalystEffectivityTags = [\r\n    TransformationTags.CatalystEffectivity,\r\n    this.getId(),\r\n  ];\r\n\r\n  getPerCatalystBonusMultiplier(state: GameState): number {\r\n    return (\r\n      1.0 +\r\n      applyTransformationsCached(this.catalystEffectivityTags, state, 0.12)\r\n    );\r\n  }\r\n\r\n  catalystEffectivityParams = {\r\n    valueType: TransformationValueType.Percent,\r\n  };\r\n\r\n  getPerCatalystBonusMultiplierExplanation(state: GameState): string {\r\n    return explainTransformationsText(\r\n      this.catalystEffectivityTags,\r\n      state,\r\n      0.12,\r\n      this.catalystEffectivityParams,\r\n    );\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"A catalyst that drastically improves Monstium gain.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effectPct = (this.getPerCatalystBonusMultiplier(state) - 1.0) * 100;\r\n    return t(\r\n      \"^+{{effectPct}}%^<{{explanation}}>:monstium: obtained from enemies\",\r\n      {\r\n        effectPct: formatNumber(effectPct),\r\n        explanation: this.getPerCatalystBonusMultiplierExplanation(state),\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 10;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const monstiumCatalyst = new MonstiumCatalyst();\r\n\r\nclass BuildMonstiumCatalyst extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.CATALYSTS] };\r\n  }\r\n\r\n  getBuilding(): MonstiumCatalyst {\r\n    return monstiumCatalyst;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      PoisonEssence: 4000,\r\n      FireEssence: 2000,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      PoisonEssence: 1.8,\r\n      FireEssence: 1.8,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return monstiumCatalysts.isPurchased(state) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const buildMonstiumCatalyst = new BuildMonstiumCatalyst();\r\n\r\nexport function loadMonstiumCatalysts() {\r\n  Buildings.register(monstiumCatalyst);\r\n  registerSpell(buildMonstiumCatalyst);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Loot, Resource.Monstium]],\r\n    \"monstiumCatalyst\",\r\n    t(\"Monstium Catalyst\"),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      const building = monstiumCatalyst;\r\n      return Math.pow(\r\n        building.getPerCatalystBonusMultiplier(state),\r\n        getBuildingAmount(state, building),\r\n      );\r\n    },\r\n  );\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { clearVisibleSpellsCache } from \"../../spells/VisibleSpellsCache\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\n\r\nclass ManaSteamers extends Enhancement {\r\n  getId(): string {\r\n    return \"manaSteamers\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Mana Steamers\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_OTHER;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 250,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 2,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Discover a new type of furniture, that uses :wateressence: and :fireessence: to generate :mana:.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t('Unlock furniture \"Mana Steamer\"');\r\n  }\r\n}\r\n\r\nconst manaSteamers = new ManaSteamers();\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == manaSteamers) {\r\n    return clearVisibleSpellsCache(state);\r\n  }\r\n  return state;\r\n}, manaSteamers.getId());\r\n\r\nexport { manaSteamers };\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { manaSteamers } from \"../../enhancement/other/ManaSteamers\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n  clearCalculatedIncomeCache,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport {\r\n  BuildingAmountListeners,\r\n  getBuildingAmountTurnedOn,\r\n} from \"../Buildings\";\r\n\r\nconst manaTags = [TransformationTags.Production, Resource.Mana, \"manaSteamer\"];\r\nconst BASE_REGEN = 6.0;\r\nfunction getManaRegenPerSec(state: GameState): number {\r\n  return applyTransformations(manaTags, state, BASE_REGEN);\r\n}\r\nconst manaRegenUnit = memoize(() => ({\r\n  unit: t(\":mana:/sec\"),\r\n}));\r\nfunction getManaRegenPerSecExplanation(state: GameState): string {\r\n  return explainTransformationsText(\r\n    manaTags,\r\n    state,\r\n    BASE_REGEN,\r\n    manaRegenUnit(),\r\n  );\r\n}\r\n\r\nconst BASE_CONSUMPTION = 3.0;\r\nconst fireTags = [\r\n  TransformationTags.Consumption,\r\n  Resource.FireEssence,\r\n  \"manaSteamer\",\r\n];\r\nfunction getFireEssenceConsumptionPerSec(state: GameState): number {\r\n  return applyTransformations(fireTags, state, BASE_CONSUMPTION);\r\n}\r\nconst fireEssenceUnit = memoize(() => ({\r\n  unit: t(\":fireessence:/sec\"),\r\n}));\r\nfunction getFireEssenceConsumptionPerSecExplanation(state: GameState): string {\r\n  return explainTransformationsText(\r\n    fireTags,\r\n    state,\r\n    BASE_CONSUMPTION,\r\n    fireEssenceUnit(),\r\n  );\r\n}\r\n\r\nconst waterTags = [\r\n  TransformationTags.Consumption,\r\n  Resource.WaterEssence,\r\n  \"manaSteamer\",\r\n];\r\nfunction getWaterEssenceConsumptionPerSec(state: GameState): number {\r\n  return applyTransformations(waterTags, state, BASE_CONSUMPTION);\r\n}\r\nconst waterEssenceUnit = memoize(() => ({\r\n  unit: t(\":wateressence:/sec\"),\r\n}));\r\nfunction getWaterEssenceConsumptionPerSecExplanation(state: GameState): string {\r\n  return explainTransformationsText(\r\n    waterTags,\r\n    state,\r\n    BASE_CONSUMPTION,\r\n    waterEssenceUnit(),\r\n  );\r\n}\r\n\r\nclass ManaSteamer extends Building {\r\n  getId(): string {\r\n    return \"manaSteamer\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Mana Steamer\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"A device that is able to use Water and Fire to produce Mana.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"^+{{manaRegenPerSec}}^<{{manaRegenExplanation}}>:mana:/sec; ^-{{waterConsumptionPerSec}}^<{{waterConsumptionExplanation}}>:wateressence:/sec; ^-{{fireConsumptionPerSec}}^<{{fireConsumptionExplanation}}>:fireessence:/sec\",\r\n      {\r\n        manaRegenPerSec: formatNumber(getManaRegenPerSec(state), {\r\n          showDecimals: true,\r\n        }),\r\n        waterConsumptionPerSec: formatNumber(\r\n          getWaterEssenceConsumptionPerSec(state),\r\n          {\r\n            showDecimals: true,\r\n          },\r\n        ),\r\n        fireConsumptionPerSec: formatNumber(\r\n          getFireEssenceConsumptionPerSec(state),\r\n          {\r\n            showDecimals: true,\r\n          },\r\n        ),\r\n        manaRegenExplanation: getManaRegenPerSecExplanation(state),\r\n        waterConsumptionExplanation:\r\n          getWaterEssenceConsumptionPerSecExplanation(state),\r\n        fireConsumptionExplanation:\r\n          getFireEssenceConsumptionPerSecExplanation(state),\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 4;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nconst manaSteamer = new ManaSteamer();\r\n\r\nclass BuildManaSteamer extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.MANA] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return manaSteamer;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      WaterEssence: 3000,\r\n      FireEssence: 3000,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      WaterEssence: 1.25,\r\n      FireEssence: 1.25,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return manaSteamers.isPurchased(state) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nconst buildManaSteamer = new BuildManaSteamer();\r\n\r\nIncomeOverTimeProducers.register(\r\n  new IncomeOverTimeProducer(\r\n    manaSteamer.getId(),\r\n    manaSteamer.getName(),\r\n    (state) => ({\r\n      Mana:\r\n        getManaRegenPerSec(state) *\r\n        getBuildingAmountTurnedOn(state, manaSteamer),\r\n      FireEssence:\r\n        -1 *\r\n        getFireEssenceConsumptionPerSec(state) *\r\n        getBuildingAmountTurnedOn(state, manaSteamer),\r\n      WaterEssence:\r\n        -1 *\r\n        getWaterEssenceConsumptionPerSec(state) *\r\n        getBuildingAmountTurnedOn(state, manaSteamer),\r\n    }),\r\n  ),\r\n);\r\n\r\nBuildingAmountListeners.register((state, building) => {\r\n  if (building == manaSteamer) {\r\n    state = clearCalculatedIncomeCache(state);\r\n  }\r\n  return state;\r\n});\r\n\r\nexport { buildManaSteamer, manaSteamer };\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { getUnlockedElements, SpellElement } from \"../../spells/Elements\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { manaSteamers } from \"./ManaSteamers\";\r\n\r\nclass SewageSystem extends Enhancement {\r\n  getId(): string {\r\n    return \"sewageSystemEnhancement\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Sewage System\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_PRODUCTION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 600,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 10,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [manaSteamers];\r\n  }\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      super.isVisible(state) &&\r\n      getUnlockedElements(state).includes(SpellElement.Poison)\r\n    );\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Discover a new type of furniture, which converts :poisonessence: automatically into large amounts of :fireessence:, :earthessence:, :wateressence: and :airessence:.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t('Unlock furniture \"Sewage System\"');\r\n  }\r\n}\r\n\r\nexport const sewageSystemEnhancement = new SewageSystem();\r\n","import memoize from \"sonic-memoize\";\r\nimport { fromEntries } from \"../../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { sewageSystemEnhancement } from \"../../enhancement/other/SewageSystem\";\r\nimport { SpellElement, getUnlockedElements } from \"../../spells/Elements\";\r\nimport { registerSpell } from \"../../spells/Spells\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../spells/channeling/ChannelingResources\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n  clearCalculatedIncomeCache,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport {\r\n  BuildingAmountListeners,\r\n  Buildings,\r\n  getBuildingAmountTurnedOn,\r\n} from \"../Buildings\";\r\n\r\nconst productionTags = memoize((resource) => [\r\n  TransformationTags.Production,\r\n  resource,\r\n  \"sewageSystem\",\r\n]);\r\nconst unitForResource = memoize((resource) => ({\r\n  unit: t(\"{{resourceIcon}}/sec\", {\r\n    resourceIcon: `:${resource.toLowerCase()}:`,\r\n  }),\r\n}));\r\nconst BASE_PRODUCTION = 100.0;\r\nfunction getEssenceProductionPerSec(\r\n  state: GameState,\r\n  resource: Resource,\r\n): number {\r\n  return applyTransformations(productionTags(resource), state, BASE_PRODUCTION);\r\n}\r\nfunction getEssenceProductionPerSecExplanation(\r\n  state: GameState,\r\n  resource: Resource,\r\n): string {\r\n  return explainTransformationsText(\r\n    productionTags(resource),\r\n    state,\r\n    BASE_PRODUCTION,\r\n    unitForResource(resource),\r\n  );\r\n}\r\n\r\nconst poisonTags = [\r\n  TransformationTags.Consumption,\r\n  Resource.PoisonEssence,\r\n  \"sewageSystem\",\r\n];\r\nconst BASE_CONSUMPTION = 10.0;\r\nfunction getPoisonEssenceConsumptionPerSec(state: GameState): number {\r\n  return applyTransformations(poisonTags, state, BASE_CONSUMPTION);\r\n}\r\nconst unitForConsumption = memoize(() => ({\r\n  unit: t(\":poisonessence:/sec\"),\r\n}));\r\nfunction getPoisonEssenceConsumptionPerSecExplanation(\r\n  state: GameState,\r\n): string {\r\n  return explainTransformationsText(\r\n    poisonTags,\r\n    state,\r\n    BASE_CONSUMPTION,\r\n    unitForConsumption(),\r\n  );\r\n}\r\n\r\nfunction getResourcesProduced(state: GameState): Resource[] {\r\n  let baseEssences = [\r\n    Resource.FireEssence,\r\n    Resource.EarthEssence,\r\n    Resource.WaterEssence,\r\n    Resource.AirEssence,\r\n  ];\r\n  if (hasFlag(state, Flag.SewageSystemMakesAll)) {\r\n    baseEssences = getUnlockedElements(state)\r\n      .filter((element) => element != SpellElement.Poison)\r\n      .map((element) => RESOURCE_FOR_ELEMENT[element]);\r\n  }\r\n  if (hasFlag(state, \"enhancement-sewageParadox\")) {\r\n    baseEssences.push(Resource.PoisonEssence);\r\n  }\r\n  return baseEssences;\r\n}\r\n\r\nclass SewageSystem extends Building {\r\n  getId(): string {\r\n    return \"sewageSystem\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Sewage System\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A nifty piece of furniture that converts Poison Essence into other elemental essences automatically.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const resourcesProduced = getResourcesProduced(state);\r\n    const resourceStrings = [];\r\n    for (let resource of resourcesProduced) {\r\n      resourceStrings.push(\r\n        t(\"^+{{income}}^<{{explanation}}>:{{icon}}:/sec\", {\r\n          income: formatNumber(getEssenceProductionPerSec(state, resource), {\r\n            showDecimals: true,\r\n          }),\r\n          explanation: getEssenceProductionPerSecExplanation(state, resource),\r\n          icon: resource.toLowerCase(),\r\n        }),\r\n      );\r\n    }\r\n    const productionString = resourceStrings.join(t(\", \"));\r\n    if (hasFlag(state, \"enhancement-sewageParadox\")) {\r\n      return productionString;\r\n    }\r\n    return t(\r\n      \"{{productionString}}; ^-{{consumption}}^<{{consumptionExplanation}}>:poisonessence:/sec\",\r\n      {\r\n        productionString,\r\n        consumption: formatNumber(getPoisonEssenceConsumptionPerSec(state), {\r\n          showDecimals: true,\r\n        }),\r\n        consumptionExplanation:\r\n          getPoisonEssenceConsumptionPerSecExplanation(state),\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 6;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport const sewageSystem = new SewageSystem();\r\n\r\nclass BuildSewageSystem extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.OTHER] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return sewageSystem;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      PoisonEssence: 6000,\r\n      WaterEssence: 5000,\r\n      AirEssence: 5000,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      PoisonEssence: 1.25,\r\n      WaterEssence: 1.25,\r\n      AirEssence: 1.25,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return sewageSystemEnhancement.isPurchased(state) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const buildSewageSystem = new BuildSewageSystem();\r\n\r\nexport function loadSewageSystem() {\r\n  Buildings.register(sewageSystem);\r\n  registerSpell(buildSewageSystem);\r\n\r\n  IncomeOverTimeProducers.register(\r\n    new IncomeOverTimeProducer(\r\n      sewageSystem.getId(),\r\n      sewageSystem.getName(),\r\n      (state) => {\r\n        const resources = getResourcesProduced(state);\r\n        const resourcesPerSec = fromEntries(\r\n          resources.map((resource) => [\r\n            resource,\r\n            getEssenceProductionPerSec(state, resource) *\r\n              getBuildingAmountTurnedOn(state, sewageSystem),\r\n          ]),\r\n        );\r\n        if (!hasFlag(state, \"enhancement-sewageParadox\")) {\r\n          resourcesPerSec.PoisonEssence =\r\n            -1 *\r\n            getPoisonEssenceConsumptionPerSec(state) *\r\n            getBuildingAmountTurnedOn(state, sewageSystem);\r\n        }\r\n        return resourcesPerSec;\r\n      },\r\n    ),\r\n  );\r\n\r\n  BuildingAmountListeners.register((state, building) => {\r\n    if (building == sewageSystem) {\r\n      state = clearCalculatedIncomeCache(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../action/ActionAreas\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"./Building\";\r\nimport { getBuildingAmount } from \"./Buildings\";\r\n\r\nclass ResearcherDesk extends Building {\r\n  getId(): string {\r\n    return \"researcherDesk\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Researcher Desk\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A flat surface, perfect for the focused study of Magic. The spot for a hired Researcher!\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+1 Researcher\");\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 4;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const researcherDesk = new ResearcherDesk();\r\n\r\nclass BuildResearcherDesk extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.OTHER] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return researcherDesk;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 500,\r\n      WaterEssence: 500,\r\n      FireEssence: 150,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 1.5,\r\n      WaterEssence: 1.35,\r\n      FireEssence: 1.35,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.ResearchersUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const buildResearcherDesk = new BuildResearcherDesk();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ResearcherAmount]],\r\n  \"researcherDesks\",\r\n  t(\"Researcher Desks\"),\r\n  TransformationType.Addition,\r\n  (state, params) => getBuildingAmount(state, researcherDesk),\r\n);\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource, clearResourceCapCache } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport { registerSpell } from \"../../spells/Spells\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport {\r\n  BuildingAmountListeners,\r\n  Buildings,\r\n  getBuildingAmount,\r\n} from \"../Buildings\";\r\n\r\nclass Monstruarium extends Building {\r\n  getId(): string {\r\n    return \"monstruarium\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Monstruarium\");\r\n  }\r\n\r\n  perBuildingCapTags = [\r\n    TransformationTags.PerBuildingCap,\r\n    Resource.Monstium,\r\n    this.getId(),\r\n  ];\r\n\r\n  getPerStorageBonusCap(state: GameState): number {\r\n    return applyTransformations(this.perBuildingCapTags, state, 3000, {\r\n      resource: Resource.Monstium,\r\n    });\r\n  }\r\n\r\n  explanationParams = memoize(() => ({\r\n    resource: Resource.Monstium,\r\n    unit: t(\" Max:monstium:\"),\r\n  }));\r\n\r\n  getPerStorageBonusCapExplanation(state: GameState): string {\r\n    return explainTransformationsText(\r\n      this.perBuildingCapTags,\r\n      state,\r\n      3000,\r\n      this.explanationParams(),\r\n    );\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"A special kind of storage, built specifically for :monstium:.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"^+{{amount}}^<{{explanation}}> Max:monstium:\", {\r\n      amount: formatNumber(this.getPerStorageBonusCap(state)),\r\n      explanation: this.getPerStorageBonusCapExplanation(state),\r\n    });\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 3;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const monstruarium = new Monstruarium();\r\n\r\nclass BuildMonstruarium extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.STORAGE] };\r\n  }\r\n\r\n  getBuilding(): Monstruarium {\r\n    return monstruarium;\r\n  }\r\n\r\n  shouldNeverHaveDemolishBlockers(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return { PoisonEssence: 6000, WaterEssence: 4000, EarthEssence: 4000 };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      PoisonEssence: 1.4,\r\n      WaterEssence: 1.4,\r\n      EarthEssence: 1.4,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.MonstruariumsUnlocked);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const buildMonstruarium = new BuildMonstruarium();\r\n\r\nexport function loadMonstruarium() {\r\n  Buildings.register(monstruarium);\r\n  registerSpell(buildMonstruarium);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Cap, Resource.Monstium]],\r\n    \"monstruariumMonstium\",\r\n    t(\"Monstruarium\"),\r\n    TransformationType.Addition,\r\n    (state, params) => {\r\n      return (\r\n        getBuildingAmount(state, monstruarium) *\r\n        monstruarium.getPerStorageBonusCap(state)\r\n      );\r\n    },\r\n  );\r\n\r\n  BuildingAmountListeners.register((state, building) => {\r\n    if (building == monstruarium) {\r\n      state = clearResourceCapCache(state);\r\n    }\r\n    return state;\r\n  }, monstruarium.getId());\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { Enhancement } from \"../Enhancement\";\r\n\r\nclass TreasureChests extends Enhancement {\r\n  getId(): string {\r\n    return \"treasureChests\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Safes\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_STORAGE;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 400,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 1,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Discover a new type of furniture, that allows safeguarding of a large amount of :coins:.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t('Unlock furniture \"Safe\"');\r\n  }\r\n}\r\n\r\nconst treasureChests = new TreasureChests();\r\n\r\nexport { treasureChests };\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource, clearResourceCapCache } from \"../../Resources\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { treasureChests } from \"../../enhancement/other/TreasureChests\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport { registerSpell } from \"../../spells/Spells\";\r\nimport {\r\n  TransformationType,\r\n  applyTransformations,\r\n  explainTransformationsText,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"../Building\";\r\nimport {\r\n  BuildingAmountListeners,\r\n  Buildings,\r\n  getBuildingAmount,\r\n} from \"../Buildings\";\r\n\r\nclass TreasureChest extends Building {\r\n  getId(): string {\r\n    return \"treasureChest\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Safe\");\r\n  }\r\n\r\n  perBuildingCapTags = [\r\n    TransformationTags.PerBuildingCap,\r\n    Resource.Coins,\r\n    this.getId(),\r\n  ];\r\n\r\n  getPerStorageBonusCap(state: GameState): number {\r\n    return applyTransformations(this.perBuildingCapTags, state, 70000, {\r\n      resource: Resource.Coins,\r\n    });\r\n  }\r\n\r\n  perBuildingCapParams = memoize(() => ({\r\n    resource: Resource.Coins,\r\n    unit: t(\" Max:coins:\"),\r\n  }));\r\n\r\n  getPerStorageBonusCapExplanation(state: GameState): string {\r\n    return explainTransformationsText(\r\n      this.perBuildingCapTags,\r\n      state,\r\n      70000,\r\n      this.perBuildingCapParams(),\r\n    );\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"A large safe. Allows you to store large amounts of :coins:.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"^+{{amount}}^<{{explanation}}> Max:coins:\", {\r\n      amount: formatNumber(this.getPerStorageBonusCap(state)),\r\n      explanation: this.getPerStorageBonusCapExplanation(state),\r\n    });\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 4;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst treasureChest = new TreasureChest();\r\n\r\nclass BuildTreasureChest extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.STORAGE] };\r\n  }\r\n\r\n  getBuilding(): TreasureChest {\r\n    return treasureChest;\r\n  }\r\n\r\n  shouldNeverHaveDemolishBlockers(): boolean {\r\n    return false;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return { EarthEssence: 4000, FireEssence: 2000 };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      EarthEssence: 1.4,\r\n      FireEssence: 1.4,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return treasureChests.isPurchased(state) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst buildTreasureChest = new BuildTreasureChest();\r\n\r\nexport function loadTreasureChest() {\r\n  Buildings.register(treasureChest);\r\n  registerSpell(buildTreasureChest);\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Cap, Resource.Coins]],\r\n    \"treasureChestCoins\",\r\n    t(\"Safe\"),\r\n    TransformationType.Addition,\r\n    (state, params) => {\r\n      return (\r\n        getBuildingAmount(state, treasureChest) *\r\n        treasureChest.getPerStorageBonusCap(state)\r\n      );\r\n    },\r\n  );\r\n\r\n  BuildingAmountListeners.register((state, building) => {\r\n    if (building == treasureChest) {\r\n      state = clearResourceCapCache(state);\r\n    }\r\n    return state;\r\n  }, treasureChest.getId());\r\n}\r\n\r\nexport {\r\n  buildTreasureChest as BuildTreasureChest,\r\n  treasureChest as TreasureChest,\r\n};\r\n","import { t } from \"../../utils/I18n\";\r\nimport {\r\n  ActionArea,\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../action/ActionAreas\";\r\nimport { isAutocastUnlocked } from \"../autocast/Autocast\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport { SpellElement } from \"../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationTags } from \"../transformation/TransformationTags\";\r\nimport { Building, BuildingSpell } from \"./Building\";\r\nimport { getBuildingAmount } from \"./Buildings\";\r\n\r\nclass WizardChamber extends Building {\r\n  getId(): string {\r\n    return \"wizardChamber\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Wizard Chamber\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A specially prepared area of your home that serves as a workstation for a hired Wizard.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+1 Wizard\");\r\n  }\r\n\r\n  getBaseLandRequired(): number {\r\n    return 3;\r\n  }\r\n\r\n  canTurnOff(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst wizardChamber = new WizardChamber();\r\n\r\nclass BuildWizardChamber extends BuildingSpell {\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return { HOME: [ActionSubcategories.OTHER] };\r\n  }\r\n\r\n  getBuilding(): Building {\r\n    return wizardChamber;\r\n  }\r\n\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 200,\r\n      AirEssence: 120,\r\n      FireEssence: 100,\r\n    };\r\n  }\r\n\r\n  getBaseResourceScale(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Coins: 1.25,\r\n      AirEssence: 1.25,\r\n      FireEssence: 1.25,\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return isAutocastUnlocked(state) && super.isVisible(state);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {};\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nconst buildWizardChamber = new BuildWizardChamber();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.WizardAmount]],\r\n  \"wizardChambers\",\r\n  t(\"Wizard Chambers\"),\r\n  TransformationType.Addition,\r\n  (state, params) => getBuildingAmount(state, wizardChamber),\r\n);\r\n\r\nexport {\r\n  buildWizardChamber as BuildWizardChamber,\r\n  wizardChamber as WizardChamber,\r\n};\r\n","import { registerSpell } from \"../spells/Spells\";\r\nimport { Buildings } from \"./Buildings\";\r\nimport { loadEssenceCatalysts } from \"./catalysts/EssenceCatalyst\";\r\nimport { loadMonstiumCatalysts } from \"./catalysts/MonstiumCatalyst\";\r\nimport { BuildManaSpout, ManaSpout } from \"./mana/ManaSpout\";\r\nimport { buildManaSteamer, manaSteamer } from \"./mana/ManaSteamer\";\r\nimport { loadSewageSystem } from \"./production/SewageSystem\";\r\nimport { buildResearcherDesk, researcherDesk } from \"./ResearcherDesk\";\r\nimport { BuildSaleStall, SaleStall } from \"./SaleStall\";\r\nimport { loadEssenceStorages } from \"./storages/EssenceStorage\";\r\nimport { BuildManaShard, ManaShard } from \"./storages/ManaShard\";\r\nimport { loadMonstruarium } from \"./storages/Monstruarium\";\r\nimport { loadTreasureChest } from \"./storages/TreasureChest\";\r\nimport { BuildWizardChamber, WizardChamber } from \"./WizardChamber\";\r\n\r\nexport function loadBuildingsDemo() {\r\n  Buildings.register(ManaSpout);\r\n  registerSpell(BuildManaSpout);\r\n  Buildings.register(ManaShard);\r\n  registerSpell(BuildManaShard);\r\n\r\n  loadEssenceStorages();\r\n  loadEssenceCatalysts();\r\n\r\n  Buildings.register(WizardChamber);\r\n  registerSpell(BuildWizardChamber);\r\n  Buildings.register(SaleStall);\r\n  registerSpell(BuildSaleStall);\r\n  Buildings.register(researcherDesk);\r\n  registerSpell(buildResearcherDesk);\r\n\r\n  loadTreasureChest();\r\n  Buildings.register(manaSteamer);\r\n  registerSpell(buildManaSteamer);\r\n\r\n  loadMonstruarium();\r\n  loadSewageSystem();\r\n  loadMonstiumCatalysts();\r\n}\r\n","import { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { AttackTarget } from \"../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../exploration/CombatStats\";\r\nimport { GameState } from \"../GameState\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport { TransformationValueType } from \"../transformation/TransformationTags\";\r\nimport { CombatClass } from \"./CombatClasses\";\r\n\r\nclass Battlemage extends CombatClass {\r\n  getId(): string {\r\n    return \"battlemage\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Battlemage\");\r\n  }\r\n  protected getBaseClassEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      attackAndDefense: {\r\n        value: 0.1,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Particularly strong physically, a Battlemage has undergone special training to make their body adept at combat, much like a knight - but while still being able to use potent magic.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getClassEffects(state);\r\n    const explanations = this.getClassEffectExplanations(state);\r\n    return t(\r\n      \"^{{attackMultiplier}}^<{{attackExplanation}}>:attack:, ^{{attackMultiplier}}^<{{attackExplanation}}>:defense:\",\r\n      {\r\n        attackMultiplier: formatMultiplier(1.0 + effects.attackAndDefense),\r\n        attackExplanation: explanations.attackAndDefense,\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const battlemage = new Battlemage();\r\n\r\nregisterTransformation(\r\n  [\r\n    [AttackTarget.Player, CombatStat.Attack],\r\n    [AttackTarget.Player, CombatStat.Defense],\r\n  ],\r\n  battlemage.getId(),\r\n  battlemage.getDisplayName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    battlemage.isActive(state)\r\n      ? 1.0 + battlemage.getClassEffects(state).attackAndDefense\r\n      : 1.0,\r\n);\r\n","import { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Storylines } from \"../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../transformation/TransformationTags\";\r\nimport { CombatClass } from \"./CombatClasses\";\r\n\r\nclass Builder extends CombatClass {\r\n  getId(): string {\r\n    return \"builder\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Builder\");\r\n  }\r\n  protected getBaseClassEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      land: {\r\n        value: 0.12,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      buildingCost: {\r\n        value: 1.5,\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A wizard that recognizes furniture is the cornerstone to success, and is able to maximize space in their home - to have even more furniture.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getClassEffects(state);\r\n    const explanations = this.getClassEffectExplanations(state);\r\n    if (Storylines.getByIdNullable(\"blessedLand\")?.isBonusActive?.(state)) {\r\n      return t(\r\n        \"^{{buildingCostMultiplier}}^<{{buildingCostExplanation}}> cost of all furniture\",\r\n        {\r\n          buildingCostMultiplier: formatMultiplier(\r\n            1.0 / (1.0 + effects.buildingCost),\r\n          ),\r\n          buildingCostExplanation: explanations.buildingCost,\r\n        },\r\n      );\r\n    }\r\n    return t(\"^{{landMultiplier}}^<{{landExplanation}}>:land:\", {\r\n      landMultiplier: formatMultiplier(1.0 + effects.land),\r\n      landExplanation: explanations.land,\r\n    });\r\n  }\r\n}\r\n\r\nexport const builder = new Builder();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Land, TransformationTags.Cap]],\r\n  builder.getId(),\r\n  builder.getDisplayName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    builder.isActive(state) ? 1.0 + builder.getClassEffects(state).land : 1.0,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Cost, TransformationTags.Building]],\r\n  builder.getId() + \"buildingCost\",\r\n  builder.getDisplayName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    builder.isActive(state) &&\r\n    Storylines.getByIdNullable(\"blessedLand\")?.isBonusActive?.(state)\r\n      ? 1.0 / (1.0 + builder.getClassEffects(state).buildingCost)\r\n      : 1.0,\r\n);\r\n","import { formatMultiplier } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { GameState } from \"../GameState\";\r\nimport { Resource } from \"../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../transformation/TransformationTags\";\r\nimport { CombatClass } from \"./CombatClasses\";\r\n\r\nclass Spellslinger extends CombatClass {\r\n  getId(): string {\r\n    return \"spellslinger\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Spellslinger\");\r\n  }\r\n  protected getBaseClassEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      mana: {\r\n        value: 0.3,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A wizard that simply loves to cast spells. Spells require Mana - a Spellslinger has mastered the ability to produce it.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getClassEffects(state);\r\n    const explanations = this.getClassEffectExplanations(state);\r\n    return t(\"^{{mana}}^<{{manaExplanation}}> :mana: production\", {\r\n      mana: formatMultiplier(1.0 + effects.mana),\r\n      manaExplanation: explanations.mana,\r\n    });\r\n  }\r\n}\r\n\r\nexport const spellslinger = new Spellslinger();\r\n\r\nregisterTransformation(\r\n  [[Resource.Mana, TransformationTags.Production]],\r\n  spellslinger.getId(),\r\n  spellslinger.getDisplayName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    spellslinger.isActive(state)\r\n      ? 1.0 + spellslinger.getClassEffects(state).mana\r\n      : 1.0,\r\n);\r\n","import { battlemage } from \"./Battlemage\";\r\nimport { builder } from \"./Builder\";\r\nimport { CombatClasses } from \"./CombatClasses\";\r\nimport { loadCombatClassesUnlocker } from \"./CombatClassesUnlocker\";\r\nimport { spellslinger } from \"./Spellslinger\";\r\n\r\nexport function loadCombatClassesDemo() {\r\n  CombatClasses.register(battlemage);\r\n  CombatClasses.register(spellslinger);\r\n  CombatClasses.register(builder);\r\n\r\n  loadCombatClassesUnlocker();\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { buildEvent } from \"../events/EventMessageBuilder\";\r\nimport { triggerEvent } from \"../events/Events\";\r\nimport { EventTag } from \"../events/GameEvent\";\r\nimport { Flag } from \"../Flag\";\r\nimport { SetFlagListeners } from \"../Flags\";\r\nimport { Storylines } from \"../storylines/Storylines\";\r\nimport { CombatClassesStoryline } from \"./CombatClassesStoryline\";\r\n\r\nexport function loadCombatClassesUnlocker() {\r\n  Storylines.register(CombatClassesStoryline);\r\n  const combatClassesUnlockEventBuilder = buildEvent(\r\n    \"typesOfWizards\",\r\n    t(\"(Storyline) Types of Wizards\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(CombatClassesStoryline.getId());\r\n\r\n  combatClassesUnlockEventBuilder\r\n    .message(\r\n      t(`You exit the Tower of Training, eager to get back home to apply what you have just learned, but you are stopped in your tracks as soon as you step out of the door. \"I'm sorry - there is one last thing.\" The familiar voice of the Head Instructor Giselle comes from behind. In her hand is a book. The title: *\"Classes\"*\r\n    \r\n\"This was always meant to be the reward for finishing the training. It is a book on various wizard specializations. It almost slipped my mind, because I got carried away with the explanation about Enhancements.\"`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = CombatClassesStoryline.complete(state);\r\n          state = CombatClassesStoryline.activateBonus(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    );\r\n  combatClassesUnlockEventBuilder\r\n    .message(\r\n      t(`You accept the book, and you quickly skim through it. There are a few pictures: a Wizard wielding a large sword and a shield, another shooting a Fireball, yet another one building home furniture. And big, long pages of explanation for each of them, it appears.\r\n      \r\nYou are not sure if you will have time to actually look at this or learn much out of it. But you think of keeping the book in your library anyhow...\r\n\r\n**You have completed the \"Types of Wizards\" Storyline and permanently unlocked the ability to select a Class after retiring! Your choice of Class at the beginning of the game gives you a powerful bonus for the duration of that retirement; you can choose a new Class by retiring again.**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const combatClassesUnlockEvent = combatClassesUnlockEventBuilder.build();\r\n\r\n  SetFlagListeners.register((state, flag) => {\r\n    if (\r\n      flag == Flag.EnhancementsUnlocked &&\r\n      !combatClassesUnlockEvent.hasTriggered(state) &&\r\n      !CombatClassesStoryline.isCompleted(state)\r\n    ) {\r\n      state = triggerEvent(combatClassesUnlockEvent)(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\n\r\nclass EfficientExploration extends Enhancement {\r\n  getId(): string {\r\n    return \"efficientExploration\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Efficient Exploration\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 200,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 1,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Refine your scanning techniques in order to explore faster.\");\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"-25% Exploration delay\");\r\n  }\r\n}\r\n\r\nexport const efficientExploration = new EfficientExploration();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  efficientExploration.getId(),\r\n  efficientExploration.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (efficientExploration.isPurchased(state) ? 0.75 : 1.0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { efficientExploration } from \"./EfficientExploration\";\r\n\r\nclass Compass extends Enhancement {\r\n  getId(): string {\r\n    return \"compass\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Compass\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 4500,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 5,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [efficientExploration];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"A compass while exploring means you will find your way much quicker and get lost much less.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"-30% Exploration delay\");\r\n  }\r\n}\r\n\r\nexport const compass = new Compass();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  compass.getId(),\r\n  compass.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (compass.isPurchased(state) ? 0.7 : 1.0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../exploration/CombatStats\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\n\r\nclass HealthBoost extends Enhancement {\r\n  getId(): string {\r\n    return \"healthBoost\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Health Boost\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 250,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 2,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Enhance your body, so you can resist more blows.\");\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+20 Max:hp:\");\r\n  }\r\n}\r\n\r\nexport const healthBoost = new HealthBoost();\r\n\r\nregisterTransformation(\r\n  [[CombatStat.MaxHP, AttackTarget.Player]],\r\n  healthBoost.getId(),\r\n  healthBoost.getBaseName(),\r\n  TransformationType.Addition,\r\n  (state) => (healthBoost.isPurchased(state) ? 20 : 0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == healthBoost) {\r\n    state = clearCombatStatCache(state, AttackTarget.Player);\r\n  }\r\n  return state;\r\n}, healthBoost.getId());\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../exploration/CombatStats\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { healthBoost } from \"./HealthBoost\";\r\n\r\nclass DoubleHealthBoost extends Enhancement {\r\n  getId(): string {\r\n    return \"doubleHealthBoost\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Double Health Boost\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 2500,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 8,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [healthBoost];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Enhance your body a second time, so you can resist even more blows.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+40 Max:hp:\");\r\n  }\r\n}\r\n\r\nexport const doubleHealthBoost = new DoubleHealthBoost();\r\n\r\nregisterTransformation(\r\n  [[CombatStat.MaxHP, AttackTarget.Player]],\r\n  doubleHealthBoost.getId(),\r\n  doubleHealthBoost.getBaseName(),\r\n  TransformationType.Addition,\r\n  (state) => (doubleHealthBoost.isPurchased(state) ? 40 : 0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == doubleHealthBoost) {\r\n    state = clearCombatStatCache(state, AttackTarget.Player);\r\n  }\r\n  return state;\r\n}, doubleHealthBoost.getId());\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { healthBoost } from \"./HealthBoost\";\r\n\r\nclass EnlargedPouch extends Enhancement {\r\n  getId(): string {\r\n    return \"enlargedPouch\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Enlarged Pouch\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 600,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 6,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [healthBoost];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Upgrade the size of your pouch, so you can use more items in battle.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+1 Pouch size\");\r\n  }\r\n}\r\n\r\nexport const enlargedPouch = new EnlargedPouch();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.PouchSize]],\r\n  enlargedPouch.getId(),\r\n  enlargedPouch.getBaseName(),\r\n  TransformationType.Addition,\r\n  (state) => (enlargedPouch.isPurchased(state) ? 1 : 0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../exploration/CombatStats\";\r\nimport { ExplorationStatus } from \"../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../exploration/ExplorationUtils\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { healthBoost } from \"./HealthBoost\";\r\n\r\nclass FirstAid extends Enhancement {\r\n  getId(): string {\r\n    return \"firstAid\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"First Aid\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 450,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 5,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [healthBoost];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Develop first aid techniques which allow you to heal wounds much faster when not fighting.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+50% :hp: recovery speed when outside of battle\");\r\n  }\r\n}\r\n\r\nexport const firstAid = new FirstAid();\r\n\r\nregisterTransformation(\r\n  [[CombatStat.HPRegen, AttackTarget.Player]],\r\n  firstAid.getId(),\r\n  firstAid.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    firstAid.isPurchased(state) &&\r\n    getExplorationStatus(state) != ExplorationStatus.Combat\r\n      ? 1.5\r\n      : 1.0,\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == firstAid) {\r\n    state = clearCombatStatCache(state, AttackTarget.Player);\r\n  }\r\n  return state;\r\n}, firstAid.getId());\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { enlargedPouch } from \"./EnlargedPouch\";\r\n\r\nclass ProfessionalPouch extends Enhancement {\r\n  getId(): string {\r\n    return \"professionalPouch\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Professional Pouch\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 3000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 12,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [enlargedPouch];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Fancy yourself a professional wizard? You heard they needed a pouch to match...\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+1 Pouch size\");\r\n  }\r\n}\r\n\r\nexport const professionalPouch = new ProfessionalPouch();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.PouchSize]],\r\n  professionalPouch.getId(),\r\n  professionalPouch.getBaseName(),\r\n  TransformationType.Addition,\r\n  (state) => (professionalPouch.isPurchased(state) ? 1 : 0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { professionalPouch } from \"./ProfessionalPouch\";\r\n\r\nclass GiantPouch extends Enhancement {\r\n  getId(): string {\r\n    return \"giantPouch\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Giant Pouch\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 25000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 30,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [professionalPouch];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Enhance your pouch even further, to hold yet another extra item.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+1 Pouch size\");\r\n  }\r\n}\r\n\r\nexport const giantPouch = new GiantPouch();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.PouchSize]],\r\n  giantPouch.getId(),\r\n  giantPouch.getBaseName(),\r\n  TransformationType.Addition,\r\n  (state) => (giantPouch.isPurchased(state) ? 1 : 0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { HealthPotion } from \"../../items/equipment/pouch/HealthPotion\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { healthBoost } from \"./HealthBoost\";\r\n\r\nclass HealthPotionEffectivity extends Enhancement {\r\n  getId(): string {\r\n    return \"healthPotionEffectivity\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Health Potion Effectivity\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 2000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 10,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [healthBoost];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Enhance how you gain effects from Health Potions, to increase their effectivity.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"Health Potions can be used 1 extra time per combat\");\r\n  }\r\n}\r\n\r\nexport const healthPotionEffectivity = new HealthPotionEffectivity();\r\n\r\nregisterTransformation(\r\n  [[HealthPotion.getId(), TransformationTags.PouchItemUses]],\r\n  healthPotionEffectivity.getId(),\r\n  healthPotionEffectivity.getBaseName(),\r\n  TransformationType.Addition,\r\n  (state) => (healthPotionEffectivity.isPurchased(state) ? 1 : 0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../exploration/CombatStats\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { doubleHealthBoost } from \"./DoubleHealthBoost\";\r\n\r\nclass TripleHealthBoost extends Enhancement {\r\n  getId(): string {\r\n    return \"tripleHealthBoost\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Triple Health Boost\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_EXPLORATION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 21000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 18,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [doubleHealthBoost];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Enhance your body a third time. Your survivability has come a long way.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+70 Max:hp:\");\r\n  }\r\n}\r\n\r\nexport const tripleHealthBoost = new TripleHealthBoost();\r\n\r\nregisterTransformation(\r\n  [[CombatStat.MaxHP, AttackTarget.Player]],\r\n  tripleHealthBoost.getId(),\r\n  tripleHealthBoost.getBaseName(),\r\n  TransformationType.Addition,\r\n  (state) => (tripleHealthBoost.isPurchased(state) ? 70 : 0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == tripleHealthBoost) {\r\n    state = clearCombatStatCache(state, AttackTarget.Player);\r\n  }\r\n  return state;\r\n}, tripleHealthBoost.getId());\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { clearLandCache, getTotalLand } from \"../../buildings/Buildings\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { clearResourceCapCache, Resource } from \"../../Resources\";\r\nimport { Storylines } from \"../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\n\r\nclass FurnitureOrganization extends Enhancement {\r\n  getId(): string {\r\n    return \"furnitureOrganization\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Furniture Organization\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_LAND;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 500,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 3,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Sort furniture in a neater way at your home to improve the amount of space available.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+10% (+{{absoluteAmount}}):land:\", {\r\n      absoluteAmount: formatNumber(getTotalLand(state) * 0.1),\r\n    });\r\n  }\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      !Storylines.getByIdNullable(\"blessedLand\")?.isBonusActive?.(state) &&\r\n      super.isVisible(state)\r\n    );\r\n  }\r\n}\r\n\r\nconst furnitureOrganization = new FurnitureOrganization();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.Land, TransformationTags.Cap]],\r\n  furnitureOrganization.getId(),\r\n  furnitureOrganization.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (furnitureOrganization.isPurchased(state) ? 1.1 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == furnitureOrganization) {\r\n    state = clearResourceCapCache(state);\r\n    state = clearLandCache(state);\r\n  }\r\n  return state;\r\n}, furnitureOrganization.getId());\r\n\r\nexport { furnitureOrganization };\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport expandHome from \"../../action/actions/ExpandHome\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { Storylines } from \"../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\n\r\nclass LandTreaty extends Enhancement {\r\n  getId(): string {\r\n    return \"landTreaty\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Land Treaty\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_LAND;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 900,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 7,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Make a deal with the town to be able to purchase land for cheaper.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"Reduces the cost to expand your home\");\r\n  }\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      !Storylines.getByIdNullable(\"blessedLand\")?.isBonusActive?.(state) &&\r\n      super.isVisible(state)\r\n    );\r\n  }\r\n}\r\n\r\nconst landTreaty = new LandTreaty();\r\n\r\nregisterTransformation(\r\n  [[expandHome.getId(), TransformationTags.CostScale]],\r\n  landTreaty.getId(),\r\n  landTreaty.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (landTreaty.isPurchased(state) ? 0.7 : 1.0),\r\n);\r\n\r\nexport { landTreaty };\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport expandHome from \"../../action/actions/ExpandHome\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { Storylines } from \"../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { landTreaty } from \"./LandTreaty\";\r\n\r\nclass HouseExpansionContract extends Enhancement {\r\n  getId(): string {\r\n    return \"houseExpansionContract\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"House Expansion Contract\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_LAND;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 4000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 15,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [landTreaty];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Negotiate a detailed contract to reduce barriers when enlargening your residence.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"Further reduces the cost to expand your home\");\r\n  }\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      !Storylines.getByIdNullable(\"blessedLand\")?.isBonusActive?.(state) &&\r\n      super.isVisible(state)\r\n    );\r\n  }\r\n}\r\n\r\nexport const houseExpansionContract = new HouseExpansionContract();\r\n\r\nregisterTransformation(\r\n  [[expandHome.getId(), TransformationTags.CostScale]],\r\n  houseExpansionContract.getId(),\r\n  houseExpansionContract.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (houseExpansionContract.isPurchased(state) ? 0.75 : 1.0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { clearResearcherExpCache } from \"../../study/Study\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\n\r\nclass UnderstandingOfMagic extends Enhancement {\r\n  getId(): string {\r\n    return \"understandingOfMagic\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Understanding of Magic\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_OTHER;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 200,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 4,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Study how magic works in order to better be able to understand how to use it.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+50% Element exp earned from Studying\");\r\n  }\r\n}\r\n\r\nconst understandingOfMagic = new UnderstandingOfMagic();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExpGain, TransformationTags.Study]],\r\n  understandingOfMagic.getId(),\r\n  understandingOfMagic.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (understandingOfMagic.isPurchased(state) ? 1.5 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == understandingOfMagic) {\r\n    state = clearResearcherExpCache(state);\r\n  }\r\n  return state;\r\n}, understandingOfMagic.getId());\r\n\r\nexport { understandingOfMagic };\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { clearResearcherExpCache } from \"../../study/Study\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { understandingOfMagic } from \"./UnderstandingOfMagic\";\r\n\r\nclass DeeperUnderstandingOfMagic extends Enhancement {\r\n  getId(): string {\r\n    return \"deeperUnderstandingOfMagic\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Deeper Understanding of Magic\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_OTHER;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 3000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 8,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [understandingOfMagic];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Study how magic works even deeper, to be able to discover new applications more efficiently.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+50% Element exp earned from Studying\");\r\n  }\r\n}\r\n\r\nexport const deeperUnderstandingOfMagic = new DeeperUnderstandingOfMagic();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExpGain, TransformationTags.Study]],\r\n  deeperUnderstandingOfMagic.getId(),\r\n  deeperUnderstandingOfMagic.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (deeperUnderstandingOfMagic.isPurchased(state) ? 1.5 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == deeperUnderstandingOfMagic) {\r\n    state = clearResearcherExpCache(state);\r\n  }\r\n  return state;\r\n}, deeperUnderstandingOfMagic.getId());\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\n\r\nclass GlitteringStalls extends Enhancement {\r\n  getId(): string {\r\n    return \"glitteringStalls\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Glittering Stalls\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_OTHER;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 300,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 2,\r\n    };\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Enhance your Market Stalls so that the goods sold appear to be of higher quality than usual.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"+100%:coins: obtained from items sold from Market Stalls\");\r\n  }\r\n}\r\n\r\nexport const glitteringStalls = new GlitteringStalls();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.SaleStallRevenue]],\r\n  glitteringStalls.getId(),\r\n  glitteringStalls.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (glitteringStalls.isPurchased(state) ? 2.0 : 1.0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { buildResearcherDesk } from \"../../buildings/ResearcherDesk\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { understandingOfMagic } from \"./UnderstandingOfMagic\";\r\n\r\nclass HiringSpree extends Enhancement {\r\n  getId(): string {\r\n    return \"hiringSpree\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Hiring Spree\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_OTHER;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 1500,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 12,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [understandingOfMagic];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Publish information about how you are recruiting researchers to the town board. You are hiring!\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"Reduces the cost needed to build Researcher Desks\");\r\n  }\r\n}\r\n\r\nexport const hiringSpree = new HiringSpree();\r\n\r\nregisterTransformation(\r\n  [[buildResearcherDesk.getId(), TransformationTags.CostScale]],\r\n  hiringSpree.getId(),\r\n  hiringSpree.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (hiringSpree.isPurchased(state) ? 0.75 : 1.0),\r\n);\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { BuildWizardChamber } from \"../../buildings/WizardChamber\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\n\r\nclass ScalableChambers extends Enhancement {\r\n  getId(): string {\r\n    return \"scalableChambers\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Scalable Chambers\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_OTHER;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 400,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 5,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Tweak the way you build Wizard Chambers, to make them more affordable.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"Reduces the cost to build Wizard Chambers\");\r\n  }\r\n}\r\n\r\nexport const scalableChambers = new ScalableChambers();\r\n\r\nregisterTransformation(\r\n  [[BuildWizardChamber.getId(), TransformationTags.CostScale]],\r\n  scalableChambers.getId(),\r\n  scalableChambers.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (scalableChambers.isPurchased(state) ? 0.7 : 1.0),\r\n);\r\n","import { valuesOf } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { SpellElement } from \"../../spells/Elements\";\r\nimport {\r\n  clearAutocastPointsCache,\r\n  clearManaCostCache,\r\n} from \"../../spells/Spells\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\n\r\nclass ShardDiligence extends Enhancement {\r\n  getId(): string {\r\n    return \"shardDiligence\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Shard Diligence\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_OTHER;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 400,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 4,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Make your hired wizards (and yourself) more diligent and effective when transmuting elemental Shards.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"Elemental Shard Transmutation spells require -75%:mana: and -90%:wizardpower:\",\r\n    );\r\n  }\r\n}\r\n\r\nexport const shardDiligence = new ShardDiligence();\r\n\r\nregisterTransformation(\r\n  [\r\n    ...valuesOf(SpellElement).map((element) => [\r\n      TransformationTags.ItemCost,\r\n      Resource.Mana,\r\n      \"transmute-elementalShard\" + element,\r\n    ]),\r\n  ],\r\n  shardDiligence.getId(),\r\n  shardDiligence.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (shardDiligence.isPurchased(state) ? 0.25 : 1.0),\r\n);\r\nregisterTransformation(\r\n  [\r\n    ...valuesOf(SpellElement).map((element) => [\r\n      TransformationTags.AutocastPointsConsumption,\r\n      \"transmute-elementalShard\" + element,\r\n    ]),\r\n  ],\r\n  shardDiligence.getId() + \"autocast\",\r\n  shardDiligence.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (shardDiligence.isPurchased(state) ? 0.1 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == shardDiligence) {\r\n    state = clearAutocastPointsCache(state);\r\n    state = clearManaCostCache(state);\r\n  }\r\n  return state;\r\n}, shardDiligence.getId());\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { sewageSystem } from \"../../buildings/production/SewageSystem\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { clearCalculatedIncomeCache } from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { sewageSystemEnhancement } from \"../other/SewageSystem\";\r\n\r\nclass ImprovedPurification extends Enhancement {\r\n  getId(): string {\r\n    return \"improvedPurification\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Improved Purification\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_PRODUCTION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 15000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 20,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [sewageSystemEnhancement];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Rearrange the Sewage System workings, so that they can produce much more Essence, although at a much lower effectivity.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"2.5x essence production; 5x :poisonessence: consumption of Sewage System\",\r\n    );\r\n  }\r\n}\r\n\r\nconst improvedPurification = new ImprovedPurification();\r\n\r\nregisterTransformation(\r\n  [[sewageSystem.getId(), TransformationTags.Production]],\r\n  improvedPurification.getId(),\r\n  improvedPurification.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (improvedPurification.isPurchased(state) ? 2.5 : 1.0),\r\n);\r\n\r\nregisterTransformation(\r\n  [[sewageSystem.getId(), TransformationTags.Consumption]],\r\n  improvedPurification.getId() + \"consumption\",\r\n  improvedPurification.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (improvedPurification.isPurchased(state) ? 5.0 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == improvedPurification) {\r\n    state = clearCalculatedIncomeCache(state);\r\n  }\r\n  return state;\r\n});\r\n\r\nexport { improvedPurification };\r\n","import { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { manaSteamer } from \"../../buildings/mana/ManaSteamer\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { clearCalculatedIncomeCache } from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { manaSteamers } from \"../other/ManaSteamers\";\r\n\r\nclass SuperheatedSteamers extends Enhancement {\r\n  getId(): string {\r\n    return \"superheatedSteamers\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Superheated Steamers\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_PRODUCTION;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 20000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 30,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [manaSteamers];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Enhance your Mana Steamers so they produce and consume much faster than before.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"+50% :mana: production; 4x :fireessence: and :wateressence: consumption of Mana Steamers\",\r\n    );\r\n  }\r\n}\r\n\r\nconst superheatedSteamers = new SuperheatedSteamers();\r\n\r\nregisterTransformation(\r\n  [[manaSteamer.getId(), TransformationTags.Production]],\r\n  superheatedSteamers.getId(),\r\n  superheatedSteamers.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (superheatedSteamers.isPurchased(state) ? 1.5 : 1.0),\r\n);\r\n\r\nregisterTransformation(\r\n  [[manaSteamer.getId(), TransformationTags.Consumption]],\r\n  superheatedSteamers.getId() + \"consumption\",\r\n  superheatedSteamers.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (superheatedSteamers.isPurchased(state) ? 4.0 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == superheatedSteamers) {\r\n    state = clearCalculatedIncomeCache(state);\r\n  }\r\n  return state;\r\n});\r\n\r\nexport { superheatedSteamers };\r\n","import { valuesOf } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { essenceStorage } from \"../../buildings/storages/EssenceStorage\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { clearResourceCapCache, Resource } from \"../../Resources\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../spells/channeling/ChannelingResources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\n\r\nclass CompressedEssence extends Enhancement {\r\n  getId(): string {\r\n    return \"compressedEssence\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Compressed Essence\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_STORAGE;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 300,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 1,\r\n    };\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Improve the way you store Essence in your Essence Storages so that you can store more with less.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"4x maximum Essence from Essence Storages\");\r\n  }\r\n}\r\n\r\nconst compressedEssence = new CompressedEssence();\r\n\r\nregisterTransformation(\r\n  valuesOf(RESOURCE_FOR_ELEMENT).map((resource) => [\r\n    resource,\r\n    TransformationTags.PerBuildingCap,\r\n    essenceStorage.getId(),\r\n  ]),\r\n  compressedEssence.getId(),\r\n  compressedEssence.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (compressedEssence.isPurchased(state) ? 4.0 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == compressedEssence) {\r\n    state = clearResourceCapCache(state);\r\n  }\r\n  return state;\r\n}, compressedEssence.getId());\r\n\r\nexport { compressedEssence };\r\n","import { valuesOf } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { essenceStorage } from \"../../buildings/storages/EssenceStorage\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { clearResourceCapCache, Resource } from \"../../Resources\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../spells/channeling/ChannelingResources\";\r\nimport { getPrimaryElements } from \"../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { compressedEssence } from \"./CompressedEssence\";\r\n\r\nclass PrimaryStorage extends Enhancement {\r\n  getId(): string {\r\n    return \"primaryStorage\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Primary Storage\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_STORAGE;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 2000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 8,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [compressedEssence];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Use the knowledge about your primary Element to become able to store extra of that Essence in particular.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\r\n      \"2x maximum {{essenceIcon}}{{essenceIconExtra}} from Essence Storages\",\r\n      {\r\n        essenceIcon: `:${RESOURCE_FOR_ELEMENT[\r\n          state.run.primaryElement\r\n        ].toLowerCase()}:`,\r\n        essenceIconExtra:\r\n          state.run.secondaryElement != null\r\n            ? t(\" and {{secondaryEssenceIcon}}\", {\r\n                secondaryEssenceIcon: `:${RESOURCE_FOR_ELEMENT[\r\n                  state.run.secondaryElement\r\n                ].toLowerCase()}:`,\r\n              })\r\n            : \"\",\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const primaryStorage = new PrimaryStorage();\r\n\r\nregisterTransformation(\r\n  valuesOf(RESOURCE_FOR_ELEMENT).map((resource) => [\r\n    resource,\r\n    TransformationTags.PerBuildingCap,\r\n    essenceStorage.getId(),\r\n  ]),\r\n  primaryStorage.getId(),\r\n  primaryStorage.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state, params) =>\r\n    primaryStorage.isPurchased(state) &&\r\n    getPrimaryElements(state)\r\n      .map((element) => RESOURCE_FOR_ELEMENT[element])\r\n      .includes(params.resource)\r\n      ? 2.0\r\n      : 1.0,\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == primaryStorage) {\r\n    state = clearResourceCapCache(state);\r\n  }\r\n  return state;\r\n}, primaryStorage.getId());\r\n","import { valuesOf } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport {\r\n  ActionSubcategories,\r\n  ActionSubcategory,\r\n} from \"../../action/ActionAreas\";\r\nimport { essenceStorage } from \"../../buildings/storages/EssenceStorage\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { clearResourceCapCache, Resource } from \"../../Resources\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../spells/channeling/ChannelingResources\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { Enhancement } from \"../Enhancement\";\r\nimport { EnhancementPurchaseListeners } from \"../EnhancementPurchaseListeners\";\r\nimport { compressedEssence } from \"./CompressedEssence\";\r\n\r\nclass WideStorage extends Enhancement {\r\n  getId(): string {\r\n    return \"wideStorage\";\r\n  }\r\n  getBaseName(): string {\r\n    return t(\"Wide Storage\");\r\n  }\r\n  getSubcategory(): ActionSubcategory {\r\n    return ActionSubcategories.ENHANCE_STORAGE;\r\n  }\r\n  getBaseResourceCost(): Partial<Record<Resource, number>> {\r\n    return {\r\n      Monstium: 6000,\r\n    };\r\n  }\r\n  getItemCost(): Record<string, number> {\r\n    return {\r\n      paper: 6,\r\n    };\r\n  }\r\n  getRequiredEnhancements(): Enhancement[] {\r\n    return [compressedEssence];\r\n  }\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Improve your Essence Storages so that they have even more room to store Essence.\",\r\n    );\r\n  }\r\n  getDisplayEffect(state: GameState): string {\r\n    return t(\"3x maximum Essence from Essence Storages\");\r\n  }\r\n}\r\n\r\nconst wideStorage = new WideStorage();\r\n\r\nregisterTransformation(\r\n  valuesOf(RESOURCE_FOR_ELEMENT).map((resource) => [\r\n    resource,\r\n    TransformationTags.PerBuildingCap,\r\n    essenceStorage.getId(),\r\n  ]),\r\n  wideStorage.getId(),\r\n  wideStorage.getBaseName(),\r\n  TransformationType.Multiplier,\r\n  (state) => (wideStorage.isPurchased(state) ? 3.0 : 1.0),\r\n);\r\n\r\nEnhancementPurchaseListeners.register((state, enhancement) => {\r\n  if (enhancement == wideStorage) {\r\n    state = clearResourceCapCache(state);\r\n  }\r\n  return state;\r\n}, wideStorage.getId());\r\n\r\nexport { wideStorage };\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport {\r\n  getCurrentDungeonFloor,\r\n  modifyPlayerCurrentHP,\r\n} from \"../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../exploration/ExplorationUtils\";\r\nimport { addToInventory } from \"../../items/Inventory\";\r\nimport { ItemStack } from \"../../items/Item\";\r\nimport { Items } from \"../../items/Items\";\r\nimport { registerRandomEventTrigger } from \"../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { EventTag, EventTransform, GameEvent } from \"../GameEvent\";\r\n\r\nexport function createChestEvent(\r\n  eventId: string,\r\n  dungeonFloorIds: string[],\r\n  weight: number,\r\n  contents: ItemStack[],\r\n): GameEvent {\r\n  const newChestEventBuilder = buildEvent(eventId, \"Found a chest\", [\r\n    EventTag.INCONSEQUENTIAL_RANDOM_EVENT,\r\n    EventTag.DO_NOT_AUTO_TRIGGER_IF_ONGOING,\r\n  ]);\r\n\r\n  newChestEventBuilder\r\n    .message(\r\n      t(\r\n        `While exploring, you find a suspicious chest in the middle of your path. What do you do?`,\r\n      ),\r\n    )\r\n    .option(\r\n      t(\"Open the chest\"),\r\n      {\r\n        transform: (state) => {\r\n          for (let itemStack of contents) {\r\n            const item = Items.getById(itemStack.itemOccurrence.itemId);\r\n            state = addToInventory(\r\n              {\r\n                itemId: item.getId(),\r\n                params: item.getDefaultParams(),\r\n              },\r\n              itemStack.amount,\r\n              state,\r\n            );\r\n          }\r\n          return state;\r\n        },\r\n      },\r\n      \"open\",\r\n    )\r\n    .option(t(\"Do not open\"), \"notOpen\")\r\n    .option(t(\"Decide later\"))\r\n    .end();\r\n\r\n  newChestEventBuilder\r\n    .message(\r\n      t(\r\n        `You open the chest. There's something inside! You pick it up and take it.\r\n    \r\n  **You obtained the following item(s): {{items}}!**`,\r\n        {\r\n          items: contents\r\n            .map((itemStack) => {\r\n              const item = Items.getById(itemStack.itemOccurrence.itemId);\r\n              return t(\"{{amount}}{{itemIcon}}{{itemName}}\", {\r\n                amount:\r\n                  itemStack.amount > 1\r\n                    ? t(\"{{amount}} \", {\r\n                        amount: formatNumber(itemStack.amount),\r\n                      })\r\n                    : \"\",\r\n                itemIcon: `:${item.getId()}:`,\r\n                itemName: item.getName(itemStack.itemOccurrence.params),\r\n              });\r\n            })\r\n            .join(t(\", \")),\r\n        },\r\n      ),\r\n    )\r\n    .tag(\"open\")\r\n    .end();\r\n\r\n  newChestEventBuilder\r\n    .message(\r\n      t(\r\n        `You decide not to open the chest. You think it might be a trap. Best to be careful...`,\r\n      ),\r\n    )\r\n    .tag(\"notOpen\")\r\n    .end();\r\n  const newChestEvent = newChestEventBuilder.build();\r\n\r\n  registerRandomEventTrigger(\r\n    newChestEvent,\r\n    weight,\r\n    (state) =>\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      dungeonFloorIds.includes(getCurrentDungeonFloor(state)?.getId()),\r\n  );\r\n\r\n  return newChestEvent;\r\n}\r\n\r\nexport function createBadChestEvent(\r\n  eventId: string,\r\n  weight: number,\r\n  lastMessage: string,\r\n  transform: EventTransform,\r\n  dungeonFloorIds?: string[],\r\n): GameEvent {\r\n  const newChestEventBuilder = buildEvent(eventId, \"Found a chest\", [\r\n    EventTag.INCONSEQUENTIAL_RANDOM_EVENT,\r\n    EventTag.DO_NOT_AUTO_TRIGGER_IF_ONGOING,\r\n  ]);\r\n\r\n  newChestEventBuilder\r\n    .message(\r\n      t(\r\n        `While exploring, you find a suspicious chest in the middle of your path. What do you do?`,\r\n      ),\r\n    )\r\n    .option(\r\n      t(\"Open the chest\"),\r\n      {\r\n        transform: transform,\r\n      },\r\n      \"open\",\r\n    )\r\n    .option(t(\"Do not open\"), \"notOpen\")\r\n    .option(t(\"Decide later\"))\r\n    .end();\r\n\r\n  newChestEventBuilder.message(lastMessage).tag(\"open\").end();\r\n  newChestEventBuilder\r\n    .message(\r\n      t(\r\n        `You decide not to open the chest. You think it might be a trap. Best to be careful...`,\r\n      ),\r\n    )\r\n    .tag(\"notOpen\")\r\n    .end();\r\n\r\n  const newChestEvent = newChestEventBuilder.build();\r\n\r\n  registerRandomEventTrigger(\r\n    newChestEvent,\r\n    weight,\r\n    (state) =>\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      (dungeonFloorIds == null ||\r\n        dungeonFloorIds.includes(getCurrentDungeonFloor(state)?.getId())),\r\n  );\r\n\r\n  return newChestEvent;\r\n}\r\n\r\nexport function loadBadChestEvent() {\r\n  createBadChestEvent(\r\n    \"badChestEvent\",\r\n    15,\r\n    `You open the chest. All of a sudden, you feel *pain* and fall to your knees! When you finally look at yourself, you notice a slight wound - as if something had pierced your leg. The chest must have been a trap! Thankfully the wound doesn't look too serious, but you'll need to wait and recover before you can continue to explore...\r\n      \r\n**You lose all your :hp:!**`,\r\n    (state) => {\r\n      state = modifyPlayerCurrentHP(state, -Infinity, \"Chest\");\r\n      return state;\r\n    },\r\n  );\r\n\r\n  createBadChestEvent(\r\n    \"emptyChestEvent\",\r\n    20,\r\n    `You open the chest. You look inside, but... there's nothing that you can see. You try to feel around to see if you missed anything, but still, there is nothing. What a letdown...`,\r\n    (state) => {\r\n      return state;\r\n    },\r\n  );\r\n}\r\n","import { getRandomElementFromArray } from \"../../../utils/CoreUtils\";\r\nimport { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { getBuildingAmount } from \"../../buildings/Buildings\";\r\nimport { essenceCatalyst } from \"../../buildings/catalysts/EssenceCatalyst\";\r\nimport { monstiumCatalyst } from \"../../buildings/catalysts/MonstiumCatalyst\";\r\nimport { ManaSpout } from \"../../buildings/mana/ManaSpout\";\r\nimport { BuildSaleStall, SaleStall } from \"../../buildings/SaleStall\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport {\r\n  getResourceAmount,\r\n  getResourceCap,\r\n  getResourceInfo,\r\n  grantResource,\r\n  Resource,\r\n} from \"../../Resources\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../spells/channeling/ChannelingResources\";\r\nimport {\r\n  getUnlockedElements,\r\n  grantElementExp,\r\n  translateElement,\r\n} from \"../../spells/Elements\";\r\nimport {\r\n  getResearcherExpPerSecAndResearcher,\r\n  getTotalResearchers,\r\n  isStudyUnlocked,\r\n} from \"../../study/Study\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  clearCalculatedIncomeCache,\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { EventTag } from \"../GameEvent\";\r\nimport { loadBadChestEvent } from \"./Chest\";\r\nimport { registerRandomEventTrigger } from \"./RandomEventTrigger\";\r\n\r\nclass PoolOfManaTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"poolOfMana\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Pool of Mana\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+100%:mana:/sec from Mana Spouts\");\r\n  }\r\n}\r\n\r\nclass EssenceCatalystResonanceTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"essenceCatalystResonance\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Essence Catalyst Resonance\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+25% Essence Catalyst effect\");\r\n  }\r\n}\r\n\r\nclass SaleRushTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"saleRush\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Sale Rush!\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"Market Stalls work twice as fast and sell for +50% more :coins:\");\r\n  }\r\n}\r\n\r\nclass ElementalGatheringTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"elementalGathering\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Elemental Gathering\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    const resource = temporaryEffectData.params.resource;\r\n    const amountPerSec = temporaryEffectData.params.amountPerSec;\r\n    return t(\"+{{amount}}:{{resourceIcon}}:/sec\", {\r\n      amount: formatNumber(amountPerSec),\r\n      resourceIcon: getResourceInfo(resource).icon,\r\n    });\r\n  }\r\n}\r\n\r\nclass MonstiumCatalystResonanceTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"monstiumCatalystResonance\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Monstium Catalyst Resonance\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+25% Monstium Catalyst effect\");\r\n  }\r\n}\r\n\r\nconst poolOfManaTemporaryEffect = new PoolOfManaTemporaryEffect();\r\n\r\nconst essenceCatalystResonanceTemporaryEffect =\r\n  new EssenceCatalystResonanceTemporaryEffect();\r\n\r\nconst saleRushTemporaryEffect = new SaleRushTemporaryEffect();\r\n\r\nconst elementalGatheringTemporaryEffect =\r\n  new ElementalGatheringTemporaryEffect();\r\n\r\nconst monstiumCatalystResonanceTemporaryEffect =\r\n  new MonstiumCatalystResonanceTemporaryEffect();\r\n\r\nexport function loadRandomRepeatableEvents() {\r\n  // Pool of Mana\r\n  TemporaryEffects.register(poolOfManaTemporaryEffect);\r\n  registerTransformation(\r\n    [[TransformationTags.Production, Resource.Mana, ManaSpout.getId()]],\r\n    poolOfManaTemporaryEffect.getId(),\r\n    poolOfManaTemporaryEffect.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(state, poolOfManaTemporaryEffect.getId()) ? 2.0 : 1.0,\r\n  );\r\n  registerTemporaryEffectListener(\r\n    poolOfManaTemporaryEffect.getId(),\r\n    (state, effect) => {\r\n      if (effect.id == poolOfManaTemporaryEffect.getId()) {\r\n        state = clearCalculatedIncomeCache(state);\r\n      }\r\n      return effect;\r\n    },\r\n    true,\r\n  );\r\n  const manaSpoutEventBuilder = buildEvent(\r\n    \"manaSpoutEvent\",\r\n    t(\"Pool of Mana\"),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  ).setOnTrigger(\r\n    grantTemporaryEffect(poolOfManaTemporaryEffect.getId(), 300, {\r\n      target: AttackTarget.Player,\r\n    }),\r\n  );\r\n  manaSpoutEventBuilder.message(\r\n    t(`You hear a sound coming from one of your Mana Spouts. When you investigate, you notice it is overflowing with Mana! It appears you've gotten lucky - they've found a pool of it!\r\n  \r\n**Your Mana Spouts will produce double the :mana: for the next 5 minutes!**`),\r\n  );\r\n  const manaSpoutEvent = manaSpoutEventBuilder.build();\r\n  registerRandomEventTrigger(\r\n    manaSpoutEvent,\r\n    100,\r\n    (state) => getBuildingAmount(state, ManaSpout) > 0,\r\n  );\r\n\r\n  // Essence Catalyst Resonance\r\n  TemporaryEffects.register(essenceCatalystResonanceTemporaryEffect);\r\n  registerTransformation(\r\n    [[TransformationTags.CatalystEffectivity, essenceCatalyst.getId()]],\r\n    essenceCatalystResonanceTemporaryEffect.getId(),\r\n    essenceCatalystResonanceTemporaryEffect.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(state, essenceCatalystResonanceTemporaryEffect.getId())\r\n        ? 1.25\r\n        : 1.0,\r\n  );\r\n  const essenceCatalystEventBuilder = buildEvent(\r\n    \"essenceCatalystEvent\",\r\n    t(\"Essence Catalyst Resonance\"),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  ).setOnTrigger(\r\n    grantTemporaryEffect(essenceCatalystResonanceTemporaryEffect.getId(), 300, {\r\n      target: AttackTarget.Player,\r\n    }),\r\n  );\r\n  essenceCatalystEventBuilder.message(\r\n    t(`Oddly, your Essence Catalysts begin to glow. Something is happening! They appear to be resonating with each other and becoming stronger. You wonder how long this will last...\r\n  \r\n**Your Essence Catalysts will be 25% more effective for the next 5 minutes!**`),\r\n  );\r\n  const essenceCatalystEvent = essenceCatalystEventBuilder.build();\r\n  registerRandomEventTrigger(\r\n    essenceCatalystEvent,\r\n    100,\r\n    (state) => getBuildingAmount(state, essenceCatalyst) > 0,\r\n  );\r\n\r\n  // Sale Rush!\r\n  TemporaryEffects.register(saleRushTemporaryEffect);\r\n  registerTransformation(\r\n    [[TransformationTags.SaleStallRevenue]],\r\n    saleRushTemporaryEffect.getId() + \"1\",\r\n    saleRushTemporaryEffect.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(state, saleRushTemporaryEffect.getId()) ? 1.5 : 1.0,\r\n  );\r\n  registerTransformation(\r\n    [[TransformationTags.TimePerAutoSalePerStall]],\r\n    saleRushTemporaryEffect.getId() + \"2\",\r\n    saleRushTemporaryEffect.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(state, saleRushTemporaryEffect.getId()) ? 0.5 : 1.0,\r\n  );\r\n  const saleRushEventBuilder = buildEvent(\"saleRushEvent\", t(\"Sale Rush!\"), [\r\n    EventTag.INCONSEQUENTIAL_RANDOM_EVENT,\r\n  ]).setOnTrigger(\r\n    grantTemporaryEffect(saleRushTemporaryEffect.getId(), 300, {\r\n      target: AttackTarget.Player,\r\n    }),\r\n  );\r\n  saleRushEventBuilder.message(\r\n    t(`The number of people coming to your home to buy items has suddenly become very high. It's a Sale Rush event! You decide to leverage this and make as much money as you can - while it lasts!\r\n  \r\n**Your Market Stalls will sell items twice as fast and earn 50% more :coins: per sale for the next 5 minutes!**`),\r\n  );\r\n  const saleRushEvent = saleRushEventBuilder.build();\r\n  registerRandomEventTrigger(\r\n    saleRushEvent,\r\n    100,\r\n    (state) => getBuildingAmount(state, SaleStall) > 0,\r\n  );\r\n\r\n  // Elemental Gathering\r\n  TemporaryEffects.register(elementalGatheringTemporaryEffect);\r\n  IncomeOverTimeProducers.register(\r\n    new IncomeOverTimeProducer(\r\n      \"elementalGathering\",\r\n      t(\"Elemental Gathering\"),\r\n      (state) => {\r\n        if (\r\n          !hasTemporaryEffect(state, elementalGatheringTemporaryEffect.getId())\r\n        ) {\r\n          return {};\r\n        }\r\n        const income = {};\r\n        const effectData = getTemporaryEffectData(\r\n          state,\r\n          elementalGatheringTemporaryEffect.getId(),\r\n        );\r\n        income[effectData.params.resource] = effectData.params.amountPerSec;\r\n        return income;\r\n      },\r\n    ),\r\n  );\r\n  const elementalGatheringEventBuilder = buildEvent(\r\n    \"elementalGatheringEvent\",\r\n    t(\"Elemental Gathering\"),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  ).setOnTrigger((state, eventParams) => {\r\n    state = grantTemporaryEffect(\r\n      elementalGatheringTemporaryEffect.getId(),\r\n      300,\r\n      {\r\n        target: AttackTarget.Player,\r\n        params: {\r\n          resource: eventParams.resource,\r\n          amountPerSec: eventParams.amountPerSec,\r\n        },\r\n      },\r\n    )(state);\r\n    return state;\r\n  });\r\n  elementalGatheringEventBuilder.message(\r\n    t(`You stumble upon an incredible cache of :/essenceIcon/:. It'll take a little time, but there is so much of it that it'll fill your storages!\r\n  \r\n**You will obtain /essenceString/ for the next 5 minutes!**`),\r\n  );\r\n  const elementalGatheringEvent = elementalGatheringEventBuilder.build();\r\n  registerRandomEventTrigger(\r\n    elementalGatheringEvent,\r\n    100,\r\n    (state) => hasFlag(state, Flag.TransmutationUnlocked),\r\n    (state) => {\r\n      const element = getRandomElementFromArray(getUnlockedElements(state));\r\n      const resource = RESOURCE_FOR_ELEMENT[element];\r\n      const resourceCap = getResourceCap(state, resource);\r\n      const amountPerSec = resourceCap / 10; // Fill in 10 seconds\r\n      return {\r\n        resource,\r\n        amountPerSec,\r\n        essenceIcon: getResourceInfo(resource).icon,\r\n        essenceString: t(\"+{{amount}}:{{essenceIcon}}:/sec\", {\r\n          amount: formatNumber(amountPerSec),\r\n          essenceIcon: getResourceInfo(resource).icon,\r\n        }),\r\n      };\r\n    },\r\n  );\r\n  registerTemporaryEffectListener(\r\n    elementalGatheringTemporaryEffect.getId(),\r\n    (state, effect) => {\r\n      if (effect.id == elementalGatheringTemporaryEffect.getId()) {\r\n        state = clearCalculatedIncomeCache(state);\r\n      }\r\n      return effect;\r\n    },\r\n    true,\r\n  );\r\n  // Monstium Catalyst Resonance\r\n  TemporaryEffects.register(monstiumCatalystResonanceTemporaryEffect);\r\n  registerTransformation(\r\n    [[TransformationTags.CatalystEffectivity, monstiumCatalyst.getId()]],\r\n    monstiumCatalystResonanceTemporaryEffect.getId(),\r\n    monstiumCatalystResonanceTemporaryEffect.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(\r\n        state,\r\n        monstiumCatalystResonanceTemporaryEffect.getId(),\r\n      )\r\n        ? 1.25\r\n        : 1.0,\r\n  );\r\n  const monstiumCatalystEventBuilder = buildEvent(\r\n    \"monstiumCatalystEvent\",\r\n    t(\"Monstium Catalyst Resonance\"),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  ).setOnTrigger(\r\n    grantTemporaryEffect(\r\n      monstiumCatalystResonanceTemporaryEffect.getId(),\r\n      300,\r\n      {\r\n        target: AttackTarget.Player,\r\n      },\r\n    ),\r\n  );\r\n  monstiumCatalystEventBuilder.message(\r\n    t(`Oddly, your Monstium Catalysts begin to glow purple. Are they resonating with each other? It might be a great time to Explore!\r\n  \r\n**Your Monstium Catalysts will be 25% more effective for the next 5 minutes!**`),\r\n  );\r\n  const monstiumCatalystEvent = monstiumCatalystEventBuilder.build();\r\n  registerRandomEventTrigger(\r\n    monstiumCatalystEvent,\r\n    100,\r\n    (state) => getBuildingAmount(state, monstiumCatalyst) > 0,\r\n  );\r\n\r\n  // Pile of Coins\r\n  // Only triggers if max coins are less than 1M, for balance\r\n  const pileOfCoinsEventBuilder = buildEvent(\r\n    \"pileOfCoinsEvent\",\r\n    t(\"Pile of Coins\"),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  ).setOnTrigger((state, params) =>\r\n    grantResource(Resource.Coins, params.amount)(state),\r\n  );\r\n  pileOfCoinsEventBuilder.message(\r\n    t(`It's your lucky day! You stumble upon a large pile of :coins:Coins on the ground. You take them - they'll certainly come in handy!\r\n    \r\n**You have obtained /amountText/:coins:!**`),\r\n  );\r\n  const pileOfCoinsEvent = pileOfCoinsEventBuilder.build();\r\n  registerRandomEventTrigger(\r\n    pileOfCoinsEvent,\r\n    100,\r\n    (state) =>\r\n      BuildSaleStall.isVisible(state) &&\r\n      getResourceCap(state, Resource.Coins) < 1000000,\r\n    (state) => {\r\n      const amount =\r\n        (Math.random() * 0.5 + 0.3) * getResourceCap(state, Resource.Coins);\r\n      const amountText = formatNumber(amount);\r\n      return {\r\n        amount,\r\n        amountText,\r\n      };\r\n    },\r\n  );\r\n\r\n  const elementBookEventBuilder = buildEvent(\r\n    \"elementBookEvent\",\r\n    t(\"An Offer of /elementText/\"),\r\n    [EventTag.INCONSEQUENTIAL_RANDOM_EVENT],\r\n  );\r\n  elementBookEventBuilder\r\n    .message(\r\n      t(`You stumble upon a traveling merchant who demands your attention!\r\n\r\n\"Hello there! You look like a wizard of some renown. I have a deal for you! I have this \"Book of /elementText/\" that I've come across, and it seems like it could be *perfect* for you! You're certain to get a nice proficiency boost with it - it's worth every coin! What do you say? Interested?\"\r\n    \r\nYou ponder whether the steep price might be worthwhile...`),\r\n    )\r\n    .option(\r\n      t(\"Buy the Book (/coinAmountText/ Coins)\"),\r\n      {\r\n        transform(state, params) {\r\n          state = grantResource(Resource.Coins, -params.coinAmount)(state);\r\n          state = grantElementExp(params.element, params.exp)(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state, params) =>\r\n          getResourceAmount(state, Resource.Coins) >= params.coinAmount,\r\n      },\r\n      \"purchased\",\r\n    )\r\n    .option(t(\"Decline\"), \"declined\")\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n  elementBookEventBuilder\r\n    .message(\r\n      t(`You decide to buy the book. The merchant smiles while taking your :coins:. \"Nice doing business with you,\" he says, then hands over the book. He walks away soon afterward.\r\n  \r\nYou flip through the book. It has information about /elementText/ that you had no idea of! You feel like you might have made a good purchase.\r\n\r\n**You have obtained /expText/ /elementText/ exp!**`),\r\n    )\r\n    .tag(\"purchased\")\r\n    .end();\r\n  elementBookEventBuilder\r\n    .message(\r\n      t(\r\n        `You decide not to buy the book. The merchant nods. \"I understand. See you next time!\" Casually waving at you, he walks away.`,\r\n      ),\r\n    )\r\n    .tag(\"declined\")\r\n    .end();\r\n  const elementBookEvent = elementBookEventBuilder.build();\r\n  registerRandomEventTrigger(\r\n    elementBookEvent,\r\n    100,\r\n    (state) => isStudyUnlocked(state),\r\n    (state) => {\r\n      const element = getRandomElementFromArray(getUnlockedElements(state));\r\n\r\n      // Exp gained is equal to the one generated by SQRT(researchers) in element for 30 in-game minutes\r\n      // Example: At base rates and 4 researchers, it will be 1 researcher hour of exp: 10800 Exp\r\n      // (non - Primary, brings Lv1 -> Lv7)\r\n      // Late game, with 64 researchers, it will be 4 researcher hours of exp, or about a quarter of the\r\n      // impact of the early game one\r\n      const exp =\r\n        Math.sqrt(getTotalResearchers(state)) *\r\n        getResearcherExpPerSecAndResearcher(state)[element] *\r\n        60 *\r\n        30;\r\n      const coinAmount =\r\n        getResourceCap(state, Resource.Coins) * (Math.random() * 0.45 + 0.5);\r\n      const elementText = translateElement(element);\r\n      const expText = formatNumber(exp);\r\n      const coinAmountText = formatNumber(coinAmount);\r\n      return {\r\n        element,\r\n        exp,\r\n        coinAmount,\r\n        elementText,\r\n        expText,\r\n        coinAmountText,\r\n      };\r\n    },\r\n  );\r\n\r\n  loadBadChestEvent();\r\n}\r\n","import { GameState } from \"../GameState\";\r\nimport { addGameStateListener } from \"../GameStateListeners\";\r\nimport { DataStore } from \"../generic/DataStore\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { getGameEventById } from \"./Events\";\r\nimport { GameEvent } from \"./GameEvent\";\r\n\r\nexport type DungeonEvent = {\r\n  event: GameEvent;\r\n  getWeight: (state: GameState) => number;\r\n};\r\n\r\nexport class DungeonEventGroup implements Identifiable {\r\n  id: string;\r\n  events: DungeonEvent[] = [];\r\n\r\n  constructor(id: string) {\r\n    this.id = id;\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  addEvent(event: DungeonEvent): DungeonEventGroup {\r\n    this.events.push(event);\r\n    return this;\r\n  }\r\n\r\n  getSelectedEvent(state: GameState): GameEvent | undefined {\r\n    return getGameEventById(\r\n      state.run.variables?.[\"dungeonEventGroup_\" + this.id] as\r\n        | string\r\n        | undefined,\r\n    );\r\n  }\r\n\r\n  hasFinishedSelecting(state: GameState): boolean {\r\n    return state.run.variables[\"dungeonEventGroup_\" + this.id] != null;\r\n  }\r\n\r\n  hasFinishedTriggeringThisRun(state: GameState): boolean {\r\n    const event = this.getSelectedEvent(state);\r\n    const triggered = event == null || event.hasTriggered(state);\r\n    return triggered;\r\n  }\r\n\r\n  selectEvent(state: GameState): GameState {\r\n    if (this.hasFinishedSelecting(state)) {\r\n      return state;\r\n    }\r\n\r\n    const totalWeight = this.events.reduce(\r\n      (sum, current) => sum + current.getWeight(state),\r\n      0,\r\n    );\r\n    if (totalWeight <= 0) {\r\n      state.run.variables[\"dungeonEventGroup_\" + this.id] =\r\n        \"dungeonEventGroup_allCompleted\";\r\n      return state;\r\n    }\r\n\r\n    let randomValue = Math.random() * totalWeight;\r\n    for (let event of this.events) {\r\n      randomValue -= event.getWeight(state);\r\n      if (randomValue < 0) {\r\n        state.run.variables[\"dungeonEventGroup_\" + this.id] =\r\n          event.event.getId();\r\n        return state;\r\n      }\r\n    }\r\n\r\n    return state;\r\n  }\r\n}\r\n\r\nconst DungeonEventGroups = new DataStore<DungeonEventGroup>();\r\n\r\nexport function getOrCreateDungeonEventGroup(id: string): DungeonEventGroup {\r\n  let dungeonEventGroup = DungeonEventGroups.getByIdNullable(id);\r\n  if (dungeonEventGroup == null) {\r\n    dungeonEventGroup = new DungeonEventGroup(id);\r\n    DungeonEventGroups.register(dungeonEventGroup);\r\n  }\r\n  return dungeonEventGroup;\r\n}\r\n\r\nexport function loadDungeonEventGroups() {\r\n  addGameStateListener(\"dungeonEventGroupTriggerer\", (state) => {\r\n    DungeonEventGroups.getAll()\r\n      .filter((group) => !group.hasFinishedSelecting(state))\r\n      .forEach((group) => group.selectEvent(state));\r\n  });\r\n}\r\n","export enum Achievement {\r\n  // Defeating specific enemies\r\n  HEAD_INSTRUCTOR_GISELLE = \"headInstructorGiselle\",\r\n  HEADMASTER = \"headmaster\",\r\n  LYTHA_DOOM_SORCERESS = \"lythaDoomSorceress\",\r\n\r\n  // Endings\r\n  TO_SAVE_A_LIFE = \"toSaveALife\",\r\n  A_TERRIBLE_MISTAKE = \"aTerribleMistake\",\r\n  REDEMPTION = \"redemption\",\r\n  TRANSCEND_HUMANITY = \"transcendHumanity\",\r\n  CREATORS_LAST_WORD = \"creatorsLastWord\",\r\n\r\n  // Specific Storylines\r\n  ZOOM_THROUGH_TRAINING = \"zoomThroughTraining\",\r\n  TIC_TAC_TOE = \"ticTacToe\",\r\n  A_FANCY_PAPERWEIGHT = \"aFancyPaperweight\",\r\n  WIZARDS_BEST_FRIEND = \"wizardsBestFriend\",\r\n  SCHEMATICS = \"schematics\",\r\n  ARTISAN_OF_MAGIC = \"artisanOfMagic\",\r\n  RITUALISTS_SECRET = \"ritualistsSecret\",\r\n  THE_BIG_PURCHASE = \"theBigPurchase\",\r\n  BLESSED_LAND = \"blessedLand\",\r\n  EMINENCE = \"eminence\",\r\n\r\n  // Elements\r\n  TOME_OF_TOXIC_KNOWLEDGE = \"tomeOfToxicKnowledge\",\r\n  TOME_OF_MENTAL_KNOWLEDGE = \"tomeOfMentalKnowledge\",\r\n  TOME_OF_LIVING_KNOWLEDGE = \"tomeOfLivingKnowledge\",\r\n  TOME_OF_ELECTRICAL_KNOWLEDGE = \"tomeOfElectricalKnowledge\",\r\n  TOME_OF_DEATHLY_KNOWLEDGE = \"tomeOfDeathlyKnowledge\",\r\n  TOME_OF_DIVINE_KNOWLEDGE = \"tomeOfDivineKnowledge\",\r\n  MYSTERIOUS_BOX = \"mysteriousBox\",\r\n  STARRY_NIGHT = \"starryNight\",\r\n\r\n  // Challenges\r\n  POUCHLESS_CHALLENGE = \"pouchlessChallenge\",\r\n  TIMED_CHALLENGE = \"timedChallenge\",\r\n  DANGER_CHALLENGE = \"dangerChallenge\",\r\n  UNSKILLED_CHALLENGE = \"unskilledChallenge\",\r\n  PRIMARY_CHALLENGE = \"primaryChallenge\",\r\n\r\n  // Other\r\n  EXPLORATION = \"exploration\",\r\n  RETIREMENT = \"retirement\",\r\n  MAGIC_RESEARCH_2 = \"magicResearch2\",\r\n}\r\n","import { nullthrows, valuesOf } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Achievement } from \"../../Achievement\";\r\nimport { registerAchievementUnlockerFromFlag } from \"../../Achievements\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { addGameStateListener } from \"../../GameStateListeners\";\r\nimport { Resource, getResourceAmount, getResourceCap } from \"../../Resources\";\r\nimport { getBuildingAmount, getUsedLand } from \"../../buildings/Buildings\";\r\nimport { essenceCatalyst } from \"../../buildings/catalysts/EssenceCatalyst\";\r\nimport {\r\n  SpellElement,\r\n  getElementLevel,\r\n  getPrimaryElementMaxLevelForRun,\r\n  translateElement,\r\n} from \"../../spells/Elements\";\r\nimport { clearVisibleSpellsCache } from \"../../spells/VisibleSpellsCache\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../spells/channeling/ChannelingResources\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\n\r\nexport function loadPreTrainingProgression() {\r\n  const channelingUnlockerEventBuilder = buildEvent(\r\n    \"channelingUnlocker\",\r\n    t(\"The Power of Magic\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger((state) => {\r\n    state = setFlag(Flag.ChannelingUnlocked)(state);\r\n    state = clearVisibleSpellsCache(state);\r\n    return state;\r\n  });\r\n\r\n  channelingUnlockerEventBuilder.message(\r\n    t(`It hasn't been very long since you completed your magical studies, but you still feel like you barely learned anything. But even among the little things you did learn, you remember: after gathering Mana, you are supposed to use it to channel it into elemental Essences...\r\n    \r\n  **You have gained the ability to Channel elemental Essences! You can do so from the Spell menu.**`),\r\n  );\r\n\r\n  const channelingUnlockerEvent = channelingUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"channelingUnlocker\", (state) => {\r\n    if (\r\n      !channelingUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.ChannelingUnlocked) &&\r\n      getResourceAmount(state, Resource.Mana) >= 10\r\n    ) {\r\n      return triggerEvent(channelingUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const manaSpoutUnlockerEventBuilder = buildEvent(\r\n    \"manaSpoutUnlocker\",\r\n    t(\"Mana Spouts\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.ManaSpoutsUnlocked));\r\n\r\n  manaSpoutUnlockerEventBuilder.message(\r\n    t(`You are already pretty tired of gathering Mana on your own. Luckily, you remember something else from your studies: neat little objects that automatically generate it. And you also recall how to make them...\r\n    \r\n**You can now build Mana Spouts!**`),\r\n  );\r\n\r\n  const manaSpoutUnlockerEvent = manaSpoutUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"manaSpoutUnlocker\", (state) => {\r\n    if (\r\n      !manaSpoutUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.ManaSpoutsUnlocked) &&\r\n      getResourceAmount(state, Resource.AirEssence) > 0 &&\r\n      getResourceAmount(state, Resource.WaterEssence) > 0\r\n    ) {\r\n      return triggerEvent(manaSpoutUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const manaShardUnlockerEventBuilder = buildEvent(\r\n    \"manaShardUnlocker\",\r\n    t(\"Mana Capacity\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.ManaShardsUnlocked));\r\n\r\n  manaShardUnlockerEventBuilder.message(\r\n    t(`With a more stable Mana income, you feel a little relieved - it is one less problem off your hands. However, your reserves are still not very large. It would be great if you could cast more powerful spells, but that requires more Mana...\r\n\r\nYou remember your basic lessons, that spoke of earthern shards that could increase this capacity, which can also be easily built. You will need to try that...\r\n    \r\n**You can now build Mana Shards!**`),\r\n  );\r\n\r\n  const manaShardUnlockerEvent = manaShardUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"manaShardUnlocker\", (state) => {\r\n    if (\r\n      !manaShardUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.ManaShardsUnlocked) &&\r\n      hasFlag(state, Flag.ManaSpoutsUnlocked) &&\r\n      getResourceAmount(state, Resource.EarthEssence) >= 30\r\n    ) {\r\n      return triggerEvent(manaShardUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const storagesUnlockerEventBuilder = buildEvent(\r\n    \"storagesUnlocker\",\r\n    t(\"Full of Essence\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.StoragesUnlocked));\r\n\r\n  storagesUnlockerEventBuilder.message(\r\n    t(`With more Mana reserves, you have managed to stockpile some elemental Essence. You think of saving some room in your home for magical storage furniture, so you can stockpile even more.\r\n\r\nYou briefly ask yourself: why would you even want more? But you rid yourself of that thought - with this much Essence, the magical power you have is still very limited... you will surely need to accumulate more.\r\n    \r\n**You can now build Essence Storages, which allow you to hold more elemental Essence at once!**`),\r\n  );\r\n\r\n  const storagesUnlockerEvent = storagesUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"storagesUnlocker\", (state) => {\r\n    if (\r\n      !storagesUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.StoragesUnlocked) &&\r\n      hasFlag(state, Flag.ManaShardsUnlocked) &&\r\n      getResourceCap(state, Resource.Mana) >= 200 &&\r\n      valuesOf(RESOURCE_FOR_ELEMENT).some(\r\n        (resource) => getResourceAmount(state, resource) >= 100,\r\n      )\r\n    ) {\r\n      return triggerEvent(storagesUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const catalystUnlockerEventBuilder = buildEvent(\r\n    \"catalystUnlocker\",\r\n    t(\"Channeling Catalysts\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.CatalystsUnlocked));\r\n\r\n  catalystUnlockerEventBuilder.message(\r\n    t(`You are slowly feeling like you are beginning to master Channeling, but something bothers you. You get so little Essence for your efforts.\r\n\r\nOnce more, you recall the words of your teachers at your school. *\"A strong, capable wizard has an elaborate home full of magical furniture.\"* You remember one more such piece of furniture: *Essence Catalysts*, which use Fire to improve Channeling efficiency.\r\n\r\nYou contemplate giving that a try...\r\n    \r\n**You can now build Essence Catalysts!**`),\r\n  );\r\n\r\n  const catalystUnlockerEvent = catalystUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"catalystUnlocker\", (state) => {\r\n    if (\r\n      !catalystUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.CatalystsUnlocked) &&\r\n      hasFlag(state, Flag.StoragesUnlocked) &&\r\n      getResourceAmount(state, Resource.FireEssence) >= 200\r\n    ) {\r\n      return triggerEvent(catalystUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const studyUnlockerEventBuilder = buildEvent(\r\n    \"studyUnlocker\",\r\n    t(\"Must Keep Learning\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.StudyUnlocked));\r\n\r\n  studyUnlockerEventBuilder.message(\r\n    t(`The Essence Catalyst is up and running! You feel a little proud of it - you notice right away that your channeling spells have become stronger.\r\n\r\nNow that you are starting to put what you were meant to have learned from the school into practice, you realize that there is just so much you don't know. You wish you had paid more attention. But at the very least, now that you are starting to see its application, you feel like it would be worthwhile to spend some effort studying it...\r\n\r\nYou never liked studying - but you finally understand! You even feel like calling yourself a Magic Researcher. You laugh a little at your own thoughts. Why not?\r\n    \r\n**You can now Study the various Elements! Studying earns you experience in the Elements, which eventually increases their level, unlocking new spells. You can Study from the Study screen!**`),\r\n  );\r\n\r\n  const studyUnlockerEvent = studyUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"studyUnlocker\", (state) => {\r\n    if (\r\n      !studyUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.StudyUnlocked) &&\r\n      hasFlag(state, Flag.CatalystsUnlocked) &&\r\n      getBuildingAmount(state, essenceCatalyst) > 0\r\n    ) {\r\n      return triggerEvent(studyUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const transmuteUnlockerEventBuilder = buildEvent(\r\n    \"transmuteUnlocker\",\r\n    t(\"Transmutation\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.TransmutationUnlocked));\r\n\r\n  transmuteUnlockerEventBuilder.message(\r\n    t(`As you hone your skills, you recall another way to use elemental Essences. By using magic, you can reshape them into solid objects of great power. It was called *Transmutation* magic. That was it! It has to be how you would make the Philosopher's Stone, isn't it? You avidly pull your notes from the school.\r\n\r\nHowever, your excitement vanishes when you realize most of them are still unintelligible. You turn back to the beginning page. There's a diagram here - but this one feels like it might be simple enough. You remember not understanding heads nor tails of the explanation at the time, but it feels like now that you have finally put some things into practice, your understanding has grown...\r\n    \r\n**You can now cast Transmutation spells! Transmutation spells allow you to convert elemental Essences and other materials into various items. You can do so from the Transmutation screen!**`),\r\n  );\r\n\r\n  const transmuteUnlockerEvent = transmuteUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"transmuteUnlocker\", (state) => {\r\n    if (\r\n      state.run.primaryElement != null &&\r\n      !transmuteUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.TransmutationUnlocked) &&\r\n      hasFlag(state, Flag.StudyUnlocked) &&\r\n      getPrimaryElementMaxLevelForRun(state) >= 2\r\n    ) {\r\n      return triggerEvent(transmuteUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const wizardsUnlockerEventBuilder = buildEvent(\r\n    \"wizardsUnlocker\",\r\n    t(\"A Strange Visitor\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  wizardsUnlockerEventBuilder.message(\r\n    t(`*Knock, knock.* Someone is at the door of your home. You decide to open it, and meet face to face with a woman. From her attire, she appears to be a wizard. But something feels a little off about her. Her robes are somewhat worn down, and she is oddly carrying a leather bag strapped to her shoulder.\r\n    \r\n*\"Wizard for hire from the Wizards' Guild\"*, she exclaims, while giving you a paper. You skim through it very quickly. It appears to be a resume listing her skills. It looks impressive indeed, almost too good to be true. You look back at her. She continues: \"You only need to tell me what to do, and I will do it for you!\"\r\n\r\nShe must have followed you from the short trip you just did to sell your items...`),\r\n  );\r\n  wizardsUnlockerEventBuilder\r\n    .message(\r\n      t(`\"As a special offer, I will join you entirely *for free*!\" As she says this, she decides to come inside your home. You are shocked - you didn't agree to anything yet! You are ready to kick her out. But before you reply, you pause and think about it some more. Having someone else helping you cast all those spells would certainly be a big help. Even more so if for free.\r\n    \r\nYou ask her to channel some Water, and then you notice her struggling. Beads of sweat start forming on her forehead as she tries to focus to show you her supposed skills. Eventually, she comes through, although she appears to be pretty exhausted. She surprisingly appears to be even less skilled than you are... *no wonder* the offer was actually free.`),\r\n    )\r\n    .option(t(\"Continue\"), { transform: setFlag(Flag.WizardsUnlocked) }, \"end\");\r\n  wizardsUnlockerEventBuilder\r\n    .message(\r\n      t(`Nevertheless, you help her get set up on a corner of your home. She appears quite excited and thanks you. You know that paper was a complete lie, but the idea still stands: if you are going to create or find the Philosopher's Stone, more helping hands - of any kind - could end up being key to getting there.\r\n    \r\nAnd maybe it is even worthwhile to have more than one extra pair...\r\n\r\n**You have unlocked the ability to direct a team of Wizards to help you cast spells of various kinds! You can do so from the Wizards screen. In addition, you can now build Wizard Chambers, which allow you to hire more Wizards from the Guild!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const wizardsUnlockerEvent = wizardsUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"wizardsUnlocker\", (state) => {\r\n    if (\r\n      !wizardsUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.WizardsUnlocked) &&\r\n      hasFlag(state, Flag.TransmutationUnlocked) &&\r\n      getResourceAmount(state, Resource.Coins) >= 500\r\n    ) {\r\n      return triggerEvent(wizardsUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const marketUnlockerEventBuilder = buildEvent(\r\n    \"marketUnlocker\",\r\n    t(\"Start of a Business\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.SaleStallsUnlocked));\r\n\r\n  marketUnlockerEventBuilder.message(\r\n    t(`You have already gone to the town so many times to sell your items. It is a bit of a trip. It would be much more convenient if instead of you having to go there, customers could simply *come* instead and buy your items...\r\n    \r\nYou decide to ask the town hall about this. The town officer tells you that you are, in fact, allowed to do so if you wish - and they will even spread the word so that people know about it! She quickly corrects herself - they will spread the word *a little*, at least until your \"store\" becomes more famous... You decide to give it a try and see if it leads anywhere - having a solid source of income means you can devote your attention to your ultimate goal.\r\n\r\n**You can now build Market Stalls to automatically sell items - and as a bonus, they will sell them for higher than their normal sale price!**`),\r\n  );\r\n\r\n  const marketUnlockerEvent = marketUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"marketUnlocker\", (state) => {\r\n    if (\r\n      !marketUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.SaleStallsUnlocked) &&\r\n      hasFlag(state, Flag.WizardsUnlocked) &&\r\n      getResourceAmount(state, Resource.Coins) >= 1000\r\n    ) {\r\n      return triggerEvent(marketUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const researchersUnlockerEventBuilder = buildEvent(\r\n    \"researchersUnlocker\",\r\n    t(\"A Helping Hand\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.ResearchersUnlocked));\r\n\r\n  researchersUnlockerEventBuilder.message(\r\n    t(`The new member of your house grabs your attention. \"Hey! I've noticed you have been attempting to study very hard. But studying stinks, doesn't it?\" She wrinkles her nose in a funny way. \"Nowadays, you're meant to get others to do the studying for you! ...Although I think it might cost some :coins:.\"\r\n    \r\nGetting others to do the studying? You are not very surprised *she* is saying this. But - you recognize that with the growing amount of things to do, it might be a good idea. Perhaps with a specially built furniture and some money, you might just be able to find people who can help...\r\n\r\n**You can now build Researcher Desks! Having Researcher Desks will grant you extra Researchers, which can Study the various elements and let you get experience faster!**`),\r\n  );\r\n\r\n  const researchersUnlockerEvent = researchersUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"researchersUnlocker\", (state) => {\r\n    if (\r\n      !researchersUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.ResearchersUnlocked) &&\r\n      hasFlag(state, Flag.SaleStallsUnlocked) &&\r\n      getResourceAmount(state, Resource.Coins) >= 1500\r\n    ) {\r\n      return triggerEvent(researchersUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const expandHomeUnlockerEventBuilder = buildEvent(\r\n    \"expandHomeUnlocker\",\r\n    t(\"A Bigger House?\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.LandPurchaseUnlocked));\r\n\r\n  expandHomeUnlockerEventBuilder.message(\r\n    t(`Your home is getting full of furniture. You start wondering if there is a way for you to expand it.\r\n    \r\nPromptly, you go to the town hall again, where the clerk you are informed that you are in luck - there are actually many possibilities for enlargening your :land:Land, and they are quite cheap! But she quickly corrects herself - only *a few of them* are cheap. You thank her for the information regardless. It might be time to start saving up...\r\n\r\n**You can now purchase additional land to expand your Home!**`),\r\n  );\r\n\r\n  const expandHomeUnlockerEvent = expandHomeUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"expandHomeUnlocker\", (state) => {\r\n    if (\r\n      !expandHomeUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.LandPurchaseUnlocked) &&\r\n      hasFlag(state, Flag.ResearchersUnlocked) &&\r\n      getUsedLand(state) >= 120\r\n    ) {\r\n      return triggerEvent(expandHomeUnlockerEvent);\r\n    }\r\n  });\r\n\r\n  const explorationUnlockerEventBuilder = buildEvent(\r\n    \"explorationUnlocker\",\r\n    t(\"Training\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  explorationUnlockerEventBuilder.message(\r\n    t(`You receive a familiar letter on your mail today. You sit down and begin to read it. It appears to be from your magic school. It reads:\r\n    \r\n*\"Esteemed Student: We would like to extend you an extra free training course on combat. If you are interested, please report to the Tower of /element/ Training. We expect you soon.*\"`),\r\n  );\r\n  explorationUnlockerEventBuilder\r\n    .message(\r\n      t(`You are then surprised by a short squeal behind you. It came straight from the first wizard you \"hired\" - the one that decided to work completely for free. She was standing behind you the entire time, *peeking at the letter* over your shoulder! Angry, you are about to reprimand her, but she exclaims:\r\n    \r\n\"*Combat* training? That sounds really exciting! You should definitely participate!\" You remind her that your goal is to find or create the Philosopher's Stone and not to get into fights, but she overrides you: \"If you are looking for an immensely powerful magical object, don't you think it's going to be hidden and guarded behind enemies that are just as powerful, or worse?\"\r\n\r\nShe might be right...`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      { transform: setFlag(Flag.ExplorationUnlocked) },\r\n      \"end\",\r\n    );\r\n  explorationUnlockerEventBuilder\r\n    .message(\r\n      t(`She continues, excited: \"So, when are we leaving?\" You notice her picking up her robe as if ready to go. You tell her to wait a little. You've made up your mind about this training, but you feel you should at least prepare yourself and get some combat equipment in order first before attending...\r\n    \r\n**You have unlocked Exploration! Venture into various different areas and fight powerful foes. What will you find?**\r\n\r\n**You can explore a new dungeon: \"Tower of /element/ Training\"!**\r\n\r\n**You can also now Transmute equipment, including Hand and Body equipment!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const explorationUnlockerEvent = explorationUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"explorationUnlocker\", (state) => {\r\n    if (\r\n      state.run.primaryElement != null &&\r\n      !explorationUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.ExplorationUnlocked) &&\r\n      hasFlag(state, Flag.LandPurchaseUnlocked) &&\r\n      [\r\n        SpellElement.Fire,\r\n        SpellElement.Earth,\r\n        SpellElement.Water,\r\n        SpellElement.Air,\r\n      ].includes(state.run.primaryElement) &&\r\n      getElementLevel(state, nullthrows(state.run.primaryElement)) >= 5\r\n    ) {\r\n      return triggerEvent(explorationUnlockerEvent, {\r\n        element: translateElement(nullthrows(state.run.primaryElement)),\r\n      });\r\n    }\r\n  });\r\n  loadOtherElementExplorationUnlocker();\r\n}\r\n\r\nfunction loadOtherElementExplorationUnlocker() {\r\n  const explorationUnlockerEventBuilder = buildEvent(\r\n    \"explorationUnlockerOtherElement\",\r\n    t(\"Training\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n  explorationUnlockerEventBuilder.message(\r\n    t(`You receive a familiar letter on your mail today. You sit down and begin to read it. It appears to be from your magic school. It reads:\r\n    \r\n*\"Esteemed Student: We would like to extend you an extra free training course on combat. If you are interested, please report to the Towers of Training. We expect you soon.*\"`),\r\n  );\r\n  explorationUnlockerEventBuilder\r\n    .message(\r\n      t(`You are then surprised by a short squeal behind you. It came straight from the first wizard you \"hired\" - the one that decided to work completely for free. She was standing behind you the entire time, *peeking at the letter* over your shoulder! Angry, you are about to reprimand her, but she exclaims:\r\n    \r\n\"*Combat* training? That sounds really exciting! You should definitely participate!\" You remind her that your goal is to find or create the Philosopher's Stone and not to get into fights, but she overrides you: \"If you are looking for an immensely powerful magical object, don't you think it's going to be hidden and guarded behind enemies that are just as powerful, or worse?\"\r\n\r\nShe might be right...`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      { transform: setFlag(Flag.ExplorationUnlocked) },\r\n      \"end\",\r\n    );\r\n  explorationUnlockerEventBuilder\r\n    .message(\r\n      t(`She continues, excited: \"So, when are we leaving?\" You notice her picking up her robe as if ready to go. You tell her to wait a little. You've made up your mind about this training, but you feel you should at least prepare yourself and get some combat equipment in order first before attending...\r\n    \r\n**You have unlocked Exploration! Venture into various different areas and fight powerful foes. What will you find?**\r\n\r\n**You can explore four new dungeons: \"Tower of Fire Training\", \"Tower of Earth Training\", \"Tower of Water Training\" and \"Tower of Air Training\"!**\r\n\r\n**You can also now Transmute equipment, including Hand and Body equipment!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const explorationUnlockerEvent = explorationUnlockerEventBuilder.build();\r\n\r\n  addGameStateListener(\"explorationUnlockerOtherElement\", (state) => {\r\n    if (\r\n      state.run.primaryElement != null &&\r\n      !explorationUnlockerEvent.hasTriggered(state) &&\r\n      !hasFlag(state, Flag.ExplorationUnlocked) &&\r\n      hasFlag(state, Flag.LandPurchaseUnlocked) &&\r\n      ![\r\n        SpellElement.Fire,\r\n        SpellElement.Earth,\r\n        SpellElement.Water,\r\n        SpellElement.Air,\r\n      ].includes(state.run.primaryElement) &&\r\n      getElementLevel(state, nullthrows(state.run.primaryElement)) >= 5\r\n    ) {\r\n      return triggerEvent(explorationUnlockerEvent, {\r\n        element: translateElement(nullthrows(state.run.primaryElement)),\r\n      });\r\n    }\r\n  });\r\n\r\n  registerAchievementUnlockerFromFlag(\r\n    Flag.ExplorationUnlocked,\r\n    Achievement.EXPLORATION,\r\n  );\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { grantTemporaryEffect } from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../../temporaryeffects/Wet\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport {\r\n  modifyEnemyCurrentHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { pushCombatActionResult } from \"../../ExplorationActionResult\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass AnimatedSnowman extends Enemy {\r\n  getId(): string {\r\n    return \"animatedSnowman\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Animated Snowman\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 1500,\r\n      attack: 20,\r\n      defense: 0,\r\n      attackDelay: 3.0,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./animatedSnowman.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 4;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 40;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 6;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (Math.random() < 0.1) {\r\n      return {\r\n        name: t(\"Splash\"),\r\n        delay: this.getAttackDelay(state) * 1.2,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.1,\r\n            {\r\n              tags: [SpellElement.Water],\r\n              cause: t(\"Splash\"),\r\n              onHit: (state, result) => {\r\n                if (result.isHit) {\r\n                  state = grantTemporaryEffect(Wet.getId(), 15, {\r\n                    target: result.target,\r\n                  })(state);\r\n                }\r\n                return state;\r\n              },\r\n            },\r\n          );\r\n\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.5) {\r\n      return {\r\n        name: t(\"Droplet of Healing\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          const healAmt = this.getMaxHP(state) * (0.02 + Math.random() * 0.005);\r\n          state = modifyEnemyCurrentHP(state, healAmt);\r\n          const actionResult = {\r\n            id: Math.random().toString(),\r\n            damage: -healAmt,\r\n            isCrit: false,\r\n            isHit: true,\r\n            time: getSecondsPlayed(state),\r\n            source: AttackTarget.Enemy,\r\n            target: AttackTarget.Enemy,\r\n            tags: [],\r\n          };\r\n          state = pushCombatActionResult(state, actionResult);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 2,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = setDungeonFloorCompleted(state, \"trainingTowerAir\");\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"Wow! The guardian of the Tower of Air Training looks like a snowman that is able to move on its own through some sort of magic. It has a lot of health, and is able to heal itself. That is annoying! On the other hand, attacks deal quite a bit of damage, even weak ones. Using Air Blast or other attack spells, a weak but speedy weapon, and having some way to heal like a few potions should do the trick!\",\r\n    );\r\n  }\r\n}\r\n\r\nexport default new AnimatedSnowman();\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport { calculatePlayerMaxHP } from \"../../../exploration/CombatStats\";\r\nimport {\r\n  getCurrentPlayerHP,\r\n  modifyPlayerCurrentHP,\r\n} from \"../../../exploration/Exploration\";\r\nimport { pushCombatActionResult } from \"../../../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { isHealingPossible } from \"../../../temporaryeffects/CommonTemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { PouchItem } from \"../PouchItem\";\r\n\r\nclass Cherry extends PouchItem {\r\n  getId(): string {\r\n    return \"cherry\";\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./cherry.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Cherry\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"They say a cherry a day keeps the doctor away... wait, something is off. Restores a little :hp:.\",\r\n    );\r\n  }\r\n\r\n  hpHealTags = [];\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      hpHeal: {\r\n        value: 10,\r\n        tags: this.hpHealTags,\r\n        unit: \":hp:\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getHPHealAmount(state: GameState, params: ItemParams): number {\r\n    return this.getItemEffects(state, params, \"hpHeal\").hpHeal;\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string {\r\n    return t(\"^+{{amount}}^<{{explanation}}>:hp:\", {\r\n      amount: formatNumber(this.getHPHealAmount(state, params)),\r\n      explanation: this.getItemEffectExplanations(state, params, \"hpHeal\")\r\n        .hpHeal,\r\n    });\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 30;\r\n  }\r\n\r\n  doPouchItemEffect(state: GameState, params: ItemParams): GameState {\r\n    const healAmt = this.getHPHealAmount(state, params);\r\n    state = modifyPlayerCurrentHP(state, healAmt, this.getBaseName(params));\r\n    const actionResult = {\r\n      id: Math.random().toString(),\r\n      damage: -healAmt,\r\n      isCrit: false,\r\n      isHit: true,\r\n      time: getSecondsPlayed(state),\r\n      source: AttackTarget.Player,\r\n      target: AttackTarget.Player,\r\n      tags: this.getTags(),\r\n    };\r\n    state = pushCombatActionResult(state, actionResult);\r\n    return state;\r\n  }\r\n\r\n  shouldAutoUse(state: GameState, params: ItemParams): boolean {\r\n    const maxHP = calculatePlayerMaxHP(state);\r\n    const currentHP = getCurrentPlayerHP(state);\r\n    return (\r\n      (maxHP - currentHP > this.getHPHealAmount(state, params) ||\r\n        currentHP / maxHP < 0.3) &&\r\n      isHealingPossible(state, AttackTarget.Player)\r\n    );\r\n  }\r\n\r\n  getUsesPerCombatBase(params: ItemParams): number {\r\n    return 3;\r\n  }\r\n}\r\n\r\nconst cherry = new Cherry();\r\n\r\nexport { cherry as Cherry };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Cherry } from \"../../../items/equipment/pouch/Cherry\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass Goat extends Enemy {\r\n  getId(): string {\r\n    return \"goat\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Goat\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 180,\r\n      attack: 18,\r\n      defense: 0,\r\n      attackDelay: 2.8,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./goat.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 2;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 14;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 3;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (Math.random() < 0.1) {\r\n      return {\r\n        name: t(\"Baa!\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) => state,\r\n      };\r\n    }\r\n    if (Math.random() < 0.25) {\r\n      return {\r\n        name: t(\"Strong Attack\"),\r\n        delay: this.getAttackDelay(state) * 2.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 2.0);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 3,\r\n        chance: 0.15,\r\n      },\r\n      {\r\n        itemId: Cherry.getId(),\r\n        amount: 1,\r\n        chance: 0.005,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new Goat();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport AnimatedSnowman from \"../../enemies/training/AnimatedSnowman\";\r\nimport Goat from \"../../enemies/training/Goat\";\r\nimport Slime from \"../../enemies/training/Slime\";\r\nimport {\r\n  DungeonFloor,\r\n  encounterEnemy,\r\n  ExplorationPossibility,\r\n} from \"../DungeonFloor\";\r\n\r\nconst EXPLORATION_POSSIBILTIIES = [\r\n  {\r\n    weight: 100,\r\n    transforms: encounterEnemy(Slime),\r\n  },\r\n  {\r\n    weight: 150,\r\n    transforms: encounterEnemy(Goat),\r\n  },\r\n];\r\n\r\nclass TrainingTowerAir extends DungeonFloor {\r\n  getId(): string {\r\n    return \"trainingTowerAir\";\r\n  }\r\n  getFloorName(): string {\r\n    return t(\"Tower of Air Training\");\r\n  }\r\n  getBoss(state: GameState): Enemy {\r\n    return AnimatedSnowman;\r\n  }\r\n  getBreedingLevel(): number {\r\n    return 1;\r\n  }\r\n  isMainStoryDungeonFloor(): boolean {\r\n    return true;\r\n  }\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 4.0;\r\n  }\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 30;\r\n  }\r\n  getBaseExplorationPossibilities(state: GameState): ExplorationPossibility[] {\r\n    return EXPLORATION_POSSIBILTIIES;\r\n  }\r\n  isUnlocked(state: GameState): boolean {\r\n    return (\r\n      ![SpellElement.Earth, SpellElement.Fire, SpellElement.Water].includes(\r\n        state.run.primaryElement,\r\n      ) || hasFlag(state, Flag.RestOfTrainingUnlocked)\r\n    );\r\n  }\r\n}\r\n\r\nexport default new TrainingTowerAir();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Cherry } from \"../../../items/equipment/pouch/Cherry\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass BreezyRabbit extends Enemy {\r\n  getId(): string {\r\n    return \"breezyRabbit\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Breezy Rabbit\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 65,\r\n      attack: 13,\r\n      defense: 3,\r\n      attackDelay: 1.0,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./breezyRabbit.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 2;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 20;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 3;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (Math.random() < 0.1) {\r\n      return {\r\n        name: t(\"Jump adorably\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) => state,\r\n      };\r\n    }\r\n    if (Math.random() < 0.2) {\r\n      return {\r\n        name: t(\"Double Attack\"),\r\n        delay: this.getAttackDelay(state) * 1.3,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Cherry.getId(),\r\n        amount: 1,\r\n        chance: 0.05,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new BreezyRabbit();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { HasteTemporaryEffect } from \"../../../spells/air/Haste\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport {\r\n  getCurrentEnemyHPFraction,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass Windglider extends Enemy {\r\n  getId(): string {\r\n    return \"windglider\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Windglider\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 700,\r\n      attack: 16,\r\n      defense: 5,\r\n      attackDelay: 1.0,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./windglider.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 4;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 60;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 4;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (\r\n      !hasTemporaryEffect(\r\n        state,\r\n        HasteTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      ) &&\r\n      getCurrentEnemyHPFraction(state) < 0.5\r\n    ) {\r\n      return {\r\n        name: t(\"Haste\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: grantTemporaryEffect(HasteTemporaryEffect.getId(), 15, {\r\n          target: AttackTarget.Enemy,\r\n          params: { commonBuff: { AttackDelayMultiplier: 0.85 } },\r\n        }),\r\n      };\r\n    }\r\n    if (Math.random() < 0.3) {\r\n      return {\r\n        name: t(\"Air Blast\"),\r\n        delay: this.getAttackDelay(state) * 1.3,\r\n        transform: (state) =>\r\n          standardEnemyAttackEffect(state, this.getAttack(state) * 1.3, {\r\n            tags: [SpellElement.Air],\r\n            cause: t(\"Air Blast\"),\r\n          }),\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 2,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = setDungeonFloorCompleted(state, \"trainingTowerEarth\");\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"The guardian of the Tower of Earth Training is an avian embodying Air. How does that make any sense?! Well... it attacks very fast, and will attack even faster after it uses Haste. You will need high :defense: for this one! Make sure to also have at least one way to heal! It is not too resilient, so just try to take down its health.\",\r\n    );\r\n  }\r\n}\r\n\r\nexport default new Windglider();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport BreezyRabbit from \"../../enemies/training/BreezyRabbit\";\r\nimport Slime from \"../../enemies/training/Slime\";\r\nimport FamiliarOfWind from \"../../enemies/training/Windglider\";\r\nimport {\r\n  DungeonFloor,\r\n  encounterEnemy,\r\n  ExplorationPossibility,\r\n} from \"../DungeonFloor\";\r\n\r\nconst EXPLORATION_POSSIBILITIES = [\r\n  {\r\n    weight: 100,\r\n    transforms: encounterEnemy(Slime),\r\n  },\r\n  {\r\n    weight: 150,\r\n    transforms: encounterEnemy(BreezyRabbit),\r\n  },\r\n];\r\n\r\nclass TrainingTowerEarth extends DungeonFloor {\r\n  getId(): string {\r\n    return \"trainingTowerEarth\";\r\n  }\r\n  getFloorName(): string {\r\n    return t(\"Tower of Earth Training\");\r\n  }\r\n  getBoss(state: GameState): Enemy {\r\n    return FamiliarOfWind;\r\n  }\r\n  getBreedingLevel(): number {\r\n    return 1;\r\n  }\r\n  isMainStoryDungeonFloor(): boolean {\r\n    return true;\r\n  }\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 4.0;\r\n  }\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 30;\r\n  }\r\n  getBaseExplorationPossibilities(state: GameState): ExplorationPossibility[] {\r\n    return EXPLORATION_POSSIBILITIES;\r\n  }\r\n  isUnlocked(state: GameState): boolean {\r\n    return (\r\n      ![SpellElement.Air, SpellElement.Fire, SpellElement.Water].includes(\r\n        state.run.primaryElement,\r\n      ) || hasFlag(state, Flag.RestOfTrainingUnlocked)\r\n    );\r\n  }\r\n}\r\n\r\nexport default new TrainingTowerEarth();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Cherry } from \"../../../items/equipment/pouch/Cherry\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass FlyingRock extends Enemy {\r\n  getId(): string {\r\n    return \"flyingRock\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Flying Rock\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 45,\r\n      attack: 16,\r\n      defense: 50,\r\n      attackDelay: 3.6,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./flyingRock.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 2;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 16;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 3;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (Math.random() < 0.2) {\r\n      return {\r\n        name: t(\"Stone Strike\"),\r\n        delay: this.getAttackDelay(state) * 1.3,\r\n        transform: (state) =>\r\n          standardEnemyAttackEffect(state, this.getAttack(state) * 1.5, {\r\n            tags: [SpellElement.Earth],\r\n            cause: t(\"Stone Strike\"),\r\n          }),\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 1,\r\n        chance: 0.4,\r\n      },\r\n      {\r\n        itemId: Cherry.getId(),\r\n        amount: 1,\r\n        chance: 0.01,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new FlyingRock();\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  grantTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationType } from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass StoneskinTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"stoneskin\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Stoneskin\");\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./stoneskin.png\");\r\n  }\r\n\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [\r\n      { stat: CombatStat.Defense, type: TransformationType.Addition },\r\n      { stat: CombatStat.Defense, type: TransformationType.Multiplier },\r\n    ];\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    const defense = temporaryEffectData.params.commonBuff.Defense;\r\n    if (!defense) {\r\n      const defenseRatio =\r\n        temporaryEffectData.params.commonBuff.DefenseMultiplier;\r\n      return t(\"{{ratio}}:defense:\", {\r\n        ratio: formatMultiplier(defenseRatio),\r\n      });\r\n    }\r\n    return t(\"+{{amount}}:defense:\", {\r\n      amount: formatNumber(defense),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new StoneskinTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass Stoneskin extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"stoneskin\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Stoneskin\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 400;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 9,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        unit: \":defense:\",\r\n      },\r\n      duration: {\r\n        value: 60.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { commonBuff: { Defense: effects.magnitude } },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Harden your skin, to protect yourself against blows.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{amount}}^<{{amountExplanation}}>:defense: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        amount: formatNumber(effects.magnitude),\r\n        amountExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 4 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 54 };\r\n  }\r\n}\r\n\r\nconst stoneskin = new Stoneskin();\r\n\r\nregisterEmpowerEffects(stoneskin, [TransformationTags.Cost, Resource.Mana], 40);\r\nregisterEmpowerEffects(\r\n  stoneskin,\r\n  [TransformationTags.TemporaryEffectMagnitude],\r\n  7,\r\n);\r\n\r\nexport { stoneskin as Stoneskin, temporaryEffect as StoneskinTemporaryEffect };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { StoneskinTemporaryEffect } from \"../../../spells/earth/Stoneskin\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport {\r\n  getCurrentEnemyHPFraction,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass RockGolem extends Enemy {\r\n  getId(): string {\r\n    return \"rockGolem\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Rock Golem\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 300,\r\n      attack: 21,\r\n      defense: 65,\r\n      attackDelay: 3.5,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./rockGolem.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 4;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 40;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 8;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (\r\n      !hasTemporaryEffect(\r\n        state,\r\n        StoneskinTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      ) &&\r\n      getCurrentEnemyHPFraction(state) < 0.5 &&\r\n      Math.random() < 0.5\r\n    ) {\r\n      return {\r\n        name: t(\"Stoneskin\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: grantTemporaryEffect(StoneskinTemporaryEffect.getId(), 20, {\r\n          target: AttackTarget.Enemy,\r\n          params: { commonBuff: { DefenseMultiplier: 1.3 } },\r\n        }),\r\n      };\r\n    }\r\n    if (Math.random() < 0.3) {\r\n      return {\r\n        name: t(\"Stone Strike\"),\r\n        delay: this.getAttackDelay(state) * 1.3,\r\n        transform: (state) =>\r\n          standardEnemyAttackEffect(state, this.getAttack(state) * 1.5),\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 2,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = setDungeonFloorCompleted(state, \"trainingTowerFire\");\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"This moving Rock Golem is the guardian of the Tower of Fire Training. It has quite low maximum :hp:, but its :defense: is extremely high, and it can get it even higher! You will need weapons and spells that have a lot of :attack: to pierce through, such as axes or Fireball.\",\r\n    );\r\n  }\r\n}\r\n\r\nexport default new RockGolem();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport FlyingRock from \"../../enemies/training/FlyingRock\";\r\nimport RockGolem from \"../../enemies/training/RockGolem\";\r\nimport Slime from \"../../enemies/training/Slime\";\r\nimport {\r\n  DungeonFloor,\r\n  encounterEnemy,\r\n  ExplorationPossibility,\r\n} from \"../DungeonFloor\";\r\n\r\nconst EXPLORATION_POSSIBILITIES = [\r\n  {\r\n    weight: 100,\r\n    transforms: encounterEnemy(Slime),\r\n  },\r\n  {\r\n    weight: 150,\r\n    transforms: encounterEnemy(FlyingRock),\r\n  },\r\n];\r\nclass TrainingTowerFire extends DungeonFloor {\r\n  getId(): string {\r\n    return \"trainingTowerFire\";\r\n  }\r\n  getFloorName(): string {\r\n    return t(\"Tower of Fire Training\");\r\n  }\r\n  getBoss(state: GameState): Enemy {\r\n    return RockGolem;\r\n  }\r\n  getBreedingLevel(): number {\r\n    return 1;\r\n  }\r\n  isMainStoryDungeonFloor(): boolean {\r\n    return true;\r\n  }\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 4.0;\r\n  }\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 30;\r\n  }\r\n  getBaseExplorationPossibilities(state: GameState): ExplorationPossibility[] {\r\n    return EXPLORATION_POSSIBILITIES;\r\n  }\r\n  isUnlocked(state: GameState): boolean {\r\n    return (\r\n      ![SpellElement.Air, SpellElement.Earth, SpellElement.Water].includes(\r\n        state.run.primaryElement,\r\n      ) || hasFlag(state, Flag.RestOfTrainingUnlocked)\r\n    );\r\n  }\r\n}\r\n\r\nexport default new TrainingTowerFire();\r\n","import { DungeonFloor } from \"../../exploration/dungeons/DungeonFloor\";\r\nimport {\r\n  addEnemyDeathListener,\r\n  getCurrentDungeonFloor,\r\n  getSuccessfulExplorationsForFloor,\r\n} from \"../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../exploration/ExplorationUtils\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { DataStore } from \"../../generic/DataStore\";\r\nimport { Identifiable } from \"../../generic/Identifiable\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { GameEvent } from \"../GameEvent\";\r\n\r\nexport type ExplorationEvent = {\r\n  event: GameEvent;\r\n  getWeight: (state: GameState) => number;\r\n  getParams?: (state: GameState) => any;\r\n};\r\n\r\nexport abstract class ExplorationTriggerGroup implements Identifiable {\r\n  explorationEvents: ExplorationEvent[] = [];\r\n\r\n  abstract getId(): string;\r\n\r\n  abstract getExplorationSuccessesBase(): number;\r\n\r\n  abstract getDungeonFloors(): DungeonFloor[];\r\n\r\n  abstract getHintMessageWhenPossible(state: GameState): string;\r\n  abstract getHintMessageWhenNotPossible(state: GameState): string;\r\n\r\n  getHintMessage(state: GameState): string {\r\n    if (this.isDoneForThisRun(state)) {\r\n      return this.getHintMessageWhenNotPossible(state);\r\n    }\r\n    return this.getHintMessageWhenPossible(state);\r\n  }\r\n\r\n  maxTriggersPerRun(): number | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  isDoneForThisRun(state: GameState): boolean {\r\n    const maxTriggers = this.maxTriggersPerRun();\r\n    if (maxTriggers === undefined) {\r\n      return false;\r\n    }\r\n\r\n    const timesTriggered =\r\n      state.run.explorationTriggers[this.getId()]?.timesTriggered ?? 0;\r\n    if (timesTriggered >= maxTriggers) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  addExplorationEvent(event: ExplorationEvent) {\r\n    this.explorationEvents.push(event);\r\n  }\r\n\r\n  getExplorationAmountNeeded(state: GameState): number {\r\n    if (state.run.explorationTriggers[this.getId()] == undefined) {\r\n      state.run.explorationTriggers[this.getId()] = {\r\n        timesTriggered: 0,\r\n        next:\r\n          this.getExplorationSuccessesBase() *\r\n          (1 + 0.5 * (0.5 - Math.random())),\r\n      };\r\n    }\r\n    return state.run.explorationTriggers[this.getId()].next;\r\n  }\r\n\r\n  getTotalExplorationSuccesses(state: GameState): number {\r\n    return this.getDungeonFloors().reduce(\r\n      (accumulated, floor) =>\r\n        accumulated + getSuccessfulExplorationsForFloor(state, floor.getId()),\r\n      0,\r\n    );\r\n  }\r\n\r\n  checkAndTrigger(state: GameState): GameState {\r\n    const totalExplorations = this.getTotalExplorationSuccesses(state);\r\n    if (\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      this.getDungeonFloors().includes(getCurrentDungeonFloor(state)) &&\r\n      totalExplorations >= this.getExplorationAmountNeeded(state)\r\n    ) {\r\n      const totalWeight = this.explorationEvents.reduce(\r\n        (sum, current) => sum + current.getWeight(state),\r\n        0,\r\n      );\r\n      if (totalWeight <= 0) {\r\n        return state;\r\n      }\r\n\r\n      let randomValue = Math.random() * totalWeight;\r\n      for (let event of this.explorationEvents) {\r\n        randomValue -= event.getWeight(state);\r\n        if (randomValue < 0) {\r\n          // We have selected an event and should trigger it\r\n          const timesTriggered =\r\n            state.run.explorationTriggers[this.getId()].timesTriggered + 1;\r\n          state.run.explorationTriggers[this.getId()].timesTriggered =\r\n            timesTriggered;\r\n          state.run.explorationTriggers[this.getId()].next =\r\n            totalExplorations +\r\n            Math.pow(timesTriggered + 1, 1.9) *\r\n              this.getExplorationSuccessesBase() *\r\n              (1 + 0.3 * (0.5 - Math.random()));\r\n          state = triggerEvent(\r\n            event.event,\r\n            event?.getParams?.(state) ?? {},\r\n          )(state);\r\n          return state;\r\n        }\r\n      }\r\n    }\r\n    return state;\r\n  }\r\n}\r\n\r\nexport const ExplorationTriggerGroups =\r\n  new DataStore<ExplorationTriggerGroup>();\r\n\r\naddEnemyDeathListener(\"explorationTriggerGroups\", (state) => {\r\n  ExplorationTriggerGroups.getAll().forEach((group) => {\r\n    state = group.checkAndTrigger(state);\r\n  });\r\n  return state;\r\n});\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass FeatheredHat extends EquippableItem {\r\n  getId(): string {\r\n    return \"featheredHat\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./featheredHat.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Feathered Hat\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A hat decorated with a feather. Not too strong, but it makes you feel light.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 2;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.05;\r\n  }\r\n}\r\n\r\nconst featheredHat = new FeatheredHat();\r\n\r\nclass TransmuteFeatheredHat extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return featheredHat;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 4,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        AirEssence: 2000,\r\n      },\r\n      items: {\r\n        elementalShardAir: 4,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nconst transmuteFeatheredHat = new TransmuteFeatheredHat();\r\nexport {\r\n  featheredHat as FeatheredHat,\r\n  transmuteFeatheredHat as TransmuteFeatheredHat,\r\n};\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass StoneMail extends EquippableItem {\r\n  getId(): string {\r\n    return \"stoneMail\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./stoneMail.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Stone Mail\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"Armor that is particularly protective, but with a drawback to mobility.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 700;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 28;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0.2;\r\n  }\r\n}\r\n\r\nconst stoneMail = new StoneMail();\r\n\r\nclass TransmuteStoneMail extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return stoneMail;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        EarthEssence: 3000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 15,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst transmuteStoneMail = new TransmuteStoneMail();\r\nexport { stoneMail as StoneMail, transmuteStoneMail as TransmuteStoneMail };\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass WizardsRobe extends EquippableItem {\r\n  getId(): string {\r\n    return \"wizardsRobe\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./wizardsRobe.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Wizard's Robe\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"Basic clothing for a wizard. Enhances spellcasting ability.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 500;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 10;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 6;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 500;\r\n  }\r\n}\r\n\r\nconst wizardsRobe = new WizardsRobe();\r\n\r\nclass TransmuteWizardsRobe extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return wizardsRobe;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        WaterEssence: 2500,\r\n      },\r\n      items: {\r\n        elementalShardWater: 10,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nconst transmuteWizardsRobe = new TransmuteWizardsRobe();\r\nexport {\r\n  wizardsRobe as WizardsRobe,\r\n  transmuteWizardsRobe as TransmuteWizardsRobe,\r\n};\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass Glaive extends EquippableItem {\r\n  getId(): string {\r\n    return \"glaive\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./glaive.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Glaive\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A fairly speedy weapon. It can attack from some distance.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 1300;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 45;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.2;\r\n  }\r\n}\r\n\r\nexport const glaive = new Glaive();\r\n\r\nclass TransmuteGlaive extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return glaive;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 12,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        AirEssence: 4200,\r\n        WaterEssence: 3500,\r\n      },\r\n      items: {\r\n        elementalShardAir: 35,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const transmuteGlaive = new TransmuteGlaive();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass BastardSword extends EquippableItem {\r\n  getId(): string {\r\n    return \"bastardSword\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./bastardSword.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Bastard Sword\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A sword that is much like a longsword, but slightly more elaborate.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 900;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 50;\r\n  }\r\n}\r\n\r\nconst bastardSword = new BastardSword();\r\n\r\nclass TransmuteBastardSword extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return bastardSword;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 10,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        EarthEssence: 4000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 25,\r\n        elementalShardFire: 4,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst transmuteBastardSword = new TransmuteBastardSword();\r\nexport { bastardSword, transmuteBastardSword };\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass BattleAxe extends EquippableItem {\r\n  getId(): string {\r\n    return \"battleAxe\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getExtraSlots(): EquipmentSlot[] {\r\n    return [EquipmentSlot.Accessory];\r\n  }\r\n  getPicture() {\r\n    return require(\"./battleAxe.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Battle Axe\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A large axe. Very strong, but difficult to swing.\");\r\n  }\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    return t(\"Extra large\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 900;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 95;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0.6;\r\n  }\r\n}\r\n\r\nconst battleAxe = new BattleAxe();\r\n\r\nclass TransmuteBattleAxe extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return battleAxe;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 11,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        FireEssence: 4000,\r\n      },\r\n      items: {\r\n        elementalShardFire: 20,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nconst transmuteBattleAxe = new TransmuteBattleAxe();\r\nexport { battleAxe as BattleAxe, transmuteBattleAxe as TransmuteBattleAxe };\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass HandAxe extends EquippableItem {\r\n  getId(): string {\r\n    return \"handAxe\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./handAxe.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Hand Axe\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A small axe, meant to be carried in one hand. Heavy and slow, but damaging.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 500;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 50;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0.5;\r\n  }\r\n}\r\n\r\nconst handAxe = new HandAxe();\r\n\r\nclass TransmuteHandAxe extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return handAxe;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        FireEssence: 1800,\r\n      },\r\n      items: {\r\n        elementalShardFire: 6,\r\n        elementalShardEarth: 2,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nconst transmuteHandAxe = new TransmuteHandAxe();\r\nexport { handAxe as HandAxe, transmuteHandAxe as TransmuteHandAxe };\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass WandOfWater extends EquippableItem {\r\n  getId(): string {\r\n    return \"wandOfWater\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./wandOfWater.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Wand of Water\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A magical wand with a special affinity for Water. Increases power of Water spells.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 1800;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 27;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 16;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 700;\r\n  }\r\n\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.15,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> power of Water elemental spells\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n        explanation: explanations.magnitude,\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const wandOfWater = new WandOfWater();\r\n\r\nregisterTransformation(\r\n  [\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.ActionMagnitude,\r\n      SpellElement.Water,\r\n    ],\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.TemporaryEffectMagnitude,\r\n      SpellElement.Water,\r\n    ],\r\n  ],\r\n  wandOfWater.getId(),\r\n  wandOfWater.getName(wandOfWater.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    getEquippedItem(state, EquipmentSlot.Hand)?.itemId == wandOfWater.getId()\r\n      ? wandOfWater.getEquippedItemEffect(state, \"magnitude\").magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nclass TransmuteWandOfWater extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return wandOfWater;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 14,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        WaterEssence: 5000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 65,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nexport const transmuteWandOfWater = new TransmuteWandOfWater();\r\n","import {\r\n  DungeonEventGroup,\r\n  getOrCreateDungeonEventGroup,\r\n} from \"../../events/DungeonEventGroup\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Identifiable } from \"../../generic/Identifiable\";\r\nimport { DungeonFloor } from \"./DungeonFloor\";\r\n\r\nexport abstract class Dungeon implements Identifiable {\r\n  abstract getId(): string;\r\n  abstract getName(): string;\r\n  abstract getDungeonFloors(): DungeonFloor[];\r\n  abstract isUnlocked(state: GameState): boolean;\r\n\r\n  getDungeonEventGroup(): DungeonEventGroup {\r\n    return getOrCreateDungeonEventGroup(this.getId());\r\n  }\r\n\r\n  hasTriggeredEvent(state: GameState): boolean {\r\n    const triggered =\r\n      this.getDungeonEventGroup().hasFinishedTriggeringThisRun(state);\r\n    return triggered;\r\n  }\r\n}\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  grantTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationType } from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass StrengthTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"strength\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Strength\");\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./strength.png\");\r\n  }\r\n\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [\r\n      { stat: CombatStat.Attack, type: TransformationType.Addition },\r\n      { stat: CombatStat.Attack, type: TransformationType.Multiplier },\r\n    ];\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    const attack = temporaryEffectData.params.commonBuff.Attack;\r\n    if (!attack) {\r\n      const attackRatio =\r\n        temporaryEffectData.params.commonBuff.AttackMultiplier;\r\n      return t(\"{{ratio}}:attack:\", {\r\n        ratio: formatMultiplier(attackRatio),\r\n      });\r\n    }\r\n    return t(\"+{{amount}}:attack:\", {\r\n      amount: formatNumber(attack),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new StrengthTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass Strength extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"strength\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Strength\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 650;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 8,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      duration: {\r\n        value: 60.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { commonBuff: { Attack: effects.magnitude } },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Increase your physical strength through a temporary enchantment.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{amount}}^<{{amountExplanation}}>:attack: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        amount: formatNumber(effects.magnitude),\r\n        amountExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 8 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 52 };\r\n  }\r\n}\r\n\r\nconst strength = new Strength();\r\n\r\nregisterEmpowerEffects(strength, [TransformationTags.Cost, Resource.Mana], 20);\r\nregisterEmpowerEffects(\r\n  strength,\r\n  [TransformationTags.TemporaryEffectMagnitude],\r\n  4,\r\n);\r\n\r\nexport { strength as Strength, temporaryEffect as StrengthTemporaryEffect };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { getCombatVariable, setCombatVariable } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { StrengthTemporaryEffect } from \"../../../spells/fire/Strength\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport { setDungeonFloorCompleted } from \"../../dungeons/Dungeons\";\r\nimport {\r\n  getCurrentEnemyHPFraction,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass BlazingTurtle extends Enemy {\r\n  getId(): string {\r\n    return \"blazingTurtle\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Blazing Turtle\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 700,\r\n      attack: 40,\r\n      defense: 32,\r\n      attackDelay: 6.0,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./blazingTurtle.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 4;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 55;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 5;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (\r\n      getCurrentEnemyHPFraction(state) < 0.5 &&\r\n      !getCombatVariable(state, \"hasUsedFireball\")\r\n    ) {\r\n      return {\r\n        name: t(\"Fireball\"),\r\n        delay: this.getAttackDelay(state) * 3.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 2.0,\r\n            {\r\n              tags: [SpellElement.Fire],\r\n            },\r\n          );\r\n          state = setCombatVariable(\"hasUsedFireball\", true)(state);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (\r\n      Math.random() < 0.2 &&\r\n      !hasTemporaryEffect(\r\n        state,\r\n        StrengthTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      )\r\n    ) {\r\n      return {\r\n        name: t(\"Strength\"),\r\n        delay: this.getAttackDelay(state) * 1.2,\r\n        transform: (state) =>\r\n          grantTemporaryEffect(StrengthTemporaryEffect.getId(), 30, {\r\n            target: AttackTarget.Enemy,\r\n            params: { commonBuff: { AttackMultiplier: 1.25 } },\r\n          })(state),\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 2,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = setDungeonFloorCompleted(state, \"trainingTowerWater\");\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"This guardian... It is literally a turtle in flames! Its attacks are extremely strong and easily pierce through any amount of defense, but they are very slow. It also has a fair amount of defense. Using effects that increase your maximum :hp: might be the best way to survive Fireball. But you will also need to have a good source of healing that you can repeat, because it does a lot of damage! A weapon with high :attack: might also be effective.\",\r\n    );\r\n  }\r\n}\r\n\r\nexport default new BlazingTurtle();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Cherry } from \"../../../items/equipment/pouch/Cherry\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { standardEnemyAttackEffect } from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass FireBat extends Enemy {\r\n  getId(): string {\r\n    return \"fireBat\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Fire Bat\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 60,\r\n      attack: 27,\r\n      defense: 8,\r\n      attackDelay: 4.5,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./fireBat.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 2;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 17;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 3;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (Math.random() < 0.25) {\r\n      return {\r\n        name: t(\"Burning Bite\"),\r\n        delay: this.getAttackDelay(state) * 2.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 1.5);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: Wildgrass.getId(),\r\n        amount: 1,\r\n        chance: 0.2,\r\n      },\r\n      {\r\n        itemId: Cherry.getId(),\r\n        amount: 1,\r\n        chance: 0.02,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default new FireBat();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Enemy } from \"../../enemies/Enemy\";\r\nimport BlazingTurtle from \"../../enemies/training/BlazingTurtle\";\r\nimport FireBat from \"../../enemies/training/FireBat\";\r\nimport Slime from \"../../enemies/training/Slime\";\r\nimport {\r\n  DungeonFloor,\r\n  encounterEnemy,\r\n  ExplorationPossibility,\r\n} from \"../DungeonFloor\";\r\n\r\nconst EXPLORATION_POSSIBILITIES = [\r\n  {\r\n    weight: 100,\r\n    transforms: encounterEnemy(Slime),\r\n  },\r\n  {\r\n    weight: 150,\r\n    transforms: encounterEnemy(FireBat),\r\n  },\r\n];\r\nclass TrainingTowerAir extends DungeonFloor {\r\n  getId(): string {\r\n    return \"trainingTowerWater\";\r\n  }\r\n  getFloorName(): string {\r\n    return t(\"Tower of Water Training\");\r\n  }\r\n  getBoss(state: GameState): Enemy {\r\n    return BlazingTurtle;\r\n  }\r\n  getBreedingLevel(): number {\r\n    return 1;\r\n  }\r\n  isMainStoryDungeonFloor(): boolean {\r\n    return true;\r\n  }\r\n  getExplorationRequiredTimeSecBase(): number {\r\n    return 4.0;\r\n  }\r\n  _getExplorationSuccessesForBossBase(): number {\r\n    return 30;\r\n  }\r\n  getBaseExplorationPossibilities(state: GameState): ExplorationPossibility[] {\r\n    return EXPLORATION_POSSIBILITIES;\r\n  }\r\n  isUnlocked(state: GameState): boolean {\r\n    return (\r\n      ![SpellElement.Earth, SpellElement.Fire, SpellElement.Air].includes(\r\n        state.run.primaryElement,\r\n      ) || hasFlag(state, Flag.RestOfTrainingUnlocked)\r\n    );\r\n  }\r\n}\r\n\r\nexport default new TrainingTowerAir();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { createChestEvent } from \"../../../events/autorandom/Chest\";\r\nimport { ExplorationTriggerGroup } from \"../../../events/autorandom/ExplorationTrigger\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { FeatheredHat } from \"../../../items/equipment/accessory/air/FeatheredHat\";\r\nimport { StoneMail } from \"../../../items/equipment/body/earth/StoneMail\";\r\nimport { WizardsRobe } from \"../../../items/equipment/body/water/WizardsRobe\";\r\nimport { glaive } from \"../../../items/equipment/hand/air/Glaive\";\r\nimport { bastardSword } from \"../../../items/equipment/hand/earth/BastardSword\";\r\nimport { BattleAxe } from \"../../../items/equipment/hand/fire/BattleAxe\";\r\nimport { HandAxe } from \"../../../items/equipment/hand/fire/HandAxe\";\r\nimport { wandOfWater } from \"../../../items/equipment/hand/water/WandOfWater\";\r\nimport { HealthPotion } from \"../../../items/equipment/pouch/HealthPotion\";\r\nimport Wildgrass from \"../../../items/material/Wildgrass\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Dungeon } from \"../Dungeon\";\r\nimport { DungeonFloor } from \"../DungeonFloor\";\r\nimport TrainingTowerAir from \"./TrainingTowerAir\";\r\nimport TrainingTowerEarth from \"./TrainingTowerEarth\";\r\nimport TrainingTowerFire from \"./TrainingTowerFire\";\r\nimport TrainingTowerWater from \"./TrainingTowerWater\";\r\n\r\nclass TrainingTowers extends Dungeon {\r\n  getId(): string {\r\n    return \"trainingTowers\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Training Towers\");\r\n  }\r\n\r\n  getDungeonFloors(): DungeonFloor[] {\r\n    return [\r\n      TrainingTowerFire,\r\n      TrainingTowerEarth,\r\n      TrainingTowerWater,\r\n      TrainingTowerAir,\r\n    ];\r\n  }\r\n\r\n  isUnlocked(state: GameState): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport const FLOOR_FOR_ELEMENT: Partial<Record<SpellElement, DungeonFloor>> = {\r\n  Fire: TrainingTowerFire,\r\n  Earth: TrainingTowerEarth,\r\n  Water: TrainingTowerWater,\r\n  Air: TrainingTowerAir,\r\n};\r\n\r\nexport const trainingTowers = new TrainingTowers();\r\n\r\nclass TrainingTowersExplorationGroup extends ExplorationTriggerGroup {\r\n  getHintMessageWhenPossible(): string {\r\n    return t(\"Explore the Training Towers\");\r\n  }\r\n  getHintMessageWhenNotPossible(): string {\r\n    return t(\r\n      \"This Storyline can be found by exploring the Training Towers, but you cannot get it this run\",\r\n    );\r\n  }\r\n  maxTriggersPerRun(): number {\r\n    return 2;\r\n  }\r\n  getId(): string {\r\n    return \"trainingTowers\";\r\n  }\r\n  getExplorationSuccessesBase(): number {\r\n    return 110;\r\n  }\r\n  getDungeonFloors(): DungeonFloor[] {\r\n    return trainingTowers.getDungeonFloors();\r\n  }\r\n}\r\n\r\nexport const trainingTowersExplorationGroup =\r\n  new TrainingTowersExplorationGroup();\r\n\r\nexport function loadTrainingTowerChests() {\r\n  createChestEvent(\r\n    \"trainingTowersChestCommon1\",\r\n    [\r\n      TrainingTowerFire.getId(),\r\n      TrainingTowerEarth.getId(),\r\n      TrainingTowerWater.getId(),\r\n      TrainingTowerAir.getId(),\r\n    ],\r\n    40,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: Wildgrass.getId(), params: {} },\r\n        amount: 10,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"trainingTowersChestUncommon2\",\r\n    [\r\n      TrainingTowerFire.getId(),\r\n      TrainingTowerEarth.getId(),\r\n      TrainingTowerWater.getId(),\r\n      TrainingTowerAir.getId(),\r\n    ],\r\n    10,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: HealthPotion.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"fireTrainingTowersChestUncommon\",\r\n    [TrainingTowerFire.getId()],\r\n    18,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: HandAxe.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"fireTrainingTowersChestRare\",\r\n    [TrainingTowerFire.getId()],\r\n    9,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: BattleAxe.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"earthTrainingTowersChestUncommon\",\r\n    [TrainingTowerEarth.getId()],\r\n    18,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: StoneMail.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"earthTrainingTowersChestRare\",\r\n    [TrainingTowerEarth.getId()],\r\n    10,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: bastardSword.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"waterTrainingTowersChestUncommon\",\r\n    [TrainingTowerWater.getId()],\r\n    15,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: WizardsRobe.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"waterTrainingTowersChestRare\",\r\n    [TrainingTowerWater.getId()],\r\n    5,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: wandOfWater.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"airTrainingTowersChestUncommon\",\r\n    [TrainingTowerAir.getId()],\r\n    12,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: FeatheredHat.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"airTrainingTowersChestRare\",\r\n    [TrainingTowerAir.getId()],\r\n    6,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: glaive.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Achievement } from \"../../../Achievement\";\r\nimport { registerAchievementUnlockerFromEnemy } from \"../../../Achievements\";\r\nimport { jumpEventToMessageIfExists } from \"../../../events/Events\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { setFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Chilled } from \"../../../temporaryeffects/Chilled\";\r\nimport {\r\n  getTemporaryEffectEndTime,\r\n  grantTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../../temporaryeffects/Wet\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport {\r\n  getCurrentEnemyHPFraction,\r\n  modifyEnemyCurrentHP,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { pushCombatActionResult } from \"../../ExplorationActionResult\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass HeadInstructor extends Enemy {\r\n  getId(): string {\r\n    return \"headInstructor\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Head Instructor Giselle\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 1800,\r\n      attack: 30,\r\n      defense: 25,\r\n      attackDelay: 2.5,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./headInstructor.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 10;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 150;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 50;\r\n  }\r\n\r\n  getNextAction2(state: GameState): BattlerAction {\r\n    if (Math.random() < 0.2) {\r\n      return {\r\n        name: t(\"Fireball\"),\r\n        delay: this.getAttackDelay(state) * 2.0,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 2.5,\r\n            {\r\n              tags: [SpellElement.Fire],\r\n            },\r\n          );\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    if (Math.random() < 0.5) {\r\n      return {\r\n        name: t(\"Air Blast\"),\r\n        delay: this.getAttackDelay(state) * 0.35,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 0.5,\r\n            {\r\n              tags: [SpellElement.Air],\r\n            },\r\n          );\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    // Strategy:\r\n    // First half is similar to the Animated Snowman\r\n    // Second half is similar to the Blazing Turtle\r\n    if (getCurrentEnemyHPFraction(state) < 0.5) {\r\n      return this.getNextAction2(state);\r\n    }\r\n\r\n    if (\r\n      Math.random() < 0.2 &&\r\n      getTemporaryEffectEndTime(state, Wet.getId(), AttackTarget.Player) -\r\n        getSecondsPlayed(state) >\r\n        5\r\n    ) {\r\n      return {\r\n        name: t(\"Frost\"),\r\n        delay: this.getAttackDelay(state) * 1.4,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.4,\r\n            {\r\n              tags: [SpellElement.Water],\r\n              onHit: (state, result) => {\r\n                if (result.isHit) {\r\n                  state = grantTemporaryEffect(Chilled.getId(), 15, {\r\n                    target: result.target,\r\n                  })(state);\r\n                }\r\n                return state;\r\n              },\r\n            },\r\n          );\r\n\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.2) {\r\n      return {\r\n        name: t(\"Splash\"),\r\n        delay: this.getAttackDelay(state) * 1.2,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(\r\n            state,\r\n            this.getAttack(state) * 1.1,\r\n            {\r\n              tags: [SpellElement.Water],\r\n              onHit: (state, result) => {\r\n                if (result.isHit) {\r\n                  state = grantTemporaryEffect(Wet.getId(), 15, {\r\n                    target: result.target,\r\n                  })(state);\r\n                }\r\n                return state;\r\n              },\r\n            },\r\n          );\r\n\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n    if (Math.random() < 0.3 && getCurrentEnemyHPFraction(state) < 0.9) {\r\n      return {\r\n        name: t(\"Droplet of Healing\"),\r\n        delay: this.getAttackDelay(state) * 1.0,\r\n        transform: (state) => {\r\n          const healAmt = this.getMaxHP(state) * (0.02 + Math.random() * 0.005);\r\n          state = modifyEnemyCurrentHP(state, healAmt);\r\n          const actionResult = {\r\n            id: Math.random().toString(),\r\n            damage: -healAmt,\r\n            isCrit: false,\r\n            isHit: true,\r\n            time: getSecondsPlayed(state),\r\n            source: AttackTarget.Enemy,\r\n            target: AttackTarget.Enemy,\r\n            tags: [],\r\n          };\r\n          state = pushCombatActionResult(state, actionResult);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getBackdropColor(): string {\r\n    return \"#fd7\";\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [\r\n      {\r\n        itemId: \"paper\",\r\n        amount: 3,\r\n        chance: 1.0,\r\n      },\r\n    ];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = jumpEventToMessageIfExists(state, \"finalTraining\", \"afterFight\");\r\n    state = setFlag(Flag.HeadInstructorDefeated)(state);\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"Ah, the Head Instructor of Combat! She is proficient in Water, Air and Fire spells, making her quite the force to be reckoned with. She will begin with Water spells only, and follow through with Fire and Air spells. Let's make sure to have solid buffs, such as from potions or spells, before the battle. Don't forget to ask me - well, us, your hired Wizards - to keep up your buffs for you, so you can focus on fighting!\",\r\n    );\r\n  }\r\n}\r\n\r\nconst headInstructor = new HeadInstructor();\r\n\r\nregisterAchievementUnlockerFromEnemy(\r\n  headInstructor,\r\n  Achievement.HEAD_INSTRUCTOR_GISELLE,\r\n);\r\n\r\nexport default headInstructor;\r\n","import { loadPreTrainingProgression } from \"./PreTrainingProgression\";\r\nimport { loadSewersProgression } from \"./SewersProgression\";\r\nimport { loadTrainingTowerProgression } from \"./TrainingTowerProgression\";\r\n\r\nexport function loadProgressionEventsDemo() {\r\n  loadPreTrainingProgression();\r\n  loadTrainingTowerProgression();\r\n  loadSewersProgression();\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { isDungeonFloorCompletedThisRun } from \"../../exploration/dungeons/Dungeons\";\r\nimport TrainingTowerAir from \"../../exploration/dungeons/training/TrainingTowerAir\";\r\nimport TrainingTowerEarth from \"../../exploration/dungeons/training/TrainingTowerEarth\";\r\nimport TrainingTowerFire from \"../../exploration/dungeons/training/TrainingTowerFire\";\r\nimport { FLOOR_FOR_ELEMENT } from \"../../exploration/dungeons/training/TrainingTowers\";\r\nimport TrainingTowerWater from \"../../exploration/dungeons/training/TrainingTowerWater\";\r\nimport HeadInstructor from \"../../exploration/enemies/training/HeadInstructor\";\r\nimport {\r\n  addEnemyDeathListener,\r\n  startCombat,\r\n} from \"../../exploration/Exploration\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag, setFlag } from \"../../Flags\";\r\nimport { addUICommand } from \"../../UICommands\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\n\r\nexport function loadTrainingTowerProgression() {\r\n  const firstBossUnlockedEventBuilder = buildEvent(\r\n    \"firstBossUnlocker\",\r\n    t(\"One More Test\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  firstBossUnlockedEventBuilder.message(\r\n    t(`You have made a lot of progress fighting enemies left and right in this combat training. You feel quite strong!\r\n    \r\nYou encounter a door, more ornately decorated than the rest. It appears you are at the top of the tower. A sign reads to the side: *\"/enemyName/\"*. You sense this is probably some sort of final test for the tower, and ready up for a tough battle...\r\n\r\n**You can now fight the boss of /dungeonFloorName/! You can do so by pressing the \"Fight Boss\" button in the Exploration screen.**\"`),\r\n  );\r\n  const firstBossUnlockedEvent = firstBossUnlockedEventBuilder.build();\r\n\r\n  addEnemyDeathListener(\r\n    firstBossUnlockedEvent.getId() + \"Triggerer\",\r\n    (state) => {\r\n      if (!state.run.primaryElement) {\r\n        return state;\r\n      }\r\n      const floor = FLOOR_FOR_ELEMENT[state.run.primaryElement];\r\n\r\n      if (\r\n        !firstBossUnlockedEvent.hasTriggered(state) &&\r\n        floor?.canFightBoss?.(state) &&\r\n        !isDungeonFloorCompletedThisRun(state, floor)\r\n      ) {\r\n        return triggerEvent(firstBossUnlockedEvent, {\r\n          dungeonFloorName: floor.getFloorName(),\r\n          enemyName: floor.getBoss(state).getName(),\r\n        })(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  const restOfTrainingTowersUnlockerEventBuilder = buildEvent(\r\n    \"restOfTrainingTowersUnlocker\",\r\n    t(\"Training is Not Over\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.RestOfTrainingUnlocked));\r\n\r\n  restOfTrainingTowersUnlockerEventBuilder.message(\r\n    t(`You fell the enemy after what felt like a longer battle than the others. It felt slightly challenging. More than that, however, you feel excited and exhilarated - you seem to enjoy combat much more than you thought you would!\r\n  \r\nIt appears that is not enough. You find a paper in this last room, which mentions that there are other training towers, meant for those who specialize in the other elements - but a true Wizard should be able to triumph over all of them, it says. You decide to take it up to the challenge - you could use some more difficult combat...\r\n\r\n**You have unlocked three more Training Towers in Exploration!**`),\r\n  );\r\n\r\n  const restOfTrainingTowersUnlockerEvent =\r\n    restOfTrainingTowersUnlockerEventBuilder.build();\r\n\r\n  addEnemyDeathListener(\r\n    restOfTrainingTowersUnlockerEvent.getId() + \"Triggerer\",\r\n    (state) => {\r\n      const floor = FLOOR_FOR_ELEMENT[state.run.primaryElement];\r\n      if (floor == null) {\r\n        return state;\r\n      }\r\n      if (\r\n        !restOfTrainingTowersUnlockerEvent.hasTriggered(state) &&\r\n        !hasFlag(state, Flag.RestOfTrainingUnlocked) &&\r\n        isDungeonFloorCompletedThisRun(state, floor)\r\n      ) {\r\n        return triggerEvent(restOfTrainingTowersUnlockerEvent)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  const finalTrainingEventBuilder = buildEvent(\r\n    \"finalTraining\",\r\n    t(\"Final Exam\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  finalTrainingEventBuilder.message(\r\n    t(\r\n      `As you defeat the strongest enemy of the last Training Tower, you hear clapping from behind you. You turn around, and you see a stylish woman, dressed in white robes and holding a staff with her arm against her body. She appears to be a capable wizard. She is the one clapping at you.`,\r\n    ),\r\n  );\r\n  finalTrainingEventBuilder.message(\r\n    t(`\"Congratulations on your victory\", she exclaims. \"You've certainly come a long way, haven't you?\"\r\n    \r\n\"Let me introduce myself\", she continues. \"I am the head instructor of combat - my name is Giselle. I am the one who extended you the invitation for this extra training course at these four Towers of Training. I don't think you have noticed me, but I saw you at the top of each of the Towers - and noticed your fights against the four guardians at the top. You did an excellent job.\" You thank her for the kind words.`),\r\n  );\r\n  finalTrainingEventBuilder.message(\r\n    t(`\"You have yet one more challenge to go through before you can complete the training, however\", she says. \"Each of those Towers tested your ability and affinity with a different Element. But, in actual combat against real adversaries, a Wizard will need to know the strengths and the weakness of each element, and combine them in order to craft the right strategy. It is a very important lesson.\"\r\n    \r\nThen she tells you more: \"Because of that reason, I will see how you do in battle by myself, in a duel. If you are able to hold your own against me, I will deem you worthy of having finished the training.\"`),\r\n  );\r\n  finalTrainingEventBuilder\r\n    .message(\r\n      t(`You shudder a little. She looks quite strong, a lot stronger than anything you've fought so far.\r\n    \r\nRegardless, it really does seem like this is the final test in this special course. You ready yourself for combat against the powerful foe.`),\r\n    )\r\n    .option(t(\"Fight the Head Instructor\"), {\r\n      transform: (state) => {\r\n        state = addUICommand(state, \"goToExploration\");\r\n        state = addUICommand(state, \"closeAllMenus\");\r\n        state = addUICommand(state, \"closeEventOverlay\");\r\n        state = startCombat(HeadInstructor)(state);\r\n        return state;\r\n      },\r\n    })\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  finalTrainingEventBuilder\r\n    .message(\r\n      t(`Another Fireball? You strike at the Head Instructor before she has the chance to finish her spell. She flinches! She asks you to stop. Then she looks at you - she looks quite visibly tired - and nods.\r\n      \r\n\"*You pass*\", she exclaims. \"Impressive performance. You have definitely understood how to combine all the elements together and become a strong all-around combatant.\" You thank her.`),\r\n    )\r\n    .tag(\"afterFight\");\r\n\r\n  finalTrainingEventBuilder.message(\r\n    t(`\"With what you've learned in this special training, you should now be ready for some of the challenges in the wide world outside\", she says. \"I am hoping the experience you got has increased your confidence.\" She is right. You feel a lot stronger.\r\n        \r\n\"I will leave you with one last thing, however - have you ever wondered what to do with the :monstium:Monstium that you have been finding from all those enemies?\"\r\n\r\nThe question stumps you. You have, indeed, wondered what was the purpose, and you have been keeping much of it...`),\r\n  );\r\n\r\n  finalTrainingEventBuilder\r\n    .message(\r\n      t(`\"Monstium is a key material used for *Enhancements*, medium-to-long-term all-encompassing magical effects that radically affect so many different things\", she explains. \"For example, there are Enhancements for greatly increasing your Essence storage, giving you extra combat power, enabling you to build new types of furniture, and many more.\"\r\n     \r\nShe also tells you about Paper, another important requirement for Enhancements. Thankfully, Paper can apparently be transmuted quite easily - she also tells you how to do so.\r\n\r\nShe tells you about a few Enhancements and what you need in order to activate them. You listen intently, while realizing how deeply transformative those Enhancements could be. You want to take notes, but you did not bring such material with you - but you think you can remember, at least this time.`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      { transform: setFlag(Flag.EnhancementsUnlocked) },\r\n      \"end\",\r\n    )\r\n    .end();\r\n\r\n  finalTrainingEventBuilder\r\n    .message(\r\n      t(`The instructor finally finishes her narration. You thank her - you are certain this will come in useful for the future. And then, finally, you head back home - you can't wait to apply those Enhancements, and head beyond the boundaries of your house, to see what you can learn... You are not sure if this gets you any closer, but you feel renewed enthusiasm about your quest to obtain the Philosopher's Stone.\r\n    \r\n**You have unlocked the ability to transmute Paper!**\r\n\r\n**You have unlocked Enhancements! Enhancements use :monstium:Monstium, as well as other items, to improve many aspects of the game. The effects do *not* persist through Retirement. You can find these on the Enhance screen!**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const finalTrainingEvent = finalTrainingEventBuilder.build();\r\n\r\n  addEnemyDeathListener(finalTrainingEvent.getId() + \"Triggerer\", (state) => {\r\n    if (\r\n      !hasFlag(state, Flag.EnhancementsUnlocked) &&\r\n      !finalTrainingEvent.hasTriggered(state) &&\r\n      [\r\n        TrainingTowerFire,\r\n        TrainingTowerEarth,\r\n        TrainingTowerWater,\r\n        TrainingTowerAir,\r\n      ].every((floor) => isDungeonFloorCompletedThisRun(state, floor))\r\n    ) {\r\n      return triggerEvent(finalTrainingEvent)(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { CombatClassesStoryline } from \"../../classes/CombatClassesStoryline\";\r\nimport { isDungeonFloorCompletedThisRun } from \"../../exploration/dungeons/Dungeons\";\r\nimport SewerEntrance from \"../../exploration/dungeons/sewers/SewerEntrance\";\r\nimport SewerHazardousSector from \"../../exploration/dungeons/sewers/SewerHazardousSector\";\r\nimport SewerHideout from \"../../exploration/dungeons/sewers/SewerHideout\";\r\nimport { addEnemyDeathListener } from \"../../exploration/Exploration\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag, setFlag, SetFlagListeners } from \"../../Flags\";\r\nimport {\r\n  getUnlockedElements,\r\n  partiallyUnlockElement,\r\n  SpellElement,\r\n} from \"../../spells/Elements\";\r\nimport { buildEvent } from \"../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../Events\";\r\nimport { EventTag } from \"../GameEvent\";\r\n\r\nexport function loadSewersProgression() {\r\n  const sewersUnlockEventBuilder = buildEvent(\r\n    \"sewersUnlock\",\r\n    t(\"A Stinky Adventure\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  sewersUnlockEventBuilder.message(\r\n    t(`With your combat abilities, you now feel ready to begin your actual search for the Philosopher's Stone. You start thinking about what should be the next area you should be heading to, when you hear a knock on your door.\r\n  \r\nWhen you check, there is no one... Oddly, you open the door, and you notice a pamphlet on the ground. \"*Wanted: Mad Alchemist*\", it says, with a crude drawing of a deformed person. You take it, and show it to your hired wizard.`),\r\n  );\r\n  sewersUnlockEventBuilder\r\n    .message(\r\n      t(`\"A wanted poster? We get several of those, fairly often, at the guild\", she mentions. \"It looks like this one references a nefarious alchemist that seems to be running experiments somewhere in the town sewers. It appears the wells in some places in town have become poisoned, and the town suspects this alchemist.\"\r\n  \r\nThen something she says catches your attention: \"It says here that the experiments have something to do with creating a Philosopher's Stone...\" *Your blood freezes.* You ask her to repeat and confirm the fact. She is not lying to you: that is what it says on the paper.`),\r\n    )\r\n    .option(t(\"Continue\"), { transform: setFlag(Flag.SewersUnlocked) }, \"end\");\r\n  sewersUnlockEventBuilder\r\n    .message(\r\n      t(`It surely can't be... out of all the places in the world where you could be starting your search, the *sewers* are your first lead?\r\n  \r\nYour hired wizard seems to have noticed your reaction, and makes a face of disgust. \"You can't possibly be thinking of *going in there*, can you?\"\r\n\r\nBut you are... you certainly are. Or so you tell yourself, conflicted, as you try to convince yourself that your loved one's illness was much worse than *just a stench*...\r\n\r\n**You can now explore the Sewers!**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const sewersUnlockEvent = sewersUnlockEventBuilder.build();\r\n\r\n  SetFlagListeners.register((state, flag) => {\r\n    if (\r\n      ((flag == Flag.EnhancementsUnlocked &&\r\n        CombatClassesStoryline.isCompleted(state)) ||\r\n        flag == CombatClassesStoryline.getCompletedFlag()) &&\r\n      !hasFlag(state, Flag.SewersUnlocked) &&\r\n      !sewersUnlockEvent.hasTriggered(state)\r\n    ) {\r\n      return triggerEvent(sewersUnlockEvent)(state);\r\n    }\r\n    return state;\r\n  }, \"sewersUnlockEventTriggerer\");\r\n\r\n  const sewersEntranceBossUnlockEventBuilder = buildEvent(\r\n    \"sewersEntranceBossUnlock\",\r\n    t(\"A Challenger from the Deep?\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  sewersEntranceBossUnlockEventBuilder.message(\r\n    t(`While exploring, you find a large circular room filled with shallow water and a tunnel entrance on the other side. Your hired wizard comments: \"I think all paths end up coming here\".\r\n  \r\nAs you begin crossing, you are stopped on your tracks. There is something in the water. It looks a little like a Sewer Fish, but it is green and deformed - and very aggressive, moving faster than what you are used to. You ready for combat.\r\n\r\n**You have unlocked the boss of Sewer Entrance!**`),\r\n  );\r\n\r\n  const sewersEntranceBossUnlockEvent =\r\n    sewersEntranceBossUnlockEventBuilder.build();\r\n\r\n  addEnemyDeathListener(\r\n    sewersEntranceBossUnlockEvent.getId() + \"Triggerer\",\r\n    (state) => {\r\n      if (\r\n        !sewersEntranceBossUnlockEvent.hasTriggered(state) &&\r\n        SewerEntrance.canFightBoss(state)\r\n      ) {\r\n        return triggerEvent(sewersEntranceBossUnlockEvent)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  const sewersEntranceBossDefeatedMainEventBuilder = buildEvent(\r\n    \"sewersEntranceBossDefeatedMain\",\r\n    t(\"Mimicking the Poison\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger((state) => {\r\n    state = partiallyUnlockElement(SpellElement.Poison)(state);\r\n    return state;\r\n  });\r\n\r\n  sewersEntranceBossDefeatedMainEventBuilder.message(\r\n    t(`You defeat the Mutated Fish! Your hired wizard yells from the thrill. You check the floating corpse one last time to make sure it is truly dead. Although you can move on, you are noticing that the sewer enemies seem to be able to use a different type of magic entirely. A different *element*, perhaps? You are not sure about it, but you want to try and mimic it.\r\n\r\n**You have discovered the \"Poison\" element! It is only *partially unlocked*, so it will not persist through retirement, and you will have a very hard time using it.**\r\n\r\n**You can now also access a new Exploration area: \"Hazardous Sector\"!**`),\r\n  );\r\n\r\n  const sewersEntranceBossDefeatedMainEvent =\r\n    sewersEntranceBossDefeatedMainEventBuilder.build();\r\n\r\n  const sewersEntranceBossDefeatedAltEventBuilder = buildEvent(\r\n    \"sewersEntranceBossDefeatedAlt\",\r\n    t(\"Hazardous Sector\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  sewersEntranceBossDefeatedAltEventBuilder.message(\r\n    t(`You defeat the Mutated Fish! Your hired wizard yells from the thrill. You check the floating corpse one last time to make sure it is truly dead, and after doing so, move on past it to the next area of the Sewers.\r\n\r\n**You can now also access a new Exploration area: \"Hazardous Sector\"!**`),\r\n  );\r\n\r\n  const sewersEntranceBossDefeatedAltEvent =\r\n    sewersEntranceBossDefeatedAltEventBuilder.build();\r\n\r\n  addEnemyDeathListener(\r\n    sewersEntranceBossDefeatedMainEvent.getId() + \"Triggerer\",\r\n    (state) => {\r\n      if (\r\n        !sewersEntranceBossDefeatedAltEvent.hasTriggered(state) &&\r\n        !sewersEntranceBossDefeatedMainEvent.hasTriggered(state) &&\r\n        isDungeonFloorCompletedThisRun(state, SewerEntrance)\r\n      ) {\r\n        if (getUnlockedElements(state).includes(SpellElement.Poison)) {\r\n          return triggerEvent(sewersEntranceBossDefeatedAltEvent)(state);\r\n        } else {\r\n          return triggerEvent(sewersEntranceBossDefeatedMainEvent)(state);\r\n        }\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  const hazardousSectorBossDefeatedMainEventBuilder = buildEvent(\r\n    \"hazardousSectorBossDefeatedMain\",\r\n    t(\"Hoarding Monstium\"),\r\n    [EventTag.MAIN_QUEST],\r\n  ).setOnTrigger(setFlag(Flag.MonstruariumsUnlocked));\r\n\r\n  hazardousSectorBossDefeatedMainEventBuilder.message(\r\n    t(`The Sludge Mass is finally no more! You still feel somewhat sick; you try and catch your breath in the corner of the room, waiting until it gets better. You notice it left behind a big pile of :monstium:, and wonder - it would be great if you could store more of this resource. You then realize that perhaps there could be a way to have a storage, similarly to how this enemy did it - leveraging Poison (or :poisonessence:) to hold it together...\r\n\r\n**You can now build Monstruariums, a new furniture that allows you to store more :monstium:!**\r\n\r\n**You can now also access a new Exploration area: \"The Hideout\"!**`),\r\n  );\r\n\r\n  const hazardousSectorBossDefeatedMainEvent =\r\n    hazardousSectorBossDefeatedMainEventBuilder.build();\r\n\r\n  addEnemyDeathListener(\r\n    hazardousSectorBossDefeatedMainEvent.getId() + \"Triggerer\",\r\n    (state) => {\r\n      if (\r\n        !hasFlag(state, Flag.MonstruariumsUnlocked) &&\r\n        !hazardousSectorBossDefeatedMainEvent.hasTriggered(state) &&\r\n        isDungeonFloorCompletedThisRun(state, SewerHazardousSector)\r\n      ) {\r\n        return triggerEvent(hazardousSectorBossDefeatedMainEvent)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  const sewersHideoutBossUnlockEventBuilder = buildEvent(\r\n    \"sewersHideoutBossUnlock\",\r\n    t(\"Carnivorous Guardian\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  sewersHideoutBossUnlockEventBuilder.message(\r\n    t(`The Sewers have gotten deeper and deeper, and more dangerous. You are certain that by now, you must have explored almost every corner, but you haven't found the wanted alchemist just yet.\r\n    \r\nIn what you feel is the last tunnel, you see a door. It appears to have been used recently, and you spot a light from the other side. But something is right in front of the door. There is a pile of... waste, and a giant Man-Eating Plant growing right on top of it. It takes notice of you and makes an awful sound - and it looks extremely dangerous. You are afraid, but you know you're going to have to get past it to get to that door. You get ready for a very tough battle...\r\n\r\n**You have unlocked the boss of The Hideout!**`),\r\n  );\r\n\r\n  const sewersHideoutBossUnlockEvent =\r\n    sewersHideoutBossUnlockEventBuilder.build();\r\n\r\n  addEnemyDeathListener(\r\n    sewersHideoutBossUnlockEvent.getId() + \"Triggerer\",\r\n    (state) => {\r\n      if (\r\n        !sewersHideoutBossUnlockEvent.hasTriggered(state) &&\r\n        SewerHideout.canFightBoss(state)\r\n      ) {\r\n        return triggerEvent(sewersHideoutBossUnlockEvent)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  const sewersCompletedEventBuilder = buildEvent(\r\n    \"sewersCompleted\",\r\n    t(\"The Mad Alchemist\"),\r\n    [EventTag.MAIN_QUEST],\r\n  );\r\n\r\n  sewersCompletedEventBuilder.message(\r\n    t(`Frantically moving left and right to try and avoid the multiple incoming attacks from each of the three heads, you deal one more blow in the tough fight. The plant gets pushed back and stops moving. Tricked twice already, you brace yourself, low in supplies, for a fourth head to pop up - but this time, it doesn't appear. You must have succeeded!\r\n    \r\nYour hired wizard jumps cheerfully and high-fives you. You are glad the fight is over - it was very difficult!\r\n\r\nWith the Man-Eating Plant out of the way, the door is now reachable. Inside must be the person you have been looking for all this time: the wanted \"Mad Alchemist\".`),\r\n  );\r\n\r\n  sewersCompletedEventBuilder.message(\r\n    t(`\"Is someone there?\" The coarse voice comes from inside. \"Come in.\"\r\n    \r\nYour hired wizard and you hesitantly enter. On the other side of the door is a room that is fancied like a study, or a lab perhaps - shelves full of potions and substances of various colors, several books, and a large desk in the center with flasks and other glass containers. On the other side of the desk is the so-called \"Mad Alchemist\": a man in their later years, with grey curly hair, a furrowed brow, and a peculiar scent.`),\r\n  );\r\n\r\n  sewersCompletedEventBuilder.message(\r\n    t(`Your hired wizard begins talking: \"Are you the one who has been poisoning...\" You interrupt her. The reason you are here is not to apprehend the wanted man, even though it is possible that he has been running potentially harmful experiments in these sewers. Instead, you ask him about what has been in your mind all this time: the *Philosopher's Stone*.\r\n    \r\n\"The Philosopher's Stone...\" He begins to talk, and closes his eyes. \"Do you really think I would be living here, in seclusion, away from people, if I had such an object?\"\r\n\r\n\"The answer is obvious, but... no, I don't have a Philosopher's Stone.\"`),\r\n  );\r\n\r\n  sewersCompletedEventBuilder.message(\r\n    t(\r\n      `He continues to talk. \"The Philosopher's Stone is the ultimate aspiration of any alchemist. It is only spoken of in legends, and as far as I know, nobody has been able to create such an item. But, what they say in the city is true: I have been trying, for many years, to create one, and yet - have not had any success.\"\r\n      \r\nYou ask him for more details. He readily gives out an answer, but it is not exactly what you are looking for: \"The Ancient Legends speak of a Philosopher's Stone that was given to the leader of Zeth, an ancient kingdom that used to be somewhere in the Vast Desert. Shortly after, the kingdom fell to unknown ruin. Nobody really knows what happened.\"`,\r\n    ),\r\n  );\r\n\r\n  sewersCompletedEventBuilder.message(\r\n    t(`He continues: \"I have also considered exploring the Vast Desert, but... I am old, as you see, and quite frail now... not ready for the physical toughness and combat prowess that are needed there.\" He lets out a small sigh.\r\n    \r\nYou symphatize with him. You do not know his motivation for the Philosopher's Stone, but you can tell he does not have many more years left to live.`),\r\n  );\r\n\r\n  sewersCompletedEventBuilder\r\n    .message(\r\n      t(`You close your eyes for a while. The Vast Desert... The place is actually quite close. You've heard it is quite dangerous, and have always been discouraged to step in there. The desert extends as far out as the eye can see, and there is no clear path. It is easy to get lost, and the conditions can be fairly extreme to endure.\r\n    \r\nYou feel a renewed urge to search it. If the legends are true, you are bound to find clues about the Philosopher's Stone there. Or maybe even find the object itself...?\r\n\r\nYou tell the Alchemist this much, and he offers you a map of the Desert. But with one condition: to not turn him in to the authorities for what he has done. Without thinking, you accept, getting a stern look from your hired wizard, and take the map.`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      { transform: setFlag(Flag.VastDesertUnlocked) },\r\n      \"end\",\r\n    )\r\n    .end();\r\n\r\n  sewersCompletedEventBuilder\r\n    .message(\r\n      t(`As you receive the map, you thank the old man - though, you do ask him to try to be careful with the city's water supply.\r\n    \r\nAnd finally, you turn back and head out. You are ready to trip through the Vast Desert. You ask the hired wizard to follow you, and she replies enthusiastically: \"Of course!\" But she quickly adds to it, wrinkling her nose: \"But only after taking a bath...\"\r\n\r\n**You can now explore the Vast Desert!**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const sewersCompletedEvent = sewersCompletedEventBuilder.build();\r\n\r\n  addEnemyDeathListener(sewersCompletedEvent.getId() + \"Triggerer\", (state) => {\r\n    if (\r\n      !sewersCompletedEvent.hasTriggered(state) &&\r\n      isDungeonFloorCompletedThisRun(state, SewerHideout)\r\n    ) {\r\n      return triggerEvent(sewersCompletedEvent)(state);\r\n    }\r\n    return state;\r\n  });\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Items } from \"../../../items/Items\";\r\nimport { ItemTagEnum } from \"../../../items/ItemTagEnum\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { registerRandomEventTrigger } from \"../../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nexport const varietyCollectorStoryline = new Storyline(\r\n  \"varietyCollector\",\r\n  t(\"Variety Collector\"),\r\n  380,\r\n  20,\r\n  t(\r\n    \"Reach at least Lv25 on your primary Element and hold at least 3 different Accessories in your inventory. Then, it may happen as a random event\",\r\n  ),\r\n  t(\"Extra Accessory slot\"),\r\n  (state) => true,\r\n);\r\n\r\nexport function loadVarietyCollector() {\r\n  Storylines.register(varietyCollectorStoryline);\r\n  const varietyCollectorEventBuilder = buildEvent(\r\n    \"varietyCollector\",\r\n    t(\"(Storyline) Variety Collector\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(varietyCollectorStoryline.getId());\r\n\r\n  varietyCollectorEventBuilder.message(\r\n    t(\r\n      `Your skill with magic continues to increase! Little by little, you begin getting more confidence in your skills.\r\n      \r\nFocused as you are, however, you are startled when your hired wizard calls for your attention. You glance at her. She is holding her hand up, and you notice the obvious: she is wearing a different ring on each finger!`,\r\n    ),\r\n  );\r\n  varietyCollectorEventBuilder.message(\r\n    t(\r\n      `\"Psst\", she exclaims. \"Accessories are really neat! Why don't you make more of them? I'd love to see a big *collection* of them.\"\r\n        \r\nYou interject. Why collect accessories? You feel it's just clutter. But she continues:\r\n\r\n\"Come on... I'd really like to try them all out! And besides... I know *something* you don't. What if I tell you what that is - if you make enough of them?\"`,\r\n    ),\r\n  );\r\n  varietyCollectorEventBuilder\r\n    .message(\r\n      t(\r\n        `Something you don't know...? You get the feeling she is pulling your leg.\r\n        \r\nShould you really bother?`,\r\n      ),\r\n    )\r\n    .option(\r\n      t(\r\n        \"Show her a collection of accessories (Requires 15 different Accessories)\",\r\n      ),\r\n      {\r\n        transform: (state) => {\r\n          return state;\r\n        },\r\n        isEnabled: (state: GameState, params) => {\r\n          return (\r\n            state.run.inventory.filter((itemStack) =>\r\n              Items.getById(itemStack.itemOccurrence.itemId)\r\n                .getTags()\r\n                .includes(ItemTagEnum.Accessory),\r\n            ).length >= 15\r\n          );\r\n        },\r\n      },\r\n      \"end\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n  varietyCollectorEventBuilder\r\n    .message(\r\n      t(\r\n        `You bring a box up to her and open it. Inside is a large, crowded set of Accessories of all kinds. Your hired wizard looks at it: she appears surprised!\r\n        \r\nYou explain to her that you had to leverage knowledge from *every Element* to be able to create such a diverse, varied collection. She better tell you now...`,\r\n      ),\r\n    )\r\n\r\n    .tag(\"end\");\r\n  varietyCollectorEventBuilder\r\n    .message(\r\n      t(`\"Oh, of course!\" She grabs two accessories from the box, and puts them on. You stare at her, confused. Then she simply says:\r\n\r\n\"You can equip *two* accessories at once!\"\r\n\r\n...What? All that work... and *that* is what she had to say?\r\n\r\n\"It's a critical skill! I haven't seen you doing it even once!\"`),\r\n    )\r\n    .option(t(\"Continue\"), {\r\n      transform: (state) => varietyCollectorStoryline.complete(state),\r\n    });\r\n  varietyCollectorEventBuilder\r\n    .message(\r\n      t(`You begin explaining your reasoning for it. About the modern style of wizards. How it is entirely out of fashion to do so. She does not seem to be paying attention. Instead, *she grabs your diary - without permission - and writes some scribble on it!*\r\n\r\n\"I'm doing you a favor! Don't be so thick-skulled!\"\r\n\r\nYou decide to just ignore her...\r\n  \r\n**You have completed the \"Variety Collector\" Storyline! Unfortunately, you refuse to change your ways... but in future retirements, your hired wizard's scribbles will grant you awareness - you will be able to equip a second accessory, as long as both of them are different!**`),\r\n    )\r\n    .end();\r\n\r\n  const varietyCollectorEvent = varietyCollectorEventBuilder.build();\r\n\r\n  registerRandomEventTrigger(\r\n    varietyCollectorEvent,\r\n    150,\r\n    (state) =>\r\n      !varietyCollectorEvent.hasTriggered(state) &&\r\n      !varietyCollectorStoryline.isCompleted(state) &&\r\n      state.run.inventory.filter((itemStack) =>\r\n        Items.getById(itemStack.itemOccurrence.itemId)\r\n          .getTags()\r\n          .includes(ItemTagEnum.Accessory),\r\n      ).length >= 3,\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.AccessorySize]],\r\n    varietyCollectorStoryline.getId(),\r\n    varietyCollectorStoryline.getName(),\r\n    TransformationType.Addition,\r\n    (state, params) => (varietyCollectorStoryline.isBonusActive(state) ? 1 : 0),\r\n  );\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { getAccumulatorVariable } from \"../../../AccumulatorVariables\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst advertisingManual = new Storyline(\r\n  \"advertisingManual\",\r\n  t(\"Advertising Manual\"),\r\n  20,\r\n  10,\r\n  t(\"Sell a total of 1000 items or more\"),\r\n  t(\"+50%:coins: from selling items\"),\r\n  (state) => true,\r\n);\r\n\r\nexport function loadAdvertisingManual() {\r\n  Storylines.register(advertisingManual);\r\n\r\n  const advertisingManualEventBuilder = buildEvent(\r\n    \"advertisingManual\",\r\n    t(\"(Storyline) Advertising Manual\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(advertisingManual.getId());\r\n\r\n  advertisingManualEventBuilder.message(\r\n    t(`After finishing a recent transaction, you're delighted - you managed to get a fair amount of :coins: for a simple item!\r\n  \r\nYou walk back home, but you are interrupted in your tracks by a man with a huge backpack. \"Excuse me,\" he says, \"may I have a few moments of your attention?\"`),\r\n  );\r\n  advertisingManualEventBuilder.message(\r\n    t(`He introduces himself: \"I am a traveling merchant. I buy and sell things for a living.\" Then he continues: \"I couldn't help but note how... *simple*... that last sale was. You just went right up to your buyer, and... handed over your good for the posted price.\"\r\n  \r\nIt feels like a reprimand: \"That's definitely not how you should do things. When you are selling a product, any price you see posted is just *the bare minimum* you could manage to sell it for. You have gone through quite some effort just acquiring your item, and they are giving you *a misery* for it!\"\r\n\r\nYou haven't had much experience as a merchant, and really didn't think much about it...`),\r\n  );\r\n  advertisingManualEventBuilder\r\n    .message(\r\n      t(`\"I have something just for you. This *book*,\" he exclaims, while taking something out from his backpack and showing it to you. It is, indeed, a book: the cover reads \"The Basics of Advertising\".\r\n  \r\n\"With this book, you'll be able to get much more value out of the things that you decide to sell - if you do a lot of this, it will *definitely* come in handy!\"\r\n\r\nIt sounds like a good idea, until he says: \"I'd be happy to sell it to you for *10K:coins:*. Which I'm sure you'll be able to make back in no time!\" That price feels very *steep*. You really feel like this merchant is using that very technique on you. You're not sure of whether you should buy it or not...`),\r\n    )\r\n    .option(\r\n      t(\"Buy the book (10K Coins)\"),\r\n      {\r\n        transform: (state, params) =>\r\n          grantResource(Resource.Coins, -10000)(state),\r\n        isEnabled: (state, params) =>\r\n          getResourceAmount(state, Resource.Coins) >= 10000,\r\n      },\r\n      \"purchased\",\r\n    )\r\n    .option(\"Maybe later\")\r\n    .end();\r\n  advertisingManualEventBuilder\r\n    .message(\r\n      t(`You decide to give over the money. It was difficult to accumulate that much, but you are convinced this book could really be valuable. The merchant smiles while taking your :coins:. \"Nice doing business with you,\" he says, then hands over the book. \"Best of luck on your future sales!\" He waves at you and walks away.\r\n  \r\nYou decide to head home...`),\r\n    )\r\n    .tag(\"purchased\")\r\n    .option(t(\"Continue\"), {\r\n      transform: (state, params) => advertisingManual.complete(state),\r\n    });\r\n  advertisingManualEventBuilder.message(\r\n    t(`From the comfort of your home, you finally decide to take out the book and read it so you can apply it right away. Then you feel heartbroken. It does indeed describe techniques about how to advertise, but... they seem *so complex and difficult to understand*! You begin to regret your purchase. Will you ever be able to master this?\r\n  \r\nFor now, you decide to put it away. You don't feel like this is going to help you very much right now. But you think that perhaps someone in the future might be able to use it...\r\n\r\n**You have completed the \"Advertising Manual\" Storyline! In future runs, you will gain +50%:coins: when selling items!**`),\r\n  );\r\n\r\n  const advertisingManualEvent = advertisingManualEventBuilder.build();\r\n\r\n  addGameStateListener(\"advertisingManualTriggerer\", (state) => {\r\n    if (\r\n      !advertisingManual.isCompleted(state) &&\r\n      !advertisingManualEvent.hasTriggered(state) &&\r\n      getAccumulatorVariable(state, \"itemsSold\") >= 1000\r\n    ) {\r\n      return triggerEvent(advertisingManualEvent);\r\n    }\r\n  });\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.ItemSalePrice]],\r\n    advertisingManual.getId(),\r\n    advertisingManual.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => (advertisingManual.isBonusActive(state) ? 1.5 : 1.0),\r\n  );\r\n}\r\n\r\nexport { advertisingManual };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"bookOfMonsters\",\r\n  t(\"Compendium\"),\r\n  30,\r\n  10,\r\n  t(\"Defeat at least 5 different enemies\"),\r\n  t('Permanently unlock \"Compendium\"'),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as BookOfMonsters };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { isAutocastUnlocked } from \"../../../autocast/Autocast\";\r\nimport {\r\n  getElementLevel,\r\n  getPrimaryElementMaxLevelForRun,\r\n  SpellElement,\r\n} from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\nimport { LevelUpListeners } from \"../../progression/LevelUp\";\r\n\r\nconst simultaneousChanneling = new Storyline(\r\n  \"simultaneousChanneling\",\r\n  t(\"Simultaneous Channeling\"),\r\n  10,\r\n  10,\r\n  t(\"Reach Lv8 on your primary Element\"),\r\n  t('Unlock spell \"Channel Four\"'),\r\n  (state) => true,\r\n);\r\n\r\nexport function loadSimultaneousChanneling() {\r\n  Storylines.register(simultaneousChanneling);\r\n\r\n  const simultaneousChannelingEventBuilder = buildEvent(\r\n    \"simultaneousChanneling\",\r\n    t(\"(Storyline) Simultaneous Channeling\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(simultaneousChanneling.getId());\r\n\r\n  simultaneousChannelingEventBuilder\r\n    .message(\r\n      t(`Your expertise with magic continues to increase. Once more, you think about Channeling - getting essences of your primary element is proving fruitful, but you begin to think that it is actually a lot of work to have to think about many elements at once...\r\n    \r\nYou wonder if perhaps there could be a spell that could channel many elements at once... You think you will probably need even more expertise to figure this out.`),\r\n    )\r\n    .option(\r\n      t(\r\n        \"Research a new spell (Requires Fire Lv7, Earth Lv7, Water Lv7, Air Lv7)\",\r\n      ),\r\n      {\r\n        transform: (state) => simultaneousChanneling.complete(state),\r\n        isEnabled: (state) =>\r\n          getElementLevel(state, SpellElement.Fire) >= 7 &&\r\n          getElementLevel(state, SpellElement.Earth) >= 7 &&\r\n          getElementLevel(state, SpellElement.Water) >= 7 &&\r\n          getElementLevel(state, SpellElement.Air) >= 7,\r\n      },\r\n      \"end\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n  simultaneousChannelingEventBuilder\r\n    .message(\r\n      t(`You come up with a new idea! You prepare yourself and get ready to cast the spell, and then you do so... and you are startled as a sudden explosion happens in front of you! You hear giggles from behind you - your hired wizard has definitely taken notice of your failure.\r\n    \r\nIt appears that isn't going to be enough. You are convinced it has something to do with your skills, but you make sure to write down your ideas in your diary, so that if anyone else sees it in the future they would be able to try it...\r\n\r\n**You have completed the \"Simultaneous Channeling\" Storyline! In future runs, you will have a new spell available, to channel Fire, Earth, Water and Air at once: \"Channel Four\"!**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const simultaneousChannelingEvent =\r\n    simultaneousChannelingEventBuilder.build();\r\n\r\n  LevelUpListeners.register((state, element) => {\r\n    if (!state.run.primaryElement) {\r\n      return state;\r\n    }\r\n    if (\r\n      !simultaneousChanneling.isCompleted(state) &&\r\n      !simultaneousChannelingEvent.hasTriggered(state) &&\r\n      getPrimaryElementMaxLevelForRun(state) >= 8 &&\r\n      isAutocastUnlocked(state)\r\n    ) {\r\n      return triggerEvent(simultaneousChannelingEvent)(state);\r\n    }\r\n    return state;\r\n  }, simultaneousChannelingEvent.getId());\r\n}\r\n\r\nexport { simultaneousChanneling };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"posterity\",\r\n  t(\"Posterity\"),\r\n  1,\r\n  10,\r\n  t(\"Reach Lv4 on your primary element\"),\r\n  t('Permanently unlock \"Retirement\"'),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as Posterity };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { jumpEventToMessageIfExists } from \"../../../events/Events\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { StoneskinTemporaryEffect } from \"../../../spells/earth/Stoneskin\";\r\nimport { StrengthTemporaryEffect } from \"../../../spells/fire/Strength\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport {\r\n  calculateAttackTarget,\r\n  getCurrentEnemyHPFraction,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass GoblinChief extends Enemy {\r\n  getId(): string {\r\n    return \"goblinChief\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Goblin Chief\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 5000,\r\n      attack: 55,\r\n      defense: 50,\r\n      attackDelay: 2.7,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./goblinChief.png\");\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 18;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 10000;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 100;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    const target = calculateAttackTarget(state);\r\n    if (getCurrentEnemyHPFraction(state) < 0.5) {\r\n      if (\r\n        !hasTemporaryEffect(\r\n          state,\r\n          StoneskinTemporaryEffect.getId(),\r\n          AttackTarget.Enemy,\r\n        )\r\n      ) {\r\n        return {\r\n          name: t(\"Goblin Stoneskin\"),\r\n          delay: this.getAttackDelay(state),\r\n          transform: grantTemporaryEffect(\r\n            StoneskinTemporaryEffect.getId(),\r\n            180,\r\n            {\r\n              target: AttackTarget.Enemy,\r\n              params: { commonBuff: { DefenseMultiplier: 1.25 } },\r\n            },\r\n          ),\r\n        };\r\n      }\r\n      if (\r\n        !hasTemporaryEffect(\r\n          state,\r\n          StrengthTemporaryEffect.getId(),\r\n          AttackTarget.Enemy,\r\n        )\r\n      ) {\r\n        return {\r\n          name: t(\"Goblin Strength\"),\r\n          delay: this.getAttackDelay(state),\r\n          transform: grantTemporaryEffect(\r\n            StrengthTemporaryEffect.getId(),\r\n            180,\r\n            {\r\n              target: AttackTarget.Enemy,\r\n              params: { commonBuff: { AttackMultiplier: 1.2 } },\r\n            },\r\n          ),\r\n        };\r\n      }\r\n    }\r\n    if (\r\n      getResourceAmount(state, Resource.Coins) >= 10000 &&\r\n      Math.random() < 0.2\r\n    ) {\r\n      return {\r\n        name: t(\"Steal Lots of Coins!\"),\r\n        delay: this.getAttackDelay(state),\r\n        transform: (state) =>\r\n          grantResource(Resource.Coins, -(1000 + 4000 * Math.random()))(state),\r\n      };\r\n    }\r\n    if (Math.random() < 0.4) {\r\n      return {\r\n        name: t(\"Strong Attack\"),\r\n        delay: this.getAttackDelay(state) * 2,\r\n        transform: (state) =>\r\n          standardEnemyAttackEffect(state, this.getAttack(state) * 2),\r\n      };\r\n    }\r\n    return super.getNextAction(state);\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = jumpEventToMessageIfExists(state, \"goblinDen\", \"afterFight\");\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"This Goblin is much larger than the others we have gotten used to fighting. It is really quite strong, with high :attack: and :defense:, and it will become even stronger once it is wounded enough. What's worse is, it will steal a ton of :coins: from us - by the thousands! We should probably not fight it if we are not ready to lose our stockpile. On the other hand, if it just ends up stealing our :coins:, that is one less attack we need to endure... right?\",\r\n    );\r\n  }\r\n}\r\n\r\nexport default new GoblinChief();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { getAccumulatorVariable } from \"../../../AccumulatorVariables\";\r\nimport GoblinChief from \"../../../exploration/enemies/sewers/GoblinChief\";\r\nimport {\r\n  addEnemyDeathListener,\r\n  startCombat,\r\n} from \"../../../exploration/Exploration\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { addUICommand } from \"../../../UICommands\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst goblinDenStoryline = new Storyline(\r\n  \"goblinDen\",\r\n  t(\"Goblin Den\"),\r\n  240,\r\n  20,\r\n  t(\"Defeat at least 80 Goblins of any kind in the Sewers this retirement\"),\r\n  t(\"+40:land:\"),\r\n  (_state) => true,\r\n);\r\n\r\nexport function loadGoblinDen() {\r\n  Storylines.register(goblinDenStoryline);\r\n\r\n  const goblinDenEventBuilder = buildEvent(\r\n    \"goblinDen\",\r\n    t(\"(Storyline) Goblin Den\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds([goblinDenStoryline.getId()]);\r\n\r\n  goblinDenEventBuilder.message(\r\n    t(`\"There are a lot of Goblins down here!\"\r\n    \r\nYou hear that from your hired wizard, who has been accompanying you through the disgusting traversal of the Sewers. You agree. You have seen - and felled - quite a few; you wonder if they might be nesting in this place.\r\n\r\nWhile you think about this, you spot a room to the side of the tunnel you are walking through. It is half open, and light is seeping out of the door. You decide to peek inside... and you end up finding something very interesting.`),\r\n  );\r\n  goblinDenEventBuilder\r\n    .message(\r\n      t(\r\n        `The room looks like a makeshift camp. There are a few crude tents laid on the ground, and there is an active bonfire in the center, which illuminates the room. You spot a large figure towards the back - it is a Goblin, but it is larger than the others. It appears to be quite dangerous.\r\n      \r\nYou show the room to your hired wizard, and then she asks you in whispers: \"Should we eliminate it and inspect the room?\"\r\n\r\nThe prospect of loot tempts you, though it's going to be a tough fight... you want to make sure you are ready first.`,\r\n      ),\r\n    )\r\n    .option(t(\"Fight the Goblin Chief\"), {\r\n      transform: (state) => {\r\n        state = addUICommand(state, \"goToExploration\");\r\n        state = addUICommand(state, \"closeAllMenus\");\r\n        state = addUICommand(state, \"closeEventOverlay\");\r\n        state = startCombat(GoblinChief)(state);\r\n        return state;\r\n      },\r\n    })\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  goblinDenEventBuilder\r\n    .message(\r\n      t(`The Goblin Chief falls to the ground, unconscious, as you manage to succeed and overpower it. You somehow feel bad for the other Goblins - you decide to refrain from killing it.\r\n      \r\nBut you *are* going to get a helping out of the loot of this room.`),\r\n    )\r\n    .tag(\"afterFight\");\r\n\r\n  goblinDenEventBuilder.message(\r\n    t(`You search everywhere - inside the tents, around the room, even the Goblin Chief itself. Very disappointingly, though, you find nothing of value. The hired wizard also looks disappointed.\r\n      \r\nBut you did find something. It's a ladder on the back side of the room, which goes up towards the ceiling. And on the ceiling, there is a trap door with a safety lock. You decide to check it out - you carefully climb the ladder, undo the safety lock, and push the trap door upwards. Then you carefully peek through the hole.\r\n\r\nWhat you see, however, *really* surprises you. *It is your own home's basement!*`),\r\n  );\r\n\r\n  goblinDenEventBuilder\r\n    .message(\r\n      t(`Without believing your eyes, you go back up and scream at the hired wizard to follow you. She does so - and after seeing the other side, she becomes just as dumbfounded as you.\r\n      \r\nThen your mind begins to race. *You had a Goblin Den right below your basement, this entire time.* You were not able to see it because it was locked from the other side - but it meant those goblins could have *come in*!\r\n\r\nYou can't let that happen. You race back down, push the Goblin Chief out of the door of the room, and then lock it - from the inside. You check one more time for any other Goblins, but there are none - and you breathe a sigh of relief.`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      { transform: (state) => goblinDenStoryline.complete(state) },\r\n      \"end\",\r\n    );\r\n\r\n  goblinDenEventBuilder\r\n    .message(\r\n      t(`Then you start thinking about what this also means. This means your basement is actually connected to an *extra room*. But - as you look around - the room is entirely unusable right now. It will take a lot of time to clean this room up, get rid of all of the things the Goblins set in this room, and more cleanly separate it from the rest of the Sewers.\r\n  \r\nYou don't have time to do that, not right now. But at some point, you tell yourself, you should - you jot down some notes in your diary, hoping you (or at least someone else!) will remember about it...\r\n\r\n**You have completed the \"Goblin Den\" Storyline! In future runs, the extra room will give you +40:land:!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const goblinDenEvent = goblinDenEventBuilder.build();\r\n\r\n  addEnemyDeathListener(goblinDenEvent.getId() + \"Triggerer\", (state) => {\r\n    if (\r\n      !goblinDenEvent.hasTriggered(state) &&\r\n      !goblinDenStoryline.isCompleted(state) &&\r\n      getAccumulatorVariable(state, \"goblinKills\") >= 80\r\n    ) {\r\n      return triggerEvent(goblinDenEvent)(state);\r\n    }\r\n    return state;\r\n  });\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Land, TransformationTags.Cap]],\r\n    \"goblinDen\",\r\n    goblinDenStoryline.getName(),\r\n    TransformationType.Addition,\r\n    (state) => (goblinDenStoryline.isBonusActive(state) ? 40 : 0),\r\n  );\r\n}\r\n\r\nexport { goblinDenStoryline };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport { TransmutationSpell } from \"../TransmutationSpell\";\r\n\r\nclass Paper extends Item {\r\n  getId(): string {\r\n    return \"paper\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./paper.png\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Paper\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"Paper. Used for Enhancements, but also for many more things.\");\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 200;\r\n  }\r\n}\r\n\r\nconst paper = new Paper();\r\n\r\nclass TransmutePaper extends TransmutationSpell {\r\n  getItem(): Item {\r\n    return paper;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 1,\r\n    };\r\n  }\r\n\r\n  canCraft(state: GameState): boolean {\r\n    return hasFlag(state, Flag.EnhancementsUnlocked) && super.canCraft(state);\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return hasFlag(state, Flag.EnhancementsUnlocked) && super.isVisible(state);\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        EarthEssence: 2000,\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst transmutePaper = new TransmutePaper();\r\n\r\nexport { transmutePaper, paper };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\n\r\nconst storyline = new Storyline(\r\n  \"locationEncyclopedia\",\r\n  t(\"Location Encyclopedia\"),\r\n  220,\r\n  20,\r\n  t(\"Defeat at least 15 enemies in the Hazardous Sector of the Sewers\"),\r\n  t(\r\n    \"Subsequent retirements will need 35% less Exploration to unlock the boss of areas you have unlocked the boss of, to a minimum of 1\",\r\n  ),\r\n  (state) => true,\r\n);\r\n\r\nexport { storyline as LocationEncyclopedia };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport {\r\n  getWorldAccumulatorVariable,\r\n  incrementAccumulatorVariable,\r\n} from \"../../../AccumulatorVariables\";\r\nimport { DungeonFloors } from \"../../../exploration/dungeons/Dungeons\";\r\nimport {\r\n  addEnemyDeathListener,\r\n  getCurrentDungeonFloor,\r\n  getSuccessfulExplorationsForFloor,\r\n} from \"../../../exploration/Exploration\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport {\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../../items/Inventory\";\r\nimport { Items } from \"../../../items/Items\";\r\nimport { paper } from \"../../../items/transmute/materials/Paper\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\nimport { LocationEncyclopedia } from \"./LocationEncyclopediaStoryline\";\r\n\r\nexport function loadLocationEncyclopedia() {\r\n  Storylines.register(LocationEncyclopedia);\r\n  const locationEncyclopediaEventBuilder = buildEvent(\r\n    \"locationEncyclopedia\",\r\n    t(\"(Storyline) Location Encyclopedia\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(LocationEncyclopedia.getId());\r\n\r\n  locationEncyclopediaEventBuilder.message(\r\n    t(`Exploring the Sewers is proving to be quite annoying. Having to deal with countless enemies and extreme disappointment every time you reach a dead end is... not good.\r\n    \r\nYou wish you had a map - so you'd be able to take the correct path, without so much wasted time.`),\r\n  );\r\n  locationEncyclopediaEventBuilder\r\n    .message(\r\n      t(`Except, you don't know where you could get one.\r\n      \r\nInstead, you think about building a map yourself. It shouldn't save you effort, but maybe you could sell it to others. Or, even better - maybe someone else might find a better use for it?\r\n\r\nYou think about what you would need to make such a map - or rather, an *encyclopedia* of those places. You'll certainly need Paper, and some Shards for gluing. But you know how to make that by now...`),\r\n    )\r\n    .option(\r\n      t(\"Craft a map (20 Paper, 10 Poison Shards)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = removeFromInventoryWithAnyParams(paper, 20, state);\r\n          state = removeFromInventoryWithAnyParams(\r\n            Items.getById(\"elementalShardPoison\"),\r\n            10,\r\n            state,\r\n          );\r\n          state = LocationEncyclopedia.complete(state);\r\n          state = tallyAll(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) =>\r\n          getTotalAmountOfItem(paper, state) >= 20 &&\r\n          getTotalAmountOfItem(Items.getById(\"elementalShardPoison\"), state) >=\r\n            10,\r\n      },\r\n      \"end\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n  locationEncyclopediaEventBuilder\r\n    .message(\r\n      t(`You put together all the pages and proceed to carefully glue them. You wrap it with a makeshift book cover, and write a grand name: \"Location Encyclopedia\". You chuckle - it is just a blank book!\r\n    \r\nBut it won't be blank for long. You start scribbling information that you still remember about the areas you have already visited. You are very hopeful this will be useful in the future!\r\n\r\n**You have completed the \"Location Encyclopedia\" Storyline! Unlocking the boss of a location will reduce the amount of required Exploration on that area by 35% after retiring. This will stack every retirement you clear the location, to a minimum of 1 exploration required!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const locationEncyclopediaEvent = locationEncyclopediaEventBuilder.build();\r\n\r\n  addGameStateListener(\"locationEncyclopediaListener\", (state) => {\r\n    if (\r\n      !locationEncyclopediaEvent.hasTriggered(state) &&\r\n      !LocationEncyclopedia.isCompleted(state) &&\r\n      getSuccessfulExplorationsForFloor(state, \"sewerHazardousSector\") >= 5\r\n    ) {\r\n      return triggerEvent(locationEncyclopediaEvent);\r\n    }\r\n  });\r\n\r\n  function tallyAll(state: GameState): GameState {\r\n    if (LocationEncyclopedia.isCompleted(state)) {\r\n      if (state.temp.locationEncyclopediaCache == undefined) {\r\n        state.temp.locationEncyclopediaCache = [].concat(\r\n          DungeonFloors.getAll(),\r\n        );\r\n      }\r\n      const remainingFloors = state.temp.locationEncyclopediaCache;\r\n\r\n      let floorsToTally = [];\r\n      let talliedFloors = [];\r\n\r\n      for (let floorIdx = 0; floorIdx < remainingFloors.length; floorIdx++) {\r\n        const floor = remainingFloors[floorIdx];\r\n        const isTallied = hasFlag(\r\n          state,\r\n          \"locationEncyclopediaTally-\" + floor.getIdForTallyingClears(),\r\n        );\r\n        if (isTallied) {\r\n          talliedFloors.push(floor);\r\n          continue;\r\n        }\r\n        if (\r\n          !isTallied &&\r\n          floor.isUnlocked(state) &&\r\n          floor.canFightBoss(state)\r\n        ) {\r\n          floorsToTally.push(floor);\r\n        }\r\n      }\r\n\r\n      if (talliedFloors.length > 0) {\r\n        state.temp.locationEncyclopediaCache = remainingFloors.filter(\r\n          (floor) => !talliedFloors.includes(floor),\r\n        );\r\n      }\r\n\r\n      if (floorsToTally.length > 0) {\r\n        for (let floor of floorsToTally) {\r\n          state = incrementAccumulatorVariable(\r\n            state,\r\n            \"clearedTally-\" + floor.getIdForTallyingClears(),\r\n            1,\r\n          );\r\n          state = setFlag(\r\n            \"locationEncyclopediaTally-\" + floor.getIdForTallyingClears(),\r\n          )(state);\r\n        }\r\n      }\r\n    }\r\n    return state;\r\n  }\r\n\r\n  addEnemyDeathListener(locationEncyclopediaEvent.getId(), (state, _enemy) => {\r\n    if (LocationEncyclopedia.isCompleted(state)) {\r\n      const floor = getCurrentDungeonFloor(state);\r\n\r\n      const isTallied = hasFlag(\r\n        state,\r\n        \"locationEncyclopediaTally-\" + floor.getIdForTallyingClears(),\r\n      );\r\n      if (!isTallied && floor.isUnlocked(state) && floor.canFightBoss(state)) {\r\n        state = incrementAccumulatorVariable(\r\n          state,\r\n          \"clearedTally-\" + floor.getIdForTallyingClears(),\r\n          1,\r\n        );\r\n        state = setFlag(\r\n          \"locationEncyclopediaTally-\" + floor.getIdForTallyingClears(),\r\n        )(state);\r\n      }\r\n    }\r\n    return state;\r\n  });\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.ExplorationBossRequirement]],\r\n    \"locationEncyclopedia\",\r\n    LocationEncyclopedia.getName(),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      if (LocationEncyclopedia.isBonusActive(state)) {\r\n        const tally = getWorldAccumulatorVariable(\r\n          state,\r\n          \"clearedTally-\" + params.floor.getIdForTallyingClears(),\r\n        );\r\n        return Math.pow(0.65, tally);\r\n      }\r\n      return 1.0;\r\n    },\r\n  );\r\n}\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { getBuildingAmount } from \"../../../buildings/Buildings\";\r\nimport { essenceCatalyst } from \"../../../buildings/catalysts/EssenceCatalyst\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\nimport { advertisingManual } from \"../pretraining/AdvertisingManual\";\r\n\r\nexport const outessencedStoryline = new Storyline(\r\n  \"outessenced\",\r\n  t(\"Outessenced\"),\r\n  290,\r\n  25,\r\n  (state) => t(\"Build at least 10 Essence Catalysts\"),\r\n  (state) =>\r\n    t(\r\n      \"Obtain a bonus to channeling of half the effect of an Essence Catalyst for each Essence Catalyst you have less than the maximum you have ever had across any retirement ({{max}})\",\r\n      {\r\n        max: formatNumber(\r\n          state.world.maxFurnitureNumbers[essenceCatalyst.getId()],\r\n        ),\r\n      },\r\n    ),\r\n  (state) => advertisingManual.isCompleted(state),\r\n);\r\n\r\nexport function loadOutessenced() {\r\n  Storylines.register(outessencedStoryline);\r\n  const eventBuilder = buildEvent(\"outessenced\", t(\"(Storyline) Outessenced\"), [\r\n    EventTag.STORYLINE,\r\n  ]).setStorylineIds(outessencedStoryline.getId());\r\n\r\n  eventBuilder.message(\r\n    t(`You finish putting together that last Essence Catalyst. They are so incredibly useful - each one of them has saved you so much work channeling Essence, you feel you cannot live without them!\r\n    \r\n\"Excuse me,\" you hear from outside your door. \"May I have a few moments of your attention?\"\r\n\r\nYou take a peek, and you spot someone that seems... familiar: a man with a huge backpack. They're a traveling merchant! You get the feeling you might have seen him before.`),\r\n  );\r\n  eventBuilder.message(\r\n    t(`\"I happened to be walking through, and I heard something about some Essence Catalyst,\" he explains. \"I'm well aware just how important these are to wizards of all skill levels.\"\r\n      \r\n\"But wasn't it *difficult* to build them? Wasn't it slow, channeling all that :fireessence:? Well... *I have a solution!*\"\r\n\r\nThe merchant pulls out a book from his bag. It reads: *\"Outessenced\"*. There is a drawing of an Essence Catalyst on the cover, but next to it, there appear to be many, many other Essence Catalysts drawn, except these are only outlined. The book catches your interest. What could this possibly be about?`),\r\n  );\r\n  eventBuilder\r\n    .message(\r\n      t(`\"Ah, I see it's caught your eye,\" exclaims the merchant. \"This was written by a celebrity professor of a school of magic. It describes a way to *record* Essence Catalysts somehow, so that they can be used even when they are no longer there... how is that even possible, I wouldn't know, I'm not a wizard,\" he says.\r\n      \r\nYou are intrigued. That could be so useful - how much easier would it have been to set up your home if that was possible?! Until he says: \"Very useful, isn't it? It can be yours for *500K:coins:*. And not a single one less!\"\r\n\r\nThat's... a lot of :coins:, and you did already set up your Essence Catalysts, after all. You think again about whether it's worth buying the book...`),\r\n    )\r\n    .option(\r\n      t(\"Buy the book (500K Coins)\"),\r\n      {\r\n        transform: (state, params) =>\r\n          grantResource(Resource.Coins, -500000)(state),\r\n        isEnabled: (state, params) =>\r\n          getResourceAmount(state, Resource.Coins) >= 500000,\r\n      },\r\n      \"purchased\",\r\n    )\r\n    .option(\"Maybe later\")\r\n    .end();\r\n  eventBuilder\r\n    .message(\r\n      t(`You decide to purchase the book, after all that hard work building up your :coins:. You have a hunch this book could be valuable... as long as it does what the merchant said it did.\r\n      \r\nThe merchant smiles while taking your :coins:. \"Nice doing business with you,\" he says, then hands over the book. \"Best of luck on your future furnishing!\" He waves at you and walks away.\r\n\r\nThe book feels very light...`),\r\n    )\r\n    .tag(\"purchased\")\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = outessencedStoryline.complete(state);\r\n          state = outessencedStoryline.activateBonus(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    )\r\n    .end();\r\n\r\n  eventBuilder\r\n    .message(\r\n      t(`You skim through it. But you realize the book is actually light because it describes a simple concept. A *really* simple concept - that you weren't aware of at all!\r\n      \r\nYou figure out you got scammed. There is no way this book was worth 500K:coins:. But on the other hand... you can tell right away that the idea works. And you can apply it right away!\r\n\r\n**You have completed the \"Outessenced\" Storyline! From now on, you will gain a bonus to channeling of half the effect of an Essence Catalyst, for each Essence Catalyst you have less than the maximum you have ever had across all retirements! This will allow you to channel Essence a lot more effectively at the beginning of a run!**`),\r\n    )\r\n    .tag(\"end\");\r\n\r\n  const event = eventBuilder.build();\r\n\r\n  addGameStateListener(event.getId(), (state) => {\r\n    if (\r\n      !event.hasTriggered(state) &&\r\n      !outessencedStoryline.isCompleted(state) &&\r\n      advertisingManual.isCompleted(state) &&\r\n      getBuildingAmount(state, essenceCatalyst) >= 10\r\n    ) {\r\n      return triggerEvent(event);\r\n    }\r\n  });\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.ChannelingEfficiency]],\r\n    outessencedStoryline.getId(),\r\n    outessencedStoryline.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      if (!outessencedStoryline.isBonusActive(state)) {\r\n        return 1.0;\r\n      }\r\n      const catalystAmount = getBuildingAmount(state, essenceCatalyst);\r\n      const maxAmount =\r\n        state.world.maxFurnitureNumbers[essenceCatalyst.getId()] ?? 0;\r\n      if (catalystAmount < maxAmount) {\r\n        const multiplierPerCatalyst =\r\n          (essenceCatalyst.getPerCatalystBonusMultiplier(state) - 1) / 2 + 1;\r\n        return Math.max(\r\n          1.0,\r\n          Math.pow(multiplierPerCatalyst, maxAmount - catalystAmount),\r\n        );\r\n      }\r\n      return 1.0;\r\n    },\r\n  );\r\n}\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CopperGauntlet extends EquippableItem {\r\n  getId(): string {\r\n    return \"copperGauntlet\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./copperGauntlet.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Gauntlet\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A gauntlet made from reinforced copper. An upgrade from basic knuckles, easily fits into your hand.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2600;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 50;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.4;\r\n  }\r\n}\r\n\r\nexport const copperGauntlet = new CopperGauntlet();\r\n\r\nclass TransmuteCopperGauntlet extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return copperGauntlet;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 17,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        AirEssence: 12000,\r\n      },\r\n      items: {\r\n        elementalShardAir: 40,\r\n        copperIngot: 7,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const transmuteCopperGauntlet = new TransmuteCopperGauntlet();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CopperRapier extends EquippableItem {\r\n  getId(): string {\r\n    return \"copperRapier\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./copperRapier.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Rapier\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A stabbing sword made from reinforced copper.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 1700;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 66;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.05;\r\n  }\r\n}\r\n\r\nexport const copperRapier = new CopperRapier();\r\n\r\nclass TransmuteCopperRapier extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return copperRapier;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 15,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        EarthEssence: 10000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 30,\r\n        copperIngot: 5,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteCopperRapier = new TransmuteCopperRapier();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CopperTomahawk extends EquippableItem {\r\n  getId(): string {\r\n    return \"copperTomahawk\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./copperTomahawk.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Tomahawk\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"An axe, made from reinforced copper. Strong, but not overly heavy.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2200;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 105;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0.4;\r\n  }\r\n}\r\n\r\nexport const copperTomahawk = new CopperTomahawk();\r\n\r\nclass TransmuteCopperTomahawk extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return copperTomahawk;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 14,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        FireEssence: 5000,\r\n      },\r\n      items: {\r\n        elementalShardFire: 25,\r\n        copperIngot: 3,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nexport const transmuteCopperTomahawk = new TransmuteCopperTomahawk();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { createChestEvent } from \"../../../events/autorandom/Chest\";\r\nimport { ExplorationTriggerGroup } from \"../../../events/autorandom/ExplorationTrigger\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag } from \"../../../Flags\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { copperGauntlet } from \"../../../items/equipment/hand/air/CopperGauntlet\";\r\nimport { copperRapier } from \"../../../items/equipment/hand/earth/CopperRapier\";\r\nimport { copperTomahawk } from \"../../../items/equipment/hand/fire/CopperTomahawk\";\r\nimport { antidotePotion } from \"../../../items/equipment/pouch/AntidotePotion\";\r\nimport { copperOre } from \"../../../items/transmute/materials/CopperOre\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { Dungeon } from \"../Dungeon\";\r\nimport { DungeonFloor } from \"../DungeonFloor\";\r\nimport SewerEntrance from \"./SewerEntrance\";\r\nimport SewerHazardousSector from \"./SewerHazardousSector\";\r\nimport SewerHideout from \"./SewerHideout\";\r\n\r\nclass Sewers extends Dungeon {\r\n  getId(): string {\r\n    return \"sewers\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Sewers\");\r\n  }\r\n\r\n  getDungeonFloors(): DungeonFloor[] {\r\n    return [SewerEntrance, SewerHazardousSector, SewerHideout];\r\n  }\r\n\r\n  isUnlocked(state: GameState): boolean {\r\n    return hasFlag(state, Flag.SewersUnlocked);\r\n  }\r\n}\r\n\r\nexport const sewers = new Sewers();\r\n\r\nclass SewersExplorationGroup extends ExplorationTriggerGroup {\r\n  getHintMessageWhenPossible(): string {\r\n    return t(\"Explore the Sewers\");\r\n  }\r\n  getHintMessageWhenNotPossible(): string {\r\n    return t(\r\n      \"This Storyline can be found by exploring the Sewers, but you cannot get it this run\",\r\n    );\r\n  }\r\n  maxTriggersPerRun(): number {\r\n    return 1;\r\n  }\r\n  getId(): string {\r\n    return \"sewers\";\r\n  }\r\n  getExplorationSuccessesBase(): number {\r\n    return 150;\r\n  }\r\n  getDungeonFloors(): DungeonFloor[] {\r\n    return sewers.getDungeonFloors();\r\n  }\r\n}\r\n\r\nexport const sewersExplorationGroup = new SewersExplorationGroup();\r\n\r\nexport function loadSewerChests() {\r\n  createChestEvent(\r\n    \"sewerChestCommon1\",\r\n    [SewerEntrance.getId(), SewerHazardousSector.getId(), SewerHideout.getId()],\r\n    70,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: copperOre.getId(), params: {} },\r\n        amount: 8,\r\n      },\r\n    ],\r\n  );\r\n  createChestEvent(\r\n    \"sewerChestCommon2\",\r\n    [SewerEntrance.getId(), SewerHazardousSector.getId(), SewerHideout.getId()],\r\n    50,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: cotton.getId(), params: {} },\r\n        amount: 3,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"sewerChestRare0\",\r\n    [SewerEntrance.getId(), SewerHazardousSector.getId(), SewerHideout.getId()],\r\n    4,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: antidotePotion.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"sewerChestRare1\",\r\n    [SewerEntrance.getId(), SewerHazardousSector.getId(), SewerHideout.getId()],\r\n    4,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: copperTomahawk.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"sewerChestRare2\",\r\n    [SewerEntrance.getId(), SewerHazardousSector.getId(), SewerHideout.getId()],\r\n    4,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: copperGauntlet.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n\r\n  createChestEvent(\r\n    \"sewerChestRare3\",\r\n    [SewerEntrance.getId(), SewerHazardousSector.getId(), SewerHideout.getId()],\r\n    4,\r\n    [\r\n      {\r\n        itemOccurrence: { itemId: copperRapier.getId(), params: {} },\r\n        amount: 1,\r\n      },\r\n    ],\r\n  );\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { essenceStorage } from \"../../../buildings/storages/EssenceStorage\";\r\nimport { sewers } from \"../../../exploration/dungeons/sewers/Sewers\";\r\nimport { getCurrentDungeonFloor } from \"../../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../../exploration/ExplorationUtils\";\r\nimport {\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../../items/Inventory\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { getElementLevel, SpellElement } from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { registerRandomEventTrigger } from \"../../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst passageOfStenchStoryline = new Storyline(\r\n  \"passageOfStench\",\r\n  t(\"Passage of Stench\"),\r\n  260,\r\n  20,\r\n  (state) => t(\"Explore the Sewers\"),\r\n  t(\"+100% effectivity of Essence Storages\"),\r\n  (_state) => true,\r\n);\r\n\r\nexport function loadPassageOfStench() {\r\n  Storylines.register(passageOfStenchStoryline);\r\n\r\n  const passageOfStenchEventBuilder = buildEvent(\r\n    \"passageOfStench\",\r\n    t(\"(Storyline) Passage of Stench\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds([passageOfStenchStoryline.getId()]);\r\n\r\n  passageOfStenchEventBuilder.message(\r\n    t(`A sharp, terrible odor pierces your nostrils. You stop, feeling quite weakened by it. Your hired wizard also feels similarly.\r\n    \r\n\"Agh... should we turn around? Why are we even doing this...? Is this Philosopher's Stone really that important...?\" she asks, while complaining.\r\n\r\nThis time, you agree with her. This stench feels dangerously strong. You will have to turn around...`),\r\n  );\r\n  passageOfStenchEventBuilder\r\n    .message(\r\n      t(\r\n        `Unless... maybe there is a way? You remind yourself you are a Wizard, after all... shouldn't you be able to use magic to solve something like this?`,\r\n      ),\r\n    )\r\n    .option(\r\n      t(\r\n        \"Transmute two protective masks (Requires Lv15 Earth, Lv15 Water, 16 Cotton, 2400 Mana)\",\r\n      ),\r\n      {\r\n        transform: (state) => {\r\n          state = removeFromInventoryWithAnyParams(cotton, 16, state);\r\n          state = grantResource(Resource.Mana, -2400)(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) => {\r\n          return (\r\n            getResourceAmount(state, Resource.Mana) >= 2400 &&\r\n            getTotalAmountOfItem(cotton, state) >= 16 &&\r\n            getElementLevel(state, SpellElement.Earth) >= 15 &&\r\n            getElementLevel(state, SpellElement.Water) >= 15\r\n          );\r\n        },\r\n      },\r\n      \"masks\",\r\n    )\r\n    .option(\r\n      t(\"Dispel the stench with wind (Requires Lv18 Air, 3200 Mana)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = grantResource(Resource.Mana, -3200)(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) => {\r\n          return (\r\n            getResourceAmount(state, Resource.Mana) >= 3200 &&\r\n            getElementLevel(state, SpellElement.Air) >= 18\r\n          );\r\n        },\r\n      },\r\n      \"wind\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  passageOfStenchEventBuilder\r\n    .message(\r\n      t(\r\n        `You transmute a pair of face masks, and give one to your hired wizard. Putting them on is a relief. You still don't feel fully well, but you get some of your strength back, and feel strong enough to press on.`,\r\n      ),\r\n    )\r\n    .tag(\"masks\")\r\n    .option(t(\"Continue\"), \"past\")\r\n    .end();\r\n\r\n  passageOfStenchEventBuilder\r\n    .message(\r\n      t(`You gather Mana and cast a strong Air spell. A strong breeze comes from behind you. Your hired wizard almost loses her hat, but manages to catch it at the last minute. She is about to complain, but she notices the same that you have - the air around you is more breathable.\r\n    \r\nAlthough not exactly pleasant, it feels like it isn't overpowering enough to stop you from advancing in this direction now...`),\r\n    )\r\n    .tag(\"wind\");\r\n\r\n  passageOfStenchEventBuilder\r\n    .message(\r\n      t(`You continue walking through the passage and eventually find the source of the foul smell: a big, big pile of what looks like rotten Goblin flesh. Your hired wizard is very disgusted by the sight and decides to wait for you outside. But you decide to scan the place.\r\n      \r\nAlthough you don't find much, one thing catches your attention: a book in the center that seems wildly unrelated to the room, *\"Essence Storage Construction\"*. You decide to take it with you - it is in good condition, and whoever put all those... Goblins... in here, for some reason, also decided to keep this book as well? You can't make much sense of it.`),\r\n    )\r\n    .tag(\"past\")\r\n    .option(\r\n      t(\"Continue\"),\r\n      { transform: (state) => passageOfStenchStoryline.complete(state) },\r\n      \"end\",\r\n    );\r\n\r\n  // Scribbled book describing how to store Corpses diagram,\r\n\r\n  passageOfStenchEventBuilder\r\n    .message(\r\n      t(`In the comfort of your home, you open the book and decide to take a look at it. You discover two different things. The first one are guides on how to better build Essence Storages, but they seem somewhat difficult to understand. The second one are crude diagrams written by someone else about the best way to pile Goblin corpses... which you find odd. It appears someone has just used this valuable book as a writing material for another purpose!\r\n      \r\nYou are somewhat disgusted, but you decide to store the book anyway. You think the knowledge about how to better build Essence Storages might be able to benefit someone else at some point...\r\n\r\n**You have completed the \"Passage of Stench\" Storyline! In future runs, the knowledge from the book will double the effect of Essence Storages!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const passageOfStench = passageOfStenchEventBuilder.build();\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.PerBuildingCap, essenceStorage.getId()]],\r\n    \"passageOfStench\",\r\n    passageOfStenchStoryline.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => (passageOfStenchStoryline.isBonusActive(state) ? 2.0 : 1.0),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    passageOfStench,\r\n    25,\r\n    (state) =>\r\n      !passageOfStench.hasTriggered(state) &&\r\n      !passageOfStenchStoryline.isCompleted(state) &&\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      sewers.getDungeonFloors().includes(getCurrentDungeonFloor(state)),\r\n  );\r\n}\r\n\r\nexport { passageOfStenchStoryline };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport {\r\n  addToInventory,\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../../items/Inventory\";\r\nimport { Items } from \"../../../items/Items\";\r\nimport { getUnlockedElements } from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { calculateIncomePerSecond } from \"../../../timetick/IncomeOverTime\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nexport const shardStockpileStoryline = new Storyline(\r\n  \"shardStockpile\",\r\n  t(\"Stockpile of Shards\"),\r\n  280,\r\n  20,\r\n  t(\"Obtain 150:mana:/sec after retiring at least 2 times\"),\r\n  t(\"Begin subsequent retirements with 30 shards of every unlocked Element\"),\r\n  (state) => true,\r\n);\r\n\r\nexport function loadShardStockpile() {\r\n  Storylines.register(shardStockpileStoryline);\r\n  const shardStockpileEventBuilder = buildEvent(\r\n    \"shardStockpile\",\r\n    t(\"(Storyline) Stockpile of Shards\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(shardStockpileStoryline.getId());\r\n\r\n  shardStockpileEventBuilder\r\n    .message(\r\n      t(`You have come pretty far, but you still remember how difficult it was to start out. Slow :mana: generation, few or no wizards helping you out, manually crafting all these Shards... Your own inexperience didn't help you, either.\r\n    \r\nYou wouldn't wish it on anyone. Now that you feel you are standing on more solid ground, you decide to create a stockpile of shards so this never happens again.\r\n\r\nYou are going to need a lot of shards...`),\r\n    )\r\n    .option(\r\n      t(\r\n        \"Create the stockpile (200 of each of Fire Shard, Earth Shard, Water Shard, Air Shard)\",\r\n      ),\r\n      {\r\n        transform: (state) => {\r\n          state = removeFromInventoryWithAnyParams(\r\n            Items.getById(\"elementalShardFire\"),\r\n            200,\r\n            state,\r\n          );\r\n          state = removeFromInventoryWithAnyParams(\r\n            Items.getById(\"elementalShardEarth\"),\r\n            200,\r\n            state,\r\n          );\r\n          state = removeFromInventoryWithAnyParams(\r\n            Items.getById(\"elementalShardWater\"),\r\n            200,\r\n            state,\r\n          );\r\n          state = removeFromInventoryWithAnyParams(\r\n            Items.getById(\"elementalShardAir\"),\r\n            200,\r\n            state,\r\n          );\r\n          state = shardStockpileStoryline.complete(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) =>\r\n          getTotalAmountOfItem(Items.getById(\"elementalShardFire\"), state) >=\r\n            200 &&\r\n          getTotalAmountOfItem(Items.getById(\"elementalShardEarth\"), state) >=\r\n            200 &&\r\n          getTotalAmountOfItem(Items.getById(\"elementalShardWater\"), state) >=\r\n            200 &&\r\n          getTotalAmountOfItem(Items.getById(\"elementalShardAir\"), state) >=\r\n            200,\r\n      },\r\n      \"end\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n  shardStockpileEventBuilder\r\n    .message(\r\n      t(`You put all the shards in a box, neatly divided and sorted. You cover the box, and you safeguard it in a corner of the house. You vow not to open it again - and hope it might help someone. Perhaps your children, if you ever decide to have any...?\r\n      \r\n**You have completed the \"Stockpile of Shards\" Storyline! In future runs, you will begin with 30 shards of all of your unlocked Elements in your inventory!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const shardStockpileEvent = shardStockpileEventBuilder.build();\r\n\r\n  addGameStateListener(\"shardStockpileListener\", (state) => {\r\n    if (\r\n      !shardStockpileEvent.hasTriggered(state) &&\r\n      !shardStockpileStoryline.isCompleted(state) &&\r\n      state.world.totalTimesResetted >= 2 &&\r\n      (calculateIncomePerSecond(state)?.Mana ?? 0) >= 150\r\n    ) {\r\n      return triggerEvent(shardStockpileEvent);\r\n    }\r\n  });\r\n\r\n  addGameStateListener(\"shardStockpile\", (state) => {\r\n    if (\r\n      shardStockpileStoryline.isBonusActive(state) &&\r\n      !hasFlag(state, \"shardStockpileHasGivenShards\") &&\r\n      state.run.primaryElement != null\r\n    ) {\r\n      return (state) => {\r\n        if (state.run.primaryElement != null) {\r\n          const unlockedElements = getUnlockedElements(state);\r\n          for (let element of unlockedElements) {\r\n            state = addToInventory(\r\n              { itemId: \"elementalShard\" + element, params: {} },\r\n              30,\r\n              state,\r\n            );\r\n          }\r\n          state = setFlag(\"shardStockpileHasGivenShards\")(state);\r\n        }\r\n        return state;\r\n      };\r\n    }\r\n  });\r\n}\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass WizardsHat extends EquippableItem {\r\n  getId(): string {\r\n    return \"wizardsHat\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./wizardsHat.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Wizard's Hat\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A traditional hat, popular with wizards of all kinds. Boosts spellcasting.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2000;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 3;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 10;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 300;\r\n  }\r\n}\r\n\r\nexport const wizardsHat = new WizardsHat();\r\n\r\nclass TransmuteWizardsHat extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return wizardsHat;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 18,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n      },\r\n      items: {\r\n        elementalShardWater: 20,\r\n        cotton: 5,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nexport const transmuteWizardsHat = new TransmuteWizardsHat();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { sewers } from \"../../../exploration/dungeons/sewers/Sewers\";\r\nimport { getCurrentDungeonFloor } from \"../../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../../exploration/ExplorationUtils\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport { wizardsHat } from \"../../../items/equipment/accessory/water/WizardsHat\";\r\nimport { addToInventory } from \"../../../items/Inventory\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { registerPostRetirementListener } from \"../../../Retire\";\r\nimport { getElementLevel, SpellElement } from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { registerRandomEventTrigger } from \"../../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { getGameEventById } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst someonesTrashBookStoryline = new Storyline(\r\n  \"someonesTrashBook\",\r\n  t(\"Somebody's Trash (Book)\"),\r\n  250,\r\n  20,\r\n  (state) =>\r\n    getGameEventById(\"someonesTrash\").hasTriggered(state)\r\n      ? !someonesTrashHatStoryline.isCompletedThisRun(state) &&\r\n        !someonesTrashTreasureStoryline.isCompletedThisRun(state)\r\n        ? t(\"Explore the Sewers\")\r\n        : t(\"Explore the Sewers, but you cannot get it this run\")\r\n      : t(\"Explore the Sewers\"),\r\n  (state) => t(\"+25% Exp gain from Studying\"),\r\n  (_state) => true,\r\n);\r\n\r\nconst someonesTrashHatStoryline = new Storyline(\r\n  \"someonesTrashHat\",\r\n  t(\"Somebody's Trash (Hat)\"),\r\n  251,\r\n  20,\r\n  (state) =>\r\n    getGameEventById(\"someonesTrash\").hasTriggered(state)\r\n      ? !someonesTrashBookStoryline.isCompletedThisRun(state) &&\r\n        !someonesTrashTreasureStoryline.isCompletedThisRun(state)\r\n        ? t(\"Explore the Sewers\")\r\n        : t(\"Explore the Sewers, but you cannot get it this run\")\r\n      : t(\"Explore the Sewers\"),\r\n  t(\"Start runs with a Wizard's Hat accessory\"),\r\n  (_state) => true,\r\n);\r\n\r\nconst someonesTrashTreasureStoryline = new Storyline(\r\n  \"someonesTrashTreasure\",\r\n  t(\"Somebody's Trash (Treasure Chest)\"),\r\n  252,\r\n  20,\r\n  (state) =>\r\n    getGameEventById(\"someonesTrash\").hasTriggered(state)\r\n      ? !someonesTrashBookStoryline.isCompletedThisRun(state) &&\r\n        !someonesTrashHatStoryline.isCompletedThisRun(state)\r\n        ? t(\"Explore the Sewers\")\r\n        : t(\"Explore the Sewers, but you cannot get it this run\")\r\n      : t(\"Explore the Sewers\"),\r\n  t(\"Start with your :coins: storage filled up\"),\r\n  (_state) => true,\r\n);\r\n\r\nexport function loadSomeonesTrash() {\r\n  Storylines.register(someonesTrashBookStoryline);\r\n  Storylines.register(someonesTrashHatStoryline);\r\n  Storylines.register(someonesTrashTreasureStoryline);\r\n\r\n  const someonesTrashEventBuilder = buildEvent(\r\n    \"someonesTrash\",\r\n    t(\"(Storyline) Somebody's Trash\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds([\r\n    someonesTrashBookStoryline.getId(),\r\n    someonesTrashHatStoryline.getId(),\r\n    someonesTrashTreasureStoryline.getId(),\r\n  ]);\r\n\r\n  someonesTrashEventBuilder.message(\r\n    t(`On your exploration of the Sewers, you notice your hired wizard falling back, staring at the canal on the tunnel you are traversing. You call to her to come, but she instead tells *you* to do so instead.\r\n    \r\n\"Look\", she exclaims. \"There are a lot of magical items here!\"\r\n\r\nYou are roughly able to see something at the bottom. Except, it looks like a pile of trash, stuck side-by-side on the canal.`),\r\n  );\r\n  someonesTrashEventBuilder.message(\r\n    t(\r\n      `You tell her that it looks worthless, but she shakes her head. \"No, you are mistaken\", she says. \"There's so many valuable things here. Look at that book, for example - it is a Magical Encyclopedia. I can't tell exactly what the contents are, though. Or that hat - it's actually a traditional Wizard's Hat, a powerful, handy way to generate more :mana:. Or even that treasure chest - I don't think it'd have anything in there, but I can sense it's enchanted. This must have been some Wizard's trash.\"\r\n      \r\nA Wizard's trash? Hmm... If the Wizard trashed them, isn't there a good reason why? But why would all of them be together *here*? Perhaps something happened to the Wizard...?`,\r\n    ),\r\n  );\r\n  someonesTrashEventBuilder\r\n    .message(\r\n      t(`Your hired wizard continues: \"They look terrible now, but I'm sure I can restore those items! It could be useful!\"\r\n\r\nAnd you also remember something you had heard before: *\"Somebody's trash is somebody else's treasure\".* But you don't feel very good about that...\r\n      \r\nTelling yourself that it's for her sake, you decide to humor her - to grab those items. But in order to do that, you need a way to go down to the canal safely - and back up, of course.`),\r\n    )\r\n    .option(\r\n      t(\"Build a ladder (Requires Lv16 Earth, 25K Earth Essence, 3000 Mana)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = grantResource(Resource.EarthEssence, -25000)(state);\r\n          state = grantResource(Resource.Mana, -3000)(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) => {\r\n          return (\r\n            getResourceAmount(state, Resource.EarthEssence) >= 25000 &&\r\n            getResourceAmount(state, Resource.Mana) >= 3000 &&\r\n            getElementLevel(state, SpellElement.Earth) >= 16\r\n          );\r\n        },\r\n      },\r\n      \"boughtLadder\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  someonesTrashEventBuilder\r\n    .message(\r\n      t(`You carefully lay down the ladder on the side of the canal, and climb down, beginning to wade through the dirty waters.\r\n  \r\nYou reach for the pile of stuck items, and think of which you should take first...`),\r\n    )\r\n    .tag(\"boughtLadder\")\r\n    .option(\r\n      t(\"Take the Book\"),\r\n      {\r\n        transform: (state) => someonesTrashBookStoryline.complete(state),\r\n        isVisible: (state) => !someonesTrashBookStoryline.isCompleted(state),\r\n      },\r\n      \"book\",\r\n    )\r\n    .option(\r\n      t(\"Take the Hat\"),\r\n      {\r\n        transform: (state) => someonesTrashHatStoryline.complete(state),\r\n        isVisible: (state) => !someonesTrashHatStoryline.isCompleted(state),\r\n      },\r\n      \"hat\",\r\n    )\r\n    .option(\r\n      t(\"Take the Treasure Chest\"),\r\n      {\r\n        transform: (state) => someonesTrashTreasureStoryline.complete(state),\r\n        isVisible: (state) =>\r\n          !someonesTrashTreasureStoryline.isCompleted(state),\r\n      },\r\n      \"treasure\",\r\n    )\r\n    .option(t(\"Decide later\"))\r\n    .end();\r\n\r\n  someonesTrashEventBuilder\r\n    .message(\r\n      t(`You try to pull off the book from the pile. It appears to be stuck! You pull harder, but then it finally comes out - and it breaks the rest of the pile of trash, which is no longer stuck and starts floating downstream at a pretty dangerous rate! Your hired wizard yells at you and you run for the ladder. You climb with great speed and manage to make it up before the ladder, too, is swept from the current.\r\n      \r\nYou hand over the book to your hired wizard. It is in a terrible condition. \"Ugh\", she says with disgust, \"I should be able to restore this, but it will take me a long time. I'm sorry.\" You obviously understand, but that felt very dangerous. You should be more careful in the future.\r\n\r\n**You have completed the \"Somebody's Trash (Book)\" Storyline! In future runs, the book will have been restored and will make you earn +25% Exp from Studying!**`),\r\n    )\r\n    .tag(\"book\")\r\n    .end();\r\n\r\n  someonesTrashEventBuilder\r\n    .message(\r\n      t(`You try to pull off the hat from the pile. It appears to be stuck! You pull harder, but then it finally comes out - and it breaks the rest of the pile of trash, which is no longer stuck and starts floating downstream at a pretty dangerous rate! Your hired wizard yells at you and you run for the ladder. You climb with great speed and manage to make it up before the ladder, too, is swept from the current.\r\n      \r\nYou hand over the hat to your hired wizard. It is in a terrible condition. \"Ugh\", she says with disgust, \"I should be able to restore this, but it will take me a long time. I'm sorry.\" You obviously understand, but that felt very dangerous. You should be more careful in the future.\r\n\r\n**You have completed the \"Somebody's Trash (Hat)\" Storyline! In future runs, you will start with a Wizard's Hat!**`),\r\n    )\r\n    .tag(\"hat\")\r\n    .end();\r\n\r\n  someonesTrashEventBuilder\r\n    .message(\r\n      t(`You try to pull off the treasure chest from the pile. It appears to be stuck! You pull harder, but then it finally comes out - and it breaks the rest of the pile of trash, which is no longer stuck and starts floating downstream at a pretty dangerous rate! Your hired wizard yells at you and you run for the ladder. You climb with great speed and manage to make it up before the ladder, too, is swept from the current.\r\n      \r\nYou hand over the treasure chest to your hired wizard. It is in a terrible condition. \"Ugh\", she says with disgust, \"I should be able to restore this, but it will take me a long time. I'm sorry.\" You obviously understand, but that felt very dangerous. You should be more careful in the future.\r\n\r\n**You have completed the \"Somebody's Trash (Treasure)\" Storyline! In future runs, the enchanted treasure chest will make you start with your Coins storage completely full!**`),\r\n    )\r\n    .tag(\"treasure\")\r\n    .end();\r\n\r\n  const someonesTrashEvent = someonesTrashEventBuilder.build();\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.ExpGain, TransformationTags.Study]],\r\n    \"someonesTrashBook\",\r\n    someonesTrashBookStoryline.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => (someonesTrashBookStoryline.isBonusActive(state) ? 1.25 : 1.0),\r\n  );\r\n\r\n  registerPostRetirementListener(\"someonesTrashHat\", (state) => {\r\n    if (someonesTrashHatStoryline.isBonusActive(state)) {\r\n      state = addToInventory(\r\n        { itemId: wizardsHat.getId(), params: {} },\r\n        1,\r\n        state,\r\n      );\r\n    }\r\n    return state;\r\n  });\r\n\r\n  // Cannot be done via post-retirement as it has to happen after other post-retirement events\r\n  addGameStateListener(\"someonesTrashTreasure\", (state) => {\r\n    if (\r\n      someonesTrashTreasureStoryline.isBonusActive(state) &&\r\n      !hasFlag(state, Flag.SomeonesTrashTreasureGranted)\r\n    ) {\r\n      return (s) => {\r\n        s = setFlag(Flag.SomeonesTrashTreasureGranted)(s);\r\n        s = grantResource(Resource.Coins, Infinity)(s);\r\n        return s;\r\n      };\r\n    }\r\n  });\r\n\r\n  registerRandomEventTrigger(\r\n    someonesTrashEvent,\r\n    40,\r\n    (state) =>\r\n      !someonesTrashEvent.hasTriggered(state) &&\r\n      [\r\n        someonesTrashBookStoryline,\r\n        someonesTrashHatStoryline,\r\n        someonesTrashTreasureStoryline,\r\n      ].some((storyline) => !storyline.isCompleted(state)) &&\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      sewers.getDungeonFloors().includes(getCurrentDungeonFloor(state)),\r\n  );\r\n}\r\n\r\nexport {\r\n  someonesTrashBookStoryline,\r\n  someonesTrashHatStoryline,\r\n  someonesTrashTreasureStoryline,\r\n};\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { ManaSpout } from \"../../../buildings/mana/ManaSpout\";\r\nimport { trainingTowers } from \"../../../exploration/dungeons/training/TrainingTowers\";\r\nimport { getCurrentDungeonFloor } from \"../../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../../exploration/ExplorationUtils\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport { getElementLevel, SpellElement } from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { registerRandomEventTrigger } from \"../../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst advancedManaSpoutsStoryline = new Storyline(\r\n  \"advancedManaSpouts\",\r\n  t(\"Advanced Mana Spouts\"),\r\n  130,\r\n  10,\r\n  (state) => t(\"Explore the Training Towers\"),\r\n  t(\"+30% effectivity and -30% cost scaling of Mana Spouts\"),\r\n  (_state) => true,\r\n);\r\n\r\nexport function loadAdvancedManaSpouts() {\r\n  Storylines.register(advancedManaSpoutsStoryline);\r\n\r\n  const advancedManaSpoutsEventBuilder = buildEvent(\r\n    \"advancedManaSpouts\",\r\n    t(\"(Storyline) Advanced Mana Spouts\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(advancedManaSpoutsStoryline.getId());\r\n\r\n  advancedManaSpoutsEventBuilder.message(\r\n    t(`Continuing to climb the Tower of Training and fend enemies left and right, you happen across someone else. It is your old teacher from Wizardry Furniture! His large figure always stood out, easily towering over everyone else in the class. You greet him, and he waves at you.\r\n    \r\nYou hold some conversation. He appears interested in how you are setting up your furniture at home. You tell him about your Mana Spouts and how you build them. But then he makes a sour face. Did you say something wrong?`),\r\n  );\r\n  advancedManaSpoutsEventBuilder\r\n    .message(\r\n      t(\r\n        `He explains that you're doing well with your home, but he realized that you are using very basic construction techniques for the Mana Spouts. You've just been basing these off what you could deduce from your own notes, which you know were quite bad, so you are not too surprised.\r\n      \r\nHe agrees to teach you how to improve on it, but before that - he mentions that you are no longer a student at the school, and that you will have to both show him that you have the skill to understand the lesson, as well as pay him for the efforts.\r\n\r\nYou decide to think about it...`,\r\n      ),\r\n    )\r\n    .option(\r\n      t(\"Take the lesson (8000 Coins, Requires Lv10 Water and Lv10 Air)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = grantResource(Resource.Coins, -8000)(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) => {\r\n          return (\r\n            getResourceAmount(state, Resource.Coins) >= 8000 &&\r\n            getElementLevel(state, SpellElement.Water) >= 10 &&\r\n            getElementLevel(state, SpellElement.Air) >= 10\r\n          );\r\n        },\r\n      },\r\n      \"end\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  advancedManaSpoutsEventBuilder\r\n    .message(\r\n      t(\r\n        `You decide to take the lesson, and hand over the Coins he asked for. He appears satisfied, and guides you to a small room in the Tower that looks like a library. The shelves are lined up with books about furniture. He pulls out a single one, titled: \"Mana Spout Construction\".\r\n        \r\nSitting down at a table with you, he shows you some diagrams in the book and explains how the construction method differs. You are definitely able to understand this explanation - everything makes sense. This is how you should have built the Mana Spouts to begin with.`,\r\n      ),\r\n    )\r\n    .option(\r\n      \"Continue\",\r\n      {\r\n        transform: (state) => advancedManaSpoutsStoryline.complete(state),\r\n      },\r\n      \"final\",\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n  advancedManaSpoutsEventBuilder\r\n    .message(\r\n      t(\r\n        `After the lesson, you head back home. Your teacher said it was ok for you to take the book, so you store it in your bookshelf. It felt like a worthwhile lesson.\r\n\r\nYou are not sure if you are going to apply it - after all, it is quite a bit of trouble to implement. It is probably something that had to be done from the beginning. Regardless, if the chance ever comes up at some point, now you have a more effective way of doing it.\r\n\r\n**You have completed the \"Advanced Mana Spouts\" Storyline! In future runs, Mana Spouts will produce 30% more Mana and their cost will scale 30% slower!**`,\r\n      ),\r\n    )\r\n    .tag(\"final\");\r\n\r\n  const advancedManaSpoutsEvent = advancedManaSpoutsEventBuilder.build();\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Production, ManaSpout.getId()]],\r\n    \"advancedManaSpoutsProduction\",\r\n    advancedManaSpoutsStoryline.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => (advancedManaSpoutsStoryline.isBonusActive(state) ? 1.3 : 1.0),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.CostScale, ManaSpout.getId()]],\r\n    \"advancedManaSpoutsCostScale\",\r\n    advancedManaSpoutsStoryline.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => (advancedManaSpoutsStoryline.isBonusActive(state) ? 0.7 : 1.0),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    advancedManaSpoutsEvent,\r\n    40,\r\n    (state) =>\r\n      !advancedManaSpoutsStoryline.isCompleted(state) &&\r\n      !advancedManaSpoutsEvent.hasTriggered(state) &&\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      trainingTowers.getDungeonFloors().includes(getCurrentDungeonFloor(state)),\r\n  );\r\n}\r\n\r\nexport { advancedManaSpoutsStoryline };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { trainingTowers } from \"../../../exploration/dungeons/training/TrainingTowers\";\r\nimport { getCurrentDungeonFloor } from \"../../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../../exploration/ExplorationUtils\";\r\nimport { HealthPotion } from \"../../../items/equipment/pouch/HealthPotion\";\r\nimport {\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../../items/Inventory\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { registerRandomEventTrigger } from \"../../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst alchemyClassStoryline = new Storyline(\r\n  \"alchemyClass\",\r\n  t(\"Alchemy Class\"),\r\n  110,\r\n  10,\r\n  (state) => t(\"Explore the Training Towers\"),\r\n  t(\"Item {{item}} restores an extra +15:hp:\", {\r\n    item: HealthPotion.getBaseName(HealthPotion.getDefaultParams()),\r\n  }),\r\n  (_state) => true,\r\n);\r\n\r\nexport function loadAlchemyClass() {\r\n  Storylines.register(alchemyClassStoryline);\r\n\r\n  const alchemyClassEventBuilder = buildEvent(\r\n    \"alchemyClass\",\r\n    t(\"(Storyline) Alchemy Class\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(alchemyClassStoryline.getId());\r\n\r\n  alchemyClassEventBuilder.message(\r\n    t(`In the Tower of Training, you find a room that looks exactly like a classroom. You are not surprised to find such rooms - after all, this place is connected to your old magic school. You peek inside. The classroom appears to be empty, so you decide to go in.\r\n    \r\nYou look around the room. It is definitely something related to Alchemy, as evidenced by the giant cauldron in the front. It appears this place has been used recently.\r\n\r\nThen you hear a faint voice from behind you: *\"Is someone there?\"*`),\r\n  );\r\n  alchemyClassEventBuilder.message(\r\n    t(\r\n      `You turn around and find a lady of advanced age. She is dressed in the same way your teachers at your school were, but you never met her. You introduce yourself and tell her that you are doing the special combat training at this tower.\r\n        \r\n\"Admirable,\" she says. \"Do you know how to defeat difficult adversaries? Perhaps the most important items in that situation are potions. Even if you cannot tell others to help you drink them, you do not need Mana to do so, so you can stay focused on using powerful spells. At the same time, among those, Health Potions are *particularly* important - they let you stay alive and heal your wounds.\"\r\n\r\nYou intently listen to her lecture.`,\r\n    ),\r\n  );\r\n\r\n  alchemyClassEventBuilder\r\n    .message(\r\n      t(`\"It just so happens that these potions are my specialty. I know how to make them particularly strong, but if you'd like me to teach you, you'll first have to show me that you have enough experience to understand my explanation.\"\r\n  \r\nShe then asks you: \"Show me that you can do this. Bring me 6 Health Potions, and I will consider telling you about it.\"\r\n\r\nShe starts turning back on you, but right before she does so, she interrupts herself to say one last thing: \"Oh, and - in case you didn't know - you can transmute Health Potions by having Water Lv6 or higher.\"`),\r\n    )\r\n    .option(\r\n      t(\"Hand over the potions (6 Health Potion)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = removeFromInventoryWithAnyParams(HealthPotion, 6, state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) => {\r\n          return getTotalAmountOfItem(HealthPotion, state) >= 6;\r\n        },\r\n      },\r\n      \"end\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n  alchemyClassEventBuilder\r\n    .message(\r\n      t(\r\n        `You hand over the potions to the teacher. She is delighted: \"Wonderful! You must have really learned Alchemy well at school.\" You are tempted to tell her that you only just learned how to make these potions recently, after finishing the school, but you keep it to yourself.\r\n        \r\n\"I will now tell you the secret technique to making Health Potions,\" she says. You begin taking notes in a frenzy as she goes through detailed explanations of how and when to combine the ingredients of the potion, as well as how to pre-treat the Wildgrass.\r\n\r\nWhen she is finally done, you thank her for the lesson and head back out.`,\r\n      ),\r\n    )\r\n    .option(\r\n      \"Continue\",\r\n      {\r\n        transform: (state) => alchemyClassStoryline.complete(state),\r\n      },\r\n      \"final\",\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n  alchemyClassEventBuilder\r\n    .message(\r\n      t(\r\n        `When you get home again, you are ready to put it into practice. Except when you look at your notes again, they don't make too much sense. Your hired Wizard looks at you with interest and glances over your notes, before exclaiming: \"I can't make heads or tails of what you wrote!\".\r\n\r\nYou have a small argument with her over the rude comment, but she is admittedly right - you feel disappointed in yourself. Perhaps in the future someone else can understand these? You get back to doing what you were doing before.\r\n\r\n**You have completed the \"Alchemy Class\" Storyline! In future runs, Health Potions will heal an extra 15:hp:!**`,\r\n      ),\r\n    )\r\n    .tag(\"final\");\r\n\r\n  const alchemyClassEvent = alchemyClassEventBuilder.build();\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.ItemEffect, HealthPotion.getId()]],\r\n    \"alchemyClass\",\r\n    alchemyClassStoryline.getName(),\r\n    TransformationType.Addition,\r\n    (state) => (alchemyClassStoryline.isBonusActive(state) ? 15 : 0),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    alchemyClassEvent,\r\n    40,\r\n    (state) =>\r\n      !alchemyClassStoryline.isCompleted(state) &&\r\n      !alchemyClassEvent.hasTriggered(state) &&\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      trainingTowers.getDungeonFloors().includes(getCurrentDungeonFloor(state)),\r\n  );\r\n}\r\n\r\nexport { alchemyClassStoryline };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { FLOOR_FOR_ELEMENT } from \"../../../exploration/dungeons/training/TrainingTowers\";\r\nimport {\r\n  addEnemyDeathListener,\r\n  getSuccessfulExplorationsForFloor,\r\n} from \"../../../exploration/Exploration\";\r\nimport {\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../../items/Inventory\";\r\nimport { Items } from \"../../../items/Items\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../../spells/channeling/ChannelingResources\";\r\nimport { SpellElement, translateElement } from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  IncomeOverTimeProducer,\r\n  IncomeOverTimeProducers,\r\n} from \"../../../timetick/IncomeOverTime\";\r\nimport { getOrCreateDungeonEventGroup } from \"../../DungeonEventGroup\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nfunction createStorylineForElement(element: SpellElement) {\r\n  return new Storyline(\r\n    \"essenceArtifact\" + element,\r\n    t(\"Essence Artifact ({{element}})\", { element: translateElement(element) }),\r\n    100 + enabledElements.indexOf(element),\r\n    10,\r\n    (state) =>\r\n      getOrCreateDungeonEventGroup(\"trainingTowers\")\r\n        .getSelectedEvent(state)\r\n        ?.getId() ==\r\n      \"essenceArtifact\" + element\r\n        ? t(\"Explore the Tower of {{element}} Training at least 60 times\", {\r\n            element: translateElement(element),\r\n          })\r\n        : t(\r\n            \"This Storyline can be found in the Training Towers, but you cannot get it this run\",\r\n          ),\r\n    t(\"+100{{essenceIcon}}/sec\", {\r\n      essenceIcon: `:${RESOURCE_FOR_ELEMENT[element].toLowerCase()}:`,\r\n    }),\r\n    (_state) => true,\r\n  );\r\n}\r\n\r\nconst enabledElements = [\r\n  SpellElement.Fire,\r\n  SpellElement.Earth,\r\n  SpellElement.Water,\r\n  SpellElement.Air,\r\n];\r\n\r\nconst essenceArtifactStorylines: Partial<Record<SpellElement, Storyline>> =\r\n  Object.fromEntries(\r\n    enabledElements.map((element) => [\r\n      element,\r\n      createStorylineForElement(element),\r\n    ]),\r\n  );\r\n\r\nexport function loadEssenceArtifact() {\r\n  const dungeonEventGroup = getOrCreateDungeonEventGroup(\"trainingTowers\");\r\n  for (let element of enabledElements) {\r\n    Storylines.register(essenceArtifactStorylines[element]);\r\n\r\n    const essenceArtifactEventBuilder = buildEvent(\r\n      \"essenceArtifact\" + element,\r\n      t(\"(Storyline) Essence Artifact ({{element}})\", {\r\n        element: translateElement(element),\r\n      }),\r\n      [EventTag.STORYLINE],\r\n    ).setStorylineIds(essenceArtifactStorylines[element].getId());\r\n\r\n    essenceArtifactEventBuilder.message(\r\n      t(\r\n        `Exploring the Tower of {{element}} Training, you find a strange small cauldron-like object. You find it odd, and haven't seen it before. You decide to bring it home to study it further.`,\r\n        { element: translateElement(element) },\r\n      ),\r\n    );\r\n    essenceArtifactEventBuilder\r\n      .message(\r\n        t(\r\n          `At home, you examine the object some more. It looks like an artifact of some sort. It is decorated with what you learned as the traditional symbols of {{element}}.\r\n    \r\nYou notice a small drawer / opening on the bottom. It appears like there are countless slots for... *something*. It seems like they are about the same size of an elemental shard. Perhaps you should try filling it up...?`,\r\n          { element: translateElement(element) },\r\n        ),\r\n      )\r\n      .option(\r\n        t(\"Insert elemental shards (100 {{element}} Shard)\", {\r\n          element: translateElement(element),\r\n        }),\r\n        {\r\n          transform: (state) => {\r\n            state = removeFromInventoryWithAnyParams(\r\n              Items.getById(\"elementalShard\" + element),\r\n              100,\r\n              state,\r\n            );\r\n            return state;\r\n          },\r\n          isEnabled: (state) => {\r\n            return (\r\n              getTotalAmountOfItem(\r\n                Items.getById(\"elementalShard\" + element),\r\n                state,\r\n              ) >= 100\r\n            );\r\n          },\r\n        },\r\n        \"end\",\r\n      )\r\n      .option(t(\"Maybe later\"))\r\n      .end();\r\n    essenceArtifactEventBuilder\r\n      .message(\r\n        t(\r\n          `You insert all the shards into the compartment, and align them one by one diligently. You then close the compartment, and wait. But nothing happens. Did you do something wrong?\r\n        \r\nYou turn around the object, and notice an inscription on the back side. How did you miss this? It says: *\"{{element}} Essence Materializer\"*. It sounds exciting. But then you notice more: *\"Charge Time: 30 Years\"*...`,\r\n          { element: translateElement(element) },\r\n        ),\r\n      )\r\n      .option(\r\n        \"Continue\",\r\n        {\r\n          transform: (state) =>\r\n            essenceArtifactStorylines[element].complete(state),\r\n        },\r\n        \"final\",\r\n      )\r\n      .tag(\"end\")\r\n      .end();\r\n    essenceArtifactEventBuilder\r\n      .message(\r\n        t(\r\n          `*What?* You will need to wait *30 years* for this to work? Changing your mind, you open the compartment to retrieve your shards. Or at least you *try* to - it appears to be locked! Even pulling strongly on it doesn't open it. It's as if it was fully sealed.\r\n          \r\nYou sigh deeply. Perhaps you shouldn't be taking random artifacts from places and playing with them. You quickly perish the thought - what if any of those were hints on how to obtain the Philosopher's Stone? Regardless, you put away the artifact, resigned that you won't be able to do anything with it...\r\n\r\n**You have completed the \"Essence Artifact ({{element}})\" Storyline! In future runs, you will gain a permanent +100{{essenceIcon}}/sec!**`,\r\n          {\r\n            element: translateElement(element),\r\n            essenceIcon:\r\n              \":\" + RESOURCE_FOR_ELEMENT[element].toLowerCase() + \":\",\r\n          },\r\n        ),\r\n      )\r\n      .tag(\"final\");\r\n\r\n    const essenceArtifactEvent = essenceArtifactEventBuilder.build();\r\n    const dungeonFloor = FLOOR_FOR_ELEMENT[element];\r\n\r\n    addEnemyDeathListener(\r\n      essenceArtifactEvent.getId() + \"Triggerer\",\r\n      (state) => {\r\n        const selectedEvent = dungeonEventGroup.getSelectedEvent(state);\r\n        if (\r\n          selectedEvent == essenceArtifactEvent &&\r\n          !essenceArtifactStorylines[element].isCompleted(state) &&\r\n          !essenceArtifactEvent.hasTriggered(state) &&\r\n          getSuccessfulExplorationsForFloor(state, dungeonFloor.getId()) >= 60\r\n        ) {\r\n          return triggerEvent(essenceArtifactEvent)(state);\r\n        }\r\n        return state;\r\n      },\r\n    );\r\n\r\n    IncomeOverTimeProducers.register(\r\n      new IncomeOverTimeProducer(\r\n        \"incomeOverTime\" + element,\r\n        essenceArtifactStorylines[element].getName(),\r\n        (state) => {\r\n          const bonus = {};\r\n          if (essenceArtifactStorylines[element].isBonusActive(state)) {\r\n            bonus[RESOURCE_FOR_ELEMENT[element]] = 100;\r\n          }\r\n          return bonus;\r\n        },\r\n      ),\r\n    );\r\n\r\n    dungeonEventGroup.addEvent({\r\n      event: essenceArtifactEvent,\r\n      getWeight: (state) => {\r\n        if (essenceArtifactStorylines[element].isCompleted(state)) {\r\n          return 0;\r\n        }\r\n        return 100;\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport { essenceArtifactStorylines };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { jumpEventToMessageIfExists } from \"../../../events/Events\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { StoneskinTemporaryEffect } from \"../../../spells/earth/Stoneskin\";\r\nimport { StrengthTemporaryEffect } from \"../../../spells/fire/Strength\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport { AttackTarget } from \"../../AttackTarget\";\r\nimport {\r\n  getCurrentEnemyHPFraction,\r\n  standardEnemyAttackEffect,\r\n} from \"../../Exploration\";\r\nimport { BattlerAction, BattlerStats, Enemy, EnemyLoot } from \"../Enemy\";\r\n\r\nclass KnightInShiningArmor extends Enemy {\r\n  getId(): string {\r\n    return \"knightInShiningArmor\";\r\n  }\r\n\r\n  getName(): string {\r\n    return t(\"Knight in Shining Armor\");\r\n  }\r\n\r\n  getBaseStats(): BattlerStats {\r\n    return {\r\n      maxHP: 1000,\r\n      attack: 25,\r\n      defense: 20,\r\n      attackDelay: 3.3,\r\n      accuracy: 100,\r\n      dodge: 100,\r\n      crit: 0,\r\n    };\r\n  }\r\n\r\n  getPicture(state: GameState) {\r\n    return require(\"./knightInShiningArmor.png\");\r\n  }\r\n\r\n  getLevel(): number {\r\n    return 5;\r\n  }\r\n\r\n  getCoinsAwardedBase(state: GameState): number {\r\n    return 100;\r\n  }\r\n\r\n  getMonstiumAwardedBase(state: GameState): number {\r\n    return 1;\r\n  }\r\n\r\n  getNextAction(state: GameState): BattlerAction {\r\n    if (\r\n      !hasTemporaryEffect(\r\n        state,\r\n        StoneskinTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      ) &&\r\n      getCurrentEnemyHPFraction(state) > 0.5 &&\r\n      Math.random() < 0.5\r\n    ) {\r\n      return {\r\n        name: t(\"Stoneskin\"),\r\n        delay: this.getAttackDelay(state) * 1.2,\r\n        transform: grantTemporaryEffect(StoneskinTemporaryEffect.getId(), 30, {\r\n          target: AttackTarget.Enemy,\r\n          params: { commonBuff: { DefenseMultiplier: 1.75 } },\r\n        }),\r\n      };\r\n    }\r\n    if (\r\n      Math.random() < 0.5 &&\r\n      getCurrentEnemyHPFraction(state) < 0.5 &&\r\n      !hasTemporaryEffect(\r\n        state,\r\n        StrengthTemporaryEffect.getId(),\r\n        AttackTarget.Enemy,\r\n      )\r\n    ) {\r\n      return {\r\n        name: t(\"Strength\"),\r\n        delay: this.getAttackDelay(state) * 1.2,\r\n        transform: (state) =>\r\n          grantTemporaryEffect(StrengthTemporaryEffect.getId(), 30, {\r\n            target: AttackTarget.Enemy,\r\n            params: { commonBuff: { AttackMultiplier: 1.25 } },\r\n          })(state),\r\n      };\r\n    }\r\n\r\n    if (Math.random() < 0.2 && getCurrentEnemyHPFraction(state) < 0.3) {\r\n      return {\r\n        name: t(\"Triple Attack\"),\r\n        delay: this.getAttackDelay(state) * 1.2,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.7);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    if (Math.random() < 0.3) {\r\n      return {\r\n        name: t(\"Double Attack\"),\r\n        delay: this.getAttackDelay(state) * 1.1,\r\n        transform: (state) => {\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          state = standardEnemyAttackEffect(state, this.getAttack(state) * 0.8);\r\n          return state;\r\n        },\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: t(\"Attack\"),\r\n      delay: this.getAttackDelay(state),\r\n      transform: (state) =>\r\n        standardEnemyAttackEffect(state, this.getAttack(state)),\r\n    };\r\n  }\r\n\r\n  isBoss(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getItemsAwardedBase(state: GameState): EnemyLoot[] {\r\n    return [];\r\n  }\r\n\r\n  onDeath(\r\n    state: GameState,\r\n    isFromCreatures: boolean,\r\n    familiarId?: string,\r\n  ): GameState {\r\n    state = super.onDeath(state, isFromCreatures, familiarId);\r\n    state = jumpEventToMessageIfExists(state, \"howToFight\", \"afterFight\");\r\n    return state;\r\n  }\r\n\r\n  getTips(): string {\r\n    return t(\r\n      \"Wow... so gallant! I wish he had come for me instead! In any case... he likes to attack multiple times in a row, but the attacks are weaker than a normal attack. High :defense: armor is pretty effective, but make sure you also have a way to heal, like with Health Potions - you might need Water Lv6 for that. It's obvious he is going easy on you!\",\r\n    );\r\n  }\r\n}\r\n\r\nexport default new KnightInShiningArmor();\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { getAccumulatorVariable } from \"../../../AccumulatorVariables\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../../exploration/CombatStats\";\r\nimport KnightInShiningArmor from \"../../../exploration/enemies/training/KnightInShiningArmor\";\r\nimport {\r\n  modifyPlayerCurrentHP,\r\n  startCombat,\r\n} from \"../../../exploration/Exploration\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { addUICommand } from \"../../../UICommands\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { getGameEventById, triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst howToFightHPStoryline = new Storyline(\r\n  \"howToFightHP\",\r\n  t(\"How to Fight (HP)\"),\r\n  140,\r\n  10,\r\n  (state) =>\r\n    getGameEventById(\"howToFight\").hasTriggered(state)\r\n      ? t(\r\n          \"Lose in battle at least 20 times; however, you cannot trigger it again this run\",\r\n        )\r\n      : t(\"Lose in battle at least 20 times\"),\r\n  t(\"+30 Max:hp:\"),\r\n  (_state) => true,\r\n);\r\n\r\nconst howToFightAttackStoryline = new Storyline(\r\n  \"howToFightAttack\",\r\n  t(\"How to Fight (Attack)\"),\r\n  141,\r\n  10,\r\n  (state) =>\r\n    getGameEventById(\"howToFight\").hasTriggered(state)\r\n      ? t(\r\n          \"Lose in battle at least 20 times; however, you cannot trigger it again this run\",\r\n        )\r\n      : t(\"Lose in battle at least 20 times\"),\r\n  t(\"+10:attack:\"),\r\n  (_state) => true,\r\n);\r\n\r\nconst howToFightDefenseStoryline = new Storyline(\r\n  \"howToFightDefense\",\r\n  t(\"How to Fight (Defense)\"),\r\n  142,\r\n  10,\r\n  (state) =>\r\n    getGameEventById(\"howToFight\").hasTriggered(state)\r\n      ? t(\r\n          \"Lose in battle at least 20 times; however, you cannot trigger it again this run\",\r\n        )\r\n      : t(\"Lose in battle at least 20 times\"),\r\n  t(\"+10:defense:\"),\r\n  (_state) => true,\r\n);\r\n\r\nconst howToFightAttackDelayStoryline = new Storyline(\r\n  \"howToFightAttackDelay\",\r\n  t(\"How to Fight (Speed)\"),\r\n  143,\r\n  10,\r\n  (state) =>\r\n    getGameEventById(\"howToFight\").hasTriggered(state)\r\n      ? t(\r\n          \"Lose in battle at least 20 times; however, you cannot trigger it again this run\",\r\n        )\r\n      : t(\"Lose in battle at least 20 times\"),\r\n  t(\"-5%:attackDelay:\"),\r\n  (_state) => true,\r\n);\r\n\r\nexport function loadHowToFight() {\r\n  Storylines.register(howToFightHPStoryline);\r\n  Storylines.register(howToFightAttackStoryline);\r\n  Storylines.register(howToFightDefenseStoryline);\r\n  Storylines.register(howToFightAttackDelayStoryline);\r\n\r\n  const howToFightEventBuilder = buildEvent(\r\n    \"howToFight\",\r\n    t(\"(Storyline) How to Fight\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds([\r\n    howToFightHPStoryline.getId(),\r\n    howToFightAttackStoryline.getId(),\r\n    howToFightDefenseStoryline.getId(),\r\n    howToFightAttackDelayStoryline.getId(),\r\n  ]);\r\n\r\n  howToFightEventBuilder.message(\r\n    t(`*Ouch*. You have had to run away from combat so many times. As you nurse your wounds yet again at home, you hear a knock on the door. Your hired wizard checks it out, but she exclaims in a dreamy voice: \"It is a *knight in shining armor*!\"\r\n    \r\nYou feel she is probably just pulling your leg, so you decide to head up to the door and open it. But she was not. She was speaking the truth. You come face to face with what you can just describe as... a knight in shining armor.`),\r\n  );\r\n  howToFightEventBuilder.message(\r\n    t(\r\n      `\"Salutations,\" he says, removing his helmet. \"I am a combat trainer, and I have observed your recent battle.\" He continues: \"I know some more advanced ways to fight, which can definitely help level the playfield. I can teach some of them to you, if you'd like.\"\r\n      \r\nYou agree that would be a good idea. You ask him about prices, but he shakes his head: \"I don't take pleasure in benefiting from those in need.\" You don't really understand this person. But their armor and movements appear very skilled, so you're inclined to believe him.\r\n\r\nYour hired wizard watches you, from a distance, but she seems more enthralled with the knight than anything else.`,\r\n    ),\r\n  );\r\n  howToFightEventBuilder\r\n    .message(\r\n      t(`\"However\", he says, \"you will first need to show me that you can at least handle some basic combat. Let's have a short duel - *don't worry, I will not use my full strength* - and if you are able to win, I'll teach you some advanced combat techniques.\"\r\n    \r\nYou are now wary of him. He looks very strong. Is this really going to be possible?\r\n\r\n\"I will heal you before we begin, but otherwise, make sure you are ready for combat before we duel\", he finishes saying, before putting his helmet back on. You heed his words, and ready up for combat.`),\r\n    )\r\n    .option(t(\"Fight the Knight in Shining Armor\"), {\r\n      transform: (state) => {\r\n        state = addUICommand(state, \"goToExploration\");\r\n        state = addUICommand(state, \"closeAllMenus\");\r\n        state = addUICommand(state, \"closeEventOverlay\");\r\n        state = modifyPlayerCurrentHP(\r\n          state,\r\n          Infinity,\r\n          t(\"Healing from the Knight in Shining Armor\"),\r\n        );\r\n        state = startCombat(KnightInShiningArmor)(state);\r\n        return state;\r\n      },\r\n    })\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  howToFightEventBuilder\r\n    .message(\r\n      t(`The fighting feels intense. You hear your hired wizard rooting for the knight, but you are too focused on the fight to argue with her.\r\n    \r\nYou wipe your sweat from your face and ready to strike again at the knight, but he tells you to stop. \"That's enough,\" he shouts. You back off, and take a deep breath, putting down your weapon just as he does.`),\r\n    )\r\n    .tag(\"afterFight\");\r\n\r\n  howToFightEventBuilder\r\n    .message(\r\n      t(`The knight removes his helmet once again, and tells you: \"That was a pretty good job. I'd be happy to teach you now.\" You feel like you need to continue releasing the tension from the fight. You are not sure how he can be so unfazed.\r\n    \r\nHe continues: \"Please tell me what kind of combat techniques you would like to learn.\"`),\r\n    )\r\n    .option(\r\n      t(\"More vitality (Max HP)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = howToFightHPStoryline.complete(state);\r\n          state = howToFightHPStoryline.activateBonus(state);\r\n          state = clearCombatStatCache(state, AttackTarget.Player);\r\n          return state;\r\n        },\r\n        isVisible: (state) => !howToFightHPStoryline.isCompleted(state),\r\n      },\r\n      \"maxHP\",\r\n    )\r\n    .option(\r\n      t(\"More power (Attack)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = howToFightAttackStoryline.complete(state);\r\n          state = howToFightAttackStoryline.activateBonus(state);\r\n          state = clearCombatStatCache(state, AttackTarget.Player);\r\n          return state;\r\n        },\r\n        isVisible: (state) => !howToFightAttackStoryline.isCompleted(state),\r\n      },\r\n      \"attack\",\r\n    )\r\n    .option(\r\n      t(\"More resilience (Defense)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = howToFightDefenseStoryline.complete(state);\r\n          state = howToFightDefenseStoryline.activateBonus(state);\r\n          state = clearCombatStatCache(state, AttackTarget.Player);\r\n          return state;\r\n        },\r\n        isVisible: (state) => !howToFightDefenseStoryline.isCompleted(state),\r\n      },\r\n      \"defense\",\r\n    )\r\n    .option(\r\n      t(\"More speed (Attack Delay)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = howToFightAttackDelayStoryline.complete(state);\r\n          state = howToFightAttackDelayStoryline.activateBonus(state);\r\n          state = clearCombatStatCache(state, AttackTarget.Player);\r\n          return state;\r\n        },\r\n        isVisible: (state) =>\r\n          !howToFightAttackDelayStoryline.isCompleted(state),\r\n      },\r\n      \"attackDelay\",\r\n    )\r\n    .end();\r\n\r\n  howToFightEventBuilder\r\n    .message(\r\n      t(`You tell the trainer you would like to be more healthy throughout and outside of battle. With a nod, he proceeds to tell you how to better take care of your body to endure more wounds and be able to heal quicker. You listen intently and take notes.\r\n    \r\nAfter the exchange, you thank him for his services. With those tips, you are sure you will be much more healthy in the future.\r\n\r\n**You have completed the \"How to Fight (HP)\" Storyline! You will permanently gain +30 Max:hp:. This will persist even after retirement!**`),\r\n    )\r\n    .tag(\"maxHP\")\r\n    .end();\r\n  howToFightEventBuilder\r\n    .message(\r\n      t(`You tell the trainer you would like to be more powerful and able to deal more damage to enemies with your attacks. With a nod, he proceeds to tell you how to better swing your weapon and position yourself in order to apply more power to your movement. You listen intently and take notes.\r\n    \r\nAfter the exchange, you thank him for his services. With those tips, you are sure you will be able to gain an upper hand over enemies in the future.\r\n\r\n**You have completed the \"How to Fight (Attack)\" Storyline! You will permanently gain +10:attack:. This will persist even after retirement!**`),\r\n    )\r\n    .tag(\"attack\")\r\n    .end();\r\n  howToFightEventBuilder\r\n    .message(\r\n      t(`You tell the trainer you would like to be more resilient against enemy attacks. With a nod, he proceeds to tell you how to strengthen your muscles and harden your body to become more impervious to damage. You listen intently and take notes.\r\n    \r\nAfter the exchange, you thank him for his services. With those tips, you are sure you will be able to endure onslaughts much more effectively.\r\n\r\n**You have completed the \"How to Fight (Defense)\" Storyline! You will permanently gain +10:defense:. This will persist even after retirement!**`),\r\n    )\r\n    .tag(\"defense\")\r\n    .end();\r\n  howToFightEventBuilder\r\n    .message(\r\n      t(`You tell the trainer you would like to be speedier in your movements in combat. With a nod, he proceeds to tell you how to gracefully switch positions from one to the next and how to make your attacks flow into the next one effortlessly. You listen intently and take notes.\r\n    \r\nAfter the exchange, you thank him for his services. With those tips, you are sure you will be able to approach combat with increased agility.\r\n\r\n**You have completed the \"How to Fight (Speed)\" Storyline! You will permanently gain -5%:attackDelay:. This will persist even after retirement!**`),\r\n    )\r\n    .tag(\"attackDelay\")\r\n    .end();\r\n\r\n  const howToFightEvent = howToFightEventBuilder.build();\r\n\r\n  addGameStateListener(\"howToFightEventTriggerer\", (state) => {\r\n    // For perf\r\n    if (hasFlag(state, \"howToFightIsDone\")) {\r\n      return;\r\n    }\r\n    if (\r\n      [\r\n        howToFightHPStoryline,\r\n        howToFightAttackStoryline,\r\n        howToFightDefenseStoryline,\r\n        howToFightAttackDelayStoryline,\r\n      ].every((storyline) => storyline.isCompleted(state))\r\n    ) {\r\n      return setFlag(\"howToFightIsDone\");\r\n    }\r\n\r\n    if (\r\n      !howToFightEvent.hasTriggered(state) &&\r\n      getAccumulatorVariable(state, \"deathCount\") >= 20 &&\r\n      [\r\n        howToFightHPStoryline,\r\n        howToFightAttackStoryline,\r\n        howToFightDefenseStoryline,\r\n        howToFightAttackDelayStoryline,\r\n      ].some((storyline) => !storyline.isCompleted(state))\r\n    ) {\r\n      state = setFlag(\"howToFightIsDone\")(state);\r\n      return triggerEvent(howToFightEvent);\r\n    }\r\n  });\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.MaxHP]],\r\n    \"howToFightHP\",\r\n    howToFightHPStoryline.getName(),\r\n    TransformationType.Addition,\r\n    (state) => (howToFightHPStoryline.isBonusActive(state) ? 30 : 0),\r\n  );\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.Attack]],\r\n    \"howToFightAttack\",\r\n    howToFightAttackStoryline.getName(),\r\n    TransformationType.Addition,\r\n    (state) => (howToFightAttackStoryline.isBonusActive(state) ? 10 : 0),\r\n  );\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.Defense]],\r\n    \"howToFightDefense\",\r\n    howToFightDefenseStoryline.getName(),\r\n    TransformationType.Addition,\r\n    (state) => (howToFightDefenseStoryline.isBonusActive(state) ? 10 : 0),\r\n  );\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n    \"howToFightAttackDelay\",\r\n    howToFightAttackDelayStoryline.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      howToFightAttackDelayStoryline.isBonusActive(state) ? 0.95 : 1.0,\r\n  );\r\n}\r\n\r\nexport {\r\n  howToFightAttackDelayStoryline,\r\n  howToFightAttackStoryline,\r\n  howToFightDefenseStoryline,\r\n  howToFightHPStoryline,\r\n};\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { FLOOR_FOR_ELEMENT } from \"../../../exploration/dungeons/training/TrainingTowers\";\r\nimport { getCurrentDungeonFloor } from \"../../../exploration/Exploration\";\r\nimport { ExplorationStatus } from \"../../../exploration/ExplorationStatus\";\r\nimport { getExplorationStatus } from \"../../../exploration/ExplorationUtils\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { getResourceAmount, grantResource, Resource } from \"../../../Resources\";\r\nimport {\r\n  getElementLevel,\r\n  SpellElement,\r\n  translateElement,\r\n} from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { registerRandomEventTrigger } from \"../../autorandom/RandomEventTrigger\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nfunction elementToUse(state: GameState): SpellElement {\r\n  return [\r\n    SpellElement.Fire,\r\n    SpellElement.Earth,\r\n    SpellElement.Water,\r\n    SpellElement.Air,\r\n  ].includes(state.run.primaryElement)\r\n    ? state.run.primaryElement\r\n    : SpellElement.Fire;\r\n}\r\n\r\nconst studentContestStoryline = new Storyline(\r\n  \"studentContest\",\r\n  t(\"The Student Contest\"),\r\n  120,\r\n  10,\r\n  (state) =>\r\n    t(\"Explore the Tower of {{element}} Training\", {\r\n      element: translateElement(elementToUse(state)),\r\n    }),\r\n  t(\"+5 extra Wizards\"),\r\n  (_state) => true,\r\n);\r\n\r\nexport function loadStudentContest() {\r\n  Storylines.register(studentContestStoryline);\r\n\r\n  const studentContestEventBuilder = buildEvent(\r\n    \"studentContest\",\r\n    t(\"(Storyline) Student Contest\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(studentContestStoryline.getId());\r\n\r\n  studentContestEventBuilder.message(\r\n    t(`Climbing the tower, as you climb yet another flight of stairs, you notice this floor is different. It is a large, flat floor, with no individual walls. But most interestingly, it is full of *students* - all gathered around a figure who is elevated, on a sort of stage. You hear the figure exclaim:\r\n    \r\n\"Show me that you can *really* handle /element/ for a big prize!\" From the voice, it sounds like an enthusiastic young man. Is he also a student as well?`),\r\n  );\r\n  studentContestEventBuilder\r\n    .message(\r\n      t(\r\n        `You head closer, and you start noticing that the students seem to be trying quite hard to cast /element/ spells - and yet you can't help but notice how much they are struggling.\r\n      \r\nYou feel like showing them how to really do it. You prepare your energy and ready yourself up for a spell.`,\r\n      ),\r\n    )\r\n    .option(\r\n      t(\"Cast a spell (1200 Mana, Requires /element/ Lv11)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = grantResource(Resource.Mana, -1200)(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) => {\r\n          return (\r\n            getResourceAmount(state, Resource.Mana) >= 1200 &&\r\n            getElementLevel(state, elementToUse(state)) >= 11\r\n          );\r\n        },\r\n      },\r\n      \"step1\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  studentContestEventBuilder\r\n    .message(\r\n      t(`You cast your spell! The crowd goes silent and glances at your direction. You appear to have gotten the attention of the young man at the stage.\r\n  \r\nHe exclaims, loudly: \"Quite impressive!\" But then challenges you again: \"However... can you do *even better* than that?\"\r\n\r\nIt looks like you are going to have to work harder...`),\r\n    )\r\n    .tag(\"step1\")\r\n    .option(\r\n      t(\"Cast a stronger spell (1500 Mana, Requires /element/ Lv14)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = grantResource(Resource.Mana, -1500)(state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) => {\r\n          return (\r\n            getResourceAmount(state, Resource.Mana) >= 1500 &&\r\n            getElementLevel(state, elementToUse(state)) >= 14\r\n          );\r\n        },\r\n      },\r\n      \"step2\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  studentContestEventBuilder\r\n    .message(\r\n      t(`With more concentration than last time, you unleash a new spell. It is much stronger this time. You hear the students wowing at you, amazed at your spell. Then the young man speaks again:\r\n  \r\n\"We have a *winner*! Please come forward to the stage for your prize,\" he shouts. It looks like that did the trick!\r\n\r\nYou climb the stage. The man pulls out a small gold medal and wraps it around your neck. \"Congratulations! Thank you for showing everyone how to truly use /element/!\"`),\r\n    )\r\n    .tag(\"step2\")\r\n    .option(\r\n      \"Continue\",\r\n      {\r\n        transform: (state) => studentContestStoryline.complete(state),\r\n      },\r\n      \"final\",\r\n    )\r\n    .end();\r\n\r\n  studentContestEventBuilder\r\n    .message(\r\n      t(`Back at home, you show the medal to your hired wizard. She squeals and appears very excited. \"That is *amazing*! You are so talented. I feel so honored to be working for you! And I'm sure others will too.\"\r\n  \r\nYou put the gold medal in a case and decide to display it. You are a little proud. You don't think it is really going to help you in the short term. But reputation builds up over time - you believe this achievement will benefit whoever might be next to take over this house.\r\n\r\n**You have completed the \"Student Contest\" Storyline! In future runs, you will get an extra 5 Wizards available - without the need to build Wizard Chambers for them - as soon as you meet your first Wizard!**`),\r\n    )\r\n    .tag(\"final\");\r\n\r\n  const studentContestEvent = studentContestEventBuilder.build();\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.WizardAmount]],\r\n    \"studentContest\",\r\n    studentContestStoryline.getName(),\r\n    TransformationType.Addition,\r\n    (state) => (studentContestStoryline.isBonusActive(state) ? 5 : 0),\r\n  );\r\n\r\n  registerRandomEventTrigger(\r\n    studentContestEvent,\r\n    65,\r\n    (state) =>\r\n      !studentContestStoryline.isCompleted(state) &&\r\n      !studentContestEvent.hasTriggered(state) &&\r\n      getExplorationStatus(state) != ExplorationStatus.None &&\r\n      getCurrentDungeonFloor(state) == FLOOR_FOR_ELEMENT[elementToUse(state)],\r\n    (state) => ({ element: translateElement(elementToUse(state)) }),\r\n  );\r\n}\r\n\r\nexport { studentContestStoryline };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Achievement } from \"../../../Achievement\";\r\nimport { registerAchievementUnlockerFromStoryline } from \"../../../Achievements\";\r\nimport { setDungeonFloorCompleted } from \"../../../exploration/dungeons/Dungeons\";\r\nimport TrainingTowerAir from \"../../../exploration/dungeons/training/TrainingTowerAir\";\r\nimport TrainingTowerEarth from \"../../../exploration/dungeons/training/TrainingTowerEarth\";\r\nimport TrainingTowerFire from \"../../../exploration/dungeons/training/TrainingTowerFire\";\r\nimport TrainingTowerWater from \"../../../exploration/dungeons/training/TrainingTowerWater\";\r\nimport { addEnemyDeathListener } from \"../../../exploration/Exploration\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { hasFlag, setFlag } from \"../../../Flags\";\r\nimport { HealthPotion } from \"../../../items/equipment/pouch/HealthPotion\";\r\nimport { addToInventory } from \"../../../items/Inventory\";\r\nimport { paper } from \"../../../items/transmute/materials/Paper\";\r\nimport { grantResource, Resource } from \"../../../Resources\";\r\nimport { registerPostRetirementListener } from \"../../../Retire\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../../spells/channeling/ChannelingResources\";\r\nimport { getUnlockedElements } from \"../../../spells/Elements\";\r\nimport { Storyline } from \"../../../storylines/Storyline\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { getSecondsPlayed } from \"../../../timetick/TotalTimePlayed\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\n\r\nconst storyline = new Storyline(\r\n  \"zoomThroughTraining\",\r\n  t(\"Zoom Through Training\"),\r\n  160,\r\n  10,\r\n  t(\"Defeat the Head Instructor within 5 in-game minutes after starting a run\"),\r\n  t(\r\n    \"Start new retirements with all game progress until the end of the Training Towers completed; +14.9K Max of all Essences; +9K Max:monstium:; +15K Max:coins:; +20:land:; Begin new retirements with 100 :paper:Paper, full :monstium: and storage of all Essences, and 3 :healthPotion:Health Potion\",\r\n  ),\r\n  (state) => true,\r\n);\r\n\r\nexport function loadZoomThroughTraining() {\r\n  Storylines.register(storyline);\r\n  const eventBuilder = buildEvent(\r\n    \"zoomThroughTraining\",\r\n    t(\"(Storyline) Zoom Through Training\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(storyline.getId());\r\n\r\n  eventBuilder\r\n    .message(\r\n      t(\r\n        `Your victory in combat against the Head Instructor marks the end of your combat training, but you really feel like you have no need for it anymore. Everything so far felt like a complete breeze.`,\r\n      ),\r\n    )\r\n    .option(t(\"Continue\"), {\r\n      transform: (state) => {\r\n        state = storyline.complete(state);\r\n        return state;\r\n      },\r\n    });\r\n  eventBuilder.message(\r\n    t(`You write a few more notes in your diary. Everything you found in that house once you moved in has helped you so much - and with this last bit of information, if anyone else comes after you, they'll be able to get going... *very* quickly.\r\n\r\n**You have completed the \"Zoom Through Training\" Storyline! In future retirements, you will begin with all the unlocks you have obtained up to this point already unlocked. This means you will not need to explore the Training Towers and will be able to start directly from the next area! But you will also obtain many more bonuses: a flat +14.9K bonus to all your Essence storing capacity, +15K Max:coins: and +9000 Max:monstium:, as well as an extra +20:land:! You will also begin with 100 :paper:Paper in your inventory, and 3 :healthPotion:Health Potion so you don't need to look for their materials. And to top it all off, your Essence and Monstium storage will start full!**`),\r\n  );\r\n  const event = eventBuilder.build();\r\n\r\n  addEnemyDeathListener(event.getId() + \"Triggerer\", (state) => {\r\n    if (\r\n      !event.hasTriggered(state) &&\r\n      !storyline.isCompleted(state) &&\r\n      getSecondsPlayed(state) <= 60 * 5 &&\r\n      hasFlag(state, Flag.HeadInstructorDefeated)\r\n    ) {\r\n      return triggerEvent(event)(state);\r\n    }\r\n    return state;\r\n  });\r\n\r\n  registerPostRetirementListener(\"zoomThroughTraining\", (state) => {\r\n    if (storyline.isBonusActive(state)) {\r\n      const flagsToActivate = [\r\n        Flag.ChannelingUnlocked,\r\n        Flag.ManaSpoutsUnlocked,\r\n        Flag.ManaShardsUnlocked,\r\n        Flag.StoragesUnlocked,\r\n        Flag.CatalystsUnlocked,\r\n        Flag.StudyUnlocked,\r\n        Flag.TransmutationUnlocked,\r\n        Flag.WizardsUnlocked,\r\n        Flag.SaleStallsUnlocked,\r\n        Flag.ResearchersUnlocked,\r\n        Flag.LandPurchaseUnlocked,\r\n        Flag.ExplorationUnlocked,\r\n        Flag.RestOfTrainingUnlocked,\r\n        Flag.EnhancementsUnlocked,\r\n        Flag.SewersUnlocked,\r\n      ];\r\n      for (let flag of flagsToActivate) {\r\n        state = setFlag(flag)(state);\r\n      }\r\n\r\n      const dungeonsToClear = [\r\n        TrainingTowerAir,\r\n        TrainingTowerEarth,\r\n        TrainingTowerFire,\r\n        TrainingTowerWater,\r\n      ];\r\n      for (let dungeon of dungeonsToClear) {\r\n        state = setDungeonFloorCompleted(state, dungeon.getId());\r\n      }\r\n\r\n      state = grantResource(Resource.Monstium, Infinity)(state);\r\n      const unlockedElements = getUnlockedElements(state);\r\n      for (let element of unlockedElements) {\r\n        state = grantResource(RESOURCE_FOR_ELEMENT[element], Infinity)(state);\r\n      }\r\n      state = addToInventory({ itemId: paper.getId(), params: {} }, 100, state);\r\n      state = addToInventory(\r\n        { itemId: HealthPotion.getId(), params: {} },\r\n        3,\r\n        state,\r\n      );\r\n    }\r\n    return state;\r\n  });\r\n\r\n  registerTransformation(\r\n    [\r\n      ...Object.values(RESOURCE_FOR_ELEMENT).map((resource) => [\r\n        resource,\r\n        TransformationTags.Cap,\r\n      ]),\r\n    ],\r\n    \"zoomThroughTrainingStorage\",\r\n    storyline.getName(),\r\n    TransformationType.Addition,\r\n    (state, params) => (storyline.isBonusActive(state) ? 14900 : 0),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[Resource.Coins, TransformationTags.Cap]],\r\n    \"zoomThroughTrainingCoins\",\r\n    storyline.getName(),\r\n    TransformationType.Addition,\r\n    (state, params) => (storyline.isBonusActive(state) ? 15000 : 0),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[Resource.Monstium, TransformationTags.Cap]],\r\n    \"zoomThroughTrainingMonstium\",\r\n    storyline.getName(),\r\n    TransformationType.Addition,\r\n    (state, params) => (storyline.isBonusActive(state) ? 9000 : 0),\r\n  );\r\n\r\n  registerTransformation(\r\n    [[TransformationTags.Land, TransformationTags.Cap]],\r\n    \"zoomThroughTrainingLand\",\r\n    storyline.getName(),\r\n    TransformationType.Addition,\r\n    (state, params) => (storyline.isBonusActive(state) ? 20 : 0),\r\n  );\r\n\r\n  registerAchievementUnlockerFromStoryline(\r\n    storyline,\r\n    Achievement.ZOOM_THROUGH_TRAINING,\r\n  );\r\n}\r\n","import { loadStorylinesCore } from \"../../storylines/StorylinesCommonLogic\";\r\nimport { loadConvenience } from \"./desert/Convenience\";\r\nimport { loadVarietyCollector } from \"./desert/VarietyCollector\";\r\nimport { loadAdvertisingManual } from \"./pretraining/AdvertisingManual\";\r\nimport { loadBestiaryUnlocker } from \"./pretraining/BookOfMonsters\";\r\nimport { loadSimultaneousChanneling } from \"./pretraining/ChannelAllStoryline\";\r\nimport { loadRetireUnlocker } from \"./pretraining/RetireUnlocker\";\r\nimport { loadFurniturePreservation } from \"./sewers/FurniturePreservation\";\r\nimport { loadGoblinDen } from \"./sewers/GoblinDen\";\r\nimport { loadLocationEncyclopedia } from \"./sewers/LocationEncyclopedia\";\r\nimport { loadOutessenced } from \"./sewers/Outessenced\";\r\nimport { loadPassageOfStench } from \"./sewers/PassageOfStench\";\r\nimport { loadPermaCast } from \"./sewers/PermaCast\";\r\nimport { loadShardStockpile } from \"./sewers/ShardStockpile\";\r\nimport { loadSomeonesTrash } from \"./sewers/SomeonesTrash\";\r\nimport { loadTicTacToe } from \"./sewers/TicTacToe\";\r\nimport { loadTomeOfToxicKnowledge } from \"./sewers/TomeOfToxicKnowledge\";\r\nimport { loadAdvancedManaSpouts } from \"./training/AdvancedManaSpouts\";\r\nimport { loadAlchemyClass } from \"./training/AlchemyClass\";\r\nimport { loadEssenceArtifact } from \"./training/EssenceArtifact\";\r\nimport { loadHowToFight } from \"./training/HowToFight\";\r\nimport { loadStudentContest } from \"./training/StudentContest\";\r\nimport { loadZoomThroughTraining } from \"./training/ZoomThroughTraining\";\r\n\r\nexport function loadStorylineEventsDemo() {\r\n  loadStorylinesCore();\r\n\r\n  // Training Towers (non-grouped)\r\n  loadRetireUnlocker();\r\n  loadBestiaryUnlocker();\r\n  loadAdvertisingManual();\r\n  loadSimultaneousChanneling();\r\n  loadHowToFight();\r\n  loadZoomThroughTraining();\r\n\r\n  // Training Towers (grouped)\r\n  loadEssenceArtifact();\r\n  loadAlchemyClass();\r\n  loadStudentContest();\r\n  loadAdvancedManaSpouts();\r\n\r\n  // Sewers (non-grouped)\r\n  loadFurniturePreservation();\r\n  loadLocationEncyclopedia();\r\n  loadTicTacToe();\r\n  loadShardStockpile();\r\n  loadTomeOfToxicKnowledge();\r\n  loadOutessenced();\r\n  loadPermaCast();\r\n\r\n  // Sewers (grouped)\r\n  loadGoblinDen();\r\n  loadSomeonesTrash();\r\n  loadPassageOfStench();\r\n\r\n  loadConvenience();\r\n  loadVarietyCollector();\r\n}\r\n","import { LevelUpListeners } from \"../events/progression/LevelUp\";\r\nimport { registerRetirementListener } from \"../Retire\";\r\nimport { storylineHintUnlockChecker, Storylines } from \"./Storylines\";\r\n\r\nfunction loadStorylinesCore(): void {\r\n  registerRetirementListener(\"StorylineBonusActivator\", (state, isMock) => {\r\n    Storylines.getAll().forEach((storyline) => {\r\n      if (storyline.isCompleted(state) && !storyline.isBonusActive(state)) {\r\n        state = storyline.activateBonus(state);\r\n      }\r\n    });\r\n    return state;\r\n  });\r\n\r\n  LevelUpListeners.register(\r\n    storylineHintUnlockChecker,\r\n    \"storylineHintUnlocker\",\r\n  );\r\n}\r\n\r\nexport { loadStorylinesCore };\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { getPrimaryElementMaxLevelForRun } from \"../../../spells/Elements\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\nimport { LevelUpListeners } from \"../../progression/LevelUp\";\r\nimport { Posterity } from \"./PosterityStoryline\";\r\n\r\nexport function loadRetireUnlocker() {\r\n  Storylines.register(Posterity);\r\n  const retireUnlockEventBuilder = buildEvent(\r\n    \"posterity\",\r\n    t(\"(Storyline) Posterity\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(Posterity.getId());\r\n\r\n  retireUnlockEventBuilder.message(\r\n    t(`As you continue casting various different kinds of spells, your knowledge becomes more advanced and you start realizing that you are actually learning, unlike when you were at school. You are learning not just about the elements and about their magic, but you are also learning about *how to learn* - how to become more proficient in the process itself.\r\n  \r\nYou pull out your diary and intend to write about it, but as you begin to flip through the pages, you notice one where your writing was particularly sloppy. You stop, and the blood freezes in your veins: it is your entry from the day your close relative succumbed to illness.`),\r\n  );\r\n  retireUnlockEventBuilder\r\n    .message(\r\n      t(`You read a slight bit. It has already been several years since then, but you still remember how devastated you were. That specific day, too, was the day when you decided that no one else should go through the horrors they did - the day when you vowed to yourself to find or create the *Philosopher's Stone*. You had then enrolled into magic school, hoping to be able to deduce how to make it, but... it was merely a pipe dream, wasn't it?\r\n  \r\nYou take a deep breath and jump over to the last page, and you begin writing about what you have learned so far. You suddenly become quite tired. It feels like such a difficult task - and you don't know how long it would even take. You feel tears welling in your eyes - and soon after, you tell yourself you want to *give up*.`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = Posterity.complete(state);\r\n          state = Posterity.activateBonus(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    );\r\n  retireUnlockEventBuilder\r\n    .message(\r\n      t(`However, you stop yourself. Not yet... no, you can't give up. You have barely started, you tell yourself. But, you recognize the immensity of the task you laid upon yourself, and realize that you are not sure if you'll be able to get to the end like this.\r\n  \r\nBecause of that reason, you make one more promise to yourself - you are going to write about everything that you have learnt in this same diary. If you ever decide to give up, someone can then pick up this book, and hopefully that will give them a head start and set them up for success. With renewed energy, you quickly finish what you were writing and continue practicing magic.\r\n\r\n**You have permanently unlocked the \"Retirement\" feature! At any point, you can decide to retire - starting the game over again from the beginning, but obtaining powerful bonuses. You can do so from the \"Retirement\" screen!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const retireUnlockEvent = retireUnlockEventBuilder.build();\r\n\r\n  LevelUpListeners.register((state, element) => {\r\n    if (!state.run.primaryElement) {\r\n      return state;\r\n    }\r\n    if (\r\n      !retireUnlockEvent.hasTriggered(state) &&\r\n      !Posterity.isCompleted(state) &&\r\n      getPrimaryElementMaxLevelForRun(state) >= 4\r\n    ) {\r\n      return triggerEvent(retireUnlockEvent)(state);\r\n    }\r\n    return state;\r\n  }, retireUnlockEvent.getId());\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { getBestiaryVisibleEnemies } from \"../../../exploration/enemies/Enemy\";\r\nimport { addGameStateListener } from \"../../../GameStateListeners\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\nimport { BookOfMonsters } from \"./BookOfMonstersStoryline\";\r\n\r\nexport function loadBestiaryUnlocker() {\r\n  Storylines.register(BookOfMonsters);\r\n  const bestiaryUnlockEventBuilder = buildEvent(\r\n    \"bookOfMonsters\",\r\n    t(\"(Storyline) Compendium\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(BookOfMonsters.getId());\r\n\r\n  bestiaryUnlockEventBuilder.message(\r\n    t(`You fell one more enemy as you explore. You look behind you and you notice a familiar figure - it is your hired wizard! What is she doing all the way here?\r\n    \r\n\"That was *so cool*\", she exclaims loudly, after you notice her. \"You are strong! How do you do it?\"\r\n\r\nYou are quite startled and surprised by her presence, and are not quite sure how to respond, but she continues before you are able to...`),\r\n  );\r\n  bestiaryUnlockEventBuilder\r\n    .message(\r\n      t(`\"I've been actually watching you since you started exploring, and - I've noticed the various kinds of enemies you have been fighting and items you have been finding. And I've been *recording information* about them!\" She shows you a book, titled *\"Compendium\"*.\r\n      \r\nYou admit you are a little intrigued. You walk up to her and open the book. It is barely filled in, but the few pages that have writing in them have quite a lot of information - including even *drawings* of each of the enemies you have defeated!`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = BookOfMonsters.complete(state);\r\n          state = BookOfMonsters.activateBonus(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    );\r\n  bestiaryUnlockEventBuilder\r\n    .message(\r\n      t(`You are pretty impressed. Some of the enemy entries even have observations from her on how to combat them effectively!\r\n      \r\nSomething like this might justify her accompanying you. You hesitate to tell her immediately - you sense she will get extremely excited. For a brief moment you even think about her motivations. You tell yourself it's not the time right now, though. Resolved to let her know that she should come with you on your explorations *after* you go back home, you thank her for starting the book - you are sure it'll be useful.\r\n\r\n**You have completed the \"Compendium\" Storyline! You have permanently unlocked the \"Compendium\" screen, which records information about items you have found, and about enemies you have defeated or battled before. This will persist even after retirement!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const bestiaryUnlockEvent = bestiaryUnlockEventBuilder.build();\r\n\r\n  addGameStateListener(\"bestiaryUnlockListener\", (state) => {\r\n    if (\r\n      !bestiaryUnlockEvent.hasTriggered(state) &&\r\n      !BookOfMonsters.isCompleted(state) &&\r\n      getBestiaryVisibleEnemies(state).length >= 5\r\n    ) {\r\n      return triggerEvent(bestiaryUnlockEvent);\r\n    }\r\n  });\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Achievement } from \"../../../Achievement\";\r\nimport { registerAchievementUnlockerFromStoryline } from \"../../../Achievements\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { setFlag } from \"../../../Flags\";\r\nimport { Resource, getResourceAmount, grantResource } from \"../../../Resources\";\r\nimport { registerPostRetirementListener } from \"../../../Retire\";\r\nimport {\r\n  addEnemyDeathListener,\r\n  getSuccessfulExplorationsForFloor,\r\n} from \"../../../exploration/Exploration\";\r\nimport SewerHideout from \"../../../exploration/dungeons/sewers/SewerHideout\";\r\nimport {\r\n  getTotalAmountOfItem,\r\n  removeFromInventoryWithAnyParams,\r\n} from \"../../../items/Inventory\";\r\nimport { cotton } from \"../../../items/transmute/materials/Cotton\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\nimport { TicTacToeStoryline } from \"./TicTacToeStoryline\";\r\n\r\nexport function loadTicTacToe() {\r\n  Storylines.register(TicTacToeStoryline);\r\n  const ticTacToeEventBuilder = buildEvent(\r\n    \"ticTacToe\",\r\n    t(\"(Storyline) Tic-Tac-Toe\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(TicTacToeStoryline.getId());\r\n\r\n  ticTacToeEventBuilder\r\n    .message(\r\n      t(`Before moving on, you notice an odd object on the floor. You take it in your hands. It is a grid-like wooden board, with 9 compartments on the top, set in a 3x3 grid. It is somewhat dirty, but the construction is sturdy and meticulous.\r\n      \r\nIt's... a tic-tac-toe board, isn't it? For some reason, you get an urge to play. You decide to restore it to its proper usable state...`),\r\n    )\r\n    .option(\r\n      t(\"Restore it (10 Cotton, 20K Water Essence)\"),\r\n      {\r\n        transform: (state) => {\r\n          state = grantResource(Resource.WaterEssence, -20000)(state);\r\n          state = removeFromInventoryWithAnyParams(cotton, 10, state);\r\n          return state;\r\n        },\r\n        isEnabled: (state) =>\r\n          getResourceAmount(state, Resource.WaterEssence) >= 20000 &&\r\n          getTotalAmountOfItem(cotton, state) >= 10,\r\n      },\r\n      \"restored\",\r\n    )\r\n    .option(t(\"Maybe later\"))\r\n    .end();\r\n\r\n  ticTacToeEventBuilder\r\n    .message(\r\n      t(\r\n        `You moisten the Cotton and rub it vigorously against the board. The dirty spots disappear! The board is ready to be used! You call the hired wizard. You get ready to start a game of tic-tac-toe with her, but you're struck with a big dilemma...`,\r\n      ),\r\n    )\r\n    .tag(\"restored\")\r\n    .option(t('Choose to be \"O\"'), \"O\")\r\n    .option(t('Choose to be \"X\"'), \"X\")\r\n    .end();\r\n\r\n  ticTacToeEventBuilder\r\n    .message(\r\n      t(`Of course! *O* is always for the winners. You get ready to write an O in the corner...\r\n\r\n\"What? *Tic-tac-toe*?\" Your hired wizard looks at you, then at the board, and then furrows her brow. \"...What are you doing with *that*? That's not a toy! That's a *Synchro Board*!\"\r\n\r\nYou look at her, confused. *You've never heard of that in your life.*`),\r\n    )\r\n    .tag(\"O\")\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = TicTacToeStoryline.complete(state);\r\n          state = TicTacToeStoryline.activateBonus(state);\r\n          state = setFlag(Flag.SynchroUnlocked)(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    )\r\n    .end();\r\n  ticTacToeEventBuilder\r\n    .message(\r\n      t(`Of course! *X* is always the superior side. You get ready to write an X in the corner...\r\n\r\n\"What? *Tic-tac-toe*?\" Your hired wizard looks at you, then at the board, and then furrows her brow. \"...What are you doing with *that*? That's not a toy! That's a *Synchro Board*!\"\r\n\r\nYou look at her, confused. *You've never heard of that in your life.*`),\r\n    )\r\n    .tag(\"X\")\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = TicTacToeStoryline.complete(state);\r\n          state = TicTacToeStoryline.activateBonus(state);\r\n          state = setFlag(Flag.SynchroUnlocked)(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    )\r\n    .end();\r\n  ticTacToeEventBuilder\r\n    .message(\r\n      t(`\"You're meant to put *Elements* in the grid! Then, depending on what Elements and what position you put them on, you get different *bonuses*. These boards are *rare*!\" She sounds pretty upset...\r\n      \r\nIt takes you a few minutes to get over your desire to play, but once you do, you realize this could become another great tool for your journey... And maybe finding a good Element combination will scratch that same itch?\r\n\r\n...Three Fire-in-a-row?\r\n\r\n**You have completed the \"Tic-Tac-Toe\" Storyline! You have permanently unlocked the \"Synchro\" feature, where you can arrange Elements in a grid to get various bonuses. Find the best pattern and become more powerful!**`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const ticTacToeEvent = ticTacToeEventBuilder.build();\r\n\r\n  addEnemyDeathListener(ticTacToeEvent.getId() + \"Triggerer\", (state) => {\r\n    if (\r\n      !ticTacToeEvent.hasTriggered(state) &&\r\n      !TicTacToeStoryline.isCompleted(state) &&\r\n      (getSuccessfulExplorationsForFloor(state, \"sewerHideout\") >= 6 ||\r\n        SewerHideout.canFightBoss(state))\r\n    ) {\r\n      return triggerEvent(ticTacToeEvent)(state);\r\n    }\r\n    return state;\r\n  });\r\n\r\n  registerPostRetirementListener(\"synchroUnlocker\", (state, isMock) => {\r\n    if (TicTacToeStoryline.isBonusActive(state)) {\r\n      return setFlag(Flag.SynchroUnlocked)(state);\r\n    }\r\n    return state;\r\n  });\r\n\r\n  registerAchievementUnlockerFromStoryline(\r\n    TicTacToeStoryline,\r\n    Achievement.TIC_TAC_TOE,\r\n  );\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { Achievement } from \"../../../Achievement\";\r\nimport { registerAchievementUnlockerFromStoryline } from \"../../../Achievements\";\r\nimport { monstiumCatalysts } from \"../../../enhancement/other/MonstiumCatalysts\";\r\nimport { Flag } from \"../../../Flag\";\r\nimport { setFlag, SetFlagListeners } from \"../../../Flags\";\r\nimport { clearResourceCapCache, Resource } from \"../../../Resources\";\r\nimport {\r\n  registerPostRetirementListener,\r\n  registerRetirementListener,\r\n} from \"../../../Retire\";\r\nimport {\r\n  PARTIALLY_UNLOCKED_CHANNELING_MULTIPLIER,\r\n  PARTIALLY_UNLOCKED_STORAGE_MULTIPLIER,\r\n} from \"../../../spells/ElementMultipliers\";\r\nimport {\r\n  getElementLevel,\r\n  getFullyUnlockedElements,\r\n  getTotalExpRequiredForLevel,\r\n  grantElementExp,\r\n  hasElementBeenPartiallyUnlockedInPreviousRun,\r\n  SpellElement,\r\n  unlockElement,\r\n} from \"../../../spells/Elements\";\r\nimport { Storylines } from \"../../../storylines/Storylines\";\r\nimport { clearResearcherExpCache } from \"../../../study/Study\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { buildEvent } from \"../../EventMessageBuilder\";\r\nimport { triggerEvent } from \"../../Events\";\r\nimport { EventTag } from \"../../GameEvent\";\r\nimport { TomeOfToxicKnowledge } from \"./TomeOfToxicKnowledgeStoryline\";\r\n\r\nexport function loadTomeOfToxicKnowledge() {\r\n  Storylines.register(TomeOfToxicKnowledge);\r\n  const poisonUnlockEventBuilder = buildEvent(\r\n    \"tomeOfToxicKnowledge\",\r\n    t(\"(Storyline) Tome of Toxic Knowledge\"),\r\n    [EventTag.STORYLINE],\r\n  ).setStorylineIds(TomeOfToxicKnowledge.getId());\r\n\r\n  poisonUnlockEventBuilder.message(\r\n    t(`On the desk of the Mad Alchemist, you notice a book with a purple cover. It immediately catches your attention, as it says: *\"Tome of Toxic Knowledge\"* - and it depicts *a Man-Eating Plant* on the cover. You are thinking this Tome might be just what you are looking for - you have been having such a hard time with Poison all this time!\r\n    \r\nThe Mad Alchemist is facing away. You look at your hired wizard, who seems to understand what you're about to do and quietly steps away. Then you tiptoe and pick up the book, store it, and head out of the room... and then slightly after, out of sight, you *run*, to make sure he cannot catch you!`),\r\n  );\r\n  poisonUnlockEventBuilder\r\n    .message(\r\n      t(`Back at home, your hired wizard looks at it with you. She exclaims: \"It is so detailed - it is like a basic but thorough explanation of Poison as an element!\"\r\n\r\nAs you skim it with her, you realize she speaks the truth. You read an excerpt from the introduction: *\"The Poison element is essential not only for the creation of potent substances that can weaken, but also for a wide variety of magical substances. Proper management of Poison is also critical for obtaining, storing, and working with, the important wizardry resource, Monstium.\"* \r\n      \r\nYou also notice there is not only basic knowledge about the element written down here, but also many details about advanced applications - things you would have never been able to even dream of! Even now, you still can't understand most of it, but this Tome feels like a very valuable reference material.`),\r\n    )\r\n    .option(\r\n      t(\"Continue\"),\r\n      {\r\n        transform: (state) => {\r\n          state = TomeOfToxicKnowledge.complete(state);\r\n          if (\r\n            hasElementBeenPartiallyUnlockedInPreviousRun(\r\n              state,\r\n              SpellElement.Poison,\r\n            )\r\n          ) {\r\n            state = TomeOfToxicKnowledge.activateBonus(state);\r\n            const poisonLevel = getElementLevel(state, SpellElement.Poison);\r\n            state = unlockElement(SpellElement.Poison)(state);\r\n            state.run.elementExperience[SpellElement.Poison] = 0;\r\n            delete state.run.elementExponents[SpellElement.Poison];\r\n            state = grantElementExp(\r\n              SpellElement.Poison,\r\n              getTotalExpRequiredForLevel(\r\n                state,\r\n                poisonLevel,\r\n                SpellElement.Poison,\r\n              ),\r\n            )(state);\r\n          }\r\n          state = clearResourceCapCache(state);\r\n          state = clearResearcherExpCache(state);\r\n          return state;\r\n        },\r\n      },\r\n      \"end\",\r\n    );\r\n  poisonUnlockEventBuilder\r\n    .message(\r\n      t(`You take the Tome and store it in a special bookshelf. You are saving this bookshelf only for those volumes that are *particularly* useful. And this one certainly is. Although, you hope you will be able to have the time to read it...\r\n\r\n/lastLine/`),\r\n    )\r\n    .tag(\"end\")\r\n    .end();\r\n\r\n  const poisonUnlockEvent = poisonUnlockEventBuilder.build();\r\n\r\n  SetFlagListeners.register((state, flag) => {\r\n    if (!state.run.primaryElement) {\r\n      return state;\r\n    }\r\n    if (\r\n      flag == Flag.VastDesertUnlocked &&\r\n      !poisonUnlockEvent.hasTriggered(state) &&\r\n      !TomeOfToxicKnowledge.isCompleted(state)\r\n    ) {\r\n      return triggerEvent(poisonUnlockEvent, {\r\n        lastLine: hasElementBeenPartiallyUnlockedInPreviousRun(\r\n          state,\r\n          SpellElement.Poison,\r\n        )\r\n          ? t(\r\n              '**You have completed the \"Tome of Toxic Knowledge\" Storyline and have fully unlocked the Poison element! There will be no more penalties to Poison or :poisonessence:. Also, in future retirements, Poison will be available from the start, with no penalties, and it will be possible to select it as a primary element! And as a bonus, you will begin new runs with Monstruariums and Monstium Catalysts already unlocked!**',\r\n            )\r\n          : t(\r\n              '**You have completed the \"Tome of Toxic Knowledge\" Storyline! There will be no more penalties to :poisonessence:. Also, in future retirements, Poison will be fully unlocked! This means that it will be available from the start, with no penalties, and it will be possible to select it as a primary element! And as a bonus, you will begin new runs with Monstruariums and Monstium Catalysts already unlocked!**',\r\n            ),\r\n      })(state);\r\n    }\r\n    return state;\r\n  }, poisonUnlockEvent.getId());\r\n\r\n  registerRetirementListener(\r\n    \"poisonUnlockRetirementListener\",\r\n    (state, isMock) => {\r\n      if (\r\n        TomeOfToxicKnowledge.isCompleted(state) &&\r\n        !getFullyUnlockedElements(state).includes(SpellElement.Poison)\r\n      ) {\r\n        state = unlockElement(SpellElement.Poison)(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  registerPostRetirementListener(\r\n    \"poisonUnlockPostRetirementListener\",\r\n    (state) => {\r\n      if (getFullyUnlockedElements(state).includes(SpellElement.Poison)) {\r\n        state = setFlag(Flag.MonstruariumsUnlocked)(state);\r\n        state = monstiumCatalysts.setPurchased(state);\r\n      }\r\n      return state;\r\n    },\r\n  );\r\n\r\n  registerTransformation(\r\n    [[Resource.PoisonEssence, TransformationTags.Cap]],\r\n    \"afterPoisonUnlockCap\",\r\n    TomeOfToxicKnowledge.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      TomeOfToxicKnowledge.isCompleted(state) &&\r\n      !getFullyUnlockedElements(state).includes(SpellElement.Poison)\r\n        ? 1 / PARTIALLY_UNLOCKED_STORAGE_MULTIPLIER\r\n        : 1.0,\r\n  );\r\n\r\n  registerTransformation(\r\n    [\r\n      [SpellElement.Poison, TransformationTags.ChannelingEfficiency],\r\n      [SpellElement.Poison, TransformationTags.ExpGain],\r\n    ],\r\n    \"afterPoisonUnlockChanneling\",\r\n    TomeOfToxicKnowledge.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      TomeOfToxicKnowledge.isCompleted(state) &&\r\n      !getFullyUnlockedElements(state).includes(SpellElement.Poison)\r\n        ? 1 / PARTIALLY_UNLOCKED_CHANNELING_MULTIPLIER\r\n        : 1.0,\r\n  );\r\n\r\n  registerAchievementUnlockerFromStoryline(\r\n    TomeOfToxicKnowledge,\r\n    Achievement.TOME_OF_TOXIC_KNOWLEDGE,\r\n  );\r\n}\r\n","import { loadRandomEventTriggers } from \"./autorandom/RandomEventTrigger\";\r\nimport { loadRandomRepeatableEvents } from \"./autorandom/RandomRepeatableEvents\";\r\nimport { loadDemoEndEvent } from \"./DemoEndEvent\";\r\nimport { loadDungeonEventGroups } from \"./DungeonEventGroup\";\r\nimport { loadProgressionEventsDemo } from \"./progression/DemoProgressionEvents\";\r\nimport { loadLevelUpEvents } from \"./progression/LevelUp\";\r\nimport { loadStorylineEventsDemo } from \"./storyline/DemoStorylinesLoader\";\r\n\r\nexport function loadGameEventsDemo() {\r\n  loadDungeonEventGroups();\r\n  loadRandomEventTriggers();\r\n\r\n  // Events below\r\n  loadProgressionEventsDemo();\r\n  loadLevelUpEvents();\r\n  loadStorylineEventsDemo();\r\n  loadRandomRepeatableEvents();\r\n\r\n  loadDemoEndEvent();\r\n}\r\n","import { ExplorationTriggerGroups } from \"../../events/autorandom/ExplorationTrigger\";\r\nimport { DungeonFloors, Dungeons } from \"./Dungeons\";\r\nimport SewerEntrance from \"./sewers/SewerEntrance\";\r\nimport SewerHazardousSector from \"./sewers/SewerHazardousSector\";\r\nimport SewerHideout from \"./sewers/SewerHideout\";\r\nimport {\r\n  loadSewerChests,\r\n  sewers,\r\n  sewersExplorationGroup,\r\n} from \"./sewers/Sewers\";\r\nimport TrainingTowerAir from \"./training/TrainingTowerAir\";\r\nimport TrainingTowerEarth from \"./training/TrainingTowerEarth\";\r\nimport TrainingTowerFire from \"./training/TrainingTowerFire\";\r\nimport {\r\n  loadTrainingTowerChests,\r\n  trainingTowers,\r\n  trainingTowersExplorationGroup,\r\n} from \"./training/TrainingTowers\";\r\nimport TrainingTowerWater from \"./training/TrainingTowerWater\";\r\n\r\nexport function loadDungeonsDemo() {\r\n  DungeonFloors.register(TrainingTowerFire);\r\n  DungeonFloors.register(TrainingTowerEarth);\r\n  DungeonFloors.register(TrainingTowerWater);\r\n  DungeonFloors.register(TrainingTowerAir);\r\n  Dungeons.register(trainingTowers);\r\n  ExplorationTriggerGroups.register(trainingTowersExplorationGroup);\r\n  loadTrainingTowerChests();\r\n\r\n  DungeonFloors.register(SewerEntrance);\r\n  DungeonFloors.register(SewerHazardousSector);\r\n  DungeonFloors.register(SewerHideout);\r\n  Dungeons.register(sewers);\r\n  ExplorationTriggerGroups.register(sewersExplorationGroup);\r\n  loadSewerChests();\r\n}\r\n","import { Enemies } from \"./Enemies\";\r\nimport EtherealEel from \"./sewers/EtherealEel\";\r\nimport EvolvedSlime from \"./sewers/EvolvedSlime\";\r\nimport Goblin from \"./sewers/Goblin\";\r\nimport GoblinChief from \"./sewers/GoblinChief\";\r\nimport GoblinDoctor from \"./sewers/GoblinDoctor\";\r\nimport GoblinSharpshooter from \"./sewers/GoblinSharpshooter\";\r\nimport { loadManEatingPlant } from \"./sewers/ManEatingPlant\";\r\nimport MutatedFish from \"./sewers/MutatedFish\";\r\nimport PoisonousToad from \"./sewers/PoisonousToad\";\r\nimport SewerFish from \"./sewers/SewerFish\";\r\nimport SewerFly from \"./sewers/SewerFly\";\r\nimport Sicklefish from \"./sewers/Sicklefish\";\r\nimport SludgeMass from \"./sewers/SludgeMass\";\r\nimport VenomousSpider from \"./sewers/VenomousSpider\";\r\nimport AnimatedSnowman from \"./training/AnimatedSnowman\";\r\nimport BlazingTurtle from \"./training/BlazingTurtle\";\r\nimport BreezyRabbit from \"./training/BreezyRabbit\";\r\nimport FireBat from \"./training/FireBat\";\r\nimport FlyingRock from \"./training/FlyingRock\";\r\nimport Goat from \"./training/Goat\";\r\nimport HeadInstructor from \"./training/HeadInstructor\";\r\nimport KnightInShiningArmor from \"./training/KnightInShiningArmor\";\r\nimport RockGolem from \"./training/RockGolem\";\r\nimport Slime from \"./training/Slime\";\r\nimport FamiliarOfWind from \"./training/Windglider\";\r\n\r\nexport function loadEnemiesDemo() {\r\n  // Training Towers\r\n  Enemies.register(Slime);\r\n  Enemies.register(FlyingRock);\r\n  Enemies.register(RockGolem);\r\n  Enemies.register(BreezyRabbit);\r\n  Enemies.register(FamiliarOfWind);\r\n  Enemies.register(FireBat);\r\n  Enemies.register(BlazingTurtle);\r\n  Enemies.register(Goat);\r\n  Enemies.register(AnimatedSnowman);\r\n  Enemies.register(KnightInShiningArmor);\r\n  Enemies.register(HeadInstructor);\r\n\r\n  // Sewers\r\n  Enemies.register(EvolvedSlime);\r\n  Enemies.register(PoisonousToad);\r\n  Enemies.register(SewerFish);\r\n  Enemies.register(Goblin);\r\n  Enemies.register(MutatedFish);\r\n  Enemies.register(Sicklefish);\r\n  Enemies.register(SewerFly);\r\n  Enemies.register(GoblinSharpshooter);\r\n  Enemies.register(SludgeMass);\r\n  Enemies.register(GoblinChief);\r\n  Enemies.register(VenomousSpider);\r\n  Enemies.register(GoblinDoctor);\r\n  Enemies.register(EtherealEel);\r\n  loadManEatingPlant();\r\n}\r\n","import { t } from \"../../utils/I18n\";\r\nimport { isAutocastEverUnlocked } from \"../autocast/Autocast\";\r\nimport { CombatClassesStoryline } from \"../classes/CombatClassesStoryline\";\r\nimport { isEnhancementEverUnlocked } from \"../enhancement/Enhancements\";\r\nimport { manaSteamers } from \"../enhancement/other/ManaSteamers\";\r\nimport { BookOfMonsters } from \"../events/storyline/pretraining/BookOfMonstersStoryline\";\r\nimport { permacastStoryline } from \"../events/storyline/sewers/PermaCast\";\r\nimport { isDungeonFloorEverCompleted } from \"../exploration/dungeons/Dungeons\";\r\nimport SewerEntrance from \"../exploration/dungeons/sewers/SewerEntrance\";\r\nimport { isExplorationEverUnlocked } from \"../exploration/Exploration\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasEverHadFlag, hasWorldFlag } from \"../Flags\";\r\nimport {\r\n  hasEverUnlockedCrafting,\r\n  isInventoryEverUnlocked,\r\n} from \"../items/Items\";\r\nimport { isRetirementUnlocked } from \"../Retire\";\r\nimport { isStudyEverUnlocked } from \"../study/Study\";\r\nimport { isSynchroUnlocked } from \"../synchro/Synchro\";\r\nimport { HelpCategory, Helps } from \"./Helps\";\r\n\r\nexport function loadHelpsDemo() {\r\n  Helps.reset();\r\n\r\n  // Introduction\r\n\r\n  Helps.register({\r\n    id: \"welcome\",\r\n    category: HelpCategory.Introduction,\r\n    title: t(\"Welcome to Magic Research 2!\"),\r\n    order: 0,\r\n    description: t(`**Welcome to Magic Research 2!**\r\n      \r\nIn Magic Research 2, you are a rookie wizard with a single ambition: to find or create the Philosopher's Stone, a legendary magical item that is said to be able to cure any illness. As you do so, you will learn more than you ever imagined about Magic and about the world around you.\r\n\r\nIn the top left corner, you will find **the menu button** which shows you a breakdown of your current resources and let you access various areas of the game.\r\n\r\nIn the top right corner, you will find **the notification bell button** while takes you to the list of events that have happened recently and allows you to see more information about them or interact with them.\r\n\r\nThe other important button is usually in the bottom right corner: **the magic wand button**. This will take you to the magic menu, where you can cast any spell you may have learned.\r\n\r\nDepending on screen size, some of those buttons can be in different positions on the screen, or the menus they open will be visible at all times. If your screen is wide enough, the menu on the left may also have heart-shaped icons - these will allow you to open screens side-by-side.\r\n\r\n**Note: at the bottom of the Home screen, there will be a \"Current Goal\" section. You can progress through the game by following what it says.**`),\r\n  });\r\n\r\n  // Screens Overview\r\n  Helps.register({\r\n    id: \"homeScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Home\"),\r\n    order: 1000,\r\n    description:\r\n      t(`The :home:**Home** screen is where you can do activities related to your own home - your \"base of operations\" as a wizard.\r\n    \r\nIn the Home screen, you will be able to manually gather :mana:Mana at a slow rate, as well as use it on Channeling spells to obtain Essences, the basic resources of the game.\r\n\r\nEssences have many uses, but within the Home screen, you can utilize them to create *Furniture*. Furniture are objects that decorate or otherwise fill in your Home and have various effects.\r\n\r\nYour Home has a limited amount of :land:Land available for Furniture. You can expand the amount of :land: available by purchasing more from the same screen, but it is expensive and requires :coins:Coins. The choice of what furniture you decide to have in your home and in what amounts is one of the biggest challenges of the game.`),\r\n  });\r\n  Helps.register({\r\n    id: \"studyScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Study\"),\r\n    order: 1010,\r\n    isVisible(state) {\r\n      return isStudyEverUnlocked(state);\r\n    },\r\n    description:\r\n      t(`The :study:**Study** screen allows you to further your knowledge about the Elements, which is key to advancing in the game! Studying allows you to get Element exp over time, which eventually will let you level up your Elements to unlock new spells and get other bonuses.\r\n      \r\nIn this screen, you are able to decide how to distribute your researchers between the Elements. You start with a single researcher (yourself) but you will find a way to get more later in the game. Note that your Primary Element will earn Element exp twice as fast.\r\n\r\nIf you decide to let the game auto-assign your researchers, there are a few options. \"Spread evenly\" will try to keep the same amount of researchers on every Element. \"Most researchers\" will assign all the researchers to the Element that already has the most researchers assigned to it. \"Spread, then most researchers\" will make sure there is at least one researcher assigned to every Element, then it will assign the rest to the Element that has the most Researchers. If more than one Element fits the definition, it will prioritize the Primary Element over non-Primary Elements.`),\r\n  });\r\n  Helps.register({\r\n    id: \"inventoryScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Inventory\"),\r\n    order: 1020,\r\n    isVisible(state) {\r\n      return isInventoryEverUnlocked(state);\r\n    },\r\n    description:\r\n      t(`The :inventory:**Inventory** screen will show you a list of items, which you may have obtained in your journey via Transmutation or other means!\r\n\r\n*There is no limit to the amount of items you may have.*\r\n\r\nThe screen is divided into two parts:\r\n\r\nAt the top is a list of equipped items, which can be individually unequipped.\r\n\r\nAt the bottom is the actual list of items shown as a grid. You may filter items by type - this feature may be useful later in the game. Pressing an item in the grid will show its details and often allow to use, equip, or sell the item to obtain :coins:.`),\r\n  });\r\n  Helps.register({\r\n    id: \"transmutationScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Transmutation\"),\r\n    order: 1030,\r\n    isVisible(state) {\r\n      return hasEverUnlockedCrafting(state);\r\n    },\r\n    description:\r\n      t(`In the :transmute:**Transmute** screen, you will be able to Transmute items! Transmutation lets you transform items, elemental essences and other resources into new items.\r\n\r\nThe screen shows your possible Transmutations as a grid. You may select one item to see its details, cost, and Transmute it. You can unlock more Transmutations by raising your Element levels.\r\n\r\nOnce you have Transmuted an item, it will go straight to your :inventory:Inventory and you should be able to see it in that screen.`),\r\n  });\r\n  Helps.register({\r\n    id: \"wizardsScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Wizards\"),\r\n    order: 1040,\r\n    isVisible(state) {\r\n      return isAutocastEverUnlocked(state);\r\n    },\r\n    description:\r\n      t(`The :wizards:**Wizards** screen lets you give instructions to your hired Wizards, who will cast spells as you ask - effectively letting you automate a large part of the game!\r\n      \r\nThis screen, and its feature, is quite complex. You can learn more about this screen in other Help items in the Wizards category.`),\r\n  });\r\n  Helps.register({\r\n    id: \"explorationScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Exploration\"),\r\n    order: 1050,\r\n    isVisible(state) {\r\n      return isExplorationEverUnlocked(state);\r\n    },\r\n    description:\r\n      t(`In the :exploration:**Exploration** screen, you can delve through various areas as you further your quest for the Philosopher's Stone!\r\n      \r\nThis screen and feature is quite complex. You can learn more about this screen in other Help items in the Exploration category.`),\r\n  });\r\n  Helps.register({\r\n    id: \"enhancementScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Enhance\"),\r\n    order: 1060,\r\n    isVisible(state) {\r\n      return isEnhancementEverUnlocked(state);\r\n    },\r\n    description:\r\n      t(`In the :enhance:**Enhance** screen, you can spend your hard-earned :monstium:Monstium, together with :paper:Paper, to obtain powerful semi-permanent bonuses and greatly improve your capabilities!\r\n      \r\nEnhancements will last for the rest of the run, but they do not persist through Retirement.\r\n\r\nYou can obtain :monstium:Monstium from defeating enemies in Exploration. On the other hand, :paper:Paper can be Transmuted, and you will need lots of it - if you are able to, consider automating their production with Wizards!`),\r\n  });\r\n  Helps.register({\r\n    id: \"synchroScreen\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Synchro\"),\r\n    order: 1065,\r\n    isVisible(state) {\r\n      return isSynchroUnlocked(state);\r\n    },\r\n    description:\r\n      t(`In the :synchro:**Synchro** screen, you can arrange your fully unlocked Elements in a 3x3 grid. Adjacent Elements in the grid will give you various bonuses, depending on the Elements themselves. You can reassign Elements to the grid anytime.\r\n      \r\nYou can place each Element up to 2 times in the grid, and because of the size and shape of the grid, the maximum amount of bonuses you can have is 12. Bonuses are multiplicative with each other.\r\n\r\nSome bonus effects may show up as \"???\". If that is the case, it's because you haven't yet unlocked what the effect does. For example, if an effect would give +10% Droplet of Healing spell power, but you hadn't unlocked the spell Droplet of Healing, it would appear as \"???\". In addition, sometimes, a pair of Elements may not provide a bonus, or it might give a bonus with negative effects. Optimize your grid so that you avoid these negative effects!\r\n\r\nYou have the ability to set up 8 grids in total. However, only the active grid will provide its bonuses at any time. You can swap between grids quickly either from the Synchro screen, or from the Exploration screen, under the Strategy tab.\r\n\r\nSome grid ideas:\r\n\r\n* You can easily obtain 4 times of a single boost by creating a 2x2 square within the grid where the top-left and bottom-right are the same Element, and the top-right and bottom-left are another Element.\r\n* Fire+Earth is a good combination for melee builds. Water+Air is a good combination for offensive spellcasters.\r\n\r\nWhen fully unlocking Elements, they will become usable in the Synchro grid. Revisit your set-up occasionally to see what new combinations you may find!`),\r\n  });\r\n  Helps.register({\r\n    id: \"retirement\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Retirement\"),\r\n    order: 1200,\r\n    isVisible(state) {\r\n      return isRetirementUnlocked(state);\r\n    },\r\n    description:\r\n      t(`:retirement:**Retirement** is one of the most powerful features in the game. In essence, retiring allows you to restart the game from the beginning, including choosing a new primary Element. However, there are strong benefits to retirement which are detailed below.\r\n    \r\nWhen you retire, the level your primary Element is currently at is permanently recorded. This level is called the **Maximum Primary Level**, or **MPL**. The MPL for an Element can never go down - if you re-select an Element as your primary and then retire again without reaching your previous MPL, you will keep the previous value.\r\n\r\nAfter you retire, you will get a **Global Experience Multiplier**. This multiplier is very important, as it can vastly improve the effectiveness of studying, letting you unlock stronger spells much, much quicker.\r\n\r\nIn addition, there is a similar **Global Production Multiplier** which will affect all resource production you have from Channeling, furniture and other features in the game. This includes Mana, which means after retirement it should be much easier to cast stronger spells or cast spells more often. This also affects loot.\r\n\r\nBoth of the multipliers above are determined based on two factors. The first is the maximum MPL you have ever achieved, regardless of Element. This is the main factor impacting the two multipliers. The second is the sum of all the MPLs you have across all the Elements. This is a secondary factor and it will impact the multipliers, but not as much. Because of this, it's recommended to **pick a new Primary Element when retiring** if possible, to maximize the bonuses.\r\n\r\nOne last benefit from retirement is related to Storylines. Any **benefits acquired from Storylines will persist through retirements**, meaning progress will become faster. In addition, some Storylines only provide their benefit after you retire once - retiring is encouraged in order to get the full benefit in those cases.\r\n\r\nDeciding when to retire is very important. One suggestion is to retire if progress has gotten slower or achieving the next Goal (see: **Home** help section) appears impossible. Another is to retire if the research and production multipliers will substantially increase, or if you complete a Storyline with powerful effects that only appear after retirement. For the first retirement *only*, it is usually a good idea to retire if your new Global Experience Multiplier will be above 2.5x (i.e. do not retire right away after unlocking Retirement).`),\r\n  });\r\n  Helps.register({\r\n    id: \"compendium\",\r\n    category: HelpCategory.ScreensOverview,\r\n    title: t(\"Compendium\"),\r\n    order: 1210,\r\n    isVisible(state) {\r\n      return BookOfMonsters.isCompleted(state);\r\n    },\r\n    description:\r\n      t(`The :compendium:**Compendium** is a resource that you can use to aid your quest. It contains two separate areas: *Items* and *Bestiary*. **Items** is essentially a list of all the items you have ever acquired, together with their basic effect and a small breakdown of where you could acquire them from. **Bestiary**, on the other hand, is a list of all the enemies you have fought throughout your journey. You can find information such as their stats, loot, or encounter rate. In order to see all the information, you may need to defeat an enemy many times, up to 50. The information on the Compendium persists through Retirement.\r\n      \r\n**Tip: If you lose more than twice to a boss, their entry in the Bestiary will include special combat tips from your hired wizard!** If you are stuck on a boss, this information can help you overcome it.`),\r\n  });\r\n\r\n  // Game Features\r\n  Helps.register({\r\n    id: \"channeling\",\r\n    category: HelpCategory.GameFeatures,\r\n    title: t(\"Channeling\"),\r\n    order: 2000,\r\n    isVisible(state) {\r\n      return true;\r\n    },\r\n    description:\r\n      t(`**Channeling** spells are the most basic spell for each Element, and allow you to generate Essences of each Element. Essences are the most basic resources in the game and the building blocks for almost everything else.\r\n      \r\nThe amount of Essences you get from Channeling is calculated based on the amount of :mana: spent on the Channeling spell. Channeling spells, unlike other spells, do not have a fixed :mana: cost. Instead, their cost scales with your Max:mana:, and the Essences you get are proportional to this as well. Because of this scaling, you will be using the same Channeling spells throughout the game.`),\r\n  });\r\n  Helps.register({\r\n    id: \"timePieces\",\r\n    category: HelpCategory.GameFeatures,\r\n    title: t(\"Time Pieces\"),\r\n    order: 2005,\r\n    isVisible(state) {\r\n      return hasWorldFlag(state, \"has_seen_offline_progress\");\r\n    },\r\n    description:\r\n      t(`If you close the game or are away from it for longer than 10 minutes, you will gain a new resource: **:timepiece:Time Pieces**.\r\n      \r\nTime Pieces let you regain some of the lost time from being away from the game. You can use them in several different ways:\r\n\r\n* You can use them to speed up the game by going to the left-side menu and changing the game speed.\r\n* You can use them to instantly warp ahead in time. It is faster than speeding up the game, but uses up more :timepiece:. You can do this at the bottom of the Home screen.\r\n* You can use them to instantly obtain Element exp equivalent to some real world time. You can use this option to (usually) get more exp than warping for the same amount of :timepiece:. You can do this at the bottom of the Study screen.\r\n* If you have unlocked a certain feature, you can also use them to immediately trigger the next random event. This can be useful in some occasions, as it is cheaper than warping. You can do this at the bottom of the Home screen.\r\n\r\nYou will get exactly 1:timepiece: for each second you spend offline, and you can store up to 100K:timepiece:. They can be a very effective way to speed up progress, so don't hesitate to use them!`),\r\n  });\r\n  Helps.register({\r\n    id: \"primaryElement\",\r\n    category: HelpCategory.GameFeatures,\r\n    title: t(\"Primary Element\"),\r\n    order: 2010,\r\n    isVisible(state) {\r\n      return isRetirementUnlocked(state);\r\n    },\r\n    description:\r\n      t(`When you begin a new run, you must select a **Primary Element**. Primary Elements:\r\n      \r\n* Get double experience from spellcasting and Studying,\r\n* Require much less experience to level up,\r\n* Require half the :mana: to cast their spells,\r\n* Are the only elements that matter when calculating your Retirement bonus,\r\n* May have other hidden bonuses later in the game.\r\n\r\nOverall, your Primary Element will most likely be the highest level out of all your Elements, which - together with the lower :mana: cost - means that your playstyle will be influenced by your choice of Primary Element.\r\n\r\nYou can choose a new Primary Element by *retiring* and starting a new run.`),\r\n  });\r\n  Helps.register({\r\n    id: \"classes\",\r\n    category: HelpCategory.GameFeatures,\r\n    title: t(\"Classes\"),\r\n    order: 2020,\r\n    isVisible(state) {\r\n      return CombatClassesStoryline.isCompleted(state);\r\n    },\r\n    description:\r\n      t(`After you begin a new run through Retirement, you will be able to select a **Class**. Classes provide significant bonuses to various aspects of the game that are specific to the run.\r\n      \r\nWhen you begin, you will have access to three classes:\r\n\r\n* The *Battlemage* class gets a bonus to :attack: and :defense:. It makes Exploration and Combat much easier.\r\n* The *Spellslinger* class gets a significant bonus to :mana: production, letting you cast more spells.\r\n* The *Builder* class gets a bonus to :land: obtained, letting you have more furniture at once in your Home.\r\n\r\nYou suspect there might be other classes out there... but you're not sure how to find them.`),\r\n  });\r\n  Helps.register({\r\n    id: \"turningOffFurniture\",\r\n    category: HelpCategory.GameFeatures,\r\n    title: t(\"Turning off Furniture\"),\r\n    order: 2025,\r\n    isVisible(state) {\r\n      return manaSteamers.hasEverBeenPurchased(state);\r\n    },\r\n    description:\r\n      t(`Some Furniture, like Mana Steamers, will consume resources or have some other detrimental effect in order to provide their benefit. To avoid demolishing your Furniture if you have built too many, or if you are facing a temporary situation, you can **turn off** some of them at will.\r\n      \r\nTo turn off Furniture, you can do so from the Home screen. If it can be turned off, expanding the Furniture will let you turn it off and on. If a Furniture can be turned off, it will display its count as *(3/5)* or so, where 3 is the amount that are turned on, and 5 is the total amount that are built.\r\n\r\n*Note that turning off Furniture does not prevent it from using up your :land:Land.* If you are keeping your Furniture off for a long time, consider demolishing it so that you can build something else instead.`),\r\n  });\r\n  Helps.register({\r\n    id: \"partiallyUnlocked\",\r\n    category: HelpCategory.GameFeatures,\r\n    title: t(\"Partially Unlocked Elements\"),\r\n    order: 2030,\r\n    isVisible(state) {\r\n      return isDungeonFloorEverCompleted(state, SewerEntrance);\r\n    },\r\n    description:\r\n      t(`Sometimes, from observation of the world around you, you will figure out that **entirely unknown Elements** exist! However, your intuitive, basic knowledge, without any reference material, makes it much more difficult to use their spells or level them up.\r\n      \r\nPartially unlocked Elements:\r\n\r\n* Will be much harder (although possible) to Channel,\r\n* Will require a lot more Exp to level up,\r\n* Will not persist through Retirement.\r\n\r\nIf you find an Element and partially unlock it, it is usually suggested to get some levels on it, even if it's difficult. It might help you gain an edge and get further in progression...`),\r\n  });\r\n\r\n  // Wizards\r\n\r\n  Helps.register({\r\n    id: \"wizardsOverview\",\r\n    category: HelpCategory.Wizards,\r\n    title: t(\"Overview\"),\r\n    order: 4000,\r\n    isVisible(state) {\r\n      return isAutocastEverUnlocked(state);\r\n    },\r\n    description: t(\r\n      `The :wizards:**Wizards** feature lets you give instructions to your hired Wizards, who will cast spells as you ask - effectively letting you automate a large part of the game!\r\n\r\nIn order to automate the casting of a spell, you will need to assign at least one Wizard to it. The Wizards you assign to the spell will generate :wizardpower:Wizard Power, filling a gauge on the spell's rule - and when it's completely full, the spell will automatically cast!\r\n\r\nYou can assign Wizards to a spell by opening its details in the Spell menu. When a Spell has Wizards assigned to it, it will have a (A) next to its name, signaling that it's being Automated. You can also have Wizards assigned to Transmutation spells from the Transmute screen.\r\n\r\nWhen unlocking the feature, you begin with a single Wizard. However, you can get more by building *Wizard Chambers*, a type of furniture in your :home:Home.`,\r\n    ),\r\n  });\r\n  Helps.register({\r\n    id: \"wizardsLayout\",\r\n    category: HelpCategory.Wizards,\r\n    title: t(\"Screen Layout\"),\r\n    order: 4010,\r\n    isVisible(state) {\r\n      return isAutocastEverUnlocked(state);\r\n    },\r\n    description: t(\r\n      `The Wizards screen is divided into three areas.\r\n\r\nThe main area in the center shows a list of rules: they are the instructions that you are giving to your Wizards. Each rule represents a spell, which could be either a normal or a Transmutation spell. You can assign or remove Wizards from the rules here, and you can reorder them for readability if desired. You can also pause the execution of certain rules temporarily.\r\n\r\nThe area at the top lets you control Wizard Strategies (also called \"Loadouts\"), which allows you to save a strategy and reuse it later. This is useful especially if your :mana: or :wizardpower: is limited and you would like to create set-ups that focus on different areas of the game.\r\n\r\nFinally, the area at the bottom shows summary statistics about your current instructions.`,\r\n    ),\r\n  });\r\n  Helps.register({\r\n    id: \"wizardsCaveats\",\r\n    category: HelpCategory.Wizards,\r\n    title: t(\"Caveats\"),\r\n    order: 4020,\r\n    isVisible(state) {\r\n      return isAutocastEverUnlocked(state);\r\n    },\r\n    description: t(\r\n      `Your Wizards will only cast a spell when the :wizardpower: for a rule is full. However, there will be times where even if it is full, wizards will not cast spells:\r\n      \r\nIf you are unable to cast the spell yourself for any reason (for example, if your :mana: is not enough) the Wizards will not cast the spell.\r\n\r\nHowever, **there is an extra hidden condition** - for many spells, your Wizards will only cast the spell when they deem it \"worthwhile\", often saving you :mana:. For example, Channeling spells will not be cast if your storage for that elemental essence is full. Or spells that grant a buff may not be cast until the buff's remaining time is less than two seconds. Other spells may have other caveats.`,\r\n    ),\r\n  });\r\n  Helps.register({\r\n    id: \"wizardsPermaCast\",\r\n    category: HelpCategory.Wizards,\r\n    title: t(\"Perma-Cast\"),\r\n    order: 4030,\r\n    isVisible(state) {\r\n      return permacastStoryline.isBonusActive(state);\r\n    },\r\n    description: t(\r\n      `The Perma-Cast Storyline reward allows your wizards to *Perma-Cast* a spell. Perma-Casting a spell essentially makes your Wizards cast the spell again, indefinitely, as fast as possible or as soon as it's estimated to be needed again. Instead of draining your :mana: all at once at the time the spell is cast, your :mana: will instead be drained over time.\r\n      \r\nYou can set a spell to Perma-Cast from each individual spell's details. Not every spell is available for Perma-Cast: usually, they need to either have a cooldown or grant a buff or a debuff to be Perma-Cast eligible.\r\n\r\nPerma-Cast's ease of setup is one of its biggest advantages, and is especially good for buffs that you always want to have on, such as Enchant Mana Spouts. When a buff or debuff is caused by a spell you have on Perma-Cast, it will be displayed with a (P) on any lists of buffs or debuffs, and it will show towards the bottom of the list so that you don't need to worry about its presence.\r\n\r\nAnother, more subtle advantage of Perma-Cast is that Wizards assigned to Perma-Cast spells will pool together their :wizardpower:, so you will likely need less Wizards than if you had individual rules for all of them.\r\n\r\nThe Perma-Cast rule will group together all spells you have decided to Perma-Cast, and it will always display at the top in the Wizards screen. Wizard Strategies will also include any spells you may have under your Perma-Cast rule.\r\n\r\nIf your :mana: or :wizardpower: generation is not large enough to sustain all your Perma-Cast spells, your Wizards will prioritize those that are \"cheaper\". However, despite this, it can still cause problems if it isn't resolved. If this is happening, your Wizards menu icon will change, letting you know that there is an unsolved issue.`,\r\n    ),\r\n  });\r\n\r\n  // Exploration\r\n\r\n  Helps.register({\r\n    id: \"explorationOverview\",\r\n    category: HelpCategory.Exploration,\r\n    title: t(\"Overview\"),\r\n    order: 5000,\r\n    isVisible(state) {\r\n      return isExplorationEverUnlocked(state);\r\n    },\r\n    description: t(\r\n      `Your pursuit for the Philosopher's Stone will take you through many dangerous places. What will you find?\r\n      \r\n:exploration:**Exploration** is a key feature of the game and easily the most complex. When you explore, you will find enemies that you will need to engage in combat with (and defeat). Defeating enough enemies on an area will let you fight against the boss of that area. *Challenging ever-more-difficult bosses and defeating them is the main way to make progress in Magic Research 2.*\r\n\r\nFirst, you need to select an area to explore. At the beginning, you will only have a single area unlocked, but more will show up as you make progress in the game.\r\n\r\nAfter you select an area, the screen will change. You will explore for a short period of time, and then you will engage in combat against an enemy. In combat, both you and your enemy attack automatically, dealing damage to each other until a combatant's :hp:HP drops to zero. When that happens, the combatant is defeated.\r\n\r\nIf you are victorious, you will immediately start exploring again. If, instead, you are defeated, you will first wait for your :hp: to be fully recovered before exploring again. **There is no penalty for losing in combat, except for the time it takes to heal back to full.**`,\r\n    ),\r\n  });\r\n  Helps.register({\r\n    id: \"explorationUI\",\r\n    category: HelpCategory.Exploration,\r\n    title: t(\"Exploration UI\"),\r\n    order: 5010,\r\n    isVisible(state) {\r\n      return isExplorationEverUnlocked(state);\r\n    },\r\n    description: t(\r\n      `The Exploration screen is divided into roughly two parts.\r\n      \r\nIn the top part, you will be able to see the enemy you are currently fighting, their :hp: and their various attacks. If they are affected by a buff or debuff, you will also see it here. Slightly below, you will also see your own :hp: and your automatic attack progress.\r\n\r\nIn the bottom part, you will see the Exploration Log, a short description that keeps track of the enemies that you have defeated, as well as the loot you have obtained.\r\n\r\nThere are also four buttons in the bottom, which let you interact with combat in various ways:\r\n\r\n* The \"Items\" tab allows you to access your pouch. You can also let the game automatically use most of your pouch items for you.\r\n* The \"Spells\" tab allows you to cast a subset of spells that is particularly useful for Exploration. You can also add spells to your Quickbar by expanding them in this tab.\r\n* The \"Strategy\" tab allows you to change your Wizard strategy (see \"Screen Layout\" under the \"Wizards\" category), switch between equipment sets, or control some aspects of how Exploration works, such as telling the game to wait until you fully recover before you Explore again.\r\n* Finally, the \"Quickbar\" tab is the best way to react to a heated battle. You can set key spells to your Quickbar and use them without having to look through the menus, which is important in difficult battles. The tab also shows a short list of buffs and debuffs on the right.`,\r\n    ),\r\n  });\r\n  Helps.register({\r\n    id: \"explorationPouch\",\r\n    category: HelpCategory.Exploration,\r\n    title: t(\"Pouch Items\"),\r\n    order: 5020,\r\n    isVisible(state) {\r\n      return isExplorationEverUnlocked(state);\r\n    },\r\n    description: t(\r\n      `Pouch Items are an important category of *Equipment*. They are usually potions or fruit that recover your :hp: or grant you a buff for some time. You can equip pouch items from the Inventory screen.\r\n\r\n**Pouch Items are not consumable, and they will not disappear when used.** They are considered pieces of equipment. You start the game with four pouch item slots, and you can have multiples of the same item in those slots. For example, you can fill your pouch with four :cherry:Cherry.\r\n      \r\nPouch items can be used only during combat, and each one will have a certain amount of uses. Entering a new combat will refresh the pouch items and restore their uses.\r\n\r\nMost pouch items will be used automatically during combat unless you disable this behavior in the \"Items\" tab in Exploration. Healing items will typically be used if your :hp: is dangerously low, or if you would obtain their full effect. Buffing items will typically be used whenever the buff is not present, which is usually at the beginning of a battle.\r\n\r\nPouch items are key to succeeding in Exploration, and may be your main source of healing during combat for a good portion of the game. Think very carefully about what pouch items to equip before entering combat: you will need to wait until the next combat to use it if you equip a new pouch item while you are already fighting.`,\r\n    ),\r\n  });\r\n  Helps.register({\r\n    id: \"explorationBasicStats\",\r\n    category: HelpCategory.Exploration,\r\n    title: t(\"Basic Combat Stats\"),\r\n    order: 5030,\r\n    isVisible(state) {\r\n      return isExplorationEverUnlocked(state);\r\n    },\r\n    description: t(\r\n      `There are a handful of stats that are specific to Exploration. They are:\r\n      \r\n:hp:HP is short for \"Health Points\". It represents a combatant's life. If it becomes 0, the combatant will be defeated. Your :hp: slowly regenerates over time. The higher your Max:hp:, the faster it will regenerate. Additionally, your :hp: will regenerate much faster when outside of combat.\r\n\r\n:attack:Attack is the basic damage you would deal with your automatic attack. The damage you actually deal to an enemy will usually be lower than this, as it is reduced by their :defense:Defense stat.\r\n\r\n:attackDelay:Attack Delay is the amount of time between automatic attacks. The lower it is, the better.\r\n\r\n:defense:Defense reduces the damage you take from enemy attacks. Generally, two points of :defense: will reduce damage by 1. However, if your :defense: is much higher than the incoming :attack:, the reduction will slowly become less. You can usually reduce the damage from an attack to 1 if your :defense: is about *four times* the incoming :attack:.\r\n\r\nHere is an example of how :defense: reduces the damage from a 50:attack::\r\n\r\n* With 0:defense:: it would deal 50 damage\r\n* With 20:defense:: it would deal 40 damage\r\n* With 50:defense:: it would deal 25 damage\r\n* With 100:defense:: it would deal 9 damage\r\n* With 150:defense:: it would deal 4 damage\r\n* With 200:defense:: it would deal 1 damage`,\r\n    ),\r\n  });\r\n  Helps.register({\r\n    id: \"explorationDodgeAccuracy\",\r\n    category: HelpCategory.Exploration,\r\n    title: t(\"Dodge and Accuracy\"),\r\n    order: 5040,\r\n    isVisible(state) {\r\n      return hasEverHadFlag(state, Flag.SewersUnlocked);\r\n    },\r\n    description: t(\r\n      `As you make your way into the Sewers, two more stats will become important in Exploration. They are:\r\n      \r\n:dodge:Dodge allows you (or an enemy) to evade attacks entirely. :dodge: starts at 100, and can be increased or decreased by many things, including equipment and buffs. The higher your :dodge: is, the bigger the likelihood you will evade an attack.\r\n\r\n:accuracy:Accuracy, on the other hand, determines the likelihood you will be able to hit an enemy. Like :dodge:, it starts at 100, and can be increased or decreased by many things. If your :accuracy: is higher than or equal to the enemy's :dodge:, your attacks will never miss.\r\n\r\nIf :accuracy: and :dodge: are not displayed in a list of stats, they are implied to be exactly 100.\r\n\r\nThe hit rate of an attack depends on the proportion between the attacker's :accuracy: and the defender's :dodge:. Here's an example (assuming 100:accuracy:, the default):\r\n\r\n* With 100:dodge: or less: it would always hit\r\n* With 120:dodge:: it would have a 91% chance of hitting\r\n* With 150:dodge:: it would have a 74% chance of hitting\r\n* With 200:dodge:: it would have a 50% chance of hitting\r\n* With 300:dodge:: it would have a 15% chance of hitting\r\n* With 400:dodge:: it would have a 0% chance of hitting\r\n\r\n**Note that :dodge: and :accuracy: also affect spells that deal damage!**`,\r\n    ),\r\n  });\r\n}\r\n","import { valuesOf } from \"../../utils/CoreUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { getBuildingAmount, getUsedLand } from \"../buildings/Buildings\";\r\nimport { essenceCatalyst } from \"../buildings/catalysts/EssenceCatalyst\";\r\nimport { ManaSpout } from \"../buildings/mana/ManaSpout\";\r\nimport { ManaShard } from \"../buildings/storages/ManaShard\";\r\nimport { isDungeonFloorCompletedThisRun } from \"../exploration/dungeons/Dungeons\";\r\nimport SewerEntrance from \"../exploration/dungeons/sewers/SewerEntrance\";\r\nimport SewerHazardousSector from \"../exploration/dungeons/sewers/SewerHazardousSector\";\r\nimport SewerHideout from \"../exploration/dungeons/sewers/SewerHideout\";\r\nimport { FLOOR_FOR_ELEMENT } from \"../exploration/dungeons/training/TrainingTowers\";\r\nimport {\r\n  getSuccessfulExplorationsForFloor,\r\n  isExplorationUnlocked,\r\n} from \"../exploration/Exploration\";\r\nimport { Flag } from \"../Flag\";\r\nimport { hasFlag } from \"../Flags\";\r\nimport { getResourceAmount, getResourceCap, Resource } from \"../Resources\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../spells/channeling/ChannelingResources\";\r\nimport {\r\n  getElementExp,\r\n  getPrimaryElementMaxLevelForRun,\r\n  getTotalExpRequiredForLevel,\r\n  SpellElement,\r\n} from \"../spells/Elements\";\r\nimport { clearAllHints, pushHint } from \"./Hints\";\r\n\r\nexport function loadHintsDemo() {\r\n  clearAllHints();\r\n  // 1\r\n  pushHint({\r\n    description: t(\"Gather more Mana\"),\r\n    isCompleted: (state) => hasFlag(state, Flag.ChannelingUnlocked),\r\n    progress: (state) => getResourceAmount(state, Resource.Mana) / 10.0,\r\n  });\r\n  pushHint({\r\n    description: t(\r\n      \"Channel Water and Air Essence. Tip: You can do so from the Spell menu! (Look for a magic wand icon on the right side of the screen; then in the menu, change the Element to Water or Air to find the spells)\",\r\n    ),\r\n    isCompleted: (state) => hasFlag(state, Flag.ManaSpoutsUnlocked),\r\n  });\r\n  pushHint({\r\n    description: t(\"Build a Mana Spout\"),\r\n    isCompleted: (state) =>\r\n      getBuildingAmount(state, ManaSpout) > 0 ||\r\n      hasFlag(state, Flag.ManaShardsUnlocked),\r\n  });\r\n  pushHint({\r\n    description: t(\"Channel Earth Essence\"),\r\n    isCompleted: (state) => hasFlag(state, Flag.ManaShardsUnlocked),\r\n    progress: (state) => getResourceAmount(state, Resource.EarthEssence) / 30.0,\r\n  });\r\n  pushHint({\r\n    description: t(\"Build a Mana Shard\"),\r\n    isCompleted: (state) =>\r\n      getBuildingAmount(state, ManaShard) > 0 ||\r\n      hasFlag(state, Flag.StoragesUnlocked),\r\n  });\r\n  pushHint({\r\n    description: t(\"Fill up your Essence storage\"),\r\n    isCompleted: (state) => hasFlag(state, Flag.StoragesUnlocked),\r\n    progress: (state) =>\r\n      Math.max(\r\n        ...valuesOf(RESOURCE_FOR_ELEMENT).map((resource) =>\r\n          getResourceAmount(state, resource),\r\n        ),\r\n      ) / 100.0,\r\n  });\r\n  pushHint({\r\n    description: t(\"Build an Essence Storage\"),\r\n    isCompleted: (state) => getResourceCap(state, Resource.FireEssence) >= 200,\r\n  });\r\n  pushHint({\r\n    description: t(\"Channel Fire Essence\"),\r\n    isCompleted: (state) => hasFlag(state, Flag.CatalystsUnlocked),\r\n    progress: (state) => getResourceAmount(state, Resource.FireEssence) / 200.0,\r\n  });\r\n  pushHint({\r\n    description: t(\"Build an Essence Catalyst\"),\r\n    isCompleted: (state) =>\r\n      getBuildingAmount(state, essenceCatalyst) > 0 ||\r\n      hasFlag(state, Flag.StudyUnlocked),\r\n  });\r\n  pushHint({\r\n    description: t(\r\n      \"Study your primary element and level it up to Lv2, while continuing to build your home\",\r\n    ),\r\n    isCompleted: (state) => getPrimaryElementMaxLevelForRun(state) >= 2,\r\n    progress: (state) =>\r\n      getElementExp(state, state.run.primaryElement ?? SpellElement.Fire) /\r\n      getTotalExpRequiredForLevel(\r\n        state,\r\n        2,\r\n        state.run.primaryElement ?? SpellElement.Fire,\r\n      ),\r\n  });\r\n  pushHint({\r\n    description: t(\"Transmute items, sell them and accumulate Coins\"),\r\n    isCompleted: (state) => hasFlag(state, Flag.WizardsUnlocked),\r\n    progress: (state) => getResourceAmount(state, Resource.Coins) / 500.0,\r\n  });\r\n  pushHint({\r\n    description: t(\r\n      \"Continue transmuting and selling items and accumulate at least 1000 Coins\",\r\n    ),\r\n    isCompleted: (state) => hasFlag(state, Flag.SaleStallsUnlocked),\r\n    progress: (state) => getResourceAmount(state, Resource.Coins) / 1000.0,\r\n  });\r\n  pushHint({\r\n    description: t(\r\n      \"Continue transmuting and selling items and accumulate at least 1500 Coins\",\r\n    ),\r\n    isCompleted: (state) => hasFlag(state, Flag.ResearchersUnlocked),\r\n    progress: (state) => getResourceAmount(state, Resource.Coins) / 1500.0,\r\n  });\r\n  pushHint({\r\n    description: t(\"Continue building furniture and using up land\"),\r\n    isCompleted: (state) => hasFlag(state, Flag.LandPurchaseUnlocked),\r\n    progress: (state) => getUsedLand(state) / 120.0,\r\n  });\r\n  pushHint({\r\n    description: t(\"Level up your primary element to Lv5\"),\r\n    isCompleted: (state) => isExplorationUnlocked(state),\r\n    progress: (state) =>\r\n      getElementExp(state, state.run.primaryElement ?? SpellElement.Fire) /\r\n      getTotalExpRequiredForLevel(\r\n        state,\r\n        5,\r\n        state.run.primaryElement ?? SpellElement.Fire,\r\n      ),\r\n  });\r\n  pushHint({\r\n    description: t(\"Explore the Tower of Training of your primary element\"),\r\n    isCompleted: (state) => {\r\n      const floor = FLOOR_FOR_ELEMENT[state.run.primaryElement];\r\n      return floor == null || floor.canFightBoss(state);\r\n    },\r\n    progress: (state) => {\r\n      const floor = FLOOR_FOR_ELEMENT[state.run.primaryElement];\r\n      if (floor == null) {\r\n        return 1.0;\r\n      }\r\n      return (\r\n        1.0 -\r\n        (floor.getExplorationSuccessesForBoss(state) -\r\n          getSuccessfulExplorationsForFloor(state, floor.getId())) /\r\n          floor.getExplorationSuccessesForBoss(state)\r\n      );\r\n    },\r\n  });\r\n  pushHint({\r\n    description: t(\r\n      \"Defeat the boss of the Tower of Training of your primary element\",\r\n    ),\r\n    isCompleted: (state) => {\r\n      if (hasFlag(state, Flag.EnhancementsUnlocked)) {\r\n        return true;\r\n      }\r\n      const floor = FLOOR_FOR_ELEMENT[state.run.primaryElement];\r\n      return floor == null || isDungeonFloorCompletedThisRun(state, floor);\r\n    },\r\n  });\r\n  pushHint({\r\n    description: t(\r\n      \"Explore and defeat the boss of all of the Towers of Training\",\r\n    ),\r\n    isCompleted: (state) => {\r\n      if (hasFlag(state, Flag.EnhancementsUnlocked)) {\r\n        return true;\r\n      }\r\n      for (let floor of valuesOf(FLOOR_FOR_ELEMENT)) {\r\n        if (!isDungeonFloorCompletedThisRun(state, floor)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    },\r\n  });\r\n  pushHint({\r\n    description: t(\r\n      'Complete the \"Final Exam\" event by defeating the Head Instructor',\r\n    ),\r\n    isCompleted: (state) => hasFlag(state, Flag.EnhancementsUnlocked),\r\n  });\r\n  pushHint({\r\n    description: t(\"Explore the Sewer Entrance\"),\r\n    isCompleted: (state) => SewerEntrance.canFightBoss(state),\r\n  });\r\n  pushHint({\r\n    description: t(\"Defeat the boss of the Sewer Entrance\"),\r\n    isCompleted: (state) =>\r\n      isDungeonFloorCompletedThisRun(state, SewerEntrance),\r\n  });\r\n  pushHint({\r\n    description: t(\"Explore the Hazardous Sector\"),\r\n    isCompleted: (state) => SewerHazardousSector.canFightBoss(state),\r\n  });\r\n  pushHint({\r\n    description: t(\"Defeat the boss of the Hazardous Sector\"),\r\n    isCompleted: (state) =>\r\n      isDungeonFloorCompletedThisRun(state, SewerHazardousSector),\r\n  });\r\n  pushHint({\r\n    description: t(\"Explore the Sewer Hideout\"),\r\n    isCompleted: (state) => SewerHideout.canFightBoss(state),\r\n  });\r\n  pushHint({\r\n    description: t(\"Defeat the boss of the Sewer Hideout\"),\r\n    isCompleted: (state) => hasFlag(state, Flag.VastDesertUnlocked),\r\n  });\r\n  pushHint({\r\n    description: t(\"Enjoy your time in the World\"),\r\n    isCompleted: (state) => false,\r\n  });\r\n}\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CloakOfDarkness extends EquippableItem {\r\n  getId(): string {\r\n    return \"cloakOfDarkness\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./cloakOfDarkness.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Cloak of Darkness\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A cloak that is abnormally dark. Makes the wearer hard to spot.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 1800;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 4;\r\n  }\r\n\r\n  getPlayerDodgeBonusBase(params: ItemParams): number {\r\n    return 25;\r\n  }\r\n}\r\n\r\nexport const cloakOfDarkness = new CloakOfDarkness();\r\n\r\nclass TransmuteCloakOfDarkness extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return cloakOfDarkness;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 15,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        AirEssence: 15000,\r\n      },\r\n      items: {\r\n        elementalShardAir: 30,\r\n        cotton: 4,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const transmuteCloakOfDarkness = new TransmuteCloakOfDarkness();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CopperShield extends EquippableItem {\r\n  getId(): string {\r\n    return \"copperShield\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./copperShield.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Shield\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"An effective shield that utilizes Copper in its construction.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2500;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 15;\r\n  }\r\n}\r\n\r\nexport const copperShield = new CopperShield();\r\n\r\nclass TransmuteCopperShield extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return copperShield;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 17,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        EarthEssence: 20000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 10,\r\n        copperIngot: 6,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteCopperShield = new TransmuteCopperShield();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass SmallShield extends EquippableItem {\r\n  getId(): string {\r\n    return \"smallShield\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./smallShield.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Small Shield\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A defensive accessory. Provides some protection from damage.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 450;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 7;\r\n  }\r\n}\r\n\r\nexport const smallShield = new SmallShield();\r\n\r\nclass TransmuteSmallShield extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return smallShield;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 8,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        AirEssence: 1500,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 8,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteSmallShield = new TransmuteSmallShield();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { AttackTarget } from \"../../../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { registerTemporaryEffectListener } from \"../../../../temporaryeffects/TemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../../../timetick/TotalTimePlayed\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass StoneEgg extends EquippableItem {\r\n  getId(): string {\r\n    return \"stoneEgg\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./stoneEgg.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Stone Egg\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A large, heavy egg-shaped rock. The holder is not going anywhere...\",\r\n    );\r\n  }\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    return t('Immunity to \"Airborne\"');\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 1200;\r\n  }\r\n}\r\n\r\nexport const stoneEgg = new StoneEgg();\r\n\r\nregisterTemporaryEffectListener(stoneEgg.getId(), (state, temporaryEffect) => {\r\n  if (\r\n    !stoneEgg.isEquippedWithAnyParams(state) ||\r\n    temporaryEffect.target != AttackTarget.Player\r\n  ) {\r\n    return temporaryEffect;\r\n  }\r\n  if (temporaryEffect.id != \"airborne\") {\r\n    return temporaryEffect;\r\n  }\r\n  // Prevent!\r\n  temporaryEffect.endTime = getSecondsPlayed(state) - 1.0;\r\n  return temporaryEffect;\r\n});\r\n\r\nclass TransmuteStoneEgg extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return stoneEgg;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 22,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n        EarthEssence: 28000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 50,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteStoneEgg = new TransmuteStoneEgg();\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { AttackTarget } from \"../../../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport { TransformationValueType } from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CollarOfPower extends EquippableItem {\r\n  getId(): string {\r\n    return \"collarOfPower\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./collarOfPower.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Collar of Power\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A peculiar item. Makes the wearer stronger, but at a cost...\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2000;\r\n  }\r\n\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.2,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\"^{{magnitude}}^<{{explanation}}>:attack:; -20%:defense:\", {\r\n      magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n      explanation: explanations.magnitude,\r\n    });\r\n  }\r\n}\r\n\r\nexport const collarOfPower = new CollarOfPower();\r\n\r\nclass TransmuteCollarOfPower extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return collarOfPower;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 20,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n      },\r\n      items: {\r\n        elementalShardFire: 60,\r\n        copperIngot: 5,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  collarOfPower.getId() + \"attack\",\r\n  collarOfPower.getName(collarOfPower.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state, params) => {\r\n    if (collarOfPower.isEquippedWithAnyParams(state)) {\r\n      return (\r\n        collarOfPower.getEquippedItemEffect(state, \"magnitude\").magnitude + 1.0\r\n      );\r\n    }\r\n    return 1.0;\r\n  },\r\n);\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Defense]],\r\n  collarOfPower.getId(),\r\n  collarOfPower.getName(collarOfPower.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state, params) => {\r\n    if (collarOfPower.isEquippedWithAnyParams(state)) {\r\n      return 0.8;\r\n    }\r\n    return 1.0;\r\n  },\r\n);\r\n\r\nexport const transmuteCollarOfPower = new TransmuteCollarOfPower();\r\n","import { formatNumber } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { AttackTarget } from \"../../../../exploration/AttackTarget\";\r\nimport { CombatActionResultListeners } from \"../../../../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { poison } from \"../../../../temporaryeffects/Poison\";\r\nimport { grantTemporaryEffect } from \"../../../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass AssassinsBaselard extends EquippableItem {\r\n  getId(): string {\r\n    return \"assassinsBaselard\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./assassinsBaselard.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Assassin's Baselard\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A sophisticated small weapon used by covert rogues. Has a potent poisoning effect.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 4000;\r\n  }\r\n\r\n  poisonTags = [TransformationTags.TemporaryEffectMagnitude, poison.getId()];\r\n  poisonDurationTags = [\r\n    TransformationTags.TemporaryEffectDuration,\r\n    poison.getId(),\r\n  ];\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      poisonStrength: {\r\n        value: 15,\r\n        tags: this.poisonTags,\r\n        unit: \":hp:/sec\",\r\n      },\r\n      poisonDuration: {\r\n        value: 1,\r\n        tags: this.poisonDurationTags,\r\n        unit: \" sec\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getPoisonStrength(state: GameState, params: ItemParams): number {\r\n    return this.getItemEffects(state, params, \"poisonStrength\").poisonStrength;\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const poisonStrength = this.getPoisonStrength(state, params);\r\n    const poisonDuration = this.getItemEffects(\r\n      state,\r\n      params,\r\n      \"poisonDuration\",\r\n    ).poisonDuration;\r\n    return t(\r\n      \"On hit, applies ^-{{poisonStrength}}^<{{strengthExplanation}}>:hp:/sec Poison for ^{{poisonDuration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        poisonStrength: formatNumber(poisonStrength),\r\n        strengthExplanation: this.getItemEffectExplanations(\r\n          state,\r\n          params,\r\n          \"poisonStrength\",\r\n        ).poisonStrength,\r\n        poisonDuration: formatNumber(poisonDuration, { showDecimals: true }),\r\n        durationExplanation: this.getItemEffectExplanations(\r\n          state,\r\n          params,\r\n          \"poisonDuration\",\r\n        ).poisonDuration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 55;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.15;\r\n  }\r\n}\r\n\r\nexport const assassinsBaselard = new AssassinsBaselard();\r\n\r\nCombatActionResultListeners.register((state, result) => {\r\n  if (assassinsBaselard.isEquippedWithAnyParams(state)) {\r\n    if (\r\n      result.source == AttackTarget.Player &&\r\n      result.tags.includes(TransformationTags.AutoAttack) &&\r\n      result.isHit\r\n    ) {\r\n      const effects = assassinsBaselard.getItemEffects(\r\n        state,\r\n        getEquippedItem(state, EquipmentSlot.Hand).params,\r\n      );\r\n      state = grantTemporaryEffect(poison.getId(), effects.poisonDuration, {\r\n        mode: \"add\",\r\n        target: result.target,\r\n        params: {\r\n          magnitude: assassinsBaselard.getPoisonStrength(\r\n            state,\r\n            getEquippedItem(state, EquipmentSlot.Hand).params,\r\n          ),\r\n        },\r\n      })(state);\r\n    }\r\n  }\r\n  return state;\r\n});\r\n\r\nclass TransmuteAssassinsBaselard extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return assassinsBaselard;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 14,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        PoisonEssence: 8000,\r\n      },\r\n      items: {\r\n        elementalShardPoison: 15,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteAssassinsBaselard = new TransmuteAssassinsBaselard();\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\nimport { assassinsBaselard } from \"../../hand/poison/AssassinsBaselard\";\r\n\r\nclass AssassinsCloak extends EquippableItem {\r\n  getId(): string {\r\n    return \"assassinsCloak\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./assassinsCloak.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Assassin's Cloak\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A lightweight cloak that empowers an assassin's capabilities.\");\r\n  }\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 2;\r\n  }\r\n\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 4.0,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> Assassin's Baselard poison strength\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n        explanation: explanations.magnitude,\r\n      },\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 6500;\r\n  }\r\n}\r\n\r\nexport const assassinsCloak = new AssassinsCloak();\r\n\r\nregisterTransformation(\r\n  [[assassinsBaselard.getId(), TransformationTags.TemporaryEffectMagnitude]],\r\n  assassinsCloak.getId(),\r\n  assassinsCloak.getBaseName(assassinsCloak.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    assassinsCloak.isEquippedWithAnyParams(state)\r\n      ? assassinsCloak.getEquippedItemEffect(state, \"magnitude\").magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nclass TransmuteAssassinsCloak extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return assassinsCloak;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 19,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        PoisonEssence: 15000,\r\n      },\r\n      items: {\r\n        elementalShardPoison: 20,\r\n        cotton: 4,\r\n        venomPowder: 4,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteAssassinsCloak = new TransmuteAssassinsCloak();\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { AttackTarget } from \"../../../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { poison } from \"../../../../temporaryeffects/Poison\";\r\nimport { registerTemporaryEffectListener } from \"../../../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationValueType } from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CharmOfPoisonResistance extends EquippableItem {\r\n  getId(): string {\r\n    return \"charmOfPoisonResistance\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./charmOfPoisonResistance.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Charm of Poison Resistance\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A necklace enchanted with protective magic. Effective against poison.\",\r\n    );\r\n  }\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 1;\r\n  }\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 3.0,\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n    };\r\n  }\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\"^{{magnitude}}^<{{explanation}}> damage received from Poison\", {\r\n      magnitude: formatMultiplier(1.0 / (1.0 + effects.magnitude)),\r\n      explanation: explanations.magnitude,\r\n    });\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 700;\r\n  }\r\n}\r\n\r\nexport const charmOfPoisonResistance = new CharmOfPoisonResistance();\r\n\r\nregisterTemporaryEffectListener(\r\n  charmOfPoisonResistance.getId(),\r\n  (state, temporaryEffectData) => {\r\n    if (charmOfPoisonResistance.isEquippedWithAnyParams(state)) {\r\n      if (\r\n        temporaryEffectData.id == poison.getId() &&\r\n        temporaryEffectData.target == AttackTarget.Player\r\n      ) {\r\n        const multiplier =\r\n          1.0 /\r\n          (1.0 +\r\n            charmOfPoisonResistance.getItemEffects(\r\n              state,\r\n              getEquippedItem(state, EquipmentSlot.Accessory),\r\n            ).magnitude);\r\n        temporaryEffectData.params.magnitude =\r\n          temporaryEffectData.params.magnitude * multiplier;\r\n      }\r\n    }\r\n    return temporaryEffectData;\r\n  },\r\n);\r\n\r\nclass TransmuteCharmOfPoisonResistance extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return charmOfPoisonResistance;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 4,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        PoisonEssence: 2000,\r\n      },\r\n      items: {\r\n        elementalShardPoison: 5,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteCharmOfPoisonResistance =\r\n  new TransmuteCharmOfPoisonResistance();\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass SoulStone extends EquippableItem {\r\n  getId(): string {\r\n    return \"soulStone\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./soulStone.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Soul Stone\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"An enchanted trinket that increases the effectivity from which you can get the essence of enemies.\",\r\n    );\r\n  }\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.5,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}>:monstium: obtained from Exploration\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n        explanation: explanations.magnitude,\r\n      },\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 5000;\r\n  }\r\n}\r\n\r\nexport const soulStone = new SoulStone();\r\n\r\nregisterTransformation(\r\n  [\r\n    [\r\n      TransformationTags.Loot,\r\n      TransformationTags.FromExploration,\r\n      Resource.Monstium,\r\n    ],\r\n  ],\r\n  soulStone.getId(),\r\n  soulStone.getBaseName(soulStone.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    soulStone.isEquippedWithAnyParams(state)\r\n      ? soulStone.getEquippedItemEffect(state, \"magnitude\").magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nclass TransmuteSoulStone extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return soulStone;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 21,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n        PoisonEssence: 35000,\r\n      },\r\n      items: {\r\n        elementalShardPoison: 80,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteSoulStone = new TransmuteSoulStone();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass ManaTear extends EquippableItem {\r\n  getId(): string {\r\n    return \"manaTear\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./manaTear.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Tear of Mana\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A small gem that provides just a little wizardry push.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 300;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 3;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 100;\r\n  }\r\n}\r\n\r\nconst manaTear = new ManaTear();\r\n\r\nclass TransmuteManaTear extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return manaTear;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 4,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nconst transmuteManaTear = new TransmuteManaTear();\r\nexport { manaTear as ManaTear, transmuteManaTear as TransmuteManaTear };\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { AttackTarget } from \"../../../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass RingOfRegeneration extends EquippableItem {\r\n  getId(): string {\r\n    return \"ringOfRegeneration\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Accessory;\r\n  }\r\n  getPicture() {\r\n    return require(\"./ringOfRegeneration.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Ring of Regeneration\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A ring that greatly magnifies the wearer's innate healing power.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 3500;\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    return t(\"Doubles innate :hp: regeneration\");\r\n  }\r\n}\r\n\r\nexport const ringOfRegeneration = new RingOfRegeneration();\r\n\r\nclass TransmuteRingOfRegeneration extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return ringOfRegeneration;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 23,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n      },\r\n      items: {\r\n        elementalShardWater: 120,\r\n        elementalShardEarth: 20,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.HPRegen]],\r\n  ringOfRegeneration.getId(),\r\n  ringOfRegeneration.getName(ringOfRegeneration.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state, params) => {\r\n    if (ringOfRegeneration.isEquippedWithAnyParams(state)) {\r\n      return 2.0;\r\n    }\r\n    return 1.0;\r\n  },\r\n);\r\n\r\nexport const transmuteRingOfRegeneration = new TransmuteRingOfRegeneration();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass BreezyShirt extends EquippableItem {\r\n  getId(): string {\r\n    return \"breezyShirt\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./breezyShirt.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Breezy Shirt\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A lightweight shirt. Doesn't protect much, but wearing it makes you feel lighter than usual.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 500;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 12;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.2;\r\n  }\r\n}\r\n\r\nconst breezyShirt = new BreezyShirt();\r\n\r\nclass TransmuteBreezyShirt extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return breezyShirt;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        WaterEssence: 1200,\r\n      },\r\n      items: {\r\n        elementalShardAir: 10,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nconst transmuteBreezyShirt = new TransmuteBreezyShirt();\r\nexport {\r\n  breezyShirt as BreezyShirt,\r\n  transmuteBreezyShirt as TransmuteBreezyShirt,\r\n};\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass EvasiveGarb extends EquippableItem {\r\n  getId(): string {\r\n    return \"evasiveGarb\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./evasiveGarb.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Evasive Garb\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"An armor that may not protect much, but allows its wearer to dodge more easily.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 3600;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 24;\r\n  }\r\n\r\n  getPlayerDodgeBonusBase(params: ItemParams): number {\r\n    return 40;\r\n  }\r\n}\r\n\r\nexport const evasiveGarb = new EvasiveGarb();\r\n\r\nclass TransmuteEvasiveGarb extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return evasiveGarb;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 17,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        AirEssence: 25000,\r\n      },\r\n      items: {\r\n        elementalShardAir: 50,\r\n        cotton: 16,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const transmuteEvasiveGarb = new TransmuteEvasiveGarb();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CopperArmor extends EquippableItem {\r\n  getId(): string {\r\n    return \"copperArmor\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./copperArmor.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Armor\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"An armor made from reinforced copper. Adapts more easily to your body than other armor.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 3000;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 50;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0.1;\r\n  }\r\n}\r\n\r\nexport const copperArmor = new CopperArmor();\r\n\r\nclass TransmuteCopperArmor extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return copperArmor;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 16,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        EarthEssence: 15000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 15,\r\n        copperIngot: 12,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteCopperArmor = new TransmuteCopperArmor();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass TurtleArmor extends EquippableItem {\r\n  getId(): string {\r\n    return \"turtleArmor\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./turtleArmor.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Turtle Armor\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A very heavy armor. Offers extremely strong protection, but reduces attack speed to a crawl...\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 3500;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 90;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 1.0;\r\n  }\r\n}\r\n\r\nexport const turtleArmor = new TurtleArmor();\r\n\r\nclass TransmuteTurtleArmor extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return turtleArmor;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 23,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n        EarthEssence: 33000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 100,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteTurtleArmor = new TransmuteTurtleArmor();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass LeatherArmor extends EquippableItem {\r\n  getId(): string {\r\n    return \"leatherArmor\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./leatherArmor.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Leather Armor\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"Standard protective equipment. Gives some protection without drawbacks to movement.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 500;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 18;\r\n  }\r\n}\r\n\r\nexport const leatherArmor = new LeatherArmor();\r\n\r\nclass TransmuteLeatherArmor extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return leatherArmor;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        EarthEssence: 1200,\r\n      },\r\n      items: {\r\n        elementalShardFire: 8,\r\n        elementalShardEarth: 1,\r\n        elementalShardAir: 1,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nexport const transmuteLeatherArmor = new TransmuteLeatherArmor();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass ReinforcedLeatherArmor extends EquippableItem {\r\n  getId(): string {\r\n    return \"reinforcedLeatherArmor\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./reinforcedLeatherArmor.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Reinforced Leather Armor\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A sturdy light armor, with good straightforward protection.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 3500;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 65;\r\n  }\r\n}\r\n\r\nexport const reinforcedLeatherArmor = new ReinforcedLeatherArmor();\r\n\r\nclass TransmuteReinforcedLeatherArmor extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return reinforcedLeatherArmor;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 21,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 600,\r\n        EarthEssence: 18000,\r\n      },\r\n      items: {\r\n        elementalShardFire: 50,\r\n        elementalShardEarth: 5,\r\n        thickHide: 10,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nexport const transmuteReinforcedLeatherArmor =\r\n  new TransmuteReinforcedLeatherArmor();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass ElderWizardsRobe extends EquippableItem {\r\n  getId(): string {\r\n    return \"elderWizardsRobe\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./elderWizardsRobe.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Elder Wizard's Robe\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"An upgraded version of the Wizard's Robe. This time, built from cotton, to last longer.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2750;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 20;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 18;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 800;\r\n  }\r\n}\r\n\r\nexport const elderWizardsRobe = new ElderWizardsRobe();\r\n\r\nclass TransmuteElderWizardsRobe extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return elderWizardsRobe;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 15,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n      },\r\n      items: {\r\n        elementalShardWater: 25,\r\n        cotton: 6,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nexport const transmuteElderWizardsRobe = new TransmuteElderWizardsRobe();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { AttackTarget } from \"../../../../exploration/AttackTarget\";\r\nimport { CombatStat } from \"../../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass TunicOfGoodHealth extends EquippableItem {\r\n  getId(): string {\r\n    return \"tunicOfGoodHealth\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Body;\r\n  }\r\n  getPicture() {\r\n    return require(\"./tunicOfGoodHealth.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Tunic of Good Health\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A cotton-based cloth armor that greatly boosts longevity and allows for recovering quicker.\",\r\n    );\r\n  }\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    return t(\"Double passive HP regeneration speed\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 4800;\r\n  }\r\n\r\n  getDefenseBonusBase(params: ItemParams): number {\r\n    return 24;\r\n  }\r\n\r\n  getMaxHPBonusBase(params: ItemParams): number {\r\n    return 80;\r\n  }\r\n}\r\n\r\nexport const tunicOfGoodHealth = new TunicOfGoodHealth();\r\n\r\nregisterTransformation(\r\n  [[CombatStat.HPRegen, AttackTarget.Player]],\r\n  tunicOfGoodHealth.getId(),\r\n  tunicOfGoodHealth.getName(tunicOfGoodHealth.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    getEquippedItem(state, EquipmentSlot.Body)?.itemId ==\r\n    tunicOfGoodHealth.getId()\r\n      ? 2.0\r\n      : 1.0,\r\n);\r\n\r\nclass TransmuteTunicOfGoodHealth extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return tunicOfGoodHealth;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 19,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n        WaterEssence: 30000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 60,\r\n        cotton: 20,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nexport const transmuteTunicOfGoodHealth = new TransmuteTunicOfGoodHealth();\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass GaleScepter extends EquippableItem {\r\n  getId(): string {\r\n    return \"galeScepter\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./galeScepter.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Gale Scepter\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A staff with a heavy affinity for Air.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 4000;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 35;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.3;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 30;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 700;\r\n  }\r\n\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.15,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      magnitudeCost: {\r\n        value: 0.25,\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> power of Air elemental spells; ^{{magnitudeCost}}^<{{explanationCost}}> :mana: cost of Air elemental spells\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n        explanation: explanations.magnitude,\r\n        magnitudeCost: formatMultiplier(1.0 / (1.0 + effects.magnitudeCost)),\r\n        explanationCost: explanations.magnitudeCost,\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const galeScepter = new GaleScepter();\r\n\r\nregisterTransformation(\r\n  [\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.ActionMagnitude,\r\n      SpellElement.Air,\r\n    ],\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.TemporaryEffectMagnitude,\r\n      SpellElement.Air,\r\n    ],\r\n  ],\r\n  galeScepter.getId(),\r\n  galeScepter.getName(galeScepter.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    getEquippedItem(state, EquipmentSlot.Hand)?.itemId == galeScepter.getId()\r\n      ? galeScepter.getEquippedItemEffect(state, \"magnitude\").magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nregisterTransformation(\r\n  [[SpellElement.Air, TransformationTags.Cost, Resource.Mana]],\r\n  galeScepter.getId() + \"cost\",\r\n  galeScepter.getName(galeScepter.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    galeScepter.isEquippedWithAnyParams(state)\r\n      ? 1.0 /\r\n        (galeScepter.getEquippedItemEffect(state, \"magnitudeCost\")\r\n          .magnitudeCost +\r\n          1.0)\r\n      : 1.0,\r\n);\r\n\r\nclass TransmuteGaleScepter extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return galeScepter;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 23,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 600,\r\n        AirEssence: 33000,\r\n      },\r\n      items: {\r\n        elementalShardAir: 150,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const transmuteGaleScepter = new TransmuteGaleScepter();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass Knuckles extends EquippableItem {\r\n  getId(): string {\r\n    return \"knuckles\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./knuckles.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Knuckles\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A tiny, but swift weapon. Weak, but its speed makes up for it.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 500;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 20;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.4;\r\n  }\r\n}\r\n\r\nconst knuckles = new Knuckles();\r\n\r\nclass TransmuteKnuckles extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return knuckles;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        AirEssence: 1800,\r\n      },\r\n      items: {\r\n        elementalShardAir: 10,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nconst transmuteKnuckles = new TransmuteKnuckles();\r\nexport { knuckles as Knuckles, transmuteKnuckles as TransmuteKnuckles };\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass Longsword extends EquippableItem {\r\n  getId(): string {\r\n    return \"longsword\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./longsword.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Longsword\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A standard longsword. Consistent, average damage.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 500;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 30;\r\n  }\r\n}\r\n\r\nconst longsword = new Longsword();\r\n\r\nclass TransmuteLongsword extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return longsword;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 6,\r\n        elementalShardFire: 2,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst transmuteLongsword = new TransmuteLongsword();\r\nexport { longsword as Longsword, transmuteLongsword as TransmuteLongsword };\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass CopperWarhammer extends EquippableItem {\r\n  getId(): string {\r\n    return \"copperWarhammer\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getExtraSlots(): EquipmentSlot[] {\r\n    return [EquipmentSlot.Accessory];\r\n  }\r\n  getPicture() {\r\n    return require(\"./copperWarhammer.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Warhammer\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A heavy hammer made from reinforced copper. Has a great amount of metal, but is very powerful.\",\r\n    );\r\n  }\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    return t(\"Extra large\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 4000;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 185;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0.65;\r\n  }\r\n}\r\n\r\nexport const copperWarhammer = new CopperWarhammer();\r\n\r\nclass TransmuteCopperWarhammer extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return copperWarhammer;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 18,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 400,\r\n        FireEssence: 20000,\r\n      },\r\n      items: {\r\n        elementalShardFire: 50,\r\n        copperIngot: 12,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nexport const transmuteCopperWarhammer = new TransmuteCopperWarhammer();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource, getResourceAmount } from \"../../../../Resources\";\r\nimport { CombatStat } from \"../../../../exploration/CombatStats\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../../transformation/Transformation\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass RedConflagration extends EquippableItem {\r\n  getId(): string {\r\n    return \"redConflagration\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getExtraSlots(): EquipmentSlot[] {\r\n    return [EquipmentSlot.Accessory];\r\n  }\r\n  getPicture() {\r\n    return require(\"./redConflagration.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Red Conflagration\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A massive two-handed sword. Leverages :fireessence: to empower itself further, but spellcasting suffers.\",\r\n    );\r\n  }\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    return t(\"Extra large\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 9000;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return -2000;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 340;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return 0.4;\r\n  }\r\n}\r\n\r\nexport const redConflagration = new RedConflagration();\r\n\r\nregisterTransformation(\r\n  [[redConflagration.getId(), CombatStat.Attack]],\r\n  redConflagration.getId() + \"fireEssence\",\r\n  t(\":fireessence: amount\"),\r\n  TransformationType.Multiplier,\r\n  (state) => {\r\n    const fireEssence = getResourceAmount(state, Resource.FireEssence);\r\n    return Math.max(\r\n      0.5,\r\n      Math.floor(Math.log10(fireEssence / 15000.0) * 10) / 10,\r\n    );\r\n  },\r\n);\r\n\r\nclass TransmuteRedConflagration extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return redConflagration;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 27,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 700,\r\n        FireEssence: 120000,\r\n      },\r\n      items: {\r\n        elementalPrismFire: 30,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nexport const transmuteRedConflagration = new TransmuteRedConflagration();\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass WandOfFire extends EquippableItem {\r\n  getId(): string {\r\n    return \"wandOfFire\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./wandOfFire.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Wand of Fire\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A simple wand. Fire spells are powerful, and this makes them even more so.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 8000;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 70;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 80;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 1200;\r\n  }\r\n\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.2,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> power of Fire elemental spells\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n        explanation: explanations.magnitude,\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const wandOfFire = new WandOfFire();\r\n\r\nregisterTransformation(\r\n  [\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.ActionMagnitude,\r\n      SpellElement.Fire,\r\n    ],\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.TemporaryEffectMagnitude,\r\n      SpellElement.Fire,\r\n    ],\r\n  ],\r\n  wandOfFire.getId(),\r\n  wandOfFire.getName(wandOfFire.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    getEquippedItem(state, EquipmentSlot.Hand)?.itemId == wandOfFire.getId()\r\n      ? wandOfFire.getEquippedItemEffect(state, \"magnitude\").magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nclass TransmuteWandOfFire extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return wandOfFire;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 29,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 700,\r\n        FireEssence: 100000,\r\n      },\r\n      items: {\r\n        elementalPrismFire: 25,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nexport const transmuteWandOfFire = new TransmuteWandOfFire();\r\n","import { formatNumber } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { AttackTarget } from \"../../../../exploration/AttackTarget\";\r\nimport { CombatActionResultListeners } from \"../../../../exploration/ExplorationActionResult\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { poison } from \"../../../../temporaryeffects/Poison\";\r\nimport { grantTemporaryEffect } from \"../../../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass Dagger extends EquippableItem {\r\n  getId(): string {\r\n    return \"dagger\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./dagger.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Dagger\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A small blade with the power of Poison.\");\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 800;\r\n  }\r\n\r\n  poisonTags = [TransformationTags.TemporaryEffectMagnitude, poison.getId()];\r\n  poisonDurationTags = [\r\n    TransformationTags.TemporaryEffectDuration,\r\n    poison.getId(),\r\n  ];\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      poisonStrength: {\r\n        value: 8,\r\n        tags: this.poisonTags,\r\n        unit: \":hp:/sec\",\r\n      },\r\n      poisonDuration: {\r\n        value: 1,\r\n        tags: this.poisonDurationTags,\r\n        unit: \" sec\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getPoisonStrength(state: GameState, params: ItemParams): number {\r\n    return this.getItemEffects(state, params, \"poisonStrength\").poisonStrength;\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const poisonStrength = this.getPoisonStrength(state, params);\r\n    const poisonDuration = this.getItemEffects(\r\n      state,\r\n      params,\r\n      \"poisonDuration\",\r\n    ).poisonDuration;\r\n    return t(\r\n      \"On hit, applies ^-{{poisonStrength}}^<{{strengthExplanation}}>:hp:/sec Poison for ^{{poisonDuration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        poisonStrength: formatNumber(poisonStrength),\r\n        strengthExplanation: this.getItemEffectExplanations(\r\n          state,\r\n          params,\r\n          \"poisonStrength\",\r\n        ).poisonStrength,\r\n        poisonDuration: formatNumber(poisonDuration, { showDecimals: true }),\r\n        durationExplanation: this.getItemEffectExplanations(\r\n          state,\r\n          params,\r\n          \"poisonDuration\",\r\n        ).poisonDuration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 20;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.3;\r\n  }\r\n}\r\n\r\nexport const dagger = new Dagger();\r\n\r\nCombatActionResultListeners.register((state, result) => {\r\n  if (dagger.isEquippedWithAnyParams(state)) {\r\n    if (\r\n      result.source == AttackTarget.Player &&\r\n      result.tags.includes(TransformationTags.AutoAttack) &&\r\n      result.isHit\r\n    ) {\r\n      const effects = dagger.getItemEffects(\r\n        state,\r\n        getEquippedItem(state, EquipmentSlot.Hand).params,\r\n      );\r\n      state = grantTemporaryEffect(poison.getId(), effects.poisonDuration, {\r\n        mode: \"add\",\r\n        target: result.target,\r\n        params: {\r\n          magnitude: dagger.getPoisonStrength(\r\n            state,\r\n            getEquippedItem(state, EquipmentSlot.Hand).params,\r\n          ),\r\n        },\r\n      })(state);\r\n    }\r\n  }\r\n  return state;\r\n});\r\n\r\nclass TransmuteDagger extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return dagger;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        PoisonEssence: 2500,\r\n      },\r\n      items: {\r\n        elementalShardAir: 1,\r\n        elementalShardPoison: 4,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteDagger = new TransmuteDagger();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass ShadowBlade extends EquippableItem {\r\n  getId(): string {\r\n    return \"shadowBlade\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./shadowBlade.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Shadow Blade\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A silent killer. Fast, effective, and keeps the wielder undetected.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 10000;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 105;\r\n  }\r\n\r\n  getAttackDelayBonusRatioBase(params: ItemParams): number {\r\n    return -0.3;\r\n  }\r\n\r\n  getPlayerDodgeBonusBase(params: ItemParams): number {\r\n    return 15;\r\n  }\r\n}\r\n\r\nexport const shadowBlade = new ShadowBlade();\r\n\r\nclass TransmuteShadowBlade extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return shadowBlade;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 29,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 700,\r\n        PoisonEssence: 115000,\r\n      },\r\n      items: {\r\n        elementalPrismPoison: 16,\r\n        elementalPrismAir: 1,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteShadowBlade = new TransmuteShadowBlade();\r\n","import { formatMultiplier } from \"../../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../../action/Action\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../../transformation/TransformationTags\";\r\nimport { EquipmentSlot, getEquippedItem } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass WandOfPoison extends EquippableItem {\r\n  getId(): string {\r\n    return \"wandOfPoison\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./wandOfPoison.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Wand of Poison\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A magical wand fine tuned for Poison. Increases power of Poison spells.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 5000;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 60;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 60;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 1200;\r\n  }\r\n\r\n  protected getBaseExtraItemEffects(\r\n    params: ItemParams,\r\n  ): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.15,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffectExtra(state: GameState, params: ItemParams): string {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> power of Poison elemental spells\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n        explanation: explanations.magnitude,\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const wandOfPoison = new WandOfPoison();\r\n\r\nregisterTransformation(\r\n  [\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.ActionMagnitude,\r\n      SpellElement.Poison,\r\n    ],\r\n    [\r\n      TransformationTags.ActionEffect,\r\n      TransformationTags.TemporaryEffectMagnitude,\r\n      SpellElement.Poison,\r\n    ],\r\n  ],\r\n  wandOfPoison.getId(),\r\n  wandOfPoison.getName(wandOfPoison.getDefaultParams()),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    getEquippedItem(state, EquipmentSlot.Hand)?.itemId == wandOfPoison.getId()\r\n      ? wandOfPoison.getEquippedItemEffect(state, \"magnitude\").magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nclass TransmuteWandOfPoison extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return wandOfPoison;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 25,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 600,\r\n        PoisonEssence: 50000,\r\n      },\r\n      items: {\r\n        elementalPrismPoison: 6,\r\n        copperIngot: 20,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmuteWandOfPoison = new TransmuteWandOfPoison();\r\n","import { t } from \"../../../../../utils/I18n\";\r\nimport { GameState } from \"../../../../GameState\";\r\nimport { Resource } from \"../../../../Resources\";\r\nimport { SpellElement } from \"../../../../spells/Elements\";\r\nimport { EquipmentSlot } from \"../../../Equipment\";\r\nimport { ItemParams } from \"../../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../../transmute/EquipmentTransmutationSpell\";\r\nimport { EquippableItem } from \"../../EquippableItem\";\r\n\r\nclass Rod extends EquippableItem {\r\n  getId(): string {\r\n    return \"rod\";\r\n  }\r\n  getSlot(): EquipmentSlot {\r\n    return EquipmentSlot.Hand;\r\n  }\r\n  getPicture() {\r\n    return require(\"./rod.png\");\r\n  }\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Rod\");\r\n  }\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"An enchanted short stick. Not too sturdy, not very damaging, but it enhances magic power.\",\r\n    );\r\n  }\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 500;\r\n  }\r\n\r\n  getAttackBonusBase(params: ItemParams): number {\r\n    return 16;\r\n  }\r\n\r\n  getManaRegenBonusBase(params: ItemParams): number {\r\n    return 8;\r\n  }\r\n\r\n  getMaxManaBonusBase(params: ItemParams): number {\r\n    return 400;\r\n  }\r\n}\r\n\r\nconst rod = new Rod();\r\n\r\nclass TransmuteRod extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return rod;\r\n  }\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 5,\r\n    };\r\n  }\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 200,\r\n        EarthEssence: 1200,\r\n      },\r\n      items: {\r\n        elementalShardFire: 1,\r\n        elementalShardAir: 1,\r\n        elementalShardWater: 7,\r\n      },\r\n    };\r\n  }\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nconst transmuteRod = new TransmuteRod();\r\nexport { rod as Rod, transmuteRod as TransmuteRod };\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { registerTransmutationSpellAndItem } from \"../../transmute/TransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { BuffingPouchItem } from \"./BuffingPouchItem\";\r\n\r\nclass PotionOfAlacrityTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"potionOfAlacrity\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Potion of Alacrity\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-{{magnitude}}%:attackDelay:\", {\r\n      magnitude: formatNumber(\r\n        Math.abs(1 - 1 / (temporaryEffectData.params.magnitude + 1)) * 100,\r\n      ),\r\n    });\r\n  }\r\n  getIcon() {\r\n    return require(\"./potionOfAlacrity.png\");\r\n  }\r\n}\r\n\r\nexport const potionOfAlacrityTemporaryEffect =\r\n  new PotionOfAlacrityTemporaryEffect();\r\n\r\nclass PotionOfAlacrity extends BuffingPouchItem {\r\n  getTemporaryEffect(): TemporaryEffect {\r\n    return potionOfAlacrityTemporaryEffect;\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A magical concoction that makes you feel light as a feather.\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.13636,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n      duration: {\r\n        value: 300,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n\r\n    return t(\r\n      \"^-{{magnitude}}%^<{{explanation}}>:attackDelay: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatNumber(\r\n          Math.abs(1 - 1 / (effects.magnitude + 1)) * 100,\r\n        ),\r\n        explanation: explanations?.magnitude,\r\n        duration: formatNumber(Math.floor(effects.duration)),\r\n        durationExplanation: explanations?.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n}\r\n\r\nexport const potionOfAlacrity = new PotionOfAlacrity();\r\n\r\nclass TransmutePotionOfAlacrity extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return potionOfAlacrity;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 10,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        AirEssence: 3000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n        elementalShardAir: 10,\r\n        slimeDrop: 10,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport const transmutePotionOfAlacrity = new TransmutePotionOfAlacrity();\r\n\r\nexport function loadPotionOfAlacrity() {\r\n  TemporaryEffects.register(potionOfAlacrityTemporaryEffect);\r\n  registerTransmutationSpellAndItem(transmutePotionOfAlacrity);\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.AttackDelay]],\r\n    potionOfAlacrityTemporaryEffect.getId(),\r\n    potionOfAlacrityTemporaryEffect.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(\r\n        state,\r\n        potionOfAlacrityTemporaryEffect.getId(),\r\n        AttackTarget.Player,\r\n      )\r\n        ? 1 /\r\n          (getTemporaryEffectData(\r\n            state,\r\n            potionOfAlacrityTemporaryEffect.getId(),\r\n            AttackTarget.Player,\r\n          ).params.magnitude +\r\n            1)\r\n        : 1.0,\r\n  );\r\n\r\n  registerTemporaryEffectListener(\r\n    potionOfAlacrityTemporaryEffect.getId(),\r\n    (state, effect) => {\r\n      if (effect.id == potionOfAlacrityTemporaryEffect.getId()) {\r\n        state = clearCombatStatCache(\r\n          state,\r\n          AttackTarget.Player,\r\n          CombatStat.AttackDelay,\r\n        );\r\n      }\r\n      return effect;\r\n    },\r\n  );\r\n}\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { registerTransmutationSpellAndItem } from \"../../transmute/TransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { BuffingPouchItem } from \"./BuffingPouchItem\";\r\n\r\nclass PotionOfEvasionTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"potionOfEvasion\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Potion of Evasion\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitude}}:dodge:\", {\r\n      magnitude: formatNumber(temporaryEffectData.params.magnitude),\r\n    });\r\n  }\r\n  getIcon() {\r\n    return require(\"./potionOfEvasion.png\");\r\n  }\r\n}\r\n\r\nexport const potionOfEvasionTemporaryEffect =\r\n  new PotionOfEvasionTemporaryEffect();\r\n\r\nclass PotionOfEvasion extends BuffingPouchItem {\r\n  getTemporaryEffect(): TemporaryEffect {\r\n    return potionOfEvasionTemporaryEffect;\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A magical concoction that accelerates your body motion.\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 20,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 300,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n\r\n    return t(\r\n      \"^+{{magnitude}}^<{{explanation}}>:dodge: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatNumber(effects.magnitude),\r\n        explanation: explanations?.magnitude,\r\n        duration: formatNumber(Math.floor(effects.duration)),\r\n        durationExplanation: explanations?.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 2500;\r\n  }\r\n}\r\n\r\nexport const potionOfEvasion = new PotionOfEvasion();\r\n\r\nclass TransmutePotionOfEvasion extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return potionOfEvasion;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 23,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 600,\r\n        AirEssence: 30000,\r\n        PoisonEssence: 20000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n        elementalShardAir: 50,\r\n        elementalShardPoison: 20,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport const transmutePotionOfEvasion = new TransmutePotionOfEvasion();\r\n\r\nexport function loadPotionOfEvasion() {\r\n  TemporaryEffects.register(potionOfEvasionTemporaryEffect);\r\n  registerTransmutationSpellAndItem(transmutePotionOfEvasion);\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.Dodge]],\r\n    potionOfEvasionTemporaryEffect.getId(),\r\n    potionOfEvasionTemporaryEffect.getDisplayName(),\r\n    TransformationType.Addition,\r\n    (state) =>\r\n      hasTemporaryEffect(\r\n        state,\r\n        potionOfEvasionTemporaryEffect.getId(),\r\n        AttackTarget.Player,\r\n      )\r\n        ? getTemporaryEffectData(\r\n            state,\r\n            potionOfEvasionTemporaryEffect.getId(),\r\n            AttackTarget.Player,\r\n          ).params.magnitude\r\n        : 0,\r\n  );\r\n\r\n  registerTemporaryEffectListener(\r\n    potionOfEvasionTemporaryEffect.getId(),\r\n    (state, effect) => {\r\n      if (effect.id == potionOfEvasionTemporaryEffect.getId()) {\r\n        state = clearCombatStatCache(\r\n          state,\r\n          AttackTarget.Player,\r\n          CombatStat.Dodge,\r\n        );\r\n      }\r\n      return effect;\r\n    },\r\n  );\r\n}\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { registerTransmutationSpellAndItem } from \"../../transmute/TransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { BuffingPouchItem } from \"./BuffingPouchItem\";\r\n\r\nclass PotionOfMuscleTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"potionOfMuscle\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Potion of Muscle\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitude}}:attack:\", {\r\n      magnitude: formatNumber(temporaryEffectData.params.magnitude),\r\n    });\r\n  }\r\n  getIcon() {\r\n    return require(\"./potionOfMuscle.png\");\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new PotionOfMuscleTemporaryEffect();\r\n\r\nclass PotionOfMuscle extends BuffingPouchItem {\r\n  getTemporaryEffect(): TemporaryEffect {\r\n    return temporaryEffect;\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A magical concoction that boosts your raw strength and makes you hit harder.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 16.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 300,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n\r\n    return t(\r\n      \"^+{{magnitude}}^<{{explanation}}>:attack: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatNumber(effects.magnitude),\r\n        explanation: explanations?.magnitude,\r\n        duration: formatNumber(Math.floor(effects.duration)),\r\n        durationExplanation: explanations?.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n}\r\n\r\nconst potionOfMuscle = new PotionOfMuscle();\r\n\r\nclass TransmutePotionOfMuscle extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return potionOfMuscle;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 10,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        FireEssence: 3000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n        elementalShardFire: 10,\r\n        slimeDrop: 10,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nconst transmutePotionOfMuscle = new TransmutePotionOfMuscle();\r\n\r\nexport function loadPotionOfMuscle() {\r\n  TemporaryEffects.register(temporaryEffect);\r\n  registerTransmutationSpellAndItem(transmutePotionOfMuscle);\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.Attack]],\r\n    temporaryEffect.getId(),\r\n    temporaryEffect.getDisplayName(),\r\n    TransformationType.Addition,\r\n    (state) =>\r\n      hasTemporaryEffect(state, temporaryEffect.getId(), AttackTarget.Player)\r\n        ? getTemporaryEffectData(\r\n            state,\r\n            temporaryEffect.getId(),\r\n            AttackTarget.Player,\r\n          ).params.magnitude\r\n        : 0,\r\n  );\r\n\r\n  registerTemporaryEffectListener(temporaryEffect.getId(), (state, effect) => {\r\n    if (effect.id == temporaryEffect.getId()) {\r\n      state = clearCombatStatCache(\r\n        state,\r\n        AttackTarget.Player,\r\n        CombatStat.Attack,\r\n      );\r\n    }\r\n    return effect;\r\n  });\r\n}\r\n\r\nexport {\r\n  potionOfMuscle as PotionOfMuscle,\r\n  temporaryEffect as PotionOfMuscleTemporaryEffect,\r\n  transmutePotionOfMuscle as TransmutePotionOfMuscle,\r\n};\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../../transformation/TransformationTags\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { registerTransmutationSpellAndItem } from \"../../transmute/TransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { BuffingPouchItem } from \"./BuffingPouchItem\";\r\n\r\nclass PotionOfToughnessTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"potionOfToughness\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Potion of Toughness\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitude}}:defense:\", {\r\n      magnitude: formatNumber(temporaryEffectData.params.magnitude),\r\n    });\r\n  }\r\n  getIcon() {\r\n    return require(\"./potionOfToughness.png\");\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new PotionOfToughnessTemporaryEffect();\r\n\r\nclass PotionOfToughness extends BuffingPouchItem {\r\n  getTemporaryEffect(): TemporaryEffect {\r\n    return temporaryEffect;\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A magical concoction that strengthens your body's resistance to blows.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 16.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n      },\r\n      duration: {\r\n        value: 300,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n\r\n    return t(\r\n      \"^+{{magnitude}}^<{{explanation}}>:defense: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatNumber(effects.magnitude),\r\n        explanation: explanations?.magnitude,\r\n        duration: formatNumber(Math.floor(effects.duration)),\r\n        durationExplanation: explanations?.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n}\r\n\r\nconst potionOfToughness = new PotionOfToughness();\r\n\r\nclass TransmutePotionOfToughness extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return potionOfToughness;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 10,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        EarthEssence: 3000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 5,\r\n        elementalShardEarth: 10,\r\n        slimeDrop: 10,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nconst transmutePotionOfToughness = new TransmutePotionOfToughness();\r\n\r\nexport function loadPotionOfToughness() {\r\n  TemporaryEffects.register(temporaryEffect);\r\n  registerTransmutationSpellAndItem(transmutePotionOfToughness);\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.Defense]],\r\n    temporaryEffect.getId(),\r\n    temporaryEffect.getDisplayName(),\r\n    TransformationType.Addition,\r\n    (state) =>\r\n      hasTemporaryEffect(state, temporaryEffect.getId(), AttackTarget.Player)\r\n        ? getTemporaryEffectData(\r\n            state,\r\n            temporaryEffect.getId(),\r\n            AttackTarget.Player,\r\n          ).params.magnitude\r\n        : 0,\r\n  );\r\n\r\n  registerTemporaryEffectListener(temporaryEffect.getId(), (state, effect) => {\r\n    if (effect.id == temporaryEffect.getId()) {\r\n      state = clearCombatStatCache(\r\n        state,\r\n        AttackTarget.Player,\r\n        CombatStat.Defense,\r\n      );\r\n    }\r\n    return effect;\r\n  });\r\n}\r\n\r\nexport {\r\n  potionOfToughness as PotionOfToughness,\r\n  temporaryEffect as PotionOfToughnessTemporaryEffect,\r\n  transmutePotionOfToughness as TransmutePotionOfToughness,\r\n};\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  clearCombatStatCache,\r\n  CombatStat,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { TemporaryEffect } from \"../../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  getTemporaryEffectData,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n} from \"../../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  registerTransformation,\r\n  TransformationType,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { ItemParams } from \"../../Item\";\r\nimport { EquipmentTransmutationSpell } from \"../../transmute/EquipmentTransmutationSpell\";\r\nimport { registerTransmutationSpellAndItem } from \"../../transmute/TransmutationSpell\";\r\nimport { EquippableItem } from \"../EquippableItem\";\r\nimport { BuffingPouchItem } from \"./BuffingPouchItem\";\r\n\r\nclass PotionOfVitalityTemporaryEffect extends TemporaryEffect {\r\n  getId(): string {\r\n    return \"potionOfVitality\";\r\n  }\r\n  getDisplayName(): string {\r\n    return t(\"Potion of Vitality\");\r\n  }\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitude}}% :hp: regeneration in combat\", {\r\n      magnitude: formatNumber(temporaryEffectData.params.magnitude * 100),\r\n    });\r\n  }\r\n  getIcon() {\r\n    return require(\"./potionOfVitality.png\");\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new PotionOfVitalityTemporaryEffect();\r\n\r\nclass PotionOfVitality extends BuffingPouchItem {\r\n  getTemporaryEffect(): TemporaryEffect {\r\n    return temporaryEffect;\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\"A magical concoction that improves your regeneration powers.\");\r\n  }\r\n\r\n  protected getBaseItemEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.5,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      duration: {\r\n        value: 300,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    const effects = this.getItemEffects(state, params);\r\n    const explanations = this.getItemEffectExplanations(state, params);\r\n\r\n    return t(\r\n      \"^+{{magnitude}}%^<{{explanation}}> :hp: regeneration in combat for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatNumber(effects.magnitude * 100),\r\n        explanation: explanations?.magnitude,\r\n        duration: formatNumber(Math.floor(effects.duration)),\r\n        durationExplanation: explanations?.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 400;\r\n  }\r\n}\r\n\r\nconst potionOfVitality = new PotionOfVitality();\r\n\r\nclass TransmutePotionOfVitality extends EquipmentTransmutationSpell {\r\n  getItem(): EquippableItem {\r\n    return potionOfVitality;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 10,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 300,\r\n        WaterEssence: 3000,\r\n      },\r\n      items: {\r\n        elementalShardWater: 15,\r\n        slimeDrop: 10,\r\n      },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nconst transmutePotionOfVitality = new TransmutePotionOfVitality();\r\n\r\nexport function loadPotionOfVitality() {\r\n  TemporaryEffects.register(temporaryEffect);\r\n  registerTransmutationSpellAndItem(transmutePotionOfVitality);\r\n\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.HPRegen]],\r\n    temporaryEffect.getId(),\r\n    temporaryEffect.getDisplayName(),\r\n    TransformationType.Multiplier,\r\n    (state) =>\r\n      hasTemporaryEffect(state, temporaryEffect.getId(), AttackTarget.Player)\r\n        ? getTemporaryEffectData(\r\n            state,\r\n            temporaryEffect.getId(),\r\n            AttackTarget.Player,\r\n          ).params.magnitude + 1.0\r\n        : 1.0,\r\n  );\r\n  registerTemporaryEffectListener(temporaryEffect.getId(), (state, effect) => {\r\n    if (effect.id == temporaryEffect.getId()) {\r\n      state = clearCombatStatCache(\r\n        state,\r\n        AttackTarget.Player,\r\n        CombatStat.HPRegen,\r\n      );\r\n    }\r\n    return effect;\r\n  });\r\n}\r\n\r\nexport {\r\n  temporaryEffect as PotionOfVitalityTemporaryEffect,\r\n  potionOfVitality as PotionOfVitality,\r\n  transmutePotionOfVitality as TransmutePotionOfVitality,\r\n};\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport { TransmutationSpell } from \"../TransmutationSpell\";\r\n\r\nclass CopperIngot extends Item {\r\n  getId(): string {\r\n    return \"copperIngot\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./copperIngot.png\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Copper Ingot\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"Processed Copper Ore. Although soft, in this state it can be used to make equipment.\",\r\n    );\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 300;\r\n  }\r\n}\r\n\r\nconst copperIngot = new CopperIngot();\r\n\r\nclass TransmuteCopperIngot extends TransmutationSpell {\r\n  getItem(): Item {\r\n    return copperIngot;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 10,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 250,\r\n        FireEssence: 7500,\r\n      },\r\n      items: { copperOre: 6 },\r\n    };\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nconst transmuteCopperIngot = new TransmuteCopperIngot();\r\n\r\nexport { transmuteCopperIngot, copperIngot };\r\n","import { valuesOf } from \"../../../../utils/CoreUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../../spells/channeling/ChannelingResources\";\r\nimport { SpellElement, translateElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport {\r\n  registerTransmutationSpellAndItem,\r\n  TransmutationSpell,\r\n} from \"../TransmutationSpell\";\r\n\r\nclass ElementalPrism extends Item {\r\n  element: SpellElement;\r\n  icon: any;\r\n  baseSalePrice: number;\r\n\r\n  constructor(element: SpellElement, icon: any, baseSalePrice: number) {\r\n    super();\r\n    this.element = element;\r\n    this.icon = icon;\r\n    this.baseSalePrice = baseSalePrice;\r\n  }\r\n\r\n  getId(): string {\r\n    return \"elementalPrism\" + this.element;\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return this.icon;\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return this.element;\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"{{element}} Prism\", { element: translateElement(this.element) });\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A prism built with very-high-density {{resourceIcon}}. Useful for more advanced transmutation.\",\r\n      { resourceIcon: `:${RESOURCE_FOR_ELEMENT[this.element].toLowerCase()}:` },\r\n    );\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return this.baseSalePrice;\r\n  }\r\n}\r\n\r\nclass ElementalPrismTransmutation extends TransmutationSpell {\r\n  item: ElementalPrism;\r\n  essenceAmountRequired: number;\r\n\r\n  constructor(item: ElementalPrism, essenceAmountRequired: number) {\r\n    super();\r\n    this.item = item;\r\n    this.essenceAmountRequired = essenceAmountRequired;\r\n  }\r\n\r\n  getItem(): Item {\r\n    return this.item;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    const requirements = {};\r\n    requirements[this.item.getElement()] = 24;\r\n    return requirements;\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    const resources = { Mana: 200 };\r\n    resources[RESOURCE_FOR_ELEMENT[this.item.getElement()]] =\r\n      this.essenceAmountRequired;\r\n    return {\r\n      resources,\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 30;\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return this.item.getElement();\r\n  }\r\n}\r\n\r\nexport function loadElementalPrisms() {\r\n  const perElementData: Record<SpellElement, any> = {\r\n    Fire: {\r\n      icon: require(\"./firePrism.png\"),\r\n      salePriceMultiplier: 1.5,\r\n    },\r\n    Earth: {\r\n      icon: require(\"./earthPrism.png\"),\r\n      salePriceMultiplier: 1.5,\r\n    },\r\n    Water: {\r\n      icon: require(\"./waterPrism.png\"),\r\n      salePriceMultiplier: 1.0,\r\n    },\r\n    Air: {\r\n      icon: require(\"./airPrism.png\"),\r\n      salePriceMultiplier: 1.0,\r\n    },\r\n    Poison: {\r\n      icon: require(\"./poisonPrism.png\"),\r\n      salePriceMultiplier: 3.0,\r\n    },\r\n    Mind: {\r\n      icon: require(\"./mindPrism.png\"),\r\n      salePriceMultiplier: 2.0,\r\n    },\r\n    Life: {\r\n      icon: require(\"./lifePrism.png\"),\r\n      salePriceMultiplier: 2.5,\r\n    },\r\n    Electric: {\r\n      icon: require(\"./electricPrism.png\"),\r\n      salePriceMultiplier: 10.0,\r\n    },\r\n    Death: {\r\n      icon: require(\"./deathPrism.png\"),\r\n      salePriceMultiplier: 5.0,\r\n    },\r\n    Holy: {\r\n      icon: require(\"./holyPrism.png\"),\r\n      salePriceMultiplier: 6.0,\r\n    },\r\n    Time: {\r\n      icon: require(\"./timePrism.png\"),\r\n      salePriceMultiplier: 1.5,\r\n    },\r\n    Space: {\r\n      icon: require(\"./spacePrism.png\"),\r\n      salePriceMultiplier: 2.0,\r\n    },\r\n  };\r\n  const basePrice = 2000;\r\n  const baseEssenceAmount = 50000;\r\n  for (let element of valuesOf(SpellElement)) {\r\n    const perElement = perElementData[element];\r\n    const prismItem = new ElementalPrism(\r\n      element,\r\n      perElement.icon,\r\n      basePrice * perElement.salePriceMultiplier,\r\n    );\r\n    const transmuteSpell = new ElementalPrismTransmutation(\r\n      prismItem,\r\n      baseEssenceAmount,\r\n    );\r\n    registerTransmutationSpellAndItem(transmuteSpell);\r\n  }\r\n}\r\n","import { valuesOf } from \"../../../../utils/CoreUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../../../spells/channeling/ChannelingResources\";\r\nimport { SpellElement, translateElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport {\r\n  registerTransmutationSpellAndItem,\r\n  TransmutationSpell,\r\n} from \"../TransmutationSpell\";\r\n\r\nclass ElementalShard extends Item {\r\n  element: SpellElement;\r\n  icon: any;\r\n  baseSalePrice: number;\r\n\r\n  constructor(element: SpellElement, icon: any, baseSalePrice: number) {\r\n    super();\r\n    this.element = element;\r\n    this.icon = icon;\r\n    this.baseSalePrice = baseSalePrice;\r\n  }\r\n\r\n  getId(): string {\r\n    return \"elementalShard\" + this.element;\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return this.icon;\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return this.element;\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"{{element}} Shard\", { element: translateElement(this.element) });\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"A shard resulting from concentrating {{resourceIcon}}. Useful for further transmutation.\",\r\n      { resourceIcon: `:${RESOURCE_FOR_ELEMENT[this.element].toLowerCase()}:` },\r\n    );\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return this.baseSalePrice;\r\n  }\r\n}\r\n\r\nclass ElementalShardTransmutation extends TransmutationSpell {\r\n  item: ElementalShard;\r\n  essenceAmountRequired: number;\r\n\r\n  constructor(item: ElementalShard, essenceAmountRequired: number) {\r\n    super();\r\n    this.item = item;\r\n    this.essenceAmountRequired = essenceAmountRequired;\r\n  }\r\n\r\n  getItem(): Item {\r\n    return this.item;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    const requirements = {};\r\n    requirements[this.item.getElement()] = 2;\r\n    return requirements;\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    const resources = { Mana: 20 };\r\n    resources[RESOURCE_FOR_ELEMENT[this.item.getElement()]] =\r\n      this.essenceAmountRequired;\r\n    return {\r\n      resources,\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 20;\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return this.item.getElement();\r\n  }\r\n}\r\n\r\nexport function loadElementalShards() {\r\n  const perElementData: Record<SpellElement, any> = {\r\n    Fire: {\r\n      icon: require(\"./fireShard.png\"),\r\n      salePriceMultiplier: 1.5,\r\n    },\r\n    Earth: {\r\n      icon: require(\"./earthShard.png\"),\r\n      salePriceMultiplier: 1.5,\r\n    },\r\n    Water: {\r\n      icon: require(\"./waterShard.png\"),\r\n      salePriceMultiplier: 1.0,\r\n    },\r\n    Air: {\r\n      icon: require(\"./airShard.png\"),\r\n      salePriceMultiplier: 1.0,\r\n    },\r\n    Poison: {\r\n      icon: require(\"./poisonShard.png\"),\r\n      salePriceMultiplier: 3.0,\r\n    },\r\n    Mind: {\r\n      icon: require(\"./mindShard.png\"),\r\n      salePriceMultiplier: 2.0,\r\n    },\r\n    Life: {\r\n      icon: require(\"./lifeShard.png\"),\r\n      salePriceMultiplier: 2.5,\r\n    },\r\n    Electric: {\r\n      icon: require(\"./electricShard.png\"),\r\n      salePriceMultiplier: 10.0,\r\n    },\r\n    Death: {\r\n      icon: require(\"./deathShard.png\"),\r\n      salePriceMultiplier: 5.0,\r\n    },\r\n    Holy: {\r\n      icon: require(\"./holyShard.png\"),\r\n      salePriceMultiplier: 6.0,\r\n    },\r\n    Time: {\r\n      icon: require(\"./timeShard.png\"),\r\n      salePriceMultiplier: 1.5,\r\n    },\r\n    Space: {\r\n      icon: require(\"./spaceShard.png\"),\r\n      salePriceMultiplier: 2.0,\r\n    },\r\n  };\r\n  const basePrice = 100;\r\n  const baseEssenceAmount = 500;\r\n  for (let element of valuesOf(SpellElement)) {\r\n    const perElement = perElementData[element];\r\n    const shardItem = new ElementalShard(\r\n      element,\r\n      perElement.icon,\r\n      basePrice * perElement.salePriceMultiplier,\r\n    );\r\n    const transmuteSpell = new ElementalShardTransmutation(\r\n      shardItem,\r\n      baseEssenceAmount,\r\n    );\r\n    registerTransmutationSpellAndItem(transmuteSpell);\r\n  }\r\n}\r\n","import { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { Resource } from \"../../../Resources\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { Item, ItemParams } from \"../../Item\";\r\nimport { ItemTagEnum } from \"../../ItemTagEnum\";\r\nimport { TransmutationSpell } from \"../TransmutationSpell\";\r\n\r\nclass ThickHide extends Item {\r\n  getId(): string {\r\n    return \"thickHide\";\r\n  }\r\n\r\n  getTags(): ItemTagEnum[] {\r\n    return [ItemTagEnum.Material];\r\n  }\r\n\r\n  getPicture() {\r\n    return require(\"./thickHide.png\");\r\n  }\r\n\r\n  getBaseName(params: ItemParams): string {\r\n    return t(\"Thick Hide\");\r\n  }\r\n\r\n  getDescription(state: GameState, params: ItemParams): string | undefined {\r\n    return t(\r\n      \"Thick hide from an animal. Flexible yet resistant, useful for light armor.\",\r\n    );\r\n  }\r\n\r\n  getEffect(state: GameState, params: ItemParams): string | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseSalePrice(state: GameState, params: ItemParams): number {\r\n    return 160;\r\n  }\r\n}\r\n\r\nexport const thickHide = new ThickHide();\r\n\r\nclass TransmuteThickHide extends TransmutationSpell {\r\n  getItem(): Item {\r\n    return thickHide;\r\n  }\r\n\r\n  getCraftingElementLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 16,\r\n    };\r\n  }\r\n\r\n  getCraftingMaterialsBase(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: 500,\r\n        EarthEssence: 10000,\r\n      },\r\n      items: {\r\n        elementalShardEarth: 5,\r\n      },\r\n    };\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 5;\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport const transmuteThickHide = new TransmuteThickHide();\r\n","import { transmuteCloakOfDarkness } from \"./equipment/accessory/air/CloakOfDarkness\";\r\nimport { TransmuteFeatheredHat } from \"./equipment/accessory/air/FeatheredHat\";\r\nimport { transmuteCopperShield } from \"./equipment/accessory/earth/CopperShield\";\r\nimport { transmuteSmallShield } from \"./equipment/accessory/earth/SmallShield\";\r\nimport { transmuteStoneEgg } from \"./equipment/accessory/earth/StoneEgg\";\r\nimport { transmuteCollarOfPower } from \"./equipment/accessory/fire/CollarOfPower\";\r\nimport { transmuteAssassinsCloak } from \"./equipment/accessory/poison/AssassinsCloak\";\r\nimport { transmuteCharmOfPoisonResistance } from \"./equipment/accessory/poison/CharmOfPoisonResistance\";\r\nimport { transmuteSoulStone } from \"./equipment/accessory/poison/SoulStone\";\r\nimport { TransmuteManaTear } from \"./equipment/accessory/water/ManaTear\";\r\nimport { transmuteRingOfRegeneration } from \"./equipment/accessory/water/RingOfRegeneration\";\r\nimport { transmuteWizardsHat } from \"./equipment/accessory/water/WizardsHat\";\r\nimport { TransmuteBreezyShirt } from \"./equipment/body/air/BreezyShirt\";\r\nimport { transmuteEvasiveGarb } from \"./equipment/body/air/EvasiveGarb\";\r\nimport { transmuteCopperArmor } from \"./equipment/body/earth/CopperArmor\";\r\nimport { TransmuteStoneMail } from \"./equipment/body/earth/StoneMail\";\r\nimport { transmuteTurtleArmor } from \"./equipment/body/earth/TurtleArmor\";\r\nimport { transmuteLeatherArmor } from \"./equipment/body/fire/LeatherArmor\";\r\nimport { transmuteReinforcedLeatherArmor } from \"./equipment/body/fire/ReinforcedLeatherArmor\";\r\nimport { transmuteElderWizardsRobe } from \"./equipment/body/water/ElderWizardsRobe\";\r\nimport { transmuteTunicOfGoodHealth } from \"./equipment/body/water/TunicOfGoodHealth\";\r\nimport { TransmuteWizardsRobe } from \"./equipment/body/water/WizardsRobe\";\r\nimport { transmuteCopperGauntlet } from \"./equipment/hand/air/CopperGauntlet\";\r\nimport { transmuteGaleScepter } from \"./equipment/hand/air/GaleScepter\";\r\nimport { transmuteGlaive } from \"./equipment/hand/air/Glaive\";\r\nimport { TransmuteKnuckles } from \"./equipment/hand/air/Knuckles\";\r\nimport { transmuteBastardSword } from \"./equipment/hand/earth/BastardSword\";\r\nimport { transmuteCopperRapier } from \"./equipment/hand/earth/CopperRapier\";\r\nimport { TransmuteLongsword } from \"./equipment/hand/earth/Longsword\";\r\nimport { TransmuteBattleAxe } from \"./equipment/hand/fire/BattleAxe\";\r\nimport { transmuteCopperTomahawk } from \"./equipment/hand/fire/CopperTomahawk\";\r\nimport { transmuteCopperWarhammer } from \"./equipment/hand/fire/CopperWarhammer\";\r\nimport { TransmuteHandAxe } from \"./equipment/hand/fire/HandAxe\";\r\nimport { transmuteRedConflagration } from \"./equipment/hand/fire/RedConflagration\";\r\nimport { transmuteWandOfFire } from \"./equipment/hand/fire/WandOfFire\";\r\nimport { transmuteAssassinsBaselard } from \"./equipment/hand/poison/AssassinsBaselard\";\r\nimport { transmuteDagger } from \"./equipment/hand/poison/Dagger\";\r\nimport { transmuteShadowBlade } from \"./equipment/hand/poison/ShadowBlade\";\r\nimport { transmuteWandOfPoison } from \"./equipment/hand/poison/WandOfPoison\";\r\nimport { TransmuteRod } from \"./equipment/hand/water/Rod\";\r\nimport { transmuteWandOfWater } from \"./equipment/hand/water/WandOfWater\";\r\nimport { transmuteAntidotePotion } from \"./equipment/pouch/AntidotePotion\";\r\nimport { Cherry } from \"./equipment/pouch/Cherry\";\r\nimport { TransmuteHealthPotion } from \"./equipment/pouch/HealthPotion\";\r\nimport { loadPotionOfAlacrity } from \"./equipment/pouch/PotionOfAlacrity\";\r\nimport { loadPotionOfEvasion } from \"./equipment/pouch/PotionOfEvasion\";\r\nimport { loadPotionOfMuscle } from \"./equipment/pouch/PotionOfMuscle\";\r\nimport { loadPotionOfToughness } from \"./equipment/pouch/PotionOfToughness\";\r\nimport { loadPotionOfVitality } from \"./equipment/pouch/PotionOfVitality\";\r\nimport { transmuteVenomousBrew } from \"./equipment/pouch/VenomousBrew\";\r\nimport { loadPouch } from \"./equipment/PouchItem\";\r\nimport { Items } from \"./Items\";\r\nimport SlimeDrop from \"./material/SlimeDrop\";\r\nimport VenomPowder from \"./material/VenomPowder\";\r\nimport Wildgrass from \"./material/Wildgrass\";\r\nimport EtherealEelExtract from \"./quest/EtherealEelExtract\";\r\nimport { transmuteCopperIngot } from \"./transmute/materials/CopperIngot\";\r\nimport { transmuteCopperOre } from \"./transmute/materials/CopperOre\";\r\nimport { transmuteCotton } from \"./transmute/materials/Cotton\";\r\nimport { loadElementalPrisms } from \"./transmute/materials/ElementalPrism\";\r\nimport { loadElementalShards } from \"./transmute/materials/ElementalShard\";\r\nimport { transmutePaper } from \"./transmute/materials/Paper\";\r\nimport { transmuteThickHide } from \"./transmute/materials/ThickHide\";\r\nimport { registerTransmutationSpellAndItem } from \"./transmute/TransmutationSpell\";\r\n\r\nexport function loadItemsDemo() {\r\n  loadPouch();\r\n\r\n  // Loot\r\n  Items.register(Wildgrass);\r\n  Items.register(SlimeDrop);\r\n  Items.register(Cherry);\r\n  Items.register(VenomPowder);\r\n  Items.register(EtherealEelExtract);\r\n\r\n  // Transmutable\r\n  loadElementalShards();\r\n  registerTransmutationSpellAndItem(transmutePaper);\r\n  registerTransmutationSpellAndItem(transmuteCopperOre);\r\n  registerTransmutationSpellAndItem(transmuteCopperIngot);\r\n  registerTransmutationSpellAndItem(transmuteCotton);\r\n  loadElementalPrisms();\r\n\r\n  // Fire\r\n  registerTransmutationSpellAndItem(TransmuteHandAxe);\r\n  registerTransmutationSpellAndItem(transmuteLeatherArmor);\r\n  loadPotionOfMuscle();\r\n  registerTransmutationSpellAndItem(TransmuteBattleAxe);\r\n  registerTransmutationSpellAndItem(transmuteCopperTomahawk);\r\n  registerTransmutationSpellAndItem(transmuteCopperWarhammer);\r\n  registerTransmutationSpellAndItem(transmuteCollarOfPower);\r\n  registerTransmutationSpellAndItem(transmuteReinforcedLeatherArmor);\r\n  registerTransmutationSpellAndItem(transmuteRedConflagration);\r\n  registerTransmutationSpellAndItem(transmuteWandOfFire);\r\n\r\n  // Earth\r\n  registerTransmutationSpellAndItem(TransmuteLongsword);\r\n  registerTransmutationSpellAndItem(TransmuteStoneMail);\r\n  registerTransmutationSpellAndItem(transmuteSmallShield);\r\n  loadPotionOfToughness();\r\n  registerTransmutationSpellAndItem(transmuteBastardSword);\r\n  registerTransmutationSpellAndItem(transmuteCopperRapier);\r\n  registerTransmutationSpellAndItem(transmuteCopperArmor);\r\n  registerTransmutationSpellAndItem(transmuteCopperShield);\r\n  registerTransmutationSpellAndItem(transmuteStoneEgg);\r\n  registerTransmutationSpellAndItem(transmuteTurtleArmor);\r\n  registerTransmutationSpellAndItem(transmuteThickHide);\r\n\r\n  // Water\r\n  registerTransmutationSpellAndItem(TransmuteManaTear);\r\n  registerTransmutationSpellAndItem(TransmuteRod);\r\n  registerTransmutationSpellAndItem(TransmuteWizardsRobe);\r\n  registerTransmutationSpellAndItem(TransmuteHealthPotion);\r\n  loadPotionOfVitality();\r\n  registerTransmutationSpellAndItem(transmuteWandOfWater);\r\n  registerTransmutationSpellAndItem(transmuteElderWizardsRobe);\r\n  registerTransmutationSpellAndItem(transmuteWizardsHat);\r\n  registerTransmutationSpellAndItem(transmuteTunicOfGoodHealth);\r\n  registerTransmutationSpellAndItem(transmuteRingOfRegeneration);\r\n\r\n  // Air\r\n  registerTransmutationSpellAndItem(TransmuteFeatheredHat);\r\n  registerTransmutationSpellAndItem(TransmuteKnuckles);\r\n  registerTransmutationSpellAndItem(TransmuteBreezyShirt);\r\n  loadPotionOfAlacrity();\r\n  registerTransmutationSpellAndItem(transmuteGlaive);\r\n  registerTransmutationSpellAndItem(transmuteCloakOfDarkness);\r\n  registerTransmutationSpellAndItem(transmuteCopperGauntlet);\r\n  registerTransmutationSpellAndItem(transmuteEvasiveGarb);\r\n  registerTransmutationSpellAndItem(transmuteGaleScepter);\r\n\r\n  // Poison\r\n  registerTransmutationSpellAndItem(transmuteCharmOfPoisonResistance);\r\n  registerTransmutationSpellAndItem(transmuteDagger);\r\n  registerTransmutationSpellAndItem(transmuteAntidotePotion);\r\n  registerTransmutationSpellAndItem(transmuteVenomousBrew);\r\n  registerTransmutationSpellAndItem(transmuteAssassinsBaselard);\r\n  registerTransmutationSpellAndItem(transmuteAssassinsCloak);\r\n  registerTransmutationSpellAndItem(transmuteSoulStone);\r\n  loadPotionOfEvasion();\r\n  registerTransmutationSpellAndItem(transmuteWandOfPoison);\r\n  registerTransmutationSpellAndItem(transmuteShadowBlade);\r\n}\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerStandardEmpowerEffects } from \"../Spells\";\r\nimport {\r\n  getStandardSpellAttackEffect,\r\n  getStandardSpellAttackEffectText,\r\n} from \"../Utils\";\r\n\r\nclass AirBlast extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"airBlast\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Air Blast\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 80;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Push an enemy backwards with a blast of air, slightly damaging them. Easy to use repeatedly.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 25,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 5,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return getStandardSpellAttackEffectText(state, this);\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 0.5;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 10;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 7,\r\n    };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 43 };\r\n  }\r\n}\r\n\r\nconst airBlast = new AirBlast();\r\n\r\nregisterStandardEmpowerEffects(airBlast, 6, 15);\r\n\r\nexport default airBlast as AirBlast;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  grantTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationType } from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass BlurTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"blur\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Blur\");\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./blur.png\");\r\n  }\r\n\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [{ stat: CombatStat.Dodge, type: TransformationType.Addition }];\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{amount}}:dodge:\", {\r\n      amount: formatNumber(temporaryEffectData.params.commonBuff.Dodge),\r\n    });\r\n  }\r\n}\r\n\r\nexport const blurTemporaryEffect = new BlurTemporaryEffect();\r\nTemporaryEffects.register(blurTemporaryEffect);\r\n\r\nclass Blur extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"blur\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Blur\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 1200;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        unit: \":dodge:\",\r\n      },\r\n      duration: {\r\n        value: 15.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(blurTemporaryEffect.getId(), effects.duration, {\r\n      params: { commonBuff: { Dodge: effects.magnitude } },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Make yourself harder to spot and target by enemies.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{amount}}^<{{amountExplanation}}>:dodge: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        amount: formatNumber(effects.magnitude),\r\n        amountExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 14 };\r\n  }\r\n}\r\n\r\nexport const blur = new Blur();\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { BuildSaleStall } from \"../../buildings/SaleStall\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\n\r\nclass EnchantSaleStallsTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"enchantSaleStalls\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Enchant Market Stalls\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-{{magnitudePct}}% time between sales from Market Stalls\", {\r\n      magnitudePct: formatNumber(\r\n        (1.0 - 1.0 / (temporaryEffectData.params.magnitude + 1.0)) * 100,\r\n      ),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new EnchantSaleStallsTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass EnchantSaleStalls extends Spell {\r\n  getId(): string {\r\n    return \"enchantSaleStalls\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Enchant Market Stalls\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 150;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.25,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n      duration: {\r\n        value: 30.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return BuildSaleStall.isVisible(state) && super.isVisible(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Use Air to make your Market Stalls more efficient, selling faster for a limited time.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^{{magnitudePct}}^<{{magnitudeExplanation}}> time between sales from Market Stalls for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitudePct: formatMultiplier(1.0 / (1 + effects.magnitude)),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 3 };\r\n  }\r\n}\r\n\r\nconst enchantSaleStalls = new EnchantSaleStalls();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.TimePerAutoSalePerStall]],\r\n  temporaryEffect.getId(),\r\n  enchantSaleStalls.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantSaleStalls.getId())\r\n      ? 1.0 /\r\n        (getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude +\r\n          1.0)\r\n      : 1.0,\r\n);\r\n\r\nexport default enchantSaleStalls;\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass LevitationTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"levitation\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Levitation\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"-{{magnitude}}% time between Explorations\", {\r\n      magnitude: formatNumber(\r\n        Math.abs(1 - 1 / (temporaryEffectData.params.magnitude + 1)) * 100,\r\n      ),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new LevitationTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass Levitation extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"levitation\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Levitation\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 250;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.66667,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n      duration: {\r\n        value: 60.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: {\r\n        magnitude: effects.magnitude,\r\n      },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Make your body float. Without needing to walk, exploring is much faster.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^{{magnitude}}^<{{magnitudeExplanation}}> time between Explorations for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 / (effects.magnitude + 1)),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 11 };\r\n  }\r\n}\r\n\r\nconst levitation = new Levitation();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ExplorationDelay]],\r\n  levitation.getId(),\r\n  levitation.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state, params) =>\r\n    hasTemporaryEffect(state, levitation.getId())\r\n      ? 1 /\r\n        (1 + getTemporaryEffectData(state, levitation.getId()).params.magnitude)\r\n      : 1.0,\r\n);\r\n\r\nexport {\r\n  levitation as Levitation,\r\n  temporaryEffect as LevitationTemporaryEffect,\r\n};\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { BuildSaleStall } from \"../../buildings/SaleStall\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport { registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass RichnessTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"richness\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Richness\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitudePct}}% item sale price from Market Stalls\", {\r\n      magnitudePct: formatNumber(temporaryEffectData.params.magnitude * 100),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new RichnessTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass Richness extends Spell {\r\n  getId(): string {\r\n    return \"richness\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Richness\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 1300;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.5,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      duration: {\r\n        value: 20.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return BuildSaleStall.isVisible(state) && super.isVisible(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Make your items sold by your Market Stalls appear more luxurious. People will pay more.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^{{magnitude}}^<{{magnitudeExplanation}}> item sale price from Market Stalls for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitude: formatMultiplier(1.0 + effects.magnitude),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 21 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 54 };\r\n  }\r\n}\r\n\r\nconst richness = new Richness();\r\n\r\nregisterEmpowerEffects(richness, [TransformationTags.Cost, Resource.Mana], 10);\r\nregisterEmpowerEffects(\r\n  richness,\r\n  [TransformationTags.TemporaryEffectMagnitude],\r\n  3,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.SaleStallRevenue]],\r\n  temporaryEffect.getId(),\r\n  richness.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, richness.getId())\r\n      ? getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nexport default richness;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { getLastQueuedActionResult } from \"../../exploration/ExplorationUtils\";\r\nimport { airborne } from \"../../temporaryeffects/Airborne\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Twister extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"twister\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Twister\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 850;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Create a mass of unstable air, dealing damage to the enemy. Easy to use repeatedly.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 85,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 5,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n      duration: {\r\n        value: 2,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    const standardEffect = getStandardAttackEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n      explanations.average,\r\n    );\r\n    const effectExplanation =\r\n      airborne.getParameterlessDisplayDescription(state);\r\n    return t(\r\n      '{{standardEffect}}; inflicts ^\"Airborne\"^<{{effectExplanation}}> for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        standardEffect,\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n        effectExplanation,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state, \"duration\");\r\n    state = getStandardSpellAttackEffect(state, this);\r\n    if (getLastQueuedActionResult(state).isHit) {\r\n      state = grantTemporaryEffect(airborne.getId(), effects.duration, {\r\n        target: AttackTarget.Enemy,\r\n      })(state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 0.5;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 10;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Air: 19,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, airborne.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default new Twister();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { BasicChannelingSpellBase } from \"./BasicChannelingSpellBase\";\r\n\r\nclass ChannelAir extends BasicChannelingSpellBase {\r\n  getId(): string {\r\n    return \"channelAir\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Channel Air\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  getBaseEssenceEfficiency(): number {\r\n    return 1.6;\r\n  }\r\n\r\n  getManaCostProportion(): number {\r\n    return 0.05;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Channel some of your Mana into Air Essence, a basic resource.\");\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Air: 1 };\r\n  }\r\n}\r\n\r\nexport default new ChannelAir();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { BasicChannelingSpellBase } from \"./BasicChannelingSpellBase\";\r\n\r\nclass ChannelEarth extends BasicChannelingSpellBase {\r\n  getId(): string {\r\n    return \"channelEarth\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Channel Earth\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getBaseEssenceEfficiency(): number {\r\n    return 0.9;\r\n  }\r\n\r\n  getManaCostProportion(): number {\r\n    return 0.15;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Channel some of your Mana into Earth Essence, a basic resource.\");\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 1 };\r\n  }\r\n}\r\n\r\nexport default new ChannelEarth();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { BasicChannelingSpellBase } from \"./BasicChannelingSpellBase\";\r\n\r\nclass ChannelWater extends BasicChannelingSpellBase {\r\n  getId(): string {\r\n    return \"channelWater\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Channel Water\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Channel some of your Mana into Water Essence, a basic resource.\");\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 1 };\r\n  }\r\n}\r\n\r\nexport default new ChannelWater();\r\n","import { addRecords } from \"../../../utils/CoreUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { Flag } from \"../../Flag\";\r\nimport { hasFlag } from \"../../Flags\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { DoActionArgs } from \"../../action/Action\";\r\nimport { ActionArea, ActionSubcategory } from \"../../action/ActionAreas\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { simultaneousChanneling } from \"../../events/storyline/pretraining/ChannelAllStoryline\";\r\nimport { Storylines } from \"../../storylines/Storylines\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport ChannelAir from \"./ChannelAir\";\r\nimport ChannelEarth from \"./ChannelEarth\";\r\nimport ChannelFire from \"./ChannelFire\";\r\nimport ChannelWater from \"./ChannelWater\";\r\n\r\nexport const FOUR_CHANNELING_SPELLS = [\r\n  ChannelFire,\r\n  ChannelEarth,\r\n  ChannelWater,\r\n  ChannelAir,\r\n];\r\n\r\nclass ChannelFour extends Spell {\r\n  getId(): string {\r\n    return \"channelFour\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Channel Four\");\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      `Combines the effects of Channel Fire, Channel Earth, Channel Water, and Channel Air, all in one spell.`,\r\n    );\r\n  }\r\n\r\n  getAreas(): Partial<Record<ActionArea, ActionSubcategory[]>> {\r\n    return {\r\n      SPELL_MENU: [\r\n        SpellElement.Fire,\r\n        SpellElement.Earth,\r\n        SpellElement.Water,\r\n        SpellElement.Air,\r\n      ],\r\n    };\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.CHANNELING;\r\n  }\r\n\r\n  getTags(): string[] {\r\n    if (this._tagArray == null) {\r\n      const tags = [\r\n        TransformationTags.Spell,\r\n        ...Object.keys(this.getLevelRequirements()),\r\n      ];\r\n      this._tagArray = tags;\r\n    }\r\n    return this._tagArray;\r\n  }\r\n\r\n  getCost(state: GameState): {\r\n    resources: Partial<Record<Resource, number>>;\r\n    items: Record<string, number>;\r\n  } {\r\n    return {\r\n      resources: {\r\n        Mana: this.getManaCost(state),\r\n      },\r\n      items: {},\r\n    };\r\n  }\r\n\r\n  getManaCost(state: GameState): number {\r\n    return FOUR_CHANNELING_SPELLS.map((spell) =>\r\n      spell.getManaCost(state, this),\r\n    ).reduce((a, b) => a + b, 0);\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return FOUR_CHANNELING_SPELLS.map((spell) =>\r\n      spell.getDisplayEffect(state),\r\n    ).join(t(\", \"));\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return (\r\n      hasFlag(state, Flag.ChannelingUnlocked) &&\r\n      simultaneousChanneling.isBonusActive(state) &&\r\n      !Storylines.getByIdNullable(\"allTheElements\")?.isBonusActive?.(state)\r\n    );\r\n  }\r\n\r\n  isEnabled(state: GameState, skipAffordabilityChecks?: boolean): boolean {\r\n    return (\r\n      super.isEnabled(state, skipAffordabilityChecks) &&\r\n      this.isCastingRecommended(state)\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 1,\r\n      Earth: 1,\r\n      Water: 1,\r\n      Air: 1,\r\n    };\r\n  }\r\n\r\n  getExpFromUsage(state: GameState) {\r\n    return FOUR_CHANNELING_SPELLS.reduce(\r\n      (previous, current) =>\r\n        addRecords([previous, current.getExpFromUsage(state)]),\r\n      {},\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    return FOUR_CHANNELING_SPELLS.reduce(\r\n      (state, current) => current.doSpellAction(state, args),\r\n      state,\r\n    );\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    return FOUR_CHANNELING_SPELLS.reduce(\r\n      (previous, current) => previous || current.isCastingRecommended(state),\r\n      false,\r\n    );\r\n  }\r\n\r\n  getElement(): SpellElement | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    throw new Error(\"Should not be called\");\r\n  }\r\n}\r\n\r\nexport default new ChannelFour();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { BasicChannelingSpellBase } from \"./BasicChannelingSpellBase\";\r\n\r\nclass ChannelPoison extends BasicChannelingSpellBase {\r\n  getId(): string {\r\n    return \"channelPoison\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Channel Poison\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  getBaseEssenceEfficiency(): number {\r\n    return 0.3333334;\r\n  }\r\n\r\n  getManaCostProportion(): number {\r\n    return 0.1;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Channel some of your Mana into Poison Essence, a basic resource.\",\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Poison: 1 };\r\n  }\r\n}\r\n\r\nexport default new ChannelPoison();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { addGameStateListener } from \"../../GameStateListeners\";\r\nimport { Resource, getResourceAmount, grantResource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport {\r\n  CombatStat,\r\n  clearCombatStatCache,\r\n} from \"../../exploration/CombatStats\";\r\nimport { CombatActionResultListeners } from \"../../exploration/ExplorationActionResult\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass EarthShieldTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"earthShield\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Earth Shield\");\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./stoneskin.png\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"If :earthessence: is {{essenceAmount}} or more, +{{amount}}:defense:; -{{essenceAmount}}:earthessence: on hit\",\r\n      {\r\n        amount: formatNumber(temporaryEffectData.params.effectAmount),\r\n        essenceAmount: formatNumber(temporaryEffectData.params.essenceAmount),\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const earthShieldTemporaryEffect = new EarthShieldTemporaryEffect();\r\nTemporaryEffects.register(earthShieldTemporaryEffect);\r\n\r\nconst calculateEffect = (state) => {\r\n  if (\r\n    !hasTemporaryEffect(\r\n      state,\r\n      earthShieldTemporaryEffect.getId(),\r\n      AttackTarget.Player,\r\n    )\r\n  ) {\r\n    return 0;\r\n  }\r\n  const data = getTemporaryEffectData(\r\n    state,\r\n    earthShieldTemporaryEffect.getId(),\r\n    AttackTarget.Player,\r\n  );\r\n  const essenceAmount = getResourceAmount(state, Resource.EarthEssence);\r\n  if (essenceAmount < data.params.essenceAmount) {\r\n    return 0;\r\n  }\r\n  return data.params.effectAmount;\r\n};\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Defense]],\r\n  earthShieldTemporaryEffect.getId(),\r\n  earthShieldTemporaryEffect.getDisplayName(),\r\n  TransformationType.Addition,\r\n  calculateEffect,\r\n);\r\n\r\naddGameStateListener(\r\n  earthShieldTemporaryEffect.getId() + \"cacheClearer\",\r\n  (state) => (state) =>\r\n    clearCombatStatCache(state, AttackTarget.Player, CombatStat.Defense),\r\n  calculateEffect,\r\n);\r\n\r\nCombatActionResultListeners.register((state, result) => {\r\n  if (\r\n    !hasTemporaryEffect(\r\n      state,\r\n      earthShieldTemporaryEffect.getId(),\r\n      AttackTarget.Player,\r\n    ) ||\r\n    result.target != AttackTarget.Player ||\r\n    !result.isHit\r\n  ) {\r\n    return state;\r\n  }\r\n  const data = getTemporaryEffectData(\r\n    state,\r\n    earthShieldTemporaryEffect.getId(),\r\n    AttackTarget.Player,\r\n  );\r\n  const essenceAmount = getResourceAmount(state, Resource.EarthEssence);\r\n  if (essenceAmount < data.params.essenceAmount) {\r\n    return state;\r\n  }\r\n  state = grantResource(\r\n    Resource.EarthEssence,\r\n    -data.params.essenceAmount,\r\n  )(state);\r\n  return state;\r\n});\r\n\r\nclass EarthShield extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"earthShield\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Earth Shield\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 2000;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 30,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        unit: \":defense:\",\r\n      },\r\n      cost: {\r\n        value: 1000,\r\n        tags: [TransformationTags.TemporaryEffectExtraCost],\r\n        unit: \":earthessence:\",\r\n      },\r\n      duration: {\r\n        value: 30.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      earthShieldTemporaryEffect.getId(),\r\n      effects.duration,\r\n      {\r\n        params: {\r\n          effectAmount: effects.magnitude,\r\n          essenceAmount: effects.cost,\r\n        },\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Use stored :earthessence: to boost your resistance to all sorts of attacks.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"If :earthessence: is ^{{essenceAmount}}^<{{essenceAmountExplanation}}> or more, ^+{{amount}}^<{{amountExplanation}}>:defense:; ^-{{essenceAmount}}^<{{essenceAmountExplanation}}>:earthessence: on hit; effects last ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        essenceAmount: formatNumber(effects.cost),\r\n        essenceAmountExplanation: explanations.cost,\r\n        amount: formatNumber(effects.magnitude),\r\n        amountExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 21 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 58 };\r\n  }\r\n}\r\n\r\nconst earthShield = new EarthShield();\r\n\r\nregisterEmpowerEffects(\r\n  earthShield,\r\n  [TransformationTags.Cost, Resource.Mana],\r\n  10,\r\n);\r\nregisterEmpowerEffects(\r\n  earthShield,\r\n  [TransformationTags.TemporaryEffectExtraCost],\r\n  1000,\r\n);\r\nregisterEmpowerEffects(\r\n  earthShield,\r\n  [TransformationTags.TemporaryEffectMagnitude],\r\n  4,\r\n);\r\n\r\nexport { earthShield };\r\n","import { keysOf } from \"../../../utils/CoreUtils\";\r\nimport { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport { RESOURCE_FOR_ELEMENT } from \"../channeling/ChannelingResources\";\r\n\r\nclass EnchantTransmutationTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"enchantTransmutation\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Enchant Transmutation\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    if (temporaryEffectData.params.magnitudeMana > 0) {\r\n      return t(\r\n        \"-{{magnitudePct}}% Essences and :mana: required for transmutation\",\r\n        {\r\n          magnitudePct: formatNumber(\r\n            (1.0 - 1.0 / (temporaryEffectData.params.magnitude + 1.0)) * 100,\r\n          ),\r\n        },\r\n      );\r\n    }\r\n    return t(\"-{{magnitudePct}}% Essences required for transmutation\", {\r\n      magnitudePct: formatNumber(\r\n        (1.0 - 1.0 / (temporaryEffectData.params.magnitude + 1.0)) * 100,\r\n      ),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new EnchantTransmutationTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass EnchantTransmutation extends Spell {\r\n  getId(): string {\r\n    return \"enchantTransmutation\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Enchant Transmutation\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 180;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.11112,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n      magnitudeMana: {\r\n        value: 0.11112,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n      duration: {\r\n        value: 15.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: {\r\n        magnitude: effects.magnitude,\r\n        magnitudeMana: effects.magnitudeMana,\r\n      },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Use the knowledge and power of the Earth element to make Transmutation more efficient.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    if (effects.magnitudeMana > 0) {\r\n      return t(\r\n        \"^{{magnitudePct}}^<{{magnitudeExplanation}}> Essences and :mana: required for Transmutation for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n        {\r\n          magnitudePct: formatMultiplier(1.0 / (1 + effects.magnitude)),\r\n          magnitudeExplanation: explanations.magnitude,\r\n          duration: formatNumber(effects.duration),\r\n          durationExplanation: explanations.duration,\r\n        },\r\n      );\r\n    }\r\n    return t(\r\n      \"^{{magnitudePct}}^<{{magnitudeExplanation}}> Essences required for Transmutation for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitudePct: formatMultiplier(1.0 / (1 + effects.magnitude)),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 3 };\r\n  }\r\n}\r\n\r\nconst enchantTransmutation = new EnchantTransmutation();\r\n\r\nregisterTransformation(\r\n  keysOf(SpellElement).map((element) => [\r\n    TransformationTags.ItemCost,\r\n    RESOURCE_FOR_ELEMENT[element],\r\n  ]),\r\n  temporaryEffect.getId(),\r\n  enchantTransmutation.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantTransmutation.getId())\r\n      ? 1.0 /\r\n        (getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude +\r\n          1.0)\r\n      : 1.0,\r\n);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.ItemCost, Resource.Mana]],\r\n  temporaryEffect.getId() + \"mana\",\r\n  enchantTransmutation.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantTransmutation.getId())\r\n      ? 1.0 /\r\n        (getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitudeMana +\r\n          1.0)\r\n      : 1.0,\r\n);\r\n\r\nexport default enchantTransmutation;\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { GuardTemporaryEffect } from \"../../temporaryeffects/Guard\";\r\nimport { grantTemporaryEffect } from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass Guard extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"guard\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Guard\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 800;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 1.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n      duration: {\r\n        value: 30.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      GuardTemporaryEffect.getId(),\r\n      effects.duration,\r\n      {\r\n        params: { multiplier: 1.0 / (effects.magnitude + 1.0) },\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Raise a magical guard to mitigate a single attack.\");\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 30.0;\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"Next attack received deals ^{{amount}}^<{{amountExplanation}}> damage; effect lasts for at most ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        amount: formatMultiplier(1.0 / (1 + effects.magnitude)),\r\n        amountExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 12 };\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst guard = new Guard();\r\n\r\nexport { guard as Guard };\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { stunned, stunProtection } from \"../../temporaryeffects/Stunning\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass Knockout extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"knockout\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Knockout\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 2500;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Apply a single, solid impact to the enemy. As they say, if everything else fails...\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      duration: {\r\n        value: 1,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      'Inflicts \"Stunned!\" for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state, \"duration\");\r\n    state = grantTemporaryEffect(stunned.getId(), effects.duration, {\r\n      target: AttackTarget.Enemy,\r\n    })(state);\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 120;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 28,\r\n    };\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    return (\r\n      super.isCastingRecommended(state) &&\r\n      !hasTemporaryEffect(state, stunProtection.getId(), AttackTarget.Enemy)\r\n    );\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default new Knockout();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { getLastQueuedActionResult } from \"../../exploration/ExplorationUtils\";\r\nimport { grounded } from \"../../temporaryeffects/Grounded\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Landslide extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"landslide\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Landslide\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 1300;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Bury an enemy with unstable ground, dealing damage and trapping them.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 180,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 0,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n      duration: {\r\n        value: 10,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    const standardEffect = getStandardAttackEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n      explanations.average,\r\n    );\r\n    const effectExplanation =\r\n      grounded.getParameterlessDisplayDescription(state);\r\n    return t(\r\n      '{{standardEffect}}; on hit, inflicts ^\"Grounded\"^<{{effectExplanation}}> for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        standardEffect,\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n        effectExplanation,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state, \"duration\");\r\n    state = getStandardSpellAttackEffect(state, this);\r\n    if (getLastQueuedActionResult(state).isHit) {\r\n      state = grantTemporaryEffect(grounded.getId(), effects.duration, {\r\n        target: AttackTarget.Enemy,\r\n      })(state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 2.5;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 15;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 19,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, grounded.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default new Landslide();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerStandardEmpowerEffects } from \"../Spells\";\r\nimport {\r\n  getStandardSpellAttackEffect,\r\n  getStandardSpellAttackEffectText,\r\n} from \"../Utils\";\r\n\r\nclass StoneStrike extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"stoneStrike\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Stone Strike\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 210;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Shower your enemy with multiple small rocks, dealing damage.\");\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 60,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 0,\r\n        tags: [TransformationTags.ActionVariance],\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return getStandardSpellAttackEffectText(state, this);\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 2.0;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 10;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Earth: 6,\r\n    };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Earth: 47 };\r\n  }\r\n}\r\n\r\nconst stoneStrike = new StoneStrike();\r\n\r\nregisterStandardEmpowerEffects(stoneStrike, 4, 10);\r\n\r\nexport default stoneStrike as StoneStrike;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { cloakOfFlames } from \"../../temporaryeffects/CloakOfFlames\";\r\nimport { grantTemporaryEffect } from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass CloakOfFlames extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"cloakOfFlames\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Cloak of Flames\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 2000;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 1.0,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        unit: t(\"x\"),\r\n      },\r\n      duration: {\r\n        value: 15.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(cloakOfFlames.getId(), effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Surround yourself with fiery flames that retaliate when you are hurt.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"Reflects back ^{{multiplier}}x^<{{multiplierExplanation}}> of the damage received for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        multiplier: formatNumber(effects.magnitude, { showDecimals: true }),\r\n        multiplierExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 24 };\r\n  }\r\n}\r\n\r\nexport const cloakOfFlamesSpell = new CloakOfFlames();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { essenceCatalyst } from \"../../buildings/catalysts/EssenceCatalyst\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\n\r\nclass EnchantCatalystsTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"enchantCatalysts\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Enchant Essence Catalysts\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitudePct}}% effectivity of Essence Catalysts\", {\r\n      magnitudePct: formatNumber(temporaryEffectData.params.magnitude * 100),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new EnchantCatalystsTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass EnchantCatalysts extends Spell {\r\n  getId(): string {\r\n    return \"enchantCatalysts\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Enchant Essence Catalysts\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 200;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.15,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      duration: {\r\n        value: 20.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Leverage Fire to temporarily power up your Essence Catalysts, to produce essences faster.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{magnitudePct}}%^<{{magnitudeExplanation}}> effectivity of Essence Catalysts for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitudePct: formatNumber(effects.magnitude * 100),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 3 };\r\n  }\r\n}\r\n\r\nconst enchantCatalysts = new EnchantCatalysts();\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.CatalystEffectivity, essenceCatalyst.getId()]],\r\n  temporaryEffect.getId(),\r\n  enchantCatalysts.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantCatalysts.getId())\r\n      ? getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nexport default enchantCatalysts;\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerStandardEmpowerEffects } from \"../Spells\";\r\nimport {\r\n  getStandardSpellAttackEffect,\r\n  getStandardSpellAttackEffectText,\r\n} from \"../Utils\";\r\n\r\nclass Fireball extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"fireball\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Fireball\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 380;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Materialize and fling a blazing hot ball of flames towards the enemy.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 100,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 10,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return getStandardSpellAttackEffectText(state, this);\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 6.0;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 20;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 6,\r\n    };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 43 };\r\n  }\r\n}\r\n\r\nconst fireball = new Fireball();\r\n\r\nregisterStandardEmpowerEffects(fireball, 7, 20);\r\n\r\nexport default fireball;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { addGameStateListener } from \"../../GameStateListeners\";\r\nimport { Resource, getResourceAmount, grantResource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport {\r\n  CombatStat,\r\n  clearCombatStatCache,\r\n} from \"../../exploration/CombatStats\";\r\nimport { CombatActionResultListeners } from \"../../exploration/ExplorationActionResult\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass ImbueFlamesTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"imbueFlames\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Imbue Flames\");\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./strength.png\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\r\n      \"If :fireessence: is {{essenceAmount}} or more, +{{amount}}:attack:; -{{essenceAmount}}:fireessence: on attack\",\r\n      {\r\n        amount: formatNumber(temporaryEffectData.params.effectAmount),\r\n        essenceAmount: formatNumber(temporaryEffectData.params.essenceAmount),\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport const imbueFlamesTemporaryEffect = new ImbueFlamesTemporaryEffect();\r\nTemporaryEffects.register(imbueFlamesTemporaryEffect);\r\n\r\nconst calculateEffect = (state) => {\r\n  if (\r\n    !hasTemporaryEffect(\r\n      state,\r\n      imbueFlamesTemporaryEffect.getId(),\r\n      AttackTarget.Player,\r\n    )\r\n  ) {\r\n    return 0;\r\n  }\r\n  const data = getTemporaryEffectData(\r\n    state,\r\n    imbueFlamesTemporaryEffect.getId(),\r\n    AttackTarget.Player,\r\n  );\r\n  const essenceAmount = getResourceAmount(state, Resource.FireEssence);\r\n  if (essenceAmount < data.params.essenceAmount) {\r\n    return 0;\r\n  }\r\n  return data.params.effectAmount;\r\n};\r\n\r\nregisterTransformation(\r\n  [[AttackTarget.Player, CombatStat.Attack]],\r\n  imbueFlamesTemporaryEffect.getId(),\r\n  imbueFlamesTemporaryEffect.getDisplayName(),\r\n  TransformationType.Addition,\r\n  calculateEffect,\r\n);\r\n\r\naddGameStateListener(\r\n  imbueFlamesTemporaryEffect.getId() + \"cacheClearer\",\r\n  (state) => (state) =>\r\n    clearCombatStatCache(state, AttackTarget.Player, CombatStat.Attack),\r\n  calculateEffect,\r\n);\r\n\r\nCombatActionResultListeners.register((state, result) => {\r\n  if (\r\n    !hasTemporaryEffect(\r\n      state,\r\n      imbueFlamesTemporaryEffect.getId(),\r\n      AttackTarget.Player,\r\n    ) ||\r\n    result.source != AttackTarget.Player ||\r\n    !result.tags.includes(TransformationTags.AutoAttack)\r\n  ) {\r\n    return state;\r\n  }\r\n  const data = getTemporaryEffectData(\r\n    state,\r\n    imbueFlamesTemporaryEffect.getId(),\r\n    AttackTarget.Player,\r\n  );\r\n  const essenceAmount = getResourceAmount(state, Resource.FireEssence);\r\n  if (essenceAmount < data.params.essenceAmount) {\r\n    return state;\r\n  }\r\n  state = grantResource(\r\n    Resource.FireEssence,\r\n    -data.params.essenceAmount,\r\n  )(state);\r\n  return state;\r\n});\r\n\r\nclass ImbueFlames extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"imbueFlames\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Imbue Flames\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 2000;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 25,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      cost: {\r\n        value: 1000,\r\n        tags: [TransformationTags.TemporaryEffectExtraCost],\r\n        unit: \":fireessence:\",\r\n      },\r\n      duration: {\r\n        value: 30.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\r\n      imbueFlamesTemporaryEffect.getId(),\r\n      effects.duration,\r\n      {\r\n        params: {\r\n          effectAmount: effects.magnitude,\r\n          essenceAmount: effects.cost,\r\n        },\r\n      },\r\n    )(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Power up your weapon by consuming :fireessence:.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"If :fireessence: is ^{{essenceAmount}}^<{{essenceAmountExplanation}}> or more, ^+{{amount}}^<{{amountExplanation}}>:attack:; ^-{{essenceAmount}}^<{{essenceAmountExplanation}}>:fireessence: on attack; effects last ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        essenceAmount: formatNumber(effects.cost),\r\n        essenceAmountExplanation: explanations.cost,\r\n        amount: formatNumber(effects.magnitude),\r\n        amountExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 22 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 58 };\r\n  }\r\n}\r\n\r\nconst imbueFlames = new ImbueFlames();\r\n\r\nregisterEmpowerEffects(\r\n  imbueFlames,\r\n  [TransformationTags.Cost, Resource.Mana],\r\n  10,\r\n);\r\nregisterEmpowerEffects(\r\n  imbueFlames,\r\n  [TransformationTags.TemporaryEffectExtraCost],\r\n  1000,\r\n);\r\nregisterEmpowerEffects(\r\n  imbueFlames,\r\n  [TransformationTags.TemporaryEffectMagnitude],\r\n  8,\r\n);\r\n\r\nexport { imbueFlames };\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerStandardEmpowerEffects } from \"../Spells\";\r\nimport {\r\n  getStandardSpellAttackEffect,\r\n  getStandardSpellAttackEffectText,\r\n} from \"../Utils\";\r\n\r\nclass InfernalBlaze extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"infernalBlaze\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Infernal Blaze\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 3600;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Cover the enemy with very powerful flames. Strong.\");\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 550,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 50,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return getStandardSpellAttackEffectText(state, this);\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    return getStandardSpellAttackEffect(state, this);\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 8.0;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 25,\r\n    };\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Fire: 61 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n}\r\n\r\nconst infernalBlaze = new InfernalBlaze();\r\n\r\nregisterStandardEmpowerEffects(infernalBlaze, 4, 5);\r\n\r\nexport default infernalBlaze;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { getLastQueuedActionResult } from \"../../exploration/ExplorationUtils\";\r\nimport { Seared } from \"../../temporaryeffects/Seared\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Sear extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"sear\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Sear\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 1050;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Burn the enemy for a prolonged period of time, lowering their defenses.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 170,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 15,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n      duration: {\r\n        value: 8,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    const damageText = getStandardAttackEffectText(\r\n      effects.average,\r\n      effects.variance,\r\n      explanations.average,\r\n    );\r\n    const effectExplanation = Seared.getParameterlessDisplayDescription(state);\r\n    return t(\r\n      '{{damageText}}; On hit, inflicts ^\"Seared\"^<{{effectExplanation}}> for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        damageText,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n        effectExplanation,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state, \"duration\");\r\n    state = getStandardSpellAttackEffect(state, this);\r\n    if (getLastQueuedActionResult(state).isHit) {\r\n      state = grantTemporaryEffect(Seared.getId(), effects.duration, {\r\n        target: AttackTarget.Enemy,\r\n      })(state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 7.0;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 30;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Fire: 13,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, Seared.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default new Sear();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { poison } from \"../../temporaryeffects/Poison\";\r\nimport {\r\n  clearTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass Antidote extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"antidote\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Antidote\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.HEALING;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 500;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 5.0;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Cleanse any and all poisons from your system.\");\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    return t('Removes \"Poison\"');\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    if (hasTemporaryEffect(state, poison.getId(), AttackTarget.Player)) {\r\n      state = clearTemporaryEffect(poison.getId(), AttackTarget.Player)(state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 7,\r\n    };\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, poison.getId(), AttackTarget.Player);\r\n  }\r\n}\r\n\r\nexport default new Antidote();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport {\r\n  buildMonstiumCatalyst,\r\n  monstiumCatalyst,\r\n} from \"../../buildings/catalysts/MonstiumCatalyst\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport { registerBuffEmpowerEffects } from \"../Spells\";\r\n\r\nclass EnchantMonstiumCatalystsTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"enchantMonstiumCatalysts\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Enchant Monstium Catalysts\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitudePct}}% effectivity of Monstium Catalysts\", {\r\n      magnitudePct: formatNumber(temporaryEffectData.params.magnitude * 100),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new EnchantMonstiumCatalystsTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass EnchantMonstiumCatalysts extends Spell {\r\n  getId(): string {\r\n    return \"enchantMonstiumCatalysts\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Enchant Monstium Catalysts\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 1500;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.2,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      duration: {\r\n        value: 15.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return buildMonstiumCatalyst.isVisible(state) && super.isVisible(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Leverage Poison to temporarily power up your Monstium Catalysts, when you need more Monstium.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{magnitudePct}}%^<{{magnitudeExplanation}}> effectivity of Monstium Catalysts for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitudePct: formatNumber(effects.magnitude * 100),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Poison: 18 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Poison: 60 };\r\n  }\r\n}\r\n\r\nexport const enchantMonstiumCatalysts = new EnchantMonstiumCatalysts();\r\n\r\nregisterBuffEmpowerEffects(enchantMonstiumCatalysts, 1.5, 10);\r\n\r\nregisterTransformation(\r\n  [[TransformationTags.CatalystEffectivity, monstiumCatalyst.getId()]],\r\n  temporaryEffect.getId(),\r\n  enchantMonstiumCatalysts.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantMonstiumCatalysts.getId())\r\n      ? getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude + 1.0\r\n      : 1.0,\r\n);\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport {\r\n  buildSewageSystem,\r\n  sewageSystem,\r\n} from \"../../buildings/production/SewageSystem\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { clearCalculatedIncomeCache } from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport { registerBuffEmpowerEffects } from \"../Spells\";\r\n\r\nclass EnchantSewageSystemTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"enchantSewageSystem\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Enchant Sewage System\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitudePct}}% production and consumption of Sewage System\", {\r\n      magnitudePct: formatNumber(temporaryEffectData.params.magnitude * 100),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new EnchantSewageSystemTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass EnchantSewageSystem extends Spell {\r\n  getId(): string {\r\n    return \"enchantSewageSystem\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Enchant Sewage System\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 900;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.5,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      duration: {\r\n        value: 20.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return buildSewageSystem.isVisible(state) && super.isVisible(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Enchant your Sewage System to produce and consume more essences at a time.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{magnitudePct}}%^<{{magnitudeExplanation}}> production and consumption of Sewage System for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitudePct: formatNumber(effects.magnitude * 100),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Poison: 22 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Poison: 55 };\r\n  }\r\n}\r\n\r\nexport const enchantSewageSystem = new EnchantSewageSystem();\r\n\r\nregisterBuffEmpowerEffects(enchantSewageSystem, 10, 10);\r\n\r\nregisterTransformation(\r\n  [\r\n    [TransformationTags.Production, sewageSystem.getId()],\r\n    [TransformationTags.Consumption, sewageSystem.getId()],\r\n  ],\r\n  temporaryEffect.getId(),\r\n  enchantSewageSystem.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantSewageSystem.getId())\r\n      ? getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nregisterTemporaryEffectListener(\r\n  temporaryEffect.getId(),\r\n  (state, effect) => {\r\n    if (effect.id == temporaryEffect.getId()) {\r\n      state = clearCalculatedIncomeCache(state);\r\n    }\r\n    return effect;\r\n  },\r\n  true,\r\n);\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { frail } from \"../../temporaryeffects/Frail\";\r\nimport { poison } from \"../../temporaryeffects/Poison\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass FrailSpell extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"frail\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Frail\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 4000;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Make the enemy frail, slightly reducing its defense and making it particularly weak to Poison.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      duration: {\r\n        value: 12,\r\n        tags: [TransformationTags.TemporaryEffectDuration, poison.getId()],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    const effectExplanation = frail.getParameterlessDisplayDescription(state);\r\n    return t(\r\n      'Inflicts ^\"Frail\"^<{{effectExplanation}}> for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n        effectExplanation,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    state = grantTemporaryEffect(frail.getId(), effects.duration, {\r\n      target: AttackTarget.Enemy,\r\n    })(state);\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 8.0;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 27,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, frail.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    return !hasTemporaryEffect(state, frail.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n}\r\n\r\nexport const frailSpell = new FrailSpell();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { poison } from \"../../temporaryeffects/Poison\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerBuffEmpowerEffects, registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass Intoxicate extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"intoxicate\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Intoxicate\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 2500;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Apply a potent poison to the enemy that cannot be dodged.\");\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 35,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude, poison.getId()],\r\n        unit: \":hp:/sec\",\r\n      },\r\n      duration: {\r\n        value: 12,\r\n        tags: [TransformationTags.TemporaryEffectDuration, poison.getId()],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      'Inflicts ^-{{magnitude}}^<{{magnitudeExplanation}}>:hp:/sec \"Poison\" for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        magnitude: formatNumber(effects.magnitude, { showDecimals: true }),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    state = grantTemporaryEffect(poison.getId(), effects.duration, {\r\n      target: AttackTarget.Enemy,\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 7.0;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 20,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, poison.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    return !hasTemporaryEffect(state, poison.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Poison: 53 };\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst intoxicate = new Intoxicate();\r\n\r\nregisterBuffEmpowerEffects(intoxicate, 3, 5);\r\nregisterEmpowerEffects(\r\n  intoxicate,\r\n  [TransformationTags.TemporaryEffectDuration],\r\n  1.5,\r\n);\r\n\r\nexport { intoxicate };\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { getLastQueuedActionResult } from \"../../exploration/ExplorationUtils\";\r\nimport { poison } from \"../../temporaryeffects/Poison\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Sting extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"sting\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Sting\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 260;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Materialize a small poisonous projectile and hit the enemy with it.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 22,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 2,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n      magnitude: {\r\n        value: 12,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude, poison.getId()],\r\n        unit: \":hp:/sec\",\r\n      },\r\n      duration: {\r\n        value: 5,\r\n        tags: [TransformationTags.TemporaryEffectDuration, poison.getId()],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      '{{standardAttack}}; On hit, inflicts ^-{{magnitude}}^<{{magnitudeExplanation}}>:hp:/sec \"Poison\" for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        standardAttack: getStandardAttackEffectText(\r\n          effects.average,\r\n          effects.variance,\r\n          explanations.average,\r\n        ),\r\n        magnitude: formatNumber(effects.magnitude, { showDecimals: true }),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    state = getStandardSpellAttackEffect(state, this);\r\n    if (getLastQueuedActionResult(state).isHit) {\r\n      state = grantTemporaryEffect(poison.getId(), effects.duration, {\r\n        target: AttackTarget.Enemy,\r\n        params: { magnitude: effects.magnitude },\r\n      })(state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 6.0;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 15;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Poison: 6,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, poison.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const sting = new Sting();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { calculatePlayerMaxHP } from \"../../exploration/CombatStats\";\r\nimport {\r\n  getCurrentPlayerHP,\r\n  modifyPlayerCurrentHP,\r\n} from \"../../exploration/Exploration\";\r\nimport { pushCombatActionResult } from \"../../exploration/ExplorationActionResult\";\r\nimport { isHealingPossible } from \"../../temporaryeffects/CommonTemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { getStandardRangeEffectText } from \"../Utils\";\r\n\r\nclass DropletOfHealing extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"dropletOfHealing\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Droplet of Healing\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.HEALING;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 900;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 10.0;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Conjure a small droplet of curative water. Slightly heals wounds.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 25,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":hp:\",\r\n      },\r\n      variance: {\r\n        value: 3,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":hp:\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanation = this.getActionEffectExplanations(state, \"average\");\r\n    return t(\"+{{effect}}:hp:\", {\r\n      effect: getStandardRangeEffectText(\r\n        effects.average,\r\n        effects.variance,\r\n        explanation.average,\r\n      ),\r\n    });\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    const healAmt =\r\n      effects.average + (Math.random() - 0.5) * effects.variance * 2;\r\n    state = modifyPlayerCurrentHP(state, healAmt, this.getSpellName());\r\n    const actionResult = {\r\n      id: Math.random().toString(),\r\n      damage: -healAmt,\r\n      isCrit: false,\r\n      isHit: true,\r\n      time: getSecondsPlayed(state),\r\n      source: AttackTarget.Player,\r\n      target: AttackTarget.Player,\r\n      tags: this.getTags(),\r\n    };\r\n    state = pushCombatActionResult(state, actionResult);\r\n    return state;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 8,\r\n    };\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 40;\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    return (\r\n      getCurrentPlayerHP(state) < calculatePlayerMaxHP(state) * 0.99 &&\r\n      isHealingPossible(state, AttackTarget.Player)\r\n    );\r\n  }\r\n}\r\n\r\nexport default new DropletOfHealing();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { ManaSpout } from \"../../buildings/mana/ManaSpout\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { clearCalculatedIncomeCache } from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport { registerBuffEmpowerEffects } from \"../Spells\";\r\n\r\nclass EnchantManaSpoutsTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"enchantManaSpouts\";\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./boostMana.png\");\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Enchant Mana Spouts\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitudePct}}% effectivity of Mana Spouts\", {\r\n      magnitudePct: formatNumber(temporaryEffectData.params.magnitude * 100),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new EnchantManaSpoutsTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass EnchantManaSpouts extends Spell {\r\n  getId(): string {\r\n    return \"enchantManaSpouts\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Enchant Mana Spouts\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 60;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.6,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      duration: {\r\n        value: 30.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(\"enchantManaSpouts\", effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Use your Water expertise to temporarily power up your Mana Spouts.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{magnitudePct}}%^<{{magnitudeExplanation}}> effectivity of Mana Spouts for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitudePct: formatNumber(effects.magnitude * 100),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 2 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 51 };\r\n  }\r\n}\r\n\r\nconst enchantManaSpouts = new EnchantManaSpouts();\r\n\r\nregisterBuffEmpowerEffects(enchantManaSpouts, 1.5, 50);\r\n\r\nregisterTransformation(\r\n  [[ManaSpout.getId(), TransformationTags.Production]],\r\n  \"enchantManaSpouts\",\r\n  enchantManaSpouts.getSpellName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantManaSpouts.getId())\r\n      ? getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nregisterTemporaryEffectListener(\r\n  temporaryEffect.getId(),\r\n  (state, effect) => {\r\n    if (effect.id == temporaryEffect.getId()) {\r\n      state = clearCalculatedIncomeCache(state);\r\n    }\r\n    return effect;\r\n  },\r\n  true,\r\n);\r\n\r\nexport default enchantManaSpouts;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport {\r\n  buildManaSteamer,\r\n  manaSteamer,\r\n} from \"../../buildings/mana/ManaSteamer\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  getTemporaryEffectData,\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n  registerTemporaryEffectListener,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { clearCalculatedIncomeCache } from \"../../timetick/IncomeOverTime\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { Spell } from \"../Spell\";\r\nimport { registerBuffEmpowerEffects } from \"../Spells\";\r\n\r\nclass EnchantManaSteamersTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"enchantManaSteamers\";\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./boostMana.png\");\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Enchant Mana Steamers\");\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    return t(\"+{{magnitudePct}}% production and consumption of Mana Steamers\", {\r\n      magnitudePct: formatNumber(temporaryEffectData.params.magnitude * 100),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new EnchantManaSteamersTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass EnchantManaSteamers extends Spell {\r\n  getId(): string {\r\n    return \"enchantManaSteamers\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Enchant Mana Steamers\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.GENERAL_BUFF;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return buildManaSteamer.isVisible(state) && super.isVisible(state);\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 220;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.6,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      duration: {\r\n        value: 20.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { magnitude: effects.magnitude },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Power up your Mana Steamers so that they work faster for a limited time.\",\r\n    );\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{magnitudePct}}%^<{{magnitudeExplanation}}> production and consumption of Mana Steamers for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        magnitudePct: formatNumber(effects.magnitude * 100),\r\n        magnitudeExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 15 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 61 };\r\n  }\r\n}\r\n\r\nconst enchantManaSteamers = new EnchantManaSteamers();\r\n\r\nregisterBuffEmpowerEffects(enchantManaSteamers, 1.5, 30);\r\n\r\nregisterTransformation(\r\n  [\r\n    [manaSteamer.getId(), TransformationTags.Production],\r\n    [manaSteamer.getId(), TransformationTags.Consumption],\r\n  ],\r\n  temporaryEffect.getId(),\r\n  temporaryEffect.getDisplayName(),\r\n  TransformationType.Multiplier,\r\n  (state) =>\r\n    hasTemporaryEffect(state, enchantManaSteamers.getId())\r\n      ? getTemporaryEffectData(state, temporaryEffect.getId()).params\r\n          .magnitude + 1.0\r\n      : 1.0,\r\n);\r\n\r\nregisterTemporaryEffectListener(\r\n  temporaryEffect.getId(),\r\n  (state, effect) => {\r\n    if (effect.id == temporaryEffect.getId()) {\r\n      state = clearCalculatedIncomeCache(state);\r\n    }\r\n    return effect;\r\n  },\r\n  true,\r\n);\r\n\r\nexport default enchantManaSteamers;\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { getLastQueuedActionResult } from \"../../exploration/ExplorationUtils\";\r\nimport { Chilled } from \"../../temporaryeffects/Chilled\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Frost extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"frost\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Frost\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 650;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 24;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Batter the enemy with a sub-zero breeze that can chill their bones.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 110,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 5,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n      duration: {\r\n        value: 10,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    const effectExplanation = Chilled.getParameterlessDisplayDescription(state);\r\n    return t(\r\n      '{{standardAttack}}; On hit, inflicts ^\"Chilled\"^<{{effectExplanation}}> for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        standardAttack: getStandardAttackEffectText(\r\n          effects.average,\r\n          effects.variance,\r\n          explanations.average,\r\n        ),\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n        effectExplanation,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state, \"duration\");\r\n    state = getStandardSpellAttackEffect(state, this);\r\n    if (getLastQueuedActionResult(state).isHit) {\r\n      state = grantTemporaryEffect(Chilled.getId(), effects.duration, {\r\n        target: AttackTarget.Enemy,\r\n      })(state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 3.0;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 16,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, Chilled.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default new Frost();\r\n","import { formatMultiplier, formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { Resource } from \"../../Resources\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { CombatStat } from \"../../exploration/CombatStats\";\r\nimport { TemporaryEffect } from \"../../temporaryeffects/TemporaryEffect\";\r\nimport {\r\n  TemporaryEffectData,\r\n  TemporaryEffects,\r\n  grantTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { TransformationType } from \"../../transformation/Transformation\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerEmpowerEffects } from \"../Spells\";\r\n\r\nclass LongevityTemporaryEffect extends TemporaryEffect {\r\n  getId() {\r\n    return \"longevity\";\r\n  }\r\n\r\n  getDisplayName(): string {\r\n    return t(\"Longevity\");\r\n  }\r\n\r\n  getIcon() {\r\n    return require(\"./longevity.png\");\r\n  }\r\n\r\n  isCommonBuffEnabled(): { stat: CombatStat; type: TransformationType }[] {\r\n    return [\r\n      { stat: CombatStat.MaxHP, type: TransformationType.Addition },\r\n      { stat: CombatStat.MaxHP, type: TransformationType.Multiplier },\r\n    ];\r\n  }\r\n\r\n  getDisplayDescription(\r\n    state: GameState,\r\n    temporaryEffectData: TemporaryEffectData,\r\n  ): string {\r\n    const maxHP = temporaryEffectData.params.commonBuff.MaxHP;\r\n    if (!maxHP) {\r\n      const maxHPRatio = temporaryEffectData.params.commonBuff.MaxHPMultiplier;\r\n      return t(\"{{ratio}} Max:hp:\", {\r\n        ratio: formatMultiplier(maxHPRatio),\r\n      });\r\n    }\r\n    return t(\"+{{amount}} Max:hp:\", {\r\n      amount: formatNumber(maxHP),\r\n    });\r\n  }\r\n}\r\n\r\nconst temporaryEffect = new LongevityTemporaryEffect();\r\nTemporaryEffects.register(temporaryEffect);\r\n\r\nclass Longevity extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"longevity\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Longevity\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.COMBAT_BUFF;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 450;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 60,\r\n        tags: [TransformationTags.TemporaryEffectMagnitude],\r\n        unit: \" Max:hp:\",\r\n      },\r\n      duration: {\r\n        value: 70.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(temporaryEffect.getId(), effects.duration, {\r\n      params: { commonBuff: { MaxHP: effects.magnitude } },\r\n    })(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Bolster the ability of your body to stay alive.\");\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    return t(\r\n      \"^+{{amount}}^<{{amountExplanation}}> Max:hp: for ^{{duration}}^<{{durationExplanation}}> sec\",\r\n      {\r\n        amount: formatNumber(effects.magnitude),\r\n        amountExplanation: explanations.magnitude,\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n      },\r\n    );\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 7 };\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 54 };\r\n  }\r\n}\r\n\r\nconst longevity = new Longevity();\r\n\r\nregisterEmpowerEffects(longevity, [TransformationTags.Cost, Resource.Mana], 30);\r\nregisterEmpowerEffects(\r\n  longevity,\r\n  [TransformationTags.TemporaryEffectMagnitude],\r\n  4,\r\n);\r\n\r\nexport { longevity as Longevity, temporaryEffect as LongevityTemporaryEffect };\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect, DoActionArgs } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../temporaryeffects/Wet\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\n\r\nclass Soak extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"soak\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Soak\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.OTHER;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 300;\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      duration: {\r\n        value: 30.0,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  doSpellAction(state: GameState, args: DoActionArgs): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    return grantTemporaryEffect(Wet.getId(), effects.duration, {})(state);\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\"Make yourself wet! If you're facing a fiery blaze...\");\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 6.0;\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    const effectExplanation = Wet.getParameterlessDisplayDescription(state);\r\n    return t(\r\n      'Inflicts ^\"Wet\"^<{{effectExplanation}}> on yourself for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        duration: formatNumber(effects.duration),\r\n        durationExplanation: explanations.duration,\r\n        effectExplanation,\r\n      },\r\n    );\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, Wet.getId(), AttackTarget.Player);\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 25 };\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule?: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const soak = new Soak();\r\n","import { formatNumber } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { AutocastRule, SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { getLastQueuedActionResult } from \"../../exploration/ExplorationUtils\";\r\nimport {\r\n  grantTemporaryEffect,\r\n  hasTemporaryEffect,\r\n} from \"../../temporaryeffects/TemporaryEffects\";\r\nimport { Wet } from \"../../temporaryeffects/Wet\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport {\r\n  getStandardAttackEffectText,\r\n  getStandardSpellAttackEffect,\r\n} from \"../Utils\";\r\n\r\nclass Splash extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"splash\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Splash\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.ATTACK;\r\n  }\r\n\r\n  getExtraTags(): string[] {\r\n    return [TransformationTags.AttackSpell];\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 160;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Spray the enemy with a small burst of water. Leaves the enemy Wet.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 42,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":attack:\",\r\n      },\r\n      variance: {\r\n        value: 2,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":attack:\",\r\n      },\r\n      duration: {\r\n        value: 10,\r\n        tags: [TransformationTags.TemporaryEffectDuration],\r\n        unit: t(\" sec\"),\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanations = this.getActionEffectExplanations(state);\r\n    const effectExplanation = Wet.getParameterlessDisplayDescription(state);\r\n    return t(\r\n      '{{standardAttack}}; On hit, inflicts ^\"Wet\"^<{{effectExplanation}}> for ^{{duration}}^<{{durationExplanation}}> sec',\r\n      {\r\n        standardAttack: getStandardAttackEffectText(\r\n          effects.average,\r\n          effects.variance,\r\n          explanations.average,\r\n        ),\r\n        duration: formatNumber(effects.duration, { showDecimals: true }),\r\n        durationExplanation: explanations.duration,\r\n        effectExplanation,\r\n      },\r\n    );\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state, \"duration\");\r\n    state = getStandardSpellAttackEffect(state, this);\r\n    if (getLastQueuedActionResult(state).isHit) {\r\n      state = grantTemporaryEffect(Wet.getId(), effects.duration, {\r\n        target: AttackTarget.Enemy,\r\n      })(state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 2.0;\r\n  }\r\n\r\n  getBaseAutocastPointsRequirement(): number {\r\n    return 15;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 6,\r\n    };\r\n  }\r\n\r\n  isActive(state: GameState): boolean {\r\n    return hasTemporaryEffect(state, Wet.getId(), AttackTarget.Enemy);\r\n  }\r\n\r\n  getEstimatedMinAutocastDelay(state: GameState, rule: AutocastRule): number {\r\n    return this.getCooldown(state);\r\n  }\r\n\r\n  allowRegisteringTemporaryEffectsAsPermacast(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default new Splash();\r\n","import { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { SpellAutocastCategory } from \"../../autocast/Autocast\";\r\nimport { AttackTarget } from \"../../exploration/AttackTarget\";\r\nimport { calculatePlayerMaxHP } from \"../../exploration/CombatStats\";\r\nimport {\r\n  getCurrentPlayerHP,\r\n  modifyPlayerCurrentHP,\r\n} from \"../../exploration/Exploration\";\r\nimport { pushCombatActionResult } from \"../../exploration/ExplorationActionResult\";\r\nimport { isHealingPossible } from \"../../temporaryeffects/CommonTemporaryEffects\";\r\nimport { getSecondsPlayed } from \"../../timetick/TotalTimePlayed\";\r\nimport { TransformationTags } from \"../../transformation/TransformationTags\";\r\nimport { CombatSpellBase } from \"../CombatSpellBase\";\r\nimport { SpellElement } from \"../Elements\";\r\nimport { registerStandardEmpowerEffects } from \"../Spells\";\r\nimport { getStandardRangeEffectText } from \"../Utils\";\r\n\r\nclass StreamOfHealing extends CombatSpellBase {\r\n  getId(): string {\r\n    return \"streamOfHealing\";\r\n  }\r\n\r\n  getSpellName(): string {\r\n    return t(\"Stream of Healing\");\r\n  }\r\n\r\n  getElement(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  getAutocastCategory(): SpellAutocastCategory {\r\n    return SpellAutocastCategory.HEALING;\r\n  }\r\n\r\n  getBaseManaCost(state: GameState): number {\r\n    return 2600;\r\n  }\r\n\r\n  getBaseCooldown(): number {\r\n    return 15.0;\r\n  }\r\n\r\n  getDisplayDescription(state: GameState): string {\r\n    return t(\r\n      \"Conjure a stream of curative water running through your body. Significantly heals wounds.\",\r\n    );\r\n  }\r\n\r\n  protected getBaseActionEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      average: {\r\n        value: 80,\r\n        tags: [TransformationTags.ActionMagnitude],\r\n        unit: \":hp:\",\r\n      },\r\n      variance: {\r\n        value: 5,\r\n        tags: [TransformationTags.ActionVariance],\r\n        unit: \":hp:\",\r\n      },\r\n    };\r\n  }\r\n\r\n  getDisplayEffect(state: GameState): string {\r\n    const effects = this.getActionEffects(state);\r\n    const explanation = this.getActionEffectExplanations(state, \"average\");\r\n    return t(\"+{{effect}}:hp:\", {\r\n      effect: getStandardRangeEffectText(\r\n        effects.average,\r\n        effects.variance,\r\n        explanation.average,\r\n      ),\r\n    });\r\n  }\r\n\r\n  doSpellAction(state: GameState): GameState {\r\n    const effects = this.getActionEffects(state);\r\n    const healAmt =\r\n      effects.average + (Math.random() - 0.5) * effects.variance * 2;\r\n    state = modifyPlayerCurrentHP(state, healAmt, this.getSpellName());\r\n    const actionResult = {\r\n      id: Math.random().toString(),\r\n      damage: -healAmt,\r\n      isCrit: false,\r\n      isHit: true,\r\n      time: getSecondsPlayed(state),\r\n      source: AttackTarget.Player,\r\n      target: AttackTarget.Player,\r\n      tags: this.getTags(),\r\n    };\r\n    state = pushCombatActionResult(state, actionResult);\r\n    return state;\r\n  }\r\n\r\n  canUseOutsideOfCombat(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return {\r\n      Water: 21,\r\n    };\r\n  }\r\n\r\n  isCastingRecommended(state: GameState): boolean {\r\n    return (\r\n      getCurrentPlayerHP(state) < calculatePlayerMaxHP(state) * 0.99 &&\r\n      isHealingPossible(state, AttackTarget.Player)\r\n    );\r\n  }\r\n\r\n  protected isEmpowerable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  getEmpoweringLevelRequirements(): Partial<Record<SpellElement, number>> {\r\n    return { Water: 58 };\r\n  }\r\n}\r\n\r\nconst streamOfHealing = new StreamOfHealing();\r\n\r\nregisterStandardEmpowerEffects(streamOfHealing, 3, 8);\r\n\r\nexport default streamOfHealing as StreamOfHealing;\r\n","import AirBlast from \"./air/AirBlast\";\r\nimport { blur } from \"./air/Blur\";\r\nimport EnchantSaleStalls from \"./air/EnchantSaleStalls\";\r\nimport { Haste } from \"./air/Haste\";\r\nimport { Levitation } from \"./air/Levitation\";\r\nimport richness from \"./air/Richness\";\r\nimport Twister from \"./air/Twister\";\r\nimport ChannelAir from \"./channeling/ChannelAir\";\r\nimport ChannelEarth from \"./channeling/ChannelEarth\";\r\nimport ChannelFire from \"./channeling/ChannelFire\";\r\nimport ChannelFour from \"./channeling/ChannelFour\";\r\nimport ChannelPoison from \"./channeling/ChannelPoison\";\r\nimport ChannelWater from \"./channeling/ChannelWater\";\r\nimport { earthShield } from \"./earth/EarthShield\";\r\nimport EnchantTransmutation from \"./earth/EnchantTransmutation\";\r\nimport { Guard } from \"./earth/Guard\";\r\nimport Knockout from \"./earth/Knockout\";\r\nimport Landslide from \"./earth/Landslide\";\r\nimport { Stoneskin } from \"./earth/Stoneskin\";\r\nimport StoneStrike from \"./earth/StoneStrike\";\r\nimport { loadElementsCommonLogic } from \"./ElementsCommonLogic\";\r\nimport { cloakOfFlamesSpell } from \"./fire/CloakOfFlames\";\r\nimport EnchantCatalysts from \"./fire/EnchantCatalysts\";\r\nimport Fireball from \"./fire/Fireball\";\r\nimport { imbueFlames } from \"./fire/ImbueFlames\";\r\nimport InfernalBlaze from \"./fire/InfernalBlaze\";\r\nimport Sear from \"./fire/Sear\";\r\nimport { Strength } from \"./fire/Strength\";\r\nimport Antidote from \"./poison/Antidote\";\r\nimport { enchantMonstiumCatalysts } from \"./poison/EnchantMonstiumCatalysts\";\r\nimport { enchantSewageSystem } from \"./poison/EnchantSewageSystem\";\r\nimport { frailSpell } from \"./poison/Frail\";\r\nimport { intoxicate } from \"./poison/Intoxicate\";\r\nimport { sting } from \"./poison/Sting\";\r\nimport { loadSpellCommonLogic } from \"./SpellCommonLogic\";\r\nimport { registerSpell } from \"./Spells\";\r\nimport DropletOfHealing from \"./water/DropletOfHealing\";\r\nimport EnchantManaSpouts from \"./water/EnchantManaSpouts\";\r\nimport enchantManaSteamers from \"./water/EnchantManaSteamers\";\r\nimport Frost from \"./water/Frost\";\r\nimport { Longevity } from \"./water/Longevity\";\r\nimport { soak } from \"./water/Soak\";\r\nimport Splash from \"./water/Splash\";\r\nimport StreamOfHealing from \"./water/StreamOfHealing\";\r\n\r\nexport function loadSpellsDemo() {\r\n  loadElementsCommonLogic();\r\n  loadSpellCommonLogic();\r\n\r\n  // Fire\r\n  registerSpell(ChannelFire);\r\n  registerSpell(EnchantCatalysts);\r\n  registerSpell(Fireball);\r\n  registerSpell(Strength);\r\n  registerSpell(Sear);\r\n  registerSpell(enchantManaSteamers);\r\n  registerSpell(imbueFlames);\r\n  registerSpell(cloakOfFlamesSpell);\r\n  registerSpell(InfernalBlaze);\r\n\r\n  // Earth\r\n  registerSpell(ChannelEarth);\r\n  registerSpell(EnchantTransmutation);\r\n  registerSpell(Stoneskin);\r\n  registerSpell(StoneStrike);\r\n  registerSpell(Guard);\r\n  registerSpell(Landslide);\r\n  registerSpell(earthShield);\r\n  registerSpell(Knockout);\r\n\r\n  // Water\r\n  registerSpell(ChannelWater);\r\n  registerSpell(EnchantManaSpouts);\r\n  registerSpell(DropletOfHealing);\r\n  registerSpell(Splash);\r\n  registerSpell(Longevity);\r\n  registerSpell(Frost);\r\n  registerSpell(StreamOfHealing);\r\n  registerSpell(soak);\r\n\r\n  // Air\r\n  registerSpell(ChannelAir);\r\n  registerSpell(EnchantSaleStalls);\r\n  registerSpell(AirBlast);\r\n  registerSpell(Haste);\r\n  registerSpell(Levitation);\r\n  registerSpell(blur);\r\n  registerSpell(Twister);\r\n  registerSpell(richness);\r\n\r\n  // Poison\r\n  registerSpell(ChannelPoison);\r\n  registerSpell(sting);\r\n  registerSpell(Antidote);\r\n  registerSpell(enchantMonstiumCatalysts);\r\n  registerSpell(intoxicate);\r\n  registerSpell(enchantSewageSystem);\r\n  registerSpell(frailSpell);\r\n\r\n  // Other\r\n  registerSpell(ChannelFour);\r\n}\r\n","import { LevelUpListeners } from \"../events/progression/LevelUp\";\r\nimport { getElementLevel, getUnlockedElements } from \"./Elements\";\r\n\r\nexport function loadElementsCommonLogic() {\r\n  LevelUpListeners.register((state, element) => {\r\n    const elements = getUnlockedElements(state);\r\n    const newMaxes = state.world.maxElementLevels;\r\n    let update = false;\r\n    elements.forEach((element) => {\r\n      const previousMax = state.world.maxElementLevels?.[element] ?? 0;\r\n      const newLevel = getElementLevel(state, element);\r\n      if (newLevel > previousMax) {\r\n        newMaxes[element] = newLevel;\r\n        update = true;\r\n      }\r\n    });\r\n    if (update) {\r\n      state.world.maxElementLevels = newMaxes;\r\n    }\r\n    return state;\r\n  }, \"maxMaxElementLevels\");\r\n}\r\n","import { ActionArea } from \"../action/ActionAreas\";\r\nimport { LevelUpListeners } from \"../events/progression/LevelUp\";\r\nimport { createHypotheticalState } from \"../GameState\";\r\nimport { getElementExp, grantElementExp } from \"./Elements\";\r\nimport { GameStartupListeners } from \"./GameStartup\";\r\nimport { getVisibleSpellsForElement, Spells, toggleEmpowered } from \"./Spells\";\r\nimport { clearVisibleSpellsCache } from \"./VisibleSpellsCache\";\r\n\r\nexport function loadSpellCommonLogic() {\r\n  LevelUpListeners.register((state, element, oldExp) => {\r\n    let lessExpState = createHypotheticalState(state);\r\n    lessExpState = grantElementExp(\r\n      element,\r\n      -(getElementExp(state, element) - oldExp),\r\n    )(lessExpState);\r\n    const oldSpells = getVisibleSpellsForElement(\r\n      lessExpState,\r\n      element,\r\n      ActionArea.SPELL_MENU,\r\n    );\r\n    const newSpells = getVisibleSpellsForElement(\r\n      state,\r\n      element,\r\n      ActionArea.SPELL_MENU,\r\n    );\r\n    const oldEmpoweredSpells = oldSpells.filter((spell) =>\r\n      spell.isEmpoweringPossible(lessExpState),\r\n    );\r\n    const newEmpoweredSpells = newSpells.filter(\r\n      (spell) =>\r\n        spell.isEmpoweringPossible(state) &&\r\n        !oldEmpoweredSpells.includes(spell),\r\n    );\r\n    for (let spell of newEmpoweredSpells) {\r\n      state = toggleEmpowered(state, spell);\r\n    }\r\n    return state;\r\n  }, \"spellAutoEmpowering\");\r\n  LevelUpListeners.register((state, element, oldExp) => {\r\n    return clearVisibleSpellsCache(state);\r\n  }, \"spellByElementCacheClearer\");\r\n  GameStartupListeners.register((state) => {\r\n    const spells = Spells.getAll();\r\n    for (let spell of spells) {\r\n      if (spell.isEmpoweringPossible(state)) {\r\n        state = toggleEmpowered(state, spell);\r\n      }\r\n    }\r\n    return state;\r\n  }, \"spellAutoEmpoweringOnStartup\");\r\n}\r\n","import memoize from \"sonic-memoize\";\r\nimport { formatNumber } from \"../../utils/FormattingUtils\";\r\nimport { t } from \"../../utils/I18n\";\r\nimport { GameState } from \"../GameState\";\r\nimport { ActionEffect } from \"../action/Action\";\r\nimport { Identifiable } from \"../generic/Identifiable\";\r\nimport { SpellElement, translateElement } from \"../spells/Elements\";\r\nimport {\r\n  applyTransformationsCached,\r\n  explainTransformationsText,\r\n} from \"../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../transformation/TransformationTags\";\r\nimport { getCurrentSynchroBonuses } from \"./Synchro\";\r\n\r\nexport abstract class SynchroBonus implements Identifiable {\r\n  constructor() {}\r\n\r\n  getId(): string {\r\n    return this.getElement1() + \"-\" + this.getElement2();\r\n  }\r\n  abstract getEffect(state: GameState, amount: number): string | undefined;\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {};\r\n  }\r\n\r\n  getCachedBaseBonusEffects = memoize(() => this.getBaseBonusEffects());\r\n\r\n  abstract getElement1(): SpellElement;\r\n  abstract getElement2(): SpellElement;\r\n\r\n  getName(): string {\r\n    return t(\"Synchro Bonus ({{element1}}+{{element2}})\", {\r\n      element1: translateElement(this.getElement1()),\r\n      element2: translateElement(this.getElement2()),\r\n    });\r\n  }\r\n\r\n  getTags(): string[] {\r\n    return [];\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return true;\r\n  }\r\n\r\n  isBeneficial(): boolean {\r\n    return true;\r\n  }\r\n\r\n  tagsByEffect: Record<string, string[]> = {};\r\n  getTagsByEffect(key: string, baseEffect: ActionEffect): string[] {\r\n    if (this.tagsByEffect?.[key] == null) {\r\n      this.tagsByEffect[key] = [\r\n        ...this.getTags(),\r\n        this.getId(),\r\n        ...(baseEffect.tags ?? []),\r\n        TransformationTags.SynchroEffect,\r\n      ];\r\n    }\r\n    return this.tagsByEffect[key];\r\n  }\r\n\r\n  getBonusEffect(state: GameState, effectId: string, amount?: number): number {\r\n    const baseEffects = this.getCachedBaseBonusEffects();\r\n    const baseEffect = baseEffects[effectId];\r\n    switch (baseEffect.valueType) {\r\n      case TransformationValueType.Divisor:\r\n        return Math.pow(\r\n          applyTransformationsCached(\r\n            this.getTagsByEffect(effectId, baseEffect),\r\n            state,\r\n            baseEffect.value,\r\n          ),\r\n          amount ?? 1,\r\n        );\r\n      case TransformationValueType.Percent:\r\n        return Math.pow(\r\n          applyTransformationsCached(\r\n            this.getTagsByEffect(effectId, baseEffect),\r\n            state,\r\n            baseEffect.value,\r\n          ) + 1.0,\r\n          amount ?? 1,\r\n        );\r\n      case TransformationValueType.Basic:\r\n      default:\r\n        return (\r\n          applyTransformationsCached(\r\n            this.getTagsByEffect(effectId, baseEffect),\r\n            state,\r\n            baseEffect.value,\r\n          ) * (amount ?? 1)\r\n        );\r\n    }\r\n  }\r\n\r\n  getBonusEffects(state: GameState, amount?: number): Record<string, number> {\r\n    const baseEffects = this.getCachedBaseBonusEffects();\r\n    const finalEffects: Record<string, number> = {};\r\n    for (let key in baseEffects) {\r\n      const baseEffect = baseEffects[key];\r\n      finalEffects[key] = Math.pow(\r\n        applyTransformationsCached(\r\n          this.getTagsByEffect(key, baseEffect),\r\n          state,\r\n          baseEffect.value,\r\n        ),\r\n        amount ?? 1,\r\n      );\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  getExplanationParamsByEffect = memoize((baseEffect: ActionEffect) => ({\r\n    valueType: baseEffect.valueType,\r\n    unit: baseEffect.unit,\r\n  }));\r\n\r\n  getBonusEffectExplanations(\r\n    state: GameState,\r\n    amount?: number,\r\n    onlyId?: string,\r\n  ): Record<string, string> {\r\n    const baseEffects = this.getCachedBaseBonusEffects();\r\n    const finalEffects: Record<string, string> = {};\r\n    for (let key in baseEffects) {\r\n      if (onlyId != null && key != onlyId) {\r\n        continue;\r\n      }\r\n      const baseEffect = baseEffects[key];\r\n      const transformedEffect = explainTransformationsText(\r\n        this.getTagsByEffect(key, baseEffect),\r\n        state,\r\n        baseEffect.value,\r\n        this.getExplanationParamsByEffect(baseEffect),\r\n      );\r\n      if (transformedEffect != \"\" || amount != 1) {\r\n        finalEffects[key] = t(\r\n          \"Results from stacking {{amount}} time(s) the following: {{transformedEffect}}\",\r\n          {\r\n            amount: formatNumber(amount ?? 1),\r\n            transformedEffect:\r\n              transformedEffect != \"\"\r\n                ? transformedEffect\r\n                : t(\"{{amount}}{{unit}}\", {\r\n                    amount: formatNumber(\r\n                      baseEffect.valueType == TransformationValueType.Percent\r\n                        ? 100.0 * baseEffect.value\r\n                        : baseEffect.value,\r\n                      { showDecimals: true },\r\n                    ),\r\n                    unit:\r\n                      baseEffect.valueType == TransformationValueType.Percent\r\n                        ? t(\"%{{unit}}\", { unit: baseEffect.unit })\r\n                        : baseEffect.unit,\r\n                  }),\r\n          },\r\n        );\r\n      }\r\n    }\r\n    return finalEffects;\r\n  }\r\n\r\n  getCurrentBonusAmount(state: GameState): number {\r\n    return getCurrentSynchroBonuses(\r\n      state,\r\n      this.getElement1(),\r\n      this.getElement2(),\r\n    );\r\n  }\r\n\r\n  getCurrentBonusEffect(state: GameState, effectId: string): number {\r\n    return this.getBonusEffect(\r\n      state,\r\n      effectId,\r\n      this.getCurrentBonusAmount(state),\r\n    );\r\n  }\r\n}\r\n","import { valuesOfCached } from \"../../../utils/CoreUtils\";\r\nimport { formatMultiplier } from \"../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../utils/I18n\";\r\nimport { GameState } from \"../../GameState\";\r\nimport { ActionEffect } from \"../../action/Action\";\r\nimport { getRankDifference } from \"../../spells/ElementMultipliers\";\r\nimport {\r\n  SpellElement,\r\n  getElementLevel,\r\n  translateElement,\r\n} from \"../../spells/Elements\";\r\nimport { Spell } from \"../../spells/Spell\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../transformation/TransformationTags\";\r\nimport { getCurrentSynchroBonuses } from \"../Synchro\";\r\nimport { SynchroBonus } from \"../SynchroBonus\";\r\nimport { SynchroBonuses } from \"../SynchroBonuses\";\r\n\r\nclass DoubleElementSynchroBonus extends SynchroBonus {\r\n  element: SpellElement;\r\n  constructor(element: SpellElement) {\r\n    super();\r\n    this.element = element;\r\n  }\r\n\r\n  getElement1(): SpellElement {\r\n    return this.element;\r\n  }\r\n\r\n  getElement2(): SpellElement {\r\n    return this.element;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.02,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> {{element}} spell power for every {{element}} Rank above the spell's Rank\",\r\n      {\r\n        magnitude: formatMultiplier(magnitude),\r\n        explanation,\r\n        element: translateElement(this.element),\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nfunction loadDoubleElementSynchroBonus(element: SpellElement) {\r\n  const synchroBonus = new DoubleElementSynchroBonus(element);\r\n  SynchroBonuses.register(synchroBonus);\r\n\r\n  registerTransformation(\r\n    [\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.ActionMagnitude,\r\n        element,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.TemporaryEffectMagnitude,\r\n        element,\r\n      ],\r\n    ],\r\n    \"doubleSynchroBonus\" + element,\r\n    t(\"Synchro Bonus ({{element}}+{{element}})\", {\r\n      element: translateElement(element),\r\n    }),\r\n    TransformationType.Multiplier,\r\n    (state, params) => {\r\n      const spell = params.action as Spell;\r\n      const baseLevel = spell.getLevelRequirements()[element];\r\n      if (baseLevel == null) {\r\n        return 1.0;\r\n      }\r\n      const currentLevel = getElementLevel(state, element);\r\n      const rankDifference = getRankDifference(baseLevel, currentLevel);\r\n      if (rankDifference <= 0) {\r\n        return 1.0;\r\n      }\r\n      return Math.pow(\r\n        synchroBonus.getBonusEffect(\r\n          state,\r\n          \"magnitude\",\r\n          getCurrentSynchroBonuses(state, element, element),\r\n        ),\r\n        rankDifference,\r\n      );\r\n    },\r\n  );\r\n\r\n  registerTransformation(\r\n    [[element, TransformationTags.ChannelingEfficiency]],\r\n    \"doubleSynchroBonus\" + element + \"ChannelingMultiplier\",\r\n    t(\"Synchro Bonus ({{element}}+{{element}})\", {\r\n      element: translateElement(element),\r\n    }),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      const currentLevel = getElementLevel(state, element);\r\n      const rankDifference = getRankDifference(1, currentLevel);\r\n      return Math.pow(\r\n        synchroBonus.getBonusEffect(\r\n          state,\r\n          \"magnitude\",\r\n          getCurrentSynchroBonuses(state, element, element),\r\n        ),\r\n        rankDifference,\r\n      );\r\n    },\r\n  );\r\n}\r\n\r\nexport function loadDoubleElementSynchroBonuses() {\r\n  for (let element of valuesOfCached(SpellElement)) {\r\n    loadDoubleElementSynchroBonus(element);\r\n  }\r\n}\r\n","import { SpellElement } from \"../../spells/Elements\";\r\nimport { SynchroBonus } from \"../SynchroBonus\";\r\n\r\nexport abstract class FireSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Fire;\r\n  }\r\n}\r\n\r\nexport abstract class EarthSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n}\r\n\r\nexport abstract class WaterSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n}\r\n\r\nexport abstract class AirSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n}\r\n\r\nexport abstract class PoisonSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n}\r\n\r\nexport abstract class MindSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Mind;\r\n  }\r\n}\r\n\r\nexport abstract class LifeSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Life;\r\n  }\r\n}\r\n\r\nexport abstract class ElectricSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Electric;\r\n  }\r\n}\r\n\r\nexport abstract class DeathSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Death;\r\n  }\r\n}\r\n\r\nexport abstract class HolySynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Holy;\r\n  }\r\n}\r\n\r\nexport abstract class TimeSynchroBonus extends SynchroBonus {\r\n  getElement1(): SpellElement {\r\n    return SpellElement.Time;\r\n  }\r\n}\r\n","import { formatNumber } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  CombatStat,\r\n  clearCombatStatCache,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationValueType } from \"../../../transformation/TransformationTags\";\r\nimport { SynchroChangeListeners } from \"../../Synchro\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { AirSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass AirPoisonSynchroBonus extends AirSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 8,\r\n        valueType: TransformationValueType.Basic,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\"^+{{magnitude}}^<{{explanation}}>:dodge:\", {\r\n      magnitude: formatNumber(magnitude),\r\n      explanation,\r\n    });\r\n  }\r\n}\r\nexport function loadAirPoisonSynchroBonus() {\r\n  const bonus = new AirPoisonSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.Dodge]],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Addition,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n  SynchroChangeListeners.register((state) => {\r\n    state = clearCombatStatCache(state, AttackTarget.Player, CombatStat.Dodge);\r\n    return state;\r\n  }, bonus.getId());\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { EarthSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass EarthAirSynchroBonus extends EarthSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.95,\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\"^{{magnitude}}^<{{explanation}}> Earth and Air spell power\", {\r\n      magnitude: formatMultiplier(magnitude),\r\n      explanation,\r\n    });\r\n  }\r\n}\r\nexport function loadEarthAirSynchroBonus() {\r\n  const bonus = new EarthAirSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.ActionMagnitude,\r\n        SpellElement.Earth,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.TemporaryEffectMagnitude,\r\n        SpellElement.Earth,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.ActionMagnitude,\r\n        SpellElement.Air,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.TemporaryEffectMagnitude,\r\n        SpellElement.Air,\r\n      ],\r\n    ],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { EarthSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass EarthPoisonSynchroBonus extends EarthSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.15,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\"^{{magnitude}}^<{{explanation}}> Channeling efficiency\", {\r\n      magnitude: formatMultiplier(magnitude),\r\n      explanation,\r\n    });\r\n  }\r\n}\r\nexport function loadEarthPoisonSynchroBonus() {\r\n  const bonus = new EarthPoisonSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [[TransformationTags.ChannelingEfficiency]],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  CombatStat,\r\n  clearCombatStatCache,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationValueType } from \"../../../transformation/TransformationTags\";\r\nimport { SynchroChangeListeners } from \"../../Synchro\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { EarthSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass EarthWaterSynchroBonus extends EarthSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.04,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\"^{{magnitude}}^<{{explanation}}> Max:hp:\", {\r\n      magnitude: formatMultiplier(magnitude),\r\n      explanation,\r\n    });\r\n  }\r\n}\r\nexport function loadEarthWaterSynchroBonus() {\r\n  const bonus = new EarthWaterSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [[AttackTarget.Player, CombatStat.MaxHP]],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n  SynchroChangeListeners.register((state) => {\r\n    state = clearCombatStatCache(state, AttackTarget.Player, CombatStat.MaxHP);\r\n    return state;\r\n  }, \"earthWaterCombatStatCacheClearer\");\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { FireSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass FireAirSynchroBonus extends FireSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.8,\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> time between Market Stalls sales\",\r\n      {\r\n        magnitude: formatMultiplier(magnitude),\r\n        explanation,\r\n      },\r\n    );\r\n  }\r\n}\r\nexport function loadFireAirSynchroBonus() {\r\n  const bonus = new FireAirSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [[TransformationTags.TimePerAutoSalePerStall]],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { AttackTarget } from \"../../../exploration/AttackTarget\";\r\nimport {\r\n  CombatStat,\r\n  clearCombatStatCache,\r\n} from \"../../../exploration/CombatStats\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport { TransformationValueType } from \"../../../transformation/TransformationTags\";\r\nimport { SynchroChangeListeners } from \"../../Synchro\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { FireSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass FireEarthSynchroBonus extends FireSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Earth;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.02,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\"^{{magnitude}}^<{{explanation}}> :attack: and :defense:\", {\r\n      magnitude: formatMultiplier(magnitude),\r\n      explanation,\r\n    });\r\n  }\r\n}\r\nexport function loadFireEarthSynchroBonus() {\r\n  const bonus = new FireEarthSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [\r\n      [AttackTarget.Player, CombatStat.Attack],\r\n      [AttackTarget.Player, CombatStat.Defense],\r\n    ],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n  SynchroChangeListeners.register((state) => {\r\n    state = clearCombatStatCache(state, AttackTarget.Player, CombatStat.Attack);\r\n    state = clearCombatStatCache(\r\n      state,\r\n      AttackTarget.Player,\r\n      CombatStat.Defense,\r\n    );\r\n    return state;\r\n  }, \"fireEarthCombatStatCacheClearer\");\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport {\r\n  buildMonstiumCatalyst,\r\n  monstiumCatalyst,\r\n} from \"../../../buildings/catalysts/MonstiumCatalyst\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { FireSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass FirePoisonSynchroBonus extends FireSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.02,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return buildMonstiumCatalyst.isVisible(state);\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> effectivity of Monstium Catalysts\",\r\n      {\r\n        magnitude: formatMultiplier(magnitude),\r\n        explanation,\r\n      },\r\n    );\r\n  }\r\n}\r\nexport function loadFirePoisonSynchroBonus() {\r\n  const poison = new FirePoisonSynchroBonus();\r\n  SynchroBonuses.register(poison);\r\n  registerTransformation(\r\n    [[TransformationTags.CatalystEffectivity, monstiumCatalyst.getId()]],\r\n    poison.getId(),\r\n    poison.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return poison.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { FireSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass FireWaterSynchroBonus extends FireSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Water;\r\n  }\r\n\r\n  isBeneficial(): boolean {\r\n    return false;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.95,\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\"^{{magnitude}}^<{{explanation}}> Fire and Water spell power\", {\r\n      magnitude: formatMultiplier(magnitude),\r\n      explanation,\r\n    });\r\n  }\r\n}\r\nexport function loadFireWaterSynchroBonus() {\r\n  const bonus = new FireWaterSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.ActionMagnitude,\r\n        SpellElement.Fire,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.TemporaryEffectMagnitude,\r\n        SpellElement.Fire,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.ActionMagnitude,\r\n        SpellElement.Water,\r\n      ],\r\n      [\r\n        TransformationTags.Spell,\r\n        TransformationTags.ActionEffect,\r\n        TransformationTags.TemporaryEffectMagnitude,\r\n        SpellElement.Water,\r\n      ],\r\n    ],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { clearSpellCooldownCache } from \"../../../spells/Spells\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { SynchroChangeListeners } from \"../../Synchro\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { WaterSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass WaterAirSynchroBonus extends WaterSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Air;\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.97,\r\n        valueType: TransformationValueType.Divisor,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const explanation = this.getBonusEffectExplanations(\r\n      state,\r\n      amount,\r\n      \"magnitude\",\r\n    )[\"magnitude\"];\r\n    return t(\"^{{magnitude}}^<{{explanation}}> cooldown of attack spells\", {\r\n      magnitude: formatMultiplier(magnitude),\r\n      explanation,\r\n    });\r\n  }\r\n}\r\nexport function loadWaterAirSynchroBonus() {\r\n  const bonus = new WaterAirSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [[TransformationTags.AttackSpell, TransformationTags.SpellCooldown]],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n  SynchroChangeListeners.register(\r\n    (state) => clearSpellCooldownCache(state),\r\n    bonus.getId(),\r\n  );\r\n}\r\n","import { formatMultiplier } from \"../../../../utils/FormattingUtils\";\r\nimport { t } from \"../../../../utils/I18n\";\r\nimport { GameState } from \"../../../GameState\";\r\nimport { ActionEffect } from \"../../../action/Action\";\r\nimport {\r\n  buildSewageSystem,\r\n  sewageSystem,\r\n} from \"../../../buildings/production/SewageSystem\";\r\nimport { SpellElement } from \"../../../spells/Elements\";\r\nimport { clearCalculatedIncomeCache } from \"../../../timetick/IncomeOverTime\";\r\nimport {\r\n  TransformationType,\r\n  registerTransformation,\r\n} from \"../../../transformation/Transformation\";\r\nimport {\r\n  TransformationTags,\r\n  TransformationValueType,\r\n} from \"../../../transformation/TransformationTags\";\r\nimport { SynchroChangeListeners } from \"../../Synchro\";\r\nimport { SynchroBonuses } from \"../../SynchroBonuses\";\r\nimport { WaterSynchroBonus } from \"../BaseSynchroBonuses\";\r\n\r\nclass WaterPoisonSynchroBonus extends WaterSynchroBonus {\r\n  getElement2(): SpellElement {\r\n    return SpellElement.Poison;\r\n  }\r\n\r\n  isVisible(state: GameState): boolean {\r\n    return buildSewageSystem.isVisible(state);\r\n  }\r\n\r\n  protected getBaseBonusEffects(): Record<string, ActionEffect> {\r\n    return {\r\n      magnitude: {\r\n        value: 0.5,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n      magnitudeConsumption: {\r\n        value: 1.0,\r\n        valueType: TransformationValueType.Percent,\r\n      },\r\n    };\r\n  }\r\n\r\n  getEffect(state: GameState, amount: number): string {\r\n    const magnitude = this.getBonusEffect(state, \"magnitude\", amount);\r\n    const magnitudeConsumption = this.getBonusEffect(\r\n      state,\r\n      \"magnitudeConsumption\",\r\n      amount,\r\n    );\r\n    const explanations = this.getBonusEffectExplanations(state, amount);\r\n    return t(\r\n      \"^{{magnitude}}^<{{explanation}}> production, but ^{{magnitudeConsumption}}^<{{explanationConsumption}}> consumption of Sewage Systems\",\r\n      {\r\n        magnitude: formatMultiplier(magnitude),\r\n        explanation: explanations.magnitude,\r\n        magnitudeConsumption: formatMultiplier(magnitudeConsumption),\r\n        explanationConsumption: explanations.magnitudeConsumption,\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\nexport function loadWaterPoisonSynchroBonus() {\r\n  const bonus = new WaterPoisonSynchroBonus();\r\n  SynchroBonuses.register(bonus);\r\n  registerTransformation(\r\n    [[sewageSystem.getId(), TransformationTags.Production]],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitude\");\r\n    },\r\n  );\r\n  registerTransformation(\r\n    [[sewageSystem.getId(), TransformationTags.Consumption]],\r\n    bonus.getId(),\r\n    bonus.getName(),\r\n    TransformationType.Multiplier,\r\n    (state) => {\r\n      return bonus.getCurrentBonusEffect(state, \"magnitudeConsumption\");\r\n    },\r\n  );\r\n  SynchroChangeListeners.register(\r\n    (state) => clearCalculatedIncomeCache(state),\r\n    bonus.getId(),\r\n  );\r\n}\r\n","import { loadDoubleElementSynchroBonuses } from \"./bonuses/DoubleElementSynchroBonuses\";\r\nimport { loadAirPoisonSynchroBonus } from \"./bonuses/air/AirPoisonSynchroBonus\";\r\nimport { loadEarthAirSynchroBonus } from \"./bonuses/earth/EarthAirSynchroBonus\";\r\nimport { loadEarthPoisonSynchroBonus } from \"./bonuses/earth/EarthPoisonSynchroBonus\";\r\nimport { loadEarthWaterSynchroBonus } from \"./bonuses/earth/EarthWaterSynchroBonus\";\r\nimport { loadFireAirSynchroBonus } from \"./bonuses/fire/FireAirSynchroBonus\";\r\nimport { loadFireEarthSynchroBonus } from \"./bonuses/fire/FireEarthSynchroBonus\";\r\nimport { loadFirePoisonSynchroBonus } from \"./bonuses/fire/FirePoisonSynchroBonus\";\r\nimport { loadFireWaterSynchroBonus } from \"./bonuses/fire/FireWaterSynchroBonus\";\r\nimport { loadWaterAirSynchroBonus } from \"./bonuses/water/WaterAirSynchroBonus\";\r\nimport { loadWaterPoisonSynchroBonus } from \"./bonuses/water/WaterPoisonSynchroBonus\";\r\n\r\nexport function loadSynchroDemo() {\r\n  loadDoubleElementSynchroBonuses();\r\n\r\n  // Fire\r\n  loadFireEarthSynchroBonus();\r\n  loadFireWaterSynchroBonus();\r\n  loadFireAirSynchroBonus();\r\n  loadFirePoisonSynchroBonus();\r\n\r\n  // Earth\r\n  loadEarthWaterSynchroBonus();\r\n  loadEarthAirSynchroBonus();\r\n  loadEarthPoisonSynchroBonus();\r\n\r\n  // Water\r\n  loadWaterAirSynchroBonus();\r\n  loadWaterPoisonSynchroBonus();\r\n\r\n  // Air\r\n  loadAirPoisonSynchroBonus();\r\n}\r\n","import { loadResources } from \"i18next\";\r\nimport { setDemo } from \"./Demo\";\r\nimport { loadActions } from \"./action/ActionLoader\";\r\nimport { loadAutocast } from \"./autocast/Autocast\";\r\nimport { loadMarket } from \"./autocast/Market\";\r\nimport { loadBuildingsDemo } from \"./buildings/DemoBuildingLoader\";\r\nimport { loadCombatClassesDemo } from \"./classes/DemoCombatClassLoader\";\r\nimport { loadEnhancementsDemo } from \"./enhancement/DemoEnhancementLoader\";\r\nimport { loadGameEventsDemo } from \"./events/DemoGameEventLoader\";\r\nimport { loadExploration } from \"./exploration/Exploration\";\r\nimport { loadDungeonsDemo } from \"./exploration/dungeons/DemoDungeonLoader\";\r\nimport { loadEnemiesDemo } from \"./exploration/enemies/DemoEnemyLoader\";\r\nimport { loadHelpsDemo } from \"./helps/HelpLoaderDemo\";\r\nimport { loadHintsDemo } from \"./hints/DemoHintLoader\";\r\nimport { loadItemsDemo } from \"./items/DemoItemLoader\";\r\nimport { loadCompendium } from \"./items/ItemCompendium\";\r\nimport { loadSpellsDemo } from \"./spells/DemoSpellLoader\";\r\nimport { loadElementMultipliers } from \"./spells/ElementMultipliers\";\r\nimport { loadResearchers } from \"./study/Study\";\r\nimport { loadSynchroDemo } from \"./synchro/SynchroLoaderDemo\";\r\nimport { loadCommonTemporaryEffects } from \"./temporaryeffects/CommonTemporaryEffects\";\r\nimport { loadTimePieces } from \"./timetick/TimePieces\";\r\nimport { loadTotalTimePlayed } from \"./timetick/TotalTimePlayed\";\r\n\r\nexport function loadDemoGame() {\r\n  setDemo(true);\r\n  loadActions();\r\n  loadBuildingsDemo();\r\n  loadSpellsDemo();\r\n  loadElementMultipliers();\r\n  loadAutocast();\r\n  loadResources();\r\n  loadResearchers();\r\n  loadTotalTimePlayed();\r\n  loadItemsDemo();\r\n  loadMarket();\r\n  loadEnemiesDemo();\r\n  loadDungeonsDemo();\r\n  loadExploration();\r\n  loadEnhancementsDemo();\r\n  loadCombatClassesDemo();\r\n  loadSynchroDemo();\r\n  loadCommonTemporaryEffects();\r\n  loadTimePieces();\r\n  loadGameEventsDemo();\r\n  loadHintsDemo();\r\n  loadHelpsDemo();\r\n  loadCompendium();\r\n}\r\n","import {\r\n  loadEnhancementCommonLogic,\r\n  registerEnhancement,\r\n} from \"./Enhancements\";\r\nimport { compass } from \"./exploration/Compass\";\r\nimport { doubleHealthBoost } from \"./exploration/DoubleHealthBoost\";\r\nimport { efficientExploration } from \"./exploration/EfficientExploration\";\r\nimport { enlargedPouch } from \"./exploration/EnlargedPouch\";\r\nimport { firstAid } from \"./exploration/FirstAid\";\r\nimport { giantPouch } from \"./exploration/GiantPouch\";\r\nimport { healthBoost } from \"./exploration/HealthBoost\";\r\nimport { healthPotionEffectivity } from \"./exploration/HealthPotionEffectivity\";\r\nimport { monstiumCollection } from \"./exploration/MonstiumCollection\";\r\nimport { professionalPouch } from \"./exploration/ProfessionalPouch\";\r\nimport { tripleHealthBoost } from \"./exploration/TripleHealthBoost\";\r\nimport { furnitureOrganization } from \"./land/FurnitureOrganization\";\r\nimport { houseExpansionContract } from \"./land/HouseExpansionContract\";\r\nimport { landTreaty } from \"./land/LandTreaty\";\r\nimport { deeperUnderstandingOfMagic } from \"./other/DeeperUnderstandingOfMagic\";\r\nimport { glitteringStalls } from \"./other/GlitteringStalls\";\r\nimport { hiringSpree } from \"./other/HiringSpree\";\r\nimport { manaSteamers } from \"./other/ManaSteamers\";\r\nimport { monstiumCatalysts } from \"./other/MonstiumCatalysts\";\r\nimport { scalableChambers } from \"./other/ScalableChambers\";\r\nimport { sewageSystemEnhancement } from \"./other/SewageSystem\";\r\nimport { shardDiligence } from \"./other/ShardDiligence\";\r\nimport { treasureChests } from \"./other/TreasureChests\";\r\nimport { understandingOfMagic } from \"./other/UnderstandingOfMagic\";\r\nimport { improvedPurification } from \"./production/ImprovedPurification\";\r\nimport { superheatedCatalysts } from \"./production/SuperheatedCatalysts\";\r\nimport { superheatedSteamers } from \"./production/SuperheatedSteamers\";\r\nimport { compressedEssence } from \"./storage/CompressedEssence\";\r\nimport { primaryStorage } from \"./storage/PrimaryStorage\";\r\nimport { wideStorage } from \"./storage/WideStorage\";\r\n\r\nexport function loadEnhancementsDemo() {\r\n  loadEnhancementCommonLogic();\r\n\r\n  // Storage\r\n  registerEnhancement(compressedEssence);\r\n  registerEnhancement(treasureChests);\r\n  registerEnhancement(primaryStorage);\r\n  registerEnhancement(wideStorage);\r\n\r\n  // Land\r\n  registerEnhancement(landTreaty);\r\n  registerEnhancement(houseExpansionContract);\r\n  registerEnhancement(furnitureOrganization);\r\n\r\n  // Production\r\n  registerEnhancement(superheatedCatalysts);\r\n  registerEnhancement(sewageSystemEnhancement);\r\n  registerEnhancement(improvedPurification);\r\n  registerEnhancement(superheatedSteamers);\r\n\r\n  // Exploration\r\n  registerEnhancement(efficientExploration);\r\n  registerEnhancement(healthBoost);\r\n  registerEnhancement(healthPotionEffectivity);\r\n  registerEnhancement(firstAid);\r\n  registerEnhancement(monstiumCollection);\r\n  registerEnhancement(enlargedPouch);\r\n  registerEnhancement(compass);\r\n  registerEnhancement(doubleHealthBoost);\r\n  registerEnhancement(professionalPouch);\r\n  registerEnhancement(tripleHealthBoost);\r\n  registerEnhancement(giantPouch);\r\n\r\n  // Other\r\n  registerEnhancement(understandingOfMagic);\r\n  registerEnhancement(deeperUnderstandingOfMagic);\r\n  registerEnhancement(manaSteamers);\r\n  registerEnhancement(glitteringStalls);\r\n  registerEnhancement(monstiumCatalysts);\r\n  registerEnhancement(hiringSpree);\r\n  registerEnhancement(scalableChambers);\r\n  registerEnhancement(shardDiligence);\r\n}\r\n","import { registerRootComponent } from \"expo\";\r\nimport \"intl-pluralrules\";\r\nimport { useEffect, useState } from \"react\";\r\nimport \"react-native-gesture-handler\";\r\nimport \"setimmediate\";\r\nimport \"./i18n\";\r\nimport AppContents from \"./src/AppContents\";\r\nimport AudioManager from \"./src/audio/AudioManager\";\r\nimport { loadDemoGame } from \"./src/backend/DemoLoader\";\r\nimport { setTooltipComponentForMarkdown } from \"./src/components/utility/Markdown\";\r\nimport Tooltip from \"./src/components/utility/tooltip/PaperTooltip\";\r\n\r\nfunction loadGame() {\r\n  loadDemoGame();\r\n\r\n  setTooltipComponentForMarkdown(Tooltip);\r\n  AudioManager.load();\r\n}\r\n\r\nexport default function App() {\r\n  const [loading, setLoading] = useState(true);\r\n  useEffect(() => {\r\n    loadGame();\r\n    setLoading(false);\r\n  }, []);\r\n  if (loading) {\r\n    return null;\r\n  }\r\n  return <AppContents />;\r\n}\r\n\r\nregisterRootComponent(App);\r\n","var map = {\n\t\"./af\": 26735,\n\t\"./af.js\": 26735,\n\t\"./ar\": 79343,\n\t\"./ar-dz\": 55300,\n\t\"./ar-dz.js\": 55300,\n\t\"./ar-kw\": 77947,\n\t\"./ar-kw.js\": 77947,\n\t\"./ar-ly\": 92882,\n\t\"./ar-ly.js\": 92882,\n\t\"./ar-ma\": 43030,\n\t\"./ar-ma.js\": 43030,\n\t\"./ar-sa\": 22971,\n\t\"./ar-sa.js\": 22971,\n\t\"./ar-tn\": 78662,\n\t\"./ar-tn.js\": 78662,\n\t\"./ar.js\": 79343,\n\t\"./az\": 81672,\n\t\"./az.js\": 81672,\n\t\"./be\": 39027,\n\t\"./be.js\": 39027,\n\t\"./bg\": 19107,\n\t\"./bg.js\": 19107,\n\t\"./bm\": 38932,\n\t\"./bm.js\": 38932,\n\t\"./bn\": 76218,\n\t\"./bn-bd\": 33617,\n\t\"./bn-bd.js\": 33617,\n\t\"./bn.js\": 76218,\n\t\"./bo\": 94527,\n\t\"./bo.js\": 94527,\n\t\"./br\": 53345,\n\t\"./br.js\": 53345,\n\t\"./bs\": 67930,\n\t\"./bs.js\": 67930,\n\t\"./ca\": 60454,\n\t\"./ca.js\": 60454,\n\t\"./cs\": 13984,\n\t\"./cs.js\": 13984,\n\t\"./cv\": 64646,\n\t\"./cv.js\": 64646,\n\t\"./cy\": 71372,\n\t\"./cy.js\": 71372,\n\t\"./da\": 62978,\n\t\"./da.js\": 62978,\n\t\"./de\": 32193,\n\t\"./de-at\": 56365,\n\t\"./de-at.js\": 56365,\n\t\"./de-ch\": 29737,\n\t\"./de-ch.js\": 29737,\n\t\"./de.js\": 32193,\n\t\"./dv\": 10872,\n\t\"./dv.js\": 10872,\n\t\"./el\": 99534,\n\t\"./el.js\": 99534,\n\t\"./en-au\": 68450,\n\t\"./en-au.js\": 68450,\n\t\"./en-ca\": 56996,\n\t\"./en-ca.js\": 56996,\n\t\"./en-gb\": 3864,\n\t\"./en-gb.js\": 3864,\n\t\"./en-ie\": 39472,\n\t\"./en-ie.js\": 39472,\n\t\"./en-il\": 40300,\n\t\"./en-il.js\": 40300,\n\t\"./en-in\": 67078,\n\t\"./en-in.js\": 67078,\n\t\"./en-nz\": 50472,\n\t\"./en-nz.js\": 50472,\n\t\"./en-sg\": 28696,\n\t\"./en-sg.js\": 28696,\n\t\"./eo\": 33550,\n\t\"./eo.js\": 33550,\n\t\"./es\": 59311,\n\t\"./es-do\": 83080,\n\t\"./es-do.js\": 83080,\n\t\"./es-mx\": 77334,\n\t\"./es-mx.js\": 77334,\n\t\"./es-us\": 64336,\n\t\"./es-us.js\": 64336,\n\t\"./es.js\": 59311,\n\t\"./et\": 28067,\n\t\"./et.js\": 28067,\n\t\"./eu\": 88831,\n\t\"./eu.js\": 88831,\n\t\"./fa\": 67981,\n\t\"./fa.js\": 67981,\n\t\"./fi\": 17479,\n\t\"./fi.js\": 17479,\n\t\"./fil\": 20757,\n\t\"./fil.js\": 20757,\n\t\"./fo\": 9510,\n\t\"./fo.js\": 9510,\n\t\"./fr\": 78573,\n\t\"./fr-ca\": 6805,\n\t\"./fr-ca.js\": 6805,\n\t\"./fr-ch\": 74170,\n\t\"./fr-ch.js\": 74170,\n\t\"./fr.js\": 78573,\n\t\"./fy\": 80926,\n\t\"./fy.js\": 80926,\n\t\"./ga\": 60203,\n\t\"./ga.js\": 60203,\n\t\"./gd\": 92975,\n\t\"./gd.js\": 92975,\n\t\"./gl\": 76890,\n\t\"./gl.js\": 76890,\n\t\"./gom-deva\": 24234,\n\t\"./gom-deva.js\": 24234,\n\t\"./gom-latn\": 97577,\n\t\"./gom-latn.js\": 97577,\n\t\"./gu\": 55804,\n\t\"./gu.js\": 55804,\n\t\"./he\": 5377,\n\t\"./he.js\": 5377,\n\t\"./hi\": 99401,\n\t\"./hi.js\": 99401,\n\t\"./hr\": 12435,\n\t\"./hr.js\": 12435,\n\t\"./hu\": 62728,\n\t\"./hu.js\": 62728,\n\t\"./hy-am\": 88093,\n\t\"./hy-am.js\": 88093,\n\t\"./id\": 26666,\n\t\"./id.js\": 26666,\n\t\"./is\": 35187,\n\t\"./is.js\": 35187,\n\t\"./it\": 62667,\n\t\"./it-ch\": 56334,\n\t\"./it-ch.js\": 56334,\n\t\"./it.js\": 62667,\n\t\"./ja\": 62414,\n\t\"./ja.js\": 62414,\n\t\"./jv\": 29359,\n\t\"./jv.js\": 29359,\n\t\"./ka\": 78740,\n\t\"./ka.js\": 78740,\n\t\"./kk\": 9521,\n\t\"./kk.js\": 9521,\n\t\"./km\": 21679,\n\t\"./km.js\": 21679,\n\t\"./kn\": 58554,\n\t\"./kn.js\": 58554,\n\t\"./ko\": 50686,\n\t\"./ko.js\": 50686,\n\t\"./ku\": 75965,\n\t\"./ku.js\": 75965,\n\t\"./ky\": 24780,\n\t\"./ky.js\": 24780,\n\t\"./lb\": 56950,\n\t\"./lb.js\": 56950,\n\t\"./lo\": 9434,\n\t\"./lo.js\": 9434,\n\t\"./lt\": 43681,\n\t\"./lt.js\": 43681,\n\t\"./lv\": 82552,\n\t\"./lv.js\": 82552,\n\t\"./me\": 18473,\n\t\"./me.js\": 18473,\n\t\"./mi\": 862,\n\t\"./mi.js\": 862,\n\t\"./mk\": 18932,\n\t\"./mk.js\": 18932,\n\t\"./ml\": 63174,\n\t\"./ml.js\": 63174,\n\t\"./mn\": 66863,\n\t\"./mn.js\": 66863,\n\t\"./mr\": 10566,\n\t\"./mr.js\": 10566,\n\t\"./ms\": 42215,\n\t\"./ms-my\": 54959,\n\t\"./ms-my.js\": 54959,\n\t\"./ms.js\": 42215,\n\t\"./mt\": 38830,\n\t\"./mt.js\": 38830,\n\t\"./my\": 19336,\n\t\"./my.js\": 19336,\n\t\"./nb\": 48113,\n\t\"./nb.js\": 48113,\n\t\"./ne\": 94005,\n\t\"./ne.js\": 94005,\n\t\"./nl\": 22699,\n\t\"./nl-be\": 2796,\n\t\"./nl-be.js\": 2796,\n\t\"./nl.js\": 22699,\n\t\"./nn\": 29700,\n\t\"./nn.js\": 29700,\n\t\"./oc-lnc\": 39495,\n\t\"./oc-lnc.js\": 39495,\n\t\"./pa-in\": 11217,\n\t\"./pa-in.js\": 11217,\n\t\"./pl\": 98807,\n\t\"./pl.js\": 98807,\n\t\"./pt\": 19221,\n\t\"./pt-br\": 39895,\n\t\"./pt-br.js\": 39895,\n\t\"./pt.js\": 19221,\n\t\"./ro\": 39162,\n\t\"./ro.js\": 39162,\n\t\"./ru\": 37991,\n\t\"./ru.js\": 37991,\n\t\"./sd\": 64518,\n\t\"./sd.js\": 64518,\n\t\"./se\": 64197,\n\t\"./se.js\": 64197,\n\t\"./si\": 40056,\n\t\"./si.js\": 40056,\n\t\"./sk\": 17025,\n\t\"./sk.js\": 17025,\n\t\"./sl\": 20069,\n\t\"./sl.js\": 20069,\n\t\"./sq\": 1961,\n\t\"./sq.js\": 1961,\n\t\"./sr\": 35820,\n\t\"./sr-cyrl\": 20250,\n\t\"./sr-cyrl.js\": 20250,\n\t\"./sr.js\": 35820,\n\t\"./ss\": 97806,\n\t\"./ss.js\": 97806,\n\t\"./sv\": 2833,\n\t\"./sv.js\": 2833,\n\t\"./sw\": 29018,\n\t\"./sw.js\": 29018,\n\t\"./ta\": 51830,\n\t\"./ta.js\": 51830,\n\t\"./te\": 2102,\n\t\"./te.js\": 2102,\n\t\"./tet\": 58711,\n\t\"./tet.js\": 58711,\n\t\"./tg\": 72615,\n\t\"./tg.js\": 72615,\n\t\"./th\": 38373,\n\t\"./th.js\": 38373,\n\t\"./tk\": 43277,\n\t\"./tk.js\": 43277,\n\t\"./tl-ph\": 76249,\n\t\"./tl-ph.js\": 76249,\n\t\"./tlh\": 87413,\n\t\"./tlh.js\": 87413,\n\t\"./tr\": 26726,\n\t\"./tr.js\": 26726,\n\t\"./tzl\": 29131,\n\t\"./tzl.js\": 29131,\n\t\"./tzm\": 45683,\n\t\"./tzm-latn\": 22174,\n\t\"./tzm-latn.js\": 22174,\n\t\"./tzm.js\": 45683,\n\t\"./ug-cn\": 74984,\n\t\"./ug-cn.js\": 74984,\n\t\"./uk\": 83778,\n\t\"./uk.js\": 83778,\n\t\"./ur\": 22753,\n\t\"./ur.js\": 22753,\n\t\"./uz\": 54345,\n\t\"./uz-latn\": 67383,\n\t\"./uz-latn.js\": 67383,\n\t\"./uz.js\": 54345,\n\t\"./vi\": 8201,\n\t\"./vi.js\": 8201,\n\t\"./x-pseudo\": 57395,\n\t\"./x-pseudo.js\": 57395,\n\t\"./yo\": 99359,\n\t\"./yo.js\": 99359,\n\t\"./zh-cn\": 75680,\n\t\"./zh-cn.js\": 75680,\n\t\"./zh-hk\": 89536,\n\t\"./zh-hk.js\": 89536,\n\t\"./zh-mo\": 35088,\n\t\"./zh-mo.js\": 35088,\n\t\"./zh-tw\": 2867,\n\t\"./zh-tw.js\": 2867\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","__webpack_require__.p = \"./\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkweb\"] = self[\"webpackChunkweb\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [923], () => (__webpack_require__(23479)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["Storage","MMKV","resources","en","translation","JSON","parse","_Storage$getString","getString","i18n","initReactI18next","init","lng","nsSeparator","keySeparator","fallbackLng","saveMissing","interpolation","escapeValue","clone","obj","stringify","getRandomElementFromArray","arr","len","length","Math","floor","random","keysOf","Object","keys","memoize","valuesOf","values","valuesOfCached","fromEntries","entries","addRecords","records","result","record","key","_record$key","_result$key","nullthrows","Error","cache","LRUCache","max","t","_len","arguments","args","Array","_key","cached","get","undefined","i18nextT","set","RoundingMethod","MAX_FORMAT_VALUE","Number","MAX_VALUE","formatNumber","num","_options$roundingMeth","options","showDecimals","roundingMethod","toExponential","DEFAULT","abs","isInteger","round","UP","ceil","toFixed","base","formatMultiplier","ratio","pct","formatTime","secs","shortForm","unit","time","formatTimeLong","duration","asDays","hours","padStart","minutes","seconds","days","getCurrentVersionTimestamp","_Constants$expoConfig","_Constants$expoConfig2","Constants","extra","buildRunTimestamp","getCurrentVersion","_Constants$expoConfig3","version","ExplorationStatus","ResearcherAutoAssignStrategy","EXPLORATION_INITIAL_STATE","currentHP","explorationStatus","None","explorationStartTime","currentDungeonFloorId","currentEnemy","id","successfulExplorationsPerFloor","playerActionProgress","familiarActionProgress","enemyActionProgress","familiarIsInBackRow","lastPlayerDamageCause","actionResultQueue","lastActionResultPushedTime","pouchItemsUsesLeft","variables","triggerPlayerDeath","AUTOCAST_INITIAL_STATE","savedStrategies","currentStrategy","rules","permaCastRules","name","wizardsAssignedToPermaCast","lastStrategyIndex","SYNCHRO_INITIAL_STATE","grid","GLOBAL_INITIAL_STATE","secondsPlayed","activeSecondsPlayed","timePiecesConsumed","startTimestamp","Date","now","appVersionTimestamp","appVersionString","_getCurrentVersion","isFullVersionSave","tickCount","newGamePlusUnlocked","newGamePlusCount","newGamePlusMax","totalBoonPointsEarned","appPlatform","Platform","notifications","autoUsePouch","autocast","debugShowUpdatesPerSec","debugLastUpdateTimestamps","debugLastUpdateBeginEndTimestamps","endingsHistory","RUN_INITIAL_STATE","newFlagsOnRetirement","endingTriggered","lastDungeonFloorCompleted","buildings","flags","elementExperience","Fire","Earth","Water","Air","elementExponents","eventQueue","eventOccurrences","nextEventIsManuallyTriggered","temporaryEffects","recentSpellsCast","nextRandomEvent","primaryElement","inventory","equipment","Hand","Body","Accessory","Pouch","autocastPaused","exploration","explorationMessageLog","lastSpellCastTimes","uiCommands","lastProcessedTime","lastItemUsedTimes","quickbar","favoriteSpells","skipAheadTime","warpTimeSecs","summoningBlockedUntilTime","boostsBought","Poison","Mind","Life","Electric","Death","Holy","Time","Space","equipmentLoadouts","lastEquipmentLoadoutModified","landPurchaseCount","saleStallItems","saleStallProgressRatio","partiallyUnlockedElements","combatClassId","explorationTriggers","studyAllocation","familiars","secondaryElement","autoPurchaseActions","empoweredSpells","activeRituals","maxElementLevelsOnPrevRetirement","lastComputedLevelUpElementExperience","pityEnabledAtSeconds","pityCounter","extraEventSecs","currentChallengeId","autoAdvanceToNextFloor","autoAttemptBoss","spellcrafts","WORLD_INITIAL_STATE","maxPrimaryElementLevels","maxElementLevels","maxFurnitureNumbers","unlockedElements","totalTimesResetted","quickbars","currentQuickbar","timesEnemyDefeated","maxLandsPurchased","sheerPowerLevel","storylineOracleLevel","blazingSpeedLevel","worldDifficultyLevel","knownEnemiesThatDrop","itemsEverAddedToInventory","synchro","grids","currentGrid","OPTIONS_INITIAL_STATE","targetFps","wakeLock","hiddenFromBottomMenu","hideDamageEffects","doNotUseNativeDriver","overrideElementDisplay","themeMode","hideEventTags","enableSwiping","enableBottomMenu","leftHandedMode","putCastSpellOnBottomMenu","hideTooltips","doNotShowEventsOnWideScreens","hideBottomResourceViewer","waitUntilFullyHealedBeforeExplore","autoPurchaseEnhancements","zoomLevel","researcherAutoAssignStrategy","OFF","expandedUI","saveExpandedUI","colorSpellButtonsByElement","sectionOrder","compactUI","doNotPopupEventsDuringBossFights","INITIAL_STATE","global","run","world","temp","createTempState","isFake","Map","flagCache","worldFlagCache","locationEncyclopediaCache","isInAutocast","isInPermacast","isInPouch","elementLevelCache","lastAutoPurchaseRun","lastAutoPurchaseEnhancementRun","familiarLevelCache","combatStatCache","Player","Familiar","Enemy","resourceCapCache","unlockedElementsCache","incomeOverTimeCache","autocastPointsRequirementCache","spellManaCostCache","researchPerSecCache","spellRequirementsCache","spellExpCache","lastProcessedAutocastSpellId","createHypotheticalState","state","clonedState","StateContext","React","_objectSpread","apply","transform","overwrite","cacheByTickCount","valueFn","readCacheOnly","oldValue","newValue","cacheBySecondsPlayed","cacheByArbitraryVersion","versionFn","cacheBooleanTrueOnly","value","cacheIndefinitely","keyFn","clearCacheKey","delete","clearCacheListeners","clearAllCaches","listener","isThisDemo","isDemo","idOf","getId","DataStore","_classCallCheck","store","numericIds","maxId","_createClass","overrideId","numericId","this","toString","isIdentifiable","hasFlag","flag","_state$run$flags","SetFlagListeners","setFlagImpl","_state$run$flags2","_state$run$flags$flag","_state$world$flags","getAll","forEach","hasEverHadFlag","hasWorldFlag","setFlag","bind","_this","clearFlagImpl","clearFlag","setWorldFlagForNextRunImpl","setWorldFlagForNextRun","setWorldFlagImpl","_state$world$flags2","setWorldFlag","_state$world$flags3","setCombatVariableImpl","variable","setCombatVariable","resetAllCombatVariables","getCombatVariable","_state$run$exploratio","listeners","highPriorityListeners","triggerExtractors","triggerValues","perfInfo","addGameStateListener","triggerExtractor","clearGameStateListener","getPerfInfoForListener","executed","listenerMs","executedTrigger","triggerMs","applyHighPriGameStateListeners","newState","filter","listenerKey","beginTimestamp","performance","endTimestamp","map","applyGameStateListeners","validListeners","extractor","push","listenerResults","applyAllTransforms","transforms","trans","assign","TransformationTags","TransformationValueType","TransformationType","transformationDatabase","allTransformations","registerTransformation","tags","transformationId","transformationDescription","transformationType","transformation","data","description","type","lastValue","allTags","Set","flat","tag","_transformationDataba","forTag","some","preExisting","cacheMisses","getTransformationsThatApply","memoizeWithLimit","prejoinedTags","_cacheMisses$get","joinedTags","join","allTransformationsThatApply","_transformationDataba2","targetTags","every","targetTag","includes","uniqueTransformations","_toConsumableArray","applyMultiplierTransformations","startingValue","params","transformParams","Multiplier","reduce","prev","current","applyTransformations","oldTransformTags","concat","transformations","additionTransformations","Addition","afterAddition","_transformation$trans","powerTransformations","Power","afterPower","_transformation$trans2","pow","multiplicationTransformations","afterMultiplication","_transformation2$tran","overrideTransformations","Override","afterOverride","newOverride","missMap","getCacheKeyStuff","_missMap$joinedTags","applyTransformationsCached","cacheKey","applyTransformationsPermaCached","_state","clearTransformationCache","deleteKey","explainTransformations","output","explainTransformationsText","_params$unit","_params$valueType","explained","valueType","Basic","overrides","amount","toTextAddition","Percent","toTextMultiplier","additions","multipliers","baseText","additionText","plusText","multiplierText","Log2","_params$base","Log2Divisor","_params$base2","Divisor","explainTransformationsTextUncached","Resource","translateResource","resource","Mana","FireEssence","EarthEssence","WaterEssence","AirEssence","PoisonEssence","MindEssence","LifeEssence","ElectricEssence","DeathEssence","HolyEssence","TimeEssence","SpaceEssence","Coins","Monstium","TimePiece","RESOURCES","baseCap","icon","getResourceInfo","getSortedResourceKeys","sort","a","b","indexOf","resourceCapTags","resourceName","Cap","resourceCapParams","clearResourceCapCache","getResourceCap","calculateResourceCap","getResourceAmount","_state$run$resources","grantResourceImpl","_state$run$resources2","cap","min","grantResource","retirementListeners","postRetirementListeners","registerRetirementListener","registerPostRetirementListener","isRetirementUnlocked","retire","isMock","listenerId","_state$run","ActionArea","ActionSubcategories","translateActionSubcategory","subcategory","ACTIONS","CHANNELING","MANA","STORAGE","CATALYSTS","OTHER","TIME_PIECES","ENHANCE_STORAGE","ENHANCE_LAND","ENHANCE_PRODUCTION","ENHANCE_CATALYSTS","ENHANCE_EXPLORATION","ENHANCE_OTHER","BOOST","BOOST_OTHER","FAMILIARS","clearVisibleSpellsCache","actionArea","SpellElement","translateElement","element","getRankForLevel","level","rankPlus","rank","ELEMENT_LEVEL_CAP_BASE","ELEMENT_LEVEL_CAP_DEMO_BASE","expTable","getElementExp","_state$run$elementExp","maxElementLevelTags","MaxElementLevel","getMaxElementLevel","getIncrementalExpRequiredForLevelAndExponent","exponent","maxLevel","Infinity","getTotalExpRequiredForLevelByExponent","_expTable$get","cachedExp","getLevelByExpAndExponent","exp","estimateLevel","getExponentForElement","_state$run$elementExp2","_state$run$elementExp3","getUnlockedElements","primary","ExpRequirementScale","isPartiallyUnlocked","getTotalExpRequiredForLevel","estimateLevels","getElementLevel","cacheByTickCountElementLevel","_state$run$elementExp4","getLevelByExp","grantElementExpImpl","grantElementExp","selectPrimaryElementImpl","selectSecondaryElementImpl","getPrimaryElements","getPrimaryElementMaxLevelForRun","primaryElements","elementValues","getFullyUnlockedElements","_state$world$unlocked","_state$run$partiallyU","unlockElementImpl","unlockElement","partiallyUnlockElementImpl","partiallyUnlockElement","hasElementBeenPartiallyUnlockedInPreviousRun","getMaxPrimaryElementLevel","_state$world$maxPrima","getMaxOfMaxPrimaryElementLevels","tagsForExpGain","ExpGain","getElementExpByUsage","manaSpent","isSpellElement","transformed","school","BASE_STARTING_EXP","STARTING_EXP_POWER_BASE","STARTING_ELEMENT_EXP_BASE_TAGS_BY_ELEMENT","StartingElementExpBase","startingExpForElement","maximumElementLevelExpMultiplier","s","sumOfLevels","total","_maxElementLevels","getSumOfMaxPrimaryElementLevels","maximumElementLevelProductionMultiplierDx","researchMultiplier","grantStartingExp","meetsRequirements","requirements","elementName","Production","ChannelingEfficiency","Loot","FamiliarExp","Cost","Spell","cachedExponents","_loop","_expTable$get2","generateDeathColor","fireColor","isDark","color","grayscale","darken","hexa","generateHolyColor","lighten","COLORS_TO_REGENERATE_LIGHT","COLORS_TO_REGENERATE_DARK","TO_GRAYSCALE_ONLY","getThemeByElementAndDarkMode","getThemeByElementAndDarkModeUnmemoized","colors","onPrimary","primaryContainer","onPrimaryContainer","secondary","onSecondary","secondaryContainer","onSecondaryContainer","tertiary","onTertiary","tertiaryContainer","onTertiaryContainer","error","onError","errorContainer","onErrorContainer","background","onBackground","surface","onSurface","surfaceVariant","onSurfaceVariant","outline","outlineVariant","shadow","scrim","inverseSurface","inverseOnSurface","inversePrimary","elevation","level0","level1","level2","level3","level4","level5","surfaceDisabled","onSurfaceDisabled","backdrop","deathColors","colorToChange","holyColors","baseTheme","MD3DarkTheme","MD3LightTheme","hpBarForeground","hpBarBackground","fonts","labelSmall","letterSpacing","labelMedium","bodySmall","bodyMedium","roundness","getThemeWithOverriddenOnError","theme","newTheme","Dungeons","DungeonFloors","getUnlockedDungeons","dungeon","isUnlocked","isDungeonFloorCompletedThisRun","isDungeonFloorEverCompleted","setDungeonFloorCompleted","floorId","mplIsTooLow","maxLowRecommendation","floors","getDungeonFloors","isMainStoryDungeonFloor","_floor$getMinimumMPLR","getMinimumMPLRecommendation","minMPLRecommendation","mplIsTooHigh","minHighRecommendation","_floor$getMaximumMPLR","getMaximumMPLRecommendation","maxMPLRecommendation","StorylineStatus","STORYLINE_STATUS_ORDER","LOCKED","UNLOCKED","HINT_REVEALED","COMPLETED","BONUS_ACTIVE","translateStorylineStatus","status","HIDDEN","Storyline","order","mindRequirementForHint","hintDescription","getBonusDescription","isHintUnlockable","isHidden","isHintRevealed","isBonusActive","isCompleted","storyline","Flag","Items","isItemQualityUnlocked","Schematics","combineAll","combined","stack","combineActions","getById","itemOccurrence","itemId","getCombineActions","combineAllAction","isEnabled","sellLowQualityItems","sold","item","itemStack","_itemStack$itemOccurr","_itemStack$itemOccurr2","_stack$itemOccurrence","_stack$itemOccurrence2","itemQuality","saleActions","getSaleActions","saleAction","getItemOccurrenceIndex","itemOccurrenceParamsJSON","findIndex","isItemOccurrenceEqual","itemOccurrenceA","itemOccurrenceB","getItemStackFromInventory","index","AddToInventoryForFirstTimeListeners","addToInventory","previousIndex","removeFromInventory","newAmount","splice","getAmountOfItem","getTotalAmountOfItem","count","removeFromInventoryWithAnyParams","oldRunState","firstIndex","itemAmount","AttackTarget","translateAttackTarget","target","CombatStat","BASE_VALUES","MaxHP","Attack","Defense","AttackDelay","HPRegen","Dodge","Accuracy","Crit","calculatePlayerMaxHP","calculatePlayerCombatStat","calculatePlayerAttack","calculatePlayerAttackDelaySec","calculatePlayerDefense","calculatePlayerHPRegenRatioPerSec","calculatePlayerDodgePoints","calculatePlayerAccuracyPoints","calculatePlayerCritPoints","playerStatTags","stat","getCachedCombatStat","fn","familiarId","clearCombatStatCache","explainPlayerCombatStat","explainParams","OfflineTickListener","OfflineTickListeners","WarpTimeListeners","WarpTimeListener","nextFrame","Promise","resolve","reject","requestAnimationFrame","registerTimeTickListener","priority","sortedListeners","idA","idB","gameSpeedTags","GameSpeed","processTimeTick","timeElapsedSec","isWarp","speedMultiplier","timeElapsedSecAfterTransform","WARP_TIME_PROCESSING_CONFIG_DEFAULT","secsPerTick","warpTimeProcessingConfig","_processOfflineTicks","_asyncToGenerator","initialState","secsTotal","setPlayerState","currentState","getListener","_processWarpTime","onLoadingProgress","secsProcessedSoFar","ticksProcessedSoFar","secsToProcess","getTotalSecondsPlayed","getSecondsPlayed","Actions","getVisibleActionsForAreaBySubcategory","area","actionsBySubcategory","actionsByAreaAndSubcategory","action","isVisible","HOME","SPELL_MENU","STUDY","TRANSMUTE","EXPLORATION","ENHANCEMENT","registerAction","getByIdNullable","register","areas","getAreas","subcategories","isAutoPurchaseUnlocked","AutoPurchaseUnlocked","getAutoPurchaseActions","canAutoPurchaseMax","Spells","registerSpell","spell","getVisibleSpellsByElement","spellsByElement","_spell$getAreas2","elementRequirements","getLevelRequirements","_element","getVisibleSpellsForElement","extraLevels","_getVisibleSpellsByEl2","_getVisibleSpellsByEl","fakeState","setLastCastedTime","getFavoriteSpells","_state$run$favoriteSp","_state$run$favoriteSp2","removeFromFavoriteSpells","isInFavoriteSpells","toggleEmpowered","empowered","isEmpowered","callSpellCacheListeners","spellCacheListeners","clearAutocastPointsCache","clearManaCostCache","clearCanCastSpellCache","CanCastSpell","clearSpellCooldownCache","SpellCooldown","clearAllSpellCaches","_loop2","startsWith","clearSpellDurationCache","registerEmpowerEffects","multiplier","registerStandardEmpowerEffects","actionEffectMultiplier","manaCostMultiplier","ActionEffect","registerBuffEmpowerEffects","effectMagnitudeMultiplier","TemporaryEffectMagnitude","translateResearcherAutoAssignStrategy","strategy","SPREAD_EVENLY","HIGHEST_AMOUNT","SPREAD_THEN_HIGHEST","decideOnAutoAssigning","elements","maxElement","maxElementResearchers","assignedResearchers","minElement","minElementResearchers","onTick","elapsedTimeSec","expPerSec","getResearcherExpPerSecForElements","_expPerSec","BASE_RESEARCH_EXP_PER_SEC_PER_RESEARCHER","expGainTagsCache","Study","researcherAllocation","totalExpPerSec","allocatedResearchers","researchRatePerResearcher","fromResearch","clearResearcherExpCache","expGainStudyTags","getBaseResearchRate","researcherAmountTags","ResearcherAmount","getTotalResearchers","getFreeResearchers","researchersAllocated","allocateResearchersToElementImpl","currentAllocation","actualAmountToAllocate","allocateResearchersToElement","isStudyUnlocked","StudyUnlocked","IncomeOverTimeProducer","displayName","calculator","IncomeOverTimeProducers","calculatedIncomeCached","producerId","getCalculator","clearCalculatedIncomeCache","calculatedIncomesCached","producer","income","getDisplayName","finalIncomeTags","FinalIncomePerSec","calculateIncomePerSecond","incomes","canApply","subResString","_income$income$subRes2","subResource","subResourceIncome","resString","_total$resource","_income$income$resour","_income$income","_income$income$resour2","_income$income2","existingIncome","_total","explainIncomePerSecText","explanations","foundNonzero","_income$income$subRes3","_total$resource2","_income$income$resour3","_income$income3","_income$income4","explainIncomePerSecondPreTransform","_total2","valuesText","postTransformationExplanation","appliedTotals","_income$income$subRes","_income$income$_subRe","_appliedTotals$_subRe2","_appliedTotals3","_appliedTotals4","_appliedTotals5","EquipmentSlot","POUCH_SIZE_TAGS","PouchSize","ACCESSORY_SIZE_TAGS","AccessorySize","getMaxEquippedItemsPerSlot","slot","canUnequipItem","getEquippedItems","canEquipItem","EquipmentChangeListeners","equipToSlot","position","skipSave","extraSlots","getExtraSlots","capacity","equippedItems","equippedExtraSlotItem","getEquippedExtraSlotItem","done","i","extraSlot","unequipFromSlotImpl","saveEquipmentLoadoutToPosition","getEquippedItem","_state$run$equipment","_state$run$equipment$","_state$run$equipment2","equipped","otherSlot","equippedItem","actualItem","doCleanup","getSlot","unequipFromSlot","getUnequipAction","gzipCompress","promisify","zlib","gzipDecompress","_loadData","jsonValue","AsyncStorage","makeCompatible","_saveData","lastSaveDataTime","parseFloat","saveDataUnsafe","_x2","_saveDataUnsafe","oldTemp","rule","strategies","currentStrategyIndex","isArray","loadout","deepmerge","loadBase64Data","_x3","_loadBase64Data","saveData","decodedBuffer","Buffer","decodedJSON","decodedData","serializeSaveData","_x4","_serializeSaveData","compressedJSON","getUICommands","addUICommand","command","requiredElectron","window","require","e","isElectron","electron","ACHIEVEMENTS_SUPPORTED","incrementAccumulatorVariable","variableName","_ref","_state$run$variables","_ref2","_state$world$variable","currentValue","worldValue","getAccumulatorVariable","_ref3","_state$run$variables2","getLastQueuedActionResult","getExplorationStatus","FamiliarStatusType","FamiliarCompanionStatusType","translateFamiliarCompanionStatusType","Preparing","Exploring","Reviving","Combat","getFamiliarData","_state$run$familiars","FamiliarDeletionListeners","getCurrentCompanionId","_getCurrentCompanionD","getCurrentCompanionData","find","familiarData","Companion","getCurrentCompanionClass","companionData","Familiars","familiarClassId","setFamiliarToExplore","dungeonFloorId","actionProgress","exploringDungeonFloorId","autoExploring","exploringNextRandomRoll","setFamiliarToAutoExplore","findMaxFloorForFamiliar","throttleTimestamps","throttleCounts","THROTTLE_THRESHOLD","pushToFamiliarMessageLog","log","_throttleTimestamps$f2","_throttleCounts$famil2","timestamp","timestampSec","throttleTimestamp","throttleCount","familiarMessageLog","messageLog","unshift","realTimestamp","message","slice","areFamiliarsUnlocked","FamiliarsUnlocked","getFloorsAvailableForFamiliars","dungeonFloor","canFightBoss","getBoss","isDungeonFloorValidForFamiliars","FamiliarExplorationDelay","calculateAverageEnemyLevelForFamiliars","isDangerousForFamiliar","getLevel","TemporaryEffects","TEMPORARY_EFFECT_DELTA","getLookupId","getTemporaryEffectEndTime","getTemporaryEffectEndTimeRaw","fullId","_state$run$temporaryE","endTime","hasTemporaryEffect","hasTemporaryEffectRaw","getTemporaryEffectData","includeEvenIfExpired","getTemporaryEffects","effectName","temporaryEffect","getTemporaryEffectsForTarget","temporaryEffectDurationTags","TemporaryEffectDurationPostProcessing","grantTemporaryEffectImpl","baseDurationSec","_extra$mode","_extra$target","_extra$params","mode","durationSec","effectExtra","newEndTime","temporaryEffectData","setTime","fromAutocast","fromPermacast","fromPouch","registeredClear","mergeData","temporaryEffectListeners","grantTemporaryEffect","clearTemporaryEffect","clearCombatTemporaryEffects","effect","isCombatOnly","getTemporaryEffectsForCommonBuff","isCommonBuffEnabled","registerTemporaryEffectListener","registerExpiration","TemporaryEffectExpirationListeners","registerTemporaryEffectCombatStatCacheClearer","DeathInterceptors","CombatActionResultListeners","pushCombatActionResult","combatActionResult","hasCurrentActiveCompanion","companionStatus","Enemies","getCurrentEnemy","lastSelectedEnemyAction","lastSelectedFamiliarAction","isExplorationUnlocked","ExplorationUnlocked","isExplorationEverUnlocked","startExplorationOnFloor","startExploration","startBossExploration","ExploringBoss","getExplorationStartTime","getCurrentDungeonFloor","_state$run$exploratio2","startCombatImpl","enemy","getMaxHP","onEncounter","getNextAction","companion","getNextActionForCompanion","startCombat","getCurrentPlayerHP","_state$run$exploratio6","getCurrentFamiliarHP","_getCurrentCompanionD2","currentHp","getCurrentEnemyHP","_state$run$exploratio7","_state$run$exploratio8","getCurrentEnemyHPFraction","_getCurrentEnemy$getM","_getCurrentEnemy","DAMAGE_INFLECTION","calculateDamage","attack","defense","damage","calculateIsHit","accuracyPoints","dodgePoints","hitOdds","modifyTargetCurrentHP","cause","modifyPlayerCurrentHP","modifyCompanionCurrentHP","modifyEnemyCurrentHP","_cause","_lastSelectedEnemyAct","currentCompanion","currentCompanionData","getStatsForCompanion","maxHP","triggerFamiliarDeath","executePlayerAutoAttack","standardPlayerAttackEffect","AutoAttack","getCurrentHPFromTarget","getStatFromTarget","familiar","toLowerCase","substring","getAttack","getAttackDelay","getDefense","getAccuracyPoints","getDodgePoints","getCriticalPoints","calculateAttackTarget","calculateIsEnemyHit","modifiedAccuracyPoints","forcedTarget","attackDamageReceivedByTargetTags","AttackDamageReceived","critResistanceByTargetTags","CriticalResistance","standardEnemyAttackEffect","_options$accuracyAddi","_options$accuracyMult","_options$forcedTarget","_options$tags","accuracyAddition","accuracyMultiplier","isHit","isCrit","_options$critChanceMu","critChance","critChanceMultiplier","critResistance","enemyAction","source","onHit","drainingEnemyAttackEffect","_options$accuracyMult4","_options$forcedTarget4","_options$tags4","_options$critChanceMu3","_options$tags3","_options$forcedTarget7","_options$overrideAccu","_options$accuracyMult7","_options$tags8","overrideAccuracy","_options$overrideCrit","_options$critChanceAd","_options$critChanceMu6","_options$targetDefens","critChancePoints","overrideCritChance","critChanceAddition","targetDefenseMultiplier","getCumulativeLosses","enemyId","_state$world$timesEne","_state$world$timesEne2","_state$world$timesEne3","losses","getSuccessfulExplorationsForFloor","_state$run$exploratio9","_state$run$exploratio10","pushToMessageLog","accessibleMessage","endExploration","ExplorationDelay","explorationDelayTags","getExplorationTimeRequirementSec","getExplorationRequiredTimeSecBase","getFamiliarAttackDelay","_state$run$exploratio11","currentFamiliar","delay","enemyAttackDelayTags","getEnemyAttackDelay","baseEnemyAttackDelay","actualEnemyAttackDelay","getEnemyTurnCounter","_getCombatVariable","enemyDeathListeners","addEnemyDeathListener","triggerCombatLoss","_state$run$exploratio12","isBoss","currentEnemyName","getName","fromEnemyMessage","_state$world$timesEne4","_state$world$timesEne5","player","incrementCumulativeLosses","onPlayerDeath","loadExploration","startExplorationOrAutoAdvance","_getCurrentDungeonFlo","getNextFloor","explorationTimeRequirement","nextExplorationTime","doFightBoss","outcome","doExplore","normal","attackDelayPlayer","attackDelayEnemy","attackDelayFamiliar","extraSec","newAttackDelay","executeFamiliarAction","executeEnemyAction","interceptor","onDeath","couldFightBoss","triggerEnemyDeathListeners","playerMaxHP","hpRegenBase","hpRegenMultiplier","BestiaryState","getCombatStatFromBattlerStat","battlerStat","getCumulativeEnemyKills","getCumulativeEnemyKillsFromCreatures","_state$world$timesEne6","getBestiaryVisibleEnemies","getBestiaryState","Hidden","enemyStatTags","KILLS_FOR_BESTIARY_LOOT","lootTags","isFromCreatures","FromFamiliarExploration","FromExploration","lootChanceTags","LootChance","_memoizedEnemyLootTags","enemyLootId","isFromFamiliars","LootItemAmount","_this2","getBaseStats","_this3","attackDelay","_this4","crit","_this5","_this6","accuracy","_this7","dodge","_this8","kills","Expanded","SpriteOnly","_state$world$timesEne7","_state$world$timesEne8","_this9","totalTimesDefeated","baseCoinsAwarded","getCoinsAwardedBase","baseMonstiumAwarded","getMonstiumAwardedBase","coinsAwarded","monstiumAwarded","familiarExpAwarded","familiarClass","oldLevel","newLevel","_throttleTimestamps$f","_throttleCounts$famil","wouldBeThrottledIfPushingToCreatureMessageLog","expAwarded","getItemsAwardedBase","enemyLoot","chance","_state$world$knownEne","foundLoot","achievementsUnlocked","unlockAchievement","achievement","achievementName","ipcRenderer","send","AchievementSyncListeners","registerAchievementUnlockerFromFlag","flagSet","registerAchievementUnlockerFromStoryline","getCompletedFlag","CombatClass","getCachedBaseClassEffects","getBaseClassEffects","tagsByEffect","getCurrentCombatClass","isCombatClassSelectionUnlocked","baseEffect","_this$tagsByEffect","_baseEffect$tags","ClassEffect","onlyId","baseEffects","finalEffects","getTagsByEffect","CombatClasses","CombatClassesStoryline","Storylines","getSortedStorylines","getTotalStorylineCount","storylineHintUnlockChecker","storylines","shouldRevealHint","revealHint","Endings","getEndingData","hasEverTriggeredEnding","ending","endingId","EndingCloseListeners","EmptyEventMessage","EmptyEventMessageImpl","EventTag","eventMessages","getEventMessageById","gameEvents","getGameEventById","getEventOccurrenceById","_state$run$eventOccur","executeEventOccurrenceActionImpl","occurrenceId","selectedOption","nextMessage","messageHistory","currentMessageId","isTerminal","timestampSecondsPlayed","jumpEventToMessageIfExists","eventId","messageId","eventOccurrence","addOccurrenceToQueueImpl","eventOccurrenceId","removeOccurrenceFromQueueImpl","lastIndexOf","triggerEventImpl","event","extraTags","totalTags","getTags","DO_NOT_AUTO_TRIGGER_IF_ONGOING","occurrenceData","STORYLINE","getMainEventMessage","everTriggered","hasEverTriggered","MAIN_QUEST","MAIN_QUEST_SEEN_BEFORE","currentMessage","getAllowedOptions","onTrigger","DO_NOT_POPUP","shouldPopUpEventWithTags","triggerEvent","STUB_OPTION","replaceWithParams","text","RegExp","isNaN","replacement","replace","EventMessageImpl","title","option","EventMessageBuilderDeluxe","isEnd","built","setDescription","_paramsOrNextMessageI","_paramsOrNextMessageI2","_paramsOrNextMessageI3","paramsOrNextMessageId","nextMessageId","SimpleGameEvent","onTriggerTransform","storylineIds","triggerString","_this$storylineIds","EventBuilder","messages","lastMessageId","builder","newMessageId","setSimpleDescription","buildRecursive","parseInt","createGameEvent","idToSearch","messageBuilder","_this$messages","getOptions","optionStub","_optionStub$descripti","_this2$messages","_this2$messages2","nextMessageIndex","findMessageIndexWithId","buildEvent","getDemoAboutText","fullGameLink","getMR1AboutText","AuxOptionsContext","compactLayout","useAuxOptions","useContext","Text","props","ariaLevel","h1","h2","h3","h4","style","useMemo","styles","_jsx","PaperText","maxFontSizeMultiplier","doNotScaleFonts","accessibilityRole","selectable","accessibilityLevel","StyleSheet","fontSize","Button","_props$ButtonComponen","disabled","autoRepressConfig","enableAutoRepress","labelStyle","passthroughStyle","disableDisabledRenderingOptimization","TextComponent","rest","_objectWithoutProperties","_excluded","pressed","useRef","disabledRef","currentRepressTimeout","currentRepressHandler","_useState","useState","_useState2","_slicedToArray","flash","setFlash","shouldDisableRenderingOptimization","ButtonComponent","useEffect","_autoRepressConfig$mi","timeoutHandler","setTimeout","minTimeMs","clearTimeout","rePress","useCallback","_autoRepressConfig$mi2","_autoRepressConfig$dr","onPress","dropoffMultiplier","onPressInCallback","_autoRepressConfig$st2","_autoRepressConfig$st","startingRepressTime","startingThreshold","onPressOutCallback","PaperButton","useTheme","auxOptions","basicLabelStyle","compact","labelLarge","verticalLabelStyle","compactLabel","styleFlash","opacity","computedLabelStyle","activeButton","onPressIn","onPressOut","disabledButton","View","children","_jsxs","display","marginVertical","icons","fire","earth","water","air","poison","mind","life","electric","death","holy","space","fireessence","earthessence","wateressence","airessence","poisonessence","mindessence","lifeessence","electricessence","deathessence","holyessence","timeessence","spaceessence","land","coins","mana","wizardpower","boost","hp","monstium","debuff","generic","timepiece","exchange","corruption","x","about","apprentices","boosts","compendium","creatures","enhance","help","home","research","retirement","rituals","spellcraft","stats","study","transmute","wizards","worlds","GameIcon","otherProps","imageSource","label","getPicture","getDefaultParams","computedStyle","width","height","small","Image","accessibilityLabel","Plugin","match","utils","Tooltip","markdownItInstance","MarkdownIt","typographer","use","MarkdownIconPlugin","containerClassName","MarkdownTooltipPlugin","markdownRules","paragraph","node","parent","markdownStyles","markdownParagraph","inheritedStyles","content","sourceMeta","default","imageStyleAndroidAttack","imageStyleAndroid","resizeMode","getUniqueID","ios","imageContainerStyleiOSAttack","imageContainerStyleiOS","imageStyleiOSAttack","imageStyleiOS","tooltip","tooltipTextContainer","underlined","Markdown","_props$children","_props$accessibilityL","_props$children2","_props$children2$repl","_props$accessibilityL2","containerStyle","_substring","replaceAll","accessibilityLiveRegion","fullStyle","body","justifyContent","minHeight","lineHeight","bullet_list_icon","marginTop","bullet_list","list_item","alignItems","heading2","accessible","containerView","LibraryMarkdown","markdownit","markdownTextgroup","flexDirection","flexWrap","padding","margin","top","marginLeft","marginRight","alignSelf","right","web","flex","textDecorationLine","flexRow","flexEnd","flexRowSpaceBetween","flexRowAlignCenter","flexCenter","alignSelfStretch","alignSelfNormal","ml4","ml8","ml16","mt2","mt4","mt8","mt16","mr4","mr8","mr16","mb4","marginBottom","mb8","mb16","mv2","mv4","mv8","mv16","pb4","paddingBottom","pb8","pb16","ph4","paddingHorizontal","ph8","ph16","pv4","paddingVertical","pv8","pv16","p4","p8","p16","bold","fontWeight","About","_getCurrentVersionTim","stateRef","versionText","versionNumber","versionString","versionNumberText","demoText","mr1text","container","explanation","explanationText","showDebug","Styles","Action","getCachedBaseActionEffects","getBaseActionEffects","memoizedActionEffectParam","memoizedActionEffectExplanationParam","effectId","cost","getCost","_cost$resources$resou","_cost$resources$resou2","items","_cost$resources$resou3","n","times","_cost$resources$resou4","_cost$resources","skipAffordabilityChecks","canAfford","RESOURCE_FOR_ELEMENT","_Action","_inherits","BoostActionBase","_super","_createSuper","call","_costScaleMonstium","CostScale","_costScaleEssence","essence","getElement","_get","_getPrototypeOf","prototype","Boost","bought","getBoughtBoostsAmount","fractionAddedPerUpgrade","essenceFractionAddedPerUpgrade","resourcesObject","getTotalBoughtBoosts","_cost$Monstium","_cost$RESOURCE_FOR_EL","isNotificationRead","_data$globalTimestamp","globalTimestampRead","globalTimestampTriggered","getNotificationByGroupAndItem","group","notification","getUnreadNotificationsByGroup","getNotificationsByGroup","triggerNotification","previousNotification","AutocastCondition","parameters","getParameters","validation","idx","_values$idx","validationResponse","parameterType","validate","AutocastConditions","_AutocastCondition","AlwaysAutocastCondition","AutocastConditionParameterDisplay","AutocastConditionParameterType","NumericAutocastConditionParameterType","_AutocastConditionPar","TEXT_FIELD","ResourceAutocastConditionParameterType","PICKER","hasEverHadResource","ResourceLessThanAutocastCondition","resourceIcon","ResourceLessThanAutocastConditionRatio","percent","ResourceMoreThanAutocastCondition","ResourceMoreThanAutocastConditionRatio","SmartlyAutocastCondition","isCastingRecommended","TemporaryEffectAutocastConditionParameterType","hasEverHadTemporaryEffect","TemporaryEffectLowTimeRemainingAutocastCondition","buff","temporaryEffectId","timeLeftSecs","TemporaryEffectPresentAutocastCondition","SpellAutocastCategory","translateSpellAutocastCategory","category","ATTACK","COMBAT_BUFF","GENERAL_BUFF","HEALING","TRANSMUTATION","productionTags","AutocastPointsProduction","productionUnit","getAutocastPointIncomePerSecPerWizard","wizardAmountTags","WizardAmount","getWizardAmount","wizardAmountUnit","getFreeWizards","usedWizards","getCurrentAutocastStrategy","_getAssignedWizardsBy","getAssignedWizardsByRuleIndex","getUsedWizards","grantAutocastPoints","ruleIdx","grantAutocastPointsToRule","spellId","ruleStatus","getAutocastStatusByRule","currentPoints","getAutocastPointsRequirement","assignWizardsToPermaCast","freeWizards","amountToAdd","permaCastWizardPowerNeeded","getPermaCastDelaySec","isSpellInPermaCast","assignWizardsToRuleIndex","assignWizardsToRule","wizardsAssigned","AssignedWizard","toggleAutocastRuleDisabled","toggleAutocastRuleHidden","hidden","getAutocastStatusByRuleIndex","_state$run$autocast$r","_state$run$autocast$r2","getAutocastRuleBySpell","getAutocastRuleById","ruleId","getConditionFromData","conditionData","condition","conditionIsMet","isConditionMet","isAutocastUnlocked","WizardsUnlocked","isAutocastEverUnlocked","estimateIntervalBetweenCastsForRule","minimumFrequency","getEstimatedMinAutocastDelay","timeToFull","estimateManaConsumptionPerSecPerRule","_spell$getCost$resour","estimateManaConsumptionPerSecPerRuleIndex","estimateExpGainPerSecPerRule","expGain","getExpFromUsage","intervalBetweenCasts","estimateIntervalBetweenCastsForRuleIndex","estimateManaConsumptionPerSecPermaCast","estimateManaConsumptionPerSecPermaCastUncached","getManaCost","getPermaCastManaCostPerSec","estimateWizardPowerConsumptionPerSecPermaCast","uncached","getPermaCastAutocastPointsConsumptionPerSec","clearAutocastCaches","clearPermacastCache","estimateWizardsNeededPermaCast","DEFAULT_CONDITIONS","calculatePermacastInfo","permaCastSpells","permaCastSpellRequiredWizardPower","permaCastSpellRequiredMana","sortedPermaCastSpells","loadAutocast","_getAssignedWizardsBy2","conditions","pointsRequired","doAction","isAutomatic","_ret","_calculatePermacastIn","availableWizardPower","maxMana","currentMana","manaCostToPay","wizardPowerToAssign","doActionPermaCast","_ret2","_calculatePermacastIn2","foundTheSpell","_loop3","currentRuleIdx","Enhancements","registerEnhancement","enhancement","isEnhancementUnlocked","EnhancementsUnlocked","loadEnhancementCommonLogic","shouldAutoPurchaseEnhancements","SpellCastListeners","getStandardRangeEffectText","average","variance","getStandardAttackEffectText","getStandardSpellAttackEffect","extras","effects","getActionEffects","getSpellName","getStandardSpellAttackEffectText","getActionEffectExplanations","_tagArray","_manaCostTags","parentSpell","_cooldownTagArray","_actionParams","_assertThisInitialized","canCastSpellTags","autocastPointsRequirementTags","AutocastPointsConsumption","getExtraTags","getManaCostUncached","getBaseManaCost","_state$run$lastSpellC","mainName","hasActiveSpellcrafts","lastCastTime","getLastCastTime","isInPermaCast","getBasicDisplayName","secTillOver","getCooldown","spellName","isSpellInWizards","spellcraftId","getBaseCooldown","_this$getCachedBaseAc","_this$getCachedBaseAc2","_this$getCachedBaseAc3","getBaseAutocastPointsRequirement","_this3$getCost$resour","_this3$getCost$resour2","_exp$element","_exp$element2","expMin","expMax","doSpellAction","grantExpFromUsage","payCost","recentSpellName","addRecentSpellCast","isCastingRecommendedTemporaryEffect","getActionEffect","isEmpowerable","getEmpoweringLevelRequirements","_state$run$empoweredS","TransmutationSpell","_Spell","tagsForResource","getItem","getCraftingElementLevelRequirements","ItemCost","tagsForItem","ItemCostItem","tagsForQuality","ItemQuality","tagsForCreation","ItemAmountTransmuted","itemName","getBaseName","getCraftingMaterials","getCraftingMaterialsBase","_base$resources","baseAmount","_base$items$item","_this$getItem$getDesc","getDescription","generateCraftedParams","_this$getItem$getEffe","getEffect","materials","_materials$resources","hasCraftingMaterials","isTransmutationUnlocked","getBaseSalePrice","craftN","automated","canCraft","amountToCraft","calculateAmountPerCraft","simplifyCrafting","expGranted","timesCraftable","amountNeeded","amountInInventory","getTransmutationSpellForItem","amountRequired","amountPerCraft","timesToCraft","resourceThresholds","itemThresholds","TransmutationUnlocked","transmutationSpellsByItem","registerTransmutationSpellAndItem","getVisibleTransmutationSpells","isCraftingUnlocked","getAllTransmutationSpellsEverCastable","hypotheticalState","_state$world$maxEleme","_state$world$maxEleme2","TemporaryEffect","getDisplayDescription","isBeneficial","oldData","newData","currentEndTime","extraDuration","ritualWeakness","_TemporaryEffect","RitualWeakness","Rituals","CORRUPTION_CAP_TAGS","CorruptionCap","getCorruptionCap","CORRUPTION_TAGS","Corruption","Accumulation","getCorruption","CORRUPTION_HP_PENALTY_BASE","CORRUPTION_HP_PENALTY_PER_CORRUPTION","CORRUPTION_HP_PENALTY_OVER_CAP","isCorruptionHPPenaltyActive","getCorruptionHPPenaltyMultiplier","CORRUPTION_EXP_PENALTY_BASE","CORRUPTION_EXP_PENALTY_PER_CORRUPTION","CORRUPTION_EXP_PENALTY_OVER_CAP","isCorruptionExpPenaltyActive","getCorruptionExpPenaltyMultiplier","CORRUPTION_TRANSMUTE_PENALTY_BASE","CORRUPTION_TRANSMUTE_PENALTY_PER_CORRUPTION","CORRUPTION_TRANSMUTE_PENALTY_OVER_CAP","isCorruptionTransmutePenaltyActive","getCorruptionTransmutePenaltyMultiplier","getVisibleRituals","RitualsUnlocked","ritual","PARTIALLY_UNLOCKED_STORAGE_MULTIPLIER","PARTIALLY_UNLOCKED_CHANNELING_MULTIPLIER","LEVELS_PER_RANK","EXPONENTIAL_BONUS_PER_RANK","getRankMultiplier","baseLevel","currentLevel","rankDifference","getRankDifference","getConcatenatedRequirements","formatRequirements","getMarkdownTextForSpell","getMarkdownTextForSpellEmpowerment","getMarkdownTextForTransmutationSpell","itemIcon","LevelUpListeners","loadLevelUpEvents","_element2","eventBuilder","LEVEL_UP","build","_state$run$lastComput","lessExpState","oldSpells","newSpells","levelUpLearnedSpells","diffSpells","newSpellText","extraSpellText","extraSpells","newSpellsLearnedText","getLevelUpLearnedSpellsText","oldTransmutations","newTransmutations","levelUpLearnedTransmutations","_spell$getLevelRequir","_spell$getLevelRequir2","newSpellsText","extraSpellsText","getLevelUpLearnedTransmutationsForElement","levelUpLearnedEmpowers","getLevelUpLearnedEmpoweredSpellsText","isEmpoweringPossible","levelUpLearnedRituals","oldRituals","newRituals","diffRituals","newRitualText","extraRitualText","extraRituals","newRitualsLearnedText","getLevelUpLearnedRitualsText","rankText","LEVEL_UP_EMPTY","LEVEL_UP_ALREADY_REACHED","levelUpLearnedCrafts","_state$run$lastComput2","getAllKnownItemCompendiumInfos","info","transmuteSpell","knownLootFromEnemies","transmutationSpell","transmutationSpellsEverCastable","enemyInfo","lootChance","getItemCompendiumInfoForItem","clearItemCompendiumInfoCache","generateEffect","generateSpellcraftMultiplier","baseValue","transformedValue","Spellcraft","getCachedBaseBonusEffects","getBaseWizardPowerMultiplier","wizardPower","getBasePowerMultiplier","power","getBaseCooldownMultiplier","cooldown","getBaseTemporaryEffectDurationMultiplier","temporaryEffectDuration","getBaseManaCostMultiplier","manaCost","bonusEffectExplanationParams","getBaseItem","getDefaultName","SpellcraftEffect","requiresSpellsWithFixedManaCost","hasFixedManaCost","requiresSpellsWithParameterizedEffects","_effect$tags","ActionMagnitude","_effect$tags2","_effect$tags3","requiresSpellsWithCooldown","requiresSpellsWithTemporaryEffect","_effect$tags4","TemporaryEffectDuration","getBonusEffects","effectExplanations","getBonusEffectExplanations","bonusString","getBonusEffect","Spellcrafts","_Spellcraft2","PrismBasedSpellcraft","_Spellcraft3","JewelBasedSpellcraft","_super2","MAX_VATS_PER_SPELL","getSpellcraftVatsForSpell","getVisibleSpellcraftsForSpell","getVisibleSpellcrafts","isSpellCompatible","canApplySpellcraftToSpell","allVats","vats","vat","transmutation","canLoadMultipleVats","removeSpellcraftFromVat","vatId","createNewVat","newId","isSpellcraftUnlocked","SpellcraftUnlocked","SynchroBonuses","SYNCHRO_ROWS","SYNCHRO_COLS","SYNCHRO_GRID_AMOUNT","isSynchroUnlocked","SynchroUnlocked","getCurrentSynchroStrategy","getSynchroPosition","y","_strategy","_strategy$grid$y","SynchroChangeListeners","getCurrentSynchroBonuses","element1","element2","offsetsToCheck","bonusCount","offsets","getTotalOccurrencesInSynchroGrid","_current$grid$x","_current$grid","_current$grid2","_current$grid2$x","calculateMaxOccurrencesInSynchroGrid","SynchroGridMax","findSynchroBonusForElements","bonus","getElement1","getElement2","hasNegativeSynchroBonusOnTile","currentElement","otherElement","disabledColorByThemeMemoized","disabledColor","_color","_color2","string","elementColorByTheme","getPrimaryButtonTextColor","DescriptionViewer","EffectViewer","effectText","getAllSections","scrollable","hideBottomResourceBar","scrollView","keepInMemory","hotkey","isBadged","_calculateIncomePerSe","_calculateIncomePerSe2","BoostingMachine","isBoostingUnlocked","areRitualsUnlocked","fullScreen","isBestiaryUnlocked","DEFAULT_SECTION_ORDER","sectionData","getAllMenuItems","section","getSectionInfo","sectionInfo","MAX_OPEN_TABS","useLayoutType","_useWindowDimensions","useWindowDimensions","getLayoutType","_state$options","_state$options2","wideLayout","showMenu","showSpellMenu","showEventsMenu","activeContentTabs","TooltipContext","containerWidth","EMPTY_TOOLTIP_CONTEXT","TooltipControlContext","setTooltip","clearTooltip","onMouseLeave","onMouseEnter","measurementId","onUnmountTooltip","VisibilityContext","TooltipDisplay","tooltipContext","windowDimensions","layout","_tooltipContext$posit","_tooltipContext$posit2","_tooltipContext$posit3","_tooltipContext$posit4","_tooltipContext$posit5","_tooltipContext$posit6","_tooltipContext$posit7","_tooltipContext$posit8","zIndex","left","bottom","minWidth","pointerEvents","backgroundColor","borderRadius","borderWidth","borderColor","maxWidth","TooltipPositionType","TooltipWrapper","_props$tooltipPositio","tooltipPositionType","tooltipPosition","visible","screenDimensions","wrapperRef","measureAndSetTooltip","_wrapperRef$current","measure","pageX","pageY","tooltipId","RIGHT_OF_ELEMENT","LEFT_OF_ELEMENT","onMouseOver","onMouseOut","ref","tooltipWrapper","ItemTile","lastTapTime","setLastTapTime","overriddenThemePrimary","overriddenThemeSecondary","inner","_props$borderColor","tile","quality","Badge","tooltipIdSuffix","TouchableOpacity","currentTapTime","onDoublePress","prevProps","nextProps","Buildings","STARTING_LAND","landCapTags","Land","getTotalLand","clearLandCache","getUsedLand","totalLand","building","getLandRequired","getBuildingAmount","getFreeLand","_state$run$buildings","_state$run$buildings$","getBuildingAmountTurnedOn","_state$run$buildings2","_state$run$buildings3","turnedOn","changeBuildingsTurnedOn","_state$run$buildings4","BuildingAmountListeners","Building","landTags","LandCost","baseLandRequired","getBaseLandRequired","BuildingSpell","costTags","costScaleTags","buildingName","getBuilding","canTurnOff","buildingAmountTurnedOn","buildingAmount","getResourceCost","currentAmount","baseCost","getBaseResourceCost","scale","getBaseResourceScale","finalCost","baseCostForKey","costScaleForKey","getDisplayEffect","landRequirement","freeLand","_state$world$maxFurni","_state$world$maxFurni2","buildingData","shouldNeverHaveDemolishBlockers","blockerBuildings","_demolishUnsafe","shouldNotCountForDemolishBlockers","resourceCost","getDemolishBlockers","amountToDemolish","canDemolish","CheckBox","Switch","checked","onValueChange","ResourceRowMemo","row","inlineRow","itemOrResource","switch","costValue","CostViewer","rows","resourceCap","resourceInfo","itemRows","_props$items","itemCost","notMet","IconButton","_props$disabled","PaperIconButton","iconColor","containerColor","PlusMinusAllocator","disableMinus","disablePlus","onPressMinus","onPressPlus","minusButton","plusMinusAllocatorButton","size","plusButton","marginHorizontal","plusMinusAllocatorButtonInner","plusMinusAllocatorIcon","SpellWizardsInfo","manaCostPerSec","helperText","wizardsAssignedComponent","newRule","strategyRule","allocator","GameStartupListeners","useExpandedUIFromContext","defaultValue","_state$options$expand","stateValue","setStateValue","ActionContainer","_state$run$autoPurcha","isFree","buildingAmountOn","capIsEnough","isCapEnough","_useExpandedUIFromCon","_useExpandedUIFromCon2","expanded","setExpanded","descriptionContainer","descriptionContents","descriptionTextContainer","landContainer","costContainer","CostRow","turnOffContainer","amountActiveText","turnOnRow","turnOnQuantityContainer","plusMinusContainer","demolish","demolishBlockers","demolishContainer","shouldHideDemolish","canSpam","furnitureList","blocker","canAutoPurchase","isAutoPurchaseEnabled","autoPurchaseEnabledToggle","_state$run$autoPurcha2","autoPurchaseContainer","preConfirmation","setPreConfirmation","onPressCallback","requireConfirmation","isAutoPurchasing","onPressExpand","button","buttonContainer","actionName","autoPurchase","showWizards","actionContainer","buttonRowContainer","buttonContainerView","TouchableWithoutFeedback","expandContainer","Entypo","split","quickbarButtonContainer","cursor","buttonTitle","textAlign","android","fontFamily","smallButtonTitle","buttonContainerSmall","capTooLowText","spellButtonTitleContainer","spellButtonTitleOnlyContainer","spellButtonCostContainer","spellManaIcon","Divider","PaperDivider","GameStateFreezer","Provider","ThemeProvider","CategoryContainer","_props$initiallyExpan","initiallyExpanded","isExpanded","setExpandedCallback","titleStyle","categoryTitle","contentContainerStyle","dividerStyle","categoryDivider","dividerColor","header","categoryHeaderExpand","paddingTop","categoryHeader","ActionSubcategoryContainer","_actionsBySubcategory","actions","actionNamesStr","actionContainers","underCategoryPadding","ActionsContainer","actionCategories","_createElement","Boosts","bonusText","_getVisibleActionsFor","_getVisibleActionsFor2","visibleBoost","getTotalBoostDescription","getBoostsBonusText","playerHasBoosts","hasBoosts","campusContainer","sanitizeImageSourceForElectron","EnemySpriteTile","LinearGradientComponent","LinearGradient","sprite","backdropColor","gradient","image","getTooltipXPosition","childrenX","childrenWidth","tooltipWidth","center","overflowLeft","Dimensions","overflowRight","getTooltipYPosition","_ref4","childrenY","childrenHeight","tooltipHeight","overflowBottom","getTooltipPosition","_ref5","measured","fullView","pressContainer","textInvisible","hitSlop","_React$useState","_React$useState2","setVisible","_React$useState3","_React$useState4","measurement","setMeasurement","showTooltipTimer","hideTooltipTimer","childrenWrapperRef","touched","isWeb","subscription","Module","_Module$addEventListe","eventName","handler","removed","addEventListener","remove","removeEventListener","handleTouchStart","handleTouchEnd","hide","mobilePressProps","webPressProps","onHoverIn","onHoverOut","isTextVisible","innerSurface","Surface","onLayout","nativeEvent","_x","_y","testID","_Fragment","Portal","Pressable","CombatStatsRowMemo","hideText","valueMax","PlayerCombatStatsViewer","maxHPUnit","attackUnit","attackDelayUnit","defenseUnit","accuracyUnit","dodgeUnit","critChanceUnit","combatStatsDisplayObject","maxHPExplanation","attackExplanation","attackDelayExplanation","defenseExplanation","accuracyExplanation","dodgeExplanation","critExplanation","CombatStatsViewer","showCurrentHP","combatStats","EnemyCombatStatsViewer","hpRegen","obfuscateValues","BestiaryEnemyContents","unlockedFloors","bestiaryState","foundInDungeons","getExplorationPossibilities","possibility","_possibility$transfor","_possibilities$find$w","_possibilities$find","possibilities","getBaseExplorationPossibilities","weight","_possibility$transfor2","totalWeight","getFloorName","dungeonFloorName","showDrops","dropsText","loot","_loot$params","lootChancePct","v","cumulativeKills","cumulativeLosses","generalText1","generalText2","showEnemyStats","showTip","getTips","tips","contentContainer","column","categoryContents","BestiaryEnemyContainer","helpContainer","accessibilityHint","topRowContainer","topContainer","enemyName","bossText","collapsed","descriptionViewer","disabledStorylineText","BestiaryContainer","expandedEnemyId","setExpandedEnemyId","setEnemyCallback","allEnemies","enemyString","enemyContainers","enemyContainer","Bestiary","bestiaryContainer","headerContainer","valueText","valueTextLong","captionText","ItemTagEnum","QuickbarItem","occurrence","isActive","Consumable","getCooldownLeftSec","amountText","cooldownText","_this$getItem$getPrim","getPrimaryAction","_this$getItem$getPrim2","doActionMemoized","mem","QuickbarActionImpl","getAction","getCurrentQuickbar","_state$world$quickbar","addToQuickbar","isInQuickbar","isQuickbarFull","removeFromQuickbar","stringifiedData","translateItemTag","Material","Equipment","QuestItem","saleActionOne","salePrice","saleActionMany","isAll","totalAmount","requireConfirm","quickbarAction","enabled","addItemToQuickbar","getAmountNeededForCombining","ItemsNeededForCombining","combineActionOne","_params$itemQuality","_params$itemQuality2","combineActionMany","_params$itemQuality3","_params$itemQuality4","INITIAL_MAX_ITEM_QUALITY","MAX_ITEM_QUALITY_TAGS","ItemQualityMax","Item","getCachedBaseItemEffects","getBaseItemEffects","_tags","_itemOccurrenceCache","getMemoizedItemOccurrence","explanationParams","itemTag","ItemEffect","neutralValue","basePrice","ItemSalePrice","getTransformationTags","_params","getSalePrice","remainingCoinCap","canSellLess","_params$itemQuality5","extraActions","isItemQualityValid","getMaxItemQuality","amountOfItem","neededItemsToCombine","previousValue","_params$params$itemQu","_params$params","_params$params$itemQu2","_params$params2","bonusFn","memoizedEquip","EquippableItem","_Item","attackTags","defenseTags","maxHPTags","manaRegenTags","maxManaTags","PerItemCap","attackDelayTags","accuracyTags","dodgeTags","critTags","getItemEffects","bonuses","getAttackBonusBase","getDefenseBonusBase","getMaxHPBonusBase","manaRegen","getManaRegenBonusBase","getMaxManaBonusBase","getAttackDelayBonusRatioBase","getPlayerAccuracyBonusBase","getPlayerDodgeBonusBase","getPlayerCritChanceBonusBase","getBaseExtraItemEffects","getEffectBase","_effects$attack","_effects$defense","_effects$maxHP","_effects$manaRegen","_effects$maxMana","_effects$attackDelay","_effects$accuracy","_effects$dodge","_effects$crit","getItemEffectExplanations","bonusStrings","prefix","statIcon","bonusEffect","getEffectExtra","forEachEquippedItem","each","equippedItemHand","equippedItemBody","equippedItemAccessory","additiveTransform","totalIncome","_totalIncome$Resource","getItemEffect","totalMultiplier","capBonus","maxManaBonus","memoizedPrimary","active","refreshedAction","getPouchItemAction","getUsesPerCombat","doPouchItemEffect","PouchItem","_EquippableItem","getUsesPerCombatTags","PouchItemUses","isStunned","hasUsedUpPouchItemThisCombat","getUsesPerCombatBase","ItemTags","tagRow","tagStyle","tagTextStyle","ItemInfo","_props$itemStack$item","usesPerCombat","usesPerCombatExplanation","getUsesPerCombatExplanation","itemDetailsContainer","main","showTile","TransmuteSpellInfo","totalOwnedText","isCraftable","concatenatedRequirements","cannotCastText","getMainExp","expGainText","costTextContainer","actionRow","cannotCraftText","TransmuteSpellDetails","canTransmute","maxCraftAmount","transmuteCallback","transmuteMaxCallback","craftMax","transmuteIntermediateCallback","craftIntermediate","transmuteMaxVisible","transmuteIntermediateVisible","isCraftIntermediatePotentiallyPossible","transmuteIntermediateEnabled","isCraftIntermediatePossible","craftingDetailsContainer","gap","actionButtonContainer","inventoryFullContainer","fontStyle","SpellcraftInfo","SpellcraftDetails","assignCallback","assignSpellcraftToVat","isAlreadyAssigned","hasError","ItemGridElementUsage","ItemGridTooltip","location","COMPENDIUM","itemGridElement","itemOrSpellId","SPELLCRAFT","ItemGridTile","accessibilityMarker","accessibilityHidden","accessibilityElementsHidden","disableTooltip","_itemGridElement$para","ItemGrid","estimatedMaxHeight","topContainerStyle","scrollViewStyle","overrideMaxHeight","maxHeight","insideContainerStyle","gridContainer","ScrollView","nestedScrollEnabled","onPressItem","onDoublePressItem","DropDownIcon","MaterialIcons","Picker","selectedValue","RNPicker","inputAndroidContainer","paddingRight","inputAndroid","iconContainer","viewContainer","placeholder","disablePlaceholder","fixAndroidTouchableBug","Icon","useNativeAndroidPickerStyle","dropdownIconColor","dropdownIconRippleColor","textInputProps","maxLength","UIContext","getUIState","setUIState","useUIStateFromContext","context","initialValue","_context$getUIState","ITEM_TAG_ORDER","Transmute","uiContext","selectedElement","setSelectedElement","_useUIStateFromContex","_useUIStateFromContex2","selectedTag","setSelectedTag","currentElementLevels","castableSpells","DeepCavernsUnlocked","LostForestUnlocked","tagSet","add","from","tagButtons","UtilityPicker","picker","sortedCastableSpells","firstTagA","firstTagB","_useUIStateFromContex3","_useUIStateFromContex4","hideLocked","setHideLocked","toggleLockedCallback","_useState3","_useState4","filterText","setFilterText","_useState5","_useState6","filterTextTemp","setFilterTextTemp","timeout","itemGridElements","itemGridElementsJSON","isAnyLocked","itemGridElementsFiltered","itemGridElementsFilteredJSON","selectedSpell","itemGrid","details","detailsContainer","clearFilter","tagPickerContainer","checkboxContainer","TextInput","dense","onChangeText","buttonGroupContainer","buttonGroupButtonContainer","checkboxText","ItemCompendiumDetails","howToObtainStrings","lootInfo","howToObtainText","howToObtain","howToObtainComponent","ItemCompendium","visibleItemInfos","sortedItemInfos","itemInfo","selectedItemInfo","Compendium","selectedTab","setSelectedTab","buttons","buttonSelectors","SegmentedButtons","soundMap","menuClick","AudioManager","sampleMap","_load","Audio","all","audioId","audioSample","audioSound","loadAsync","replayAsync","cleanup","oldEventOccurrenceIds","randomEvents","registerRandomEventTrigger","eligible","getParams","PITY_COUNTER_THRESHOLD","PITY_COUNTER_SECOND_THRESHOLD","PITY_COUNTER_VARIANCE","PITY_MULTIPLIER","PITY_MAX_PER_RUN","registerPity","nextPitySec","randomEventWeightTags","RandomEventWeight","triggerRandomEvent","eventsThatApply","randomEvent","sumToNow","eventRoll","getStorylines","debugRandomEvents","chancesPerEvent","loadRandomEventTriggers","_state$run$pityEnable","isInPity","elapsedSec","secsPlayed","periodMultiplier","SAVE_TO_FILE_SUPPORTED","LOAD_FROM_FILE_SUPPORTED","_loadSaveFromFile","_yield$window$showOpe","showOpenFilePicker","fileHandle","file","getFile","resultContents","unserialized","_loadTranslationsFromFile","_yield$window$showOpe3","saveToFile","_saveToFile","serializedData","openURL","Debug","events","selectedEvent","setSelectedEvent","eventButtons","selectedStoryline","setSelectedStoryline","pickerStoryline","storylineButtons","complete","activateBonus","newPlayerContextState","setNewPlayerContextState","_useState7","_useState8","fixingPlayerContextState","setFixingPlayerContextState","overridePlayerContext","deserializedJSON","_oldState","_useState9","_useState10","transformDebugInput","setTransformDebugInput","_useState11","_useState12","transformDebugOutput","setTransformDebugOutput","calculate","debugOutput","playSoundCallback","getDocumentAsync","FileSystem","readAsStringAsync","uri","console","warn","I18nManager","Card","onSubmitEditing","multiline","contentStyle","Challenges","getCurrentChallenge","getVisibleChallenges","ChallengesUnlocked","areChallengesUnlocked","challenge","Row","rowCaption","numberOfLines","caption","EndingDataViewer","_CombatClasses$getByI","_CombatClasses$getByI2","_Challenges$getByIdNu","_endingData$totalReti","_endingData$totalReti2","endingData","totalDuration","moment","totalTimePlayed","thisWorldDuration","totalTimePlayedThisWorld","thisRunDuration","totalTimePlayedThisRun","totalActiveDuration","totalActiveTimePlayed","totalActiveDurationThisWorld","totalActiveTimePlayedThisWorld","totalActiveDurationThisRun","totalActiveTimePlayedThisRun","thisRunTimePieces","timePiecesConsumedThisRun","thisWorldTimePieces","timePiecesConsumedThisWorld","totalTimePieces","totalRealDuration","totalRealWorldTimePlayed","totalRealDurationThisWorld","totalRealWorldTimePlayedThisWorld","totalRealDurationThisRun","totalRealWorldTimePlayedThisRun","combatClassText","primaryElementText","primaryElementLevelsText","primaryElementLevel","primaryElementLevelOnEnding","secondaryElementLevel","secondaryElementLevelOnEnding","challengeText","challengeId","worldsCreated","isNewGamePlus","showWorldStats","worldModifiers","sheerPower","storylineOracle","blazingSpeed","worldDifficulty","storylineCount","format","totalRetirements","mpl","productionMultiplier","completedStorylines","totalStorylines","Ending","_props$overrideEnding","overrideEnding","dividerContainer","congratsContainer","close","ObtainedEnhancementsView","_alreadyObtainedEnhan","alreadyObtainedEnhancements","purchasedEnhancements","isPurchased","sortedEnhancements","_enhancement$getAreas","subareas","subarea","getAllPurchasedEnhancements","enhancementName","enhancementEffect","EnhancementConfigView","autoPurchaseCallback","Enhance","purchasedComponent","showAutoPurchase","Ritual","_costTags","PerRitualCost","getCachedBaseRitualEffects","getBaseRitualEffects","ritualEffectParams","ritualEffectExplanationParams","baseName","ritualName","getBaseCorruptionCost","ritualId","getDeathLevelRequirement","_state$run$activeRitu","RitualEffect","necromancyRitual","_Ritual","NecromancyRitual","attackMagnitude","regenMagnitude","getRitualEffects","getRitualEffectExplanations","attackMultiplier","regenMultiplier","regenExplanation","AccessibilityContext","announceForAccessibility","isRTL","ProgressBar","_theme$colors","indeterminate","_ref$progress","progress","_ref$visible","animatedValue","timer","Animated","passedAnimatedValue","setWidth","prevWidth","setPrevWidth","indeterminateAnimation","animation","startAnimation","toValue","useNativeDriver","isInteraction","setValue","start","stopAnimation","stop","tintColor","trackTintColor","isV3","setColor","alpha","rgb","progressBar","translateX","interpolate","inputRange","outputRange","scaleX","accessibilityState","busy","accessibilityValue","overflow","EnemyActionDisplay","currentEventOccurrenceId","currentEnemyAction","_state$run$exploratio4","getEnemyActionProgress","accessibilityContext","progressBarContainer","markdownContainer","idleTextContainer","CombatActionResultDisplay","_props$action","_props$action2","_useMemo","auxText","auxTextStyle","auxTextCritical","auxTextDamage","auxTextHealing","_useMemo2","damageAnim","opacityAnim","bounciness","auxTextContainer","translateY","RNText","HPBar","mountTime","actionTarget","actionKeys","actionResults","lastTime","displays","actionIdx","bar","progressBarText","empty","overlaidText","shortcut","EnemyHPBar","inCombat","ActiveMark","_props$themeOverride","themeOverride","activeMark","SpellElementTag","spellElement","elementTextContainer","dark","spellElementBadgeText","SpellNameText","SpellViewButtonContents","_spell$getCost","_spell$getCost$resour2","buttonTitleStyles","spellDisplayName","spellCost","spellButtonTitleTitleOnlyContainer","SpellViewMemoized","showAddToQuickbar","displayDescription","displayEffect","_cacheByArbitraryVers","_cacheByArbitraryVers2","elementText","elementContainer","mainExp","expText","cooldownContainer","toggleFavorite","addFavoriteSpell","favoritesButton","Ionicons","elementTheme","buttonOnPress","buttonContents","isMinimal","tooltipExtra","buttonLabelStyle","buttonContentStyle","addToQuickbarButton","addActionToQuickbar","calculatePermaCastStuff","isPermaCastAllowed","PermaCastUnlocked","permaCastManaCost","permaCastDelay","permaCastWizardPowerNeededForSpell","permaCastWizardsNeededForSpell","wizardPowerProductionPerWizard","wizardPowerNeeded","permaCastWizardsNeeded","hasEnoughMaxManaForPermacast","permaCastButton","totalWizardsNeededBefore","currentWizards","totalWizardsNeededAfter","removeSpellFromPermaCast","totalWizardsNeeded","addSpellToPermaCast","empowerButton","extraActionsRow","permaCastParams","sec","wizText","wiz","permaCastText","empowerText","extrasText","extrasExplanation","toggleCollapsed","descriptionRow","SpellView","disabledActionText","DragHandle","importantForAccessibility","dragHandle","drag","FavoriteSpellsContainerInside","renderItem","ScaleDecorator","deleteButton","keyExtractor","categoryContainer","DraggableFlatList","onDragEnd","FavoriteSpellsContainer","deleteButtonInner","SpellElementSelectorItem","_props","selected","themeForElement","_props$dividerColor","itemContainerStyle","SpellElementSelector","SpellsContainerInside","_elements$","currentElementKey","uiKey","setCurrentElement","expandedSpells","setExpandedSpells","expandedSpellsRef","currentElementSpells","_expandedSpellsRef$cu","boundToggleCollapsed","spellActionContainers","spellArray","spellElementPicker","currentElementSpellsString","hasAllSpellsExpanded","_expandedSpells$spell","expandCollapseAll","expandedSomething","hideTitle","emptyTitleContainer","SimpleLineIcons","magicWand","onlyBySchool","schoolRowContainer","schoolContainer","noSpellsContainer","noSpellsText","SpellsContainer","hideRecent","spellsContainer","schoolButton","schoolTitleContainer","titleContainer","schoolTitleTextContainer","nuxText","KeyboardListener","callback","EquippedPouchSlot","useAction","usesLeft","_state$run$exploratio3","uses","getUsesLeftForPouchItem","_equippedItem$params","ExplorationPouch","slotComponents","autoUsePouchToggle","HITSLOP","TemporaryEffectRowMemo","viewStyle","boostText","TemporaryEffectsViewer","_props$target","maxElements","temporaryEffectObject","timeLeftSec","skipPermacast","temporaryEffectName","familiarPrefix","getIcon","andMoreComponent","notShownElements","accessibilityHeader","QuickbarIndexSelector","disableBackArrow","disableForwardArrow","slotNumber","goBack","goForward","backButton","quickbarSelectorButton","forwardButton","barText","QuickbarActionContainer","getTransform","toQuickbarData","QuickbarContainer","quickbarData","getQuickbarActions","_getIndex","getIndex","quickbarKeypressCallback","ev","ctrlKey","mainContainer","actionsContainer","actionsScroll","emptyText","infoContainer","mainButton","EquipmentSetButtons","setNumber","equipmentSetButtonCallback","_state$run$equipmentL","_state$run$equipmentL2","_equipment$slot","currentItemOccurrence","loadEquipmentLoadoutFromPosition","equipmentSetButtons","equipmentSet","_equipmentSet$equipme","_equipmentSet$equipme2","emptyIcon","setButton","number","iconsContainer","equipmentSetButtonsRow","setText","SynchroGridSmallDisplay","_state$world$synchro$","gridIndex","j","currentRow","saturate","borderLeftWidth","borderTopWidth","borderRightWidth","borderBottomWidth","SynchroGridSelector","setCurrentSynchroGrid","SynchroGridSelectors","memo","selectors","AutocastLoadoutLoadContainer","_state$global$autocas","loadoutObjects","loadPosition","strategyToLoad","oldStrategy","oldRuleStatuses","permaCastWizards","_oldRuleStatuses$oldR","_oldRuleStatuses$oldR2","oldRule","oldRuleId","_oldRuleStatuses$oldR3","_oldRuleStatuses$oldR4","oldRuleProgress","newStatus","loadAutocastStrategy","loadoutsLoadRow","loadTextContainer","loadoutObject","loadButton","noLoadoutsText","StrategyContainer","_state$global$autocas2","_state$global$autocas3","lastLoadoutUsed","autoNextFloorCallback","autoBossCallback","fullyHealedCallback","equipmentContainer","autocastContainer","lastLoadedContainer","ExplorationBottomComponent","openedTab","setOpenedTab","useSafeAreaInsets","isPaused","onPause","onKeyboard","shiftKey","mainComponent","mainScrollView","containerHeight","quickbarScrollView","tabsContainer","tab","borderTopLeftRadius","borderTopRightRadius","ExplorationProgressDisplay","FamiliarActionDisplay","currentFamiliarAction","ready","_state$run$exploratio5","getFamiliarActionProgress","ActivityIndicator","FamiliarHPBar","_getCurrentCompanionC","_getCurrentCompanionC2","FamiliarSpriteTile","showUndead","showDead","PlayerActionDisplay","getPlayerActionProgress","PlayerHPBar","PlayerMessageLog","getMessageLog","logItem","_logItem$accessibleMe","ResourceItemMemo","isCapped","textStyle","BottomResourceViewer","filteredResourceKeys","ExplorationRow","isBossUnlocked","isFloorCompleted","noneRow","noneFloorText","noneStatusRow","noneIcon","_floor$getNextFloor","ExplorationDungeon","ExplorationNone","allDungeons","noneContent","topRow","ExplorationMain","_dungeonFloor$getNext","_uiContext$getUIState","dungeonTitle","currentEnemySprite","toUnlockBoss","getExplorationSuccessesForBoss","checkmark","hasBoss","canMoveToNextFloor","fightingBoss","isExplorationPaused","togglePauseExploration","resumeExploration","pauseExploration","pauseExplorationButton","explorationStatusContainer","centerContent","persistentScrollbar","hasCompanion","hasCurrentCompanion","currentCompanionSprite","isCompanionReady","flipCompanionRow","getBackdropColor","currentExplorationBottomTab","lastAnnounced","setLastAnnounced","hasFamiliar","isCompanionUndead","shouldShowGrayscaleFamiliar","buttonRow","exitButtonContainer","summonContainer","playerContainer","switchFamiliarRowContainer","switchFamiliarRow","runAway","unlockBossContainer","unlockBossTextContainer","setContainerHeight","wholeContainer","restOfScreen","playerMessageLogContainer","bottomComponentContainer","Exploration","arrowBack","moveRow","dungeonButton","noneDungeonContentsContainer","noMoreStorylines","SlimeDrop","Wildgrass","_Enemy","Slime","FAMILIAR_EXP_REQUIREMENT_MULTIPLIER","cachedStats","FAMILIAR_MAX_LEVEL_TAGS","MaxFamiliarLevel","FamiliarClass","getStats","_options$forcedTarget5","_options$accuracyMult5","_options$tags5","familiarStats","_options$critChanceMu4","summonAction","standardFamiliarAttackEffect","onlyStat","baseStats","getPerLevelStatMultiplier","statFromLevel","levelEstimate","getMaxLevel","Idle","slimeFamiliar","_FamiliarClass","SlimeFamiliar","familiarCrate","_Building","FamiliarCrate","buildFamiliarCrate","_BuildingSpell","BuildFamiliarCrate","FamiliarMessageLog","_getFamiliarData","getFamiliarMessageLog","DungeonFloorSelect","dungeons","dungeonFloors","floorsByDungeon","filteredFloors","floorsView","dungeonId","onSelect","bigContainer","flexGrow","buildingAmt","familiarAmt","create","FullscreenModal","Modal","onDismiss","overlay","FamiliarRow","setCollapsed","familiarLevel","familiarMaxLevel","statusString","auto","explorationProgressPct","setIsModalSelectorOpen","showingDungeonSelector","setShowingDungeonSelector","showModal","hideModal","confirmRelease","setConfirmRelease","releaseFamiliar","deleteFamiliar","autoExploreCallback","companionCallback","newCompanionData","setCurrentCompanion","explorationCallback","rowContainer","expandTouchable","familiarName","currentExp","toNextLevel","getExpForNextLevel","optionRow","messageLogContainer","FamiliarsComponent","familiarIds","setAllFamiliarsToAutoExplore","setAllFamiliarsToExplore","hintProgress","loadoutsContainer","campusHintWarning","HelpCategory","translateHelpCategory","helpCategory","Introduction","ScreensOverview","ElementsOverview","GameFeatures","Wizards","TipsAndTricks","Helps","getVisibleHelps","tempIds","HelpContainer","showBadge","badgeContainer","_tempIds$split","_tempIds","oldIds","newHelps","idsToNotify","helpId","HelpsCategoryContainer","expandedHelp","helps","setHelpCallback","helpNotifications","helpNameString","helpContainers","HelpsContainer","setExpandedHelp","markNotificationAsRead","allHelps","helpsByCategory","_helpsByCategory$help","getVisibleHelpsByCategory","categoryContainers","HelpScreen","hintsDatabase","pushHint","hint","Home","currentHint","getFirstHint","menuVisible","setMenuVisible","toggleMenuVisible","menuButton","toggleAllAutoBuildAction","Menu","shouldEnableAll","_action$getAreas$Acti","_action$getAreas$Acti2","_action$getAreas$Acti3","_action$getAreas$Acti4","menuDismiss","menuActions","menu","anchor","onScroll","scrollRef","hintContainer","hintContents","hintContentsText","PaperCard","LoadGameContainer","loadMessage","setLoadMessage","loadSaveContents","setLoadSaveContents","loadSaveFromDeserializedData","deserializedData","currentAppVersionTimestamp","versionCompare","v1","v2","maxDepth","v1Parts","v2Parts","_v1Parts$i","_v2Parts$i","v1Part","v2Part","compareVersions","compatibleData","importSavefile","showByFile","importSavefileFromFile","loadSaveFromFile","_t","Intro","_state$world$totalTim","_state$global$newGame","selectedMPL","showLoadGameContainer","loadText","primarySchoolText","elementDescriptionMap","selectedClassId","setSelectedClassId","classes","combatClass","getSelectableCombatClasses","showClassSelection","selectedClass","selectedSecondaryElement","setSelectedSecondaryElement","selectedSecondaryMPL","secondarySchoolText","showSecondaryElementSelection","DualFlexibilityStoryline","selectedChallengeId","setSelectedChallengeId","challenges","showChallenges","selectedChallenge","allowMovingForward","UtilityCard","RadioButton","combatClassEffect","completed","objective","getObjective","reward","getReward","startButton","selectPrimaryElement","selectSecondaryElement","runGameStartupListeners","buttonGroupText","mplText","EquippedItemSlot","actualEquippedItem","unequipAction","showAsDisabled","EquippedItems","components","onPressEquippedItem","equipmentRow","EquippedPouch","saleStallTags","TimePerAutoSalePerStall","getSaleStallSecsPerSale","secsPerSaleUnit","getSaleStallSecsPerSaleExplanation","saleStall","SaleStall","timeExplanation","getSaleStallPriceMultiplier","multiplierExplanation","getSaleStallPriceMultiplierExplanation","BuildSaleStall","isMarketUnlocked","SaleStallsUnlocked","saleStallRevenueTags","SaleStallRevenue","multiplierUnit","buildSaleStall","autosellOneItem","currentlyInInventory","distinctItemCount","_sellAction$transform","selectedItem","sellAction","getSellOneAction","FromSaleStalls","isItemBeingAutosold","disableAllAutosold","refreshedPrimary","getFamiliarAction","doFamiliarItemEffect","FamiliarItem","numberInInventory","canUseOnFamiliar","shouldConfirm","_TransmutationSpell","FamiliarTransmutationSpell","ItemDetailsAction","pressedOnce","setPressedOnce","extraOnPress","familiarAction","ItemFamiliarModalContents","onClose","ItemDetails","_saleActions$map","_combineActions$map","_extraActions$map","isFamiliarItem","familiarItemModalVisible","setFamiliarItemModalVisible","dismissFamiliarItemModal","familiarPrimaryAction","disableSelling","primaryAction","showQuickbar","getQuickbarAction","getExtraActions","onCombineAllExtraPress","_props$itemStack$item2","newQuality","newOccurrence","selectItem","combineAction","extraPress","onAutosoldPress","toggleItemAutosold","rowGap","itemFilterer","itemSorter","_b$itemOccurrence$par","_a$itemOccurrence$par","itemA","itemB","getNumericId","getItemGridElement","InventoryItems","selectedTagString","setSelectedItem","sortedInventory","paramsJSON","itemDetails","sellLowQualityAction","removeAllFromSaleStallsAction","showExtraActions","isFullBleed","detailsContainerPadding","Inventory","fullBleedPadding","equippedItemsContainer","topButtons","craftButton","OrientationLockManager","Loading","loadingAnim","easing","Easing","SafeAreaProvider","initialMetrics","initialWindowMetrics","PaperProvider","StatusBar","SafeAreaView","safeAreaContainer","ZOOM_SUPPORTED","ZoomChecker","webFrame","setZoomFactor","FPS_DATA","ZOOM_DATA","useEventTagToggle","_stateRef$current","oldState","innerTag","BottomMenuToggle","_stateRef$current2","innerSection","useHiddenFromBottomMenuToggle","toggleMenuRow","toggleMenuTextContainer","toggleMenuCheckboxContainer","MenuSection","_sectionInfo$isVisibl","MenuSectionsOrder","Options","copyToClipboardError","setCopyToClipboardError","copyToClipboard","Clipboard","setStringAsync","savedData","getStringAsync","targetFpsChange","zoomChange","elementOverrideChange","elementOptions","hideBottomResourceViewerToggle","hideDamageEffectsToggle","doNotUseNativeDriverToggle","darkModeToggle","colorSpellToggle","compactUIToggle","expandedUIToggle","hideTooltipsToggle","wakeLockCallback","enableBottomMenuCallback","leftHandedModeCallback","putCastSpellOnBottomMenuCallback","doNotShowEventsCallback","eventTagLevelUpAlreadyReachedToggle","eventTagLevelUpEmptyToggle","eventTagLevelUpAllToggle","eventTagInconsequentialRandomEventsToggle","INCONSEQUENTIAL_RANDOM_EVENT","eventTagMainQuestSeenBeforeEventsToggle","eventTagBossFightToggle","eraseText","setEraseText","eraseGame","saveToFileCallback","hasTranslations","translationMessage","setTranslationMessage","importTranslationFileCallback","loadTranslationsFromFile","clearTranslationFileCallback","bottomMenuToggles","labelColor","performanceCategory","targetFpsDropdownContainer","targetFpsPicker","hideDamageEffectsContainer","keepAwakeCategory","hideEventPopupsCategory","eventPopupsContainer","bottomMenuCategory","hideBottomMenuContainer","themingAndUICategory","uiColorPicker","elementOverrideContainer","saveFileCategory","loadFileCategory","languageCategory","eraseSavedDataCategory","buttonColor","textColor","sliderContainer","sliderTextContainer","saveButton","loadMessageContainer","inputContainer","paddingLeft","bottomMenuCustomizationContainer","Retirement","allElementLevels","eachElement","allStorylines","isCompletedThisRun","modifiedState","retiredState","newExpMultiplier","newProductionMultiplier","oldExpMultiplier","oldProductionMultiplier","expDeltaPct","productionDeltaPct","newStorylines","storylineBonusMessage","storylineList","storylineName","storylineBonus","startingExp","startingLevel","startingExpSecondary","startingLevelSecondary","retirementEffects","newExp","newProduction","secondaryElementText","hasClicked","setHasClicked","showOngoingEventsWarning","showMPLTooLowWarning","showMPLTooHighWarning","warning","CorruptionDetails","isHPPenaltyActive","isExpPenaltyActive","isTransmutePenaltyActive","corruptionAmount","corruptionCap","penalties","penaltyText","corruptionExplanation","corruptionPenalties","RitualDetails","ritualDescription","ritualEffect","corruptionCost","getCorruptionCost","toggleRitual","turnOff","turnOn","RitualView","effectContainer","effectSubcontainer","RitualsView","ritualsIdString","ritualContainers","ritualContainer","RitualsComponent","spellcraftingVat","SpellcraftingVat","buildSpellcraftingVat","BuildSpellcraftingVat","SpellSelectSpellButton","onSpellPress","SpellSelect","_keysOf","_spellsByElement","setSpellId","selectedSubcategory","setSelectedSubcategory","spellsToShow","onSpellSelect","dependencies","hasMounted","useComponentDidUpdate","subcategoryPickerComponent","spellButtons","vatAmt","SpellcraftRow","spellcraftData","spellcraftName","spellcraftSpell","subtitle","showingSpellSelector","setShowingSpellSelector","confirmDestroy","setConfirmDestroy","destroyVatCallback","destroyVat","setSpellCallback","assignSpellToVat","removeSpellcraftCallback","selectedSpellcraft","modal","_spellcraftSpell$getS","SpellcraftsComponent","vatIds","convenienceStoryline","EssenceCatalyst","catalystTags","CatalystEffectivity","catalystEffectivityParams","effectPct","getPerCatalystBonusMultiplier","getPerCatalystBonusMultiplierExplanation","essenceCatalyst","buildEssenceCatalyst","BuildEssenceCatalyst","CatalystsUnlocked","BASE_REGEN","getManaRegenPerSec","ManaSpout","effectUnit","manaRegenPerSec","manaSpout","buildManaSpout","BuildManaSpout","ManaSpoutsUnlocked","EssenceStorage","perBuildingCapTags","PerBuildingCap","perBuildingCapParams","perBuildingCapExplanationParams","getPerStorageBonusCap","getPerStorageBonusCapExplanation","_getDisplayEffectUncached","essenceStorage","buildEssenceStorage","BuildEssenceStorage","StoragesUnlocked","getMaxManaBonus","getMaxManaBonusExplanation","manaShard","ManaShard","buildManaShard","BuildManaShard","ManaShardsUnlocked","copperOre","CopperOre","transmuteCopperOre","TransmuteCopperOre","poisonDoTAmountTags","PoisonDoTAmount","_temporaryEffectData$","magnitude","getDamagePerSec","totalDamageOld","noxiousCloak","NoxiousCloak","EvolvedSlime","airborne","Airborne","resistAttackSpell","ResistAttackSpell","damageMultiplier","resistAutoAttack","ResistAutoAttack","berserk","Berserk","damageMagnitude","wet","Wet","chilled","Chilled","cloakOfFlames","CloakOfFlames","Corrosion","corrosionDoTAmountTags","CorrosionDoTAmount","corrosion","cursed","Cursed","disease","Disease","divineImmunityTemporaryEffect","DivineImmunityTemporaryEffect","ResistElementBase","SilenceElementBase","loadElementalSilence","frail","Frail","frozen","Frozen","frozenProtection","_TemporaryEffect2","FrozenProtection","postFrozenProtectionDurationTags","PostFrozenProtectionDuration","grounded","Grounded","guard","Guard","paralyzed","Paralyzed","petrified","Petrified","poisonImmunity","PoisonImmunity","seared","Seared","shapeshifted","Shapeshifted","what","shrunken","Shrunken","commonBuff","StatusImmunityBase","ALLOWED_STATUS_IMMUNITY_EFFECTS","statusImmunity","StatusImmunity","stunned","Stunned","stunProtection","StunProtection","loadStunning","stunDuration","PostStunProtectionDuration","weakened","Weakened","AttackMultiplier","wizardDisarray","WizardDisarray","isHealingPossible","loadCommonTemporaryEffects","_effect$params","commonDoTAmount","effectObject","totalValue","_data$params$commonBu","_data$params","_data$params$commonBu2","multiplierStr","_data$params$commonBu3","_data$params2","_data$params2$commonB","commonBuffs","notClearedEffects","_params$tags","loadWet","loadChilled","loadFrozen","loadSeared","loadDisease","loadGrounded","loadAirborne","Reflected","damageReflected","loadFrail","loadBerserk","loadPetrified","loadElementalProtection","loadParalyzed","AttackSpell","loadSpecificStatusImmunity","loadDivineImmunity","EquipmentTransmutationSpell","HealthPotion","_PouchItem","hpHealTags","hpHeal","getHPHealAmount","healAmt","healthPotion","transmuteHealthPotion","_EquipmentTransmutati","TransmuteHealthPotion","elementalShardWater","wildgrass","cotton","Cotton","transmuteCotton","TransmuteCotton","Goblin","MutatedFish","VenomPowder","PoisonousToad","SewerFish","encounterEnemy","enemyLevel","successRate","explorationBossRequirementTags","ExplorationBossRequirement","DungeonFloor","_getExplorationSuccessesForBossBase","forcedRoll","explorationRoll","boss","getExplorationPossibilityTags","explorationPossibilities","succeedWeight","failWeight","levelSum","ExplorationWeight","antidotePotion","AntidotePotion","transmuteAntidotePotion","TransmuteAntidotePotion","elementalShardPoison","venomPowder","GoblinSharpshooter","lastActionResult","SewerFly","Sicklefish","SludgeMass","EtherealEelExtract","CombatSpellBase","canUseOutsideOfCombat","HasteTemporaryEffect","attackDelayRatio","AttackDelayMultiplier","BASE","haste","_CombatSpellBase","Haste","log2","magnitudeExplanation","durationExplanation","EtherealEel","aoeEnemyAttackEffect","GoblinDoctor","DoubleTroubleTemporaryEffect","BotanicalSwarmTemporaryEffect","doubleTroubleTemporaryEffect","botanicalSwarmTemporaryEffect","ManEatingPlant","_super3","getPhase","phase","getNextActionPhase3","getNextActionPhase2","manEatingPlant","BuffingPouchItem","getTemporaryEffect","_this$getItemEffects","other","getTarget","venomousBrew","_BuffingPouchItem","VenomousBrew","transmuteVenomousBrew","TransmuteVenomousBrew","VenomousSpider","EXPLORATION_POSSIBILITIES","_DungeonFloor","SewerHideout","SewerHazardousSector","SewerEntrance","SewersUnlocked","FURNITURE_PRESERVATION_OPTIONS","furniture","loadFurniturePreservation","furniturePreservationStorylines","furniturePreservationEvent","hasTriggered","createStorylineForOption","furniturePreservationEventBuilder","setStorylineIds","tParams","end","permacastStoryline","MAX_DIFFICULTY_LEVEL","MAX_BOON_LEVEL","getMaxPossibleDifficultyLevel","BASE_BOON_POINTS_PER_WORLD","BOON_POINTS_TAGS","BoonPointsEarned","getTotalAvailableBoonPoints","getNewBoonPointsAvailable","triggerNewGamePlus","getPointsRequiredForConfiguration","storylinesToGrant","storylinesToAvoid","oracleLevel","getStorylinesToUnlockForSpecificOracleLevel","newGamePlusReset","fibonacci","getIncrementalPointsRequiredForLevel","getTotalPointsRequiredForLevel","points","l","getSheerPowerLevel","getStorylineOracleLevel","getBlazingSpeedLevel","getWorldDifficultyLevel","getNewGamePlusElementMaxLevelBonus","getNewGamePlusFamiliarMaxLevelBonus","getNewGamePlusItemQualityMaxBonus","getNewGamePlusStorageMultiplier","getNewGamePlusProductionMultiplier","getNewGamePlusChannelingAndSalePriceMultiplier","getNewGamePlusExpGainMultiplier","getNewGamePlusLootMultiplier","getNewGamePlusHpMultiplier","difficultyLevel","getNewGamePlusAttackDelayMultiplier","getNewGamePlusAccuracyAndDodgeMultiplier","getNewGamePlusOtherStatMultiplier","getNewGamePlusBoonPointsEarnedMultiplier","TomeOfToxicKnowledge","TicTacToeStoryline","EndingHistoryRow","worldStats","challengeStats","extraStats","extraStatsText","List","EndingHistoryContainer","_state$global$endings","endings","_endings$toReversed","FlatList","toReversed","StorylineContainer","DiviningTheWorld","MaterialCommunityIcons","storylineContainer","storylineTeaser","StorylinesContainer","expandedStoryline","setExpandedStoryline","onlyStorylineStatus","setStorylineCallback","getStatus","storylineNameString","storylineContainers","StatsSingleElement","_researchEstimate$ele","_researchEstimate$ele2","researchEstimate","currentRank","thisLevelSpells","thisLevelCrafts","thisLevelEmpowerments","currentElementLevel","nextUnlockLevelAdd","foundNewSpellsOrItems","extraCrafts","extraEmpowerments","nextLevelSpells","nextLevelTransmutations","nextLevelEmpowerments","newEmpowerments","newUnlocks","unlocks","nextLevelRequiredExp","insideBlock","StatsElementViewerElement","elementElementContainer","StatsElementViewer","perElement","StorylineViewer","storylineStatusMap","_storylineStatusMap$s","storylineStatusSet","has","storylineStatus","setStorylineStatus","storylineStatuses","indexA","indexB","statusPicker","_storylineStatusMap$s2","completedStorylinesPct","StatsOtherViewer","_state$global","thisRunActiveDuration","thisWorldActiveDuration","thisRunRealWorldDuration","thisWorldRealWorldDuration","totalRealWorldDuration","getNewGamePlusCount","expMultiplier","primaryElementRow","inGameTimeTotalRow","inGameTimeThisWorldRow","inGameTimeThisRunRow","activeDurationTotalRow","activeDurationThisWorldRow","timePiecesThisRunRow","timePiecesTotalRow","timePiecesThisWorldRow","activeDurationThisRunRow","realWorldDurationTotalRow","realWorldDurationThisWorldRow","realWorldDurationThisRunRow","combatClassRow","challengeRow","newGamePlusRows","retirementRows","Stats","showEndings","StudyRowDetails","thisLevelRituals","nextLevelRituals","StudyRow","_state$run$studyAlloc","toggleExpanded","hasFreeResearchers","applyAll","elementLevel","elementPrimaryText","singleElementContainer","isOdd","rightHandSide","plusMinusAllocatorContainer","expansionContainer","freeResearchers","totalResearchers","setApplyAll","toggleApplyAll","autoAssign","setAutoAssign","autoAssignPicker","rateExplanation","explainBaseResearchRate","expRateContents","bottomSection","assignAllContainer","researcherCapacityContainer","free","disableAllMinus","disableAllPlus","onPressMinusAll","onPressPlusAll","expansionPlaceholder","SynchroBonusRow","SynchroBottomComponent","activeBonuses","allBonuses","bonusesToConsider","fullyUnlockedElements","getCurrentBonusAmount","getSortedSynchroBonuses","topPart","SynchroGridItem","translationArgs","SynchroGrid","_props$selectedPositi3","_props$selectedPositi4","_props$selectedPositi","_props$selectedPositi2","selectedPosition","onGridPress","SynchroElement","Synchro","setSelectedPosition","onElementPress","EverUsedSynchro","setCurrentSynchroPosition","synchroGrid","synchroElementButtons","showIntroMessage","BasicChannelingSpellBase","getManaCostProportion","essenceEfficiency","getBaseEssenceEfficiency","getEssencesToGrant","getEssenceAmountToGrant","resourceTexts","ChannelingUnlocked","_this2$getCost$resour","log10","_BasicChannelingSpell","ChannelFire","ConditionRow","getDisplayExplanation","PermaCastRow","hasPermaCastSpells","getSortedPermaCastSpellList","permaCastSpellList","actualSpellList","reverse","powerNeededPerSec","manaNeededPerSec","wizardsNeeded","manaIncome","maxManaCost","manaCap","warningWizardPower","warningManaConsumption","warningManaCap","topHalf","explanationComponent","warningComponent","AutocastRuleRow","toggleDisabled","onDelete","wizardPointCap","isSpellVisible","hideRule","wizardPointStatusComponent","_formatNumber","rightSide","AutocastRuleRowContainer","saveRule","deleteRule","ruleDisabled","surfaceColor","boundSave","boundDelete","unhideRule","unhideIconFn","hiddenViewStyle","hiddenText","wizardCount","unfoldButton","WizardsBottomComponent","_calculateIncomePerSe3","manaConsumption","cumulativeManaConsumption","estimateManaConsumptionPerSecPerStrategy","cumulative","currentRule","estimateExpGainPerSecPerStrategy","maxExpGain","maxExpGainElement","wizardPowerProductionPerWizardExplanation","explainAutocastPointIncomePerSecPerWizard","totalWizards","explainTotalWizards","explainWizardAmount","remainingWizards","mainElement","WizardsMainComponent","getAutocastRuleIndexByRule","showPermaCast","rulesByAutocastCategory","getAutocastCategory","togglePause","paused","NestableScrollContainer","NestableDraggableFlatList","ruleIndices","ruleIds","setSlotNumber","loadoutsSlotPicker","loadoutName","setLoadoutName","_loadoutObjects$Numbe","_loadoutObjects$Numbe2","_state$global$autocas4","showHeader","headerComponent","saveCurrentAutocastStrategy","clearAutocastStrategy","SheerPowerDescription","explanationBase","elementMaxLevelBonus","familiarMaxLevelBonus","itemQualityBonus","maxElementLevel","maxFamiliarLevel","maxItemQuality","storageMultiplier","StorylineOracleDescription","storylineBonusesLines","storylineText","storylineBonusesText","BlazingSpeedDescription","channelingMultiplier","lootMultiplier","WorldDifficultyDescription","hpMultiplier","attackDelayMultiplier","boonPointMultiplier","boonPoints","doubleBoonPoints","ultimateChallengeText","penUltimateChallengeRewardText","BoonRow","decreasingPossible","increasingPossible","useBoonManipulation","remainingPoints","setLevel","Worlds","totalPointsAvailable","newBoonPointsAvailable","maxDifficultyLevel","setSheerPower","setStorylineOracle","setBlazingSpeed","setWorldDifficulty","topMessage","noContentWarning","explanationForBoonsMessage","newPointsAvailable","sheerPowerManipulation","storylineOracleManipulation","blazingSpeedManipulation","difficultyExplanation","maxDifficulty","clearText","onPressDifficultyMinus","onPressDifficultyPlus","hasExportedGame","setHasExportedGame","doNewGamePlus","INITIAL_STATE_CLONED","EventListItemMemoized","_props$item","_props$item4","currentMessageData","getTitle","_props$item2","descriptionNumberOfLines","_props$item3","isActionable","EvilIcons","EventList","addOccurrenceToQueue","sortedEvents","stringifiedEvents","terminalEvents","ongoingEvents","eventCategories","categoryKeyExtractor","categoryRenderItem","titleIcon","eventTitleContainer","titleText","actionableIcon","EventOverlay","_optionDescriptions","isPickerOpen","isEndingOpen","setCurrentEventOccurrenceId","processUICommand","uiCommand","setCurrentLookbackMessageId","processUICommands","currentEventOccurrenceIdRef","currentLookbackMessageId","newEventOccurrenceId","eventsToRemoveFromQueue","pop","_occurrence$timestamp","_getEventMessageById","accumulatedState","eventToRemove","removeOccurrenceFromQueue","eventMessage","optionDescriptions","totalText","messageInLookbackIdx","messageLength","totalMessageCount","_eventOccurrence$mess","_eventOccurrence","_eventOccurrence$mess2","_eventOccurrence$mess3","_eventOccurrence4","_eventOccurrence4$mes","_eventOccurrence2","_eventOccurrence3","idxToDisplay","disabledIconColor","disabledColorByTheme","_eventOccurrence5","_eventOccurrence9","_eventOccurrence10","dismissable","overlayContainer","overlayCloseButton","titleTextContainer","historyContainer","historyButton","_eventOccurrence$mess4","_eventOccurrence6","_eventOccurrence6$mes","_eventOccurrence$mess5","_eventOccurrence7","_eventOccurrence7$mes","_eventOccurrence$mess6","_eventOccurrence8","_eventOccurrence8$mes","executeEventOccurrenceAction","optionButton","overlayCloseButtonInner","SelectedContext","MenuComponent","shouldHighlight","notificationBadge","itemStyle","SCROLL_VIEW_EPSILON","BottomMenu","menuOrder","menuItemsCalculated","navigationPressCallback","onNavigationPress","menuItems","callbacks","sectionsWithBadges","_getSectionInfo$isBad","_getSectionInfo","orientation","scrollEnd","setScrollEnd","scrollStart","setScrollStart","contentOffset","contentWidth","contentSize","scrollViewWidth","layoutMeasurement","isStart","flatListBackgroundStyle","scrollContentContainer","wheelScrollRef","elRef","el","onWheel","deltaY","scrollableElement","getScrollableNode","scrollLeft","scrollWidth","clientWidth","preventDefault","stopPropagation","scrollBy","behavior","_el$getScrollableNode","useHorizontalScrollRef","bottomMenuContainer","leftHanded","showCastSpellButton","spellButtonPlaceholder","chevron","horizontal","snapToInterval","scrollContainer","scrollEventThrottle","overScrollMode","showsHorizontalScrollIndicator","navigationBlock","spellMenuButtonPlaceholder","TARGET_FPS","GameTickProcessor","currentError","setCurrentError","lastTickTime","setLastTickTime","randomValueForReprocessing","setRandomValueForReprocessing","warping","setWarping","timeTickCallback","nowTime","lastTickTimeConsidered","_x5","_x6","_x7","_x8","processWarpTime","_excluded2","processOfflineTicks","remainingSec","ticksRun","tickTime","begin","cleanupCallback","_state$options$target","interval","setInterval","ManaBar","insets","ratioFilled","filledAnimWithNativeDriver","filledAnimWithoutNativeDriver","permaCastCost","incomeText","animatedStyle","filled","animatedComponent","incomeTextComponent","manaTextComponent","textOverlay","getCurrentTimePieceSpeedupSpeed","getCurrentTimePieceSpeedupCost","TimePiecePerFasterSpeedup","TimePiecePerFastSpeedup","getCurrentTimePieceSpeedupCostPerGameSecond","speed","totalSpeed","calculateSpeedMultiplier","recordTimePieceConsumption","SchoolRowMemo","isPrimary","primaryText","nextLevelExp","ElementViewer","incomeComponent","hideIncome","incomeSign","firstComponent","ResourceViewer","resourceKeys","incomeExplanation","hasAnyIncome","_income$resourceName","_incomeExplanation$re","boldHotkeyLetter","hotkeyPos","firstHalf","lastHalf","hotkeyText","toUpperCase","others","favoriteButton","favorited","onPressFavorite","Component","TouchableNativeFeedback","focusable","menuComponentTouch","wide","menuComponentButton","showFavoriteIcon","menuItemText","MenuContents","favoritesFull","pinnedSections","menuComponent","sectionKey","sectionTitle","menuProps","badgeCacheKey","navigation","_sectionInfo$find","_sectionInfo$find2","_sectionInfo$find3","topDivider","hasTemporaryEffects","gameSpeed","hasTimePieces","speedupCost","timePieceCost","timepiecePerSec","showExploration","timePieceButtonsContainer","timePieceButtonTitle","timePieceButtonContainer","timePieceTextRows","statViewer","navigationRowTitle","notificationBadgeSize","SpellMenuContents","isBottomMenuEnabled","heightWithoutBottomMenu","hasFavorites","magicContainer","favoritesOnBottom","borderTopColor","favoritesContainer","SpellMenu","backdropTouchable","DebugUPSOverlay","timestamps","startEndTimestamps","msPerUpdate","backendMsPerUpdate","ticksPerUpdate","updatesPerSec","estimatedMsPerUpdate","ErrorBoundary","_React$Component","errorInfo","errorFallback","FullScreenListener","altKey","KeepAwake","useKeepAwake","SaveDataBackupper","backupCallback","BottomSafeAreaPadding","safeAreaInsets","IntroContents","headerContainerStyle","borderBottomColor","centerComponent","centerText","maxContainer","nativeID","Appbar","biggerContainer","introContainer","MainAppContents","_sectionData$activeSe","menuShown","setMenuShown","rightMenuShown","setRightMenuShown","allSections","setSection","pinnedSectionObjects","setPinnedSectionObjects","pinnedSectionObjectsRef","activeSections","pinnedSection","setUiActiveSections","newSectionObjects","resetKeys","togglePinnedSection","usedIndices","lowestFreeIndex","newPinnedSectionObjects","endingHistoryIndex","setEndingHistoryIndex","onMenuPress","onMenuOpen","onMenuClose","onEventMenuPress","onEventMenuOpen","onSpellMenuOpen","onRightMenuClose","onSpellMenuPress","ongoingEventCount","showBottomResourceBar","scrollRefs","scrollPositions","setScrollPositions","onScrollPerSection","scrollValue","_sectionData$_section","_scrollPositions$_sec","_scrollRefs$_section","_scrollRefs$_section$","_scrollPositions$_sec2","scrollTo","animated","showBottomMenu","wrapInSection","component","activeSection","contents","fullscreenContainer","fullscreenContainerInside","onEndingClose","sectionIndices","indices","mainSections","unusedIndex","_pinnedSectionObjects","_pinnedSectionObjects2","_pinnedSectionObjects3","_sectionData$Study","_sectionData$Inventor","_sectionData$Transmut","_sectionData$Enhance","_sectionData$Boosts","_sectionData$Familiar","_sectionData$Spellcra","_sectionData$Rituals","_sectionData$Ending","_sectionData$Ending2","_sectionData$Worlds","_sectionData$Retireme","_sectionData$Compendi","_sectionData$Stats","_sectionData$Options","_sectionData$Help","_sectionData$About","_sectionKey","_sectionKey2","_sectionData$currentS","currentSection","scrollViewContents","Help","explorationContents","synchroContents","UtilityText","backCallback","BackHandler","contentsWide","onAccessibilityEscape","horizontalContainer","Drawer","drawerPosition","drawerType","open","onOpen","swipeEnabled","renderDrawerContent","mainContainerPhone","onMagicTap","GestureHandlerRootView","notificationsBadge","OfflineProgress","offlineProgressContainer","currentTicks","totalTicks","AppContents","_tooltip3","_tooltip4","_stateContextValue$op","playerState","_useState13","_useState14","localUiState","setLocalUiState","_useState15","_useState16","processingBigTime","setProcessingBigTime","_useState17","_useState18","setTotalTicks","_useState19","_useState20","setCurrentTicks","NavigationBar","setPositionAsync","setBackgroundColorAsync","setBehaviorAsync","uiContextValue","_useState21","_useState22","tooltips","setTooltips","tooltipsRef","newTooltips","postMeasurementId","mouseEnterTimestamp","mouseLeaveTimestamp","_tooltipsRef$current","tooltipContextValue","_tooltip","_tooltip$position","_tooltip2","tooltipControlContextValue","_useState23","_useState24","loading","setLoading","_useState25","_useState26","criticalError","setCriticalError","_useState27","_useState28","lessCriticalError","setLessCriticalError","playerStateRef","transformedState","stateContextValue","fetchData","loadedState","loadData","_useState29","_useState30","lastTimeFailedToSave","setLastTimeFailedToSave","storeData","_useTransition","useTransition","_useTransition2","setTransition","shouldShowIntro","_useState31","_useState32","showIntro","setShowIntro","_useWindowDimensions2","copyAsyncStorageToClipboard","criticalErrorView","errorWrapper","errorHeader","variant","errorView","_useState33","_useState34","accessibilityItems","setAccessibilityItems","accessibilityItemsRef","announcement","AccessibilityInfo","queue","_accessibilityItemsRe","newItem","oldItem","_useState35","_useState36","visibilityState","setVisibilityState","onVisibilityChange","document","resizeBy","offlineProgressView","centerAligned","accessibilityView","role","mainView","safeAreaProviderStyle","internalToPaperContextComponent","internalToUIContextComponent","headerPadding","rightHeaderContainer","rightHeaderIcon","gestureRecognizer","webMenuContainer","webRightMenuContainer","menuContainer","closeButtonInner","pinButtonInner","ExpandHome","_Storylines$getByIdNu","LandPurchaseUnlocked","fractionAddedPerLandPurchase","_this$getCost$resourc","expandHome","GatherMana","ManualGathering","UseTimePiecesEvent","_this$getCost$resourc2","UseTimePiecesStudy","timePiecesPerResearchSecond","TimePiecePerStudy","timeString","expPerResearcherPerSec","transformedSecs","timePieces","_state$run$studyAlloc2","UseTimePiecesWarp","timePiecePerWarpedSec","TimePiecePerWarpedSec","totalSecs","formattedTime","loadActions","monstiumPaper","MonstiumPaper","transmuteMonstiumPaper","TransmuteMonstiumPaper","paper","EnhancementPurchaseListeners","Enhancement","getSubcategory","getRequiredEnhancements","getItemCost","setPurchased","monstiumCollection","_Enhancement","MonstiumCollection","superheatedCatalysts","SuperheatedCatalysts","monstiumCatalysts","MonstiumCatalysts","MonstiumCatalyst","catalystEffectivityTags","monstiumCatalyst","buildMonstiumCatalyst","BuildMonstiumCatalyst","manaSteamers","ManaSteamers","manaTags","manaRegenUnit","getManaRegenPerSecExplanation","fireTags","Consumption","getFireEssenceConsumptionPerSec","fireEssenceUnit","getFireEssenceConsumptionPerSecExplanation","waterTags","getWaterEssenceConsumptionPerSec","waterEssenceUnit","getWaterEssenceConsumptionPerSecExplanation","manaSteamer","ManaSteamer","waterConsumptionPerSec","fireConsumptionPerSec","manaRegenExplanation","waterConsumptionExplanation","fireConsumptionExplanation","buildManaSteamer","BuildManaSteamer","sewageSystemEnhancement","SewageSystem","unitForResource","BASE_PRODUCTION","getEssenceProductionPerSec","getEssenceProductionPerSecExplanation","poisonTags","BASE_CONSUMPTION","getPoisonEssenceConsumptionPerSec","unitForConsumption","getPoisonEssenceConsumptionPerSecExplanation","getResourcesProduced","baseEssences","SewageSystemMakesAll","resourcesProduced","resourceStrings","productionString","consumption","consumptionExplanation","sewageSystem","buildSewageSystem","BuildSewageSystem","researcherDesk","ResearcherDesk","buildResearcherDesk","BuildResearcherDesk","ResearchersUnlocked","Monstruarium","monstruarium","buildMonstruarium","BuildMonstruarium","MonstruariumsUnlocked","treasureChests","TreasureChests","TreasureChest","treasureChest","buildTreasureChest","BuildTreasureChest","wizardChamber","WizardChamber","buildWizardChamber","BuildWizardChamber","loadBuildingsDemo","loadEssenceStorages","resourcesPerSec","battlemage","_CombatClass","Battlemage","attackAndDefense","getClassEffects","getClassEffectExplanations","Builder","buildingCost","buildingCostMultiplier","buildingCostExplanation","landMultiplier","landExplanation","_Storylines$getByIdNu2","spellslinger","Spellslinger","manaExplanation","loadCombatClassesDemo","combatClassesUnlockEventBuilder","combatClassesUnlockEvent","loadCombatClassesUnlocker","efficientExploration","EfficientExploration","compass","Compass","healthBoost","HealthBoost","doubleHealthBoost","DoubleHealthBoost","enlargedPouch","EnlargedPouch","firstAid","FirstAid","professionalPouch","ProfessionalPouch","giantPouch","GiantPouch","healthPotionEffectivity","HealthPotionEffectivity","tripleHealthBoost","TripleHealthBoost","furnitureOrganization","FurnitureOrganization","absoluteAmount","landTreaty","LandTreaty","houseExpansionContract","HouseExpansionContract","understandingOfMagic","UnderstandingOfMagic","deeperUnderstandingOfMagic","DeeperUnderstandingOfMagic","glitteringStalls","GlitteringStalls","hiringSpree","HiringSpree","scalableChambers","ScalableChambers","shardDiligence","ShardDiligence","improvedPurification","ImprovedPurification","superheatedSteamers","SuperheatedSteamers","compressedEssence","CompressedEssence","primaryStorage","PrimaryStorage","essenceIcon","essenceIconExtra","secondaryEssenceIcon","wideStorage","WideStorage","createChestEvent","dungeonFloorIds","newChestEventBuilder","newChestEvent","createBadChestEvent","lastMessage","_getCurrentDungeonFlo2","PoolOfManaTemporaryEffect","EssenceCatalystResonanceTemporaryEffect","SaleRushTemporaryEffect","_TemporaryEffect3","ElementalGatheringTemporaryEffect","_TemporaryEffect4","_super4","amountPerSec","MonstiumCatalystResonanceTemporaryEffect","_TemporaryEffect5","_super5","poolOfManaTemporaryEffect","essenceCatalystResonanceTemporaryEffect","saleRushTemporaryEffect","elementalGatheringTemporaryEffect","monstiumCatalystResonanceTemporaryEffect","loadRandomRepeatableEvents","manaSpoutEventBuilder","setOnTrigger","essenceCatalystEventBuilder","saleRushEventBuilder","effectData","elementalGatheringEventBuilder","eventParams","essenceString","monstiumCatalystEventBuilder","pileOfCoinsEventBuilder","elementBookEventBuilder","coinAmount","sqrt","researchRates","getResearcherExpPerSecAndResearcher","coinAmountText","DungeonEventGroup","getSelectedEvent","hasFinishedSelecting","sum","getWeight","randomValue","DungeonEventGroups","getOrCreateDungeonEventGroup","dungeonEventGroup","Achievement","loadPreTrainingProgression","channelingUnlockerEventBuilder","channelingUnlockerEvent","manaSpoutUnlockerEventBuilder","manaSpoutUnlockerEvent","manaShardUnlockerEventBuilder","manaShardUnlockerEvent","storagesUnlockerEventBuilder","storagesUnlockerEvent","catalystUnlockerEventBuilder","catalystUnlockerEvent","studyUnlockerEventBuilder","studyUnlockerEvent","transmuteUnlockerEventBuilder","transmuteUnlockerEvent","wizardsUnlockerEventBuilder","wizardsUnlockerEvent","marketUnlockerEventBuilder","marketUnlockerEvent","researchersUnlockerEventBuilder","researchersUnlockerEvent","expandHomeUnlockerEventBuilder","expandHomeUnlockerEvent","explorationUnlockerEventBuilder","explorationUnlockerEvent","loadOtherElementExplorationUnlocker","AnimatedSnowman","Cherry","cherry","Goat","EXPLORATION_POSSIBILTIIES","TrainingTowerAir","RestOfTrainingUnlocked","BreezyRabbit","Windglider","TrainingTowerEarth","FamiliarOfWind","FlyingRock","StoneskinTemporaryEffect","defenseRatio","DefenseMultiplier","stoneskin","Stoneskin","amountExplanation","RockGolem","TrainingTowerFire","ExplorationTriggerGroup","explorationEvents","isDoneForThisRun","getHintMessageWhenNotPossible","getHintMessageWhenPossible","maxTriggers","maxTriggersPerRun","timesTriggered","next","getExplorationSuccessesBase","accumulated","totalExplorations","getTotalExplorationSuccesses","getExplorationAmountNeeded","_event$getParams","ExplorationTriggerGroups","checkAndTrigger","featheredHat","FeatheredHat","transmuteFeatheredHat","TransmuteFeatheredHat","elementalShardAir","stoneMail","StoneMail","transmuteStoneMail","TransmuteStoneMail","elementalShardEarth","wizardsRobe","WizardsRobe","transmuteWizardsRobe","TransmuteWizardsRobe","glaive","Glaive","transmuteGlaive","TransmuteGlaive","bastardSword","BastardSword","transmuteBastardSword","TransmuteBastardSword","elementalShardFire","battleAxe","BattleAxe","transmuteBattleAxe","TransmuteBattleAxe","handAxe","HandAxe","transmuteHandAxe","TransmuteHandAxe","wandOfWater","WandOfWater","_getEquippedItem","getEquippedItemEffect","transmuteWandOfWater","TransmuteWandOfWater","Dungeon","getDungeonEventGroup","hasFinishedTriggeringThisRun","StrengthTemporaryEffect","attackRatio","strength","Strength","BlazingTurtle","FireBat","TrainingTowers","_Dungeon","TrainingTowerWater","FLOOR_FOR_ELEMENT","trainingTowers","trainingTowersExplorationGroup","_ExplorationTriggerGr","TrainingTowersExplorationGroup","HeadInstructor","getNextAction2","HeadInstructorDefeated","headInstructor","HEAD_INSTRUCTOR_GISELLE","enemyDefeated","loadProgressionEventsDemo","firstBossUnlockedEventBuilder","firstBossUnlockedEvent","restOfTrainingTowersUnlockerEventBuilder","restOfTrainingTowersUnlockerEvent","finalTrainingEventBuilder","finalTrainingEvent","loadTrainingTowerProgression","sewersUnlockEventBuilder","sewersUnlockEvent","sewersEntranceBossUnlockEventBuilder","sewersEntranceBossUnlockEvent","sewersEntranceBossDefeatedMainEventBuilder","sewersEntranceBossDefeatedMainEvent","sewersEntranceBossDefeatedAltEventBuilder","sewersEntranceBossDefeatedAltEvent","hazardousSectorBossDefeatedMainEventBuilder","hazardousSectorBossDefeatedMainEvent","sewersHideoutBossUnlockEventBuilder","sewersHideoutBossUnlockEvent","sewersCompletedEventBuilder","VastDesertUnlocked","sewersCompletedEvent","loadSewersProgression","varietyCollectorStoryline","advertisingManual","simultaneousChanneling","GoblinChief","goblinDenStoryline","Paper","transmutePaper","TransmutePaper","loadLocationEncyclopedia","LocationEncyclopedia","locationEncyclopediaEventBuilder","remainingFloors","floorsToTally","talliedFloors","floorIdx","isTallied","getIdForTallyingClears","tallyAll","locationEncyclopediaEvent","_enemy","tally","_state$world$variable2","getWorldAccumulatorVariable","outessencedStoryline","copperGauntlet","CopperGauntlet","transmuteCopperGauntlet","TransmuteCopperGauntlet","copperIngot","copperRapier","CopperRapier","transmuteCopperRapier","TransmuteCopperRapier","copperTomahawk","CopperTomahawk","transmuteCopperTomahawk","TransmuteCopperTomahawk","sewers","Sewers","sewersExplorationGroup","SewersExplorationGroup","passageOfStenchStoryline","shardStockpileStoryline","wizardsHat","WizardsHat","transmuteWizardsHat","TransmuteWizardsHat","someonesTrashBookStoryline","someonesTrashHatStoryline","someonesTrashTreasureStoryline","advancedManaSpoutsStoryline","alchemyClassStoryline","createStorylineForElement","enabledElements","_getOrCreateDungeonEv","essenceArtifactStorylines","KnightInShiningArmor","howToFightHPStoryline","howToFightAttackStoryline","howToFightDefenseStoryline","howToFightAttackDelayStoryline","elementToUse","studentContestStoryline","loadStorylineEventsDemo","Posterity","retireUnlockEventBuilder","retireUnlockEvent","loadRetireUnlocker","BookOfMonsters","bestiaryUnlockEventBuilder","bestiaryUnlockEvent","loadBestiaryUnlocker","advertisingManualEventBuilder","advertisingManualEvent","loadAdvertisingManual","simultaneousChannelingEventBuilder","simultaneousChannelingEvent","loadSimultaneousChanneling","howToFightEventBuilder","howToFightEvent","loadHowToFight","flagsToActivate","dungeonsToClear","ZOOM_THROUGH_TRAINING","loadZoomThroughTraining","essenceArtifactEventBuilder","essenceArtifactEvent","addEvent","loadEssenceArtifact","alchemyClassEventBuilder","alchemyClassEvent","loadAlchemyClass","studentContestEventBuilder","studentContestEvent","loadStudentContest","advancedManaSpoutsEventBuilder","advancedManaSpoutsEvent","loadAdvancedManaSpouts","ticTacToeEventBuilder","ticTacToeEvent","TIC_TAC_TOE","loadTicTacToe","shardStockpileEventBuilder","shardStockpileEvent","loadShardStockpile","poisonUnlockEventBuilder","poisonLevel","poisonUnlockEvent","lastLine","TOME_OF_TOXIC_KNOWLEDGE","loadTomeOfToxicKnowledge","catalystAmount","maxAmount","multiplierPerCatalyst","loadOutessenced","_getAutocastStatusByR","loadPermaCast","goblinDenEventBuilder","goblinDenEvent","loadGoblinDen","someonesTrashEventBuilder","someonesTrashEvent","SomeonesTrashTreasureGranted","loadSomeonesTrash","passageOfStenchEventBuilder","passageOfStench","loadPassageOfStench","loadConvenience","varietyCollectorEventBuilder","varietyCollectorEvent","loadVarietyCollector","loadGameEventsDemo","selectEvent","loadDemoEndEvent","loadDungeonsDemo","loadEnemiesDemo","loadHelpsDemo","reset","isStudyEverUnlocked","isInventoryEverUnlocked","hasEverUnlockedCrafting","isEnhancementEverUnlocked","hasEverBeenPurchased","loadHintsDemo","_state$run$primaryEle","_state$run$primaryEle2","_state$run$primaryEle3","_state$run$primaryEle4","cloakOfDarkness","CloakOfDarkness","transmuteCloakOfDarkness","TransmuteCloakOfDarkness","copperShield","CopperShield","transmuteCopperShield","TransmuteCopperShield","smallShield","SmallShield","transmuteSmallShield","TransmuteSmallShield","stoneEgg","StoneEgg","isEquippedWithAnyParams","transmuteStoneEgg","TransmuteStoneEgg","collarOfPower","CollarOfPower","TransmuteCollarOfPower","transmuteCollarOfPower","AssassinsBaselard","poisonDurationTags","poisonStrength","poisonDuration","getPoisonStrength","strengthExplanation","assassinsBaselard","transmuteAssassinsBaselard","TransmuteAssassinsBaselard","assassinsCloak","AssassinsCloak","transmuteAssassinsCloak","TransmuteAssassinsCloak","charmOfPoisonResistance","CharmOfPoisonResistance","transmuteCharmOfPoisonResistance","TransmuteCharmOfPoisonResistance","soulStone","SoulStone","transmuteSoulStone","TransmuteSoulStone","manaTear","ManaTear","transmuteManaTear","TransmuteManaTear","ringOfRegeneration","RingOfRegeneration","TransmuteRingOfRegeneration","transmuteRingOfRegeneration","breezyShirt","BreezyShirt","transmuteBreezyShirt","TransmuteBreezyShirt","evasiveGarb","EvasiveGarb","transmuteEvasiveGarb","TransmuteEvasiveGarb","copperArmor","CopperArmor","transmuteCopperArmor","TransmuteCopperArmor","turtleArmor","TurtleArmor","transmuteTurtleArmor","TransmuteTurtleArmor","leatherArmor","LeatherArmor","transmuteLeatherArmor","TransmuteLeatherArmor","reinforcedLeatherArmor","ReinforcedLeatherArmor","transmuteReinforcedLeatherArmor","TransmuteReinforcedLeatherArmor","thickHide","elderWizardsRobe","ElderWizardsRobe","transmuteElderWizardsRobe","TransmuteElderWizardsRobe","tunicOfGoodHealth","TunicOfGoodHealth","transmuteTunicOfGoodHealth","TransmuteTunicOfGoodHealth","galeScepter","GaleScepter","magnitudeCost","explanationCost","transmuteGaleScepter","TransmuteGaleScepter","knuckles","Knuckles","transmuteKnuckles","TransmuteKnuckles","longsword","Longsword","transmuteLongsword","TransmuteLongsword","copperWarhammer","CopperWarhammer","transmuteCopperWarhammer","TransmuteCopperWarhammer","redConflagration","RedConflagration","fireEssence","transmuteRedConflagration","TransmuteRedConflagration","elementalPrismFire","wandOfFire","WandOfFire","transmuteWandOfFire","TransmuteWandOfFire","Dagger","dagger","transmuteDagger","TransmuteDagger","shadowBlade","ShadowBlade","transmuteShadowBlade","TransmuteShadowBlade","elementalPrismPoison","elementalPrismAir","wandOfPoison","WandOfPoison","transmuteWandOfPoison","TransmuteWandOfPoison","rod","Rod","transmuteRod","TransmuteRod","potionOfAlacrityTemporaryEffect","PotionOfAlacrityTemporaryEffect","potionOfAlacrity","PotionOfAlacrity","transmutePotionOfAlacrity","TransmutePotionOfAlacrity","slimeDrop","potionOfEvasionTemporaryEffect","PotionOfEvasionTemporaryEffect","potionOfEvasion","PotionOfEvasion","transmutePotionOfEvasion","TransmutePotionOfEvasion","PotionOfMuscleTemporaryEffect","potionOfMuscle","PotionOfMuscle","transmutePotionOfMuscle","TransmutePotionOfMuscle","PotionOfToughnessTemporaryEffect","potionOfToughness","PotionOfToughness","transmutePotionOfToughness","TransmutePotionOfToughness","PotionOfVitalityTemporaryEffect","potionOfVitality","PotionOfVitality","transmutePotionOfVitality","TransmutePotionOfVitality","CopperIngot","transmuteCopperIngot","TransmuteCopperIngot","ElementalPrism","baseSalePrice","ElementalPrismTransmutation","essenceAmountRequired","ElementalShard","ElementalShardTransmutation","ThickHide","transmuteThickHide","TransmuteThickHide","loadItemsDemo","pouchItems","used","_action$transform","shouldAutoUse","perElementData","salePriceMultiplier","shardItem","loadElementalShards","prismItem","loadElementalPrisms","airBlast","AirBlast","ActionVariance","blurTemporaryEffect","BlurTemporaryEffect","blur","Blur","EnchantSaleStallsTemporaryEffect","magnitudePct","enchantSaleStalls","EnchantSaleStalls","LevitationTemporaryEffect","levitation","Levitation","RichnessTemporaryEffect","richness","Richness","Twister","standardEffect","effectExplanation","getParameterlessDisplayDescription","ChannelAir","ChannelEarth","ChannelWater","FOUR_CHANNELING_SPELLS","ChannelFour","previous","ChannelPoison","earthShieldTemporaryEffect","EarthShieldTemporaryEffect","effectAmount","essenceAmount","calculateEffect","earthShield","EarthShield","TemporaryEffectExtraCost","essenceAmountExplanation","EnchantTransmutationTemporaryEffect","magnitudeMana","enchantTransmutation","EnchantTransmutation","GuardTemporaryEffect","Knockout","Landslide","stoneStrike","StoneStrike","cloakOfFlamesSpell","EnchantCatalystsTemporaryEffect","enchantCatalysts","EnchantCatalysts","fireball","Fireball","imbueFlamesTemporaryEffect","ImbueFlamesTemporaryEffect","imbueFlames","ImbueFlames","infernalBlaze","InfernalBlaze","Sear","damageText","Antidote","EnchantMonstiumCatalystsTemporaryEffect","enchantMonstiumCatalysts","EnchantMonstiumCatalysts","EnchantSewageSystemTemporaryEffect","enchantSewageSystem","EnchantSewageSystem","frailSpell","FrailSpell","intoxicate","Intoxicate","sting","Sting","standardAttack","DropletOfHealing","EnchantManaSpoutsTemporaryEffect","enchantManaSpouts","EnchantManaSpouts","EnchantManaSteamersTemporaryEffect","enchantManaSteamers","EnchantManaSteamers","Frost","LongevityTemporaryEffect","maxHPRatio","MaxHPMultiplier","longevity","Longevity","soak","Soak","Splash","streamOfHealing","StreamOfHealing","loadSpellsDemo","newMaxes","update","previousMax","oldExp","oldEmpoweredSpells","newEmpoweredSpells","spells","SynchroBonus","getBaseBonusEffects","getExplanationParamsByEffect","SynchroEffect","transformedEffect","DoubleElementSynchroBonus","_SynchroBonus","loadDoubleElementSynchroBonus","synchroBonus","FireSynchroBonus","EarthSynchroBonus","_SynchroBonus2","WaterSynchroBonus","_SynchroBonus3","AirSynchroBonus","_SynchroBonus4","_SynchroBonus5","PoisonSynchroBonus","_SynchroBonus6","MindSynchroBonus","_super6","_SynchroBonus7","LifeSynchroBonus","_super7","_SynchroBonus8","ElectricSynchroBonus","_super8","_SynchroBonus9","DeathSynchroBonus","_super9","_SynchroBonus10","HolySynchroBonus","_super10","_SynchroBonus11","TimeSynchroBonus","_super11","AirPoisonSynchroBonus","_AirSynchroBonus","EarthAirSynchroBonus","_EarthSynchroBonus","EarthPoisonSynchroBonus","EarthWaterSynchroBonus","FireAirSynchroBonus","_FireSynchroBonus","FireEarthSynchroBonus","FirePoisonSynchroBonus","FireWaterSynchroBonus","WaterAirSynchroBonus","_WaterSynchroBonus","WaterPoisonSynchroBonus","magnitudeConsumption","explanationConsumption","loadSynchroDemo","loadDoubleElementSynchroBonuses","getCurrentBonusEffect","loadFireEarthSynchroBonus","loadFireWaterSynchroBonus","loadFireAirSynchroBonus","loadFirePoisonSynchroBonus","loadEarthWaterSynchroBonus","loadEarthAirSynchroBonus","loadEarthPoisonSynchroBonus","loadWaterAirSynchroBonus","loadWaterPoisonSynchroBonus","loadAirPoisonSynchroBonus","loadDemoGame","TemporaryEffectExtraCostDivisor","loadElementMultipliers","loadResources","currentElementIdx","elementToAssign","loadTotalTimePlayed","timePerSale","saleStalls","totalProgress","loadMarket","costPerSecond","timePieceEventBuilder","timePieceEvent","timePieceEventBuilderFirstTime","timePieceEventFirstTime","timePieceGranter","OfflineTimePieceGain","oldTimePiece","lastEventOccurrenceId","_getEventOccurrenceBy","_eventOccurrence$para","_eventOccurrence$para2","rawAmount","loadTimePieces","totalCounter","loadGame","App","registerRootComponent","webpackContext","req","webpackContextResolve","__webpack_require__","o","code","module","exports","__webpack_module_cache__","moduleId","cachedModule","loaded","__webpack_modules__","m","deferred","O","chunkIds","notFulfilled","fulfilled","r","getter","__esModule","d","leafPrototypes","getProto","getPrototypeOf","then","ns","def","getOwnPropertyNames","definition","defineProperty","enumerable","g","globalThis","Function","prop","hasOwnProperty","Symbol","toStringTag","nmd","paths","p","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","self","__webpack_exports__"],"sourceRoot":""}